function F4(n,t){for(var e=0;e<t.length;e++){const s=t[e];if(typeof s!="string"&&!Array.isArray(s)){for(const r in s)if(r!=="default"&&!(r in n)){const i=Object.getOwnPropertyDescriptor(s,r);i&&Object.defineProperty(n,r,i.get?i:{enumerable:!0,get:()=>s[r]})}}}return Object.freeze(Object.defineProperty(n,Symbol.toStringTag,{value:"Module"}))}(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const r of document.querySelectorAll('link[rel="modulepreload"]'))s(r);new MutationObserver(r=>{for(const i of r)if(i.type==="childList")for(const o of i.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&s(o)}).observe(document,{childList:!0,subtree:!0});function e(r){const i={};return r.integrity&&(i.integrity=r.integrity),r.referrerPolicy&&(i.referrerPolicy=r.referrerPolicy),r.crossOrigin==="use-credentials"?i.credentials="include":r.crossOrigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function s(r){if(r.ep)return;r.ep=!0;const i=e(r);fetch(r.href,i)}})();function Yy(n){return n&&n.__esModule&&Object.prototype.hasOwnProperty.call(n,"default")?n.default:n}function L4(n){if(Object.prototype.hasOwnProperty.call(n,"__esModule"))return n;var t=n.default;if(typeof t=="function"){var e=function s(){return this instanceof s?Reflect.construct(t,arguments,this.constructor):t.apply(this,arguments)};e.prototype=t.prototype}else e={};return Object.defineProperty(e,"__esModule",{value:!0}),Object.keys(n).forEach(function(s){var r=Object.getOwnPropertyDescriptor(n,s);Object.defineProperty(e,s,r.get?r:{enumerable:!0,get:function(){return n[s]}})}),e}var V1={exports:{}},Ad={};/**
 * @license React
 * react-jsx-runtime.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var l_;function P4(){if(l_)return Ad;l_=1;var n=Symbol.for("react.transitional.element"),t=Symbol.for("react.fragment");function e(s,r,i){var o=null;if(i!==void 0&&(o=""+i),r.key!==void 0&&(o=""+r.key),"key"in r){i={};for(var l in r)l!=="key"&&(i[l]=r[l])}else i=r;return r=i.ref,{$$typeof:n,type:s,key:o,ref:r!==void 0?r:null,props:i}}return Ad.Fragment=t,Ad.jsx=e,Ad.jsxs=e,Ad}var u_;function V4(){return u_||(u_=1,V1.exports=P4()),V1.exports}var Ut=V4(),z1={exports:{}},ie={};/**
 * @license React
 * react.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var c_;function z4(){if(c_)return ie;c_=1;var n=Symbol.for("react.transitional.element"),t=Symbol.for("react.portal"),e=Symbol.for("react.fragment"),s=Symbol.for("react.strict_mode"),r=Symbol.for("react.profiler"),i=Symbol.for("react.consumer"),o=Symbol.for("react.context"),l=Symbol.for("react.forward_ref"),u=Symbol.for("react.suspense"),h=Symbol.for("react.memo"),d=Symbol.for("react.lazy"),p=Symbol.iterator;function m(B){return B===null||typeof B!="object"?null:(B=p&&B[p]||B["@@iterator"],typeof B=="function"?B:null)}var y={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},x=Object.assign,v={};function C(B,j,st){this.props=B,this.context=j,this.refs=v,this.updater=st||y}C.prototype.isReactComponent={},C.prototype.setState=function(B,j){if(typeof B!="object"&&typeof B!="function"&&B!=null)throw Error("takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,B,j,"setState")},C.prototype.forceUpdate=function(B){this.updater.enqueueForceUpdate(this,B,"forceUpdate")};function S(){}S.prototype=C.prototype;function E(B,j,st){this.props=B,this.context=j,this.refs=v,this.updater=st||y}var _=E.prototype=new S;_.constructor=E,x(_,C.prototype),_.isPureReactComponent=!0;var I=Array.isArray,O={H:null,A:null,T:null,S:null,V:null},P=Object.prototype.hasOwnProperty;function D(B,j,st,tt,xt,vt){return st=vt.ref,{$$typeof:n,type:B,key:j,ref:st!==void 0?st:null,props:vt}}function N(B,j){return D(B.type,j,void 0,void 0,void 0,B.props)}function R(B){return typeof B=="object"&&B!==null&&B.$$typeof===n}function $(B){var j={"=":"=0",":":"=2"};return"$"+B.replace(/[=:]/g,function(st){return j[st]})}var A=/\/+/g;function V(B,j){return typeof B=="object"&&B!==null&&B.key!=null?$(""+B.key):j.toString(36)}function L(){}function nt(B){switch(B.status){case"fulfilled":return B.value;case"rejected":throw B.reason;default:switch(typeof B.status=="string"?B.then(L,L):(B.status="pending",B.then(function(j){B.status==="pending"&&(B.status="fulfilled",B.value=j)},function(j){B.status==="pending"&&(B.status="rejected",B.reason=j)})),B.status){case"fulfilled":return B.value;case"rejected":throw B.reason}}throw B}function Z(B,j,st,tt,xt){var vt=typeof B;(vt==="undefined"||vt==="boolean")&&(B=null);var Ct=!1;if(B===null)Ct=!0;else switch(vt){case"bigint":case"string":case"number":Ct=!0;break;case"object":switch(B.$$typeof){case n:case t:Ct=!0;break;case d:return Ct=B._init,Z(Ct(B._payload),j,st,tt,xt)}}if(Ct)return xt=xt(B),Ct=tt===""?"."+V(B,0):tt,I(xt)?(st="",Ct!=null&&(st=Ct.replace(A,"$&/")+"/"),Z(xt,j,st,"",function(Lt){return Lt})):xt!=null&&(R(xt)&&(xt=N(xt,st+(xt.key==null||B&&B.key===xt.key?"":(""+xt.key).replace(A,"$&/")+"/")+Ct)),j.push(xt)),1;Ct=0;var $t=tt===""?".":tt+":";if(I(B))for(var Rt=0;Rt<B.length;Rt++)tt=B[Rt],vt=$t+V(tt,Rt),Ct+=Z(tt,j,st,vt,xt);else if(Rt=m(B),typeof Rt=="function")for(B=Rt.call(B),Rt=0;!(tt=B.next()).done;)tt=tt.value,vt=$t+V(tt,Rt++),Ct+=Z(tt,j,st,vt,xt);else if(vt==="object"){if(typeof B.then=="function")return Z(nt(B),j,st,tt,xt);throw j=String(B),Error("Objects are not valid as a React child (found: "+(j==="[object Object]"?"object with keys {"+Object.keys(B).join(", ")+"}":j)+"). If you meant to render a collection of children, use an array instead.")}return Ct}function W(B,j,st){if(B==null)return B;var tt=[],xt=0;return Z(B,tt,"","",function(vt){return j.call(st,vt,xt++)}),tt}function K(B){if(B._status===-1){var j=B._result;j=j(),j.then(function(st){(B._status===0||B._status===-1)&&(B._status=1,B._result=st)},function(st){(B._status===0||B._status===-1)&&(B._status=2,B._result=st)}),B._status===-1&&(B._status=0,B._result=j)}if(B._status===1)return B._result.default;throw B._result}var Y=typeof reportError=="function"?reportError:function(B){if(typeof window=="object"&&typeof window.ErrorEvent=="function"){var j=new window.ErrorEvent("error",{bubbles:!0,cancelable:!0,message:typeof B=="object"&&B!==null&&typeof B.message=="string"?String(B.message):String(B),error:B});if(!window.dispatchEvent(j))return}else if(typeof process=="object"&&typeof process.emit=="function"){process.emit("uncaughtException",B);return}console.error(B)};function at(){}return ie.Children={map:W,forEach:function(B,j,st){W(B,function(){j.apply(this,arguments)},st)},count:function(B){var j=0;return W(B,function(){j++}),j},toArray:function(B){return W(B,function(j){return j})||[]},only:function(B){if(!R(B))throw Error("React.Children.only expected to receive a single React element child.");return B}},ie.Component=C,ie.Fragment=e,ie.Profiler=r,ie.PureComponent=E,ie.StrictMode=s,ie.Suspense=u,ie.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE=O,ie.__COMPILER_RUNTIME={__proto__:null,c:function(B){return O.H.useMemoCache(B)}},ie.cache=function(B){return function(){return B.apply(null,arguments)}},ie.cloneElement=function(B,j,st){if(B==null)throw Error("The argument must be a React element, but you passed "+B+".");var tt=x({},B.props),xt=B.key,vt=void 0;if(j!=null)for(Ct in j.ref!==void 0&&(vt=void 0),j.key!==void 0&&(xt=""+j.key),j)!P.call(j,Ct)||Ct==="key"||Ct==="__self"||Ct==="__source"||Ct==="ref"&&j.ref===void 0||(tt[Ct]=j[Ct]);var Ct=arguments.length-2;if(Ct===1)tt.children=st;else if(1<Ct){for(var $t=Array(Ct),Rt=0;Rt<Ct;Rt++)$t[Rt]=arguments[Rt+2];tt.children=$t}return D(B.type,xt,void 0,void 0,vt,tt)},ie.createContext=function(B){return B={$$typeof:o,_currentValue:B,_currentValue2:B,_threadCount:0,Provider:null,Consumer:null},B.Provider=B,B.Consumer={$$typeof:i,_context:B},B},ie.createElement=function(B,j,st){var tt,xt={},vt=null;if(j!=null)for(tt in j.key!==void 0&&(vt=""+j.key),j)P.call(j,tt)&&tt!=="key"&&tt!=="__self"&&tt!=="__source"&&(xt[tt]=j[tt]);var Ct=arguments.length-2;if(Ct===1)xt.children=st;else if(1<Ct){for(var $t=Array(Ct),Rt=0;Rt<Ct;Rt++)$t[Rt]=arguments[Rt+2];xt.children=$t}if(B&&B.defaultProps)for(tt in Ct=B.defaultProps,Ct)xt[tt]===void 0&&(xt[tt]=Ct[tt]);return D(B,vt,void 0,void 0,null,xt)},ie.createRef=function(){return{current:null}},ie.forwardRef=function(B){return{$$typeof:l,render:B}},ie.isValidElement=R,ie.lazy=function(B){return{$$typeof:d,_payload:{_status:-1,_result:B},_init:K}},ie.memo=function(B,j){return{$$typeof:h,type:B,compare:j===void 0?null:j}},ie.startTransition=function(B){var j=O.T,st={};O.T=st;try{var tt=B(),xt=O.S;xt!==null&&xt(st,tt),typeof tt=="object"&&tt!==null&&typeof tt.then=="function"&&tt.then(at,Y)}catch(vt){Y(vt)}finally{O.T=j}},ie.unstable_useCacheRefresh=function(){return O.H.useCacheRefresh()},ie.use=function(B){return O.H.use(B)},ie.useActionState=function(B,j,st){return O.H.useActionState(B,j,st)},ie.useCallback=function(B,j){return O.H.useCallback(B,j)},ie.useContext=function(B){return O.H.useContext(B)},ie.useDebugValue=function(){},ie.useDeferredValue=function(B,j){return O.H.useDeferredValue(B,j)},ie.useEffect=function(B,j,st){var tt=O.H;if(typeof st=="function")throw Error("useEffect CRUD overload is not enabled in this build of React.");return tt.useEffect(B,j)},ie.useId=function(){return O.H.useId()},ie.useImperativeHandle=function(B,j,st){return O.H.useImperativeHandle(B,j,st)},ie.useInsertionEffect=function(B,j){return O.H.useInsertionEffect(B,j)},ie.useLayoutEffect=function(B,j){return O.H.useLayoutEffect(B,j)},ie.useMemo=function(B,j){return O.H.useMemo(B,j)},ie.useOptimistic=function(B,j){return O.H.useOptimistic(B,j)},ie.useReducer=function(B,j,st){return O.H.useReducer(B,j,st)},ie.useRef=function(B){return O.H.useRef(B)},ie.useState=function(B){return O.H.useState(B)},ie.useSyncExternalStore=function(B,j,st){return O.H.useSyncExternalStore(B,j,st)},ie.useTransition=function(){return O.H.useTransition()},ie.version="19.1.0",ie}var h_;function Qy(){return h_||(h_=1,z1.exports=z4()),z1.exports}var bt=Qy();const B4=Yy(bt);var B1={exports:{}},Nd={},U1={exports:{}},G1={};/**
 * @license React
 * scheduler.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var d_;function U4(){return d_||(d_=1,function(n){function t(W,K){var Y=W.length;W.push(K);t:for(;0<Y;){var at=Y-1>>>1,B=W[at];if(0<r(B,K))W[at]=K,W[Y]=B,Y=at;else break t}}function e(W){return W.length===0?null:W[0]}function s(W){if(W.length===0)return null;var K=W[0],Y=W.pop();if(Y!==K){W[0]=Y;t:for(var at=0,B=W.length,j=B>>>1;at<j;){var st=2*(at+1)-1,tt=W[st],xt=st+1,vt=W[xt];if(0>r(tt,Y))xt<B&&0>r(vt,tt)?(W[at]=vt,W[xt]=Y,at=xt):(W[at]=tt,W[st]=Y,at=st);else if(xt<B&&0>r(vt,Y))W[at]=vt,W[xt]=Y,at=xt;else break t}}return K}function r(W,K){var Y=W.sortIndex-K.sortIndex;return Y!==0?Y:W.id-K.id}if(n.unstable_now=void 0,typeof performance=="object"&&typeof performance.now=="function"){var i=performance;n.unstable_now=function(){return i.now()}}else{var o=Date,l=o.now();n.unstable_now=function(){return o.now()-l}}var u=[],h=[],d=1,p=null,m=3,y=!1,x=!1,v=!1,C=!1,S=typeof setTimeout=="function"?setTimeout:null,E=typeof clearTimeout=="function"?clearTimeout:null,_=typeof setImmediate<"u"?setImmediate:null;function I(W){for(var K=e(h);K!==null;){if(K.callback===null)s(h);else if(K.startTime<=W)s(h),K.sortIndex=K.expirationTime,t(u,K);else break;K=e(h)}}function O(W){if(v=!1,I(W),!x)if(e(u)!==null)x=!0,P||(P=!0,V());else{var K=e(h);K!==null&&Z(O,K.startTime-W)}}var P=!1,D=-1,N=5,R=-1;function $(){return C?!0:!(n.unstable_now()-R<N)}function A(){if(C=!1,P){var W=n.unstable_now();R=W;var K=!0;try{t:{x=!1,v&&(v=!1,E(D),D=-1),y=!0;var Y=m;try{e:{for(I(W),p=e(u);p!==null&&!(p.expirationTime>W&&$());){var at=p.callback;if(typeof at=="function"){p.callback=null,m=p.priorityLevel;var B=at(p.expirationTime<=W);if(W=n.unstable_now(),typeof B=="function"){p.callback=B,I(W),K=!0;break e}p===e(u)&&s(u),I(W)}else s(u);p=e(u)}if(p!==null)K=!0;else{var j=e(h);j!==null&&Z(O,j.startTime-W),K=!1}}break t}finally{p=null,m=Y,y=!1}K=void 0}}finally{K?V():P=!1}}}var V;if(typeof _=="function")V=function(){_(A)};else if(typeof MessageChannel<"u"){var L=new MessageChannel,nt=L.port2;L.port1.onmessage=A,V=function(){nt.postMessage(null)}}else V=function(){S(A,0)};function Z(W,K){D=S(function(){W(n.unstable_now())},K)}n.unstable_IdlePriority=5,n.unstable_ImmediatePriority=1,n.unstable_LowPriority=4,n.unstable_NormalPriority=3,n.unstable_Profiling=null,n.unstable_UserBlockingPriority=2,n.unstable_cancelCallback=function(W){W.callback=null},n.unstable_forceFrameRate=function(W){0>W||125<W?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):N=0<W?Math.floor(1e3/W):5},n.unstable_getCurrentPriorityLevel=function(){return m},n.unstable_next=function(W){switch(m){case 1:case 2:case 3:var K=3;break;default:K=m}var Y=m;m=K;try{return W()}finally{m=Y}},n.unstable_requestPaint=function(){C=!0},n.unstable_runWithPriority=function(W,K){switch(W){case 1:case 2:case 3:case 4:case 5:break;default:W=3}var Y=m;m=W;try{return K()}finally{m=Y}},n.unstable_scheduleCallback=function(W,K,Y){var at=n.unstable_now();switch(typeof Y=="object"&&Y!==null?(Y=Y.delay,Y=typeof Y=="number"&&0<Y?at+Y:at):Y=at,W){case 1:var B=-1;break;case 2:B=250;break;case 5:B=1073741823;break;case 4:B=1e4;break;default:B=5e3}return B=Y+B,W={id:d++,callback:K,priorityLevel:W,startTime:Y,expirationTime:B,sortIndex:-1},Y>at?(W.sortIndex=Y,t(h,W),e(u)===null&&W===e(h)&&(v?(E(D),D=-1):v=!0,Z(O,Y-at))):(W.sortIndex=B,t(u,W),x||y||(x=!0,P||(P=!0,V()))),W},n.unstable_shouldYield=$,n.unstable_wrapCallback=function(W){var K=m;return function(){var Y=m;m=K;try{return W.apply(this,arguments)}finally{m=Y}}}}(G1)),G1}var f_;function G4(){return f_||(f_=1,U1.exports=U4()),U1.exports}var W1={exports:{}},Rs={};/**
 * @license React
 * react-dom.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var p_;function W4(){if(p_)return Rs;p_=1;var n=Qy();function t(u){var h="https://react.dev/errors/"+u;if(1<arguments.length){h+="?args[]="+encodeURIComponent(arguments[1]);for(var d=2;d<arguments.length;d++)h+="&args[]="+encodeURIComponent(arguments[d])}return"Minified React error #"+u+"; visit "+h+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}function e(){}var s={d:{f:e,r:function(){throw Error(t(522))},D:e,C:e,L:e,m:e,X:e,S:e,M:e},p:0,findDOMNode:null},r=Symbol.for("react.portal");function i(u,h,d){var p=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:r,key:p==null?null:""+p,children:u,containerInfo:h,implementation:d}}var o=n.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE;function l(u,h){if(u==="font")return"";if(typeof h=="string")return h==="use-credentials"?h:""}return Rs.__DOM_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE=s,Rs.createPortal=function(u,h){var d=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!h||h.nodeType!==1&&h.nodeType!==9&&h.nodeType!==11)throw Error(t(299));return i(u,h,null,d)},Rs.flushSync=function(u){var h=o.T,d=s.p;try{if(o.T=null,s.p=2,u)return u()}finally{o.T=h,s.p=d,s.d.f()}},Rs.preconnect=function(u,h){typeof u=="string"&&(h?(h=h.crossOrigin,h=typeof h=="string"?h==="use-credentials"?h:"":void 0):h=null,s.d.C(u,h))},Rs.prefetchDNS=function(u){typeof u=="string"&&s.d.D(u)},Rs.preinit=function(u,h){if(typeof u=="string"&&h&&typeof h.as=="string"){var d=h.as,p=l(d,h.crossOrigin),m=typeof h.integrity=="string"?h.integrity:void 0,y=typeof h.fetchPriority=="string"?h.fetchPriority:void 0;d==="style"?s.d.S(u,typeof h.precedence=="string"?h.precedence:void 0,{crossOrigin:p,integrity:m,fetchPriority:y}):d==="script"&&s.d.X(u,{crossOrigin:p,integrity:m,fetchPriority:y,nonce:typeof h.nonce=="string"?h.nonce:void 0})}},Rs.preinitModule=function(u,h){if(typeof u=="string")if(typeof h=="object"&&h!==null){if(h.as==null||h.as==="script"){var d=l(h.as,h.crossOrigin);s.d.M(u,{crossOrigin:d,integrity:typeof h.integrity=="string"?h.integrity:void 0,nonce:typeof h.nonce=="string"?h.nonce:void 0})}}else h==null&&s.d.M(u)},Rs.preload=function(u,h){if(typeof u=="string"&&typeof h=="object"&&h!==null&&typeof h.as=="string"){var d=h.as,p=l(d,h.crossOrigin);s.d.L(u,d,{crossOrigin:p,integrity:typeof h.integrity=="string"?h.integrity:void 0,nonce:typeof h.nonce=="string"?h.nonce:void 0,type:typeof h.type=="string"?h.type:void 0,fetchPriority:typeof h.fetchPriority=="string"?h.fetchPriority:void 0,referrerPolicy:typeof h.referrerPolicy=="string"?h.referrerPolicy:void 0,imageSrcSet:typeof h.imageSrcSet=="string"?h.imageSrcSet:void 0,imageSizes:typeof h.imageSizes=="string"?h.imageSizes:void 0,media:typeof h.media=="string"?h.media:void 0})}},Rs.preloadModule=function(u,h){if(typeof u=="string")if(h){var d=l(h.as,h.crossOrigin);s.d.m(u,{as:typeof h.as=="string"&&h.as!=="script"?h.as:void 0,crossOrigin:d,integrity:typeof h.integrity=="string"?h.integrity:void 0})}else s.d.m(u)},Rs.requestFormReset=function(u){s.d.r(u)},Rs.unstable_batchedUpdates=function(u,h){return u(h)},Rs.useFormState=function(u,h,d){return o.H.useFormState(u,h,d)},Rs.useFormStatus=function(){return o.H.useHostTransitionStatus()},Rs.version="19.1.0",Rs}var m_;function H4(){if(m_)return W1.exports;m_=1;function n(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(n)}catch(t){console.error(t)}}return n(),W1.exports=W4(),W1.exports}/**
 * @license React
 * react-dom-client.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var g_;function q4(){if(g_)return Nd;g_=1;var n=G4(),t=Qy(),e=H4();function s(a){var c="https://react.dev/errors/"+a;if(1<arguments.length){c+="?args[]="+encodeURIComponent(arguments[1]);for(var f=2;f<arguments.length;f++)c+="&args[]="+encodeURIComponent(arguments[f])}return"Minified React error #"+a+"; visit "+c+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}function r(a){return!(!a||a.nodeType!==1&&a.nodeType!==9&&a.nodeType!==11)}function i(a){var c=a,f=a;if(a.alternate)for(;c.return;)c=c.return;else{a=c;do c=a,(c.flags&4098)!==0&&(f=c.return),a=c.return;while(a)}return c.tag===3?f:null}function o(a){if(a.tag===13){var c=a.memoizedState;if(c===null&&(a=a.alternate,a!==null&&(c=a.memoizedState)),c!==null)return c.dehydrated}return null}function l(a){if(i(a)!==a)throw Error(s(188))}function u(a){var c=a.alternate;if(!c){if(c=i(a),c===null)throw Error(s(188));return c!==a?null:a}for(var f=a,g=c;;){var w=f.return;if(w===null)break;var T=w.alternate;if(T===null){if(g=w.return,g!==null){f=g;continue}break}if(w.child===T.child){for(T=w.child;T;){if(T===f)return l(w),a;if(T===g)return l(w),c;T=T.sibling}throw Error(s(188))}if(f.return!==g.return)f=w,g=T;else{for(var F=!1,z=w.child;z;){if(z===f){F=!0,f=w,g=T;break}if(z===g){F=!0,g=w,f=T;break}z=z.sibling}if(!F){for(z=T.child;z;){if(z===f){F=!0,f=T,g=w;break}if(z===g){F=!0,g=T,f=w;break}z=z.sibling}if(!F)throw Error(s(189))}}if(f.alternate!==g)throw Error(s(190))}if(f.tag!==3)throw Error(s(188));return f.stateNode.current===f?a:c}function h(a){var c=a.tag;if(c===5||c===26||c===27||c===6)return a;for(a=a.child;a!==null;){if(c=h(a),c!==null)return c;a=a.sibling}return null}var d=Object.assign,p=Symbol.for("react.element"),m=Symbol.for("react.transitional.element"),y=Symbol.for("react.portal"),x=Symbol.for("react.fragment"),v=Symbol.for("react.strict_mode"),C=Symbol.for("react.profiler"),S=Symbol.for("react.provider"),E=Symbol.for("react.consumer"),_=Symbol.for("react.context"),I=Symbol.for("react.forward_ref"),O=Symbol.for("react.suspense"),P=Symbol.for("react.suspense_list"),D=Symbol.for("react.memo"),N=Symbol.for("react.lazy"),R=Symbol.for("react.activity"),$=Symbol.for("react.memo_cache_sentinel"),A=Symbol.iterator;function V(a){return a===null||typeof a!="object"?null:(a=A&&a[A]||a["@@iterator"],typeof a=="function"?a:null)}var L=Symbol.for("react.client.reference");function nt(a){if(a==null)return null;if(typeof a=="function")return a.$$typeof===L?null:a.displayName||a.name||null;if(typeof a=="string")return a;switch(a){case x:return"Fragment";case C:return"Profiler";case v:return"StrictMode";case O:return"Suspense";case P:return"SuspenseList";case R:return"Activity"}if(typeof a=="object")switch(a.$$typeof){case y:return"Portal";case _:return(a.displayName||"Context")+".Provider";case E:return(a._context.displayName||"Context")+".Consumer";case I:var c=a.render;return a=a.displayName,a||(a=c.displayName||c.name||"",a=a!==""?"ForwardRef("+a+")":"ForwardRef"),a;case D:return c=a.displayName||null,c!==null?c:nt(a.type)||"Memo";case N:c=a._payload,a=a._init;try{return nt(a(c))}catch{}}return null}var Z=Array.isArray,W=t.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE,K=e.__DOM_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE,Y={pending:!1,data:null,method:null,action:null},at=[],B=-1;function j(a){return{current:a}}function st(a){0>B||(a.current=at[B],at[B]=null,B--)}function tt(a,c){B++,at[B]=a.current,a.current=c}var xt=j(null),vt=j(null),Ct=j(null),$t=j(null);function Rt(a,c){switch(tt(Ct,c),tt(vt,a),tt(xt,null),c.nodeType){case 9:case 11:a=(a=c.documentElement)&&(a=a.namespaceURI)?F2(a):0;break;default:if(a=c.tagName,c=c.namespaceURI)c=F2(c),a=L2(c,a);else switch(a){case"svg":a=1;break;case"math":a=2;break;default:a=0}}st(xt),tt(xt,a)}function Lt(){st(xt),st(vt),st(Ct)}function jt(a){a.memoizedState!==null&&tt($t,a);var c=xt.current,f=L2(c,a.type);c!==f&&(tt(vt,a),tt(xt,f))}function Kt(a){vt.current===a&&(st(xt),st(vt)),$t.current===a&&(st($t),Td._currentValue=Y)}var de=Object.prototype.hasOwnProperty,be=n.unstable_scheduleCallback,Me=n.unstable_cancelCallback,Ne=n.unstable_shouldYield,Se=n.unstable_requestPaint,me=n.unstable_now,Ue=n.unstable_getCurrentPriorityLevel,Bs=n.unstable_ImmediatePriority,sn=n.unstable_UserBlockingPriority,As=n.unstable_NormalPriority,fs=n.unstable_LowPriority,Js=n.unstable_IdlePriority,ps=n.log,tr=n.unstable_setDisableYieldValue,Fe=null,fe=null;function mn(a){if(typeof ps=="function"&&tr(a),fe&&typeof fe.setStrictMode=="function")try{fe.setStrictMode(Fe,a)}catch{}}var gn=Math.clz32?Math.clz32:so,Xo=Math.log,al=Math.LN2;function so(a){return a>>>=0,a===0?32:31-(Xo(a)/al|0)|0}var Ir=256,ro=4194304;function hr(a){var c=a&42;if(c!==0)return c;switch(a&-a){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:return 64;case 128:return 128;case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return a&4194048;case 4194304:case 8388608:case 16777216:case 33554432:return a&62914560;case 67108864:return 67108864;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 0;default:return a}}function Nu(a,c,f){var g=a.pendingLanes;if(g===0)return 0;var w=0,T=a.suspendedLanes,F=a.pingedLanes;a=a.warmLanes;var z=g&134217727;return z!==0?(g=z&~T,g!==0?w=hr(g):(F&=z,F!==0?w=hr(F):f||(f=z&~a,f!==0&&(w=hr(f))))):(z=g&~T,z!==0?w=hr(z):F!==0?w=hr(F):f||(f=g&~a,f!==0&&(w=hr(f)))),w===0?0:c!==0&&c!==w&&(c&T)===0&&(T=w&-w,f=c&-c,T>=f||T===32&&(f&4194048)!==0)?c:w}function ll(a,c){return(a.pendingLanes&~(a.suspendedLanes&~a.pingedLanes)&c)===0}function Th(a,c){switch(a){case 1:case 2:case 4:case 8:case 64:return c+250;case 16:case 32:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return c+5e3;case 4194304:case 8388608:case 16777216:case 33554432:return-1;case 67108864:case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function Eh(){var a=Ir;return Ir<<=1,(Ir&4194048)===0&&(Ir=256),a}function Ih(){var a=ro;return ro<<=1,(ro&62914560)===0&&(ro=4194304),a}function io(a){for(var c=[],f=0;31>f;f++)c.push(a);return c}function oo(a,c){a.pendingLanes|=c,c!==268435456&&(a.suspendedLanes=0,a.pingedLanes=0,a.warmLanes=0)}function _h(a,c,f,g,w,T){var F=a.pendingLanes;a.pendingLanes=f,a.suspendedLanes=0,a.pingedLanes=0,a.warmLanes=0,a.expiredLanes&=f,a.entangledLanes&=f,a.errorRecoveryDisabledLanes&=f,a.shellSuspendCounter=0;var z=a.entanglements,q=a.expirationTimes,ht=a.hiddenUpdates;for(f=F&~f;0<f;){var wt=31-gn(f),Tt=1<<wt;z[wt]=0,q[wt]=-1;var ft=ht[wt];if(ft!==null)for(ht[wt]=null,wt=0;wt<ft.length;wt++){var pt=ft[wt];pt!==null&&(pt.lane&=-536870913)}f&=~Tt}g!==0&&gi(a,g,0),T!==0&&w===0&&a.tag!==0&&(a.suspendedLanes|=T&~(F&~c))}function gi(a,c,f){a.pendingLanes|=c,a.suspendedLanes&=~c;var g=31-gn(c);a.entangledLanes|=c,a.entanglements[g]=a.entanglements[g]|1073741824|f&4194090}function kh(a,c){var f=a.entangledLanes|=c;for(a=a.entanglements;f;){var g=31-gn(f),w=1<<g;w&c|a[g]&c&&(a[g]|=c),f&=~w}}function Yo(a){switch(a){case 2:a=1;break;case 8:a=4;break;case 32:a=16;break;case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:a=128;break;case 268435456:a=134217728;break;default:a=0}return a}function Ru(a){return a&=-a,2<a?8<a?(a&134217727)!==0?32:268435456:8:2}function Qo(){var a=K.p;return a!==0?a:(a=window.event,a===void 0?32:n_(a.type))}function Qp(a,c){var f=K.p;try{return K.p=a,c()}finally{K.p=f}}var an=Math.random().toString(36).slice(2),Gn="__reactFiber$"+an,Rn="__reactProps$"+an,_r="__reactContainer$"+an,Ah="__reactEvents$"+an,Ux="__reactListeners$"+an,Zo="__reactHandles$"+an,Zp="__reactResources$"+an,ul="__reactMarker$"+an;function Jo(a){delete a[Gn],delete a[Rn],delete a[Ah],delete a[Ux],delete a[Zo]}function ao(a){var c=a[Gn];if(c)return c;for(var f=a.parentNode;f;){if(c=f[_r]||f[Gn]){if(f=c.alternate,c.child!==null||f!==null&&f.child!==null)for(a=B2(a);a!==null;){if(f=a[Gn])return f;a=B2(a)}return c}a=f,f=a.parentNode}return null}function yi(a){if(a=a[Gn]||a[_r]){var c=a.tag;if(c===5||c===6||c===13||c===26||c===27||c===3)return a}return null}function xi(a){var c=a.tag;if(c===5||c===26||c===27||c===6)return a.stateNode;throw Error(s(33))}function Us(a){var c=a[Zp];return c||(c=a[Zp]={hoistableStyles:new Map,hoistableScripts:new Map}),c}function En(a){a[ul]=!0}var Nh=new Set,$u={};function Qr(a,c){lo(a,c),lo(a+"Capture",c)}function lo(a,c){for($u[a]=c,a=0;a<c.length;a++)Nh.add(c[a])}var Jp=RegExp("^[:A-Z_a-z\\u00C0-\\u00D6\\u00D8-\\u00F6\\u00F8-\\u02FF\\u0370-\\u037D\\u037F-\\u1FFF\\u200C-\\u200D\\u2070-\\u218F\\u2C00-\\u2FEF\\u3001-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFFD][:A-Z_a-z\\u00C0-\\u00D6\\u00D8-\\u00F6\\u00F8-\\u02FF\\u0370-\\u037D\\u037F-\\u1FFF\\u200C-\\u200D\\u2070-\\u218F\\u2C00-\\u2FEF\\u3001-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFFD\\-.0-9\\u00B7\\u0300-\\u036F\\u203F-\\u2040]*$"),tm={},cl={};function em(a){return de.call(cl,a)?!0:de.call(tm,a)?!1:Jp.test(a)?cl[a]=!0:(tm[a]=!0,!1)}function ta(a,c,f){if(em(c))if(f===null)a.removeAttribute(c);else{switch(typeof f){case"undefined":case"function":case"symbol":a.removeAttribute(c);return;case"boolean":var g=c.toLowerCase().slice(0,5);if(g!=="data-"&&g!=="aria-"){a.removeAttribute(c);return}}a.setAttribute(c,""+f)}}function bi(a,c,f){if(f===null)a.removeAttribute(c);else{switch(typeof f){case"undefined":case"function":case"symbol":case"boolean":a.removeAttribute(c);return}a.setAttribute(c,""+f)}}function ms(a,c,f,g){if(g===null)a.removeAttribute(f);else{switch(typeof g){case"undefined":case"function":case"symbol":case"boolean":a.removeAttribute(f);return}a.setAttributeNS(c,f,""+g)}}var hl,nm;function uo(a){if(hl===void 0)try{throw Error()}catch(f){var c=f.stack.trim().match(/\n( *(at )?)/);hl=c&&c[1]||"",nm=-1<f.stack.indexOf(`
    at`)?" (<anonymous>)":-1<f.stack.indexOf("@")?"@unknown:0:0":""}return`
`+hl+a+nm}var Du=!1;function Ou(a,c){if(!a||Du)return"";Du=!0;var f=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{var g={DetermineComponentFrameRoot:function(){try{if(c){var Tt=function(){throw Error()};if(Object.defineProperty(Tt.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(Tt,[])}catch(pt){var ft=pt}Reflect.construct(a,[],Tt)}else{try{Tt.call()}catch(pt){ft=pt}a.call(Tt.prototype)}}else{try{throw Error()}catch(pt){ft=pt}(Tt=a())&&typeof Tt.catch=="function"&&Tt.catch(function(){})}}catch(pt){if(pt&&ft&&typeof pt.stack=="string")return[pt.stack,ft.stack]}return[null,null]}};g.DetermineComponentFrameRoot.displayName="DetermineComponentFrameRoot";var w=Object.getOwnPropertyDescriptor(g.DetermineComponentFrameRoot,"name");w&&w.configurable&&Object.defineProperty(g.DetermineComponentFrameRoot,"name",{value:"DetermineComponentFrameRoot"});var T=g.DetermineComponentFrameRoot(),F=T[0],z=T[1];if(F&&z){var q=F.split(`
`),ht=z.split(`
`);for(w=g=0;g<q.length&&!q[g].includes("DetermineComponentFrameRoot");)g++;for(;w<ht.length&&!ht[w].includes("DetermineComponentFrameRoot");)w++;if(g===q.length||w===ht.length)for(g=q.length-1,w=ht.length-1;1<=g&&0<=w&&q[g]!==ht[w];)w--;for(;1<=g&&0<=w;g--,w--)if(q[g]!==ht[w]){if(g!==1||w!==1)do if(g--,w--,0>w||q[g]!==ht[w]){var wt=`
`+q[g].replace(" at new "," at ");return a.displayName&&wt.includes("<anonymous>")&&(wt=wt.replace("<anonymous>",a.displayName)),wt}while(1<=g&&0<=w);break}}}finally{Du=!1,Error.prepareStackTrace=f}return(f=a?a.displayName||a.name:"")?uo(f):""}function Rh(a){switch(a.tag){case 26:case 27:case 5:return uo(a.type);case 16:return uo("Lazy");case 13:return uo("Suspense");case 19:return uo("SuspenseList");case 0:case 15:return Ou(a.type,!1);case 11:return Ou(a.type.render,!1);case 1:return Ou(a.type,!0);case 31:return uo("Activity");default:return""}}function Mu(a){try{var c="";do c+=Rh(a),a=a.return;while(a);return c}catch(f){return`
Error generating stack: `+f.message+`
`+f.stack}}function Gs(a){switch(typeof a){case"bigint":case"boolean":case"number":case"string":case"undefined":return a;case"object":return a;default:return""}}function $h(a){var c=a.type;return(a=a.nodeName)&&a.toLowerCase()==="input"&&(c==="checkbox"||c==="radio")}function Gx(a){var c=$h(a)?"checked":"value",f=Object.getOwnPropertyDescriptor(a.constructor.prototype,c),g=""+a[c];if(!a.hasOwnProperty(c)&&typeof f<"u"&&typeof f.get=="function"&&typeof f.set=="function"){var w=f.get,T=f.set;return Object.defineProperty(a,c,{configurable:!0,get:function(){return w.call(this)},set:function(F){g=""+F,T.call(this,F)}}),Object.defineProperty(a,c,{enumerable:f.enumerable}),{getValue:function(){return g},setValue:function(F){g=""+F},stopTracking:function(){a._valueTracker=null,delete a[c]}}}}function Fu(a){a._valueTracker||(a._valueTracker=Gx(a))}function Dh(a){if(!a)return!1;var c=a._valueTracker;if(!c)return!0;var f=c.getValue(),g="";return a&&(g=$h(a)?a.checked?"true":"false":a.value),a=g,a!==f?(c.setValue(a),!0):!1}function dl(a){if(a=a||(typeof document<"u"?document:void 0),typeof a>"u")return null;try{return a.activeElement||a.body}catch{return a.body}}var Wx=/[\n"\\]/g;function $n(a){return a.replace(Wx,function(c){return"\\"+c.charCodeAt(0).toString(16)+" "})}function dr(a,c,f,g,w,T,F,z){a.name="",F!=null&&typeof F!="function"&&typeof F!="symbol"&&typeof F!="boolean"?a.type=F:a.removeAttribute("type"),c!=null?F==="number"?(c===0&&a.value===""||a.value!=c)&&(a.value=""+Gs(c)):a.value!==""+Gs(c)&&(a.value=""+Gs(c)):F!=="submit"&&F!=="reset"||a.removeAttribute("value"),c!=null?ea(a,F,Gs(c)):f!=null?ea(a,F,Gs(f)):g!=null&&a.removeAttribute("value"),w==null&&T!=null&&(a.defaultChecked=!!T),w!=null&&(a.checked=w&&typeof w!="function"&&typeof w!="symbol"),z!=null&&typeof z!="function"&&typeof z!="symbol"&&typeof z!="boolean"?a.name=""+Gs(z):a.removeAttribute("name")}function fl(a,c,f,g,w,T,F,z){if(T!=null&&typeof T!="function"&&typeof T!="symbol"&&typeof T!="boolean"&&(a.type=T),c!=null||f!=null){if(!(T!=="submit"&&T!=="reset"||c!=null))return;f=f!=null?""+Gs(f):"",c=c!=null?""+Gs(c):f,z||c===a.value||(a.value=c),a.defaultValue=c}g=g??w,g=typeof g!="function"&&typeof g!="symbol"&&!!g,a.checked=z?a.checked:!!g,a.defaultChecked=!!g,F!=null&&typeof F!="function"&&typeof F!="symbol"&&typeof F!="boolean"&&(a.name=F)}function ea(a,c,f){c==="number"&&dl(a.ownerDocument)===a||a.defaultValue===""+f||(a.defaultValue=""+f)}function co(a,c,f,g){if(a=a.options,c){c={};for(var w=0;w<f.length;w++)c["$"+f[w]]=!0;for(f=0;f<a.length;f++)w=c.hasOwnProperty("$"+a[f].value),a[f].selected!==w&&(a[f].selected=w),w&&g&&(a[f].defaultSelected=!0)}else{for(f=""+Gs(f),c=null,w=0;w<a.length;w++){if(a[w].value===f){a[w].selected=!0,g&&(a[w].defaultSelected=!0);return}c!==null||a[w].disabled||(c=a[w])}c!==null&&(c.selected=!0)}}function qe(a,c,f){if(c!=null&&(c=""+Gs(c),c!==a.value&&(a.value=c),f==null)){a.defaultValue!==c&&(a.defaultValue=c);return}a.defaultValue=f!=null?""+Gs(f):""}function pl(a,c,f,g){if(c==null){if(g!=null){if(f!=null)throw Error(s(92));if(Z(g)){if(1<g.length)throw Error(s(93));g=g[0]}f=g}f==null&&(f=""),c=f}f=Gs(c),a.defaultValue=f,g=a.textContent,g===f&&g!==""&&g!==null&&(a.value=g)}function kr(a,c){if(c){var f=a.firstChild;if(f&&f===a.lastChild&&f.nodeType===3){f.nodeValue=c;return}}a.textContent=c}var ml=new Set("animationIterationCount aspectRatio borderImageOutset borderImageSlice borderImageWidth boxFlex boxFlexGroup boxOrdinalGroup columnCount columns flex flexGrow flexPositive flexShrink flexNegative flexOrder gridArea gridRow gridRowEnd gridRowSpan gridRowStart gridColumn gridColumnEnd gridColumnSpan gridColumnStart fontWeight lineClamp lineHeight opacity order orphans scale tabSize widows zIndex zoom fillOpacity floodOpacity stopOpacity strokeDasharray strokeDashoffset strokeMiterlimit strokeOpacity strokeWidth MozAnimationIterationCount MozBoxFlex MozBoxFlexGroup MozLineClamp msAnimationIterationCount msFlex msZoom msFlexGrow msFlexNegative msFlexOrder msFlexPositive msFlexShrink msGridColumn msGridColumnSpan msGridRow msGridRowSpan WebkitAnimationIterationCount WebkitBoxFlex WebKitBoxFlexGroup WebkitBoxOrdinalGroup WebkitColumnCount WebkitColumns WebkitFlex WebkitFlexGrow WebkitFlexPositive WebkitFlexShrink WebkitLineClamp".split(" "));function sm(a,c,f){var g=c.indexOf("--")===0;f==null||typeof f=="boolean"||f===""?g?a.setProperty(c,""):c==="float"?a.cssFloat="":a[c]="":g?a.setProperty(c,f):typeof f!="number"||f===0||ml.has(c)?c==="float"?a.cssFloat=f:a[c]=(""+f).trim():a[c]=f+"px"}function Oh(a,c,f){if(c!=null&&typeof c!="object")throw Error(s(62));if(a=a.style,f!=null){for(var g in f)!f.hasOwnProperty(g)||c!=null&&c.hasOwnProperty(g)||(g.indexOf("--")===0?a.setProperty(g,""):g==="float"?a.cssFloat="":a[g]="");for(var w in c)g=c[w],c.hasOwnProperty(w)&&f[w]!==g&&sm(a,w,g)}else for(var T in c)c.hasOwnProperty(T)&&sm(a,T,c[T])}function Mh(a){if(a.indexOf("-")===-1)return!1;switch(a){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var Hx=new Map([["acceptCharset","accept-charset"],["htmlFor","for"],["httpEquiv","http-equiv"],["crossOrigin","crossorigin"],["accentHeight","accent-height"],["alignmentBaseline","alignment-baseline"],["arabicForm","arabic-form"],["baselineShift","baseline-shift"],["capHeight","cap-height"],["clipPath","clip-path"],["clipRule","clip-rule"],["colorInterpolation","color-interpolation"],["colorInterpolationFilters","color-interpolation-filters"],["colorProfile","color-profile"],["colorRendering","color-rendering"],["dominantBaseline","dominant-baseline"],["enableBackground","enable-background"],["fillOpacity","fill-opacity"],["fillRule","fill-rule"],["floodColor","flood-color"],["floodOpacity","flood-opacity"],["fontFamily","font-family"],["fontSize","font-size"],["fontSizeAdjust","font-size-adjust"],["fontStretch","font-stretch"],["fontStyle","font-style"],["fontVariant","font-variant"],["fontWeight","font-weight"],["glyphName","glyph-name"],["glyphOrientationHorizontal","glyph-orientation-horizontal"],["glyphOrientationVertical","glyph-orientation-vertical"],["horizAdvX","horiz-adv-x"],["horizOriginX","horiz-origin-x"],["imageRendering","image-rendering"],["letterSpacing","letter-spacing"],["lightingColor","lighting-color"],["markerEnd","marker-end"],["markerMid","marker-mid"],["markerStart","marker-start"],["overlinePosition","overline-position"],["overlineThickness","overline-thickness"],["paintOrder","paint-order"],["panose-1","panose-1"],["pointerEvents","pointer-events"],["renderingIntent","rendering-intent"],["shapeRendering","shape-rendering"],["stopColor","stop-color"],["stopOpacity","stop-opacity"],["strikethroughPosition","strikethrough-position"],["strikethroughThickness","strikethrough-thickness"],["strokeDasharray","stroke-dasharray"],["strokeDashoffset","stroke-dashoffset"],["strokeLinecap","stroke-linecap"],["strokeLinejoin","stroke-linejoin"],["strokeMiterlimit","stroke-miterlimit"],["strokeOpacity","stroke-opacity"],["strokeWidth","stroke-width"],["textAnchor","text-anchor"],["textDecoration","text-decoration"],["textRendering","text-rendering"],["transformOrigin","transform-origin"],["underlinePosition","underline-position"],["underlineThickness","underline-thickness"],["unicodeBidi","unicode-bidi"],["unicodeRange","unicode-range"],["unitsPerEm","units-per-em"],["vAlphabetic","v-alphabetic"],["vHanging","v-hanging"],["vIdeographic","v-ideographic"],["vMathematical","v-mathematical"],["vectorEffect","vector-effect"],["vertAdvY","vert-adv-y"],["vertOriginX","vert-origin-x"],["vertOriginY","vert-origin-y"],["wordSpacing","word-spacing"],["writingMode","writing-mode"],["xmlnsXlink","xmlns:xlink"],["xHeight","x-height"]]),qx=/^[\u0000-\u001F ]*j[\r\n\t]*a[\r\n\t]*v[\r\n\t]*a[\r\n\t]*s[\r\n\t]*c[\r\n\t]*r[\r\n\t]*i[\r\n\t]*p[\r\n\t]*t[\r\n\t]*:/i;function Lu(a){return qx.test(""+a)?"javascript:throw new Error('React has blocked a javascript: URL as a security precaution.')":a}var ho=null;function Ar(a){return a=a.target||a.srcElement||window,a.correspondingUseElement&&(a=a.correspondingUseElement),a.nodeType===3?a.parentNode:a}var fo=null,po=null;function Fh(a){var c=yi(a);if(c&&(a=c.stateNode)){var f=a[Rn]||null;t:switch(a=c.stateNode,c.type){case"input":if(dr(a,f.value,f.defaultValue,f.defaultValue,f.checked,f.defaultChecked,f.type,f.name),c=f.name,f.type==="radio"&&c!=null){for(f=a;f.parentNode;)f=f.parentNode;for(f=f.querySelectorAll('input[name="'+$n(""+c)+'"][type="radio"]'),c=0;c<f.length;c++){var g=f[c];if(g!==a&&g.form===a.form){var w=g[Rn]||null;if(!w)throw Error(s(90));dr(g,w.value,w.defaultValue,w.defaultValue,w.checked,w.defaultChecked,w.type,w.name)}}for(c=0;c<f.length;c++)g=f[c],g.form===a.form&&Dh(g)}break t;case"textarea":qe(a,f.value,f.defaultValue);break t;case"select":c=f.value,c!=null&&co(a,!!f.multiple,c,!1)}}}var vi=!1;function rm(a,c,f){if(vi)return a(c,f);vi=!0;try{var g=a(c);return g}finally{if(vi=!1,(fo!==null||po!==null)&&(Qm(),fo&&(c=fo,a=po,po=fo=null,Fh(c),a)))for(c=0;c<a.length;c++)Fh(a[c])}}function gl(a,c){var f=a.stateNode;if(f===null)return null;var g=f[Rn]||null;if(g===null)return null;f=g[c];t:switch(c){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(g=!g.disabled)||(a=a.type,g=!(a==="button"||a==="input"||a==="select"||a==="textarea")),a=!g;break t;default:a=!1}if(a)return null;if(f&&typeof f!="function")throw Error(s(231,c,typeof f));return f}var Zr=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),Nr=!1;if(Zr)try{var yl={};Object.defineProperty(yl,"passive",{get:function(){Nr=!0}}),window.addEventListener("test",yl,yl),window.removeEventListener("test",yl,yl)}catch{Nr=!1}var wi=null,na=null,mo=null;function Lh(){if(mo)return mo;var a,c=na,f=c.length,g,w="value"in wi?wi.value:wi.textContent,T=w.length;for(a=0;a<f&&c[a]===w[a];a++);var F=f-a;for(g=1;g<=F&&c[f-g]===w[T-g];g++);return mo=w.slice(a,1<g?1-g:void 0)}function Ci(a){var c=a.keyCode;return"charCode"in a?(a=a.charCode,a===0&&c===13&&(a=13)):a=c,a===10&&(a=13),32<=a||a===13?a:0}function Si(){return!0}function Ph(){return!1}function ns(a){function c(f,g,w,T,F){this._reactName=f,this._targetInst=w,this.type=g,this.nativeEvent=T,this.target=F,this.currentTarget=null;for(var z in a)a.hasOwnProperty(z)&&(f=a[z],this[z]=f?f(T):T[z]);return this.isDefaultPrevented=(T.defaultPrevented!=null?T.defaultPrevented:T.returnValue===!1)?Si:Ph,this.isPropagationStopped=Ph,this}return d(c.prototype,{preventDefault:function(){this.defaultPrevented=!0;var f=this.nativeEvent;f&&(f.preventDefault?f.preventDefault():typeof f.returnValue!="unknown"&&(f.returnValue=!1),this.isDefaultPrevented=Si)},stopPropagation:function(){var f=this.nativeEvent;f&&(f.stopPropagation?f.stopPropagation():typeof f.cancelBubble!="unknown"&&(f.cancelBubble=!0),this.isPropagationStopped=Si)},persist:function(){},isPersistent:Si}),c}var Pe={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(a){return a.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},Pu=ns(Pe),xl=d({},Pe,{view:0,detail:0}),im=ns(xl),Vu,zu,Ti,bl=d({},xl,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:Cl,button:0,buttons:0,relatedTarget:function(a){return a.relatedTarget===void 0?a.fromElement===a.srcElement?a.toElement:a.fromElement:a.relatedTarget},movementX:function(a){return"movementX"in a?a.movementX:(a!==Ti&&(Ti&&a.type==="mousemove"?(Vu=a.screenX-Ti.screenX,zu=a.screenY-Ti.screenY):zu=Vu=0,Ti=a),Vu)},movementY:function(a){return"movementY"in a?a.movementY:zu}}),Rr=ns(bl),om=d({},bl,{dataTransfer:0}),jx=ns(om),vl=d({},xl,{relatedTarget:0}),Bu=ns(vl),Vh=d({},Pe,{animationName:0,elapsedTime:0,pseudoElement:0}),Uu=ns(Vh),am=d({},Pe,{clipboardData:function(a){return"clipboardData"in a?a.clipboardData:window.clipboardData}}),Gu=ns(am),Kx=d({},Pe,{data:0}),zh=ns(Kx),wl={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},lm={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},um={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function Bh(a){var c=this.nativeEvent;return c.getModifierState?c.getModifierState(a):(a=um[a])?!!c[a]:!1}function Cl(){return Bh}var cm=d({},xl,{key:function(a){if(a.key){var c=wl[a.key]||a.key;if(c!=="Unidentified")return c}return a.type==="keypress"?(a=Ci(a),a===13?"Enter":String.fromCharCode(a)):a.type==="keydown"||a.type==="keyup"?lm[a.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:Cl,charCode:function(a){return a.type==="keypress"?Ci(a):0},keyCode:function(a){return a.type==="keydown"||a.type==="keyup"?a.keyCode:0},which:function(a){return a.type==="keypress"?Ci(a):a.type==="keydown"||a.type==="keyup"?a.keyCode:0}}),Wu=ns(cm),hm=d({},bl,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),Uh=ns(hm),go=d({},xl,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:Cl}),dm=ns(go),fm=d({},Pe,{propertyName:0,elapsedTime:0,pseudoElement:0}),pm=ns(fm),mm=d({},bl,{deltaX:function(a){return"deltaX"in a?a.deltaX:"wheelDeltaX"in a?-a.wheelDeltaX:0},deltaY:function(a){return"deltaY"in a?a.deltaY:"wheelDeltaY"in a?-a.wheelDeltaY:"wheelDelta"in a?-a.wheelDelta:0},deltaZ:0,deltaMode:0}),Hu=ns(mm),Ws=d({},Pe,{newState:0,oldState:0}),gm=ns(Ws),ym=[9,13,27,32],Ei=Zr&&"CompositionEvent"in window,b=null;Zr&&"documentMode"in document&&(b=document.documentMode);var k=Zr&&"TextEvent"in window&&!b,M=Zr&&(!Ei||b&&8<b&&11>=b),G=" ",lt=!1;function gt(a,c){switch(a){case"keyup":return ym.indexOf(c.keyCode)!==-1;case"keydown":return c.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function At(a){return a=a.detail,typeof a=="object"&&"data"in a?a.data:null}var Te=!1;function Wn(a,c){switch(a){case"compositionend":return At(c);case"keypress":return c.which!==32?null:(lt=!0,G);case"textInput":return a=c.data,a===G&&lt?null:a;default:return null}}function Ee(a,c){if(Te)return a==="compositionend"||!Ei&&gt(a,c)?(a=Lh(),mo=na=wi=null,Te=!1,a):null;switch(a){case"paste":return null;case"keypress":if(!(c.ctrlKey||c.altKey||c.metaKey)||c.ctrlKey&&c.altKey){if(c.char&&1<c.char.length)return c.char;if(c.which)return String.fromCharCode(c.which)}return null;case"compositionend":return M&&c.locale!=="ko"?null:c.data;default:return null}}var ss={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function Hn(a){var c=a&&a.nodeName&&a.nodeName.toLowerCase();return c==="input"?!!ss[a.type]:c==="textarea"}function yo(a,c,f,g){fo?po?po.push(g):po=[g]:fo=g,c=sg(c,"onChange"),0<c.length&&(f=new Pu("onChange","change",null,f,g),a.push({event:f,listeners:c}))}var gs=null,Ii=null;function Gh(a){R2(a,0)}function xm(a){var c=xi(a);if(Dh(c))return a}function ZT(a,c){if(a==="change")return c}var JT=!1;if(Zr){var Xx;if(Zr){var Yx="oninput"in document;if(!Yx){var tE=document.createElement("div");tE.setAttribute("oninput","return;"),Yx=typeof tE.oninput=="function"}Xx=Yx}else Xx=!1;JT=Xx&&(!document.documentMode||9<document.documentMode)}function eE(){gs&&(gs.detachEvent("onpropertychange",nE),Ii=gs=null)}function nE(a){if(a.propertyName==="value"&&xm(Ii)){var c=[];yo(c,Ii,a,Ar(a)),rm(Gh,c)}}function dP(a,c,f){a==="focusin"?(eE(),gs=c,Ii=f,gs.attachEvent("onpropertychange",nE)):a==="focusout"&&eE()}function fP(a){if(a==="selectionchange"||a==="keyup"||a==="keydown")return xm(Ii)}function pP(a,c){if(a==="click")return xm(c)}function mP(a,c){if(a==="input"||a==="change")return xm(c)}function gP(a,c){return a===c&&(a!==0||1/a===1/c)||a!==a&&c!==c}var fr=typeof Object.is=="function"?Object.is:gP;function Wh(a,c){if(fr(a,c))return!0;if(typeof a!="object"||a===null||typeof c!="object"||c===null)return!1;var f=Object.keys(a),g=Object.keys(c);if(f.length!==g.length)return!1;for(g=0;g<f.length;g++){var w=f[g];if(!de.call(c,w)||!fr(a[w],c[w]))return!1}return!0}function sE(a){for(;a&&a.firstChild;)a=a.firstChild;return a}function rE(a,c){var f=sE(a);a=0;for(var g;f;){if(f.nodeType===3){if(g=a+f.textContent.length,a<=c&&g>=c)return{node:f,offset:c-a};a=g}t:{for(;f;){if(f.nextSibling){f=f.nextSibling;break t}f=f.parentNode}f=void 0}f=sE(f)}}function iE(a,c){return a&&c?a===c?!0:a&&a.nodeType===3?!1:c&&c.nodeType===3?iE(a,c.parentNode):"contains"in a?a.contains(c):a.compareDocumentPosition?!!(a.compareDocumentPosition(c)&16):!1:!1}function oE(a){a=a!=null&&a.ownerDocument!=null&&a.ownerDocument.defaultView!=null?a.ownerDocument.defaultView:window;for(var c=dl(a.document);c instanceof a.HTMLIFrameElement;){try{var f=typeof c.contentWindow.location.href=="string"}catch{f=!1}if(f)a=c.contentWindow;else break;c=dl(a.document)}return c}function Qx(a){var c=a&&a.nodeName&&a.nodeName.toLowerCase();return c&&(c==="input"&&(a.type==="text"||a.type==="search"||a.type==="tel"||a.type==="url"||a.type==="password")||c==="textarea"||a.contentEditable==="true")}var yP=Zr&&"documentMode"in document&&11>=document.documentMode,qu=null,Zx=null,Hh=null,Jx=!1;function aE(a,c,f){var g=f.window===f?f.document:f.nodeType===9?f:f.ownerDocument;Jx||qu==null||qu!==dl(g)||(g=qu,"selectionStart"in g&&Qx(g)?g={start:g.selectionStart,end:g.selectionEnd}:(g=(g.ownerDocument&&g.ownerDocument.defaultView||window).getSelection(),g={anchorNode:g.anchorNode,anchorOffset:g.anchorOffset,focusNode:g.focusNode,focusOffset:g.focusOffset}),Hh&&Wh(Hh,g)||(Hh=g,g=sg(Zx,"onSelect"),0<g.length&&(c=new Pu("onSelect","select",null,c,f),a.push({event:c,listeners:g}),c.target=qu)))}function Sl(a,c){var f={};return f[a.toLowerCase()]=c.toLowerCase(),f["Webkit"+a]="webkit"+c,f["Moz"+a]="moz"+c,f}var ju={animationend:Sl("Animation","AnimationEnd"),animationiteration:Sl("Animation","AnimationIteration"),animationstart:Sl("Animation","AnimationStart"),transitionrun:Sl("Transition","TransitionRun"),transitionstart:Sl("Transition","TransitionStart"),transitioncancel:Sl("Transition","TransitionCancel"),transitionend:Sl("Transition","TransitionEnd")},tb={},lE={};Zr&&(lE=document.createElement("div").style,"AnimationEvent"in window||(delete ju.animationend.animation,delete ju.animationiteration.animation,delete ju.animationstart.animation),"TransitionEvent"in window||delete ju.transitionend.transition);function Tl(a){if(tb[a])return tb[a];if(!ju[a])return a;var c=ju[a],f;for(f in c)if(c.hasOwnProperty(f)&&f in lE)return tb[a]=c[f];return a}var uE=Tl("animationend"),cE=Tl("animationiteration"),hE=Tl("animationstart"),xP=Tl("transitionrun"),bP=Tl("transitionstart"),vP=Tl("transitioncancel"),dE=Tl("transitionend"),fE=new Map,eb="abort auxClick beforeToggle cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");eb.push("scrollEnd");function Jr(a,c){fE.set(a,c),Qr(c,[a])}var pE=new WeakMap;function $r(a,c){if(typeof a=="object"&&a!==null){var f=pE.get(a);return f!==void 0?f:(c={value:a,source:c,stack:Mu(c)},pE.set(a,c),c)}return{value:a,source:c,stack:Mu(c)}}var Dr=[],Ku=0,nb=0;function bm(){for(var a=Ku,c=nb=Ku=0;c<a;){var f=Dr[c];Dr[c++]=null;var g=Dr[c];Dr[c++]=null;var w=Dr[c];Dr[c++]=null;var T=Dr[c];if(Dr[c++]=null,g!==null&&w!==null){var F=g.pending;F===null?w.next=w:(w.next=F.next,F.next=w),g.pending=w}T!==0&&mE(f,w,T)}}function vm(a,c,f,g){Dr[Ku++]=a,Dr[Ku++]=c,Dr[Ku++]=f,Dr[Ku++]=g,nb|=g,a.lanes|=g,a=a.alternate,a!==null&&(a.lanes|=g)}function sb(a,c,f,g){return vm(a,c,f,g),wm(a)}function Xu(a,c){return vm(a,null,null,c),wm(a)}function mE(a,c,f){a.lanes|=f;var g=a.alternate;g!==null&&(g.lanes|=f);for(var w=!1,T=a.return;T!==null;)T.childLanes|=f,g=T.alternate,g!==null&&(g.childLanes|=f),T.tag===22&&(a=T.stateNode,a===null||a._visibility&1||(w=!0)),a=T,T=T.return;return a.tag===3?(T=a.stateNode,w&&c!==null&&(w=31-gn(f),a=T.hiddenUpdates,g=a[w],g===null?a[w]=[c]:g.push(c),c.lane=f|536870912),T):null}function wm(a){if(50<gd)throw gd=0,u1=null,Error(s(185));for(var c=a.return;c!==null;)a=c,c=a.return;return a.tag===3?a.stateNode:null}var Yu={};function wP(a,c,f,g){this.tag=a,this.key=f,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.refCleanup=this.ref=null,this.pendingProps=c,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=g,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function pr(a,c,f,g){return new wP(a,c,f,g)}function rb(a){return a=a.prototype,!(!a||!a.isReactComponent)}function xo(a,c){var f=a.alternate;return f===null?(f=pr(a.tag,c,a.key,a.mode),f.elementType=a.elementType,f.type=a.type,f.stateNode=a.stateNode,f.alternate=a,a.alternate=f):(f.pendingProps=c,f.type=a.type,f.flags=0,f.subtreeFlags=0,f.deletions=null),f.flags=a.flags&65011712,f.childLanes=a.childLanes,f.lanes=a.lanes,f.child=a.child,f.memoizedProps=a.memoizedProps,f.memoizedState=a.memoizedState,f.updateQueue=a.updateQueue,c=a.dependencies,f.dependencies=c===null?null:{lanes:c.lanes,firstContext:c.firstContext},f.sibling=a.sibling,f.index=a.index,f.ref=a.ref,f.refCleanup=a.refCleanup,f}function gE(a,c){a.flags&=65011714;var f=a.alternate;return f===null?(a.childLanes=0,a.lanes=c,a.child=null,a.subtreeFlags=0,a.memoizedProps=null,a.memoizedState=null,a.updateQueue=null,a.dependencies=null,a.stateNode=null):(a.childLanes=f.childLanes,a.lanes=f.lanes,a.child=f.child,a.subtreeFlags=0,a.deletions=null,a.memoizedProps=f.memoizedProps,a.memoizedState=f.memoizedState,a.updateQueue=f.updateQueue,a.type=f.type,c=f.dependencies,a.dependencies=c===null?null:{lanes:c.lanes,firstContext:c.firstContext}),a}function Cm(a,c,f,g,w,T){var F=0;if(g=a,typeof a=="function")rb(a)&&(F=1);else if(typeof a=="string")F=S4(a,f,xt.current)?26:a==="html"||a==="head"||a==="body"?27:5;else t:switch(a){case R:return a=pr(31,f,c,w),a.elementType=R,a.lanes=T,a;case x:return El(f.children,w,T,c);case v:F=8,w|=24;break;case C:return a=pr(12,f,c,w|2),a.elementType=C,a.lanes=T,a;case O:return a=pr(13,f,c,w),a.elementType=O,a.lanes=T,a;case P:return a=pr(19,f,c,w),a.elementType=P,a.lanes=T,a;default:if(typeof a=="object"&&a!==null)switch(a.$$typeof){case S:case _:F=10;break t;case E:F=9;break t;case I:F=11;break t;case D:F=14;break t;case N:F=16,g=null;break t}F=29,f=Error(s(130,a===null?"null":typeof a,"")),g=null}return c=pr(F,f,c,w),c.elementType=a,c.type=g,c.lanes=T,c}function El(a,c,f,g){return a=pr(7,a,g,c),a.lanes=f,a}function ib(a,c,f){return a=pr(6,a,null,c),a.lanes=f,a}function ob(a,c,f){return c=pr(4,a.children!==null?a.children:[],a.key,c),c.lanes=f,c.stateNode={containerInfo:a.containerInfo,pendingChildren:null,implementation:a.implementation},c}var Qu=[],Zu=0,Sm=null,Tm=0,Or=[],Mr=0,Il=null,bo=1,vo="";function _l(a,c){Qu[Zu++]=Tm,Qu[Zu++]=Sm,Sm=a,Tm=c}function yE(a,c,f){Or[Mr++]=bo,Or[Mr++]=vo,Or[Mr++]=Il,Il=a;var g=bo;a=vo;var w=32-gn(g)-1;g&=~(1<<w),f+=1;var T=32-gn(c)+w;if(30<T){var F=w-w%5;T=(g&(1<<F)-1).toString(32),g>>=F,w-=F,bo=1<<32-gn(c)+w|f<<w|g,vo=T+a}else bo=1<<T|f<<w|g,vo=a}function ab(a){a.return!==null&&(_l(a,1),yE(a,1,0))}function lb(a){for(;a===Sm;)Sm=Qu[--Zu],Qu[Zu]=null,Tm=Qu[--Zu],Qu[Zu]=null;for(;a===Il;)Il=Or[--Mr],Or[Mr]=null,vo=Or[--Mr],Or[Mr]=null,bo=Or[--Mr],Or[Mr]=null}var Hs=null,yn=null,Le=!1,kl=null,_i=!1,ub=Error(s(519));function Al(a){var c=Error(s(418,""));throw Kh($r(c,a)),ub}function xE(a){var c=a.stateNode,f=a.type,g=a.memoizedProps;switch(c[Gn]=a,c[Rn]=g,f){case"dialog":ye("cancel",c),ye("close",c);break;case"iframe":case"object":case"embed":ye("load",c);break;case"video":case"audio":for(f=0;f<xd.length;f++)ye(xd[f],c);break;case"source":ye("error",c);break;case"img":case"image":case"link":ye("error",c),ye("load",c);break;case"details":ye("toggle",c);break;case"input":ye("invalid",c),fl(c,g.value,g.defaultValue,g.checked,g.defaultChecked,g.type,g.name,!0),Fu(c);break;case"select":ye("invalid",c);break;case"textarea":ye("invalid",c),pl(c,g.value,g.defaultValue,g.children),Fu(c)}f=g.children,typeof f!="string"&&typeof f!="number"&&typeof f!="bigint"||c.textContent===""+f||g.suppressHydrationWarning===!0||M2(c.textContent,f)?(g.popover!=null&&(ye("beforetoggle",c),ye("toggle",c)),g.onScroll!=null&&ye("scroll",c),g.onScrollEnd!=null&&ye("scrollend",c),g.onClick!=null&&(c.onclick=rg),c=!0):c=!1,c||Al(a)}function bE(a){for(Hs=a.return;Hs;)switch(Hs.tag){case 5:case 13:_i=!1;return;case 27:case 3:_i=!0;return;default:Hs=Hs.return}}function qh(a){if(a!==Hs)return!1;if(!Le)return bE(a),Le=!0,!1;var c=a.tag,f;if((f=c!==3&&c!==27)&&((f=c===5)&&(f=a.type,f=!(f!=="form"&&f!=="button")||E1(a.type,a.memoizedProps)),f=!f),f&&yn&&Al(a),bE(a),c===13){if(a=a.memoizedState,a=a!==null?a.dehydrated:null,!a)throw Error(s(317));t:{for(a=a.nextSibling,c=0;a;){if(a.nodeType===8)if(f=a.data,f==="/$"){if(c===0){yn=ei(a.nextSibling);break t}c--}else f!=="$"&&f!=="$!"&&f!=="$?"||c++;a=a.nextSibling}yn=null}}else c===27?(c=yn,xa(a.type)?(a=A1,A1=null,yn=a):yn=c):yn=Hs?ei(a.stateNode.nextSibling):null;return!0}function jh(){yn=Hs=null,Le=!1}function vE(){var a=kl;return a!==null&&(sr===null?sr=a:sr.push.apply(sr,a),kl=null),a}function Kh(a){kl===null?kl=[a]:kl.push(a)}var cb=j(null),Nl=null,wo=null;function sa(a,c,f){tt(cb,c._currentValue),c._currentValue=f}function Co(a){a._currentValue=cb.current,st(cb)}function hb(a,c,f){for(;a!==null;){var g=a.alternate;if((a.childLanes&c)!==c?(a.childLanes|=c,g!==null&&(g.childLanes|=c)):g!==null&&(g.childLanes&c)!==c&&(g.childLanes|=c),a===f)break;a=a.return}}function db(a,c,f,g){var w=a.child;for(w!==null&&(w.return=a);w!==null;){var T=w.dependencies;if(T!==null){var F=w.child;T=T.firstContext;t:for(;T!==null;){var z=T;T=w;for(var q=0;q<c.length;q++)if(z.context===c[q]){T.lanes|=f,z=T.alternate,z!==null&&(z.lanes|=f),hb(T.return,f,a),g||(F=null);break t}T=z.next}}else if(w.tag===18){if(F=w.return,F===null)throw Error(s(341));F.lanes|=f,T=F.alternate,T!==null&&(T.lanes|=f),hb(F,f,a),F=null}else F=w.child;if(F!==null)F.return=w;else for(F=w;F!==null;){if(F===a){F=null;break}if(w=F.sibling,w!==null){w.return=F.return,F=w;break}F=F.return}w=F}}function Xh(a,c,f,g){a=null;for(var w=c,T=!1;w!==null;){if(!T){if((w.flags&524288)!==0)T=!0;else if((w.flags&262144)!==0)break}if(w.tag===10){var F=w.alternate;if(F===null)throw Error(s(387));if(F=F.memoizedProps,F!==null){var z=w.type;fr(w.pendingProps.value,F.value)||(a!==null?a.push(z):a=[z])}}else if(w===$t.current){if(F=w.alternate,F===null)throw Error(s(387));F.memoizedState.memoizedState!==w.memoizedState.memoizedState&&(a!==null?a.push(Td):a=[Td])}w=w.return}a!==null&&db(c,a,f,g),c.flags|=262144}function Em(a){for(a=a.firstContext;a!==null;){if(!fr(a.context._currentValue,a.memoizedValue))return!0;a=a.next}return!1}function Rl(a){Nl=a,wo=null,a=a.dependencies,a!==null&&(a.firstContext=null)}function Ns(a){return wE(Nl,a)}function Im(a,c){return Nl===null&&Rl(a),wE(a,c)}function wE(a,c){var f=c._currentValue;if(c={context:c,memoizedValue:f,next:null},wo===null){if(a===null)throw Error(s(308));wo=c,a.dependencies={lanes:0,firstContext:c},a.flags|=524288}else wo=wo.next=c;return f}var CP=typeof AbortController<"u"?AbortController:function(){var a=[],c=this.signal={aborted:!1,addEventListener:function(f,g){a.push(g)}};this.abort=function(){c.aborted=!0,a.forEach(function(f){return f()})}},SP=n.unstable_scheduleCallback,TP=n.unstable_NormalPriority,qn={$$typeof:_,Consumer:null,Provider:null,_currentValue:null,_currentValue2:null,_threadCount:0};function fb(){return{controller:new CP,data:new Map,refCount:0}}function Yh(a){a.refCount--,a.refCount===0&&SP(TP,function(){a.controller.abort()})}var Qh=null,pb=0,Ju=0,tc=null;function EP(a,c){if(Qh===null){var f=Qh=[];pb=0,Ju=g1(),tc={status:"pending",value:void 0,then:function(g){f.push(g)}}}return pb++,c.then(CE,CE),c}function CE(){if(--pb===0&&Qh!==null){tc!==null&&(tc.status="fulfilled");var a=Qh;Qh=null,Ju=0,tc=null;for(var c=0;c<a.length;c++)(0,a[c])()}}function IP(a,c){var f=[],g={status:"pending",value:null,reason:null,then:function(w){f.push(w)}};return a.then(function(){g.status="fulfilled",g.value=c;for(var w=0;w<f.length;w++)(0,f[w])(c)},function(w){for(g.status="rejected",g.reason=w,w=0;w<f.length;w++)(0,f[w])(void 0)}),g}var SE=W.S;W.S=function(a,c){typeof c=="object"&&c!==null&&typeof c.then=="function"&&EP(a,c),SE!==null&&SE(a,c)};var $l=j(null);function mb(){var a=$l.current;return a!==null?a:en.pooledCache}function _m(a,c){c===null?tt($l,$l.current):tt($l,c.pool)}function TE(){var a=mb();return a===null?null:{parent:qn._currentValue,pool:a}}var Zh=Error(s(460)),EE=Error(s(474)),km=Error(s(542)),gb={then:function(){}};function IE(a){return a=a.status,a==="fulfilled"||a==="rejected"}function Am(){}function _E(a,c,f){switch(f=a[f],f===void 0?a.push(c):f!==c&&(c.then(Am,Am),c=f),c.status){case"fulfilled":return c.value;case"rejected":throw a=c.reason,AE(a),a;default:if(typeof c.status=="string")c.then(Am,Am);else{if(a=en,a!==null&&100<a.shellSuspendCounter)throw Error(s(482));a=c,a.status="pending",a.then(function(g){if(c.status==="pending"){var w=c;w.status="fulfilled",w.value=g}},function(g){if(c.status==="pending"){var w=c;w.status="rejected",w.reason=g}})}switch(c.status){case"fulfilled":return c.value;case"rejected":throw a=c.reason,AE(a),a}throw Jh=c,Zh}}var Jh=null;function kE(){if(Jh===null)throw Error(s(459));var a=Jh;return Jh=null,a}function AE(a){if(a===Zh||a===km)throw Error(s(483))}var ra=!1;function yb(a){a.updateQueue={baseState:a.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,lanes:0,hiddenCallbacks:null},callbacks:null}}function xb(a,c){a=a.updateQueue,c.updateQueue===a&&(c.updateQueue={baseState:a.baseState,firstBaseUpdate:a.firstBaseUpdate,lastBaseUpdate:a.lastBaseUpdate,shared:a.shared,callbacks:null})}function ia(a){return{lane:a,tag:0,payload:null,callback:null,next:null}}function oa(a,c,f){var g=a.updateQueue;if(g===null)return null;if(g=g.shared,(Ge&2)!==0){var w=g.pending;return w===null?c.next=c:(c.next=w.next,w.next=c),g.pending=c,c=wm(a),mE(a,null,f),c}return vm(a,g,c,f),wm(a)}function td(a,c,f){if(c=c.updateQueue,c!==null&&(c=c.shared,(f&4194048)!==0)){var g=c.lanes;g&=a.pendingLanes,f|=g,c.lanes=f,kh(a,f)}}function bb(a,c){var f=a.updateQueue,g=a.alternate;if(g!==null&&(g=g.updateQueue,f===g)){var w=null,T=null;if(f=f.firstBaseUpdate,f!==null){do{var F={lane:f.lane,tag:f.tag,payload:f.payload,callback:null,next:null};T===null?w=T=F:T=T.next=F,f=f.next}while(f!==null);T===null?w=T=c:T=T.next=c}else w=T=c;f={baseState:g.baseState,firstBaseUpdate:w,lastBaseUpdate:T,shared:g.shared,callbacks:g.callbacks},a.updateQueue=f;return}a=f.lastBaseUpdate,a===null?f.firstBaseUpdate=c:a.next=c,f.lastBaseUpdate=c}var vb=!1;function ed(){if(vb){var a=tc;if(a!==null)throw a}}function nd(a,c,f,g){vb=!1;var w=a.updateQueue;ra=!1;var T=w.firstBaseUpdate,F=w.lastBaseUpdate,z=w.shared.pending;if(z!==null){w.shared.pending=null;var q=z,ht=q.next;q.next=null,F===null?T=ht:F.next=ht,F=q;var wt=a.alternate;wt!==null&&(wt=wt.updateQueue,z=wt.lastBaseUpdate,z!==F&&(z===null?wt.firstBaseUpdate=ht:z.next=ht,wt.lastBaseUpdate=q))}if(T!==null){var Tt=w.baseState;F=0,wt=ht=q=null,z=T;do{var ft=z.lane&-536870913,pt=ft!==z.lane;if(pt?(Ie&ft)===ft:(g&ft)===ft){ft!==0&&ft===Ju&&(vb=!0),wt!==null&&(wt=wt.next={lane:0,tag:z.tag,payload:z.payload,callback:null,next:null});t:{var te=a,Xt=z;ft=c;var Xe=f;switch(Xt.tag){case 1:if(te=Xt.payload,typeof te=="function"){Tt=te.call(Xe,Tt,ft);break t}Tt=te;break t;case 3:te.flags=te.flags&-65537|128;case 0:if(te=Xt.payload,ft=typeof te=="function"?te.call(Xe,Tt,ft):te,ft==null)break t;Tt=d({},Tt,ft);break t;case 2:ra=!0}}ft=z.callback,ft!==null&&(a.flags|=64,pt&&(a.flags|=8192),pt=w.callbacks,pt===null?w.callbacks=[ft]:pt.push(ft))}else pt={lane:ft,tag:z.tag,payload:z.payload,callback:z.callback,next:null},wt===null?(ht=wt=pt,q=Tt):wt=wt.next=pt,F|=ft;if(z=z.next,z===null){if(z=w.shared.pending,z===null)break;pt=z,z=pt.next,pt.next=null,w.lastBaseUpdate=pt,w.shared.pending=null}}while(!0);wt===null&&(q=Tt),w.baseState=q,w.firstBaseUpdate=ht,w.lastBaseUpdate=wt,T===null&&(w.shared.lanes=0),pa|=F,a.lanes=F,a.memoizedState=Tt}}function NE(a,c){if(typeof a!="function")throw Error(s(191,a));a.call(c)}function RE(a,c){var f=a.callbacks;if(f!==null)for(a.callbacks=null,a=0;a<f.length;a++)NE(f[a],c)}var ec=j(null),Nm=j(0);function $E(a,c){a=Ao,tt(Nm,a),tt(ec,c),Ao=a|c.baseLanes}function wb(){tt(Nm,Ao),tt(ec,ec.current)}function Cb(){Ao=Nm.current,st(ec),st(Nm)}var aa=0,ce=null,je=null,Dn=null,Rm=!1,nc=!1,Dl=!1,$m=0,sd=0,sc=null,_P=0;function In(){throw Error(s(321))}function Sb(a,c){if(c===null)return!1;for(var f=0;f<c.length&&f<a.length;f++)if(!fr(a[f],c[f]))return!1;return!0}function Tb(a,c,f,g,w,T){return aa=T,ce=c,c.memoizedState=null,c.updateQueue=null,c.lanes=0,W.H=a===null||a.memoizedState===null?mI:gI,Dl=!1,T=f(g,w),Dl=!1,nc&&(T=OE(c,f,g,w)),DE(a),T}function DE(a){W.H=Pm;var c=je!==null&&je.next!==null;if(aa=0,Dn=je=ce=null,Rm=!1,sd=0,sc=null,c)throw Error(s(300));a===null||rs||(a=a.dependencies,a!==null&&Em(a)&&(rs=!0))}function OE(a,c,f,g){ce=a;var w=0;do{if(nc&&(sc=null),sd=0,nc=!1,25<=w)throw Error(s(301));if(w+=1,Dn=je=null,a.updateQueue!=null){var T=a.updateQueue;T.lastEffect=null,T.events=null,T.stores=null,T.memoCache!=null&&(T.memoCache.index=0)}W.H=OP,T=c(f,g)}while(nc);return T}function kP(){var a=W.H,c=a.useState()[0];return c=typeof c.then=="function"?rd(c):c,a=a.useState()[0],(je!==null?je.memoizedState:null)!==a&&(ce.flags|=1024),c}function Eb(){var a=$m!==0;return $m=0,a}function Ib(a,c,f){c.updateQueue=a.updateQueue,c.flags&=-2053,a.lanes&=~f}function _b(a){if(Rm){for(a=a.memoizedState;a!==null;){var c=a.queue;c!==null&&(c.pending=null),a=a.next}Rm=!1}aa=0,Dn=je=ce=null,nc=!1,sd=$m=0,sc=null}function er(){var a={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return Dn===null?ce.memoizedState=Dn=a:Dn=Dn.next=a,Dn}function On(){if(je===null){var a=ce.alternate;a=a!==null?a.memoizedState:null}else a=je.next;var c=Dn===null?ce.memoizedState:Dn.next;if(c!==null)Dn=c,je=a;else{if(a===null)throw ce.alternate===null?Error(s(467)):Error(s(310));je=a,a={memoizedState:je.memoizedState,baseState:je.baseState,baseQueue:je.baseQueue,queue:je.queue,next:null},Dn===null?ce.memoizedState=Dn=a:Dn=Dn.next=a}return Dn}function kb(){return{lastEffect:null,events:null,stores:null,memoCache:null}}function rd(a){var c=sd;return sd+=1,sc===null&&(sc=[]),a=_E(sc,a,c),c=ce,(Dn===null?c.memoizedState:Dn.next)===null&&(c=c.alternate,W.H=c===null||c.memoizedState===null?mI:gI),a}function Dm(a){if(a!==null&&typeof a=="object"){if(typeof a.then=="function")return rd(a);if(a.$$typeof===_)return Ns(a)}throw Error(s(438,String(a)))}function Ab(a){var c=null,f=ce.updateQueue;if(f!==null&&(c=f.memoCache),c==null){var g=ce.alternate;g!==null&&(g=g.updateQueue,g!==null&&(g=g.memoCache,g!=null&&(c={data:g.data.map(function(w){return w.slice()}),index:0})))}if(c==null&&(c={data:[],index:0}),f===null&&(f=kb(),ce.updateQueue=f),f.memoCache=c,f=c.data[c.index],f===void 0)for(f=c.data[c.index]=Array(a),g=0;g<a;g++)f[g]=$;return c.index++,f}function So(a,c){return typeof c=="function"?c(a):c}function Om(a){var c=On();return Nb(c,je,a)}function Nb(a,c,f){var g=a.queue;if(g===null)throw Error(s(311));g.lastRenderedReducer=f;var w=a.baseQueue,T=g.pending;if(T!==null){if(w!==null){var F=w.next;w.next=T.next,T.next=F}c.baseQueue=w=T,g.pending=null}if(T=a.baseState,w===null)a.memoizedState=T;else{c=w.next;var z=F=null,q=null,ht=c,wt=!1;do{var Tt=ht.lane&-536870913;if(Tt!==ht.lane?(Ie&Tt)===Tt:(aa&Tt)===Tt){var ft=ht.revertLane;if(ft===0)q!==null&&(q=q.next={lane:0,revertLane:0,action:ht.action,hasEagerState:ht.hasEagerState,eagerState:ht.eagerState,next:null}),Tt===Ju&&(wt=!0);else if((aa&ft)===ft){ht=ht.next,ft===Ju&&(wt=!0);continue}else Tt={lane:0,revertLane:ht.revertLane,action:ht.action,hasEagerState:ht.hasEagerState,eagerState:ht.eagerState,next:null},q===null?(z=q=Tt,F=T):q=q.next=Tt,ce.lanes|=ft,pa|=ft;Tt=ht.action,Dl&&f(T,Tt),T=ht.hasEagerState?ht.eagerState:f(T,Tt)}else ft={lane:Tt,revertLane:ht.revertLane,action:ht.action,hasEagerState:ht.hasEagerState,eagerState:ht.eagerState,next:null},q===null?(z=q=ft,F=T):q=q.next=ft,ce.lanes|=Tt,pa|=Tt;ht=ht.next}while(ht!==null&&ht!==c);if(q===null?F=T:q.next=z,!fr(T,a.memoizedState)&&(rs=!0,wt&&(f=tc,f!==null)))throw f;a.memoizedState=T,a.baseState=F,a.baseQueue=q,g.lastRenderedState=T}return w===null&&(g.lanes=0),[a.memoizedState,g.dispatch]}function Rb(a){var c=On(),f=c.queue;if(f===null)throw Error(s(311));f.lastRenderedReducer=a;var g=f.dispatch,w=f.pending,T=c.memoizedState;if(w!==null){f.pending=null;var F=w=w.next;do T=a(T,F.action),F=F.next;while(F!==w);fr(T,c.memoizedState)||(rs=!0),c.memoizedState=T,c.baseQueue===null&&(c.baseState=T),f.lastRenderedState=T}return[T,g]}function ME(a,c,f){var g=ce,w=On(),T=Le;if(T){if(f===void 0)throw Error(s(407));f=f()}else f=c();var F=!fr((je||w).memoizedState,f);F&&(w.memoizedState=f,rs=!0),w=w.queue;var z=PE.bind(null,g,w,a);if(id(2048,8,z,[a]),w.getSnapshot!==c||F||Dn!==null&&Dn.memoizedState.tag&1){if(g.flags|=2048,rc(9,Mm(),LE.bind(null,g,w,f,c),null),en===null)throw Error(s(349));T||(aa&124)!==0||FE(g,c,f)}return f}function FE(a,c,f){a.flags|=16384,a={getSnapshot:c,value:f},c=ce.updateQueue,c===null?(c=kb(),ce.updateQueue=c,c.stores=[a]):(f=c.stores,f===null?c.stores=[a]:f.push(a))}function LE(a,c,f,g){c.value=f,c.getSnapshot=g,VE(c)&&zE(a)}function PE(a,c,f){return f(function(){VE(c)&&zE(a)})}function VE(a){var c=a.getSnapshot;a=a.value;try{var f=c();return!fr(a,f)}catch{return!0}}function zE(a){var c=Xu(a,2);c!==null&&br(c,a,2)}function $b(a){var c=er();if(typeof a=="function"){var f=a;if(a=f(),Dl){mn(!0);try{f()}finally{mn(!1)}}}return c.memoizedState=c.baseState=a,c.queue={pending:null,lanes:0,dispatch:null,lastRenderedReducer:So,lastRenderedState:a},c}function BE(a,c,f,g){return a.baseState=f,Nb(a,je,typeof g=="function"?g:So)}function AP(a,c,f,g,w){if(Lm(a))throw Error(s(485));if(a=c.action,a!==null){var T={payload:w,action:a,next:null,isTransition:!0,status:"pending",value:null,reason:null,listeners:[],then:function(F){T.listeners.push(F)}};W.T!==null?f(!0):T.isTransition=!1,g(T),f=c.pending,f===null?(T.next=c.pending=T,UE(c,T)):(T.next=f.next,c.pending=f.next=T)}}function UE(a,c){var f=c.action,g=c.payload,w=a.state;if(c.isTransition){var T=W.T,F={};W.T=F;try{var z=f(w,g),q=W.S;q!==null&&q(F,z),GE(a,c,z)}catch(ht){Db(a,c,ht)}finally{W.T=T}}else try{T=f(w,g),GE(a,c,T)}catch(ht){Db(a,c,ht)}}function GE(a,c,f){f!==null&&typeof f=="object"&&typeof f.then=="function"?f.then(function(g){WE(a,c,g)},function(g){return Db(a,c,g)}):WE(a,c,f)}function WE(a,c,f){c.status="fulfilled",c.value=f,HE(c),a.state=f,c=a.pending,c!==null&&(f=c.next,f===c?a.pending=null:(f=f.next,c.next=f,UE(a,f)))}function Db(a,c,f){var g=a.pending;if(a.pending=null,g!==null){g=g.next;do c.status="rejected",c.reason=f,HE(c),c=c.next;while(c!==g)}a.action=null}function HE(a){a=a.listeners;for(var c=0;c<a.length;c++)(0,a[c])()}function qE(a,c){return c}function jE(a,c){if(Le){var f=en.formState;if(f!==null){t:{var g=ce;if(Le){if(yn){e:{for(var w=yn,T=_i;w.nodeType!==8;){if(!T){w=null;break e}if(w=ei(w.nextSibling),w===null){w=null;break e}}T=w.data,w=T==="F!"||T==="F"?w:null}if(w){yn=ei(w.nextSibling),g=w.data==="F!";break t}}Al(g)}g=!1}g&&(c=f[0])}}return f=er(),f.memoizedState=f.baseState=c,g={pending:null,lanes:0,dispatch:null,lastRenderedReducer:qE,lastRenderedState:c},f.queue=g,f=dI.bind(null,ce,g),g.dispatch=f,g=$b(!1),T=Pb.bind(null,ce,!1,g.queue),g=er(),w={state:c,dispatch:null,action:a,pending:null},g.queue=w,f=AP.bind(null,ce,w,T,f),w.dispatch=f,g.memoizedState=a,[c,f,!1]}function KE(a){var c=On();return XE(c,je,a)}function XE(a,c,f){if(c=Nb(a,c,qE)[0],a=Om(So)[0],typeof c=="object"&&c!==null&&typeof c.then=="function")try{var g=rd(c)}catch(F){throw F===Zh?km:F}else g=c;c=On();var w=c.queue,T=w.dispatch;return f!==c.memoizedState&&(ce.flags|=2048,rc(9,Mm(),NP.bind(null,w,f),null)),[g,T,a]}function NP(a,c){a.action=c}function YE(a){var c=On(),f=je;if(f!==null)return XE(c,f,a);On(),c=c.memoizedState,f=On();var g=f.queue.dispatch;return f.memoizedState=a,[c,g,!1]}function rc(a,c,f,g){return a={tag:a,create:f,deps:g,inst:c,next:null},c=ce.updateQueue,c===null&&(c=kb(),ce.updateQueue=c),f=c.lastEffect,f===null?c.lastEffect=a.next=a:(g=f.next,f.next=a,a.next=g,c.lastEffect=a),a}function Mm(){return{destroy:void 0,resource:void 0}}function QE(){return On().memoizedState}function Fm(a,c,f,g){var w=er();g=g===void 0?null:g,ce.flags|=a,w.memoizedState=rc(1|c,Mm(),f,g)}function id(a,c,f,g){var w=On();g=g===void 0?null:g;var T=w.memoizedState.inst;je!==null&&g!==null&&Sb(g,je.memoizedState.deps)?w.memoizedState=rc(c,T,f,g):(ce.flags|=a,w.memoizedState=rc(1|c,T,f,g))}function ZE(a,c){Fm(8390656,8,a,c)}function JE(a,c){id(2048,8,a,c)}function tI(a,c){return id(4,2,a,c)}function eI(a,c){return id(4,4,a,c)}function nI(a,c){if(typeof c=="function"){a=a();var f=c(a);return function(){typeof f=="function"?f():c(null)}}if(c!=null)return a=a(),c.current=a,function(){c.current=null}}function sI(a,c,f){f=f!=null?f.concat([a]):null,id(4,4,nI.bind(null,c,a),f)}function Ob(){}function rI(a,c){var f=On();c=c===void 0?null:c;var g=f.memoizedState;return c!==null&&Sb(c,g[1])?g[0]:(f.memoizedState=[a,c],a)}function iI(a,c){var f=On();c=c===void 0?null:c;var g=f.memoizedState;if(c!==null&&Sb(c,g[1]))return g[0];if(g=a(),Dl){mn(!0);try{a()}finally{mn(!1)}}return f.memoizedState=[g,c],g}function Mb(a,c,f){return f===void 0||(aa&1073741824)!==0?a.memoizedState=c:(a.memoizedState=f,a=l2(),ce.lanes|=a,pa|=a,f)}function oI(a,c,f,g){return fr(f,c)?f:ec.current!==null?(a=Mb(a,f,g),fr(a,c)||(rs=!0),a):(aa&42)===0?(rs=!0,a.memoizedState=f):(a=l2(),ce.lanes|=a,pa|=a,c)}function aI(a,c,f,g,w){var T=K.p;K.p=T!==0&&8>T?T:8;var F=W.T,z={};W.T=z,Pb(a,!1,c,f);try{var q=w(),ht=W.S;if(ht!==null&&ht(z,q),q!==null&&typeof q=="object"&&typeof q.then=="function"){var wt=IP(q,g);od(a,c,wt,xr(a))}else od(a,c,g,xr(a))}catch(Tt){od(a,c,{then:function(){},status:"rejected",reason:Tt},xr())}finally{K.p=T,W.T=F}}function RP(){}function Fb(a,c,f,g){if(a.tag!==5)throw Error(s(476));var w=lI(a).queue;aI(a,w,c,Y,f===null?RP:function(){return uI(a),f(g)})}function lI(a){var c=a.memoizedState;if(c!==null)return c;c={memoizedState:Y,baseState:Y,baseQueue:null,queue:{pending:null,lanes:0,dispatch:null,lastRenderedReducer:So,lastRenderedState:Y},next:null};var f={};return c.next={memoizedState:f,baseState:f,baseQueue:null,queue:{pending:null,lanes:0,dispatch:null,lastRenderedReducer:So,lastRenderedState:f},next:null},a.memoizedState=c,a=a.alternate,a!==null&&(a.memoizedState=c),c}function uI(a){var c=lI(a).next.queue;od(a,c,{},xr())}function Lb(){return Ns(Td)}function cI(){return On().memoizedState}function hI(){return On().memoizedState}function $P(a){for(var c=a.return;c!==null;){switch(c.tag){case 24:case 3:var f=xr();a=ia(f);var g=oa(c,a,f);g!==null&&(br(g,c,f),td(g,c,f)),c={cache:fb()},a.payload=c;return}c=c.return}}function DP(a,c,f){var g=xr();f={lane:g,revertLane:0,action:f,hasEagerState:!1,eagerState:null,next:null},Lm(a)?fI(c,f):(f=sb(a,c,f,g),f!==null&&(br(f,a,g),pI(f,c,g)))}function dI(a,c,f){var g=xr();od(a,c,f,g)}function od(a,c,f,g){var w={lane:g,revertLane:0,action:f,hasEagerState:!1,eagerState:null,next:null};if(Lm(a))fI(c,w);else{var T=a.alternate;if(a.lanes===0&&(T===null||T.lanes===0)&&(T=c.lastRenderedReducer,T!==null))try{var F=c.lastRenderedState,z=T(F,f);if(w.hasEagerState=!0,w.eagerState=z,fr(z,F))return vm(a,c,w,0),en===null&&bm(),!1}catch{}finally{}if(f=sb(a,c,w,g),f!==null)return br(f,a,g),pI(f,c,g),!0}return!1}function Pb(a,c,f,g){if(g={lane:2,revertLane:g1(),action:g,hasEagerState:!1,eagerState:null,next:null},Lm(a)){if(c)throw Error(s(479))}else c=sb(a,f,g,2),c!==null&&br(c,a,2)}function Lm(a){var c=a.alternate;return a===ce||c!==null&&c===ce}function fI(a,c){nc=Rm=!0;var f=a.pending;f===null?c.next=c:(c.next=f.next,f.next=c),a.pending=c}function pI(a,c,f){if((f&4194048)!==0){var g=c.lanes;g&=a.pendingLanes,f|=g,c.lanes=f,kh(a,f)}}var Pm={readContext:Ns,use:Dm,useCallback:In,useContext:In,useEffect:In,useImperativeHandle:In,useLayoutEffect:In,useInsertionEffect:In,useMemo:In,useReducer:In,useRef:In,useState:In,useDebugValue:In,useDeferredValue:In,useTransition:In,useSyncExternalStore:In,useId:In,useHostTransitionStatus:In,useFormState:In,useActionState:In,useOptimistic:In,useMemoCache:In,useCacheRefresh:In},mI={readContext:Ns,use:Dm,useCallback:function(a,c){return er().memoizedState=[a,c===void 0?null:c],a},useContext:Ns,useEffect:ZE,useImperativeHandle:function(a,c,f){f=f!=null?f.concat([a]):null,Fm(4194308,4,nI.bind(null,c,a),f)},useLayoutEffect:function(a,c){return Fm(4194308,4,a,c)},useInsertionEffect:function(a,c){Fm(4,2,a,c)},useMemo:function(a,c){var f=er();c=c===void 0?null:c;var g=a();if(Dl){mn(!0);try{a()}finally{mn(!1)}}return f.memoizedState=[g,c],g},useReducer:function(a,c,f){var g=er();if(f!==void 0){var w=f(c);if(Dl){mn(!0);try{f(c)}finally{mn(!1)}}}else w=c;return g.memoizedState=g.baseState=w,a={pending:null,lanes:0,dispatch:null,lastRenderedReducer:a,lastRenderedState:w},g.queue=a,a=a.dispatch=DP.bind(null,ce,a),[g.memoizedState,a]},useRef:function(a){var c=er();return a={current:a},c.memoizedState=a},useState:function(a){a=$b(a);var c=a.queue,f=dI.bind(null,ce,c);return c.dispatch=f,[a.memoizedState,f]},useDebugValue:Ob,useDeferredValue:function(a,c){var f=er();return Mb(f,a,c)},useTransition:function(){var a=$b(!1);return a=aI.bind(null,ce,a.queue,!0,!1),er().memoizedState=a,[!1,a]},useSyncExternalStore:function(a,c,f){var g=ce,w=er();if(Le){if(f===void 0)throw Error(s(407));f=f()}else{if(f=c(),en===null)throw Error(s(349));(Ie&124)!==0||FE(g,c,f)}w.memoizedState=f;var T={value:f,getSnapshot:c};return w.queue=T,ZE(PE.bind(null,g,T,a),[a]),g.flags|=2048,rc(9,Mm(),LE.bind(null,g,T,f,c),null),f},useId:function(){var a=er(),c=en.identifierPrefix;if(Le){var f=vo,g=bo;f=(g&~(1<<32-gn(g)-1)).toString(32)+f,c="«"+c+"R"+f,f=$m++,0<f&&(c+="H"+f.toString(32)),c+="»"}else f=_P++,c="«"+c+"r"+f.toString(32)+"»";return a.memoizedState=c},useHostTransitionStatus:Lb,useFormState:jE,useActionState:jE,useOptimistic:function(a){var c=er();c.memoizedState=c.baseState=a;var f={pending:null,lanes:0,dispatch:null,lastRenderedReducer:null,lastRenderedState:null};return c.queue=f,c=Pb.bind(null,ce,!0,f),f.dispatch=c,[a,c]},useMemoCache:Ab,useCacheRefresh:function(){return er().memoizedState=$P.bind(null,ce)}},gI={readContext:Ns,use:Dm,useCallback:rI,useContext:Ns,useEffect:JE,useImperativeHandle:sI,useInsertionEffect:tI,useLayoutEffect:eI,useMemo:iI,useReducer:Om,useRef:QE,useState:function(){return Om(So)},useDebugValue:Ob,useDeferredValue:function(a,c){var f=On();return oI(f,je.memoizedState,a,c)},useTransition:function(){var a=Om(So)[0],c=On().memoizedState;return[typeof a=="boolean"?a:rd(a),c]},useSyncExternalStore:ME,useId:cI,useHostTransitionStatus:Lb,useFormState:KE,useActionState:KE,useOptimistic:function(a,c){var f=On();return BE(f,je,a,c)},useMemoCache:Ab,useCacheRefresh:hI},OP={readContext:Ns,use:Dm,useCallback:rI,useContext:Ns,useEffect:JE,useImperativeHandle:sI,useInsertionEffect:tI,useLayoutEffect:eI,useMemo:iI,useReducer:Rb,useRef:QE,useState:function(){return Rb(So)},useDebugValue:Ob,useDeferredValue:function(a,c){var f=On();return je===null?Mb(f,a,c):oI(f,je.memoizedState,a,c)},useTransition:function(){var a=Rb(So)[0],c=On().memoizedState;return[typeof a=="boolean"?a:rd(a),c]},useSyncExternalStore:ME,useId:cI,useHostTransitionStatus:Lb,useFormState:YE,useActionState:YE,useOptimistic:function(a,c){var f=On();return je!==null?BE(f,je,a,c):(f.baseState=a,[a,f.queue.dispatch])},useMemoCache:Ab,useCacheRefresh:hI},ic=null,ad=0;function Vm(a){var c=ad;return ad+=1,ic===null&&(ic=[]),_E(ic,a,c)}function ld(a,c){c=c.props.ref,a.ref=c!==void 0?c:null}function zm(a,c){throw c.$$typeof===p?Error(s(525)):(a=Object.prototype.toString.call(c),Error(s(31,a==="[object Object]"?"object with keys {"+Object.keys(c).join(", ")+"}":a)))}function yI(a){var c=a._init;return c(a._payload)}function xI(a){function c(ot,Q){if(a){var ut=ot.deletions;ut===null?(ot.deletions=[Q],ot.flags|=16):ut.push(Q)}}function f(ot,Q){if(!a)return null;for(;Q!==null;)c(ot,Q),Q=Q.sibling;return null}function g(ot){for(var Q=new Map;ot!==null;)ot.key!==null?Q.set(ot.key,ot):Q.set(ot.index,ot),ot=ot.sibling;return Q}function w(ot,Q){return ot=xo(ot,Q),ot.index=0,ot.sibling=null,ot}function T(ot,Q,ut){return ot.index=ut,a?(ut=ot.alternate,ut!==null?(ut=ut.index,ut<Q?(ot.flags|=67108866,Q):ut):(ot.flags|=67108866,Q)):(ot.flags|=1048576,Q)}function F(ot){return a&&ot.alternate===null&&(ot.flags|=67108866),ot}function z(ot,Q,ut,St){return Q===null||Q.tag!==6?(Q=ib(ut,ot.mode,St),Q.return=ot,Q):(Q=w(Q,ut),Q.return=ot,Q)}function q(ot,Q,ut,St){var Pt=ut.type;return Pt===x?wt(ot,Q,ut.props.children,St,ut.key):Q!==null&&(Q.elementType===Pt||typeof Pt=="object"&&Pt!==null&&Pt.$$typeof===N&&yI(Pt)===Q.type)?(Q=w(Q,ut.props),ld(Q,ut),Q.return=ot,Q):(Q=Cm(ut.type,ut.key,ut.props,null,ot.mode,St),ld(Q,ut),Q.return=ot,Q)}function ht(ot,Q,ut,St){return Q===null||Q.tag!==4||Q.stateNode.containerInfo!==ut.containerInfo||Q.stateNode.implementation!==ut.implementation?(Q=ob(ut,ot.mode,St),Q.return=ot,Q):(Q=w(Q,ut.children||[]),Q.return=ot,Q)}function wt(ot,Q,ut,St,Pt){return Q===null||Q.tag!==7?(Q=El(ut,ot.mode,St,Pt),Q.return=ot,Q):(Q=w(Q,ut),Q.return=ot,Q)}function Tt(ot,Q,ut){if(typeof Q=="string"&&Q!==""||typeof Q=="number"||typeof Q=="bigint")return Q=ib(""+Q,ot.mode,ut),Q.return=ot,Q;if(typeof Q=="object"&&Q!==null){switch(Q.$$typeof){case m:return ut=Cm(Q.type,Q.key,Q.props,null,ot.mode,ut),ld(ut,Q),ut.return=ot,ut;case y:return Q=ob(Q,ot.mode,ut),Q.return=ot,Q;case N:var St=Q._init;return Q=St(Q._payload),Tt(ot,Q,ut)}if(Z(Q)||V(Q))return Q=El(Q,ot.mode,ut,null),Q.return=ot,Q;if(typeof Q.then=="function")return Tt(ot,Vm(Q),ut);if(Q.$$typeof===_)return Tt(ot,Im(ot,Q),ut);zm(ot,Q)}return null}function ft(ot,Q,ut,St){var Pt=Q!==null?Q.key:null;if(typeof ut=="string"&&ut!==""||typeof ut=="number"||typeof ut=="bigint")return Pt!==null?null:z(ot,Q,""+ut,St);if(typeof ut=="object"&&ut!==null){switch(ut.$$typeof){case m:return ut.key===Pt?q(ot,Q,ut,St):null;case y:return ut.key===Pt?ht(ot,Q,ut,St):null;case N:return Pt=ut._init,ut=Pt(ut._payload),ft(ot,Q,ut,St)}if(Z(ut)||V(ut))return Pt!==null?null:wt(ot,Q,ut,St,null);if(typeof ut.then=="function")return ft(ot,Q,Vm(ut),St);if(ut.$$typeof===_)return ft(ot,Q,Im(ot,ut),St);zm(ot,ut)}return null}function pt(ot,Q,ut,St,Pt){if(typeof St=="string"&&St!==""||typeof St=="number"||typeof St=="bigint")return ot=ot.get(ut)||null,z(Q,ot,""+St,Pt);if(typeof St=="object"&&St!==null){switch(St.$$typeof){case m:return ot=ot.get(St.key===null?ut:St.key)||null,q(Q,ot,St,Pt);case y:return ot=ot.get(St.key===null?ut:St.key)||null,ht(Q,ot,St,Pt);case N:var pe=St._init;return St=pe(St._payload),pt(ot,Q,ut,St,Pt)}if(Z(St)||V(St))return ot=ot.get(ut)||null,wt(Q,ot,St,Pt,null);if(typeof St.then=="function")return pt(ot,Q,ut,Vm(St),Pt);if(St.$$typeof===_)return pt(ot,Q,ut,Im(Q,St),Pt);zm(Q,St)}return null}function te(ot,Q,ut,St){for(var Pt=null,pe=null,Bt=Q,Qt=Q=0,os=null;Bt!==null&&Qt<ut.length;Qt++){Bt.index>Qt?(os=Bt,Bt=null):os=Bt.sibling;var Re=ft(ot,Bt,ut[Qt],St);if(Re===null){Bt===null&&(Bt=os);break}a&&Bt&&Re.alternate===null&&c(ot,Bt),Q=T(Re,Q,Qt),pe===null?Pt=Re:pe.sibling=Re,pe=Re,Bt=os}if(Qt===ut.length)return f(ot,Bt),Le&&_l(ot,Qt),Pt;if(Bt===null){for(;Qt<ut.length;Qt++)Bt=Tt(ot,ut[Qt],St),Bt!==null&&(Q=T(Bt,Q,Qt),pe===null?Pt=Bt:pe.sibling=Bt,pe=Bt);return Le&&_l(ot,Qt),Pt}for(Bt=g(Bt);Qt<ut.length;Qt++)os=pt(Bt,ot,Qt,ut[Qt],St),os!==null&&(a&&os.alternate!==null&&Bt.delete(os.key===null?Qt:os.key),Q=T(os,Q,Qt),pe===null?Pt=os:pe.sibling=os,pe=os);return a&&Bt.forEach(function(Sa){return c(ot,Sa)}),Le&&_l(ot,Qt),Pt}function Xt(ot,Q,ut,St){if(ut==null)throw Error(s(151));for(var Pt=null,pe=null,Bt=Q,Qt=Q=0,os=null,Re=ut.next();Bt!==null&&!Re.done;Qt++,Re=ut.next()){Bt.index>Qt?(os=Bt,Bt=null):os=Bt.sibling;var Sa=ft(ot,Bt,Re.value,St);if(Sa===null){Bt===null&&(Bt=os);break}a&&Bt&&Sa.alternate===null&&c(ot,Bt),Q=T(Sa,Q,Qt),pe===null?Pt=Sa:pe.sibling=Sa,pe=Sa,Bt=os}if(Re.done)return f(ot,Bt),Le&&_l(ot,Qt),Pt;if(Bt===null){for(;!Re.done;Qt++,Re=ut.next())Re=Tt(ot,Re.value,St),Re!==null&&(Q=T(Re,Q,Qt),pe===null?Pt=Re:pe.sibling=Re,pe=Re);return Le&&_l(ot,Qt),Pt}for(Bt=g(Bt);!Re.done;Qt++,Re=ut.next())Re=pt(Bt,ot,Qt,Re.value,St),Re!==null&&(a&&Re.alternate!==null&&Bt.delete(Re.key===null?Qt:Re.key),Q=T(Re,Q,Qt),pe===null?Pt=Re:pe.sibling=Re,pe=Re);return a&&Bt.forEach(function(M4){return c(ot,M4)}),Le&&_l(ot,Qt),Pt}function Xe(ot,Q,ut,St){if(typeof ut=="object"&&ut!==null&&ut.type===x&&ut.key===null&&(ut=ut.props.children),typeof ut=="object"&&ut!==null){switch(ut.$$typeof){case m:t:{for(var Pt=ut.key;Q!==null;){if(Q.key===Pt){if(Pt=ut.type,Pt===x){if(Q.tag===7){f(ot,Q.sibling),St=w(Q,ut.props.children),St.return=ot,ot=St;break t}}else if(Q.elementType===Pt||typeof Pt=="object"&&Pt!==null&&Pt.$$typeof===N&&yI(Pt)===Q.type){f(ot,Q.sibling),St=w(Q,ut.props),ld(St,ut),St.return=ot,ot=St;break t}f(ot,Q);break}else c(ot,Q);Q=Q.sibling}ut.type===x?(St=El(ut.props.children,ot.mode,St,ut.key),St.return=ot,ot=St):(St=Cm(ut.type,ut.key,ut.props,null,ot.mode,St),ld(St,ut),St.return=ot,ot=St)}return F(ot);case y:t:{for(Pt=ut.key;Q!==null;){if(Q.key===Pt)if(Q.tag===4&&Q.stateNode.containerInfo===ut.containerInfo&&Q.stateNode.implementation===ut.implementation){f(ot,Q.sibling),St=w(Q,ut.children||[]),St.return=ot,ot=St;break t}else{f(ot,Q);break}else c(ot,Q);Q=Q.sibling}St=ob(ut,ot.mode,St),St.return=ot,ot=St}return F(ot);case N:return Pt=ut._init,ut=Pt(ut._payload),Xe(ot,Q,ut,St)}if(Z(ut))return te(ot,Q,ut,St);if(V(ut)){if(Pt=V(ut),typeof Pt!="function")throw Error(s(150));return ut=Pt.call(ut),Xt(ot,Q,ut,St)}if(typeof ut.then=="function")return Xe(ot,Q,Vm(ut),St);if(ut.$$typeof===_)return Xe(ot,Q,Im(ot,ut),St);zm(ot,ut)}return typeof ut=="string"&&ut!==""||typeof ut=="number"||typeof ut=="bigint"?(ut=""+ut,Q!==null&&Q.tag===6?(f(ot,Q.sibling),St=w(Q,ut),St.return=ot,ot=St):(f(ot,Q),St=ib(ut,ot.mode,St),St.return=ot,ot=St),F(ot)):f(ot,Q)}return function(ot,Q,ut,St){try{ad=0;var Pt=Xe(ot,Q,ut,St);return ic=null,Pt}catch(Bt){if(Bt===Zh||Bt===km)throw Bt;var pe=pr(29,Bt,null,ot.mode);return pe.lanes=St,pe.return=ot,pe}finally{}}}var oc=xI(!0),bI=xI(!1),Fr=j(null),ki=null;function la(a){var c=a.alternate;tt(jn,jn.current&1),tt(Fr,a),ki===null&&(c===null||ec.current!==null||c.memoizedState!==null)&&(ki=a)}function vI(a){if(a.tag===22){if(tt(jn,jn.current),tt(Fr,a),ki===null){var c=a.alternate;c!==null&&c.memoizedState!==null&&(ki=a)}}else ua()}function ua(){tt(jn,jn.current),tt(Fr,Fr.current)}function To(a){st(Fr),ki===a&&(ki=null),st(jn)}var jn=j(0);function Bm(a){for(var c=a;c!==null;){if(c.tag===13){var f=c.memoizedState;if(f!==null&&(f=f.dehydrated,f===null||f.data==="$?"||k1(f)))return c}else if(c.tag===19&&c.memoizedProps.revealOrder!==void 0){if((c.flags&128)!==0)return c}else if(c.child!==null){c.child.return=c,c=c.child;continue}if(c===a)break;for(;c.sibling===null;){if(c.return===null||c.return===a)return null;c=c.return}c.sibling.return=c.return,c=c.sibling}return null}function Vb(a,c,f,g){c=a.memoizedState,f=f(g,c),f=f==null?c:d({},c,f),a.memoizedState=f,a.lanes===0&&(a.updateQueue.baseState=f)}var zb={enqueueSetState:function(a,c,f){a=a._reactInternals;var g=xr(),w=ia(g);w.payload=c,f!=null&&(w.callback=f),c=oa(a,w,g),c!==null&&(br(c,a,g),td(c,a,g))},enqueueReplaceState:function(a,c,f){a=a._reactInternals;var g=xr(),w=ia(g);w.tag=1,w.payload=c,f!=null&&(w.callback=f),c=oa(a,w,g),c!==null&&(br(c,a,g),td(c,a,g))},enqueueForceUpdate:function(a,c){a=a._reactInternals;var f=xr(),g=ia(f);g.tag=2,c!=null&&(g.callback=c),c=oa(a,g,f),c!==null&&(br(c,a,f),td(c,a,f))}};function wI(a,c,f,g,w,T,F){return a=a.stateNode,typeof a.shouldComponentUpdate=="function"?a.shouldComponentUpdate(g,T,F):c.prototype&&c.prototype.isPureReactComponent?!Wh(f,g)||!Wh(w,T):!0}function CI(a,c,f,g){a=c.state,typeof c.componentWillReceiveProps=="function"&&c.componentWillReceiveProps(f,g),typeof c.UNSAFE_componentWillReceiveProps=="function"&&c.UNSAFE_componentWillReceiveProps(f,g),c.state!==a&&zb.enqueueReplaceState(c,c.state,null)}function Ol(a,c){var f=c;if("ref"in c){f={};for(var g in c)g!=="ref"&&(f[g]=c[g])}if(a=a.defaultProps){f===c&&(f=d({},f));for(var w in a)f[w]===void 0&&(f[w]=a[w])}return f}var Um=typeof reportError=="function"?reportError:function(a){if(typeof window=="object"&&typeof window.ErrorEvent=="function"){var c=new window.ErrorEvent("error",{bubbles:!0,cancelable:!0,message:typeof a=="object"&&a!==null&&typeof a.message=="string"?String(a.message):String(a),error:a});if(!window.dispatchEvent(c))return}else if(typeof process=="object"&&typeof process.emit=="function"){process.emit("uncaughtException",a);return}console.error(a)};function SI(a){Um(a)}function TI(a){console.error(a)}function EI(a){Um(a)}function Gm(a,c){try{var f=a.onUncaughtError;f(c.value,{componentStack:c.stack})}catch(g){setTimeout(function(){throw g})}}function II(a,c,f){try{var g=a.onCaughtError;g(f.value,{componentStack:f.stack,errorBoundary:c.tag===1?c.stateNode:null})}catch(w){setTimeout(function(){throw w})}}function Bb(a,c,f){return f=ia(f),f.tag=3,f.payload={element:null},f.callback=function(){Gm(a,c)},f}function _I(a){return a=ia(a),a.tag=3,a}function kI(a,c,f,g){var w=f.type.getDerivedStateFromError;if(typeof w=="function"){var T=g.value;a.payload=function(){return w(T)},a.callback=function(){II(c,f,g)}}var F=f.stateNode;F!==null&&typeof F.componentDidCatch=="function"&&(a.callback=function(){II(c,f,g),typeof w!="function"&&(ma===null?ma=new Set([this]):ma.add(this));var z=g.stack;this.componentDidCatch(g.value,{componentStack:z!==null?z:""})})}function MP(a,c,f,g,w){if(f.flags|=32768,g!==null&&typeof g=="object"&&typeof g.then=="function"){if(c=f.alternate,c!==null&&Xh(c,f,w,!0),f=Fr.current,f!==null){switch(f.tag){case 13:return ki===null?h1():f.alternate===null&&xn===0&&(xn=3),f.flags&=-257,f.flags|=65536,f.lanes=w,g===gb?f.flags|=16384:(c=f.updateQueue,c===null?f.updateQueue=new Set([g]):c.add(g),f1(a,g,w)),!1;case 22:return f.flags|=65536,g===gb?f.flags|=16384:(c=f.updateQueue,c===null?(c={transitions:null,markerInstances:null,retryQueue:new Set([g])},f.updateQueue=c):(f=c.retryQueue,f===null?c.retryQueue=new Set([g]):f.add(g)),f1(a,g,w)),!1}throw Error(s(435,f.tag))}return f1(a,g,w),h1(),!1}if(Le)return c=Fr.current,c!==null?((c.flags&65536)===0&&(c.flags|=256),c.flags|=65536,c.lanes=w,g!==ub&&(a=Error(s(422),{cause:g}),Kh($r(a,f)))):(g!==ub&&(c=Error(s(423),{cause:g}),Kh($r(c,f))),a=a.current.alternate,a.flags|=65536,w&=-w,a.lanes|=w,g=$r(g,f),w=Bb(a.stateNode,g,w),bb(a,w),xn!==4&&(xn=2)),!1;var T=Error(s(520),{cause:g});if(T=$r(T,f),md===null?md=[T]:md.push(T),xn!==4&&(xn=2),c===null)return!0;g=$r(g,f),f=c;do{switch(f.tag){case 3:return f.flags|=65536,a=w&-w,f.lanes|=a,a=Bb(f.stateNode,g,a),bb(f,a),!1;case 1:if(c=f.type,T=f.stateNode,(f.flags&128)===0&&(typeof c.getDerivedStateFromError=="function"||T!==null&&typeof T.componentDidCatch=="function"&&(ma===null||!ma.has(T))))return f.flags|=65536,w&=-w,f.lanes|=w,w=_I(w),kI(w,a,f,g),bb(f,w),!1}f=f.return}while(f!==null);return!1}var AI=Error(s(461)),rs=!1;function ys(a,c,f,g){c.child=a===null?bI(c,null,f,g):oc(c,a.child,f,g)}function NI(a,c,f,g,w){f=f.render;var T=c.ref;if("ref"in g){var F={};for(var z in g)z!=="ref"&&(F[z]=g[z])}else F=g;return Rl(c),g=Tb(a,c,f,F,T,w),z=Eb(),a!==null&&!rs?(Ib(a,c,w),Eo(a,c,w)):(Le&&z&&ab(c),c.flags|=1,ys(a,c,g,w),c.child)}function RI(a,c,f,g,w){if(a===null){var T=f.type;return typeof T=="function"&&!rb(T)&&T.defaultProps===void 0&&f.compare===null?(c.tag=15,c.type=T,$I(a,c,T,g,w)):(a=Cm(f.type,null,g,c,c.mode,w),a.ref=c.ref,a.return=c,c.child=a)}if(T=a.child,!Xb(a,w)){var F=T.memoizedProps;if(f=f.compare,f=f!==null?f:Wh,f(F,g)&&a.ref===c.ref)return Eo(a,c,w)}return c.flags|=1,a=xo(T,g),a.ref=c.ref,a.return=c,c.child=a}function $I(a,c,f,g,w){if(a!==null){var T=a.memoizedProps;if(Wh(T,g)&&a.ref===c.ref)if(rs=!1,c.pendingProps=g=T,Xb(a,w))(a.flags&131072)!==0&&(rs=!0);else return c.lanes=a.lanes,Eo(a,c,w)}return Ub(a,c,f,g,w)}function DI(a,c,f){var g=c.pendingProps,w=g.children,T=a!==null?a.memoizedState:null;if(g.mode==="hidden"){if((c.flags&128)!==0){if(g=T!==null?T.baseLanes|f:f,a!==null){for(w=c.child=a.child,T=0;w!==null;)T=T|w.lanes|w.childLanes,w=w.sibling;c.childLanes=T&~g}else c.childLanes=0,c.child=null;return OI(a,c,g,f)}if((f&536870912)!==0)c.memoizedState={baseLanes:0,cachePool:null},a!==null&&_m(c,T!==null?T.cachePool:null),T!==null?$E(c,T):wb(),vI(c);else return c.lanes=c.childLanes=536870912,OI(a,c,T!==null?T.baseLanes|f:f,f)}else T!==null?(_m(c,T.cachePool),$E(c,T),ua(),c.memoizedState=null):(a!==null&&_m(c,null),wb(),ua());return ys(a,c,w,f),c.child}function OI(a,c,f,g){var w=mb();return w=w===null?null:{parent:qn._currentValue,pool:w},c.memoizedState={baseLanes:f,cachePool:w},a!==null&&_m(c,null),wb(),vI(c),a!==null&&Xh(a,c,g,!0),null}function Wm(a,c){var f=c.ref;if(f===null)a!==null&&a.ref!==null&&(c.flags|=4194816);else{if(typeof f!="function"&&typeof f!="object")throw Error(s(284));(a===null||a.ref!==f)&&(c.flags|=4194816)}}function Ub(a,c,f,g,w){return Rl(c),f=Tb(a,c,f,g,void 0,w),g=Eb(),a!==null&&!rs?(Ib(a,c,w),Eo(a,c,w)):(Le&&g&&ab(c),c.flags|=1,ys(a,c,f,w),c.child)}function MI(a,c,f,g,w,T){return Rl(c),c.updateQueue=null,f=OE(c,g,f,w),DE(a),g=Eb(),a!==null&&!rs?(Ib(a,c,T),Eo(a,c,T)):(Le&&g&&ab(c),c.flags|=1,ys(a,c,f,T),c.child)}function FI(a,c,f,g,w){if(Rl(c),c.stateNode===null){var T=Yu,F=f.contextType;typeof F=="object"&&F!==null&&(T=Ns(F)),T=new f(g,T),c.memoizedState=T.state!==null&&T.state!==void 0?T.state:null,T.updater=zb,c.stateNode=T,T._reactInternals=c,T=c.stateNode,T.props=g,T.state=c.memoizedState,T.refs={},yb(c),F=f.contextType,T.context=typeof F=="object"&&F!==null?Ns(F):Yu,T.state=c.memoizedState,F=f.getDerivedStateFromProps,typeof F=="function"&&(Vb(c,f,F,g),T.state=c.memoizedState),typeof f.getDerivedStateFromProps=="function"||typeof T.getSnapshotBeforeUpdate=="function"||typeof T.UNSAFE_componentWillMount!="function"&&typeof T.componentWillMount!="function"||(F=T.state,typeof T.componentWillMount=="function"&&T.componentWillMount(),typeof T.UNSAFE_componentWillMount=="function"&&T.UNSAFE_componentWillMount(),F!==T.state&&zb.enqueueReplaceState(T,T.state,null),nd(c,g,T,w),ed(),T.state=c.memoizedState),typeof T.componentDidMount=="function"&&(c.flags|=4194308),g=!0}else if(a===null){T=c.stateNode;var z=c.memoizedProps,q=Ol(f,z);T.props=q;var ht=T.context,wt=f.contextType;F=Yu,typeof wt=="object"&&wt!==null&&(F=Ns(wt));var Tt=f.getDerivedStateFromProps;wt=typeof Tt=="function"||typeof T.getSnapshotBeforeUpdate=="function",z=c.pendingProps!==z,wt||typeof T.UNSAFE_componentWillReceiveProps!="function"&&typeof T.componentWillReceiveProps!="function"||(z||ht!==F)&&CI(c,T,g,F),ra=!1;var ft=c.memoizedState;T.state=ft,nd(c,g,T,w),ed(),ht=c.memoizedState,z||ft!==ht||ra?(typeof Tt=="function"&&(Vb(c,f,Tt,g),ht=c.memoizedState),(q=ra||wI(c,f,q,g,ft,ht,F))?(wt||typeof T.UNSAFE_componentWillMount!="function"&&typeof T.componentWillMount!="function"||(typeof T.componentWillMount=="function"&&T.componentWillMount(),typeof T.UNSAFE_componentWillMount=="function"&&T.UNSAFE_componentWillMount()),typeof T.componentDidMount=="function"&&(c.flags|=4194308)):(typeof T.componentDidMount=="function"&&(c.flags|=4194308),c.memoizedProps=g,c.memoizedState=ht),T.props=g,T.state=ht,T.context=F,g=q):(typeof T.componentDidMount=="function"&&(c.flags|=4194308),g=!1)}else{T=c.stateNode,xb(a,c),F=c.memoizedProps,wt=Ol(f,F),T.props=wt,Tt=c.pendingProps,ft=T.context,ht=f.contextType,q=Yu,typeof ht=="object"&&ht!==null&&(q=Ns(ht)),z=f.getDerivedStateFromProps,(ht=typeof z=="function"||typeof T.getSnapshotBeforeUpdate=="function")||typeof T.UNSAFE_componentWillReceiveProps!="function"&&typeof T.componentWillReceiveProps!="function"||(F!==Tt||ft!==q)&&CI(c,T,g,q),ra=!1,ft=c.memoizedState,T.state=ft,nd(c,g,T,w),ed();var pt=c.memoizedState;F!==Tt||ft!==pt||ra||a!==null&&a.dependencies!==null&&Em(a.dependencies)?(typeof z=="function"&&(Vb(c,f,z,g),pt=c.memoizedState),(wt=ra||wI(c,f,wt,g,ft,pt,q)||a!==null&&a.dependencies!==null&&Em(a.dependencies))?(ht||typeof T.UNSAFE_componentWillUpdate!="function"&&typeof T.componentWillUpdate!="function"||(typeof T.componentWillUpdate=="function"&&T.componentWillUpdate(g,pt,q),typeof T.UNSAFE_componentWillUpdate=="function"&&T.UNSAFE_componentWillUpdate(g,pt,q)),typeof T.componentDidUpdate=="function"&&(c.flags|=4),typeof T.getSnapshotBeforeUpdate=="function"&&(c.flags|=1024)):(typeof T.componentDidUpdate!="function"||F===a.memoizedProps&&ft===a.memoizedState||(c.flags|=4),typeof T.getSnapshotBeforeUpdate!="function"||F===a.memoizedProps&&ft===a.memoizedState||(c.flags|=1024),c.memoizedProps=g,c.memoizedState=pt),T.props=g,T.state=pt,T.context=q,g=wt):(typeof T.componentDidUpdate!="function"||F===a.memoizedProps&&ft===a.memoizedState||(c.flags|=4),typeof T.getSnapshotBeforeUpdate!="function"||F===a.memoizedProps&&ft===a.memoizedState||(c.flags|=1024),g=!1)}return T=g,Wm(a,c),g=(c.flags&128)!==0,T||g?(T=c.stateNode,f=g&&typeof f.getDerivedStateFromError!="function"?null:T.render(),c.flags|=1,a!==null&&g?(c.child=oc(c,a.child,null,w),c.child=oc(c,null,f,w)):ys(a,c,f,w),c.memoizedState=T.state,a=c.child):a=Eo(a,c,w),a}function LI(a,c,f,g){return jh(),c.flags|=256,ys(a,c,f,g),c.child}var Gb={dehydrated:null,treeContext:null,retryLane:0,hydrationErrors:null};function Wb(a){return{baseLanes:a,cachePool:TE()}}function Hb(a,c,f){return a=a!==null?a.childLanes&~f:0,c&&(a|=Lr),a}function PI(a,c,f){var g=c.pendingProps,w=!1,T=(c.flags&128)!==0,F;if((F=T)||(F=a!==null&&a.memoizedState===null?!1:(jn.current&2)!==0),F&&(w=!0,c.flags&=-129),F=(c.flags&32)!==0,c.flags&=-33,a===null){if(Le){if(w?la(c):ua(),Le){var z=yn,q;if(q=z){t:{for(q=z,z=_i;q.nodeType!==8;){if(!z){z=null;break t}if(q=ei(q.nextSibling),q===null){z=null;break t}}z=q}z!==null?(c.memoizedState={dehydrated:z,treeContext:Il!==null?{id:bo,overflow:vo}:null,retryLane:536870912,hydrationErrors:null},q=pr(18,null,null,0),q.stateNode=z,q.return=c,c.child=q,Hs=c,yn=null,q=!0):q=!1}q||Al(c)}if(z=c.memoizedState,z!==null&&(z=z.dehydrated,z!==null))return k1(z)?c.lanes=32:c.lanes=536870912,null;To(c)}return z=g.children,g=g.fallback,w?(ua(),w=c.mode,z=Hm({mode:"hidden",children:z},w),g=El(g,w,f,null),z.return=c,g.return=c,z.sibling=g,c.child=z,w=c.child,w.memoizedState=Wb(f),w.childLanes=Hb(a,F,f),c.memoizedState=Gb,g):(la(c),qb(c,z))}if(q=a.memoizedState,q!==null&&(z=q.dehydrated,z!==null)){if(T)c.flags&256?(la(c),c.flags&=-257,c=jb(a,c,f)):c.memoizedState!==null?(ua(),c.child=a.child,c.flags|=128,c=null):(ua(),w=g.fallback,z=c.mode,g=Hm({mode:"visible",children:g.children},z),w=El(w,z,f,null),w.flags|=2,g.return=c,w.return=c,g.sibling=w,c.child=g,oc(c,a.child,null,f),g=c.child,g.memoizedState=Wb(f),g.childLanes=Hb(a,F,f),c.memoizedState=Gb,c=w);else if(la(c),k1(z)){if(F=z.nextSibling&&z.nextSibling.dataset,F)var ht=F.dgst;F=ht,g=Error(s(419)),g.stack="",g.digest=F,Kh({value:g,source:null,stack:null}),c=jb(a,c,f)}else if(rs||Xh(a,c,f,!1),F=(f&a.childLanes)!==0,rs||F){if(F=en,F!==null&&(g=f&-f,g=(g&42)!==0?1:Yo(g),g=(g&(F.suspendedLanes|f))!==0?0:g,g!==0&&g!==q.retryLane))throw q.retryLane=g,Xu(a,g),br(F,a,g),AI;z.data==="$?"||h1(),c=jb(a,c,f)}else z.data==="$?"?(c.flags|=192,c.child=a.child,c=null):(a=q.treeContext,yn=ei(z.nextSibling),Hs=c,Le=!0,kl=null,_i=!1,a!==null&&(Or[Mr++]=bo,Or[Mr++]=vo,Or[Mr++]=Il,bo=a.id,vo=a.overflow,Il=c),c=qb(c,g.children),c.flags|=4096);return c}return w?(ua(),w=g.fallback,z=c.mode,q=a.child,ht=q.sibling,g=xo(q,{mode:"hidden",children:g.children}),g.subtreeFlags=q.subtreeFlags&65011712,ht!==null?w=xo(ht,w):(w=El(w,z,f,null),w.flags|=2),w.return=c,g.return=c,g.sibling=w,c.child=g,g=w,w=c.child,z=a.child.memoizedState,z===null?z=Wb(f):(q=z.cachePool,q!==null?(ht=qn._currentValue,q=q.parent!==ht?{parent:ht,pool:ht}:q):q=TE(),z={baseLanes:z.baseLanes|f,cachePool:q}),w.memoizedState=z,w.childLanes=Hb(a,F,f),c.memoizedState=Gb,g):(la(c),f=a.child,a=f.sibling,f=xo(f,{mode:"visible",children:g.children}),f.return=c,f.sibling=null,a!==null&&(F=c.deletions,F===null?(c.deletions=[a],c.flags|=16):F.push(a)),c.child=f,c.memoizedState=null,f)}function qb(a,c){return c=Hm({mode:"visible",children:c},a.mode),c.return=a,a.child=c}function Hm(a,c){return a=pr(22,a,null,c),a.lanes=0,a.stateNode={_visibility:1,_pendingMarkers:null,_retryCache:null,_transitions:null},a}function jb(a,c,f){return oc(c,a.child,null,f),a=qb(c,c.pendingProps.children),a.flags|=2,c.memoizedState=null,a}function VI(a,c,f){a.lanes|=c;var g=a.alternate;g!==null&&(g.lanes|=c),hb(a.return,c,f)}function Kb(a,c,f,g,w){var T=a.memoizedState;T===null?a.memoizedState={isBackwards:c,rendering:null,renderingStartTime:0,last:g,tail:f,tailMode:w}:(T.isBackwards=c,T.rendering=null,T.renderingStartTime=0,T.last=g,T.tail=f,T.tailMode=w)}function zI(a,c,f){var g=c.pendingProps,w=g.revealOrder,T=g.tail;if(ys(a,c,g.children,f),g=jn.current,(g&2)!==0)g=g&1|2,c.flags|=128;else{if(a!==null&&(a.flags&128)!==0)t:for(a=c.child;a!==null;){if(a.tag===13)a.memoizedState!==null&&VI(a,f,c);else if(a.tag===19)VI(a,f,c);else if(a.child!==null){a.child.return=a,a=a.child;continue}if(a===c)break t;for(;a.sibling===null;){if(a.return===null||a.return===c)break t;a=a.return}a.sibling.return=a.return,a=a.sibling}g&=1}switch(tt(jn,g),w){case"forwards":for(f=c.child,w=null;f!==null;)a=f.alternate,a!==null&&Bm(a)===null&&(w=f),f=f.sibling;f=w,f===null?(w=c.child,c.child=null):(w=f.sibling,f.sibling=null),Kb(c,!1,w,f,T);break;case"backwards":for(f=null,w=c.child,c.child=null;w!==null;){if(a=w.alternate,a!==null&&Bm(a)===null){c.child=w;break}a=w.sibling,w.sibling=f,f=w,w=a}Kb(c,!0,f,null,T);break;case"together":Kb(c,!1,null,null,void 0);break;default:c.memoizedState=null}return c.child}function Eo(a,c,f){if(a!==null&&(c.dependencies=a.dependencies),pa|=c.lanes,(f&c.childLanes)===0)if(a!==null){if(Xh(a,c,f,!1),(f&c.childLanes)===0)return null}else return null;if(a!==null&&c.child!==a.child)throw Error(s(153));if(c.child!==null){for(a=c.child,f=xo(a,a.pendingProps),c.child=f,f.return=c;a.sibling!==null;)a=a.sibling,f=f.sibling=xo(a,a.pendingProps),f.return=c;f.sibling=null}return c.child}function Xb(a,c){return(a.lanes&c)!==0?!0:(a=a.dependencies,!!(a!==null&&Em(a)))}function FP(a,c,f){switch(c.tag){case 3:Rt(c,c.stateNode.containerInfo),sa(c,qn,a.memoizedState.cache),jh();break;case 27:case 5:jt(c);break;case 4:Rt(c,c.stateNode.containerInfo);break;case 10:sa(c,c.type,c.memoizedProps.value);break;case 13:var g=c.memoizedState;if(g!==null)return g.dehydrated!==null?(la(c),c.flags|=128,null):(f&c.child.childLanes)!==0?PI(a,c,f):(la(c),a=Eo(a,c,f),a!==null?a.sibling:null);la(c);break;case 19:var w=(a.flags&128)!==0;if(g=(f&c.childLanes)!==0,g||(Xh(a,c,f,!1),g=(f&c.childLanes)!==0),w){if(g)return zI(a,c,f);c.flags|=128}if(w=c.memoizedState,w!==null&&(w.rendering=null,w.tail=null,w.lastEffect=null),tt(jn,jn.current),g)break;return null;case 22:case 23:return c.lanes=0,DI(a,c,f);case 24:sa(c,qn,a.memoizedState.cache)}return Eo(a,c,f)}function BI(a,c,f){if(a!==null)if(a.memoizedProps!==c.pendingProps)rs=!0;else{if(!Xb(a,f)&&(c.flags&128)===0)return rs=!1,FP(a,c,f);rs=(a.flags&131072)!==0}else rs=!1,Le&&(c.flags&1048576)!==0&&yE(c,Tm,c.index);switch(c.lanes=0,c.tag){case 16:t:{a=c.pendingProps;var g=c.elementType,w=g._init;if(g=w(g._payload),c.type=g,typeof g=="function")rb(g)?(a=Ol(g,a),c.tag=1,c=FI(null,c,g,a,f)):(c.tag=0,c=Ub(null,c,g,a,f));else{if(g!=null){if(w=g.$$typeof,w===I){c.tag=11,c=NI(null,c,g,a,f);break t}else if(w===D){c.tag=14,c=RI(null,c,g,a,f);break t}}throw c=nt(g)||g,Error(s(306,c,""))}}return c;case 0:return Ub(a,c,c.type,c.pendingProps,f);case 1:return g=c.type,w=Ol(g,c.pendingProps),FI(a,c,g,w,f);case 3:t:{if(Rt(c,c.stateNode.containerInfo),a===null)throw Error(s(387));g=c.pendingProps;var T=c.memoizedState;w=T.element,xb(a,c),nd(c,g,null,f);var F=c.memoizedState;if(g=F.cache,sa(c,qn,g),g!==T.cache&&db(c,[qn],f,!0),ed(),g=F.element,T.isDehydrated)if(T={element:g,isDehydrated:!1,cache:F.cache},c.updateQueue.baseState=T,c.memoizedState=T,c.flags&256){c=LI(a,c,g,f);break t}else if(g!==w){w=$r(Error(s(424)),c),Kh(w),c=LI(a,c,g,f);break t}else{switch(a=c.stateNode.containerInfo,a.nodeType){case 9:a=a.body;break;default:a=a.nodeName==="HTML"?a.ownerDocument.body:a}for(yn=ei(a.firstChild),Hs=c,Le=!0,kl=null,_i=!0,f=bI(c,null,g,f),c.child=f;f;)f.flags=f.flags&-3|4096,f=f.sibling}else{if(jh(),g===w){c=Eo(a,c,f);break t}ys(a,c,g,f)}c=c.child}return c;case 26:return Wm(a,c),a===null?(f=H2(c.type,null,c.pendingProps,null))?c.memoizedState=f:Le||(f=c.type,a=c.pendingProps,g=ig(Ct.current).createElement(f),g[Gn]=c,g[Rn]=a,bs(g,f,a),En(g),c.stateNode=g):c.memoizedState=H2(c.type,a.memoizedProps,c.pendingProps,a.memoizedState),null;case 27:return jt(c),a===null&&Le&&(g=c.stateNode=U2(c.type,c.pendingProps,Ct.current),Hs=c,_i=!0,w=yn,xa(c.type)?(A1=w,yn=ei(g.firstChild)):yn=w),ys(a,c,c.pendingProps.children,f),Wm(a,c),a===null&&(c.flags|=4194304),c.child;case 5:return a===null&&Le&&((w=g=yn)&&(g=c4(g,c.type,c.pendingProps,_i),g!==null?(c.stateNode=g,Hs=c,yn=ei(g.firstChild),_i=!1,w=!0):w=!1),w||Al(c)),jt(c),w=c.type,T=c.pendingProps,F=a!==null?a.memoizedProps:null,g=T.children,E1(w,T)?g=null:F!==null&&E1(w,F)&&(c.flags|=32),c.memoizedState!==null&&(w=Tb(a,c,kP,null,null,f),Td._currentValue=w),Wm(a,c),ys(a,c,g,f),c.child;case 6:return a===null&&Le&&((a=f=yn)&&(f=h4(f,c.pendingProps,_i),f!==null?(c.stateNode=f,Hs=c,yn=null,a=!0):a=!1),a||Al(c)),null;case 13:return PI(a,c,f);case 4:return Rt(c,c.stateNode.containerInfo),g=c.pendingProps,a===null?c.child=oc(c,null,g,f):ys(a,c,g,f),c.child;case 11:return NI(a,c,c.type,c.pendingProps,f);case 7:return ys(a,c,c.pendingProps,f),c.child;case 8:return ys(a,c,c.pendingProps.children,f),c.child;case 12:return ys(a,c,c.pendingProps.children,f),c.child;case 10:return g=c.pendingProps,sa(c,c.type,g.value),ys(a,c,g.children,f),c.child;case 9:return w=c.type._context,g=c.pendingProps.children,Rl(c),w=Ns(w),g=g(w),c.flags|=1,ys(a,c,g,f),c.child;case 14:return RI(a,c,c.type,c.pendingProps,f);case 15:return $I(a,c,c.type,c.pendingProps,f);case 19:return zI(a,c,f);case 31:return g=c.pendingProps,f=c.mode,g={mode:g.mode,children:g.children},a===null?(f=Hm(g,f),f.ref=c.ref,c.child=f,f.return=c,c=f):(f=xo(a.child,g),f.ref=c.ref,c.child=f,f.return=c,c=f),c;case 22:return DI(a,c,f);case 24:return Rl(c),g=Ns(qn),a===null?(w=mb(),w===null&&(w=en,T=fb(),w.pooledCache=T,T.refCount++,T!==null&&(w.pooledCacheLanes|=f),w=T),c.memoizedState={parent:g,cache:w},yb(c),sa(c,qn,w)):((a.lanes&f)!==0&&(xb(a,c),nd(c,null,null,f),ed()),w=a.memoizedState,T=c.memoizedState,w.parent!==g?(w={parent:g,cache:g},c.memoizedState=w,c.lanes===0&&(c.memoizedState=c.updateQueue.baseState=w),sa(c,qn,g)):(g=T.cache,sa(c,qn,g),g!==w.cache&&db(c,[qn],f,!0))),ys(a,c,c.pendingProps.children,f),c.child;case 29:throw c.pendingProps}throw Error(s(156,c.tag))}function Io(a){a.flags|=4}function UI(a,c){if(c.type!=="stylesheet"||(c.state.loading&4)!==0)a.flags&=-16777217;else if(a.flags|=16777216,!Y2(c)){if(c=Fr.current,c!==null&&((Ie&4194048)===Ie?ki!==null:(Ie&62914560)!==Ie&&(Ie&536870912)===0||c!==ki))throw Jh=gb,EE;a.flags|=8192}}function qm(a,c){c!==null&&(a.flags|=4),a.flags&16384&&(c=a.tag!==22?Ih():536870912,a.lanes|=c,cc|=c)}function ud(a,c){if(!Le)switch(a.tailMode){case"hidden":c=a.tail;for(var f=null;c!==null;)c.alternate!==null&&(f=c),c=c.sibling;f===null?a.tail=null:f.sibling=null;break;case"collapsed":f=a.tail;for(var g=null;f!==null;)f.alternate!==null&&(g=f),f=f.sibling;g===null?c||a.tail===null?a.tail=null:a.tail.sibling=null:g.sibling=null}}function dn(a){var c=a.alternate!==null&&a.alternate.child===a.child,f=0,g=0;if(c)for(var w=a.child;w!==null;)f|=w.lanes|w.childLanes,g|=w.subtreeFlags&65011712,g|=w.flags&65011712,w.return=a,w=w.sibling;else for(w=a.child;w!==null;)f|=w.lanes|w.childLanes,g|=w.subtreeFlags,g|=w.flags,w.return=a,w=w.sibling;return a.subtreeFlags|=g,a.childLanes=f,c}function LP(a,c,f){var g=c.pendingProps;switch(lb(c),c.tag){case 31:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return dn(c),null;case 1:return dn(c),null;case 3:return f=c.stateNode,g=null,a!==null&&(g=a.memoizedState.cache),c.memoizedState.cache!==g&&(c.flags|=2048),Co(qn),Lt(),f.pendingContext&&(f.context=f.pendingContext,f.pendingContext=null),(a===null||a.child===null)&&(qh(c)?Io(c):a===null||a.memoizedState.isDehydrated&&(c.flags&256)===0||(c.flags|=1024,vE())),dn(c),null;case 26:return f=c.memoizedState,a===null?(Io(c),f!==null?(dn(c),UI(c,f)):(dn(c),c.flags&=-16777217)):f?f!==a.memoizedState?(Io(c),dn(c),UI(c,f)):(dn(c),c.flags&=-16777217):(a.memoizedProps!==g&&Io(c),dn(c),c.flags&=-16777217),null;case 27:Kt(c),f=Ct.current;var w=c.type;if(a!==null&&c.stateNode!=null)a.memoizedProps!==g&&Io(c);else{if(!g){if(c.stateNode===null)throw Error(s(166));return dn(c),null}a=xt.current,qh(c)?xE(c):(a=U2(w,g,f),c.stateNode=a,Io(c))}return dn(c),null;case 5:if(Kt(c),f=c.type,a!==null&&c.stateNode!=null)a.memoizedProps!==g&&Io(c);else{if(!g){if(c.stateNode===null)throw Error(s(166));return dn(c),null}if(a=xt.current,qh(c))xE(c);else{switch(w=ig(Ct.current),a){case 1:a=w.createElementNS("http://www.w3.org/2000/svg",f);break;case 2:a=w.createElementNS("http://www.w3.org/1998/Math/MathML",f);break;default:switch(f){case"svg":a=w.createElementNS("http://www.w3.org/2000/svg",f);break;case"math":a=w.createElementNS("http://www.w3.org/1998/Math/MathML",f);break;case"script":a=w.createElement("div"),a.innerHTML="<script><\/script>",a=a.removeChild(a.firstChild);break;case"select":a=typeof g.is=="string"?w.createElement("select",{is:g.is}):w.createElement("select"),g.multiple?a.multiple=!0:g.size&&(a.size=g.size);break;default:a=typeof g.is=="string"?w.createElement(f,{is:g.is}):w.createElement(f)}}a[Gn]=c,a[Rn]=g;t:for(w=c.child;w!==null;){if(w.tag===5||w.tag===6)a.appendChild(w.stateNode);else if(w.tag!==4&&w.tag!==27&&w.child!==null){w.child.return=w,w=w.child;continue}if(w===c)break t;for(;w.sibling===null;){if(w.return===null||w.return===c)break t;w=w.return}w.sibling.return=w.return,w=w.sibling}c.stateNode=a;t:switch(bs(a,f,g),f){case"button":case"input":case"select":case"textarea":a=!!g.autoFocus;break t;case"img":a=!0;break t;default:a=!1}a&&Io(c)}}return dn(c),c.flags&=-16777217,null;case 6:if(a&&c.stateNode!=null)a.memoizedProps!==g&&Io(c);else{if(typeof g!="string"&&c.stateNode===null)throw Error(s(166));if(a=Ct.current,qh(c)){if(a=c.stateNode,f=c.memoizedProps,g=null,w=Hs,w!==null)switch(w.tag){case 27:case 5:g=w.memoizedProps}a[Gn]=c,a=!!(a.nodeValue===f||g!==null&&g.suppressHydrationWarning===!0||M2(a.nodeValue,f)),a||Al(c)}else a=ig(a).createTextNode(g),a[Gn]=c,c.stateNode=a}return dn(c),null;case 13:if(g=c.memoizedState,a===null||a.memoizedState!==null&&a.memoizedState.dehydrated!==null){if(w=qh(c),g!==null&&g.dehydrated!==null){if(a===null){if(!w)throw Error(s(318));if(w=c.memoizedState,w=w!==null?w.dehydrated:null,!w)throw Error(s(317));w[Gn]=c}else jh(),(c.flags&128)===0&&(c.memoizedState=null),c.flags|=4;dn(c),w=!1}else w=vE(),a!==null&&a.memoizedState!==null&&(a.memoizedState.hydrationErrors=w),w=!0;if(!w)return c.flags&256?(To(c),c):(To(c),null)}if(To(c),(c.flags&128)!==0)return c.lanes=f,c;if(f=g!==null,a=a!==null&&a.memoizedState!==null,f){g=c.child,w=null,g.alternate!==null&&g.alternate.memoizedState!==null&&g.alternate.memoizedState.cachePool!==null&&(w=g.alternate.memoizedState.cachePool.pool);var T=null;g.memoizedState!==null&&g.memoizedState.cachePool!==null&&(T=g.memoizedState.cachePool.pool),T!==w&&(g.flags|=2048)}return f!==a&&f&&(c.child.flags|=8192),qm(c,c.updateQueue),dn(c),null;case 4:return Lt(),a===null&&v1(c.stateNode.containerInfo),dn(c),null;case 10:return Co(c.type),dn(c),null;case 19:if(st(jn),w=c.memoizedState,w===null)return dn(c),null;if(g=(c.flags&128)!==0,T=w.rendering,T===null)if(g)ud(w,!1);else{if(xn!==0||a!==null&&(a.flags&128)!==0)for(a=c.child;a!==null;){if(T=Bm(a),T!==null){for(c.flags|=128,ud(w,!1),a=T.updateQueue,c.updateQueue=a,qm(c,a),c.subtreeFlags=0,a=f,f=c.child;f!==null;)gE(f,a),f=f.sibling;return tt(jn,jn.current&1|2),c.child}a=a.sibling}w.tail!==null&&me()>Xm&&(c.flags|=128,g=!0,ud(w,!1),c.lanes=4194304)}else{if(!g)if(a=Bm(T),a!==null){if(c.flags|=128,g=!0,a=a.updateQueue,c.updateQueue=a,qm(c,a),ud(w,!0),w.tail===null&&w.tailMode==="hidden"&&!T.alternate&&!Le)return dn(c),null}else 2*me()-w.renderingStartTime>Xm&&f!==536870912&&(c.flags|=128,g=!0,ud(w,!1),c.lanes=4194304);w.isBackwards?(T.sibling=c.child,c.child=T):(a=w.last,a!==null?a.sibling=T:c.child=T,w.last=T)}return w.tail!==null?(c=w.tail,w.rendering=c,w.tail=c.sibling,w.renderingStartTime=me(),c.sibling=null,a=jn.current,tt(jn,g?a&1|2:a&1),c):(dn(c),null);case 22:case 23:return To(c),Cb(),g=c.memoizedState!==null,a!==null?a.memoizedState!==null!==g&&(c.flags|=8192):g&&(c.flags|=8192),g?(f&536870912)!==0&&(c.flags&128)===0&&(dn(c),c.subtreeFlags&6&&(c.flags|=8192)):dn(c),f=c.updateQueue,f!==null&&qm(c,f.retryQueue),f=null,a!==null&&a.memoizedState!==null&&a.memoizedState.cachePool!==null&&(f=a.memoizedState.cachePool.pool),g=null,c.memoizedState!==null&&c.memoizedState.cachePool!==null&&(g=c.memoizedState.cachePool.pool),g!==f&&(c.flags|=2048),a!==null&&st($l),null;case 24:return f=null,a!==null&&(f=a.memoizedState.cache),c.memoizedState.cache!==f&&(c.flags|=2048),Co(qn),dn(c),null;case 25:return null;case 30:return null}throw Error(s(156,c.tag))}function PP(a,c){switch(lb(c),c.tag){case 1:return a=c.flags,a&65536?(c.flags=a&-65537|128,c):null;case 3:return Co(qn),Lt(),a=c.flags,(a&65536)!==0&&(a&128)===0?(c.flags=a&-65537|128,c):null;case 26:case 27:case 5:return Kt(c),null;case 13:if(To(c),a=c.memoizedState,a!==null&&a.dehydrated!==null){if(c.alternate===null)throw Error(s(340));jh()}return a=c.flags,a&65536?(c.flags=a&-65537|128,c):null;case 19:return st(jn),null;case 4:return Lt(),null;case 10:return Co(c.type),null;case 22:case 23:return To(c),Cb(),a!==null&&st($l),a=c.flags,a&65536?(c.flags=a&-65537|128,c):null;case 24:return Co(qn),null;case 25:return null;default:return null}}function GI(a,c){switch(lb(c),c.tag){case 3:Co(qn),Lt();break;case 26:case 27:case 5:Kt(c);break;case 4:Lt();break;case 13:To(c);break;case 19:st(jn);break;case 10:Co(c.type);break;case 22:case 23:To(c),Cb(),a!==null&&st($l);break;case 24:Co(qn)}}function cd(a,c){try{var f=c.updateQueue,g=f!==null?f.lastEffect:null;if(g!==null){var w=g.next;f=w;do{if((f.tag&a)===a){g=void 0;var T=f.create,F=f.inst;g=T(),F.destroy=g}f=f.next}while(f!==w)}}catch(z){Qe(c,c.return,z)}}function ca(a,c,f){try{var g=c.updateQueue,w=g!==null?g.lastEffect:null;if(w!==null){var T=w.next;g=T;do{if((g.tag&a)===a){var F=g.inst,z=F.destroy;if(z!==void 0){F.destroy=void 0,w=c;var q=f,ht=z;try{ht()}catch(wt){Qe(w,q,wt)}}}g=g.next}while(g!==T)}}catch(wt){Qe(c,c.return,wt)}}function WI(a){var c=a.updateQueue;if(c!==null){var f=a.stateNode;try{RE(c,f)}catch(g){Qe(a,a.return,g)}}}function HI(a,c,f){f.props=Ol(a.type,a.memoizedProps),f.state=a.memoizedState;try{f.componentWillUnmount()}catch(g){Qe(a,c,g)}}function hd(a,c){try{var f=a.ref;if(f!==null){switch(a.tag){case 26:case 27:case 5:var g=a.stateNode;break;case 30:g=a.stateNode;break;default:g=a.stateNode}typeof f=="function"?a.refCleanup=f(g):f.current=g}}catch(w){Qe(a,c,w)}}function Ai(a,c){var f=a.ref,g=a.refCleanup;if(f!==null)if(typeof g=="function")try{g()}catch(w){Qe(a,c,w)}finally{a.refCleanup=null,a=a.alternate,a!=null&&(a.refCleanup=null)}else if(typeof f=="function")try{f(null)}catch(w){Qe(a,c,w)}else f.current=null}function qI(a){var c=a.type,f=a.memoizedProps,g=a.stateNode;try{t:switch(c){case"button":case"input":case"select":case"textarea":f.autoFocus&&g.focus();break t;case"img":f.src?g.src=f.src:f.srcSet&&(g.srcset=f.srcSet)}}catch(w){Qe(a,a.return,w)}}function Yb(a,c,f){try{var g=a.stateNode;i4(g,a.type,f,c),g[Rn]=c}catch(w){Qe(a,a.return,w)}}function jI(a){return a.tag===5||a.tag===3||a.tag===26||a.tag===27&&xa(a.type)||a.tag===4}function Qb(a){t:for(;;){for(;a.sibling===null;){if(a.return===null||jI(a.return))return null;a=a.return}for(a.sibling.return=a.return,a=a.sibling;a.tag!==5&&a.tag!==6&&a.tag!==18;){if(a.tag===27&&xa(a.type)||a.flags&2||a.child===null||a.tag===4)continue t;a.child.return=a,a=a.child}if(!(a.flags&2))return a.stateNode}}function Zb(a,c,f){var g=a.tag;if(g===5||g===6)a=a.stateNode,c?(f.nodeType===9?f.body:f.nodeName==="HTML"?f.ownerDocument.body:f).insertBefore(a,c):(c=f.nodeType===9?f.body:f.nodeName==="HTML"?f.ownerDocument.body:f,c.appendChild(a),f=f._reactRootContainer,f!=null||c.onclick!==null||(c.onclick=rg));else if(g!==4&&(g===27&&xa(a.type)&&(f=a.stateNode,c=null),a=a.child,a!==null))for(Zb(a,c,f),a=a.sibling;a!==null;)Zb(a,c,f),a=a.sibling}function jm(a,c,f){var g=a.tag;if(g===5||g===6)a=a.stateNode,c?f.insertBefore(a,c):f.appendChild(a);else if(g!==4&&(g===27&&xa(a.type)&&(f=a.stateNode),a=a.child,a!==null))for(jm(a,c,f),a=a.sibling;a!==null;)jm(a,c,f),a=a.sibling}function KI(a){var c=a.stateNode,f=a.memoizedProps;try{for(var g=a.type,w=c.attributes;w.length;)c.removeAttributeNode(w[0]);bs(c,g,f),c[Gn]=a,c[Rn]=f}catch(T){Qe(a,a.return,T)}}var _o=!1,_n=!1,Jb=!1,XI=typeof WeakSet=="function"?WeakSet:Set,is=null;function VP(a,c){if(a=a.containerInfo,S1=hg,a=oE(a),Qx(a)){if("selectionStart"in a)var f={start:a.selectionStart,end:a.selectionEnd};else t:{f=(f=a.ownerDocument)&&f.defaultView||window;var g=f.getSelection&&f.getSelection();if(g&&g.rangeCount!==0){f=g.anchorNode;var w=g.anchorOffset,T=g.focusNode;g=g.focusOffset;try{f.nodeType,T.nodeType}catch{f=null;break t}var F=0,z=-1,q=-1,ht=0,wt=0,Tt=a,ft=null;e:for(;;){for(var pt;Tt!==f||w!==0&&Tt.nodeType!==3||(z=F+w),Tt!==T||g!==0&&Tt.nodeType!==3||(q=F+g),Tt.nodeType===3&&(F+=Tt.nodeValue.length),(pt=Tt.firstChild)!==null;)ft=Tt,Tt=pt;for(;;){if(Tt===a)break e;if(ft===f&&++ht===w&&(z=F),ft===T&&++wt===g&&(q=F),(pt=Tt.nextSibling)!==null)break;Tt=ft,ft=Tt.parentNode}Tt=pt}f=z===-1||q===-1?null:{start:z,end:q}}else f=null}f=f||{start:0,end:0}}else f=null;for(T1={focusedElem:a,selectionRange:f},hg=!1,is=c;is!==null;)if(c=is,a=c.child,(c.subtreeFlags&1024)!==0&&a!==null)a.return=c,is=a;else for(;is!==null;){switch(c=is,T=c.alternate,a=c.flags,c.tag){case 0:break;case 11:case 15:break;case 1:if((a&1024)!==0&&T!==null){a=void 0,f=c,w=T.memoizedProps,T=T.memoizedState,g=f.stateNode;try{var te=Ol(f.type,w,f.elementType===f.type);a=g.getSnapshotBeforeUpdate(te,T),g.__reactInternalSnapshotBeforeUpdate=a}catch(Xt){Qe(f,f.return,Xt)}}break;case 3:if((a&1024)!==0){if(a=c.stateNode.containerInfo,f=a.nodeType,f===9)_1(a);else if(f===1)switch(a.nodeName){case"HEAD":case"HTML":case"BODY":_1(a);break;default:a.textContent=""}}break;case 5:case 26:case 27:case 6:case 4:case 17:break;default:if((a&1024)!==0)throw Error(s(163))}if(a=c.sibling,a!==null){a.return=c.return,is=a;break}is=c.return}}function YI(a,c,f){var g=f.flags;switch(f.tag){case 0:case 11:case 15:ha(a,f),g&4&&cd(5,f);break;case 1:if(ha(a,f),g&4)if(a=f.stateNode,c===null)try{a.componentDidMount()}catch(F){Qe(f,f.return,F)}else{var w=Ol(f.type,c.memoizedProps);c=c.memoizedState;try{a.componentDidUpdate(w,c,a.__reactInternalSnapshotBeforeUpdate)}catch(F){Qe(f,f.return,F)}}g&64&&WI(f),g&512&&hd(f,f.return);break;case 3:if(ha(a,f),g&64&&(a=f.updateQueue,a!==null)){if(c=null,f.child!==null)switch(f.child.tag){case 27:case 5:c=f.child.stateNode;break;case 1:c=f.child.stateNode}try{RE(a,c)}catch(F){Qe(f,f.return,F)}}break;case 27:c===null&&g&4&&KI(f);case 26:case 5:ha(a,f),c===null&&g&4&&qI(f),g&512&&hd(f,f.return);break;case 12:ha(a,f);break;case 13:ha(a,f),g&4&&JI(a,f),g&64&&(a=f.memoizedState,a!==null&&(a=a.dehydrated,a!==null&&(f=KP.bind(null,f),d4(a,f))));break;case 22:if(g=f.memoizedState!==null||_o,!g){c=c!==null&&c.memoizedState!==null||_n,w=_o;var T=_n;_o=g,(_n=c)&&!T?da(a,f,(f.subtreeFlags&8772)!==0):ha(a,f),_o=w,_n=T}break;case 30:break;default:ha(a,f)}}function QI(a){var c=a.alternate;c!==null&&(a.alternate=null,QI(c)),a.child=null,a.deletions=null,a.sibling=null,a.tag===5&&(c=a.stateNode,c!==null&&Jo(c)),a.stateNode=null,a.return=null,a.dependencies=null,a.memoizedProps=null,a.memoizedState=null,a.pendingProps=null,a.stateNode=null,a.updateQueue=null}var ln=null,nr=!1;function ko(a,c,f){for(f=f.child;f!==null;)ZI(a,c,f),f=f.sibling}function ZI(a,c,f){if(fe&&typeof fe.onCommitFiberUnmount=="function")try{fe.onCommitFiberUnmount(Fe,f)}catch{}switch(f.tag){case 26:_n||Ai(f,c),ko(a,c,f),f.memoizedState?f.memoizedState.count--:f.stateNode&&(f=f.stateNode,f.parentNode.removeChild(f));break;case 27:_n||Ai(f,c);var g=ln,w=nr;xa(f.type)&&(ln=f.stateNode,nr=!1),ko(a,c,f),vd(f.stateNode),ln=g,nr=w;break;case 5:_n||Ai(f,c);case 6:if(g=ln,w=nr,ln=null,ko(a,c,f),ln=g,nr=w,ln!==null)if(nr)try{(ln.nodeType===9?ln.body:ln.nodeName==="HTML"?ln.ownerDocument.body:ln).removeChild(f.stateNode)}catch(T){Qe(f,c,T)}else try{ln.removeChild(f.stateNode)}catch(T){Qe(f,c,T)}break;case 18:ln!==null&&(nr?(a=ln,z2(a.nodeType===9?a.body:a.nodeName==="HTML"?a.ownerDocument.body:a,f.stateNode),kd(a)):z2(ln,f.stateNode));break;case 4:g=ln,w=nr,ln=f.stateNode.containerInfo,nr=!0,ko(a,c,f),ln=g,nr=w;break;case 0:case 11:case 14:case 15:_n||ca(2,f,c),_n||ca(4,f,c),ko(a,c,f);break;case 1:_n||(Ai(f,c),g=f.stateNode,typeof g.componentWillUnmount=="function"&&HI(f,c,g)),ko(a,c,f);break;case 21:ko(a,c,f);break;case 22:_n=(g=_n)||f.memoizedState!==null,ko(a,c,f),_n=g;break;default:ko(a,c,f)}}function JI(a,c){if(c.memoizedState===null&&(a=c.alternate,a!==null&&(a=a.memoizedState,a!==null&&(a=a.dehydrated,a!==null))))try{kd(a)}catch(f){Qe(c,c.return,f)}}function zP(a){switch(a.tag){case 13:case 19:var c=a.stateNode;return c===null&&(c=a.stateNode=new XI),c;case 22:return a=a.stateNode,c=a._retryCache,c===null&&(c=a._retryCache=new XI),c;default:throw Error(s(435,a.tag))}}function t1(a,c){var f=zP(a);c.forEach(function(g){var w=XP.bind(null,a,g);f.has(g)||(f.add(g),g.then(w,w))})}function mr(a,c){var f=c.deletions;if(f!==null)for(var g=0;g<f.length;g++){var w=f[g],T=a,F=c,z=F;t:for(;z!==null;){switch(z.tag){case 27:if(xa(z.type)){ln=z.stateNode,nr=!1;break t}break;case 5:ln=z.stateNode,nr=!1;break t;case 3:case 4:ln=z.stateNode.containerInfo,nr=!0;break t}z=z.return}if(ln===null)throw Error(s(160));ZI(T,F,w),ln=null,nr=!1,T=w.alternate,T!==null&&(T.return=null),w.return=null}if(c.subtreeFlags&13878)for(c=c.child;c!==null;)t2(c,a),c=c.sibling}var ti=null;function t2(a,c){var f=a.alternate,g=a.flags;switch(a.tag){case 0:case 11:case 14:case 15:mr(c,a),gr(a),g&4&&(ca(3,a,a.return),cd(3,a),ca(5,a,a.return));break;case 1:mr(c,a),gr(a),g&512&&(_n||f===null||Ai(f,f.return)),g&64&&_o&&(a=a.updateQueue,a!==null&&(g=a.callbacks,g!==null&&(f=a.shared.hiddenCallbacks,a.shared.hiddenCallbacks=f===null?g:f.concat(g))));break;case 26:var w=ti;if(mr(c,a),gr(a),g&512&&(_n||f===null||Ai(f,f.return)),g&4){var T=f!==null?f.memoizedState:null;if(g=a.memoizedState,f===null)if(g===null)if(a.stateNode===null){t:{g=a.type,f=a.memoizedProps,w=w.ownerDocument||w;e:switch(g){case"title":T=w.getElementsByTagName("title")[0],(!T||T[ul]||T[Gn]||T.namespaceURI==="http://www.w3.org/2000/svg"||T.hasAttribute("itemprop"))&&(T=w.createElement(g),w.head.insertBefore(T,w.querySelector("head > title"))),bs(T,g,f),T[Gn]=a,En(T),g=T;break t;case"link":var F=K2("link","href",w).get(g+(f.href||""));if(F){for(var z=0;z<F.length;z++)if(T=F[z],T.getAttribute("href")===(f.href==null||f.href===""?null:f.href)&&T.getAttribute("rel")===(f.rel==null?null:f.rel)&&T.getAttribute("title")===(f.title==null?null:f.title)&&T.getAttribute("crossorigin")===(f.crossOrigin==null?null:f.crossOrigin)){F.splice(z,1);break e}}T=w.createElement(g),bs(T,g,f),w.head.appendChild(T);break;case"meta":if(F=K2("meta","content",w).get(g+(f.content||""))){for(z=0;z<F.length;z++)if(T=F[z],T.getAttribute("content")===(f.content==null?null:""+f.content)&&T.getAttribute("name")===(f.name==null?null:f.name)&&T.getAttribute("property")===(f.property==null?null:f.property)&&T.getAttribute("http-equiv")===(f.httpEquiv==null?null:f.httpEquiv)&&T.getAttribute("charset")===(f.charSet==null?null:f.charSet)){F.splice(z,1);break e}}T=w.createElement(g),bs(T,g,f),w.head.appendChild(T);break;default:throw Error(s(468,g))}T[Gn]=a,En(T),g=T}a.stateNode=g}else X2(w,a.type,a.stateNode);else a.stateNode=j2(w,g,a.memoizedProps);else T!==g?(T===null?f.stateNode!==null&&(f=f.stateNode,f.parentNode.removeChild(f)):T.count--,g===null?X2(w,a.type,a.stateNode):j2(w,g,a.memoizedProps)):g===null&&a.stateNode!==null&&Yb(a,a.memoizedProps,f.memoizedProps)}break;case 27:mr(c,a),gr(a),g&512&&(_n||f===null||Ai(f,f.return)),f!==null&&g&4&&Yb(a,a.memoizedProps,f.memoizedProps);break;case 5:if(mr(c,a),gr(a),g&512&&(_n||f===null||Ai(f,f.return)),a.flags&32){w=a.stateNode;try{kr(w,"")}catch(pt){Qe(a,a.return,pt)}}g&4&&a.stateNode!=null&&(w=a.memoizedProps,Yb(a,w,f!==null?f.memoizedProps:w)),g&1024&&(Jb=!0);break;case 6:if(mr(c,a),gr(a),g&4){if(a.stateNode===null)throw Error(s(162));g=a.memoizedProps,f=a.stateNode;try{f.nodeValue=g}catch(pt){Qe(a,a.return,pt)}}break;case 3:if(lg=null,w=ti,ti=og(c.containerInfo),mr(c,a),ti=w,gr(a),g&4&&f!==null&&f.memoizedState.isDehydrated)try{kd(c.containerInfo)}catch(pt){Qe(a,a.return,pt)}Jb&&(Jb=!1,e2(a));break;case 4:g=ti,ti=og(a.stateNode.containerInfo),mr(c,a),gr(a),ti=g;break;case 12:mr(c,a),gr(a);break;case 13:mr(c,a),gr(a),a.child.flags&8192&&a.memoizedState!==null!=(f!==null&&f.memoizedState!==null)&&(o1=me()),g&4&&(g=a.updateQueue,g!==null&&(a.updateQueue=null,t1(a,g)));break;case 22:w=a.memoizedState!==null;var q=f!==null&&f.memoizedState!==null,ht=_o,wt=_n;if(_o=ht||w,_n=wt||q,mr(c,a),_n=wt,_o=ht,gr(a),g&8192)t:for(c=a.stateNode,c._visibility=w?c._visibility&-2:c._visibility|1,w&&(f===null||q||_o||_n||Ml(a)),f=null,c=a;;){if(c.tag===5||c.tag===26){if(f===null){q=f=c;try{if(T=q.stateNode,w)F=T.style,typeof F.setProperty=="function"?F.setProperty("display","none","important"):F.display="none";else{z=q.stateNode;var Tt=q.memoizedProps.style,ft=Tt!=null&&Tt.hasOwnProperty("display")?Tt.display:null;z.style.display=ft==null||typeof ft=="boolean"?"":(""+ft).trim()}}catch(pt){Qe(q,q.return,pt)}}}else if(c.tag===6){if(f===null){q=c;try{q.stateNode.nodeValue=w?"":q.memoizedProps}catch(pt){Qe(q,q.return,pt)}}}else if((c.tag!==22&&c.tag!==23||c.memoizedState===null||c===a)&&c.child!==null){c.child.return=c,c=c.child;continue}if(c===a)break t;for(;c.sibling===null;){if(c.return===null||c.return===a)break t;f===c&&(f=null),c=c.return}f===c&&(f=null),c.sibling.return=c.return,c=c.sibling}g&4&&(g=a.updateQueue,g!==null&&(f=g.retryQueue,f!==null&&(g.retryQueue=null,t1(a,f))));break;case 19:mr(c,a),gr(a),g&4&&(g=a.updateQueue,g!==null&&(a.updateQueue=null,t1(a,g)));break;case 30:break;case 21:break;default:mr(c,a),gr(a)}}function gr(a){var c=a.flags;if(c&2){try{for(var f,g=a.return;g!==null;){if(jI(g)){f=g;break}g=g.return}if(f==null)throw Error(s(160));switch(f.tag){case 27:var w=f.stateNode,T=Qb(a);jm(a,T,w);break;case 5:var F=f.stateNode;f.flags&32&&(kr(F,""),f.flags&=-33);var z=Qb(a);jm(a,z,F);break;case 3:case 4:var q=f.stateNode.containerInfo,ht=Qb(a);Zb(a,ht,q);break;default:throw Error(s(161))}}catch(wt){Qe(a,a.return,wt)}a.flags&=-3}c&4096&&(a.flags&=-4097)}function e2(a){if(a.subtreeFlags&1024)for(a=a.child;a!==null;){var c=a;e2(c),c.tag===5&&c.flags&1024&&c.stateNode.reset(),a=a.sibling}}function ha(a,c){if(c.subtreeFlags&8772)for(c=c.child;c!==null;)YI(a,c.alternate,c),c=c.sibling}function Ml(a){for(a=a.child;a!==null;){var c=a;switch(c.tag){case 0:case 11:case 14:case 15:ca(4,c,c.return),Ml(c);break;case 1:Ai(c,c.return);var f=c.stateNode;typeof f.componentWillUnmount=="function"&&HI(c,c.return,f),Ml(c);break;case 27:vd(c.stateNode);case 26:case 5:Ai(c,c.return),Ml(c);break;case 22:c.memoizedState===null&&Ml(c);break;case 30:Ml(c);break;default:Ml(c)}a=a.sibling}}function da(a,c,f){for(f=f&&(c.subtreeFlags&8772)!==0,c=c.child;c!==null;){var g=c.alternate,w=a,T=c,F=T.flags;switch(T.tag){case 0:case 11:case 15:da(w,T,f),cd(4,T);break;case 1:if(da(w,T,f),g=T,w=g.stateNode,typeof w.componentDidMount=="function")try{w.componentDidMount()}catch(ht){Qe(g,g.return,ht)}if(g=T,w=g.updateQueue,w!==null){var z=g.stateNode;try{var q=w.shared.hiddenCallbacks;if(q!==null)for(w.shared.hiddenCallbacks=null,w=0;w<q.length;w++)NE(q[w],z)}catch(ht){Qe(g,g.return,ht)}}f&&F&64&&WI(T),hd(T,T.return);break;case 27:KI(T);case 26:case 5:da(w,T,f),f&&g===null&&F&4&&qI(T),hd(T,T.return);break;case 12:da(w,T,f);break;case 13:da(w,T,f),f&&F&4&&JI(w,T);break;case 22:T.memoizedState===null&&da(w,T,f),hd(T,T.return);break;case 30:break;default:da(w,T,f)}c=c.sibling}}function e1(a,c){var f=null;a!==null&&a.memoizedState!==null&&a.memoizedState.cachePool!==null&&(f=a.memoizedState.cachePool.pool),a=null,c.memoizedState!==null&&c.memoizedState.cachePool!==null&&(a=c.memoizedState.cachePool.pool),a!==f&&(a!=null&&a.refCount++,f!=null&&Yh(f))}function n1(a,c){a=null,c.alternate!==null&&(a=c.alternate.memoizedState.cache),c=c.memoizedState.cache,c!==a&&(c.refCount++,a!=null&&Yh(a))}function Ni(a,c,f,g){if(c.subtreeFlags&10256)for(c=c.child;c!==null;)n2(a,c,f,g),c=c.sibling}function n2(a,c,f,g){var w=c.flags;switch(c.tag){case 0:case 11:case 15:Ni(a,c,f,g),w&2048&&cd(9,c);break;case 1:Ni(a,c,f,g);break;case 3:Ni(a,c,f,g),w&2048&&(a=null,c.alternate!==null&&(a=c.alternate.memoizedState.cache),c=c.memoizedState.cache,c!==a&&(c.refCount++,a!=null&&Yh(a)));break;case 12:if(w&2048){Ni(a,c,f,g),a=c.stateNode;try{var T=c.memoizedProps,F=T.id,z=T.onPostCommit;typeof z=="function"&&z(F,c.alternate===null?"mount":"update",a.passiveEffectDuration,-0)}catch(q){Qe(c,c.return,q)}}else Ni(a,c,f,g);break;case 13:Ni(a,c,f,g);break;case 23:break;case 22:T=c.stateNode,F=c.alternate,c.memoizedState!==null?T._visibility&2?Ni(a,c,f,g):dd(a,c):T._visibility&2?Ni(a,c,f,g):(T._visibility|=2,ac(a,c,f,g,(c.subtreeFlags&10256)!==0)),w&2048&&e1(F,c);break;case 24:Ni(a,c,f,g),w&2048&&n1(c.alternate,c);break;default:Ni(a,c,f,g)}}function ac(a,c,f,g,w){for(w=w&&(c.subtreeFlags&10256)!==0,c=c.child;c!==null;){var T=a,F=c,z=f,q=g,ht=F.flags;switch(F.tag){case 0:case 11:case 15:ac(T,F,z,q,w),cd(8,F);break;case 23:break;case 22:var wt=F.stateNode;F.memoizedState!==null?wt._visibility&2?ac(T,F,z,q,w):dd(T,F):(wt._visibility|=2,ac(T,F,z,q,w)),w&&ht&2048&&e1(F.alternate,F);break;case 24:ac(T,F,z,q,w),w&&ht&2048&&n1(F.alternate,F);break;default:ac(T,F,z,q,w)}c=c.sibling}}function dd(a,c){if(c.subtreeFlags&10256)for(c=c.child;c!==null;){var f=a,g=c,w=g.flags;switch(g.tag){case 22:dd(f,g),w&2048&&e1(g.alternate,g);break;case 24:dd(f,g),w&2048&&n1(g.alternate,g);break;default:dd(f,g)}c=c.sibling}}var fd=8192;function lc(a){if(a.subtreeFlags&fd)for(a=a.child;a!==null;)s2(a),a=a.sibling}function s2(a){switch(a.tag){case 26:lc(a),a.flags&fd&&a.memoizedState!==null&&E4(ti,a.memoizedState,a.memoizedProps);break;case 5:lc(a);break;case 3:case 4:var c=ti;ti=og(a.stateNode.containerInfo),lc(a),ti=c;break;case 22:a.memoizedState===null&&(c=a.alternate,c!==null&&c.memoizedState!==null?(c=fd,fd=16777216,lc(a),fd=c):lc(a));break;default:lc(a)}}function r2(a){var c=a.alternate;if(c!==null&&(a=c.child,a!==null)){c.child=null;do c=a.sibling,a.sibling=null,a=c;while(a!==null)}}function pd(a){var c=a.deletions;if((a.flags&16)!==0){if(c!==null)for(var f=0;f<c.length;f++){var g=c[f];is=g,o2(g,a)}r2(a)}if(a.subtreeFlags&10256)for(a=a.child;a!==null;)i2(a),a=a.sibling}function i2(a){switch(a.tag){case 0:case 11:case 15:pd(a),a.flags&2048&&ca(9,a,a.return);break;case 3:pd(a);break;case 12:pd(a);break;case 22:var c=a.stateNode;a.memoizedState!==null&&c._visibility&2&&(a.return===null||a.return.tag!==13)?(c._visibility&=-3,Km(a)):pd(a);break;default:pd(a)}}function Km(a){var c=a.deletions;if((a.flags&16)!==0){if(c!==null)for(var f=0;f<c.length;f++){var g=c[f];is=g,o2(g,a)}r2(a)}for(a=a.child;a!==null;){switch(c=a,c.tag){case 0:case 11:case 15:ca(8,c,c.return),Km(c);break;case 22:f=c.stateNode,f._visibility&2&&(f._visibility&=-3,Km(c));break;default:Km(c)}a=a.sibling}}function o2(a,c){for(;is!==null;){var f=is;switch(f.tag){case 0:case 11:case 15:ca(8,f,c);break;case 23:case 22:if(f.memoizedState!==null&&f.memoizedState.cachePool!==null){var g=f.memoizedState.cachePool.pool;g!=null&&g.refCount++}break;case 24:Yh(f.memoizedState.cache)}if(g=f.child,g!==null)g.return=f,is=g;else t:for(f=a;is!==null;){g=is;var w=g.sibling,T=g.return;if(QI(g),g===f){is=null;break t}if(w!==null){w.return=T,is=w;break t}is=T}}}var BP={getCacheForType:function(a){var c=Ns(qn),f=c.data.get(a);return f===void 0&&(f=a(),c.data.set(a,f)),f}},UP=typeof WeakMap=="function"?WeakMap:Map,Ge=0,en=null,ge=null,Ie=0,We=0,yr=null,fa=!1,uc=!1,s1=!1,Ao=0,xn=0,pa=0,Fl=0,r1=0,Lr=0,cc=0,md=null,sr=null,i1=!1,o1=0,Xm=1/0,Ym=null,ma=null,xs=0,ga=null,hc=null,dc=0,a1=0,l1=null,a2=null,gd=0,u1=null;function xr(){if((Ge&2)!==0&&Ie!==0)return Ie&-Ie;if(W.T!==null){var a=Ju;return a!==0?a:g1()}return Qo()}function l2(){Lr===0&&(Lr=(Ie&536870912)===0||Le?Eh():536870912);var a=Fr.current;return a!==null&&(a.flags|=32),Lr}function br(a,c,f){(a===en&&(We===2||We===9)||a.cancelPendingCommit!==null)&&(fc(a,0),ya(a,Ie,Lr,!1)),oo(a,f),((Ge&2)===0||a!==en)&&(a===en&&((Ge&2)===0&&(Fl|=f),xn===4&&ya(a,Ie,Lr,!1)),Ri(a))}function u2(a,c,f){if((Ge&6)!==0)throw Error(s(327));var g=!f&&(c&124)===0&&(c&a.expiredLanes)===0||ll(a,c),w=g?HP(a,c):d1(a,c,!0),T=g;do{if(w===0){uc&&!g&&ya(a,c,0,!1);break}else{if(f=a.current.alternate,T&&!GP(f)){w=d1(a,c,!1),T=!1;continue}if(w===2){if(T=c,a.errorRecoveryDisabledLanes&T)var F=0;else F=a.pendingLanes&-536870913,F=F!==0?F:F&536870912?536870912:0;if(F!==0){c=F;t:{var z=a;w=md;var q=z.current.memoizedState.isDehydrated;if(q&&(fc(z,F).flags|=256),F=d1(z,F,!1),F!==2){if(s1&&!q){z.errorRecoveryDisabledLanes|=T,Fl|=T,w=4;break t}T=sr,sr=w,T!==null&&(sr===null?sr=T:sr.push.apply(sr,T))}w=F}if(T=!1,w!==2)continue}}if(w===1){fc(a,0),ya(a,c,0,!0);break}t:{switch(g=a,T=w,T){case 0:case 1:throw Error(s(345));case 4:if((c&4194048)!==c)break;case 6:ya(g,c,Lr,!fa);break t;case 2:sr=null;break;case 3:case 5:break;default:throw Error(s(329))}if((c&62914560)===c&&(w=o1+300-me(),10<w)){if(ya(g,c,Lr,!fa),Nu(g,0,!0)!==0)break t;g.timeoutHandle=P2(c2.bind(null,g,f,sr,Ym,i1,c,Lr,Fl,cc,fa,T,2,-0,0),w);break t}c2(g,f,sr,Ym,i1,c,Lr,Fl,cc,fa,T,0,-0,0)}}break}while(!0);Ri(a)}function c2(a,c,f,g,w,T,F,z,q,ht,wt,Tt,ft,pt){if(a.timeoutHandle=-1,Tt=c.subtreeFlags,(Tt&8192||(Tt&16785408)===16785408)&&(Sd={stylesheets:null,count:0,unsuspend:T4},s2(c),Tt=I4(),Tt!==null)){a.cancelPendingCommit=Tt(y2.bind(null,a,c,T,f,g,w,F,z,q,wt,1,ft,pt)),ya(a,T,F,!ht);return}y2(a,c,T,f,g,w,F,z,q)}function GP(a){for(var c=a;;){var f=c.tag;if((f===0||f===11||f===15)&&c.flags&16384&&(f=c.updateQueue,f!==null&&(f=f.stores,f!==null)))for(var g=0;g<f.length;g++){var w=f[g],T=w.getSnapshot;w=w.value;try{if(!fr(T(),w))return!1}catch{return!1}}if(f=c.child,c.subtreeFlags&16384&&f!==null)f.return=c,c=f;else{if(c===a)break;for(;c.sibling===null;){if(c.return===null||c.return===a)return!0;c=c.return}c.sibling.return=c.return,c=c.sibling}}return!0}function ya(a,c,f,g){c&=~r1,c&=~Fl,a.suspendedLanes|=c,a.pingedLanes&=~c,g&&(a.warmLanes|=c),g=a.expirationTimes;for(var w=c;0<w;){var T=31-gn(w),F=1<<T;g[T]=-1,w&=~F}f!==0&&gi(a,f,c)}function Qm(){return(Ge&6)===0?(yd(0),!1):!0}function c1(){if(ge!==null){if(We===0)var a=ge.return;else a=ge,wo=Nl=null,_b(a),ic=null,ad=0,a=ge;for(;a!==null;)GI(a.alternate,a),a=a.return;ge=null}}function fc(a,c){var f=a.timeoutHandle;f!==-1&&(a.timeoutHandle=-1,a4(f)),f=a.cancelPendingCommit,f!==null&&(a.cancelPendingCommit=null,f()),c1(),en=a,ge=f=xo(a.current,null),Ie=c,We=0,yr=null,fa=!1,uc=ll(a,c),s1=!1,cc=Lr=r1=Fl=pa=xn=0,sr=md=null,i1=!1,(c&8)!==0&&(c|=c&32);var g=a.entangledLanes;if(g!==0)for(a=a.entanglements,g&=c;0<g;){var w=31-gn(g),T=1<<w;c|=a[w],g&=~T}return Ao=c,bm(),f}function h2(a,c){ce=null,W.H=Pm,c===Zh||c===km?(c=kE(),We=3):c===EE?(c=kE(),We=4):We=c===AI?8:c!==null&&typeof c=="object"&&typeof c.then=="function"?6:1,yr=c,ge===null&&(xn=1,Gm(a,$r(c,a.current)))}function d2(){var a=W.H;return W.H=Pm,a===null?Pm:a}function f2(){var a=W.A;return W.A=BP,a}function h1(){xn=4,fa||(Ie&4194048)!==Ie&&Fr.current!==null||(uc=!0),(pa&134217727)===0&&(Fl&134217727)===0||en===null||ya(en,Ie,Lr,!1)}function d1(a,c,f){var g=Ge;Ge|=2;var w=d2(),T=f2();(en!==a||Ie!==c)&&(Ym=null,fc(a,c)),c=!1;var F=xn;t:do try{if(We!==0&&ge!==null){var z=ge,q=yr;switch(We){case 8:c1(),F=6;break t;case 3:case 2:case 9:case 6:Fr.current===null&&(c=!0);var ht=We;if(We=0,yr=null,pc(a,z,q,ht),f&&uc){F=0;break t}break;default:ht=We,We=0,yr=null,pc(a,z,q,ht)}}WP(),F=xn;break}catch(wt){h2(a,wt)}while(!0);return c&&a.shellSuspendCounter++,wo=Nl=null,Ge=g,W.H=w,W.A=T,ge===null&&(en=null,Ie=0,bm()),F}function WP(){for(;ge!==null;)p2(ge)}function HP(a,c){var f=Ge;Ge|=2;var g=d2(),w=f2();en!==a||Ie!==c?(Ym=null,Xm=me()+500,fc(a,c)):uc=ll(a,c);t:do try{if(We!==0&&ge!==null){c=ge;var T=yr;e:switch(We){case 1:We=0,yr=null,pc(a,c,T,1);break;case 2:case 9:if(IE(T)){We=0,yr=null,m2(c);break}c=function(){We!==2&&We!==9||en!==a||(We=7),Ri(a)},T.then(c,c);break t;case 3:We=7;break t;case 4:We=5;break t;case 7:IE(T)?(We=0,yr=null,m2(c)):(We=0,yr=null,pc(a,c,T,7));break;case 5:var F=null;switch(ge.tag){case 26:F=ge.memoizedState;case 5:case 27:var z=ge;if(!F||Y2(F)){We=0,yr=null;var q=z.sibling;if(q!==null)ge=q;else{var ht=z.return;ht!==null?(ge=ht,Zm(ht)):ge=null}break e}}We=0,yr=null,pc(a,c,T,5);break;case 6:We=0,yr=null,pc(a,c,T,6);break;case 8:c1(),xn=6;break t;default:throw Error(s(462))}}qP();break}catch(wt){h2(a,wt)}while(!0);return wo=Nl=null,W.H=g,W.A=w,Ge=f,ge!==null?0:(en=null,Ie=0,bm(),xn)}function qP(){for(;ge!==null&&!Ne();)p2(ge)}function p2(a){var c=BI(a.alternate,a,Ao);a.memoizedProps=a.pendingProps,c===null?Zm(a):ge=c}function m2(a){var c=a,f=c.alternate;switch(c.tag){case 15:case 0:c=MI(f,c,c.pendingProps,c.type,void 0,Ie);break;case 11:c=MI(f,c,c.pendingProps,c.type.render,c.ref,Ie);break;case 5:_b(c);default:GI(f,c),c=ge=gE(c,Ao),c=BI(f,c,Ao)}a.memoizedProps=a.pendingProps,c===null?Zm(a):ge=c}function pc(a,c,f,g){wo=Nl=null,_b(c),ic=null,ad=0;var w=c.return;try{if(MP(a,w,c,f,Ie)){xn=1,Gm(a,$r(f,a.current)),ge=null;return}}catch(T){if(w!==null)throw ge=w,T;xn=1,Gm(a,$r(f,a.current)),ge=null;return}c.flags&32768?(Le||g===1?a=!0:uc||(Ie&536870912)!==0?a=!1:(fa=a=!0,(g===2||g===9||g===3||g===6)&&(g=Fr.current,g!==null&&g.tag===13&&(g.flags|=16384))),g2(c,a)):Zm(c)}function Zm(a){var c=a;do{if((c.flags&32768)!==0){g2(c,fa);return}a=c.return;var f=LP(c.alternate,c,Ao);if(f!==null){ge=f;return}if(c=c.sibling,c!==null){ge=c;return}ge=c=a}while(c!==null);xn===0&&(xn=5)}function g2(a,c){do{var f=PP(a.alternate,a);if(f!==null){f.flags&=32767,ge=f;return}if(f=a.return,f!==null&&(f.flags|=32768,f.subtreeFlags=0,f.deletions=null),!c&&(a=a.sibling,a!==null)){ge=a;return}ge=a=f}while(a!==null);xn=6,ge=null}function y2(a,c,f,g,w,T,F,z,q){a.cancelPendingCommit=null;do Jm();while(xs!==0);if((Ge&6)!==0)throw Error(s(327));if(c!==null){if(c===a.current)throw Error(s(177));if(T=c.lanes|c.childLanes,T|=nb,_h(a,f,T,F,z,q),a===en&&(ge=en=null,Ie=0),hc=c,ga=a,dc=f,a1=T,l1=w,a2=g,(c.subtreeFlags&10256)!==0||(c.flags&10256)!==0?(a.callbackNode=null,a.callbackPriority=0,YP(As,function(){return C2(),null})):(a.callbackNode=null,a.callbackPriority=0),g=(c.flags&13878)!==0,(c.subtreeFlags&13878)!==0||g){g=W.T,W.T=null,w=K.p,K.p=2,F=Ge,Ge|=4;try{VP(a,c,f)}finally{Ge=F,K.p=w,W.T=g}}xs=1,x2(),b2(),v2()}}function x2(){if(xs===1){xs=0;var a=ga,c=hc,f=(c.flags&13878)!==0;if((c.subtreeFlags&13878)!==0||f){f=W.T,W.T=null;var g=K.p;K.p=2;var w=Ge;Ge|=4;try{t2(c,a);var T=T1,F=oE(a.containerInfo),z=T.focusedElem,q=T.selectionRange;if(F!==z&&z&&z.ownerDocument&&iE(z.ownerDocument.documentElement,z)){if(q!==null&&Qx(z)){var ht=q.start,wt=q.end;if(wt===void 0&&(wt=ht),"selectionStart"in z)z.selectionStart=ht,z.selectionEnd=Math.min(wt,z.value.length);else{var Tt=z.ownerDocument||document,ft=Tt&&Tt.defaultView||window;if(ft.getSelection){var pt=ft.getSelection(),te=z.textContent.length,Xt=Math.min(q.start,te),Xe=q.end===void 0?Xt:Math.min(q.end,te);!pt.extend&&Xt>Xe&&(F=Xe,Xe=Xt,Xt=F);var ot=rE(z,Xt),Q=rE(z,Xe);if(ot&&Q&&(pt.rangeCount!==1||pt.anchorNode!==ot.node||pt.anchorOffset!==ot.offset||pt.focusNode!==Q.node||pt.focusOffset!==Q.offset)){var ut=Tt.createRange();ut.setStart(ot.node,ot.offset),pt.removeAllRanges(),Xt>Xe?(pt.addRange(ut),pt.extend(Q.node,Q.offset)):(ut.setEnd(Q.node,Q.offset),pt.addRange(ut))}}}}for(Tt=[],pt=z;pt=pt.parentNode;)pt.nodeType===1&&Tt.push({element:pt,left:pt.scrollLeft,top:pt.scrollTop});for(typeof z.focus=="function"&&z.focus(),z=0;z<Tt.length;z++){var St=Tt[z];St.element.scrollLeft=St.left,St.element.scrollTop=St.top}}hg=!!S1,T1=S1=null}finally{Ge=w,K.p=g,W.T=f}}a.current=c,xs=2}}function b2(){if(xs===2){xs=0;var a=ga,c=hc,f=(c.flags&8772)!==0;if((c.subtreeFlags&8772)!==0||f){f=W.T,W.T=null;var g=K.p;K.p=2;var w=Ge;Ge|=4;try{YI(a,c.alternate,c)}finally{Ge=w,K.p=g,W.T=f}}xs=3}}function v2(){if(xs===4||xs===3){xs=0,Se();var a=ga,c=hc,f=dc,g=a2;(c.subtreeFlags&10256)!==0||(c.flags&10256)!==0?xs=5:(xs=0,hc=ga=null,w2(a,a.pendingLanes));var w=a.pendingLanes;if(w===0&&(ma=null),Ru(f),c=c.stateNode,fe&&typeof fe.onCommitFiberRoot=="function")try{fe.onCommitFiberRoot(Fe,c,void 0,(c.current.flags&128)===128)}catch{}if(g!==null){c=W.T,w=K.p,K.p=2,W.T=null;try{for(var T=a.onRecoverableError,F=0;F<g.length;F++){var z=g[F];T(z.value,{componentStack:z.stack})}}finally{W.T=c,K.p=w}}(dc&3)!==0&&Jm(),Ri(a),w=a.pendingLanes,(f&4194090)!==0&&(w&42)!==0?a===u1?gd++:(gd=0,u1=a):gd=0,yd(0)}}function w2(a,c){(a.pooledCacheLanes&=c)===0&&(c=a.pooledCache,c!=null&&(a.pooledCache=null,Yh(c)))}function Jm(a){return x2(),b2(),v2(),C2()}function C2(){if(xs!==5)return!1;var a=ga,c=a1;a1=0;var f=Ru(dc),g=W.T,w=K.p;try{K.p=32>f?32:f,W.T=null,f=l1,l1=null;var T=ga,F=dc;if(xs=0,hc=ga=null,dc=0,(Ge&6)!==0)throw Error(s(331));var z=Ge;if(Ge|=4,i2(T.current),n2(T,T.current,F,f),Ge=z,yd(0,!1),fe&&typeof fe.onPostCommitFiberRoot=="function")try{fe.onPostCommitFiberRoot(Fe,T)}catch{}return!0}finally{K.p=w,W.T=g,w2(a,c)}}function S2(a,c,f){c=$r(f,c),c=Bb(a.stateNode,c,2),a=oa(a,c,2),a!==null&&(oo(a,2),Ri(a))}function Qe(a,c,f){if(a.tag===3)S2(a,a,f);else for(;c!==null;){if(c.tag===3){S2(c,a,f);break}else if(c.tag===1){var g=c.stateNode;if(typeof c.type.getDerivedStateFromError=="function"||typeof g.componentDidCatch=="function"&&(ma===null||!ma.has(g))){a=$r(f,a),f=_I(2),g=oa(c,f,2),g!==null&&(kI(f,g,c,a),oo(g,2),Ri(g));break}}c=c.return}}function f1(a,c,f){var g=a.pingCache;if(g===null){g=a.pingCache=new UP;var w=new Set;g.set(c,w)}else w=g.get(c),w===void 0&&(w=new Set,g.set(c,w));w.has(f)||(s1=!0,w.add(f),a=jP.bind(null,a,c,f),c.then(a,a))}function jP(a,c,f){var g=a.pingCache;g!==null&&g.delete(c),a.pingedLanes|=a.suspendedLanes&f,a.warmLanes&=~f,en===a&&(Ie&f)===f&&(xn===4||xn===3&&(Ie&62914560)===Ie&&300>me()-o1?(Ge&2)===0&&fc(a,0):r1|=f,cc===Ie&&(cc=0)),Ri(a)}function T2(a,c){c===0&&(c=Ih()),a=Xu(a,c),a!==null&&(oo(a,c),Ri(a))}function KP(a){var c=a.memoizedState,f=0;c!==null&&(f=c.retryLane),T2(a,f)}function XP(a,c){var f=0;switch(a.tag){case 13:var g=a.stateNode,w=a.memoizedState;w!==null&&(f=w.retryLane);break;case 19:g=a.stateNode;break;case 22:g=a.stateNode._retryCache;break;default:throw Error(s(314))}g!==null&&g.delete(c),T2(a,f)}function YP(a,c){return be(a,c)}var tg=null,mc=null,p1=!1,eg=!1,m1=!1,Ll=0;function Ri(a){a!==mc&&a.next===null&&(mc===null?tg=mc=a:mc=mc.next=a),eg=!0,p1||(p1=!0,ZP())}function yd(a,c){if(!m1&&eg){m1=!0;do for(var f=!1,g=tg;g!==null;){if(a!==0){var w=g.pendingLanes;if(w===0)var T=0;else{var F=g.suspendedLanes,z=g.pingedLanes;T=(1<<31-gn(42|a)+1)-1,T&=w&~(F&~z),T=T&201326741?T&201326741|1:T?T|2:0}T!==0&&(f=!0,k2(g,T))}else T=Ie,T=Nu(g,g===en?T:0,g.cancelPendingCommit!==null||g.timeoutHandle!==-1),(T&3)===0||ll(g,T)||(f=!0,k2(g,T));g=g.next}while(f);m1=!1}}function QP(){E2()}function E2(){eg=p1=!1;var a=0;Ll!==0&&(o4()&&(a=Ll),Ll=0);for(var c=me(),f=null,g=tg;g!==null;){var w=g.next,T=I2(g,c);T===0?(g.next=null,f===null?tg=w:f.next=w,w===null&&(mc=f)):(f=g,(a!==0||(T&3)!==0)&&(eg=!0)),g=w}yd(a)}function I2(a,c){for(var f=a.suspendedLanes,g=a.pingedLanes,w=a.expirationTimes,T=a.pendingLanes&-62914561;0<T;){var F=31-gn(T),z=1<<F,q=w[F];q===-1?((z&f)===0||(z&g)!==0)&&(w[F]=Th(z,c)):q<=c&&(a.expiredLanes|=z),T&=~z}if(c=en,f=Ie,f=Nu(a,a===c?f:0,a.cancelPendingCommit!==null||a.timeoutHandle!==-1),g=a.callbackNode,f===0||a===c&&(We===2||We===9)||a.cancelPendingCommit!==null)return g!==null&&g!==null&&Me(g),a.callbackNode=null,a.callbackPriority=0;if((f&3)===0||ll(a,f)){if(c=f&-f,c===a.callbackPriority)return c;switch(g!==null&&Me(g),Ru(f)){case 2:case 8:f=sn;break;case 32:f=As;break;case 268435456:f=Js;break;default:f=As}return g=_2.bind(null,a),f=be(f,g),a.callbackPriority=c,a.callbackNode=f,c}return g!==null&&g!==null&&Me(g),a.callbackPriority=2,a.callbackNode=null,2}function _2(a,c){if(xs!==0&&xs!==5)return a.callbackNode=null,a.callbackPriority=0,null;var f=a.callbackNode;if(Jm()&&a.callbackNode!==f)return null;var g=Ie;return g=Nu(a,a===en?g:0,a.cancelPendingCommit!==null||a.timeoutHandle!==-1),g===0?null:(u2(a,g,c),I2(a,me()),a.callbackNode!=null&&a.callbackNode===f?_2.bind(null,a):null)}function k2(a,c){if(Jm())return null;u2(a,c,!0)}function ZP(){l4(function(){(Ge&6)!==0?be(Bs,QP):E2()})}function g1(){return Ll===0&&(Ll=Eh()),Ll}function A2(a){return a==null||typeof a=="symbol"||typeof a=="boolean"?null:typeof a=="function"?a:Lu(""+a)}function N2(a,c){var f=c.ownerDocument.createElement("input");return f.name=c.name,f.value=c.value,a.id&&f.setAttribute("form",a.id),c.parentNode.insertBefore(f,c),a=new FormData(a),f.parentNode.removeChild(f),a}function JP(a,c,f,g,w){if(c==="submit"&&f&&f.stateNode===w){var T=A2((w[Rn]||null).action),F=g.submitter;F&&(c=(c=F[Rn]||null)?A2(c.formAction):F.getAttribute("formAction"),c!==null&&(T=c,F=null));var z=new Pu("action","action",null,g,w);a.push({event:z,listeners:[{instance:null,listener:function(){if(g.defaultPrevented){if(Ll!==0){var q=F?N2(w,F):new FormData(w);Fb(f,{pending:!0,data:q,method:w.method,action:T},null,q)}}else typeof T=="function"&&(z.preventDefault(),q=F?N2(w,F):new FormData(w),Fb(f,{pending:!0,data:q,method:w.method,action:T},T,q))},currentTarget:w}]})}}for(var y1=0;y1<eb.length;y1++){var x1=eb[y1],t4=x1.toLowerCase(),e4=x1[0].toUpperCase()+x1.slice(1);Jr(t4,"on"+e4)}Jr(uE,"onAnimationEnd"),Jr(cE,"onAnimationIteration"),Jr(hE,"onAnimationStart"),Jr("dblclick","onDoubleClick"),Jr("focusin","onFocus"),Jr("focusout","onBlur"),Jr(xP,"onTransitionRun"),Jr(bP,"onTransitionStart"),Jr(vP,"onTransitionCancel"),Jr(dE,"onTransitionEnd"),lo("onMouseEnter",["mouseout","mouseover"]),lo("onMouseLeave",["mouseout","mouseover"]),lo("onPointerEnter",["pointerout","pointerover"]),lo("onPointerLeave",["pointerout","pointerover"]),Qr("onChange","change click focusin focusout input keydown keyup selectionchange".split(" ")),Qr("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" ")),Qr("onBeforeInput",["compositionend","keypress","textInput","paste"]),Qr("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" ")),Qr("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" ")),Qr("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var xd="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),n4=new Set("beforetoggle cancel close invalid load scroll scrollend toggle".split(" ").concat(xd));function R2(a,c){c=(c&4)!==0;for(var f=0;f<a.length;f++){var g=a[f],w=g.event;g=g.listeners;t:{var T=void 0;if(c)for(var F=g.length-1;0<=F;F--){var z=g[F],q=z.instance,ht=z.currentTarget;if(z=z.listener,q!==T&&w.isPropagationStopped())break t;T=z,w.currentTarget=ht;try{T(w)}catch(wt){Um(wt)}w.currentTarget=null,T=q}else for(F=0;F<g.length;F++){if(z=g[F],q=z.instance,ht=z.currentTarget,z=z.listener,q!==T&&w.isPropagationStopped())break t;T=z,w.currentTarget=ht;try{T(w)}catch(wt){Um(wt)}w.currentTarget=null,T=q}}}}function ye(a,c){var f=c[Ah];f===void 0&&(f=c[Ah]=new Set);var g=a+"__bubble";f.has(g)||($2(c,a,2,!1),f.add(g))}function b1(a,c,f){var g=0;c&&(g|=4),$2(f,a,g,c)}var ng="_reactListening"+Math.random().toString(36).slice(2);function v1(a){if(!a[ng]){a[ng]=!0,Nh.forEach(function(f){f!=="selectionchange"&&(n4.has(f)||b1(f,!1,a),b1(f,!0,a))});var c=a.nodeType===9?a:a.ownerDocument;c===null||c[ng]||(c[ng]=!0,b1("selectionchange",!1,c))}}function $2(a,c,f,g){switch(n_(c)){case 2:var w=A4;break;case 8:w=N4;break;default:w=O1}f=w.bind(null,c,f,a),w=void 0,!Nr||c!=="touchstart"&&c!=="touchmove"&&c!=="wheel"||(w=!0),g?w!==void 0?a.addEventListener(c,f,{capture:!0,passive:w}):a.addEventListener(c,f,!0):w!==void 0?a.addEventListener(c,f,{passive:w}):a.addEventListener(c,f,!1)}function w1(a,c,f,g,w){var T=g;if((c&1)===0&&(c&2)===0&&g!==null)t:for(;;){if(g===null)return;var F=g.tag;if(F===3||F===4){var z=g.stateNode.containerInfo;if(z===w)break;if(F===4)for(F=g.return;F!==null;){var q=F.tag;if((q===3||q===4)&&F.stateNode.containerInfo===w)return;F=F.return}for(;z!==null;){if(F=ao(z),F===null)return;if(q=F.tag,q===5||q===6||q===26||q===27){g=T=F;continue t}z=z.parentNode}}g=g.return}rm(function(){var ht=T,wt=Ar(f),Tt=[];t:{var ft=fE.get(a);if(ft!==void 0){var pt=Pu,te=a;switch(a){case"keypress":if(Ci(f)===0)break t;case"keydown":case"keyup":pt=Wu;break;case"focusin":te="focus",pt=Bu;break;case"focusout":te="blur",pt=Bu;break;case"beforeblur":case"afterblur":pt=Bu;break;case"click":if(f.button===2)break t;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":pt=Rr;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":pt=jx;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":pt=dm;break;case uE:case cE:case hE:pt=Uu;break;case dE:pt=pm;break;case"scroll":case"scrollend":pt=im;break;case"wheel":pt=Hu;break;case"copy":case"cut":case"paste":pt=Gu;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":pt=Uh;break;case"toggle":case"beforetoggle":pt=gm}var Xt=(c&4)!==0,Xe=!Xt&&(a==="scroll"||a==="scrollend"),ot=Xt?ft!==null?ft+"Capture":null:ft;Xt=[];for(var Q=ht,ut;Q!==null;){var St=Q;if(ut=St.stateNode,St=St.tag,St!==5&&St!==26&&St!==27||ut===null||ot===null||(St=gl(Q,ot),St!=null&&Xt.push(bd(Q,St,ut))),Xe)break;Q=Q.return}0<Xt.length&&(ft=new pt(ft,te,null,f,wt),Tt.push({event:ft,listeners:Xt}))}}if((c&7)===0){t:{if(ft=a==="mouseover"||a==="pointerover",pt=a==="mouseout"||a==="pointerout",ft&&f!==ho&&(te=f.relatedTarget||f.fromElement)&&(ao(te)||te[_r]))break t;if((pt||ft)&&(ft=wt.window===wt?wt:(ft=wt.ownerDocument)?ft.defaultView||ft.parentWindow:window,pt?(te=f.relatedTarget||f.toElement,pt=ht,te=te?ao(te):null,te!==null&&(Xe=i(te),Xt=te.tag,te!==Xe||Xt!==5&&Xt!==27&&Xt!==6)&&(te=null)):(pt=null,te=ht),pt!==te)){if(Xt=Rr,St="onMouseLeave",ot="onMouseEnter",Q="mouse",(a==="pointerout"||a==="pointerover")&&(Xt=Uh,St="onPointerLeave",ot="onPointerEnter",Q="pointer"),Xe=pt==null?ft:xi(pt),ut=te==null?ft:xi(te),ft=new Xt(St,Q+"leave",pt,f,wt),ft.target=Xe,ft.relatedTarget=ut,St=null,ao(wt)===ht&&(Xt=new Xt(ot,Q+"enter",te,f,wt),Xt.target=ut,Xt.relatedTarget=Xe,St=Xt),Xe=St,pt&&te)e:{for(Xt=pt,ot=te,Q=0,ut=Xt;ut;ut=gc(ut))Q++;for(ut=0,St=ot;St;St=gc(St))ut++;for(;0<Q-ut;)Xt=gc(Xt),Q--;for(;0<ut-Q;)ot=gc(ot),ut--;for(;Q--;){if(Xt===ot||ot!==null&&Xt===ot.alternate)break e;Xt=gc(Xt),ot=gc(ot)}Xt=null}else Xt=null;pt!==null&&D2(Tt,ft,pt,Xt,!1),te!==null&&Xe!==null&&D2(Tt,Xe,te,Xt,!0)}}t:{if(ft=ht?xi(ht):window,pt=ft.nodeName&&ft.nodeName.toLowerCase(),pt==="select"||pt==="input"&&ft.type==="file")var Pt=ZT;else if(Hn(ft))if(JT)Pt=mP;else{Pt=fP;var pe=dP}else pt=ft.nodeName,!pt||pt.toLowerCase()!=="input"||ft.type!=="checkbox"&&ft.type!=="radio"?ht&&Mh(ht.elementType)&&(Pt=ZT):Pt=pP;if(Pt&&(Pt=Pt(a,ht))){yo(Tt,Pt,f,wt);break t}pe&&pe(a,ft,ht),a==="focusout"&&ht&&ft.type==="number"&&ht.memoizedProps.value!=null&&ea(ft,"number",ft.value)}switch(pe=ht?xi(ht):window,a){case"focusin":(Hn(pe)||pe.contentEditable==="true")&&(qu=pe,Zx=ht,Hh=null);break;case"focusout":Hh=Zx=qu=null;break;case"mousedown":Jx=!0;break;case"contextmenu":case"mouseup":case"dragend":Jx=!1,aE(Tt,f,wt);break;case"selectionchange":if(yP)break;case"keydown":case"keyup":aE(Tt,f,wt)}var Bt;if(Ei)t:{switch(a){case"compositionstart":var Qt="onCompositionStart";break t;case"compositionend":Qt="onCompositionEnd";break t;case"compositionupdate":Qt="onCompositionUpdate";break t}Qt=void 0}else Te?gt(a,f)&&(Qt="onCompositionEnd"):a==="keydown"&&f.keyCode===229&&(Qt="onCompositionStart");Qt&&(M&&f.locale!=="ko"&&(Te||Qt!=="onCompositionStart"?Qt==="onCompositionEnd"&&Te&&(Bt=Lh()):(wi=wt,na="value"in wi?wi.value:wi.textContent,Te=!0)),pe=sg(ht,Qt),0<pe.length&&(Qt=new zh(Qt,a,null,f,wt),Tt.push({event:Qt,listeners:pe}),Bt?Qt.data=Bt:(Bt=At(f),Bt!==null&&(Qt.data=Bt)))),(Bt=k?Wn(a,f):Ee(a,f))&&(Qt=sg(ht,"onBeforeInput"),0<Qt.length&&(pe=new zh("onBeforeInput","beforeinput",null,f,wt),Tt.push({event:pe,listeners:Qt}),pe.data=Bt)),JP(Tt,a,ht,f,wt)}R2(Tt,c)})}function bd(a,c,f){return{instance:a,listener:c,currentTarget:f}}function sg(a,c){for(var f=c+"Capture",g=[];a!==null;){var w=a,T=w.stateNode;if(w=w.tag,w!==5&&w!==26&&w!==27||T===null||(w=gl(a,f),w!=null&&g.unshift(bd(a,w,T)),w=gl(a,c),w!=null&&g.push(bd(a,w,T))),a.tag===3)return g;a=a.return}return[]}function gc(a){if(a===null)return null;do a=a.return;while(a&&a.tag!==5&&a.tag!==27);return a||null}function D2(a,c,f,g,w){for(var T=c._reactName,F=[];f!==null&&f!==g;){var z=f,q=z.alternate,ht=z.stateNode;if(z=z.tag,q!==null&&q===g)break;z!==5&&z!==26&&z!==27||ht===null||(q=ht,w?(ht=gl(f,T),ht!=null&&F.unshift(bd(f,ht,q))):w||(ht=gl(f,T),ht!=null&&F.push(bd(f,ht,q)))),f=f.return}F.length!==0&&a.push({event:c,listeners:F})}var s4=/\r\n?/g,r4=/\u0000|\uFFFD/g;function O2(a){return(typeof a=="string"?a:""+a).replace(s4,`
`).replace(r4,"")}function M2(a,c){return c=O2(c),O2(a)===c}function rg(){}function Ke(a,c,f,g,w,T){switch(f){case"children":typeof g=="string"?c==="body"||c==="textarea"&&g===""||kr(a,g):(typeof g=="number"||typeof g=="bigint")&&c!=="body"&&kr(a,""+g);break;case"className":bi(a,"class",g);break;case"tabIndex":bi(a,"tabindex",g);break;case"dir":case"role":case"viewBox":case"width":case"height":bi(a,f,g);break;case"style":Oh(a,g,T);break;case"data":if(c!=="object"){bi(a,"data",g);break}case"src":case"href":if(g===""&&(c!=="a"||f!=="href")){a.removeAttribute(f);break}if(g==null||typeof g=="function"||typeof g=="symbol"||typeof g=="boolean"){a.removeAttribute(f);break}g=Lu(""+g),a.setAttribute(f,g);break;case"action":case"formAction":if(typeof g=="function"){a.setAttribute(f,"javascript:throw new Error('A React form was unexpectedly submitted. If you called form.submit() manually, consider using form.requestSubmit() instead. If you\\'re trying to use event.stopPropagation() in a submit event handler, consider also calling event.preventDefault().')");break}else typeof T=="function"&&(f==="formAction"?(c!=="input"&&Ke(a,c,"name",w.name,w,null),Ke(a,c,"formEncType",w.formEncType,w,null),Ke(a,c,"formMethod",w.formMethod,w,null),Ke(a,c,"formTarget",w.formTarget,w,null)):(Ke(a,c,"encType",w.encType,w,null),Ke(a,c,"method",w.method,w,null),Ke(a,c,"target",w.target,w,null)));if(g==null||typeof g=="symbol"||typeof g=="boolean"){a.removeAttribute(f);break}g=Lu(""+g),a.setAttribute(f,g);break;case"onClick":g!=null&&(a.onclick=rg);break;case"onScroll":g!=null&&ye("scroll",a);break;case"onScrollEnd":g!=null&&ye("scrollend",a);break;case"dangerouslySetInnerHTML":if(g!=null){if(typeof g!="object"||!("__html"in g))throw Error(s(61));if(f=g.__html,f!=null){if(w.children!=null)throw Error(s(60));a.innerHTML=f}}break;case"multiple":a.multiple=g&&typeof g!="function"&&typeof g!="symbol";break;case"muted":a.muted=g&&typeof g!="function"&&typeof g!="symbol";break;case"suppressContentEditableWarning":case"suppressHydrationWarning":case"defaultValue":case"defaultChecked":case"innerHTML":case"ref":break;case"autoFocus":break;case"xlinkHref":if(g==null||typeof g=="function"||typeof g=="boolean"||typeof g=="symbol"){a.removeAttribute("xlink:href");break}f=Lu(""+g),a.setAttributeNS("http://www.w3.org/1999/xlink","xlink:href",f);break;case"contentEditable":case"spellCheck":case"draggable":case"value":case"autoReverse":case"externalResourcesRequired":case"focusable":case"preserveAlpha":g!=null&&typeof g!="function"&&typeof g!="symbol"?a.setAttribute(f,""+g):a.removeAttribute(f);break;case"inert":case"allowFullScreen":case"async":case"autoPlay":case"controls":case"default":case"defer":case"disabled":case"disablePictureInPicture":case"disableRemotePlayback":case"formNoValidate":case"hidden":case"loop":case"noModule":case"noValidate":case"open":case"playsInline":case"readOnly":case"required":case"reversed":case"scoped":case"seamless":case"itemScope":g&&typeof g!="function"&&typeof g!="symbol"?a.setAttribute(f,""):a.removeAttribute(f);break;case"capture":case"download":g===!0?a.setAttribute(f,""):g!==!1&&g!=null&&typeof g!="function"&&typeof g!="symbol"?a.setAttribute(f,g):a.removeAttribute(f);break;case"cols":case"rows":case"size":case"span":g!=null&&typeof g!="function"&&typeof g!="symbol"&&!isNaN(g)&&1<=g?a.setAttribute(f,g):a.removeAttribute(f);break;case"rowSpan":case"start":g==null||typeof g=="function"||typeof g=="symbol"||isNaN(g)?a.removeAttribute(f):a.setAttribute(f,g);break;case"popover":ye("beforetoggle",a),ye("toggle",a),ta(a,"popover",g);break;case"xlinkActuate":ms(a,"http://www.w3.org/1999/xlink","xlink:actuate",g);break;case"xlinkArcrole":ms(a,"http://www.w3.org/1999/xlink","xlink:arcrole",g);break;case"xlinkRole":ms(a,"http://www.w3.org/1999/xlink","xlink:role",g);break;case"xlinkShow":ms(a,"http://www.w3.org/1999/xlink","xlink:show",g);break;case"xlinkTitle":ms(a,"http://www.w3.org/1999/xlink","xlink:title",g);break;case"xlinkType":ms(a,"http://www.w3.org/1999/xlink","xlink:type",g);break;case"xmlBase":ms(a,"http://www.w3.org/XML/1998/namespace","xml:base",g);break;case"xmlLang":ms(a,"http://www.w3.org/XML/1998/namespace","xml:lang",g);break;case"xmlSpace":ms(a,"http://www.w3.org/XML/1998/namespace","xml:space",g);break;case"is":ta(a,"is",g);break;case"innerText":case"textContent":break;default:(!(2<f.length)||f[0]!=="o"&&f[0]!=="O"||f[1]!=="n"&&f[1]!=="N")&&(f=Hx.get(f)||f,ta(a,f,g))}}function C1(a,c,f,g,w,T){switch(f){case"style":Oh(a,g,T);break;case"dangerouslySetInnerHTML":if(g!=null){if(typeof g!="object"||!("__html"in g))throw Error(s(61));if(f=g.__html,f!=null){if(w.children!=null)throw Error(s(60));a.innerHTML=f}}break;case"children":typeof g=="string"?kr(a,g):(typeof g=="number"||typeof g=="bigint")&&kr(a,""+g);break;case"onScroll":g!=null&&ye("scroll",a);break;case"onScrollEnd":g!=null&&ye("scrollend",a);break;case"onClick":g!=null&&(a.onclick=rg);break;case"suppressContentEditableWarning":case"suppressHydrationWarning":case"innerHTML":case"ref":break;case"innerText":case"textContent":break;default:if(!$u.hasOwnProperty(f))t:{if(f[0]==="o"&&f[1]==="n"&&(w=f.endsWith("Capture"),c=f.slice(2,w?f.length-7:void 0),T=a[Rn]||null,T=T!=null?T[f]:null,typeof T=="function"&&a.removeEventListener(c,T,w),typeof g=="function")){typeof T!="function"&&T!==null&&(f in a?a[f]=null:a.hasAttribute(f)&&a.removeAttribute(f)),a.addEventListener(c,g,w);break t}f in a?a[f]=g:g===!0?a.setAttribute(f,""):ta(a,f,g)}}}function bs(a,c,f){switch(c){case"div":case"span":case"svg":case"path":case"a":case"g":case"p":case"li":break;case"img":ye("error",a),ye("load",a);var g=!1,w=!1,T;for(T in f)if(f.hasOwnProperty(T)){var F=f[T];if(F!=null)switch(T){case"src":g=!0;break;case"srcSet":w=!0;break;case"children":case"dangerouslySetInnerHTML":throw Error(s(137,c));default:Ke(a,c,T,F,f,null)}}w&&Ke(a,c,"srcSet",f.srcSet,f,null),g&&Ke(a,c,"src",f.src,f,null);return;case"input":ye("invalid",a);var z=T=F=w=null,q=null,ht=null;for(g in f)if(f.hasOwnProperty(g)){var wt=f[g];if(wt!=null)switch(g){case"name":w=wt;break;case"type":F=wt;break;case"checked":q=wt;break;case"defaultChecked":ht=wt;break;case"value":T=wt;break;case"defaultValue":z=wt;break;case"children":case"dangerouslySetInnerHTML":if(wt!=null)throw Error(s(137,c));break;default:Ke(a,c,g,wt,f,null)}}fl(a,T,z,q,ht,F,w,!1),Fu(a);return;case"select":ye("invalid",a),g=F=T=null;for(w in f)if(f.hasOwnProperty(w)&&(z=f[w],z!=null))switch(w){case"value":T=z;break;case"defaultValue":F=z;break;case"multiple":g=z;default:Ke(a,c,w,z,f,null)}c=T,f=F,a.multiple=!!g,c!=null?co(a,!!g,c,!1):f!=null&&co(a,!!g,f,!0);return;case"textarea":ye("invalid",a),T=w=g=null;for(F in f)if(f.hasOwnProperty(F)&&(z=f[F],z!=null))switch(F){case"value":g=z;break;case"defaultValue":w=z;break;case"children":T=z;break;case"dangerouslySetInnerHTML":if(z!=null)throw Error(s(91));break;default:Ke(a,c,F,z,f,null)}pl(a,g,w,T),Fu(a);return;case"option":for(q in f)if(f.hasOwnProperty(q)&&(g=f[q],g!=null))switch(q){case"selected":a.selected=g&&typeof g!="function"&&typeof g!="symbol";break;default:Ke(a,c,q,g,f,null)}return;case"dialog":ye("beforetoggle",a),ye("toggle",a),ye("cancel",a),ye("close",a);break;case"iframe":case"object":ye("load",a);break;case"video":case"audio":for(g=0;g<xd.length;g++)ye(xd[g],a);break;case"image":ye("error",a),ye("load",a);break;case"details":ye("toggle",a);break;case"embed":case"source":case"link":ye("error",a),ye("load",a);case"area":case"base":case"br":case"col":case"hr":case"keygen":case"meta":case"param":case"track":case"wbr":case"menuitem":for(ht in f)if(f.hasOwnProperty(ht)&&(g=f[ht],g!=null))switch(ht){case"children":case"dangerouslySetInnerHTML":throw Error(s(137,c));default:Ke(a,c,ht,g,f,null)}return;default:if(Mh(c)){for(wt in f)f.hasOwnProperty(wt)&&(g=f[wt],g!==void 0&&C1(a,c,wt,g,f,void 0));return}}for(z in f)f.hasOwnProperty(z)&&(g=f[z],g!=null&&Ke(a,c,z,g,f,null))}function i4(a,c,f,g){switch(c){case"div":case"span":case"svg":case"path":case"a":case"g":case"p":case"li":break;case"input":var w=null,T=null,F=null,z=null,q=null,ht=null,wt=null;for(pt in f){var Tt=f[pt];if(f.hasOwnProperty(pt)&&Tt!=null)switch(pt){case"checked":break;case"value":break;case"defaultValue":q=Tt;default:g.hasOwnProperty(pt)||Ke(a,c,pt,null,g,Tt)}}for(var ft in g){var pt=g[ft];if(Tt=f[ft],g.hasOwnProperty(ft)&&(pt!=null||Tt!=null))switch(ft){case"type":T=pt;break;case"name":w=pt;break;case"checked":ht=pt;break;case"defaultChecked":wt=pt;break;case"value":F=pt;break;case"defaultValue":z=pt;break;case"children":case"dangerouslySetInnerHTML":if(pt!=null)throw Error(s(137,c));break;default:pt!==Tt&&Ke(a,c,ft,pt,g,Tt)}}dr(a,F,z,q,ht,wt,T,w);return;case"select":pt=F=z=ft=null;for(T in f)if(q=f[T],f.hasOwnProperty(T)&&q!=null)switch(T){case"value":break;case"multiple":pt=q;default:g.hasOwnProperty(T)||Ke(a,c,T,null,g,q)}for(w in g)if(T=g[w],q=f[w],g.hasOwnProperty(w)&&(T!=null||q!=null))switch(w){case"value":ft=T;break;case"defaultValue":z=T;break;case"multiple":F=T;default:T!==q&&Ke(a,c,w,T,g,q)}c=z,f=F,g=pt,ft!=null?co(a,!!f,ft,!1):!!g!=!!f&&(c!=null?co(a,!!f,c,!0):co(a,!!f,f?[]:"",!1));return;case"textarea":pt=ft=null;for(z in f)if(w=f[z],f.hasOwnProperty(z)&&w!=null&&!g.hasOwnProperty(z))switch(z){case"value":break;case"children":break;default:Ke(a,c,z,null,g,w)}for(F in g)if(w=g[F],T=f[F],g.hasOwnProperty(F)&&(w!=null||T!=null))switch(F){case"value":ft=w;break;case"defaultValue":pt=w;break;case"children":break;case"dangerouslySetInnerHTML":if(w!=null)throw Error(s(91));break;default:w!==T&&Ke(a,c,F,w,g,T)}qe(a,ft,pt);return;case"option":for(var te in f)if(ft=f[te],f.hasOwnProperty(te)&&ft!=null&&!g.hasOwnProperty(te))switch(te){case"selected":a.selected=!1;break;default:Ke(a,c,te,null,g,ft)}for(q in g)if(ft=g[q],pt=f[q],g.hasOwnProperty(q)&&ft!==pt&&(ft!=null||pt!=null))switch(q){case"selected":a.selected=ft&&typeof ft!="function"&&typeof ft!="symbol";break;default:Ke(a,c,q,ft,g,pt)}return;case"img":case"link":case"area":case"base":case"br":case"col":case"embed":case"hr":case"keygen":case"meta":case"param":case"source":case"track":case"wbr":case"menuitem":for(var Xt in f)ft=f[Xt],f.hasOwnProperty(Xt)&&ft!=null&&!g.hasOwnProperty(Xt)&&Ke(a,c,Xt,null,g,ft);for(ht in g)if(ft=g[ht],pt=f[ht],g.hasOwnProperty(ht)&&ft!==pt&&(ft!=null||pt!=null))switch(ht){case"children":case"dangerouslySetInnerHTML":if(ft!=null)throw Error(s(137,c));break;default:Ke(a,c,ht,ft,g,pt)}return;default:if(Mh(c)){for(var Xe in f)ft=f[Xe],f.hasOwnProperty(Xe)&&ft!==void 0&&!g.hasOwnProperty(Xe)&&C1(a,c,Xe,void 0,g,ft);for(wt in g)ft=g[wt],pt=f[wt],!g.hasOwnProperty(wt)||ft===pt||ft===void 0&&pt===void 0||C1(a,c,wt,ft,g,pt);return}}for(var ot in f)ft=f[ot],f.hasOwnProperty(ot)&&ft!=null&&!g.hasOwnProperty(ot)&&Ke(a,c,ot,null,g,ft);for(Tt in g)ft=g[Tt],pt=f[Tt],!g.hasOwnProperty(Tt)||ft===pt||ft==null&&pt==null||Ke(a,c,Tt,ft,g,pt)}var S1=null,T1=null;function ig(a){return a.nodeType===9?a:a.ownerDocument}function F2(a){switch(a){case"http://www.w3.org/2000/svg":return 1;case"http://www.w3.org/1998/Math/MathML":return 2;default:return 0}}function L2(a,c){if(a===0)switch(c){case"svg":return 1;case"math":return 2;default:return 0}return a===1&&c==="foreignObject"?0:a}function E1(a,c){return a==="textarea"||a==="noscript"||typeof c.children=="string"||typeof c.children=="number"||typeof c.children=="bigint"||typeof c.dangerouslySetInnerHTML=="object"&&c.dangerouslySetInnerHTML!==null&&c.dangerouslySetInnerHTML.__html!=null}var I1=null;function o4(){var a=window.event;return a&&a.type==="popstate"?a===I1?!1:(I1=a,!0):(I1=null,!1)}var P2=typeof setTimeout=="function"?setTimeout:void 0,a4=typeof clearTimeout=="function"?clearTimeout:void 0,V2=typeof Promise=="function"?Promise:void 0,l4=typeof queueMicrotask=="function"?queueMicrotask:typeof V2<"u"?function(a){return V2.resolve(null).then(a).catch(u4)}:P2;function u4(a){setTimeout(function(){throw a})}function xa(a){return a==="head"}function z2(a,c){var f=c,g=0,w=0;do{var T=f.nextSibling;if(a.removeChild(f),T&&T.nodeType===8)if(f=T.data,f==="/$"){if(0<g&&8>g){f=g;var F=a.ownerDocument;if(f&1&&vd(F.documentElement),f&2&&vd(F.body),f&4)for(f=F.head,vd(f),F=f.firstChild;F;){var z=F.nextSibling,q=F.nodeName;F[ul]||q==="SCRIPT"||q==="STYLE"||q==="LINK"&&F.rel.toLowerCase()==="stylesheet"||f.removeChild(F),F=z}}if(w===0){a.removeChild(T),kd(c);return}w--}else f==="$"||f==="$?"||f==="$!"?w++:g=f.charCodeAt(0)-48;else g=0;f=T}while(f);kd(c)}function _1(a){var c=a.firstChild;for(c&&c.nodeType===10&&(c=c.nextSibling);c;){var f=c;switch(c=c.nextSibling,f.nodeName){case"HTML":case"HEAD":case"BODY":_1(f),Jo(f);continue;case"SCRIPT":case"STYLE":continue;case"LINK":if(f.rel.toLowerCase()==="stylesheet")continue}a.removeChild(f)}}function c4(a,c,f,g){for(;a.nodeType===1;){var w=f;if(a.nodeName.toLowerCase()!==c.toLowerCase()){if(!g&&(a.nodeName!=="INPUT"||a.type!=="hidden"))break}else if(g){if(!a[ul])switch(c){case"meta":if(!a.hasAttribute("itemprop"))break;return a;case"link":if(T=a.getAttribute("rel"),T==="stylesheet"&&a.hasAttribute("data-precedence"))break;if(T!==w.rel||a.getAttribute("href")!==(w.href==null||w.href===""?null:w.href)||a.getAttribute("crossorigin")!==(w.crossOrigin==null?null:w.crossOrigin)||a.getAttribute("title")!==(w.title==null?null:w.title))break;return a;case"style":if(a.hasAttribute("data-precedence"))break;return a;case"script":if(T=a.getAttribute("src"),(T!==(w.src==null?null:w.src)||a.getAttribute("type")!==(w.type==null?null:w.type)||a.getAttribute("crossorigin")!==(w.crossOrigin==null?null:w.crossOrigin))&&T&&a.hasAttribute("async")&&!a.hasAttribute("itemprop"))break;return a;default:return a}}else if(c==="input"&&a.type==="hidden"){var T=w.name==null?null:""+w.name;if(w.type==="hidden"&&a.getAttribute("name")===T)return a}else return a;if(a=ei(a.nextSibling),a===null)break}return null}function h4(a,c,f){if(c==="")return null;for(;a.nodeType!==3;)if((a.nodeType!==1||a.nodeName!=="INPUT"||a.type!=="hidden")&&!f||(a=ei(a.nextSibling),a===null))return null;return a}function k1(a){return a.data==="$!"||a.data==="$?"&&a.ownerDocument.readyState==="complete"}function d4(a,c){var f=a.ownerDocument;if(a.data!=="$?"||f.readyState==="complete")c();else{var g=function(){c(),f.removeEventListener("DOMContentLoaded",g)};f.addEventListener("DOMContentLoaded",g),a._reactRetry=g}}function ei(a){for(;a!=null;a=a.nextSibling){var c=a.nodeType;if(c===1||c===3)break;if(c===8){if(c=a.data,c==="$"||c==="$!"||c==="$?"||c==="F!"||c==="F")break;if(c==="/$")return null}}return a}var A1=null;function B2(a){a=a.previousSibling;for(var c=0;a;){if(a.nodeType===8){var f=a.data;if(f==="$"||f==="$!"||f==="$?"){if(c===0)return a;c--}else f==="/$"&&c++}a=a.previousSibling}return null}function U2(a,c,f){switch(c=ig(f),a){case"html":if(a=c.documentElement,!a)throw Error(s(452));return a;case"head":if(a=c.head,!a)throw Error(s(453));return a;case"body":if(a=c.body,!a)throw Error(s(454));return a;default:throw Error(s(451))}}function vd(a){for(var c=a.attributes;c.length;)a.removeAttributeNode(c[0]);Jo(a)}var Pr=new Map,G2=new Set;function og(a){return typeof a.getRootNode=="function"?a.getRootNode():a.nodeType===9?a:a.ownerDocument}var No=K.d;K.d={f:f4,r:p4,D:m4,C:g4,L:y4,m:x4,X:v4,S:b4,M:w4};function f4(){var a=No.f(),c=Qm();return a||c}function p4(a){var c=yi(a);c!==null&&c.tag===5&&c.type==="form"?uI(c):No.r(a)}var yc=typeof document>"u"?null:document;function W2(a,c,f){var g=yc;if(g&&typeof c=="string"&&c){var w=$n(c);w='link[rel="'+a+'"][href="'+w+'"]',typeof f=="string"&&(w+='[crossorigin="'+f+'"]'),G2.has(w)||(G2.add(w),a={rel:a,crossOrigin:f,href:c},g.querySelector(w)===null&&(c=g.createElement("link"),bs(c,"link",a),En(c),g.head.appendChild(c)))}}function m4(a){No.D(a),W2("dns-prefetch",a,null)}function g4(a,c){No.C(a,c),W2("preconnect",a,c)}function y4(a,c,f){No.L(a,c,f);var g=yc;if(g&&a&&c){var w='link[rel="preload"][as="'+$n(c)+'"]';c==="image"&&f&&f.imageSrcSet?(w+='[imagesrcset="'+$n(f.imageSrcSet)+'"]',typeof f.imageSizes=="string"&&(w+='[imagesizes="'+$n(f.imageSizes)+'"]')):w+='[href="'+$n(a)+'"]';var T=w;switch(c){case"style":T=xc(a);break;case"script":T=bc(a)}Pr.has(T)||(a=d({rel:"preload",href:c==="image"&&f&&f.imageSrcSet?void 0:a,as:c},f),Pr.set(T,a),g.querySelector(w)!==null||c==="style"&&g.querySelector(wd(T))||c==="script"&&g.querySelector(Cd(T))||(c=g.createElement("link"),bs(c,"link",a),En(c),g.head.appendChild(c)))}}function x4(a,c){No.m(a,c);var f=yc;if(f&&a){var g=c&&typeof c.as=="string"?c.as:"script",w='link[rel="modulepreload"][as="'+$n(g)+'"][href="'+$n(a)+'"]',T=w;switch(g){case"audioworklet":case"paintworklet":case"serviceworker":case"sharedworker":case"worker":case"script":T=bc(a)}if(!Pr.has(T)&&(a=d({rel:"modulepreload",href:a},c),Pr.set(T,a),f.querySelector(w)===null)){switch(g){case"audioworklet":case"paintworklet":case"serviceworker":case"sharedworker":case"worker":case"script":if(f.querySelector(Cd(T)))return}g=f.createElement("link"),bs(g,"link",a),En(g),f.head.appendChild(g)}}}function b4(a,c,f){No.S(a,c,f);var g=yc;if(g&&a){var w=Us(g).hoistableStyles,T=xc(a);c=c||"default";var F=w.get(T);if(!F){var z={loading:0,preload:null};if(F=g.querySelector(wd(T)))z.loading=5;else{a=d({rel:"stylesheet",href:a,"data-precedence":c},f),(f=Pr.get(T))&&N1(a,f);var q=F=g.createElement("link");En(q),bs(q,"link",a),q._p=new Promise(function(ht,wt){q.onload=ht,q.onerror=wt}),q.addEventListener("load",function(){z.loading|=1}),q.addEventListener("error",function(){z.loading|=2}),z.loading|=4,ag(F,c,g)}F={type:"stylesheet",instance:F,count:1,state:z},w.set(T,F)}}}function v4(a,c){No.X(a,c);var f=yc;if(f&&a){var g=Us(f).hoistableScripts,w=bc(a),T=g.get(w);T||(T=f.querySelector(Cd(w)),T||(a=d({src:a,async:!0},c),(c=Pr.get(w))&&R1(a,c),T=f.createElement("script"),En(T),bs(T,"link",a),f.head.appendChild(T)),T={type:"script",instance:T,count:1,state:null},g.set(w,T))}}function w4(a,c){No.M(a,c);var f=yc;if(f&&a){var g=Us(f).hoistableScripts,w=bc(a),T=g.get(w);T||(T=f.querySelector(Cd(w)),T||(a=d({src:a,async:!0,type:"module"},c),(c=Pr.get(w))&&R1(a,c),T=f.createElement("script"),En(T),bs(T,"link",a),f.head.appendChild(T)),T={type:"script",instance:T,count:1,state:null},g.set(w,T))}}function H2(a,c,f,g){var w=(w=Ct.current)?og(w):null;if(!w)throw Error(s(446));switch(a){case"meta":case"title":return null;case"style":return typeof f.precedence=="string"&&typeof f.href=="string"?(c=xc(f.href),f=Us(w).hoistableStyles,g=f.get(c),g||(g={type:"style",instance:null,count:0,state:null},f.set(c,g)),g):{type:"void",instance:null,count:0,state:null};case"link":if(f.rel==="stylesheet"&&typeof f.href=="string"&&typeof f.precedence=="string"){a=xc(f.href);var T=Us(w).hoistableStyles,F=T.get(a);if(F||(w=w.ownerDocument||w,F={type:"stylesheet",instance:null,count:0,state:{loading:0,preload:null}},T.set(a,F),(T=w.querySelector(wd(a)))&&!T._p&&(F.instance=T,F.state.loading=5),Pr.has(a)||(f={rel:"preload",as:"style",href:f.href,crossOrigin:f.crossOrigin,integrity:f.integrity,media:f.media,hrefLang:f.hrefLang,referrerPolicy:f.referrerPolicy},Pr.set(a,f),T||C4(w,a,f,F.state))),c&&g===null)throw Error(s(528,""));return F}if(c&&g!==null)throw Error(s(529,""));return null;case"script":return c=f.async,f=f.src,typeof f=="string"&&c&&typeof c!="function"&&typeof c!="symbol"?(c=bc(f),f=Us(w).hoistableScripts,g=f.get(c),g||(g={type:"script",instance:null,count:0,state:null},f.set(c,g)),g):{type:"void",instance:null,count:0,state:null};default:throw Error(s(444,a))}}function xc(a){return'href="'+$n(a)+'"'}function wd(a){return'link[rel="stylesheet"]['+a+"]"}function q2(a){return d({},a,{"data-precedence":a.precedence,precedence:null})}function C4(a,c,f,g){a.querySelector('link[rel="preload"][as="style"]['+c+"]")?g.loading=1:(c=a.createElement("link"),g.preload=c,c.addEventListener("load",function(){return g.loading|=1}),c.addEventListener("error",function(){return g.loading|=2}),bs(c,"link",f),En(c),a.head.appendChild(c))}function bc(a){return'[src="'+$n(a)+'"]'}function Cd(a){return"script[async]"+a}function j2(a,c,f){if(c.count++,c.instance===null)switch(c.type){case"style":var g=a.querySelector('style[data-href~="'+$n(f.href)+'"]');if(g)return c.instance=g,En(g),g;var w=d({},f,{"data-href":f.href,"data-precedence":f.precedence,href:null,precedence:null});return g=(a.ownerDocument||a).createElement("style"),En(g),bs(g,"style",w),ag(g,f.precedence,a),c.instance=g;case"stylesheet":w=xc(f.href);var T=a.querySelector(wd(w));if(T)return c.state.loading|=4,c.instance=T,En(T),T;g=q2(f),(w=Pr.get(w))&&N1(g,w),T=(a.ownerDocument||a).createElement("link"),En(T);var F=T;return F._p=new Promise(function(z,q){F.onload=z,F.onerror=q}),bs(T,"link",g),c.state.loading|=4,ag(T,f.precedence,a),c.instance=T;case"script":return T=bc(f.src),(w=a.querySelector(Cd(T)))?(c.instance=w,En(w),w):(g=f,(w=Pr.get(T))&&(g=d({},f),R1(g,w)),a=a.ownerDocument||a,w=a.createElement("script"),En(w),bs(w,"link",g),a.head.appendChild(w),c.instance=w);case"void":return null;default:throw Error(s(443,c.type))}else c.type==="stylesheet"&&(c.state.loading&4)===0&&(g=c.instance,c.state.loading|=4,ag(g,f.precedence,a));return c.instance}function ag(a,c,f){for(var g=f.querySelectorAll('link[rel="stylesheet"][data-precedence],style[data-precedence]'),w=g.length?g[g.length-1]:null,T=w,F=0;F<g.length;F++){var z=g[F];if(z.dataset.precedence===c)T=z;else if(T!==w)break}T?T.parentNode.insertBefore(a,T.nextSibling):(c=f.nodeType===9?f.head:f,c.insertBefore(a,c.firstChild))}function N1(a,c){a.crossOrigin==null&&(a.crossOrigin=c.crossOrigin),a.referrerPolicy==null&&(a.referrerPolicy=c.referrerPolicy),a.title==null&&(a.title=c.title)}function R1(a,c){a.crossOrigin==null&&(a.crossOrigin=c.crossOrigin),a.referrerPolicy==null&&(a.referrerPolicy=c.referrerPolicy),a.integrity==null&&(a.integrity=c.integrity)}var lg=null;function K2(a,c,f){if(lg===null){var g=new Map,w=lg=new Map;w.set(f,g)}else w=lg,g=w.get(f),g||(g=new Map,w.set(f,g));if(g.has(a))return g;for(g.set(a,null),f=f.getElementsByTagName(a),w=0;w<f.length;w++){var T=f[w];if(!(T[ul]||T[Gn]||a==="link"&&T.getAttribute("rel")==="stylesheet")&&T.namespaceURI!=="http://www.w3.org/2000/svg"){var F=T.getAttribute(c)||"";F=a+F;var z=g.get(F);z?z.push(T):g.set(F,[T])}}return g}function X2(a,c,f){a=a.ownerDocument||a,a.head.insertBefore(f,c==="title"?a.querySelector("head > title"):null)}function S4(a,c,f){if(f===1||c.itemProp!=null)return!1;switch(a){case"meta":case"title":return!0;case"style":if(typeof c.precedence!="string"||typeof c.href!="string"||c.href==="")break;return!0;case"link":if(typeof c.rel!="string"||typeof c.href!="string"||c.href===""||c.onLoad||c.onError)break;switch(c.rel){case"stylesheet":return a=c.disabled,typeof c.precedence=="string"&&a==null;default:return!0}case"script":if(c.async&&typeof c.async!="function"&&typeof c.async!="symbol"&&!c.onLoad&&!c.onError&&c.src&&typeof c.src=="string")return!0}return!1}function Y2(a){return!(a.type==="stylesheet"&&(a.state.loading&3)===0)}var Sd=null;function T4(){}function E4(a,c,f){if(Sd===null)throw Error(s(475));var g=Sd;if(c.type==="stylesheet"&&(typeof f.media!="string"||matchMedia(f.media).matches!==!1)&&(c.state.loading&4)===0){if(c.instance===null){var w=xc(f.href),T=a.querySelector(wd(w));if(T){a=T._p,a!==null&&typeof a=="object"&&typeof a.then=="function"&&(g.count++,g=ug.bind(g),a.then(g,g)),c.state.loading|=4,c.instance=T,En(T);return}T=a.ownerDocument||a,f=q2(f),(w=Pr.get(w))&&N1(f,w),T=T.createElement("link"),En(T);var F=T;F._p=new Promise(function(z,q){F.onload=z,F.onerror=q}),bs(T,"link",f),c.instance=T}g.stylesheets===null&&(g.stylesheets=new Map),g.stylesheets.set(c,a),(a=c.state.preload)&&(c.state.loading&3)===0&&(g.count++,c=ug.bind(g),a.addEventListener("load",c),a.addEventListener("error",c))}}function I4(){if(Sd===null)throw Error(s(475));var a=Sd;return a.stylesheets&&a.count===0&&$1(a,a.stylesheets),0<a.count?function(c){var f=setTimeout(function(){if(a.stylesheets&&$1(a,a.stylesheets),a.unsuspend){var g=a.unsuspend;a.unsuspend=null,g()}},6e4);return a.unsuspend=c,function(){a.unsuspend=null,clearTimeout(f)}}:null}function ug(){if(this.count--,this.count===0){if(this.stylesheets)$1(this,this.stylesheets);else if(this.unsuspend){var a=this.unsuspend;this.unsuspend=null,a()}}}var cg=null;function $1(a,c){a.stylesheets=null,a.unsuspend!==null&&(a.count++,cg=new Map,c.forEach(_4,a),cg=null,ug.call(a))}function _4(a,c){if(!(c.state.loading&4)){var f=cg.get(a);if(f)var g=f.get(null);else{f=new Map,cg.set(a,f);for(var w=a.querySelectorAll("link[data-precedence],style[data-precedence]"),T=0;T<w.length;T++){var F=w[T];(F.nodeName==="LINK"||F.getAttribute("media")!=="not all")&&(f.set(F.dataset.precedence,F),g=F)}g&&f.set(null,g)}w=c.instance,F=w.getAttribute("data-precedence"),T=f.get(F)||g,T===g&&f.set(null,w),f.set(F,w),this.count++,g=ug.bind(this),w.addEventListener("load",g),w.addEventListener("error",g),T?T.parentNode.insertBefore(w,T.nextSibling):(a=a.nodeType===9?a.head:a,a.insertBefore(w,a.firstChild)),c.state.loading|=4}}var Td={$$typeof:_,Provider:null,Consumer:null,_currentValue:Y,_currentValue2:Y,_threadCount:0};function k4(a,c,f,g,w,T,F,z){this.tag=1,this.containerInfo=a,this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.next=this.pendingContext=this.context=this.cancelPendingCommit=null,this.callbackPriority=0,this.expirationTimes=io(-1),this.entangledLanes=this.shellSuspendCounter=this.errorRecoveryDisabledLanes=this.expiredLanes=this.warmLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=io(0),this.hiddenUpdates=io(null),this.identifierPrefix=g,this.onUncaughtError=w,this.onCaughtError=T,this.onRecoverableError=F,this.pooledCache=null,this.pooledCacheLanes=0,this.formState=z,this.incompleteTransitions=new Map}function Q2(a,c,f,g,w,T,F,z,q,ht,wt,Tt){return a=new k4(a,c,f,F,z,q,ht,Tt),c=1,T===!0&&(c|=24),T=pr(3,null,null,c),a.current=T,T.stateNode=a,c=fb(),c.refCount++,a.pooledCache=c,c.refCount++,T.memoizedState={element:g,isDehydrated:f,cache:c},yb(T),a}function Z2(a){return a?(a=Yu,a):Yu}function J2(a,c,f,g,w,T){w=Z2(w),g.context===null?g.context=w:g.pendingContext=w,g=ia(c),g.payload={element:f},T=T===void 0?null:T,T!==null&&(g.callback=T),f=oa(a,g,c),f!==null&&(br(f,a,c),td(f,a,c))}function t_(a,c){if(a=a.memoizedState,a!==null&&a.dehydrated!==null){var f=a.retryLane;a.retryLane=f!==0&&f<c?f:c}}function D1(a,c){t_(a,c),(a=a.alternate)&&t_(a,c)}function e_(a){if(a.tag===13){var c=Xu(a,67108864);c!==null&&br(c,a,67108864),D1(a,67108864)}}var hg=!0;function A4(a,c,f,g){var w=W.T;W.T=null;var T=K.p;try{K.p=2,O1(a,c,f,g)}finally{K.p=T,W.T=w}}function N4(a,c,f,g){var w=W.T;W.T=null;var T=K.p;try{K.p=8,O1(a,c,f,g)}finally{K.p=T,W.T=w}}function O1(a,c,f,g){if(hg){var w=M1(g);if(w===null)w1(a,c,g,dg,f),s_(a,g);else if($4(w,a,c,f,g))g.stopPropagation();else if(s_(a,g),c&4&&-1<R4.indexOf(a)){for(;w!==null;){var T=yi(w);if(T!==null)switch(T.tag){case 3:if(T=T.stateNode,T.current.memoizedState.isDehydrated){var F=hr(T.pendingLanes);if(F!==0){var z=T;for(z.pendingLanes|=2,z.entangledLanes|=2;F;){var q=1<<31-gn(F);z.entanglements[1]|=q,F&=~q}Ri(T),(Ge&6)===0&&(Xm=me()+500,yd(0))}}break;case 13:z=Xu(T,2),z!==null&&br(z,T,2),Qm(),D1(T,2)}if(T=M1(g),T===null&&w1(a,c,g,dg,f),T===w)break;w=T}w!==null&&g.stopPropagation()}else w1(a,c,g,null,f)}}function M1(a){return a=Ar(a),F1(a)}var dg=null;function F1(a){if(dg=null,a=ao(a),a!==null){var c=i(a);if(c===null)a=null;else{var f=c.tag;if(f===13){if(a=o(c),a!==null)return a;a=null}else if(f===3){if(c.stateNode.current.memoizedState.isDehydrated)return c.tag===3?c.stateNode.containerInfo:null;a=null}else c!==a&&(a=null)}}return dg=a,null}function n_(a){switch(a){case"beforetoggle":case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"toggle":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 2;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 8;case"message":switch(Ue()){case Bs:return 2;case sn:return 8;case As:case fs:return 32;case Js:return 268435456;default:return 32}default:return 32}}var L1=!1,ba=null,va=null,wa=null,Ed=new Map,Id=new Map,Ca=[],R4="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset".split(" ");function s_(a,c){switch(a){case"focusin":case"focusout":ba=null;break;case"dragenter":case"dragleave":va=null;break;case"mouseover":case"mouseout":wa=null;break;case"pointerover":case"pointerout":Ed.delete(c.pointerId);break;case"gotpointercapture":case"lostpointercapture":Id.delete(c.pointerId)}}function _d(a,c,f,g,w,T){return a===null||a.nativeEvent!==T?(a={blockedOn:c,domEventName:f,eventSystemFlags:g,nativeEvent:T,targetContainers:[w]},c!==null&&(c=yi(c),c!==null&&e_(c)),a):(a.eventSystemFlags|=g,c=a.targetContainers,w!==null&&c.indexOf(w)===-1&&c.push(w),a)}function $4(a,c,f,g,w){switch(c){case"focusin":return ba=_d(ba,a,c,f,g,w),!0;case"dragenter":return va=_d(va,a,c,f,g,w),!0;case"mouseover":return wa=_d(wa,a,c,f,g,w),!0;case"pointerover":var T=w.pointerId;return Ed.set(T,_d(Ed.get(T)||null,a,c,f,g,w)),!0;case"gotpointercapture":return T=w.pointerId,Id.set(T,_d(Id.get(T)||null,a,c,f,g,w)),!0}return!1}function r_(a){var c=ao(a.target);if(c!==null){var f=i(c);if(f!==null){if(c=f.tag,c===13){if(c=o(f),c!==null){a.blockedOn=c,Qp(a.priority,function(){if(f.tag===13){var g=xr();g=Yo(g);var w=Xu(f,g);w!==null&&br(w,f,g),D1(f,g)}});return}}else if(c===3&&f.stateNode.current.memoizedState.isDehydrated){a.blockedOn=f.tag===3?f.stateNode.containerInfo:null;return}}}a.blockedOn=null}function fg(a){if(a.blockedOn!==null)return!1;for(var c=a.targetContainers;0<c.length;){var f=M1(a.nativeEvent);if(f===null){f=a.nativeEvent;var g=new f.constructor(f.type,f);ho=g,f.target.dispatchEvent(g),ho=null}else return c=yi(f),c!==null&&e_(c),a.blockedOn=f,!1;c.shift()}return!0}function i_(a,c,f){fg(a)&&f.delete(c)}function D4(){L1=!1,ba!==null&&fg(ba)&&(ba=null),va!==null&&fg(va)&&(va=null),wa!==null&&fg(wa)&&(wa=null),Ed.forEach(i_),Id.forEach(i_)}function pg(a,c){a.blockedOn===c&&(a.blockedOn=null,L1||(L1=!0,n.unstable_scheduleCallback(n.unstable_NormalPriority,D4)))}var mg=null;function o_(a){mg!==a&&(mg=a,n.unstable_scheduleCallback(n.unstable_NormalPriority,function(){mg===a&&(mg=null);for(var c=0;c<a.length;c+=3){var f=a[c],g=a[c+1],w=a[c+2];if(typeof g!="function"){if(F1(g||f)===null)continue;break}var T=yi(f);T!==null&&(a.splice(c,3),c-=3,Fb(T,{pending:!0,data:w,method:f.method,action:g},g,w))}}))}function kd(a){function c(q){return pg(q,a)}ba!==null&&pg(ba,a),va!==null&&pg(va,a),wa!==null&&pg(wa,a),Ed.forEach(c),Id.forEach(c);for(var f=0;f<Ca.length;f++){var g=Ca[f];g.blockedOn===a&&(g.blockedOn=null)}for(;0<Ca.length&&(f=Ca[0],f.blockedOn===null);)r_(f),f.blockedOn===null&&Ca.shift();if(f=(a.ownerDocument||a).$$reactFormReplay,f!=null)for(g=0;g<f.length;g+=3){var w=f[g],T=f[g+1],F=w[Rn]||null;if(typeof T=="function")F||o_(f);else if(F){var z=null;if(T&&T.hasAttribute("formAction")){if(w=T,F=T[Rn]||null)z=F.formAction;else if(F1(w)!==null)continue}else z=F.action;typeof z=="function"?f[g+1]=z:(f.splice(g,3),g-=3),o_(f)}}}function P1(a){this._internalRoot=a}gg.prototype.render=P1.prototype.render=function(a){var c=this._internalRoot;if(c===null)throw Error(s(409));var f=c.current,g=xr();J2(f,g,a,c,null,null)},gg.prototype.unmount=P1.prototype.unmount=function(){var a=this._internalRoot;if(a!==null){this._internalRoot=null;var c=a.containerInfo;J2(a.current,2,null,a,null,null),Qm(),c[_r]=null}};function gg(a){this._internalRoot=a}gg.prototype.unstable_scheduleHydration=function(a){if(a){var c=Qo();a={blockedOn:null,target:a,priority:c};for(var f=0;f<Ca.length&&c!==0&&c<Ca[f].priority;f++);Ca.splice(f,0,a),f===0&&r_(a)}};var a_=t.version;if(a_!=="19.1.0")throw Error(s(527,a_,"19.1.0"));K.findDOMNode=function(a){var c=a._reactInternals;if(c===void 0)throw typeof a.render=="function"?Error(s(188)):(a=Object.keys(a).join(","),Error(s(268,a)));return a=u(c),a=a!==null?h(a):null,a=a===null?null:a.stateNode,a};var O4={bundleType:0,version:"19.1.0",rendererPackageName:"react-dom",currentDispatcherRef:W,reconcilerVersion:"19.1.0"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var yg=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!yg.isDisabled&&yg.supportsFiber)try{Fe=yg.inject(O4),fe=yg}catch{}}return Nd.createRoot=function(a,c){if(!r(a))throw Error(s(299));var f=!1,g="",w=SI,T=TI,F=EI,z=null;return c!=null&&(c.unstable_strictMode===!0&&(f=!0),c.identifierPrefix!==void 0&&(g=c.identifierPrefix),c.onUncaughtError!==void 0&&(w=c.onUncaughtError),c.onCaughtError!==void 0&&(T=c.onCaughtError),c.onRecoverableError!==void 0&&(F=c.onRecoverableError),c.unstable_transitionCallbacks!==void 0&&(z=c.unstable_transitionCallbacks)),c=Q2(a,1,!1,null,null,f,g,w,T,F,z,null),a[_r]=c.current,v1(a),new P1(c)},Nd.hydrateRoot=function(a,c,f){if(!r(a))throw Error(s(299));var g=!1,w="",T=SI,F=TI,z=EI,q=null,ht=null;return f!=null&&(f.unstable_strictMode===!0&&(g=!0),f.identifierPrefix!==void 0&&(w=f.identifierPrefix),f.onUncaughtError!==void 0&&(T=f.onUncaughtError),f.onCaughtError!==void 0&&(F=f.onCaughtError),f.onRecoverableError!==void 0&&(z=f.onRecoverableError),f.unstable_transitionCallbacks!==void 0&&(q=f.unstable_transitionCallbacks),f.formState!==void 0&&(ht=f.formState)),c=Q2(a,1,!0,c,f??null,g,w,T,F,z,q,ht),c.context=Z2(null),f=c.current,g=xr(),g=Yo(g),w=ia(g),w.callback=null,oa(f,w,g),f=g,c.current.lanes=f,oo(c,f),Ri(c),a[_r]=c.current,v1(a),new gg(c)},Nd.version="19.1.0",Nd}var y_;function j4(){if(y_)return B1.exports;y_=1;function n(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(n)}catch(t){console.error(t)}}return n(),B1.exports=q4(),B1.exports}var K4=j4();const X4=Yy(K4);var Rd={},x_;function Y4(){if(x_)return Rd;x_=1,Object.defineProperty(Rd,"__esModule",{value:!0}),Rd.parse=o,Rd.serialize=h;const n=/^[\u0021-\u003A\u003C\u003E-\u007E]+$/,t=/^[\u0021-\u003A\u003C-\u007E]*$/,e=/^([.]?[a-z0-9]([a-z0-9-]{0,61}[a-z0-9])?)([.][a-z0-9]([a-z0-9-]{0,61}[a-z0-9])?)*$/i,s=/^[\u0020-\u003A\u003D-\u007E]*$/,r=Object.prototype.toString,i=(()=>{const m=function(){};return m.prototype=Object.create(null),m})();function o(m,y){const x=new i,v=m.length;if(v<2)return x;const C=(y==null?void 0:y.decode)||d;let S=0;do{const E=m.indexOf("=",S);if(E===-1)break;const _=m.indexOf(";",S),I=_===-1?v:_;if(E>I){S=m.lastIndexOf(";",E-1)+1;continue}const O=l(m,S,E),P=u(m,E,O),D=m.slice(O,P);if(x[D]===void 0){let N=l(m,E+1,I),R=u(m,I,N);const $=C(m.slice(N,R));x[D]=$}S=I+1}while(S<v);return x}function l(m,y,x){do{const v=m.charCodeAt(y);if(v!==32&&v!==9)return y}while(++y<x);return x}function u(m,y,x){for(;y>x;){const v=m.charCodeAt(--y);if(v!==32&&v!==9)return y+1}return x}function h(m,y,x){const v=(x==null?void 0:x.encode)||encodeURIComponent;if(!n.test(m))throw new TypeError(`argument name is invalid: ${m}`);const C=v(y);if(!t.test(C))throw new TypeError(`argument val is invalid: ${y}`);let S=m+"="+C;if(!x)return S;if(x.maxAge!==void 0){if(!Number.isInteger(x.maxAge))throw new TypeError(`option maxAge is invalid: ${x.maxAge}`);S+="; Max-Age="+x.maxAge}if(x.domain){if(!e.test(x.domain))throw new TypeError(`option domain is invalid: ${x.domain}`);S+="; Domain="+x.domain}if(x.path){if(!s.test(x.path))throw new TypeError(`option path is invalid: ${x.path}`);S+="; Path="+x.path}if(x.expires){if(!p(x.expires)||!Number.isFinite(x.expires.valueOf()))throw new TypeError(`option expires is invalid: ${x.expires}`);S+="; Expires="+x.expires.toUTCString()}if(x.httpOnly&&(S+="; HttpOnly"),x.secure&&(S+="; Secure"),x.partitioned&&(S+="; Partitioned"),x.priority)switch(typeof x.priority=="string"?x.priority.toLowerCase():void 0){case"low":S+="; Priority=Low";break;case"medium":S+="; Priority=Medium";break;case"high":S+="; Priority=High";break;default:throw new TypeError(`option priority is invalid: ${x.priority}`)}if(x.sameSite)switch(typeof x.sameSite=="string"?x.sameSite.toLowerCase():x.sameSite){case!0:case"strict":S+="; SameSite=Strict";break;case"lax":S+="; SameSite=Lax";break;case"none":S+="; SameSite=None";break;default:throw new TypeError(`option sameSite is invalid: ${x.sameSite}`)}return S}function d(m){if(m.indexOf("%")===-1)return m;try{return decodeURIComponent(m)}catch{return m}}function p(m){return r.call(m)==="[object Date]"}return Rd}Y4();var b_="popstate";function Q4(n={}){function t(s,r){let{pathname:i,search:o,hash:l}=s.location;return wv("",{pathname:i,search:o,hash:l},r.state&&r.state.usr||null,r.state&&r.state.key||"default")}function e(s,r){return typeof r=="string"?r:tf(r)}return J4(t,e,null,n)}function fn(n,t){if(n===!1||n===null||typeof n>"u")throw new Error(t)}function ji(n,t){if(!n){typeof console<"u"&&console.warn(t);try{throw new Error(t)}catch{}}}function Z4(){return Math.random().toString(36).substring(2,10)}function v_(n,t){return{usr:n.state,key:n.key,idx:t}}function wv(n,t,e=null,s){return{pathname:typeof n=="string"?n:n.pathname,search:"",hash:"",...typeof t=="string"?eh(t):t,state:e,key:t&&t.key||s||Z4()}}function tf({pathname:n="/",search:t="",hash:e=""}){return t&&t!=="?"&&(n+=t.charAt(0)==="?"?t:"?"+t),e&&e!=="#"&&(n+=e.charAt(0)==="#"?e:"#"+e),n}function eh(n){let t={};if(n){let e=n.indexOf("#");e>=0&&(t.hash=n.substring(e),n=n.substring(0,e));let s=n.indexOf("?");s>=0&&(t.search=n.substring(s),n=n.substring(0,s)),n&&(t.pathname=n)}return t}function J4(n,t,e,s={}){let{window:r=document.defaultView,v5Compat:i=!1}=s,o=r.history,l="POP",u=null,h=d();h==null&&(h=0,o.replaceState({...o.state,idx:h},""));function d(){return(o.state||{idx:null}).idx}function p(){l="POP";let C=d(),S=C==null?null:C-h;h=C,u&&u({action:l,location:v.location,delta:S})}function m(C,S){l="PUSH";let E=wv(v.location,C,S);h=d()+1;let _=v_(E,h),I=v.createHref(E);try{o.pushState(_,"",I)}catch(O){if(O instanceof DOMException&&O.name==="DataCloneError")throw O;r.location.assign(I)}i&&u&&u({action:l,location:v.location,delta:1})}function y(C,S){l="REPLACE";let E=wv(v.location,C,S);h=d();let _=v_(E,h),I=v.createHref(E);o.replaceState(_,"",I),i&&u&&u({action:l,location:v.location,delta:0})}function x(C){return tV(C)}let v={get action(){return l},get location(){return n(r,o)},listen(C){if(u)throw new Error("A history only accepts one active listener");return r.addEventListener(b_,p),u=C,()=>{r.removeEventListener(b_,p),u=null}},createHref(C){return t(r,C)},createURL:x,encodeLocation(C){let S=x(C);return{pathname:S.pathname,search:S.search,hash:S.hash}},push:m,replace:y,go(C){return o.go(C)}};return v}function tV(n,t=!1){let e="http://localhost";typeof window<"u"&&(e=window.location.origin!=="null"?window.location.origin:window.location.href),fn(e,"No window.location.(origin|href) available to create URL");let s=typeof n=="string"?n:tf(n);return s=s.replace(/ $/,"%20"),!t&&s.startsWith("//")&&(s=e+s),new URL(s,e)}function SN(n,t,e="/"){return eV(n,t,e,!1)}function eV(n,t,e,s){let r=typeof t=="string"?eh(t):t,i=Fo(r.pathname||"/",e);if(i==null)return null;let o=TN(n);nV(o);let l=null;for(let u=0;l==null&&u<o.length;++u){let h=fV(i);l=hV(o[u],h,s)}return l}function TN(n,t=[],e=[],s=""){let r=(i,o,l)=>{let u={relativePath:l===void 0?i.path||"":l,caseSensitive:i.caseSensitive===!0,childrenIndex:o,route:i};u.relativePath.startsWith("/")&&(fn(u.relativePath.startsWith(s),`Absolute route path "${u.relativePath}" nested under path "${s}" is not valid. An absolute child route path must start with the combined path of all its parent routes.`),u.relativePath=u.relativePath.slice(s.length));let h=Oo([s,u.relativePath]),d=e.concat(u);i.children&&i.children.length>0&&(fn(i.index!==!0,`Index routes must not have child routes. Please remove all child routes from route path "${h}".`),TN(i.children,t,d,h)),!(i.path==null&&!i.index)&&t.push({path:h,score:uV(h,i.index),routesMeta:d})};return n.forEach((i,o)=>{var l;if(i.path===""||!((l=i.path)!=null&&l.includes("?")))r(i,o);else for(let u of EN(i.path))r(i,o,u)}),t}function EN(n){let t=n.split("/");if(t.length===0)return[];let[e,...s]=t,r=e.endsWith("?"),i=e.replace(/\?$/,"");if(s.length===0)return r?[i,""]:[i];let o=EN(s.join("/")),l=[];return l.push(...o.map(u=>u===""?i:[i,u].join("/"))),r&&l.push(...o),l.map(u=>n.startsWith("/")&&u===""?"/":u)}function nV(n){n.sort((t,e)=>t.score!==e.score?e.score-t.score:cV(t.routesMeta.map(s=>s.childrenIndex),e.routesMeta.map(s=>s.childrenIndex)))}var sV=/^:[\w-]+$/,rV=3,iV=2,oV=1,aV=10,lV=-2,w_=n=>n==="*";function uV(n,t){let e=n.split("/"),s=e.length;return e.some(w_)&&(s+=lV),t&&(s+=iV),e.filter(r=>!w_(r)).reduce((r,i)=>r+(sV.test(i)?rV:i===""?oV:aV),s)}function cV(n,t){return n.length===t.length&&n.slice(0,-1).every((s,r)=>s===t[r])?n[n.length-1]-t[t.length-1]:0}function hV(n,t,e=!1){let{routesMeta:s}=n,r={},i="/",o=[];for(let l=0;l<s.length;++l){let u=s[l],h=l===s.length-1,d=i==="/"?t:t.slice(i.length)||"/",p=ny({path:u.relativePath,caseSensitive:u.caseSensitive,end:h},d),m=u.route;if(!p&&h&&e&&!s[s.length-1].route.index&&(p=ny({path:u.relativePath,caseSensitive:u.caseSensitive,end:!1},d)),!p)return null;Object.assign(r,p.params),o.push({params:r,pathname:Oo([i,p.pathname]),pathnameBase:yV(Oo([i,p.pathnameBase])),route:m}),p.pathnameBase!=="/"&&(i=Oo([i,p.pathnameBase]))}return o}function ny(n,t){typeof n=="string"&&(n={path:n,caseSensitive:!1,end:!0});let[e,s]=dV(n.path,n.caseSensitive,n.end),r=t.match(e);if(!r)return null;let i=r[0],o=i.replace(/(.)\/+$/,"$1"),l=r.slice(1);return{params:s.reduce((h,{paramName:d,isOptional:p},m)=>{if(d==="*"){let x=l[m]||"";o=i.slice(0,i.length-x.length).replace(/(.)\/+$/,"$1")}const y=l[m];return p&&!y?h[d]=void 0:h[d]=(y||"").replace(/%2F/g,"/"),h},{}),pathname:i,pathnameBase:o,pattern:n}}function dV(n,t=!1,e=!0){ji(n==="*"||!n.endsWith("*")||n.endsWith("/*"),`Route path "${n}" will be treated as if it were "${n.replace(/\*$/,"/*")}" because the \`*\` character must always follow a \`/\` in the pattern. To get rid of this warning, please change the route path to "${n.replace(/\*$/,"/*")}".`);let s=[],r="^"+n.replace(/\/*\*?$/,"").replace(/^\/*/,"/").replace(/[\\.*+^${}|()[\]]/g,"\\$&").replace(/\/:([\w-]+)(\?)?/g,(o,l,u)=>(s.push({paramName:l,isOptional:u!=null}),u?"/?([^\\/]+)?":"/([^\\/]+)"));return n.endsWith("*")?(s.push({paramName:"*"}),r+=n==="*"||n==="/*"?"(.*)$":"(?:\\/(.+)|\\/*)$"):e?r+="\\/*$":n!==""&&n!=="/"&&(r+="(?:(?=\\/|$))"),[new RegExp(r,t?void 0:"i"),s]}function fV(n){try{return n.split("/").map(t=>decodeURIComponent(t).replace(/\//g,"%2F")).join("/")}catch(t){return ji(!1,`The URL path "${n}" could not be decoded because it is a malformed URL segment. This is probably due to a bad percent encoding (${t}).`),n}}function Fo(n,t){if(t==="/")return n;if(!n.toLowerCase().startsWith(t.toLowerCase()))return null;let e=t.endsWith("/")?t.length-1:t.length,s=n.charAt(e);return s&&s!=="/"?null:n.slice(e)||"/"}function pV(n,t="/"){let{pathname:e,search:s="",hash:r=""}=typeof n=="string"?eh(n):n;return{pathname:e?e.startsWith("/")?e:mV(e,t):t,search:xV(s),hash:bV(r)}}function mV(n,t){let e=t.replace(/\/+$/,"").split("/");return n.split("/").forEach(r=>{r===".."?e.length>1&&e.pop():r!=="."&&e.push(r)}),e.length>1?e.join("/"):"/"}function H1(n,t,e,s){return`Cannot include a '${n}' character in a manually specified \`to.${t}\` field [${JSON.stringify(s)}].  Please separate it out to the \`to.${e}\` field. Alternatively you may provide the full path as a string in <Link to="..."> and the router will parse it for you.`}function gV(n){return n.filter((t,e)=>e===0||t.route.path&&t.route.path.length>0)}function IN(n){let t=gV(n);return t.map((e,s)=>s===t.length-1?e.pathname:e.pathnameBase)}function _N(n,t,e,s=!1){let r;typeof n=="string"?r=eh(n):(r={...n},fn(!r.pathname||!r.pathname.includes("?"),H1("?","pathname","search",r)),fn(!r.pathname||!r.pathname.includes("#"),H1("#","pathname","hash",r)),fn(!r.search||!r.search.includes("#"),H1("#","search","hash",r)));let i=n===""||r.pathname==="",o=i?"/":r.pathname,l;if(o==null)l=e;else{let p=t.length-1;if(!s&&o.startsWith("..")){let m=o.split("/");for(;m[0]==="..";)m.shift(),p-=1;r.pathname=m.join("/")}l=p>=0?t[p]:"/"}let u=pV(r,l),h=o&&o!=="/"&&o.endsWith("/"),d=(i||o===".")&&e.endsWith("/");return!u.pathname.endsWith("/")&&(h||d)&&(u.pathname+="/"),u}var Oo=n=>n.join("/").replace(/\/\/+/g,"/"),yV=n=>n.replace(/\/+$/,"").replace(/^\/*/,"/"),xV=n=>!n||n==="?"?"":n.startsWith("?")?n:"?"+n,bV=n=>!n||n==="#"?"":n.startsWith("#")?n:"#"+n;function vV(n){return n!=null&&typeof n.status=="number"&&typeof n.statusText=="string"&&typeof n.internal=="boolean"&&"data"in n}var kN=["POST","PUT","PATCH","DELETE"];new Set(kN);var wV=["GET",...kN];new Set(wV);var nh=bt.createContext(null);nh.displayName="DataRouter";var Zy=bt.createContext(null);Zy.displayName="DataRouterState";var AN=bt.createContext({isTransitioning:!1});AN.displayName="ViewTransition";var CV=bt.createContext(new Map);CV.displayName="Fetchers";var SV=bt.createContext(null);SV.displayName="Await";var eo=bt.createContext(null);eo.displayName="Navigation";var Tf=bt.createContext(null);Tf.displayName="Location";var Wo=bt.createContext({outlet:null,matches:[],isDataRoute:!1});Wo.displayName="Route";var Nw=bt.createContext(null);Nw.displayName="RouteError";function TV(n,{relative:t}={}){fn(Ef(),"useHref() may be used only in the context of a <Router> component.");let{basename:e,navigator:s}=bt.useContext(eo),{hash:r,pathname:i,search:o}=If(n,{relative:t}),l=i;return e!=="/"&&(l=i==="/"?e:Oo([e,i])),s.createHref({pathname:l,search:o,hash:r})}function Ef(){return bt.useContext(Tf)!=null}function mu(){return fn(Ef(),"useLocation() may be used only in the context of a <Router> component."),bt.useContext(Tf).location}var NN="You should call navigate() in a React.useEffect(), not when your component is first rendered.";function RN(n){bt.useContext(eo).static||bt.useLayoutEffect(n)}function EV(){let{isDataRoute:n}=bt.useContext(Wo);return n?PV():IV()}function IV(){fn(Ef(),"useNavigate() may be used only in the context of a <Router> component.");let n=bt.useContext(nh),{basename:t,navigator:e}=bt.useContext(eo),{matches:s}=bt.useContext(Wo),{pathname:r}=mu(),i=JSON.stringify(IN(s)),o=bt.useRef(!1);return RN(()=>{o.current=!0}),bt.useCallback((u,h={})=>{if(ji(o.current,NN),!o.current)return;if(typeof u=="number"){e.go(u);return}let d=_N(u,JSON.parse(i),r,h.relative==="path");n==null&&t!=="/"&&(d.pathname=d.pathname==="/"?t:Oo([t,d.pathname])),(h.replace?e.replace:e.push)(d,h.state,h)},[t,e,i,r,n])}bt.createContext(null);function If(n,{relative:t}={}){let{matches:e}=bt.useContext(Wo),{pathname:s}=mu(),r=JSON.stringify(IN(e));return bt.useMemo(()=>_N(n,JSON.parse(r),s,t==="path"),[n,r,s,t])}function _V(n,t){return $N(n,t)}function $N(n,t,e,s){var S;fn(Ef(),"useRoutes() may be used only in the context of a <Router> component.");let{navigator:r}=bt.useContext(eo),{matches:i}=bt.useContext(Wo),o=i[i.length-1],l=o?o.params:{},u=o?o.pathname:"/",h=o?o.pathnameBase:"/",d=o&&o.route;{let E=d&&d.path||"";DN(u,!d||E.endsWith("*")||E.endsWith("*?"),`You rendered descendant <Routes> (or called \`useRoutes()\`) at "${u}" (under <Route path="${E}">) but the parent route path has no trailing "*". This means if you navigate deeper, the parent won't match anymore and therefore the child routes will never render.

Please change the parent <Route path="${E}"> to <Route path="${E==="/"?"*":`${E}/*`}">.`)}let p=mu(),m;if(t){let E=typeof t=="string"?eh(t):t;fn(h==="/"||((S=E.pathname)==null?void 0:S.startsWith(h)),`When overriding the location using \`<Routes location>\` or \`useRoutes(routes, location)\`, the location pathname must begin with the portion of the URL pathname that was matched by all parent routes. The current pathname base is "${h}" but pathname "${E.pathname}" was given in the \`location\` prop.`),m=E}else m=p;let y=m.pathname||"/",x=y;if(h!=="/"){let E=h.replace(/^\//,"").split("/");x="/"+y.replace(/^\//,"").split("/").slice(E.length).join("/")}let v=SN(n,{pathname:x});ji(d||v!=null,`No routes matched location "${m.pathname}${m.search}${m.hash}" `),ji(v==null||v[v.length-1].route.element!==void 0||v[v.length-1].route.Component!==void 0||v[v.length-1].route.lazy!==void 0,`Matched leaf route at location "${m.pathname}${m.search}${m.hash}" does not have an element or Component. This means it will render an <Outlet /> with a null value by default resulting in an "empty" page.`);let C=$V(v&&v.map(E=>Object.assign({},E,{params:Object.assign({},l,E.params),pathname:Oo([h,r.encodeLocation?r.encodeLocation(E.pathname).pathname:E.pathname]),pathnameBase:E.pathnameBase==="/"?h:Oo([h,r.encodeLocation?r.encodeLocation(E.pathnameBase).pathname:E.pathnameBase])})),i,e,s);return t&&C?bt.createElement(Tf.Provider,{value:{location:{pathname:"/",search:"",hash:"",state:null,key:"default",...m},navigationType:"POP"}},C):C}function kV(){let n=LV(),t=vV(n)?`${n.status} ${n.statusText}`:n instanceof Error?n.message:JSON.stringify(n),e=n instanceof Error?n.stack:null,s="rgba(200,200,200, 0.5)",r={padding:"0.5rem",backgroundColor:s},i={padding:"2px 4px",backgroundColor:s},o=null;return console.error("Error handled by React Router default ErrorBoundary:",n),o=bt.createElement(bt.Fragment,null,bt.createElement("p",null,"💿 Hey developer 👋"),bt.createElement("p",null,"You can provide a way better UX than this when your app throws errors by providing your own ",bt.createElement("code",{style:i},"ErrorBoundary")," or"," ",bt.createElement("code",{style:i},"errorElement")," prop on your route.")),bt.createElement(bt.Fragment,null,bt.createElement("h2",null,"Unexpected Application Error!"),bt.createElement("h3",{style:{fontStyle:"italic"}},t),e?bt.createElement("pre",{style:r},e):null,o)}var AV=bt.createElement(kV,null),NV=class extends bt.Component{constructor(n){super(n),this.state={location:n.location,revalidation:n.revalidation,error:n.error}}static getDerivedStateFromError(n){return{error:n}}static getDerivedStateFromProps(n,t){return t.location!==n.location||t.revalidation!=="idle"&&n.revalidation==="idle"?{error:n.error,location:n.location,revalidation:n.revalidation}:{error:n.error!==void 0?n.error:t.error,location:t.location,revalidation:n.revalidation||t.revalidation}}componentDidCatch(n,t){console.error("React Router caught the following error during render",n,t)}render(){return this.state.error!==void 0?bt.createElement(Wo.Provider,{value:this.props.routeContext},bt.createElement(Nw.Provider,{value:this.state.error,children:this.props.component})):this.props.children}};function RV({routeContext:n,match:t,children:e}){let s=bt.useContext(nh);return s&&s.static&&s.staticContext&&(t.route.errorElement||t.route.ErrorBoundary)&&(s.staticContext._deepestRenderedBoundaryId=t.route.id),bt.createElement(Wo.Provider,{value:n},e)}function $V(n,t=[],e=null,s=null){if(n==null){if(!e)return null;if(e.errors)n=e.matches;else if(t.length===0&&!e.initialized&&e.matches.length>0)n=e.matches;else return null}let r=n,i=e==null?void 0:e.errors;if(i!=null){let u=r.findIndex(h=>h.route.id&&(i==null?void 0:i[h.route.id])!==void 0);fn(u>=0,`Could not find a matching route for errors on route IDs: ${Object.keys(i).join(",")}`),r=r.slice(0,Math.min(r.length,u+1))}let o=!1,l=-1;if(e)for(let u=0;u<r.length;u++){let h=r[u];if((h.route.HydrateFallback||h.route.hydrateFallbackElement)&&(l=u),h.route.id){let{loaderData:d,errors:p}=e,m=h.route.loader&&!d.hasOwnProperty(h.route.id)&&(!p||p[h.route.id]===void 0);if(h.route.lazy||m){o=!0,l>=0?r=r.slice(0,l+1):r=[r[0]];break}}}return r.reduceRight((u,h,d)=>{let p,m=!1,y=null,x=null;e&&(p=i&&h.route.id?i[h.route.id]:void 0,y=h.route.errorElement||AV,o&&(l<0&&d===0?(DN("route-fallback",!1,"No `HydrateFallback` element provided to render during initial hydration"),m=!0,x=null):l===d&&(m=!0,x=h.route.hydrateFallbackElement||null)));let v=t.concat(r.slice(0,d+1)),C=()=>{let S;return p?S=y:m?S=x:h.route.Component?S=bt.createElement(h.route.Component,null):h.route.element?S=h.route.element:S=u,bt.createElement(RV,{match:h,routeContext:{outlet:u,matches:v,isDataRoute:e!=null},children:S})};return e&&(h.route.ErrorBoundary||h.route.errorElement||d===0)?bt.createElement(NV,{location:e.location,revalidation:e.revalidation,component:y,error:p,children:C(),routeContext:{outlet:null,matches:v,isDataRoute:!0}}):C()},null)}function Rw(n){return`${n} must be used within a data router.  See https://reactrouter.com/en/main/routers/picking-a-router.`}function DV(n){let t=bt.useContext(nh);return fn(t,Rw(n)),t}function OV(n){let t=bt.useContext(Zy);return fn(t,Rw(n)),t}function MV(n){let t=bt.useContext(Wo);return fn(t,Rw(n)),t}function $w(n){let t=MV(n),e=t.matches[t.matches.length-1];return fn(e.route.id,`${n} can only be used on routes that contain a unique "id"`),e.route.id}function FV(){return $w("useRouteId")}function LV(){var s;let n=bt.useContext(Nw),t=OV("useRouteError"),e=$w("useRouteError");return n!==void 0?n:(s=t.errors)==null?void 0:s[e]}function PV(){let{router:n}=DV("useNavigate"),t=$w("useNavigate"),e=bt.useRef(!1);return RN(()=>{e.current=!0}),bt.useCallback(async(r,i={})=>{ji(e.current,NN),e.current&&(typeof r=="number"?n.navigate(r):await n.navigate(r,{fromRouteId:t,...i}))},[n,t])}var C_={};function DN(n,t,e){!t&&!C_[n]&&(C_[n]=!0,ji(!1,e))}bt.memo(VV);function VV({routes:n,future:t,state:e}){return $N(n,void 0,e,t)}function Cv(n){fn(!1,"A <Route> is only ever to be used as the child of <Routes> element, never rendered directly. Please wrap your <Route> in a <Routes>.")}function zV({basename:n="/",children:t=null,location:e,navigationType:s="POP",navigator:r,static:i=!1}){fn(!Ef(),"You cannot render a <Router> inside another <Router>. You should never have more than one in your app.");let o=n.replace(/^\/*/,"/"),l=bt.useMemo(()=>({basename:o,navigator:r,static:i,future:{}}),[o,r,i]);typeof e=="string"&&(e=eh(e));let{pathname:u="/",search:h="",hash:d="",state:p=null,key:m="default"}=e,y=bt.useMemo(()=>{let x=Fo(u,o);return x==null?null:{location:{pathname:x,search:h,hash:d,state:p,key:m},navigationType:s}},[o,u,h,d,p,m,s]);return ji(y!=null,`<Router basename="${o}"> is not able to match the URL "${u}${h}${d}" because it does not start with the basename, so the <Router> won't render anything.`),y==null?null:bt.createElement(eo.Provider,{value:l},bt.createElement(Tf.Provider,{children:t,value:y}))}function BV({children:n,location:t}){return _V(Sv(n),t)}function Sv(n,t=[]){let e=[];return bt.Children.forEach(n,(s,r)=>{if(!bt.isValidElement(s))return;let i=[...t,r];if(s.type===bt.Fragment){e.push.apply(e,Sv(s.props.children,i));return}fn(s.type===Cv,`[${typeof s.type=="string"?s.type:s.type.name}] is not a <Route> component. All component children of <Routes> must be a <Route> or <React.Fragment>`),fn(!s.props.index||!s.props.children,"An index route cannot have child routes.");let o={id:s.props.id||i.join("-"),caseSensitive:s.props.caseSensitive,element:s.props.element,Component:s.props.Component,index:s.props.index,path:s.props.path,loader:s.props.loader,action:s.props.action,hydrateFallbackElement:s.props.hydrateFallbackElement,HydrateFallback:s.props.HydrateFallback,errorElement:s.props.errorElement,ErrorBoundary:s.props.ErrorBoundary,hasErrorBoundary:s.props.hasErrorBoundary===!0||s.props.ErrorBoundary!=null||s.props.errorElement!=null,shouldRevalidate:s.props.shouldRevalidate,handle:s.props.handle,lazy:s.props.lazy};s.props.children&&(o.children=Sv(s.props.children,i)),e.push(o)}),e}var Pg="get",Vg="application/x-www-form-urlencoded";function Jy(n){return n!=null&&typeof n.tagName=="string"}function UV(n){return Jy(n)&&n.tagName.toLowerCase()==="button"}function GV(n){return Jy(n)&&n.tagName.toLowerCase()==="form"}function WV(n){return Jy(n)&&n.tagName.toLowerCase()==="input"}function HV(n){return!!(n.metaKey||n.altKey||n.ctrlKey||n.shiftKey)}function qV(n,t){return n.button===0&&(!t||t==="_self")&&!HV(n)}var xg=null;function jV(){if(xg===null)try{new FormData(document.createElement("form"),0),xg=!1}catch{xg=!0}return xg}var KV=new Set(["application/x-www-form-urlencoded","multipart/form-data","text/plain"]);function q1(n){return n!=null&&!KV.has(n)?(ji(!1,`"${n}" is not a valid \`encType\` for \`<Form>\`/\`<fetcher.Form>\` and will default to "${Vg}"`),null):n}function XV(n,t){let e,s,r,i,o;if(GV(n)){let l=n.getAttribute("action");s=l?Fo(l,t):null,e=n.getAttribute("method")||Pg,r=q1(n.getAttribute("enctype"))||Vg,i=new FormData(n)}else if(UV(n)||WV(n)&&(n.type==="submit"||n.type==="image")){let l=n.form;if(l==null)throw new Error('Cannot submit a <button> or <input type="submit"> without a <form>');let u=n.getAttribute("formaction")||l.getAttribute("action");if(s=u?Fo(u,t):null,e=n.getAttribute("formmethod")||l.getAttribute("method")||Pg,r=q1(n.getAttribute("formenctype"))||q1(l.getAttribute("enctype"))||Vg,i=new FormData(l,n),!jV()){let{name:h,type:d,value:p}=n;if(d==="image"){let m=h?`${h}.`:"";i.append(`${m}x`,"0"),i.append(`${m}y`,"0")}else h&&i.append(h,p)}}else{if(Jy(n))throw new Error('Cannot submit element that is not <form>, <button>, or <input type="submit|image">');e=Pg,s=null,r=Vg,o=n}return i&&r==="text/plain"&&(o=i,i=void 0),{action:s,method:e.toLowerCase(),encType:r,formData:i,body:o}}function Dw(n,t){if(n===!1||n===null||typeof n>"u")throw new Error(t)}async function YV(n,t){if(n.id in t)return t[n.id];try{let e=await import(n.module);return t[n.id]=e,e}catch(e){return console.error(`Error loading route module \`${n.module}\`, reloading page...`),console.error(e),window.__reactRouterContext&&window.__reactRouterContext.isSpaMode,window.location.reload(),new Promise(()=>{})}}function QV(n){return n==null?!1:n.href==null?n.rel==="preload"&&typeof n.imageSrcSet=="string"&&typeof n.imageSizes=="string":typeof n.rel=="string"&&typeof n.href=="string"}async function ZV(n,t,e){let s=await Promise.all(n.map(async r=>{let i=t.routes[r.route.id];if(i){let o=await YV(i,e);return o.links?o.links():[]}return[]}));return nz(s.flat(1).filter(QV).filter(r=>r.rel==="stylesheet"||r.rel==="preload").map(r=>r.rel==="stylesheet"?{...r,rel:"prefetch",as:"style"}:{...r,rel:"prefetch"}))}function S_(n,t,e,s,r,i){let o=(u,h)=>e[h]?u.route.id!==e[h].route.id:!0,l=(u,h)=>{var d;return e[h].pathname!==u.pathname||((d=e[h].route.path)==null?void 0:d.endsWith("*"))&&e[h].params["*"]!==u.params["*"]};return i==="assets"?t.filter((u,h)=>o(u,h)||l(u,h)):i==="data"?t.filter((u,h)=>{var p;let d=s.routes[u.route.id];if(!d||!d.hasLoader)return!1;if(o(u,h)||l(u,h))return!0;if(u.route.shouldRevalidate){let m=u.route.shouldRevalidate({currentUrl:new URL(r.pathname+r.search+r.hash,window.origin),currentParams:((p=e[0])==null?void 0:p.params)||{},nextUrl:new URL(n,window.origin),nextParams:u.params,defaultShouldRevalidate:!0});if(typeof m=="boolean")return m}return!0}):[]}function JV(n,t,{includeHydrateFallback:e}={}){return tz(n.map(s=>{let r=t.routes[s.route.id];if(!r)return[];let i=[r.module];return r.clientActionModule&&(i=i.concat(r.clientActionModule)),r.clientLoaderModule&&(i=i.concat(r.clientLoaderModule)),e&&r.hydrateFallbackModule&&(i=i.concat(r.hydrateFallbackModule)),r.imports&&(i=i.concat(r.imports)),i}).flat(1))}function tz(n){return[...new Set(n)]}function ez(n){let t={},e=Object.keys(n).sort();for(let s of e)t[s]=n[s];return t}function nz(n,t){let e=new Set;return new Set(t),n.reduce((s,r)=>{let i=JSON.stringify(ez(r));return e.has(i)||(e.add(i),s.push({key:i,link:r})),s},[])}Object.getOwnPropertyNames(Object.prototype).sort().join("\0");var sz=new Set([100,101,204,205]);function rz(n,t){let e=typeof n=="string"?new URL(n,typeof window>"u"?"server://singlefetch/":window.location.origin):n;return e.pathname==="/"?e.pathname="_root.data":t&&Fo(e.pathname,t)==="/"?e.pathname=`${t.replace(/\/$/,"")}/_root.data`:e.pathname=`${e.pathname.replace(/\/$/,"")}.data`,e}function ON(){let n=bt.useContext(nh);return Dw(n,"You must render this element inside a <DataRouterContext.Provider> element"),n}function iz(){let n=bt.useContext(Zy);return Dw(n,"You must render this element inside a <DataRouterStateContext.Provider> element"),n}var Ow=bt.createContext(void 0);Ow.displayName="FrameworkContext";function MN(){let n=bt.useContext(Ow);return Dw(n,"You must render this element inside a <HydratedRouter> element"),n}function oz(n,t){let e=bt.useContext(Ow),[s,r]=bt.useState(!1),[i,o]=bt.useState(!1),{onFocus:l,onBlur:u,onMouseEnter:h,onMouseLeave:d,onTouchStart:p}=t,m=bt.useRef(null);bt.useEffect(()=>{if(n==="render"&&o(!0),n==="viewport"){let v=S=>{S.forEach(E=>{o(E.isIntersecting)})},C=new IntersectionObserver(v,{threshold:.5});return m.current&&C.observe(m.current),()=>{C.disconnect()}}},[n]),bt.useEffect(()=>{if(s){let v=setTimeout(()=>{o(!0)},100);return()=>{clearTimeout(v)}}},[s]);let y=()=>{r(!0)},x=()=>{r(!1),o(!1)};return e?n!=="intent"?[i,m,{}]:[i,m,{onFocus:$d(l,y),onBlur:$d(u,x),onMouseEnter:$d(h,y),onMouseLeave:$d(d,x),onTouchStart:$d(p,y)}]:[!1,m,{}]}function $d(n,t){return e=>{n&&n(e),e.defaultPrevented||t(e)}}function az({page:n,...t}){let{router:e}=ON(),s=bt.useMemo(()=>SN(e.routes,n,e.basename),[e.routes,n,e.basename]);return s?bt.createElement(uz,{page:n,matches:s,...t}):null}function lz(n){let{manifest:t,routeModules:e}=MN(),[s,r]=bt.useState([]);return bt.useEffect(()=>{let i=!1;return ZV(n,t,e).then(o=>{i||r(o)}),()=>{i=!0}},[n,t,e]),s}function uz({page:n,matches:t,...e}){let s=mu(),{manifest:r,routeModules:i}=MN(),{basename:o}=ON(),{loaderData:l,matches:u}=iz(),h=bt.useMemo(()=>S_(n,t,u,r,s,"data"),[n,t,u,r,s]),d=bt.useMemo(()=>S_(n,t,u,r,s,"assets"),[n,t,u,r,s]),p=bt.useMemo(()=>{if(n===s.pathname+s.search+s.hash)return[];let x=new Set,v=!1;if(t.forEach(S=>{var _;let E=r.routes[S.route.id];!E||!E.hasLoader||(!h.some(I=>I.route.id===S.route.id)&&S.route.id in l&&((_=i[S.route.id])!=null&&_.shouldRevalidate)||E.hasClientLoader?v=!0:x.add(S.route.id))}),x.size===0)return[];let C=rz(n,o);return v&&x.size>0&&C.searchParams.set("_routes",t.filter(S=>x.has(S.route.id)).map(S=>S.route.id).join(",")),[C.pathname+C.search]},[o,l,s,r,h,t,n,i]),m=bt.useMemo(()=>JV(d,r),[d,r]),y=lz(d);return bt.createElement(bt.Fragment,null,p.map(x=>bt.createElement("link",{key:x,rel:"prefetch",as:"fetch",href:x,...e})),m.map(x=>bt.createElement("link",{key:x,rel:"modulepreload",href:x,...e})),y.map(({key:x,link:v})=>bt.createElement("link",{key:x,...v})))}function cz(...n){return t=>{n.forEach(e=>{typeof e=="function"?e(t):e!=null&&(e.current=t)})}}var FN=typeof window<"u"&&typeof window.document<"u"&&typeof window.document.createElement<"u";try{FN&&(window.__reactRouterVersion="7.6.2")}catch{}function hz({basename:n,children:t,window:e}){let s=bt.useRef();s.current==null&&(s.current=Q4({window:e,v5Compat:!0}));let r=s.current,[i,o]=bt.useState({action:r.action,location:r.location}),l=bt.useCallback(u=>{bt.startTransition(()=>o(u))},[o]);return bt.useLayoutEffect(()=>r.listen(l),[r,l]),bt.createElement(zV,{basename:n,children:t,location:i.location,navigationType:i.action,navigator:r})}var LN=/^(?:[a-z][a-z0-9+.-]*:|\/\/)/i,PN=bt.forwardRef(function({onClick:t,discover:e="render",prefetch:s="none",relative:r,reloadDocument:i,replace:o,state:l,target:u,to:h,preventScrollReset:d,viewTransition:p,...m},y){let{basename:x}=bt.useContext(eo),v=typeof h=="string"&&LN.test(h),C,S=!1;if(typeof h=="string"&&v&&(C=h,FN))try{let R=new URL(window.location.href),$=h.startsWith("//")?new URL(R.protocol+h):new URL(h),A=Fo($.pathname,x);$.origin===R.origin&&A!=null?h=A+$.search+$.hash:S=!0}catch{ji(!1,`<Link to="${h}"> contains an invalid URL which will probably break when clicked - please update to a valid URL path.`)}let E=TV(h,{relative:r}),[_,I,O]=oz(s,m),P=pz(h,{replace:o,state:l,target:u,preventScrollReset:d,relative:r,viewTransition:p});function D(R){t&&t(R),R.defaultPrevented||P(R)}let N=bt.createElement("a",{...m,...O,href:C||E,onClick:S||i?t:D,ref:cz(y,I),target:u,"data-discover":!v&&e==="render"?"true":void 0});return _&&!v?bt.createElement(bt.Fragment,null,N,bt.createElement(az,{page:E})):N});PN.displayName="Link";var Tv=bt.forwardRef(function({"aria-current":t="page",caseSensitive:e=!1,className:s="",end:r=!1,style:i,to:o,viewTransition:l,children:u,...h},d){let p=If(o,{relative:h.relative}),m=mu(),y=bt.useContext(Zy),{navigator:x,basename:v}=bt.useContext(eo),C=y!=null&&bz(p)&&l===!0,S=x.encodeLocation?x.encodeLocation(p).pathname:p.pathname,E=m.pathname,_=y&&y.navigation&&y.navigation.location?y.navigation.location.pathname:null;e||(E=E.toLowerCase(),_=_?_.toLowerCase():null,S=S.toLowerCase()),_&&v&&(_=Fo(_,v)||_);const I=S!=="/"&&S.endsWith("/")?S.length-1:S.length;let O=E===S||!r&&E.startsWith(S)&&E.charAt(I)==="/",P=_!=null&&(_===S||!r&&_.startsWith(S)&&_.charAt(S.length)==="/"),D={isActive:O,isPending:P,isTransitioning:C},N=O?t:void 0,R;typeof s=="function"?R=s(D):R=[s,O?"active":null,P?"pending":null,C?"transitioning":null].filter(Boolean).join(" ");let $=typeof i=="function"?i(D):i;return bt.createElement(PN,{...h,"aria-current":N,className:R,ref:d,style:$,to:o,viewTransition:l},typeof u=="function"?u(D):u)});Tv.displayName="NavLink";var dz=bt.forwardRef(({discover:n="render",fetcherKey:t,navigate:e,reloadDocument:s,replace:r,state:i,method:o=Pg,action:l,onSubmit:u,relative:h,preventScrollReset:d,viewTransition:p,...m},y)=>{let x=yz(),v=xz(l,{relative:h}),C=o.toLowerCase()==="get"?"get":"post",S=typeof l=="string"&&LN.test(l),E=_=>{if(u&&u(_),_.defaultPrevented)return;_.preventDefault();let I=_.nativeEvent.submitter,O=(I==null?void 0:I.getAttribute("formmethod"))||o;x(I||_.currentTarget,{fetcherKey:t,method:O,navigate:e,replace:r,state:i,relative:h,preventScrollReset:d,viewTransition:p})};return bt.createElement("form",{ref:y,method:C,action:v,onSubmit:s?u:E,...m,"data-discover":!S&&n==="render"?"true":void 0})});dz.displayName="Form";function fz(n){return`${n} must be used within a data router.  See https://reactrouter.com/en/main/routers/picking-a-router.`}function VN(n){let t=bt.useContext(nh);return fn(t,fz(n)),t}function pz(n,{target:t,replace:e,state:s,preventScrollReset:r,relative:i,viewTransition:o}={}){let l=EV(),u=mu(),h=If(n,{relative:i});return bt.useCallback(d=>{if(qV(d,t)){d.preventDefault();let p=e!==void 0?e:tf(u)===tf(h);l(n,{replace:p,state:s,preventScrollReset:r,relative:i,viewTransition:o})}},[u,l,h,e,s,t,n,r,i,o])}var mz=0,gz=()=>`__${String(++mz)}__`;function yz(){let{router:n}=VN("useSubmit"),{basename:t}=bt.useContext(eo),e=FV();return bt.useCallback(async(s,r={})=>{let{action:i,method:o,encType:l,formData:u,body:h}=XV(s,t);if(r.navigate===!1){let d=r.fetcherKey||gz();await n.fetch(d,e,r.action||i,{preventScrollReset:r.preventScrollReset,formData:u,body:h,formMethod:r.method||o,formEncType:r.encType||l,flushSync:r.flushSync})}else await n.navigate(r.action||i,{preventScrollReset:r.preventScrollReset,formData:u,body:h,formMethod:r.method||o,formEncType:r.encType||l,replace:r.replace,state:r.state,fromRouteId:e,flushSync:r.flushSync,viewTransition:r.viewTransition})},[n,t,e])}function xz(n,{relative:t}={}){let{basename:e}=bt.useContext(eo),s=bt.useContext(Wo);fn(s,"useFormAction must be used inside a RouteContext");let[r]=s.matches.slice(-1),i={...If(n||".",{relative:t})},o=mu();if(n==null){i.search=o.search;let l=new URLSearchParams(i.search),u=l.getAll("index");if(u.some(d=>d==="")){l.delete("index"),u.filter(p=>p).forEach(p=>l.append("index",p));let d=l.toString();i.search=d?`?${d}`:""}}return(!n||n===".")&&r.route.index&&(i.search=i.search?i.search.replace(/^\?/,"?index&"):"?index"),e!=="/"&&(i.pathname=i.pathname==="/"?e:Oo([e,i.pathname])),tf(i)}function bz(n,t={}){let e=bt.useContext(AN);fn(e!=null,"`useViewTransitionState` must be used within `react-router-dom`'s `RouterProvider`.  Did you accidentally import `RouterProvider` from `react-router`?");let{basename:s}=VN("useViewTransitionState"),r=If(n,{relative:t.relative});if(!e.isTransitioning)return!1;let i=Fo(e.currentLocation.pathname,s)||e.currentLocation.pathname,o=Fo(e.nextLocation.pathname,s)||e.nextLocation.pathname;return ny(r.pathname,o)!=null||ny(r.pathname,i)!=null}[...sz];var zg={exports:{}},vz=zg.exports,T_;function wz(){return T_||(T_=1,function(n,t){(function(s,r){n.exports=r(Qy())})(vz,function(e){return function(s){var r={};function i(o){if(r[o])return r[o].exports;var l=r[o]={i:o,l:!1,exports:{}};return s[o].call(l.exports,l,l.exports,i),l.l=!0,l.exports}return i.m=s,i.c=r,i.d=function(o,l,u){i.o(o,l)||Object.defineProperty(o,l,{enumerable:!0,get:u})},i.r=function(o){typeof Symbol<"u"&&Symbol.toStringTag&&Object.defineProperty(o,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(o,"__esModule",{value:!0})},i.t=function(o,l){if(l&1&&(o=i(o)),l&8||l&4&&typeof o=="object"&&o&&o.__esModule)return o;var u=Object.create(null);if(i.r(u),Object.defineProperty(u,"default",{enumerable:!0,value:o}),l&2&&typeof o!="string")for(var h in o)i.d(u,h,(function(d){return o[d]}).bind(null,h));return u},i.n=function(o){var l=o&&o.__esModule?function(){return o.default}:function(){return o};return i.d(l,"a",l),l},i.o=function(o,l){return Object.prototype.hasOwnProperty.call(o,l)},i.p="",i(i.s="./src/react-webcam.tsx")}({"./src/react-webcam.tsx":function(s,r,i){i.r(r);var o=i("react"),l=function(){var m=function(y,x){return m=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(v,C){v.__proto__=C}||function(v,C){for(var S in C)C.hasOwnProperty(S)&&(v[S]=C[S])},m(y,x)};return function(y,x){m(y,x);function v(){this.constructor=y}y.prototype=x===null?Object.create(x):(v.prototype=x.prototype,new v)}}(),u=function(){return u=Object.assign||function(m){for(var y,x=1,v=arguments.length;x<v;x++){y=arguments[x];for(var C in y)Object.prototype.hasOwnProperty.call(y,C)&&(m[C]=y[C])}return m},u.apply(this,arguments)},h=function(m,y){var x={};for(var v in m)Object.prototype.hasOwnProperty.call(m,v)&&y.indexOf(v)<0&&(x[v]=m[v]);if(m!=null&&typeof Object.getOwnPropertySymbols=="function")for(var C=0,v=Object.getOwnPropertySymbols(m);C<v.length;C++)y.indexOf(v[C])<0&&Object.prototype.propertyIsEnumerable.call(m,v[C])&&(x[v[C]]=m[v[C]]);return x};(function(){typeof window>"u"||(navigator.mediaDevices===void 0&&(navigator.mediaDevices={}),navigator.mediaDevices.getUserMedia===void 0&&(navigator.mediaDevices.getUserMedia=function(y){var x=navigator.getUserMedia||navigator.webkitGetUserMedia||navigator.mozGetUserMedia||navigator.msGetUserMedia;return x?new Promise(function(v,C){x.call(navigator,y,v,C)}):Promise.reject(new Error("getUserMedia is not implemented in this browser"))}))})();function d(){return!!(navigator.mediaDevices&&navigator.mediaDevices.getUserMedia)}var p=function(m){l(y,m);function y(x){var v=m.call(this,x)||this;return v.canvas=null,v.ctx=null,v.requestUserMediaId=0,v.unmounted=!1,v.state={hasUserMedia:!1},v}return y.prototype.componentDidMount=function(){var x=this,v=x.state,C=x.props;if(this.unmounted=!1,!d()){C.onUserMediaError("getUserMedia not supported");return}v.hasUserMedia||this.requestUserMedia(),C.children&&typeof C.children!="function"&&console.warn("children must be a function")},y.prototype.componentDidUpdate=function(x){var v=this.props;if(!d()){v.onUserMediaError("getUserMedia not supported");return}var C=JSON.stringify(x.audioConstraints)!==JSON.stringify(v.audioConstraints),S=JSON.stringify(x.videoConstraints)!==JSON.stringify(v.videoConstraints),E=x.minScreenshotWidth!==v.minScreenshotWidth,_=x.minScreenshotHeight!==v.minScreenshotHeight;(S||E||_)&&(this.canvas=null,this.ctx=null),(C||S)&&(this.stopAndCleanup(),this.requestUserMedia())},y.prototype.componentWillUnmount=function(){this.unmounted=!0,this.stopAndCleanup()},y.stopMediaStream=function(x){x&&(x.getVideoTracks&&x.getAudioTracks?(x.getVideoTracks().map(function(v){x.removeTrack(v),v.stop()}),x.getAudioTracks().map(function(v){x.removeTrack(v),v.stop()})):x.stop())},y.prototype.stopAndCleanup=function(){var x=this.state;x.hasUserMedia&&(y.stopMediaStream(this.stream),x.src&&window.URL.revokeObjectURL(x.src))},y.prototype.getScreenshot=function(x){var v=this,C=v.state,S=v.props;if(!C.hasUserMedia)return null;var E=this.getCanvas(x);return E&&E.toDataURL(S.screenshotFormat,S.screenshotQuality)},y.prototype.getCanvas=function(x){var v=this,C=v.state,S=v.props;if(!this.video||!C.hasUserMedia||!this.video.videoHeight)return null;if(!this.ctx){var E=this.video.videoWidth,_=this.video.videoHeight;if(!this.props.forceScreenshotSourceSize){var I=E/_;E=S.minScreenshotWidth||this.video.clientWidth,_=E/I,S.minScreenshotHeight&&_<S.minScreenshotHeight&&(_=S.minScreenshotHeight,E=_*I)}this.canvas=document.createElement("canvas"),this.canvas.width=(x==null?void 0:x.width)||E,this.canvas.height=(x==null?void 0:x.height)||_,this.ctx=this.canvas.getContext("2d")}var O=this,P=O.ctx,D=O.canvas;return P&&D&&(D.width=(x==null?void 0:x.width)||D.width,D.height=(x==null?void 0:x.height)||D.height,S.mirrored&&(P.translate(D.width,0),P.scale(-1,1)),P.imageSmoothingEnabled=S.imageSmoothing,P.drawImage(this.video,0,0,(x==null?void 0:x.width)||D.width,(x==null?void 0:x.height)||D.height),S.mirrored&&(P.scale(-1,1),P.translate(-D.width,0))),D},y.prototype.requestUserMedia=function(){var x=this,v=this.props,C=function(_,I){var O={video:typeof I<"u"?I:!0};v.audio&&(O.audio=typeof _<"u"?_:!0),x.requestUserMediaId++;var P=x.requestUserMediaId;navigator.mediaDevices.getUserMedia(O).then(function(D){x.unmounted||P!==x.requestUserMediaId?y.stopMediaStream(D):x.handleUserMedia(null,D)}).catch(function(D){x.handleUserMedia(D)})};if("mediaDevices"in navigator)C(v.audioConstraints,v.videoConstraints);else{var S=function(_){return{optional:[{sourceId:_}]}},E=function(_){var I=_.deviceId;return typeof I=="string"?I:Array.isArray(I)&&I.length>0?I[0]:typeof I=="object"&&I.ideal?I.ideal:null};MediaStreamTrack.getSources(function(_){var I=null,O=null;_.forEach(function(N){N.kind==="audio"?I=N.id:N.kind==="video"&&(O=N.id)});var P=E(v.audioConstraints);P&&(I=P);var D=E(v.videoConstraints);D&&(O=D),C(S(I),S(O))})}},y.prototype.handleUserMedia=function(x,v){var C=this.props;if(x||!v){this.setState({hasUserMedia:!1}),C.onUserMediaError(x);return}this.stream=v;try{this.video&&(this.video.srcObject=v),this.setState({hasUserMedia:!0})}catch{this.setState({hasUserMedia:!0,src:window.URL.createObjectURL(v)})}C.onUserMedia(v)},y.prototype.render=function(){var x=this,v=this,C=v.state,S=v.props,E=S.audio;S.forceScreenshotSourceSize;var _=S.disablePictureInPicture;S.onUserMedia,S.onUserMediaError,S.screenshotFormat,S.screenshotQuality,S.minScreenshotWidth,S.minScreenshotHeight,S.audioConstraints,S.videoConstraints,S.imageSmoothing;var I=S.mirrored,O=S.style,P=O===void 0?{}:O,D=S.children,N=h(S,["audio","forceScreenshotSourceSize","disablePictureInPicture","onUserMedia","onUserMediaError","screenshotFormat","screenshotQuality","minScreenshotWidth","minScreenshotHeight","audioConstraints","videoConstraints","imageSmoothing","mirrored","style","children"]),R=I?u(u({},P),{transform:(P.transform||"")+" scaleX(-1)"}):P,$={getScreenshot:this.getScreenshot.bind(this)};return o.createElement(o.Fragment,null,o.createElement("video",u({autoPlay:!0,disablePictureInPicture:_,src:C.src,muted:!E,playsInline:!0,ref:function(A){x.video=A},style:R},N)),D&&D($))},y.defaultProps={audio:!1,disablePictureInPicture:!1,forceScreenshotSourceSize:!1,imageSmoothing:!0,mirrored:!1,onUserMedia:function(){},onUserMediaError:function(){},screenshotFormat:"image/webp",screenshotQuality:.92},y}(o.Component);r.default=p},react:function(s,r){s.exports=e}}).default})}(zg)),zg.exports}var Cz=wz();const Sz=Yy(Cz),Tz=()=>{};var E_={};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const zN=function(n){const t=[];let e=0;for(let s=0;s<n.length;s++){let r=n.charCodeAt(s);r<128?t[e++]=r:r<2048?(t[e++]=r>>6|192,t[e++]=r&63|128):(r&64512)===55296&&s+1<n.length&&(n.charCodeAt(s+1)&64512)===56320?(r=65536+((r&1023)<<10)+(n.charCodeAt(++s)&1023),t[e++]=r>>18|240,t[e++]=r>>12&63|128,t[e++]=r>>6&63|128,t[e++]=r&63|128):(t[e++]=r>>12|224,t[e++]=r>>6&63|128,t[e++]=r&63|128)}return t},Ez=function(n){const t=[];let e=0,s=0;for(;e<n.length;){const r=n[e++];if(r<128)t[s++]=String.fromCharCode(r);else if(r>191&&r<224){const i=n[e++];t[s++]=String.fromCharCode((r&31)<<6|i&63)}else if(r>239&&r<365){const i=n[e++],o=n[e++],l=n[e++],u=((r&7)<<18|(i&63)<<12|(o&63)<<6|l&63)-65536;t[s++]=String.fromCharCode(55296+(u>>10)),t[s++]=String.fromCharCode(56320+(u&1023))}else{const i=n[e++],o=n[e++];t[s++]=String.fromCharCode((r&15)<<12|(i&63)<<6|o&63)}}return t.join("")},BN={byteToCharMap_:null,charToByteMap_:null,byteToCharMapWebSafe_:null,charToByteMapWebSafe_:null,ENCODED_VALS_BASE:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",get ENCODED_VALS(){return this.ENCODED_VALS_BASE+"+/="},get ENCODED_VALS_WEBSAFE(){return this.ENCODED_VALS_BASE+"-_."},HAS_NATIVE_SUPPORT:typeof atob=="function",encodeByteArray(n,t){if(!Array.isArray(n))throw Error("encodeByteArray takes an array as a parameter");this.init_();const e=t?this.byteToCharMapWebSafe_:this.byteToCharMap_,s=[];for(let r=0;r<n.length;r+=3){const i=n[r],o=r+1<n.length,l=o?n[r+1]:0,u=r+2<n.length,h=u?n[r+2]:0,d=i>>2,p=(i&3)<<4|l>>4;let m=(l&15)<<2|h>>6,y=h&63;u||(y=64,o||(m=64)),s.push(e[d],e[p],e[m],e[y])}return s.join("")},encodeString(n,t){return this.HAS_NATIVE_SUPPORT&&!t?btoa(n):this.encodeByteArray(zN(n),t)},decodeString(n,t){return this.HAS_NATIVE_SUPPORT&&!t?atob(n):Ez(this.decodeStringToByteArray(n,t))},decodeStringToByteArray(n,t){this.init_();const e=t?this.charToByteMapWebSafe_:this.charToByteMap_,s=[];for(let r=0;r<n.length;){const i=e[n.charAt(r++)],l=r<n.length?e[n.charAt(r)]:0;++r;const h=r<n.length?e[n.charAt(r)]:64;++r;const p=r<n.length?e[n.charAt(r)]:64;if(++r,i==null||l==null||h==null||p==null)throw new Iz;const m=i<<2|l>>4;if(s.push(m),h!==64){const y=l<<4&240|h>>2;if(s.push(y),p!==64){const x=h<<6&192|p;s.push(x)}}}return s},init_(){if(!this.byteToCharMap_){this.byteToCharMap_={},this.charToByteMap_={},this.byteToCharMapWebSafe_={},this.charToByteMapWebSafe_={};for(let n=0;n<this.ENCODED_VALS.length;n++)this.byteToCharMap_[n]=this.ENCODED_VALS.charAt(n),this.charToByteMap_[this.byteToCharMap_[n]]=n,this.byteToCharMapWebSafe_[n]=this.ENCODED_VALS_WEBSAFE.charAt(n),this.charToByteMapWebSafe_[this.byteToCharMapWebSafe_[n]]=n,n>=this.ENCODED_VALS_BASE.length&&(this.charToByteMap_[this.ENCODED_VALS_WEBSAFE.charAt(n)]=n,this.charToByteMapWebSafe_[this.ENCODED_VALS.charAt(n)]=n)}}};class Iz extends Error{constructor(){super(...arguments),this.name="DecodeBase64StringError"}}const _z=function(n){const t=zN(n);return BN.encodeByteArray(t,!0)},sy=function(n){return _z(n).replace(/\./g,"")},kz=function(n){try{return BN.decodeString(n,!0)}catch(t){console.error("base64Decode failed: ",t)}return null};/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Az(){if(typeof self<"u")return self;if(typeof window<"u")return window;if(typeof global<"u")return global;throw new Error("Unable to locate global object.")}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Nz=()=>Az().__FIREBASE_DEFAULTS__,Rz=()=>{if(typeof process>"u"||typeof E_>"u")return;const n=E_.__FIREBASE_DEFAULTS__;if(n)return JSON.parse(n)},$z=()=>{if(typeof document>"u")return;let n;try{n=document.cookie.match(/__FIREBASE_DEFAULTS__=([^;]+)/)}catch{return}const t=n&&kz(n[1]);return t&&JSON.parse(t)},Mw=()=>{try{return Tz()||Nz()||Rz()||$z()}catch(n){console.info(`Unable to get __FIREBASE_DEFAULTS__ due to: ${n}`);return}},Dz=n=>{var t,e;return(e=(t=Mw())===null||t===void 0?void 0:t.emulatorHosts)===null||e===void 0?void 0:e[n]},Oz=n=>{const t=Dz(n);if(!t)return;const e=t.lastIndexOf(":");if(e<=0||e+1===t.length)throw new Error(`Invalid host ${t} with no separate hostname and port!`);const s=parseInt(t.substring(e+1),10);return t[0]==="["?[t.substring(1,e-1),s]:[t.substring(0,e),s]},UN=()=>{var n;return(n=Mw())===null||n===void 0?void 0:n.config};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Mz{constructor(){this.reject=()=>{},this.resolve=()=>{},this.promise=new Promise((t,e)=>{this.resolve=t,this.reject=e})}wrapCallback(t){return(e,s)=>{e?this.reject(e):this.resolve(s),typeof t=="function"&&(this.promise.catch(()=>{}),t.length===1?t(e):t(e,s))}}}/**
 * @license
 * Copyright 2025 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Fw(n){return n.endsWith(".cloudworkstations.dev")}async function Fz(n){return(await fetch(n,{credentials:"include"})).ok}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Lz(n,t){if(n.uid)throw new Error('The "uid" field is no longer supported by mockUserToken. Please use "sub" instead for Firebase Auth User ID.');const e={alg:"none",type:"JWT"},s=t||"demo-project",r=n.iat||0,i=n.sub||n.user_id;if(!i)throw new Error("mockUserToken must contain 'sub' or 'user_id' field!");const o=Object.assign({iss:`https://securetoken.google.com/${s}`,aud:s,iat:r,exp:r+3600,auth_time:r,sub:i,user_id:i,firebase:{sign_in_provider:"custom",identities:{}}},n);return[sy(JSON.stringify(e)),sy(JSON.stringify(o)),""].join(".")}const qd={};function Pz(){const n={prod:[],emulator:[]};for(const t of Object.keys(qd))qd[t]?n.emulator.push(t):n.prod.push(t);return n}function Vz(n){let t=document.getElementById(n),e=!1;return t||(t=document.createElement("div"),t.setAttribute("id",n),e=!0),{created:e,element:t}}let I_=!1;function zz(n,t){if(typeof window>"u"||typeof document>"u"||!Fw(window.location.host)||qd[n]===t||qd[n]||I_)return;qd[n]=t;function e(m){return`__firebase__banner__${m}`}const s="__firebase__banner",i=Pz().prod.length>0;function o(){const m=document.getElementById(s);m&&m.remove()}function l(m){m.style.display="flex",m.style.background="#7faaf0",m.style.position="fixed",m.style.bottom="5px",m.style.left="5px",m.style.padding=".5em",m.style.borderRadius="5px",m.style.alignItems="center"}function u(m,y){m.setAttribute("width","24"),m.setAttribute("id",y),m.setAttribute("height","24"),m.setAttribute("viewBox","0 0 24 24"),m.setAttribute("fill","none"),m.style.marginLeft="-6px"}function h(){const m=document.createElement("span");return m.style.cursor="pointer",m.style.marginLeft="16px",m.style.fontSize="24px",m.innerHTML=" &times;",m.onclick=()=>{I_=!0,o()},m}function d(m,y){m.setAttribute("id",y),m.innerText="Learn more",m.href="https://firebase.google.com/docs/studio/preview-apps#preview-backend",m.setAttribute("target","__blank"),m.style.paddingLeft="5px",m.style.textDecoration="underline"}function p(){const m=Vz(s),y=e("text"),x=document.getElementById(y)||document.createElement("span"),v=e("learnmore"),C=document.getElementById(v)||document.createElement("a"),S=e("preprendIcon"),E=document.getElementById(S)||document.createElementNS("http://www.w3.org/2000/svg","svg");if(m.created){const _=m.element;l(_),d(C,v);const I=h();u(E,S),_.append(E,x,C,I),document.body.appendChild(_)}i?(x.innerText="Preview backend disconnected.",E.innerHTML=`<g clip-path="url(#clip0_6013_33858)">
<path d="M4.8 17.6L12 5.6L19.2 17.6H4.8ZM6.91667 16.4H17.0833L12 7.93333L6.91667 16.4ZM12 15.6C12.1667 15.6 12.3056 15.5444 12.4167 15.4333C12.5389 15.3111 12.6 15.1667 12.6 15C12.6 14.8333 12.5389 14.6944 12.4167 14.5833C12.3056 14.4611 12.1667 14.4 12 14.4C11.8333 14.4 11.6889 14.4611 11.5667 14.5833C11.4556 14.6944 11.4 14.8333 11.4 15C11.4 15.1667 11.4556 15.3111 11.5667 15.4333C11.6889 15.5444 11.8333 15.6 12 15.6ZM11.4 13.6H12.6V10.4H11.4V13.6Z" fill="#212121"/>
</g>
<defs>
<clipPath id="clip0_6013_33858">
<rect width="24" height="24" fill="white"/>
</clipPath>
</defs>`):(E.innerHTML=`<g clip-path="url(#clip0_6083_34804)">
<path d="M11.4 15.2H12.6V11.2H11.4V15.2ZM12 10C12.1667 10 12.3056 9.94444 12.4167 9.83333C12.5389 9.71111 12.6 9.56667 12.6 9.4C12.6 9.23333 12.5389 9.09444 12.4167 8.98333C12.3056 8.86111 12.1667 8.8 12 8.8C11.8333 8.8 11.6889 8.86111 11.5667 8.98333C11.4556 9.09444 11.4 9.23333 11.4 9.4C11.4 9.56667 11.4556 9.71111 11.5667 9.83333C11.6889 9.94444 11.8333 10 12 10ZM12 18.4C11.1222 18.4 10.2944 18.2333 9.51667 17.9C8.73889 17.5667 8.05556 17.1111 7.46667 16.5333C6.88889 15.9444 6.43333 15.2611 6.1 14.4833C5.76667 13.7056 5.6 12.8778 5.6 12C5.6 11.1111 5.76667 10.2833 6.1 9.51667C6.43333 8.73889 6.88889 8.06111 7.46667 7.48333C8.05556 6.89444 8.73889 6.43333 9.51667 6.1C10.2944 5.76667 11.1222 5.6 12 5.6C12.8889 5.6 13.7167 5.76667 14.4833 6.1C15.2611 6.43333 15.9389 6.89444 16.5167 7.48333C17.1056 8.06111 17.5667 8.73889 17.9 9.51667C18.2333 10.2833 18.4 11.1111 18.4 12C18.4 12.8778 18.2333 13.7056 17.9 14.4833C17.5667 15.2611 17.1056 15.9444 16.5167 16.5333C15.9389 17.1111 15.2611 17.5667 14.4833 17.9C13.7167 18.2333 12.8889 18.4 12 18.4ZM12 17.2C13.4444 17.2 14.6722 16.6944 15.6833 15.6833C16.6944 14.6722 17.2 13.4444 17.2 12C17.2 10.5556 16.6944 9.32778 15.6833 8.31667C14.6722 7.30555 13.4444 6.8 12 6.8C10.5556 6.8 9.32778 7.30555 8.31667 8.31667C7.30556 9.32778 6.8 10.5556 6.8 12C6.8 13.4444 7.30556 14.6722 8.31667 15.6833C9.32778 16.6944 10.5556 17.2 12 17.2Z" fill="#212121"/>
</g>
<defs>
<clipPath id="clip0_6083_34804">
<rect width="24" height="24" fill="white"/>
</clipPath>
</defs>`,x.innerText="Preview backend running in this workspace."),x.setAttribute("id",y)}document.readyState==="loading"?window.addEventListener("DOMContentLoaded",p):p()}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Bz(){return typeof navigator<"u"&&typeof navigator.userAgent=="string"?navigator.userAgent:""}function Uz(){var n;const t=(n=Mw())===null||n===void 0?void 0:n.forceEnvironment;if(t==="node")return!0;if(t==="browser")return!1;try{return Object.prototype.toString.call(global.process)==="[object process]"}catch{return!1}}function Gz(){return!Uz()&&!!navigator.userAgent&&navigator.userAgent.includes("Safari")&&!navigator.userAgent.includes("Chrome")}function Wz(){try{return typeof indexedDB=="object"}catch{return!1}}function Hz(){return new Promise((n,t)=>{try{let e=!0;const s="validate-browser-context-for-indexeddb-analytics-module",r=self.indexedDB.open(s);r.onsuccess=()=>{r.result.close(),e||self.indexedDB.deleteDatabase(s),n(!0)},r.onupgradeneeded=()=>{e=!1},r.onerror=()=>{var i;t(((i=r.error)===null||i===void 0?void 0:i.message)||"")}}catch(e){t(e)}})}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const qz="FirebaseError";class sh extends Error{constructor(t,e,s){super(e),this.code=t,this.customData=s,this.name=qz,Object.setPrototypeOf(this,sh.prototype),Error.captureStackTrace&&Error.captureStackTrace(this,GN.prototype.create)}}class GN{constructor(t,e,s){this.service=t,this.serviceName=e,this.errors=s}create(t,...e){const s=e[0]||{},r=`${this.service}/${t}`,i=this.errors[t],o=i?jz(i,s):"Error",l=`${this.serviceName}: ${o} (${r}).`;return new sh(r,l,s)}}function jz(n,t){return n.replace(Kz,(e,s)=>{const r=t[s];return r!=null?String(r):`<${s}?>`})}const Kz=/\{\$([^}]+)}/g;function ry(n,t){if(n===t)return!0;const e=Object.keys(n),s=Object.keys(t);for(const r of e){if(!s.includes(r))return!1;const i=n[r],o=t[r];if(__(i)&&__(o)){if(!ry(i,o))return!1}else if(i!==o)return!1}for(const r of s)if(!e.includes(r))return!1;return!0}function __(n){return n!==null&&typeof n=="object"}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function ef(n){return n&&n._delegate?n._delegate:n}class nf{constructor(t,e,s){this.name=t,this.instanceFactory=e,this.type=s,this.multipleInstances=!1,this.serviceProps={},this.instantiationMode="LAZY",this.onInstanceCreated=null}setInstantiationMode(t){return this.instantiationMode=t,this}setMultipleInstances(t){return this.multipleInstances=t,this}setServiceProps(t){return this.serviceProps=t,this}setInstanceCreatedCallback(t){return this.onInstanceCreated=t,this}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Bl="[DEFAULT]";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Xz{constructor(t,e){this.name=t,this.container=e,this.component=null,this.instances=new Map,this.instancesDeferred=new Map,this.instancesOptions=new Map,this.onInitCallbacks=new Map}get(t){const e=this.normalizeInstanceIdentifier(t);if(!this.instancesDeferred.has(e)){const s=new Mz;if(this.instancesDeferred.set(e,s),this.isInitialized(e)||this.shouldAutoInitialize())try{const r=this.getOrInitializeService({instanceIdentifier:e});r&&s.resolve(r)}catch{}}return this.instancesDeferred.get(e).promise}getImmediate(t){var e;const s=this.normalizeInstanceIdentifier(t==null?void 0:t.identifier),r=(e=t==null?void 0:t.optional)!==null&&e!==void 0?e:!1;if(this.isInitialized(s)||this.shouldAutoInitialize())try{return this.getOrInitializeService({instanceIdentifier:s})}catch(i){if(r)return null;throw i}else{if(r)return null;throw Error(`Service ${this.name} is not available`)}}getComponent(){return this.component}setComponent(t){if(t.name!==this.name)throw Error(`Mismatching Component ${t.name} for Provider ${this.name}.`);if(this.component)throw Error(`Component for ${this.name} has already been provided`);if(this.component=t,!!this.shouldAutoInitialize()){if(Qz(t))try{this.getOrInitializeService({instanceIdentifier:Bl})}catch{}for(const[e,s]of this.instancesDeferred.entries()){const r=this.normalizeInstanceIdentifier(e);try{const i=this.getOrInitializeService({instanceIdentifier:r});s.resolve(i)}catch{}}}}clearInstance(t=Bl){this.instancesDeferred.delete(t),this.instancesOptions.delete(t),this.instances.delete(t)}async delete(){const t=Array.from(this.instances.values());await Promise.all([...t.filter(e=>"INTERNAL"in e).map(e=>e.INTERNAL.delete()),...t.filter(e=>"_delete"in e).map(e=>e._delete())])}isComponentSet(){return this.component!=null}isInitialized(t=Bl){return this.instances.has(t)}getOptions(t=Bl){return this.instancesOptions.get(t)||{}}initialize(t={}){const{options:e={}}=t,s=this.normalizeInstanceIdentifier(t.instanceIdentifier);if(this.isInitialized(s))throw Error(`${this.name}(${s}) has already been initialized`);if(!this.isComponentSet())throw Error(`Component ${this.name} has not been registered yet`);const r=this.getOrInitializeService({instanceIdentifier:s,options:e});for(const[i,o]of this.instancesDeferred.entries()){const l=this.normalizeInstanceIdentifier(i);s===l&&o.resolve(r)}return r}onInit(t,e){var s;const r=this.normalizeInstanceIdentifier(e),i=(s=this.onInitCallbacks.get(r))!==null&&s!==void 0?s:new Set;i.add(t),this.onInitCallbacks.set(r,i);const o=this.instances.get(r);return o&&t(o,r),()=>{i.delete(t)}}invokeOnInitCallbacks(t,e){const s=this.onInitCallbacks.get(e);if(s)for(const r of s)try{r(t,e)}catch{}}getOrInitializeService({instanceIdentifier:t,options:e={}}){let s=this.instances.get(t);if(!s&&this.component&&(s=this.component.instanceFactory(this.container,{instanceIdentifier:Yz(t),options:e}),this.instances.set(t,s),this.instancesOptions.set(t,e),this.invokeOnInitCallbacks(s,t),this.component.onInstanceCreated))try{this.component.onInstanceCreated(this.container,t,s)}catch{}return s||null}normalizeInstanceIdentifier(t=Bl){return this.component?this.component.multipleInstances?t:Bl:t}shouldAutoInitialize(){return!!this.component&&this.component.instantiationMode!=="EXPLICIT"}}function Yz(n){return n===Bl?void 0:n}function Qz(n){return n.instantiationMode==="EAGER"}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Zz{constructor(t){this.name=t,this.providers=new Map}addComponent(t){const e=this.getProvider(t.name);if(e.isComponentSet())throw new Error(`Component ${t.name} has already been registered with ${this.name}`);e.setComponent(t)}addOrOverwriteComponent(t){this.getProvider(t.name).isComponentSet()&&this.providers.delete(t.name),this.addComponent(t)}getProvider(t){if(this.providers.has(t))return this.providers.get(t);const e=new Xz(t,this);return this.providers.set(t,e),e}getProviders(){return Array.from(this.providers.values())}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var ke;(function(n){n[n.DEBUG=0]="DEBUG",n[n.VERBOSE=1]="VERBOSE",n[n.INFO=2]="INFO",n[n.WARN=3]="WARN",n[n.ERROR=4]="ERROR",n[n.SILENT=5]="SILENT"})(ke||(ke={}));const Jz={debug:ke.DEBUG,verbose:ke.VERBOSE,info:ke.INFO,warn:ke.WARN,error:ke.ERROR,silent:ke.SILENT},tB=ke.INFO,eB={[ke.DEBUG]:"log",[ke.VERBOSE]:"log",[ke.INFO]:"info",[ke.WARN]:"warn",[ke.ERROR]:"error"},nB=(n,t,...e)=>{if(t<n.logLevel)return;const s=new Date().toISOString(),r=eB[t];if(r)console[r](`[${s}]  ${n.name}:`,...e);else throw new Error(`Attempted to log a message with an invalid logType (value: ${t})`)};let WN=class{constructor(t){this.name=t,this._logLevel=tB,this._logHandler=nB,this._userLogHandler=null}get logLevel(){return this._logLevel}set logLevel(t){if(!(t in ke))throw new TypeError(`Invalid value "${t}" assigned to \`logLevel\``);this._logLevel=t}setLogLevel(t){this._logLevel=typeof t=="string"?Jz[t]:t}get logHandler(){return this._logHandler}set logHandler(t){if(typeof t!="function")throw new TypeError("Value assigned to `logHandler` must be a function");this._logHandler=t}get userLogHandler(){return this._userLogHandler}set userLogHandler(t){this._userLogHandler=t}debug(...t){this._userLogHandler&&this._userLogHandler(this,ke.DEBUG,...t),this._logHandler(this,ke.DEBUG,...t)}log(...t){this._userLogHandler&&this._userLogHandler(this,ke.VERBOSE,...t),this._logHandler(this,ke.VERBOSE,...t)}info(...t){this._userLogHandler&&this._userLogHandler(this,ke.INFO,...t),this._logHandler(this,ke.INFO,...t)}warn(...t){this._userLogHandler&&this._userLogHandler(this,ke.WARN,...t),this._logHandler(this,ke.WARN,...t)}error(...t){this._userLogHandler&&this._userLogHandler(this,ke.ERROR,...t),this._logHandler(this,ke.ERROR,...t)}};const sB=(n,t)=>t.some(e=>n instanceof e);let k_,A_;function rB(){return k_||(k_=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction])}function iB(){return A_||(A_=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])}const HN=new WeakMap,Ev=new WeakMap,qN=new WeakMap,j1=new WeakMap,Lw=new WeakMap;function oB(n){const t=new Promise((e,s)=>{const r=()=>{n.removeEventListener("success",i),n.removeEventListener("error",o)},i=()=>{e(Aa(n.result)),r()},o=()=>{s(n.error),r()};n.addEventListener("success",i),n.addEventListener("error",o)});return t.then(e=>{e instanceof IDBCursor&&HN.set(e,n)}).catch(()=>{}),Lw.set(t,n),t}function aB(n){if(Ev.has(n))return;const t=new Promise((e,s)=>{const r=()=>{n.removeEventListener("complete",i),n.removeEventListener("error",o),n.removeEventListener("abort",o)},i=()=>{e(),r()},o=()=>{s(n.error||new DOMException("AbortError","AbortError")),r()};n.addEventListener("complete",i),n.addEventListener("error",o),n.addEventListener("abort",o)});Ev.set(n,t)}let Iv={get(n,t,e){if(n instanceof IDBTransaction){if(t==="done")return Ev.get(n);if(t==="objectStoreNames")return n.objectStoreNames||qN.get(n);if(t==="store")return e.objectStoreNames[1]?void 0:e.objectStore(e.objectStoreNames[0])}return Aa(n[t])},set(n,t,e){return n[t]=e,!0},has(n,t){return n instanceof IDBTransaction&&(t==="done"||t==="store")?!0:t in n}};function lB(n){Iv=n(Iv)}function uB(n){return n===IDBDatabase.prototype.transaction&&!("objectStoreNames"in IDBTransaction.prototype)?function(t,...e){const s=n.call(K1(this),t,...e);return qN.set(s,t.sort?t.sort():[t]),Aa(s)}:iB().includes(n)?function(...t){return n.apply(K1(this),t),Aa(HN.get(this))}:function(...t){return Aa(n.apply(K1(this),t))}}function cB(n){return typeof n=="function"?uB(n):(n instanceof IDBTransaction&&aB(n),sB(n,rB())?new Proxy(n,Iv):n)}function Aa(n){if(n instanceof IDBRequest)return oB(n);if(j1.has(n))return j1.get(n);const t=cB(n);return t!==n&&(j1.set(n,t),Lw.set(t,n)),t}const K1=n=>Lw.get(n);function hB(n,t,{blocked:e,upgrade:s,blocking:r,terminated:i}={}){const o=indexedDB.open(n,t),l=Aa(o);return s&&o.addEventListener("upgradeneeded",u=>{s(Aa(o.result),u.oldVersion,u.newVersion,Aa(o.transaction),u)}),e&&o.addEventListener("blocked",u=>e(u.oldVersion,u.newVersion,u)),l.then(u=>{i&&u.addEventListener("close",()=>i()),r&&u.addEventListener("versionchange",h=>r(h.oldVersion,h.newVersion,h))}).catch(()=>{}),l}const dB=["get","getKey","getAll","getAllKeys","count"],fB=["put","add","delete","clear"],X1=new Map;function N_(n,t){if(!(n instanceof IDBDatabase&&!(t in n)&&typeof t=="string"))return;if(X1.get(t))return X1.get(t);const e=t.replace(/FromIndex$/,""),s=t!==e,r=fB.includes(e);if(!(e in(s?IDBIndex:IDBObjectStore).prototype)||!(r||dB.includes(e)))return;const i=async function(o,...l){const u=this.transaction(o,r?"readwrite":"readonly");let h=u.store;return s&&(h=h.index(l.shift())),(await Promise.all([h[e](...l),r&&u.done]))[0]};return X1.set(t,i),i}lB(n=>({...n,get:(t,e,s)=>N_(t,e)||n.get(t,e,s),has:(t,e)=>!!N_(t,e)||n.has(t,e)}));/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class pB{constructor(t){this.container=t}getPlatformInfoString(){return this.container.getProviders().map(e=>{if(mB(e)){const s=e.getImmediate();return`${s.library}/${s.version}`}else return null}).filter(e=>e).join(" ")}}function mB(n){const t=n.getComponent();return(t==null?void 0:t.type)==="VERSION"}const _v="@firebase/app",R_="0.13.1";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Lo=new WN("@firebase/app"),gB="@firebase/app-compat",yB="@firebase/analytics-compat",xB="@firebase/analytics",bB="@firebase/app-check-compat",vB="@firebase/app-check",wB="@firebase/auth",CB="@firebase/auth-compat",SB="@firebase/database",TB="@firebase/data-connect",EB="@firebase/database-compat",IB="@firebase/functions",_B="@firebase/functions-compat",kB="@firebase/installations",AB="@firebase/installations-compat",NB="@firebase/messaging",RB="@firebase/messaging-compat",$B="@firebase/performance",DB="@firebase/performance-compat",OB="@firebase/remote-config",MB="@firebase/remote-config-compat",FB="@firebase/storage",LB="@firebase/storage-compat",PB="@firebase/firestore",VB="@firebase/ai",zB="@firebase/firestore-compat",BB="firebase",UB="11.9.0";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const kv="[DEFAULT]",GB={[_v]:"fire-core",[gB]:"fire-core-compat",[xB]:"fire-analytics",[yB]:"fire-analytics-compat",[vB]:"fire-app-check",[bB]:"fire-app-check-compat",[wB]:"fire-auth",[CB]:"fire-auth-compat",[SB]:"fire-rtdb",[TB]:"fire-data-connect",[EB]:"fire-rtdb-compat",[IB]:"fire-fn",[_B]:"fire-fn-compat",[kB]:"fire-iid",[AB]:"fire-iid-compat",[NB]:"fire-fcm",[RB]:"fire-fcm-compat",[$B]:"fire-perf",[DB]:"fire-perf-compat",[OB]:"fire-rc",[MB]:"fire-rc-compat",[FB]:"fire-gcs",[LB]:"fire-gcs-compat",[PB]:"fire-fst",[zB]:"fire-fst-compat",[VB]:"fire-vertex","fire-js":"fire-js",[BB]:"fire-js-all"};/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const iy=new Map,WB=new Map,Av=new Map;function $_(n,t){try{n.container.addComponent(t)}catch(e){Lo.debug(`Component ${t.name} failed to register with FirebaseApp ${n.name}`,e)}}function oy(n){const t=n.name;if(Av.has(t))return Lo.debug(`There were multiple attempts to register component ${t}.`),!1;Av.set(t,n);for(const e of iy.values())$_(e,n);for(const e of WB.values())$_(e,n);return!0}function HB(n,t){const e=n.container.getProvider("heartbeat").getImmediate({optional:!0});return e&&e.triggerHeartbeat(),n.container.getProvider(t)}function qB(n){return n==null?!1:n.settings!==void 0}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const jB={"no-app":"No Firebase App '{$appName}' has been created - call initializeApp() first","bad-app-name":"Illegal App name: '{$appName}'","duplicate-app":"Firebase App named '{$appName}' already exists with different options or config","app-deleted":"Firebase App named '{$appName}' already deleted","server-app-deleted":"Firebase Server App has been deleted","no-options":"Need to provide options, when not being deployed to hosting via source.","invalid-app-argument":"firebase.{$appName}() takes either no argument or a Firebase App instance.","invalid-log-argument":"First argument to `onLog` must be null or a function.","idb-open":"Error thrown when opening IndexedDB. Original error: {$originalErrorMessage}.","idb-get":"Error thrown when reading from IndexedDB. Original error: {$originalErrorMessage}.","idb-set":"Error thrown when writing to IndexedDB. Original error: {$originalErrorMessage}.","idb-delete":"Error thrown when deleting from IndexedDB. Original error: {$originalErrorMessage}.","finalization-registry-not-supported":"FirebaseServerApp deleteOnDeref field defined but the JS runtime does not support FinalizationRegistry.","invalid-server-app-environment":"FirebaseServerApp is not for use in browser environments."},Na=new GN("app","Firebase",jB);/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class KB{constructor(t,e,s){this._isDeleted=!1,this._options=Object.assign({},t),this._config=Object.assign({},e),this._name=e.name,this._automaticDataCollectionEnabled=e.automaticDataCollectionEnabled,this._container=s,this.container.addComponent(new nf("app",()=>this,"PUBLIC"))}get automaticDataCollectionEnabled(){return this.checkDestroyed(),this._automaticDataCollectionEnabled}set automaticDataCollectionEnabled(t){this.checkDestroyed(),this._automaticDataCollectionEnabled=t}get name(){return this.checkDestroyed(),this._name}get options(){return this.checkDestroyed(),this._options}get config(){return this.checkDestroyed(),this._config}get container(){return this._container}get isDeleted(){return this._isDeleted}set isDeleted(t){this._isDeleted=t}checkDestroyed(){if(this.isDeleted)throw Na.create("app-deleted",{appName:this._name})}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const XB=UB;function jN(n,t={}){let e=n;typeof t!="object"&&(t={name:t});const s=Object.assign({name:kv,automaticDataCollectionEnabled:!0},t),r=s.name;if(typeof r!="string"||!r)throw Na.create("bad-app-name",{appName:String(r)});if(e||(e=UN()),!e)throw Na.create("no-options");const i=iy.get(r);if(i){if(ry(e,i.options)&&ry(s,i.config))return i;throw Na.create("duplicate-app",{appName:r})}const o=new Zz(r);for(const u of Av.values())o.addComponent(u);const l=new KB(e,s,o);return iy.set(r,l),l}function YB(n=kv){const t=iy.get(n);if(!t&&n===kv&&UN())return jN();if(!t)throw Na.create("no-app",{appName:n});return t}function Nc(n,t,e){var s;let r=(s=GB[n])!==null&&s!==void 0?s:n;e&&(r+=`-${e}`);const i=r.match(/\s|\//),o=t.match(/\s|\//);if(i||o){const l=[`Unable to register library "${r}" with version "${t}":`];i&&l.push(`library name "${r}" contains illegal characters (whitespace or "/")`),i&&o&&l.push("and"),o&&l.push(`version name "${t}" contains illegal characters (whitespace or "/")`),Lo.warn(l.join(" "));return}oy(new nf(`${r}-version`,()=>({library:r,version:t}),"VERSION"))}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const QB="firebase-heartbeat-database",ZB=1,sf="firebase-heartbeat-store";let Y1=null;function KN(){return Y1||(Y1=hB(QB,ZB,{upgrade:(n,t)=>{switch(t){case 0:try{n.createObjectStore(sf)}catch(e){console.warn(e)}}}}).catch(n=>{throw Na.create("idb-open",{originalErrorMessage:n.message})})),Y1}async function JB(n){try{const e=(await KN()).transaction(sf),s=await e.objectStore(sf).get(XN(n));return await e.done,s}catch(t){if(t instanceof sh)Lo.warn(t.message);else{const e=Na.create("idb-get",{originalErrorMessage:t==null?void 0:t.message});Lo.warn(e.message)}}}async function D_(n,t){try{const s=(await KN()).transaction(sf,"readwrite");await s.objectStore(sf).put(t,XN(n)),await s.done}catch(e){if(e instanceof sh)Lo.warn(e.message);else{const s=Na.create("idb-set",{originalErrorMessage:e==null?void 0:e.message});Lo.warn(s.message)}}}function XN(n){return`${n.name}!${n.options.appId}`}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const tU=1024,eU=30;class nU{constructor(t){this.container=t,this._heartbeatsCache=null;const e=this.container.getProvider("app").getImmediate();this._storage=new rU(e),this._heartbeatsCachePromise=this._storage.read().then(s=>(this._heartbeatsCache=s,s))}async triggerHeartbeat(){var t,e;try{const r=this.container.getProvider("platform-logger").getImmediate().getPlatformInfoString(),i=O_();if(((t=this._heartbeatsCache)===null||t===void 0?void 0:t.heartbeats)==null&&(this._heartbeatsCache=await this._heartbeatsCachePromise,((e=this._heartbeatsCache)===null||e===void 0?void 0:e.heartbeats)==null)||this._heartbeatsCache.lastSentHeartbeatDate===i||this._heartbeatsCache.heartbeats.some(o=>o.date===i))return;if(this._heartbeatsCache.heartbeats.push({date:i,agent:r}),this._heartbeatsCache.heartbeats.length>eU){const o=iU(this._heartbeatsCache.heartbeats);this._heartbeatsCache.heartbeats.splice(o,1)}return this._storage.overwrite(this._heartbeatsCache)}catch(s){Lo.warn(s)}}async getHeartbeatsHeader(){var t;try{if(this._heartbeatsCache===null&&await this._heartbeatsCachePromise,((t=this._heartbeatsCache)===null||t===void 0?void 0:t.heartbeats)==null||this._heartbeatsCache.heartbeats.length===0)return"";const e=O_(),{heartbeatsToSend:s,unsentEntries:r}=sU(this._heartbeatsCache.heartbeats),i=sy(JSON.stringify({version:2,heartbeats:s}));return this._heartbeatsCache.lastSentHeartbeatDate=e,r.length>0?(this._heartbeatsCache.heartbeats=r,await this._storage.overwrite(this._heartbeatsCache)):(this._heartbeatsCache.heartbeats=[],this._storage.overwrite(this._heartbeatsCache)),i}catch(e){return Lo.warn(e),""}}}function O_(){return new Date().toISOString().substring(0,10)}function sU(n,t=tU){const e=[];let s=n.slice();for(const r of n){const i=e.find(o=>o.agent===r.agent);if(i){if(i.dates.push(r.date),M_(e)>t){i.dates.pop();break}}else if(e.push({agent:r.agent,dates:[r.date]}),M_(e)>t){e.pop();break}s=s.slice(1)}return{heartbeatsToSend:e,unsentEntries:s}}class rU{constructor(t){this.app=t,this._canUseIndexedDBPromise=this.runIndexedDBEnvironmentCheck()}async runIndexedDBEnvironmentCheck(){return Wz()?Hz().then(()=>!0).catch(()=>!1):!1}async read(){if(await this._canUseIndexedDBPromise){const e=await JB(this.app);return e!=null&&e.heartbeats?e:{heartbeats:[]}}else return{heartbeats:[]}}async overwrite(t){var e;if(await this._canUseIndexedDBPromise){const r=await this.read();return D_(this.app,{lastSentHeartbeatDate:(e=t.lastSentHeartbeatDate)!==null&&e!==void 0?e:r.lastSentHeartbeatDate,heartbeats:t.heartbeats})}else return}async add(t){var e;if(await this._canUseIndexedDBPromise){const r=await this.read();return D_(this.app,{lastSentHeartbeatDate:(e=t.lastSentHeartbeatDate)!==null&&e!==void 0?e:r.lastSentHeartbeatDate,heartbeats:[...r.heartbeats,...t.heartbeats]})}else return}}function M_(n){return sy(JSON.stringify({version:2,heartbeats:n})).length}function iU(n){if(n.length===0)return-1;let t=0,e=n[0].date;for(let s=1;s<n.length;s++)n[s].date<e&&(e=n[s].date,t=s);return t}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function oU(n){oy(new nf("platform-logger",t=>new pB(t),"PRIVATE")),oy(new nf("heartbeat",t=>new nU(t),"PRIVATE")),Nc(_v,R_,n),Nc(_v,R_,"esm2017"),Nc("fire-js","")}oU("");var F_=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};/** @license
Copyright The Closure Library Authors.
SPDX-License-Identifier: Apache-2.0
*/var Ra,YN;(function(){var n;/** @license

 Copyright The Closure Library Authors.
 SPDX-License-Identifier: Apache-2.0
*/function t(D,N){function R(){}R.prototype=N.prototype,D.D=N.prototype,D.prototype=new R,D.prototype.constructor=D,D.C=function($,A,V){for(var L=Array(arguments.length-2),nt=2;nt<arguments.length;nt++)L[nt-2]=arguments[nt];return N.prototype[A].apply($,L)}}function e(){this.blockSize=-1}function s(){this.blockSize=-1,this.blockSize=64,this.g=Array(4),this.B=Array(this.blockSize),this.o=this.h=0,this.s()}t(s,e),s.prototype.s=function(){this.g[0]=1732584193,this.g[1]=4023233417,this.g[2]=2562383102,this.g[3]=271733878,this.o=this.h=0};function r(D,N,R){R||(R=0);var $=Array(16);if(typeof N=="string")for(var A=0;16>A;++A)$[A]=N.charCodeAt(R++)|N.charCodeAt(R++)<<8|N.charCodeAt(R++)<<16|N.charCodeAt(R++)<<24;else for(A=0;16>A;++A)$[A]=N[R++]|N[R++]<<8|N[R++]<<16|N[R++]<<24;N=D.g[0],R=D.g[1],A=D.g[2];var V=D.g[3],L=N+(V^R&(A^V))+$[0]+3614090360&4294967295;N=R+(L<<7&4294967295|L>>>25),L=V+(A^N&(R^A))+$[1]+3905402710&4294967295,V=N+(L<<12&4294967295|L>>>20),L=A+(R^V&(N^R))+$[2]+606105819&4294967295,A=V+(L<<17&4294967295|L>>>15),L=R+(N^A&(V^N))+$[3]+3250441966&4294967295,R=A+(L<<22&4294967295|L>>>10),L=N+(V^R&(A^V))+$[4]+4118548399&4294967295,N=R+(L<<7&4294967295|L>>>25),L=V+(A^N&(R^A))+$[5]+1200080426&4294967295,V=N+(L<<12&4294967295|L>>>20),L=A+(R^V&(N^R))+$[6]+2821735955&4294967295,A=V+(L<<17&4294967295|L>>>15),L=R+(N^A&(V^N))+$[7]+4249261313&4294967295,R=A+(L<<22&4294967295|L>>>10),L=N+(V^R&(A^V))+$[8]+1770035416&4294967295,N=R+(L<<7&4294967295|L>>>25),L=V+(A^N&(R^A))+$[9]+2336552879&4294967295,V=N+(L<<12&4294967295|L>>>20),L=A+(R^V&(N^R))+$[10]+4294925233&4294967295,A=V+(L<<17&4294967295|L>>>15),L=R+(N^A&(V^N))+$[11]+2304563134&4294967295,R=A+(L<<22&4294967295|L>>>10),L=N+(V^R&(A^V))+$[12]+1804603682&4294967295,N=R+(L<<7&4294967295|L>>>25),L=V+(A^N&(R^A))+$[13]+4254626195&4294967295,V=N+(L<<12&4294967295|L>>>20),L=A+(R^V&(N^R))+$[14]+2792965006&4294967295,A=V+(L<<17&4294967295|L>>>15),L=R+(N^A&(V^N))+$[15]+1236535329&4294967295,R=A+(L<<22&4294967295|L>>>10),L=N+(A^V&(R^A))+$[1]+4129170786&4294967295,N=R+(L<<5&4294967295|L>>>27),L=V+(R^A&(N^R))+$[6]+3225465664&4294967295,V=N+(L<<9&4294967295|L>>>23),L=A+(N^R&(V^N))+$[11]+643717713&4294967295,A=V+(L<<14&4294967295|L>>>18),L=R+(V^N&(A^V))+$[0]+3921069994&4294967295,R=A+(L<<20&4294967295|L>>>12),L=N+(A^V&(R^A))+$[5]+3593408605&4294967295,N=R+(L<<5&4294967295|L>>>27),L=V+(R^A&(N^R))+$[10]+38016083&4294967295,V=N+(L<<9&4294967295|L>>>23),L=A+(N^R&(V^N))+$[15]+3634488961&4294967295,A=V+(L<<14&4294967295|L>>>18),L=R+(V^N&(A^V))+$[4]+3889429448&4294967295,R=A+(L<<20&4294967295|L>>>12),L=N+(A^V&(R^A))+$[9]+568446438&4294967295,N=R+(L<<5&4294967295|L>>>27),L=V+(R^A&(N^R))+$[14]+3275163606&4294967295,V=N+(L<<9&4294967295|L>>>23),L=A+(N^R&(V^N))+$[3]+4107603335&4294967295,A=V+(L<<14&4294967295|L>>>18),L=R+(V^N&(A^V))+$[8]+1163531501&4294967295,R=A+(L<<20&4294967295|L>>>12),L=N+(A^V&(R^A))+$[13]+2850285829&4294967295,N=R+(L<<5&4294967295|L>>>27),L=V+(R^A&(N^R))+$[2]+4243563512&4294967295,V=N+(L<<9&4294967295|L>>>23),L=A+(N^R&(V^N))+$[7]+1735328473&4294967295,A=V+(L<<14&4294967295|L>>>18),L=R+(V^N&(A^V))+$[12]+2368359562&4294967295,R=A+(L<<20&4294967295|L>>>12),L=N+(R^A^V)+$[5]+4294588738&4294967295,N=R+(L<<4&4294967295|L>>>28),L=V+(N^R^A)+$[8]+2272392833&4294967295,V=N+(L<<11&4294967295|L>>>21),L=A+(V^N^R)+$[11]+1839030562&4294967295,A=V+(L<<16&4294967295|L>>>16),L=R+(A^V^N)+$[14]+4259657740&4294967295,R=A+(L<<23&4294967295|L>>>9),L=N+(R^A^V)+$[1]+2763975236&4294967295,N=R+(L<<4&4294967295|L>>>28),L=V+(N^R^A)+$[4]+1272893353&4294967295,V=N+(L<<11&4294967295|L>>>21),L=A+(V^N^R)+$[7]+4139469664&4294967295,A=V+(L<<16&4294967295|L>>>16),L=R+(A^V^N)+$[10]+3200236656&4294967295,R=A+(L<<23&4294967295|L>>>9),L=N+(R^A^V)+$[13]+681279174&4294967295,N=R+(L<<4&4294967295|L>>>28),L=V+(N^R^A)+$[0]+3936430074&4294967295,V=N+(L<<11&4294967295|L>>>21),L=A+(V^N^R)+$[3]+3572445317&4294967295,A=V+(L<<16&4294967295|L>>>16),L=R+(A^V^N)+$[6]+76029189&4294967295,R=A+(L<<23&4294967295|L>>>9),L=N+(R^A^V)+$[9]+3654602809&4294967295,N=R+(L<<4&4294967295|L>>>28),L=V+(N^R^A)+$[12]+3873151461&4294967295,V=N+(L<<11&4294967295|L>>>21),L=A+(V^N^R)+$[15]+530742520&4294967295,A=V+(L<<16&4294967295|L>>>16),L=R+(A^V^N)+$[2]+3299628645&4294967295,R=A+(L<<23&4294967295|L>>>9),L=N+(A^(R|~V))+$[0]+4096336452&4294967295,N=R+(L<<6&4294967295|L>>>26),L=V+(R^(N|~A))+$[7]+1126891415&4294967295,V=N+(L<<10&4294967295|L>>>22),L=A+(N^(V|~R))+$[14]+2878612391&4294967295,A=V+(L<<15&4294967295|L>>>17),L=R+(V^(A|~N))+$[5]+4237533241&4294967295,R=A+(L<<21&4294967295|L>>>11),L=N+(A^(R|~V))+$[12]+1700485571&4294967295,N=R+(L<<6&4294967295|L>>>26),L=V+(R^(N|~A))+$[3]+2399980690&4294967295,V=N+(L<<10&4294967295|L>>>22),L=A+(N^(V|~R))+$[10]+4293915773&4294967295,A=V+(L<<15&4294967295|L>>>17),L=R+(V^(A|~N))+$[1]+2240044497&4294967295,R=A+(L<<21&4294967295|L>>>11),L=N+(A^(R|~V))+$[8]+1873313359&4294967295,N=R+(L<<6&4294967295|L>>>26),L=V+(R^(N|~A))+$[15]+4264355552&4294967295,V=N+(L<<10&4294967295|L>>>22),L=A+(N^(V|~R))+$[6]+2734768916&4294967295,A=V+(L<<15&4294967295|L>>>17),L=R+(V^(A|~N))+$[13]+1309151649&4294967295,R=A+(L<<21&4294967295|L>>>11),L=N+(A^(R|~V))+$[4]+4149444226&4294967295,N=R+(L<<6&4294967295|L>>>26),L=V+(R^(N|~A))+$[11]+3174756917&4294967295,V=N+(L<<10&4294967295|L>>>22),L=A+(N^(V|~R))+$[2]+718787259&4294967295,A=V+(L<<15&4294967295|L>>>17),L=R+(V^(A|~N))+$[9]+3951481745&4294967295,D.g[0]=D.g[0]+N&4294967295,D.g[1]=D.g[1]+(A+(L<<21&4294967295|L>>>11))&4294967295,D.g[2]=D.g[2]+A&4294967295,D.g[3]=D.g[3]+V&4294967295}s.prototype.u=function(D,N){N===void 0&&(N=D.length);for(var R=N-this.blockSize,$=this.B,A=this.h,V=0;V<N;){if(A==0)for(;V<=R;)r(this,D,V),V+=this.blockSize;if(typeof D=="string"){for(;V<N;)if($[A++]=D.charCodeAt(V++),A==this.blockSize){r(this,$),A=0;break}}else for(;V<N;)if($[A++]=D[V++],A==this.blockSize){r(this,$),A=0;break}}this.h=A,this.o+=N},s.prototype.v=function(){var D=Array((56>this.h?this.blockSize:2*this.blockSize)-this.h);D[0]=128;for(var N=1;N<D.length-8;++N)D[N]=0;var R=8*this.o;for(N=D.length-8;N<D.length;++N)D[N]=R&255,R/=256;for(this.u(D),D=Array(16),N=R=0;4>N;++N)for(var $=0;32>$;$+=8)D[R++]=this.g[N]>>>$&255;return D};function i(D,N){var R=l;return Object.prototype.hasOwnProperty.call(R,D)?R[D]:R[D]=N(D)}function o(D,N){this.h=N;for(var R=[],$=!0,A=D.length-1;0<=A;A--){var V=D[A]|0;$&&V==N||(R[A]=V,$=!1)}this.g=R}var l={};function u(D){return-128<=D&&128>D?i(D,function(N){return new o([N|0],0>N?-1:0)}):new o([D|0],0>D?-1:0)}function h(D){if(isNaN(D)||!isFinite(D))return p;if(0>D)return C(h(-D));for(var N=[],R=1,$=0;D>=R;$++)N[$]=D/R|0,R*=4294967296;return new o(N,0)}function d(D,N){if(D.length==0)throw Error("number format error: empty string");if(N=N||10,2>N||36<N)throw Error("radix out of range: "+N);if(D.charAt(0)=="-")return C(d(D.substring(1),N));if(0<=D.indexOf("-"))throw Error('number format error: interior "-" character');for(var R=h(Math.pow(N,8)),$=p,A=0;A<D.length;A+=8){var V=Math.min(8,D.length-A),L=parseInt(D.substring(A,A+V),N);8>V?(V=h(Math.pow(N,V)),$=$.j(V).add(h(L))):($=$.j(R),$=$.add(h(L)))}return $}var p=u(0),m=u(1),y=u(16777216);n=o.prototype,n.m=function(){if(v(this))return-C(this).m();for(var D=0,N=1,R=0;R<this.g.length;R++){var $=this.i(R);D+=(0<=$?$:4294967296+$)*N,N*=4294967296}return D},n.toString=function(D){if(D=D||10,2>D||36<D)throw Error("radix out of range: "+D);if(x(this))return"0";if(v(this))return"-"+C(this).toString(D);for(var N=h(Math.pow(D,6)),R=this,$="";;){var A=I(R,N).g;R=S(R,A.j(N));var V=((0<R.g.length?R.g[0]:R.h)>>>0).toString(D);if(R=A,x(R))return V+$;for(;6>V.length;)V="0"+V;$=V+$}},n.i=function(D){return 0>D?0:D<this.g.length?this.g[D]:this.h};function x(D){if(D.h!=0)return!1;for(var N=0;N<D.g.length;N++)if(D.g[N]!=0)return!1;return!0}function v(D){return D.h==-1}n.l=function(D){return D=S(this,D),v(D)?-1:x(D)?0:1};function C(D){for(var N=D.g.length,R=[],$=0;$<N;$++)R[$]=~D.g[$];return new o(R,~D.h).add(m)}n.abs=function(){return v(this)?C(this):this},n.add=function(D){for(var N=Math.max(this.g.length,D.g.length),R=[],$=0,A=0;A<=N;A++){var V=$+(this.i(A)&65535)+(D.i(A)&65535),L=(V>>>16)+(this.i(A)>>>16)+(D.i(A)>>>16);$=L>>>16,V&=65535,L&=65535,R[A]=L<<16|V}return new o(R,R[R.length-1]&-2147483648?-1:0)};function S(D,N){return D.add(C(N))}n.j=function(D){if(x(this)||x(D))return p;if(v(this))return v(D)?C(this).j(C(D)):C(C(this).j(D));if(v(D))return C(this.j(C(D)));if(0>this.l(y)&&0>D.l(y))return h(this.m()*D.m());for(var N=this.g.length+D.g.length,R=[],$=0;$<2*N;$++)R[$]=0;for($=0;$<this.g.length;$++)for(var A=0;A<D.g.length;A++){var V=this.i($)>>>16,L=this.i($)&65535,nt=D.i(A)>>>16,Z=D.i(A)&65535;R[2*$+2*A]+=L*Z,E(R,2*$+2*A),R[2*$+2*A+1]+=V*Z,E(R,2*$+2*A+1),R[2*$+2*A+1]+=L*nt,E(R,2*$+2*A+1),R[2*$+2*A+2]+=V*nt,E(R,2*$+2*A+2)}for($=0;$<N;$++)R[$]=R[2*$+1]<<16|R[2*$];for($=N;$<2*N;$++)R[$]=0;return new o(R,0)};function E(D,N){for(;(D[N]&65535)!=D[N];)D[N+1]+=D[N]>>>16,D[N]&=65535,N++}function _(D,N){this.g=D,this.h=N}function I(D,N){if(x(N))throw Error("division by zero");if(x(D))return new _(p,p);if(v(D))return N=I(C(D),N),new _(C(N.g),C(N.h));if(v(N))return N=I(D,C(N)),new _(C(N.g),N.h);if(30<D.g.length){if(v(D)||v(N))throw Error("slowDivide_ only works with positive integers.");for(var R=m,$=N;0>=$.l(D);)R=O(R),$=O($);var A=P(R,1),V=P($,1);for($=P($,2),R=P(R,2);!x($);){var L=V.add($);0>=L.l(D)&&(A=A.add(R),V=L),$=P($,1),R=P(R,1)}return N=S(D,A.j(N)),new _(A,N)}for(A=p;0<=D.l(N);){for(R=Math.max(1,Math.floor(D.m()/N.m())),$=Math.ceil(Math.log(R)/Math.LN2),$=48>=$?1:Math.pow(2,$-48),V=h(R),L=V.j(N);v(L)||0<L.l(D);)R-=$,V=h(R),L=V.j(N);x(V)&&(V=m),A=A.add(V),D=S(D,L)}return new _(A,D)}n.A=function(D){return I(this,D).h},n.and=function(D){for(var N=Math.max(this.g.length,D.g.length),R=[],$=0;$<N;$++)R[$]=this.i($)&D.i($);return new o(R,this.h&D.h)},n.or=function(D){for(var N=Math.max(this.g.length,D.g.length),R=[],$=0;$<N;$++)R[$]=this.i($)|D.i($);return new o(R,this.h|D.h)},n.xor=function(D){for(var N=Math.max(this.g.length,D.g.length),R=[],$=0;$<N;$++)R[$]=this.i($)^D.i($);return new o(R,this.h^D.h)};function O(D){for(var N=D.g.length+1,R=[],$=0;$<N;$++)R[$]=D.i($)<<1|D.i($-1)>>>31;return new o(R,D.h)}function P(D,N){var R=N>>5;N%=32;for(var $=D.g.length-R,A=[],V=0;V<$;V++)A[V]=0<N?D.i(V+R)>>>N|D.i(V+R+1)<<32-N:D.i(V+R);return new o(A,D.h)}s.prototype.digest=s.prototype.v,s.prototype.reset=s.prototype.s,s.prototype.update=s.prototype.u,YN=s,o.prototype.add=o.prototype.add,o.prototype.multiply=o.prototype.j,o.prototype.modulo=o.prototype.A,o.prototype.compare=o.prototype.l,o.prototype.toNumber=o.prototype.m,o.prototype.toString=o.prototype.toString,o.prototype.getBits=o.prototype.i,o.fromNumber=h,o.fromString=d,Ra=o}).apply(typeof F_<"u"?F_:typeof self<"u"?self:typeof window<"u"?window:{});var bg=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};/** @license
Copyright The Closure Library Authors.
SPDX-License-Identifier: Apache-2.0
*/var QN,Ld,ZN,Bg,Nv,JN,tR,eR;(function(){var n,t=typeof Object.defineProperties=="function"?Object.defineProperty:function(b,k,M){return b==Array.prototype||b==Object.prototype||(b[k]=M.value),b};function e(b){b=[typeof globalThis=="object"&&globalThis,b,typeof window=="object"&&window,typeof self=="object"&&self,typeof bg=="object"&&bg];for(var k=0;k<b.length;++k){var M=b[k];if(M&&M.Math==Math)return M}throw Error("Cannot find global object")}var s=e(this);function r(b,k){if(k)t:{var M=s;b=b.split(".");for(var G=0;G<b.length-1;G++){var lt=b[G];if(!(lt in M))break t;M=M[lt]}b=b[b.length-1],G=M[b],k=k(G),k!=G&&k!=null&&t(M,b,{configurable:!0,writable:!0,value:k})}}function i(b,k){b instanceof String&&(b+="");var M=0,G=!1,lt={next:function(){if(!G&&M<b.length){var gt=M++;return{value:k(gt,b[gt]),done:!1}}return G=!0,{done:!0,value:void 0}}};return lt[Symbol.iterator]=function(){return lt},lt}r("Array.prototype.values",function(b){return b||function(){return i(this,function(k,M){return M})}});/** @license

 Copyright The Closure Library Authors.
 SPDX-License-Identifier: Apache-2.0
*/var o=o||{},l=this||self;function u(b){var k=typeof b;return k=k!="object"?k:b?Array.isArray(b)?"array":k:"null",k=="array"||k=="object"&&typeof b.length=="number"}function h(b){var k=typeof b;return k=="object"&&b!=null||k=="function"}function d(b,k,M){return b.call.apply(b.bind,arguments)}function p(b,k,M){if(!b)throw Error();if(2<arguments.length){var G=Array.prototype.slice.call(arguments,2);return function(){var lt=Array.prototype.slice.call(arguments);return Array.prototype.unshift.apply(lt,G),b.apply(k,lt)}}return function(){return b.apply(k,arguments)}}function m(b,k,M){return m=Function.prototype.bind&&Function.prototype.bind.toString().indexOf("native code")!=-1?d:p,m.apply(null,arguments)}function y(b,k){var M=Array.prototype.slice.call(arguments,1);return function(){var G=M.slice();return G.push.apply(G,arguments),b.apply(this,G)}}function x(b,k){function M(){}M.prototype=k.prototype,b.aa=k.prototype,b.prototype=new M,b.prototype.constructor=b,b.Qb=function(G,lt,gt){for(var At=Array(arguments.length-2),Te=2;Te<arguments.length;Te++)At[Te-2]=arguments[Te];return k.prototype[lt].apply(G,At)}}function v(b){const k=b.length;if(0<k){const M=Array(k);for(let G=0;G<k;G++)M[G]=b[G];return M}return[]}function C(b,k){for(let M=1;M<arguments.length;M++){const G=arguments[M];if(u(G)){const lt=b.length||0,gt=G.length||0;b.length=lt+gt;for(let At=0;At<gt;At++)b[lt+At]=G[At]}else b.push(G)}}class S{constructor(k,M){this.i=k,this.j=M,this.h=0,this.g=null}get(){let k;return 0<this.h?(this.h--,k=this.g,this.g=k.next,k.next=null):k=this.i(),k}}function E(b){return/^[\s\xa0]*$/.test(b)}function _(){var b=l.navigator;return b&&(b=b.userAgent)?b:""}function I(b){return I[" "](b),b}I[" "]=function(){};var O=_().indexOf("Gecko")!=-1&&!(_().toLowerCase().indexOf("webkit")!=-1&&_().indexOf("Edge")==-1)&&!(_().indexOf("Trident")!=-1||_().indexOf("MSIE")!=-1)&&_().indexOf("Edge")==-1;function P(b,k,M){for(const G in b)k.call(M,b[G],G,b)}function D(b,k){for(const M in b)k.call(void 0,b[M],M,b)}function N(b){const k={};for(const M in b)k[M]=b[M];return k}const R="constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" ");function $(b,k){let M,G;for(let lt=1;lt<arguments.length;lt++){G=arguments[lt];for(M in G)b[M]=G[M];for(let gt=0;gt<R.length;gt++)M=R[gt],Object.prototype.hasOwnProperty.call(G,M)&&(b[M]=G[M])}}function A(b){var k=1;b=b.split(":");const M=[];for(;0<k&&b.length;)M.push(b.shift()),k--;return b.length&&M.push(b.join(":")),M}function V(b){l.setTimeout(()=>{throw b},0)}function L(){var b=at;let k=null;return b.g&&(k=b.g,b.g=b.g.next,b.g||(b.h=null),k.next=null),k}class nt{constructor(){this.h=this.g=null}add(k,M){const G=Z.get();G.set(k,M),this.h?this.h.next=G:this.g=G,this.h=G}}var Z=new S(()=>new W,b=>b.reset());class W{constructor(){this.next=this.g=this.h=null}set(k,M){this.h=k,this.g=M,this.next=null}reset(){this.next=this.g=this.h=null}}let K,Y=!1,at=new nt,B=()=>{const b=l.Promise.resolve(void 0);K=()=>{b.then(j)}};var j=()=>{for(var b;b=L();){try{b.h.call(b.g)}catch(M){V(M)}var k=Z;k.j(b),100>k.h&&(k.h++,b.next=k.g,k.g=b)}Y=!1};function st(){this.s=this.s,this.C=this.C}st.prototype.s=!1,st.prototype.ma=function(){this.s||(this.s=!0,this.N())},st.prototype.N=function(){if(this.C)for(;this.C.length;)this.C.shift()()};function tt(b,k){this.type=b,this.g=this.target=k,this.defaultPrevented=!1}tt.prototype.h=function(){this.defaultPrevented=!0};var xt=function(){if(!l.addEventListener||!Object.defineProperty)return!1;var b=!1,k=Object.defineProperty({},"passive",{get:function(){b=!0}});try{const M=()=>{};l.addEventListener("test",M,k),l.removeEventListener("test",M,k)}catch{}return b}();function vt(b,k){if(tt.call(this,b?b.type:""),this.relatedTarget=this.g=this.target=null,this.button=this.screenY=this.screenX=this.clientY=this.clientX=0,this.key="",this.metaKey=this.shiftKey=this.altKey=this.ctrlKey=!1,this.state=null,this.pointerId=0,this.pointerType="",this.i=null,b){var M=this.type=b.type,G=b.changedTouches&&b.changedTouches.length?b.changedTouches[0]:null;if(this.target=b.target||b.srcElement,this.g=k,k=b.relatedTarget){if(O){t:{try{I(k.nodeName);var lt=!0;break t}catch{}lt=!1}lt||(k=null)}}else M=="mouseover"?k=b.fromElement:M=="mouseout"&&(k=b.toElement);this.relatedTarget=k,G?(this.clientX=G.clientX!==void 0?G.clientX:G.pageX,this.clientY=G.clientY!==void 0?G.clientY:G.pageY,this.screenX=G.screenX||0,this.screenY=G.screenY||0):(this.clientX=b.clientX!==void 0?b.clientX:b.pageX,this.clientY=b.clientY!==void 0?b.clientY:b.pageY,this.screenX=b.screenX||0,this.screenY=b.screenY||0),this.button=b.button,this.key=b.key||"",this.ctrlKey=b.ctrlKey,this.altKey=b.altKey,this.shiftKey=b.shiftKey,this.metaKey=b.metaKey,this.pointerId=b.pointerId||0,this.pointerType=typeof b.pointerType=="string"?b.pointerType:Ct[b.pointerType]||"",this.state=b.state,this.i=b,b.defaultPrevented&&vt.aa.h.call(this)}}x(vt,tt);var Ct={2:"touch",3:"pen",4:"mouse"};vt.prototype.h=function(){vt.aa.h.call(this);var b=this.i;b.preventDefault?b.preventDefault():b.returnValue=!1};var $t="closure_listenable_"+(1e6*Math.random()|0),Rt=0;function Lt(b,k,M,G,lt){this.listener=b,this.proxy=null,this.src=k,this.type=M,this.capture=!!G,this.ha=lt,this.key=++Rt,this.da=this.fa=!1}function jt(b){b.da=!0,b.listener=null,b.proxy=null,b.src=null,b.ha=null}function Kt(b){this.src=b,this.g={},this.h=0}Kt.prototype.add=function(b,k,M,G,lt){var gt=b.toString();b=this.g[gt],b||(b=this.g[gt]=[],this.h++);var At=be(b,k,G,lt);return-1<At?(k=b[At],M||(k.fa=!1)):(k=new Lt(k,this.src,gt,!!G,lt),k.fa=M,b.push(k)),k};function de(b,k){var M=k.type;if(M in b.g){var G=b.g[M],lt=Array.prototype.indexOf.call(G,k,void 0),gt;(gt=0<=lt)&&Array.prototype.splice.call(G,lt,1),gt&&(jt(k),b.g[M].length==0&&(delete b.g[M],b.h--))}}function be(b,k,M,G){for(var lt=0;lt<b.length;++lt){var gt=b[lt];if(!gt.da&&gt.listener==k&&gt.capture==!!M&&gt.ha==G)return lt}return-1}var Me="closure_lm_"+(1e6*Math.random()|0),Ne={};function Se(b,k,M,G,lt){if(Array.isArray(k)){for(var gt=0;gt<k.length;gt++)Se(b,k[gt],M,G,lt);return null}return M=tr(M),b&&b[$t]?b.K(k,M,h(G)?!!G.capture:!1,lt):me(b,k,M,!1,G,lt)}function me(b,k,M,G,lt,gt){if(!k)throw Error("Invalid event type");var At=h(lt)?!!lt.capture:!!lt,Te=Js(b);if(Te||(b[Me]=Te=new Kt(b)),M=Te.add(k,M,G,At,gt),M.proxy)return M;if(G=Ue(),M.proxy=G,G.src=b,G.listener=M,b.addEventListener)xt||(lt=At),lt===void 0&&(lt=!1),b.addEventListener(k.toString(),G,lt);else if(b.attachEvent)b.attachEvent(As(k.toString()),G);else if(b.addListener&&b.removeListener)b.addListener(G);else throw Error("addEventListener and attachEvent are unavailable.");return M}function Ue(){function b(M){return k.call(b.src,b.listener,M)}const k=fs;return b}function Bs(b,k,M,G,lt){if(Array.isArray(k))for(var gt=0;gt<k.length;gt++)Bs(b,k[gt],M,G,lt);else G=h(G)?!!G.capture:!!G,M=tr(M),b&&b[$t]?(b=b.i,k=String(k).toString(),k in b.g&&(gt=b.g[k],M=be(gt,M,G,lt),-1<M&&(jt(gt[M]),Array.prototype.splice.call(gt,M,1),gt.length==0&&(delete b.g[k],b.h--)))):b&&(b=Js(b))&&(k=b.g[k.toString()],b=-1,k&&(b=be(k,M,G,lt)),(M=-1<b?k[b]:null)&&sn(M))}function sn(b){if(typeof b!="number"&&b&&!b.da){var k=b.src;if(k&&k[$t])de(k.i,b);else{var M=b.type,G=b.proxy;k.removeEventListener?k.removeEventListener(M,G,b.capture):k.detachEvent?k.detachEvent(As(M),G):k.addListener&&k.removeListener&&k.removeListener(G),(M=Js(k))?(de(M,b),M.h==0&&(M.src=null,k[Me]=null)):jt(b)}}}function As(b){return b in Ne?Ne[b]:Ne[b]="on"+b}function fs(b,k){if(b.da)b=!0;else{k=new vt(k,this);var M=b.listener,G=b.ha||b.src;b.fa&&sn(b),b=M.call(G,k)}return b}function Js(b){return b=b[Me],b instanceof Kt?b:null}var ps="__closure_events_fn_"+(1e9*Math.random()>>>0);function tr(b){return typeof b=="function"?b:(b[ps]||(b[ps]=function(k){return b.handleEvent(k)}),b[ps])}function Fe(){st.call(this),this.i=new Kt(this),this.M=this,this.F=null}x(Fe,st),Fe.prototype[$t]=!0,Fe.prototype.removeEventListener=function(b,k,M,G){Bs(this,b,k,M,G)};function fe(b,k){var M,G=b.F;if(G)for(M=[];G;G=G.F)M.push(G);if(b=b.M,G=k.type||k,typeof k=="string")k=new tt(k,b);else if(k instanceof tt)k.target=k.target||b;else{var lt=k;k=new tt(G,b),$(k,lt)}if(lt=!0,M)for(var gt=M.length-1;0<=gt;gt--){var At=k.g=M[gt];lt=mn(At,G,!0,k)&&lt}if(At=k.g=b,lt=mn(At,G,!0,k)&&lt,lt=mn(At,G,!1,k)&&lt,M)for(gt=0;gt<M.length;gt++)At=k.g=M[gt],lt=mn(At,G,!1,k)&&lt}Fe.prototype.N=function(){if(Fe.aa.N.call(this),this.i){var b=this.i,k;for(k in b.g){for(var M=b.g[k],G=0;G<M.length;G++)jt(M[G]);delete b.g[k],b.h--}}this.F=null},Fe.prototype.K=function(b,k,M,G){return this.i.add(String(b),k,!1,M,G)},Fe.prototype.L=function(b,k,M,G){return this.i.add(String(b),k,!0,M,G)};function mn(b,k,M,G){if(k=b.i.g[String(k)],!k)return!0;k=k.concat();for(var lt=!0,gt=0;gt<k.length;++gt){var At=k[gt];if(At&&!At.da&&At.capture==M){var Te=At.listener,Wn=At.ha||At.src;At.fa&&de(b.i,At),lt=Te.call(Wn,G)!==!1&&lt}}return lt&&!G.defaultPrevented}function gn(b,k,M){if(typeof b=="function")M&&(b=m(b,M));else if(b&&typeof b.handleEvent=="function")b=m(b.handleEvent,b);else throw Error("Invalid listener argument");return 2147483647<Number(k)?-1:l.setTimeout(b,k||0)}function Xo(b){b.g=gn(()=>{b.g=null,b.i&&(b.i=!1,Xo(b))},b.l);const k=b.h;b.h=null,b.m.apply(null,k)}class al extends st{constructor(k,M){super(),this.m=k,this.l=M,this.h=null,this.i=!1,this.g=null}j(k){this.h=arguments,this.g?this.i=!0:Xo(this)}N(){super.N(),this.g&&(l.clearTimeout(this.g),this.g=null,this.i=!1,this.h=null)}}function so(b){st.call(this),this.h=b,this.g={}}x(so,st);var Ir=[];function ro(b){P(b.g,function(k,M){this.g.hasOwnProperty(M)&&sn(k)},b),b.g={}}so.prototype.N=function(){so.aa.N.call(this),ro(this)},so.prototype.handleEvent=function(){throw Error("EventHandler.handleEvent not implemented")};var hr=l.JSON.stringify,Nu=l.JSON.parse,ll=class{stringify(b){return l.JSON.stringify(b,void 0)}parse(b){return l.JSON.parse(b,void 0)}};function Th(){}Th.prototype.h=null;function Eh(b){return b.h||(b.h=b.i())}function Ih(){}var io={OPEN:"a",kb:"b",Ja:"c",wb:"d"};function oo(){tt.call(this,"d")}x(oo,tt);function _h(){tt.call(this,"c")}x(_h,tt);var gi={},kh=null;function Yo(){return kh=kh||new Fe}gi.La="serverreachability";function Ru(b){tt.call(this,gi.La,b)}x(Ru,tt);function Qo(b){const k=Yo();fe(k,new Ru(k))}gi.STAT_EVENT="statevent";function Qp(b,k){tt.call(this,gi.STAT_EVENT,b),this.stat=k}x(Qp,tt);function an(b){const k=Yo();fe(k,new Qp(k,b))}gi.Ma="timingevent";function Gn(b,k){tt.call(this,gi.Ma,b),this.size=k}x(Gn,tt);function Rn(b,k){if(typeof b!="function")throw Error("Fn must not be null and must be a function");return l.setTimeout(function(){b()},k)}function _r(){this.g=!0}_r.prototype.xa=function(){this.g=!1};function Ah(b,k,M,G,lt,gt){b.info(function(){if(b.g)if(gt)for(var At="",Te=gt.split("&"),Wn=0;Wn<Te.length;Wn++){var Ee=Te[Wn].split("=");if(1<Ee.length){var ss=Ee[0];Ee=Ee[1];var Hn=ss.split("_");At=2<=Hn.length&&Hn[1]=="type"?At+(ss+"="+Ee+"&"):At+(ss+"=redacted&")}}else At=null;else At=gt;return"XMLHTTP REQ ("+G+") [attempt "+lt+"]: "+k+`
`+M+`
`+At})}function Ux(b,k,M,G,lt,gt,At){b.info(function(){return"XMLHTTP RESP ("+G+") [ attempt "+lt+"]: "+k+`
`+M+`
`+gt+" "+At})}function Zo(b,k,M,G){b.info(function(){return"XMLHTTP TEXT ("+k+"): "+ul(b,M)+(G?" "+G:"")})}function Zp(b,k){b.info(function(){return"TIMEOUT: "+k})}_r.prototype.info=function(){};function ul(b,k){if(!b.g)return k;if(!k)return null;try{var M=JSON.parse(k);if(M){for(b=0;b<M.length;b++)if(Array.isArray(M[b])){var G=M[b];if(!(2>G.length)){var lt=G[1];if(Array.isArray(lt)&&!(1>lt.length)){var gt=lt[0];if(gt!="noop"&&gt!="stop"&&gt!="close")for(var At=1;At<lt.length;At++)lt[At]=""}}}}return hr(M)}catch{return k}}var Jo={NO_ERROR:0,gb:1,tb:2,sb:3,nb:4,rb:5,ub:6,Ia:7,TIMEOUT:8,xb:9},ao={lb:"complete",Hb:"success",Ja:"error",Ia:"abort",zb:"ready",Ab:"readystatechange",TIMEOUT:"timeout",vb:"incrementaldata",yb:"progress",ob:"downloadprogress",Pb:"uploadprogress"},yi;function xi(){}x(xi,Th),xi.prototype.g=function(){return new XMLHttpRequest},xi.prototype.i=function(){return{}},yi=new xi;function Us(b,k,M,G){this.j=b,this.i=k,this.l=M,this.R=G||1,this.U=new so(this),this.I=45e3,this.H=null,this.o=!1,this.m=this.A=this.v=this.L=this.F=this.S=this.B=null,this.D=[],this.g=null,this.C=0,this.s=this.u=null,this.X=-1,this.J=!1,this.O=0,this.M=null,this.W=this.K=this.T=this.P=!1,this.h=new En}function En(){this.i=null,this.g="",this.h=!1}var Nh={},$u={};function Qr(b,k,M){b.L=1,b.v=pl(dr(k)),b.m=M,b.P=!0,lo(b,null)}function lo(b,k){b.F=Date.now(),cl(b),b.A=dr(b.v);var M=b.A,G=b.R;Array.isArray(G)||(G=[String(G)]),Fh(M.i,"t",G),b.C=0,M=b.j.J,b.h=new En,b.g=pm(b.j,M?k:null,!b.m),0<b.O&&(b.M=new al(m(b.Y,b,b.g),b.O)),k=b.U,M=b.g,G=b.ca;var lt="readystatechange";Array.isArray(lt)||(lt&&(Ir[0]=lt.toString()),lt=Ir);for(var gt=0;gt<lt.length;gt++){var At=Se(M,lt[gt],G||k.handleEvent,!1,k.h||k);if(!At)break;k.g[At.key]=At}k=b.H?N(b.H):{},b.m?(b.u||(b.u="POST"),k["Content-Type"]="application/x-www-form-urlencoded",b.g.ea(b.A,b.u,b.m,k)):(b.u="GET",b.g.ea(b.A,b.u,null,k)),Qo(),Ah(b.i,b.u,b.A,b.l,b.R,b.m)}Us.prototype.ca=function(b){b=b.target;const k=this.M;k&&Rr(b)==3?k.j():this.Y(b)},Us.prototype.Y=function(b){try{if(b==this.g)t:{const Hn=Rr(this.g);var k=this.g.Ba();const yo=this.g.Z();if(!(3>Hn)&&(Hn!=3||this.g&&(this.h.h||this.g.oa()||om(this.g)))){this.J||Hn!=4||k==7||(k==8||0>=yo?Qo(3):Qo(2)),ta(this);var M=this.g.Z();this.X=M;e:if(Jp(this)){var G=om(this.g);b="";var lt=G.length,gt=Rr(this.g)==4;if(!this.h.i){if(typeof TextDecoder>"u"){ms(this),bi(this);var At="";break e}this.h.i=new l.TextDecoder}for(k=0;k<lt;k++)this.h.h=!0,b+=this.h.i.decode(G[k],{stream:!(gt&&k==lt-1)});G.length=0,this.h.g+=b,this.C=0,At=this.h.g}else At=this.g.oa();if(this.o=M==200,Ux(this.i,this.u,this.A,this.l,this.R,Hn,M),this.o){if(this.T&&!this.K){e:{if(this.g){var Te,Wn=this.g;if((Te=Wn.g?Wn.g.getResponseHeader("X-HTTP-Initial-Response"):null)&&!E(Te)){var Ee=Te;break e}}Ee=null}if(M=Ee)Zo(this.i,this.l,M,"Initial handshake response via X-HTTP-Initial-Response"),this.K=!0,hl(this,M);else{this.o=!1,this.s=3,an(12),ms(this),bi(this);break t}}if(this.P){M=!0;let gs;for(;!this.J&&this.C<At.length;)if(gs=tm(this,At),gs==$u){Hn==4&&(this.s=4,an(14),M=!1),Zo(this.i,this.l,null,"[Incomplete Response]");break}else if(gs==Nh){this.s=4,an(15),Zo(this.i,this.l,At,"[Invalid Chunk]"),M=!1;break}else Zo(this.i,this.l,gs,null),hl(this,gs);if(Jp(this)&&this.C!=0&&(this.h.g=this.h.g.slice(this.C),this.C=0),Hn!=4||At.length!=0||this.h.h||(this.s=1,an(16),M=!1),this.o=this.o&&M,!M)Zo(this.i,this.l,At,"[Invalid Chunked Response]"),ms(this),bi(this);else if(0<At.length&&!this.W){this.W=!0;var ss=this.j;ss.g==this&&ss.ba&&!ss.M&&(ss.j.info("Great, no buffering proxy detected. Bytes received: "+At.length),Cl(ss),ss.M=!0,an(11))}}else Zo(this.i,this.l,At,null),hl(this,At);Hn==4&&ms(this),this.o&&!this.J&&(Hn==4?hm(this.j,this):(this.o=!1,cl(this)))}else jx(this.g),M==400&&0<At.indexOf("Unknown SID")?(this.s=3,an(12)):(this.s=0,an(13)),ms(this),bi(this)}}}catch{}finally{}};function Jp(b){return b.g?b.u=="GET"&&b.L!=2&&b.j.Ca:!1}function tm(b,k){var M=b.C,G=k.indexOf(`
`,M);return G==-1?$u:(M=Number(k.substring(M,G)),isNaN(M)?Nh:(G+=1,G+M>k.length?$u:(k=k.slice(G,G+M),b.C=G+M,k)))}Us.prototype.cancel=function(){this.J=!0,ms(this)};function cl(b){b.S=Date.now()+b.I,em(b,b.I)}function em(b,k){if(b.B!=null)throw Error("WatchDog timer not null");b.B=Rn(m(b.ba,b),k)}function ta(b){b.B&&(l.clearTimeout(b.B),b.B=null)}Us.prototype.ba=function(){this.B=null;const b=Date.now();0<=b-this.S?(Zp(this.i,this.A),this.L!=2&&(Qo(),an(17)),ms(this),this.s=2,bi(this)):em(this,this.S-b)};function bi(b){b.j.G==0||b.J||hm(b.j,b)}function ms(b){ta(b);var k=b.M;k&&typeof k.ma=="function"&&k.ma(),b.M=null,ro(b.U),b.g&&(k=b.g,b.g=null,k.abort(),k.ma())}function hl(b,k){try{var M=b.j;if(M.G!=0&&(M.g==b||Rh(M.h,b))){if(!b.K&&Rh(M.h,b)&&M.G==3){try{var G=M.Da.g.parse(k)}catch{G=null}if(Array.isArray(G)&&G.length==3){var lt=G;if(lt[0]==0){t:if(!M.u){if(M.g)if(M.g.F+3e3<b.F)Wu(M),Uu(M);else break t;Bh(M),an(18)}}else M.za=lt[1],0<M.za-M.T&&37500>lt[2]&&M.F&&M.v==0&&!M.C&&(M.C=Rn(m(M.Za,M),6e3));if(1>=Ou(M.h)&&M.ca){try{M.ca()}catch{}M.ca=void 0}}else go(M,11)}else if((b.K||M.g==b)&&Wu(M),!E(k))for(lt=M.Da.g.parse(k),k=0;k<lt.length;k++){let Ee=lt[k];if(M.T=Ee[0],Ee=Ee[1],M.G==2)if(Ee[0]=="c"){M.K=Ee[1],M.ia=Ee[2];const ss=Ee[3];ss!=null&&(M.la=ss,M.j.info("VER="+M.la));const Hn=Ee[4];Hn!=null&&(M.Aa=Hn,M.j.info("SVER="+M.Aa));const yo=Ee[5];yo!=null&&typeof yo=="number"&&0<yo&&(G=1.5*yo,M.L=G,M.j.info("backChannelRequestTimeoutMs_="+G)),G=M;const gs=b.g;if(gs){const Ii=gs.g?gs.g.getResponseHeader("X-Client-Wire-Protocol"):null;if(Ii){var gt=G.h;gt.g||Ii.indexOf("spdy")==-1&&Ii.indexOf("quic")==-1&&Ii.indexOf("h2")==-1||(gt.j=gt.l,gt.g=new Set,gt.h&&(Mu(gt,gt.h),gt.h=null))}if(G.D){const Gh=gs.g?gs.g.getResponseHeader("X-HTTP-Session-Id"):null;Gh&&(G.ya=Gh,qe(G.I,G.D,Gh))}}M.G=3,M.l&&M.l.ua(),M.ba&&(M.R=Date.now()-b.F,M.j.info("Handshake RTT: "+M.R+"ms")),G=M;var At=b;if(G.qa=fm(G,G.J?G.ia:null,G.W),At.K){Gs(G.h,At);var Te=At,Wn=G.L;Wn&&(Te.I=Wn),Te.B&&(ta(Te),cl(Te)),G.g=At}else um(G);0<M.i.length&&Gu(M)}else Ee[0]!="stop"&&Ee[0]!="close"||go(M,7);else M.G==3&&(Ee[0]=="stop"||Ee[0]=="close"?Ee[0]=="stop"?go(M,7):Vh(M):Ee[0]!="noop"&&M.l&&M.l.ta(Ee),M.v=0)}}Qo(4)}catch{}}var nm=class{constructor(b,k){this.g=b,this.map=k}};function uo(b){this.l=b||10,l.PerformanceNavigationTiming?(b=l.performance.getEntriesByType("navigation"),b=0<b.length&&(b[0].nextHopProtocol=="hq"||b[0].nextHopProtocol=="h2")):b=!!(l.chrome&&l.chrome.loadTimes&&l.chrome.loadTimes()&&l.chrome.loadTimes().wasFetchedViaSpdy),this.j=b?this.l:1,this.g=null,1<this.j&&(this.g=new Set),this.h=null,this.i=[]}function Du(b){return b.h?!0:b.g?b.g.size>=b.j:!1}function Ou(b){return b.h?1:b.g?b.g.size:0}function Rh(b,k){return b.h?b.h==k:b.g?b.g.has(k):!1}function Mu(b,k){b.g?b.g.add(k):b.h=k}function Gs(b,k){b.h&&b.h==k?b.h=null:b.g&&b.g.has(k)&&b.g.delete(k)}uo.prototype.cancel=function(){if(this.i=$h(this),this.h)this.h.cancel(),this.h=null;else if(this.g&&this.g.size!==0){for(const b of this.g.values())b.cancel();this.g.clear()}};function $h(b){if(b.h!=null)return b.i.concat(b.h.D);if(b.g!=null&&b.g.size!==0){let k=b.i;for(const M of b.g.values())k=k.concat(M.D);return k}return v(b.i)}function Gx(b){if(b.V&&typeof b.V=="function")return b.V();if(typeof Map<"u"&&b instanceof Map||typeof Set<"u"&&b instanceof Set)return Array.from(b.values());if(typeof b=="string")return b.split("");if(u(b)){for(var k=[],M=b.length,G=0;G<M;G++)k.push(b[G]);return k}k=[],M=0;for(G in b)k[M++]=b[G];return k}function Fu(b){if(b.na&&typeof b.na=="function")return b.na();if(!b.V||typeof b.V!="function"){if(typeof Map<"u"&&b instanceof Map)return Array.from(b.keys());if(!(typeof Set<"u"&&b instanceof Set)){if(u(b)||typeof b=="string"){var k=[];b=b.length;for(var M=0;M<b;M++)k.push(M);return k}k=[],M=0;for(const G in b)k[M++]=G;return k}}}function Dh(b,k){if(b.forEach&&typeof b.forEach=="function")b.forEach(k,void 0);else if(u(b)||typeof b=="string")Array.prototype.forEach.call(b,k,void 0);else for(var M=Fu(b),G=Gx(b),lt=G.length,gt=0;gt<lt;gt++)k.call(void 0,G[gt],M&&M[gt],b)}var dl=RegExp("^(?:([^:/?#.]+):)?(?://(?:([^\\\\/?#]*)@)?([^\\\\/?#]*?)(?::([0-9]+))?(?=[\\\\/?#]|$))?([^?#]+)?(?:\\?([^#]*))?(?:#([\\s\\S]*))?$");function Wx(b,k){if(b){b=b.split("&");for(var M=0;M<b.length;M++){var G=b[M].indexOf("="),lt=null;if(0<=G){var gt=b[M].substring(0,G);lt=b[M].substring(G+1)}else gt=b[M];k(gt,lt?decodeURIComponent(lt.replace(/\+/g," ")):"")}}}function $n(b){if(this.g=this.o=this.j="",this.s=null,this.m=this.l="",this.h=!1,b instanceof $n){this.h=b.h,fl(this,b.j),this.o=b.o,this.g=b.g,ea(this,b.s),this.l=b.l;var k=b.i,M=new ho;M.i=k.i,k.g&&(M.g=new Map(k.g),M.h=k.h),co(this,M),this.m=b.m}else b&&(k=String(b).match(dl))?(this.h=!1,fl(this,k[1]||"",!0),this.o=kr(k[2]||""),this.g=kr(k[3]||"",!0),ea(this,k[4]),this.l=kr(k[5]||"",!0),co(this,k[6]||"",!0),this.m=kr(k[7]||"")):(this.h=!1,this.i=new ho(null,this.h))}$n.prototype.toString=function(){var b=[],k=this.j;k&&b.push(ml(k,Oh,!0),":");var M=this.g;return(M||k=="file")&&(b.push("//"),(k=this.o)&&b.push(ml(k,Oh,!0),"@"),b.push(encodeURIComponent(String(M)).replace(/%25([0-9a-fA-F]{2})/g,"%$1")),M=this.s,M!=null&&b.push(":",String(M))),(M=this.l)&&(this.g&&M.charAt(0)!="/"&&b.push("/"),b.push(ml(M,M.charAt(0)=="/"?Hx:Mh,!0))),(M=this.i.toString())&&b.push("?",M),(M=this.m)&&b.push("#",ml(M,Lu)),b.join("")};function dr(b){return new $n(b)}function fl(b,k,M){b.j=M?kr(k,!0):k,b.j&&(b.j=b.j.replace(/:$/,""))}function ea(b,k){if(k){if(k=Number(k),isNaN(k)||0>k)throw Error("Bad port number "+k);b.s=k}else b.s=null}function co(b,k,M){k instanceof ho?(b.i=k,rm(b.i,b.h)):(M||(k=ml(k,qx)),b.i=new ho(k,b.h))}function qe(b,k,M){b.i.set(k,M)}function pl(b){return qe(b,"zx",Math.floor(2147483648*Math.random()).toString(36)+Math.abs(Math.floor(2147483648*Math.random())^Date.now()).toString(36)),b}function kr(b,k){return b?k?decodeURI(b.replace(/%25/g,"%2525")):decodeURIComponent(b):""}function ml(b,k,M){return typeof b=="string"?(b=encodeURI(b).replace(k,sm),M&&(b=b.replace(/%25([0-9a-fA-F]{2})/g,"%$1")),b):null}function sm(b){return b=b.charCodeAt(0),"%"+(b>>4&15).toString(16)+(b&15).toString(16)}var Oh=/[#\/\?@]/g,Mh=/[#\?:]/g,Hx=/[#\?]/g,qx=/[#\?@]/g,Lu=/#/g;function ho(b,k){this.h=this.g=null,this.i=b||null,this.j=!!k}function Ar(b){b.g||(b.g=new Map,b.h=0,b.i&&Wx(b.i,function(k,M){b.add(decodeURIComponent(k.replace(/\+/g," ")),M)}))}n=ho.prototype,n.add=function(b,k){Ar(this),this.i=null,b=vi(this,b);var M=this.g.get(b);return M||this.g.set(b,M=[]),M.push(k),this.h+=1,this};function fo(b,k){Ar(b),k=vi(b,k),b.g.has(k)&&(b.i=null,b.h-=b.g.get(k).length,b.g.delete(k))}function po(b,k){return Ar(b),k=vi(b,k),b.g.has(k)}n.forEach=function(b,k){Ar(this),this.g.forEach(function(M,G){M.forEach(function(lt){b.call(k,lt,G,this)},this)},this)},n.na=function(){Ar(this);const b=Array.from(this.g.values()),k=Array.from(this.g.keys()),M=[];for(let G=0;G<k.length;G++){const lt=b[G];for(let gt=0;gt<lt.length;gt++)M.push(k[G])}return M},n.V=function(b){Ar(this);let k=[];if(typeof b=="string")po(this,b)&&(k=k.concat(this.g.get(vi(this,b))));else{b=Array.from(this.g.values());for(let M=0;M<b.length;M++)k=k.concat(b[M])}return k},n.set=function(b,k){return Ar(this),this.i=null,b=vi(this,b),po(this,b)&&(this.h-=this.g.get(b).length),this.g.set(b,[k]),this.h+=1,this},n.get=function(b,k){return b?(b=this.V(b),0<b.length?String(b[0]):k):k};function Fh(b,k,M){fo(b,k),0<M.length&&(b.i=null,b.g.set(vi(b,k),v(M)),b.h+=M.length)}n.toString=function(){if(this.i)return this.i;if(!this.g)return"";const b=[],k=Array.from(this.g.keys());for(var M=0;M<k.length;M++){var G=k[M];const gt=encodeURIComponent(String(G)),At=this.V(G);for(G=0;G<At.length;G++){var lt=gt;At[G]!==""&&(lt+="="+encodeURIComponent(String(At[G]))),b.push(lt)}}return this.i=b.join("&")};function vi(b,k){return k=String(k),b.j&&(k=k.toLowerCase()),k}function rm(b,k){k&&!b.j&&(Ar(b),b.i=null,b.g.forEach(function(M,G){var lt=G.toLowerCase();G!=lt&&(fo(this,G),Fh(this,lt,M))},b)),b.j=k}function gl(b,k){const M=new _r;if(l.Image){const G=new Image;G.onload=y(Nr,M,"TestLoadImage: loaded",!0,k,G),G.onerror=y(Nr,M,"TestLoadImage: error",!1,k,G),G.onabort=y(Nr,M,"TestLoadImage: abort",!1,k,G),G.ontimeout=y(Nr,M,"TestLoadImage: timeout",!1,k,G),l.setTimeout(function(){G.ontimeout&&G.ontimeout()},1e4),G.src=b}else k(!1)}function Zr(b,k){const M=new _r,G=new AbortController,lt=setTimeout(()=>{G.abort(),Nr(M,"TestPingServer: timeout",!1,k)},1e4);fetch(b,{signal:G.signal}).then(gt=>{clearTimeout(lt),gt.ok?Nr(M,"TestPingServer: ok",!0,k):Nr(M,"TestPingServer: server error",!1,k)}).catch(()=>{clearTimeout(lt),Nr(M,"TestPingServer: error",!1,k)})}function Nr(b,k,M,G,lt){try{lt&&(lt.onload=null,lt.onerror=null,lt.onabort=null,lt.ontimeout=null),G(M)}catch{}}function yl(){this.g=new ll}function wi(b,k,M){const G=M||"";try{Dh(b,function(lt,gt){let At=lt;h(lt)&&(At=hr(lt)),k.push(G+gt+"="+encodeURIComponent(At))})}catch(lt){throw k.push(G+"type="+encodeURIComponent("_badmap")),lt}}function na(b){this.l=b.Ub||null,this.j=b.eb||!1}x(na,Th),na.prototype.g=function(){return new mo(this.l,this.j)},na.prototype.i=function(b){return function(){return b}}({});function mo(b,k){Fe.call(this),this.D=b,this.o=k,this.m=void 0,this.status=this.readyState=0,this.responseType=this.responseText=this.response=this.statusText="",this.onreadystatechange=null,this.u=new Headers,this.h=null,this.B="GET",this.A="",this.g=!1,this.v=this.j=this.l=null}x(mo,Fe),n=mo.prototype,n.open=function(b,k){if(this.readyState!=0)throw this.abort(),Error("Error reopening a connection");this.B=b,this.A=k,this.readyState=1,Si(this)},n.send=function(b){if(this.readyState!=1)throw this.abort(),Error("need to call open() first. ");this.g=!0;const k={headers:this.u,method:this.B,credentials:this.m,cache:void 0};b&&(k.body=b),(this.D||l).fetch(new Request(this.A,k)).then(this.Sa.bind(this),this.ga.bind(this))},n.abort=function(){this.response=this.responseText="",this.u=new Headers,this.status=0,this.j&&this.j.cancel("Request was aborted.").catch(()=>{}),1<=this.readyState&&this.g&&this.readyState!=4&&(this.g=!1,Ci(this)),this.readyState=0},n.Sa=function(b){if(this.g&&(this.l=b,this.h||(this.status=this.l.status,this.statusText=this.l.statusText,this.h=b.headers,this.readyState=2,Si(this)),this.g&&(this.readyState=3,Si(this),this.g)))if(this.responseType==="arraybuffer")b.arrayBuffer().then(this.Qa.bind(this),this.ga.bind(this));else if(typeof l.ReadableStream<"u"&&"body"in b){if(this.j=b.body.getReader(),this.o){if(this.responseType)throw Error('responseType must be empty for "streamBinaryChunks" mode responses.');this.response=[]}else this.response=this.responseText="",this.v=new TextDecoder;Lh(this)}else b.text().then(this.Ra.bind(this),this.ga.bind(this))};function Lh(b){b.j.read().then(b.Pa.bind(b)).catch(b.ga.bind(b))}n.Pa=function(b){if(this.g){if(this.o&&b.value)this.response.push(b.value);else if(!this.o){var k=b.value?b.value:new Uint8Array(0);(k=this.v.decode(k,{stream:!b.done}))&&(this.response=this.responseText+=k)}b.done?Ci(this):Si(this),this.readyState==3&&Lh(this)}},n.Ra=function(b){this.g&&(this.response=this.responseText=b,Ci(this))},n.Qa=function(b){this.g&&(this.response=b,Ci(this))},n.ga=function(){this.g&&Ci(this)};function Ci(b){b.readyState=4,b.l=null,b.j=null,b.v=null,Si(b)}n.setRequestHeader=function(b,k){this.u.append(b,k)},n.getResponseHeader=function(b){return this.h&&this.h.get(b.toLowerCase())||""},n.getAllResponseHeaders=function(){if(!this.h)return"";const b=[],k=this.h.entries();for(var M=k.next();!M.done;)M=M.value,b.push(M[0]+": "+M[1]),M=k.next();return b.join(`\r
`)};function Si(b){b.onreadystatechange&&b.onreadystatechange.call(b)}Object.defineProperty(mo.prototype,"withCredentials",{get:function(){return this.m==="include"},set:function(b){this.m=b?"include":"same-origin"}});function Ph(b){let k="";return P(b,function(M,G){k+=G,k+=":",k+=M,k+=`\r
`}),k}function ns(b,k,M){t:{for(G in M){var G=!1;break t}G=!0}G||(M=Ph(M),typeof b=="string"?M!=null&&encodeURIComponent(String(M)):qe(b,k,M))}function Pe(b){Fe.call(this),this.headers=new Map,this.o=b||null,this.h=!1,this.v=this.g=null,this.D="",this.m=0,this.l="",this.j=this.B=this.u=this.A=!1,this.I=null,this.H="",this.J=!1}x(Pe,Fe);var Pu=/^https?$/i,xl=["POST","PUT"];n=Pe.prototype,n.Ha=function(b){this.J=b},n.ea=function(b,k,M,G){if(this.g)throw Error("[goog.net.XhrIo] Object is active with another request="+this.D+"; newUri="+b);k=k?k.toUpperCase():"GET",this.D=b,this.l="",this.m=0,this.A=!1,this.h=!0,this.g=this.o?this.o.g():yi.g(),this.v=this.o?Eh(this.o):Eh(yi),this.g.onreadystatechange=m(this.Ea,this);try{this.B=!0,this.g.open(k,String(b),!0),this.B=!1}catch(gt){im(this,gt);return}if(b=M||"",M=new Map(this.headers),G)if(Object.getPrototypeOf(G)===Object.prototype)for(var lt in G)M.set(lt,G[lt]);else if(typeof G.keys=="function"&&typeof G.get=="function")for(const gt of G.keys())M.set(gt,G.get(gt));else throw Error("Unknown input type for opt_headers: "+String(G));G=Array.from(M.keys()).find(gt=>gt.toLowerCase()=="content-type"),lt=l.FormData&&b instanceof l.FormData,!(0<=Array.prototype.indexOf.call(xl,k,void 0))||G||lt||M.set("Content-Type","application/x-www-form-urlencoded;charset=utf-8");for(const[gt,At]of M)this.g.setRequestHeader(gt,At);this.H&&(this.g.responseType=this.H),"withCredentials"in this.g&&this.g.withCredentials!==this.J&&(this.g.withCredentials=this.J);try{bl(this),this.u=!0,this.g.send(b),this.u=!1}catch(gt){im(this,gt)}};function im(b,k){b.h=!1,b.g&&(b.j=!0,b.g.abort(),b.j=!1),b.l=k,b.m=5,Vu(b),Ti(b)}function Vu(b){b.A||(b.A=!0,fe(b,"complete"),fe(b,"error"))}n.abort=function(b){this.g&&this.h&&(this.h=!1,this.j=!0,this.g.abort(),this.j=!1,this.m=b||7,fe(this,"complete"),fe(this,"abort"),Ti(this))},n.N=function(){this.g&&(this.h&&(this.h=!1,this.j=!0,this.g.abort(),this.j=!1),Ti(this,!0)),Pe.aa.N.call(this)},n.Ea=function(){this.s||(this.B||this.u||this.j?zu(this):this.bb())},n.bb=function(){zu(this)};function zu(b){if(b.h&&typeof o<"u"&&(!b.v[1]||Rr(b)!=4||b.Z()!=2)){if(b.u&&Rr(b)==4)gn(b.Ea,0,b);else if(fe(b,"readystatechange"),Rr(b)==4){b.h=!1;try{const At=b.Z();t:switch(At){case 200:case 201:case 202:case 204:case 206:case 304:case 1223:var k=!0;break t;default:k=!1}var M;if(!(M=k)){var G;if(G=At===0){var lt=String(b.D).match(dl)[1]||null;!lt&&l.self&&l.self.location&&(lt=l.self.location.protocol.slice(0,-1)),G=!Pu.test(lt?lt.toLowerCase():"")}M=G}if(M)fe(b,"complete"),fe(b,"success");else{b.m=6;try{var gt=2<Rr(b)?b.g.statusText:""}catch{gt=""}b.l=gt+" ["+b.Z()+"]",Vu(b)}}finally{Ti(b)}}}}function Ti(b,k){if(b.g){bl(b);const M=b.g,G=b.v[0]?()=>{}:null;b.g=null,b.v=null,k||fe(b,"ready");try{M.onreadystatechange=G}catch{}}}function bl(b){b.I&&(l.clearTimeout(b.I),b.I=null)}n.isActive=function(){return!!this.g};function Rr(b){return b.g?b.g.readyState:0}n.Z=function(){try{return 2<Rr(this)?this.g.status:-1}catch{return-1}},n.oa=function(){try{return this.g?this.g.responseText:""}catch{return""}},n.Oa=function(b){if(this.g){var k=this.g.responseText;return b&&k.indexOf(b)==0&&(k=k.substring(b.length)),Nu(k)}};function om(b){try{if(!b.g)return null;if("response"in b.g)return b.g.response;switch(b.H){case"":case"text":return b.g.responseText;case"arraybuffer":if("mozResponseArrayBuffer"in b.g)return b.g.mozResponseArrayBuffer}return null}catch{return null}}function jx(b){const k={};b=(b.g&&2<=Rr(b)&&b.g.getAllResponseHeaders()||"").split(`\r
`);for(let G=0;G<b.length;G++){if(E(b[G]))continue;var M=A(b[G]);const lt=M[0];if(M=M[1],typeof M!="string")continue;M=M.trim();const gt=k[lt]||[];k[lt]=gt,gt.push(M)}D(k,function(G){return G.join(", ")})}n.Ba=function(){return this.m},n.Ka=function(){return typeof this.l=="string"?this.l:String(this.l)};function vl(b,k,M){return M&&M.internalChannelParams&&M.internalChannelParams[b]||k}function Bu(b){this.Aa=0,this.i=[],this.j=new _r,this.ia=this.qa=this.I=this.W=this.g=this.ya=this.D=this.H=this.m=this.S=this.o=null,this.Ya=this.U=0,this.Va=vl("failFast",!1,b),this.F=this.C=this.u=this.s=this.l=null,this.X=!0,this.za=this.T=-1,this.Y=this.v=this.B=0,this.Ta=vl("baseRetryDelayMs",5e3,b),this.cb=vl("retryDelaySeedMs",1e4,b),this.Wa=vl("forwardChannelMaxRetries",2,b),this.wa=vl("forwardChannelRequestTimeoutMs",2e4,b),this.pa=b&&b.xmlHttpFactory||void 0,this.Xa=b&&b.Tb||void 0,this.Ca=b&&b.useFetchStreams||!1,this.L=void 0,this.J=b&&b.supportsCrossDomainXhr||!1,this.K="",this.h=new uo(b&&b.concurrentRequestLimit),this.Da=new yl,this.P=b&&b.fastHandshake||!1,this.O=b&&b.encodeInitMessageHeaders||!1,this.P&&this.O&&(this.O=!1),this.Ua=b&&b.Rb||!1,b&&b.xa&&this.j.xa(),b&&b.forceLongPolling&&(this.X=!1),this.ba=!this.P&&this.X&&b&&b.detectBufferingProxy||!1,this.ja=void 0,b&&b.longPollingTimeout&&0<b.longPollingTimeout&&(this.ja=b.longPollingTimeout),this.ca=void 0,this.R=0,this.M=!1,this.ka=this.A=null}n=Bu.prototype,n.la=8,n.G=1,n.connect=function(b,k,M,G){an(0),this.W=b,this.H=k||{},M&&G!==void 0&&(this.H.OSID=M,this.H.OAID=G),this.F=this.X,this.I=fm(this,null,this.W),Gu(this)};function Vh(b){if(am(b),b.G==3){var k=b.U++,M=dr(b.I);if(qe(M,"SID",b.K),qe(M,"RID",k),qe(M,"TYPE","terminate"),wl(b,M),k=new Us(b,b.j,k),k.L=2,k.v=pl(dr(M)),M=!1,l.navigator&&l.navigator.sendBeacon)try{M=l.navigator.sendBeacon(k.v.toString(),"")}catch{}!M&&l.Image&&(new Image().src=k.v,M=!0),M||(k.g=pm(k.j,null),k.g.ea(k.v)),k.F=Date.now(),cl(k)}dm(b)}function Uu(b){b.g&&(Cl(b),b.g.cancel(),b.g=null)}function am(b){Uu(b),b.u&&(l.clearTimeout(b.u),b.u=null),Wu(b),b.h.cancel(),b.s&&(typeof b.s=="number"&&l.clearTimeout(b.s),b.s=null)}function Gu(b){if(!Du(b.h)&&!b.s){b.s=!0;var k=b.Ga;K||B(),Y||(K(),Y=!0),at.add(k,b),b.B=0}}function Kx(b,k){return Ou(b.h)>=b.h.j-(b.s?1:0)?!1:b.s?(b.i=k.D.concat(b.i),!0):b.G==1||b.G==2||b.B>=(b.Va?0:b.Wa)?!1:(b.s=Rn(m(b.Ga,b,k),Uh(b,b.B)),b.B++,!0)}n.Ga=function(b){if(this.s)if(this.s=null,this.G==1){if(!b){this.U=Math.floor(1e5*Math.random()),b=this.U++;const lt=new Us(this,this.j,b);let gt=this.o;if(this.S&&(gt?(gt=N(gt),$(gt,this.S)):gt=this.S),this.m!==null||this.O||(lt.H=gt,gt=null),this.P)t:{for(var k=0,M=0;M<this.i.length;M++){e:{var G=this.i[M];if("__data__"in G.map&&(G=G.map.__data__,typeof G=="string")){G=G.length;break e}G=void 0}if(G===void 0)break;if(k+=G,4096<k){k=M;break t}if(k===4096||M===this.i.length-1){k=M+1;break t}}k=1e3}else k=1e3;k=lm(this,lt,k),M=dr(this.I),qe(M,"RID",b),qe(M,"CVER",22),this.D&&qe(M,"X-HTTP-Session-Id",this.D),wl(this,M),gt&&(this.O?k="headers="+encodeURIComponent(String(Ph(gt)))+"&"+k:this.m&&ns(M,this.m,gt)),Mu(this.h,lt),this.Ua&&qe(M,"TYPE","init"),this.P?(qe(M,"$req",k),qe(M,"SID","null"),lt.T=!0,Qr(lt,M,null)):Qr(lt,M,k),this.G=2}}else this.G==3&&(b?zh(this,b):this.i.length==0||Du(this.h)||zh(this))};function zh(b,k){var M;k?M=k.l:M=b.U++;const G=dr(b.I);qe(G,"SID",b.K),qe(G,"RID",M),qe(G,"AID",b.T),wl(b,G),b.m&&b.o&&ns(G,b.m,b.o),M=new Us(b,b.j,M,b.B+1),b.m===null&&(M.H=b.o),k&&(b.i=k.D.concat(b.i)),k=lm(b,M,1e3),M.I=Math.round(.5*b.wa)+Math.round(.5*b.wa*Math.random()),Mu(b.h,M),Qr(M,G,k)}function wl(b,k){b.H&&P(b.H,function(M,G){qe(k,G,M)}),b.l&&Dh({},function(M,G){qe(k,G,M)})}function lm(b,k,M){M=Math.min(b.i.length,M);var G=b.l?m(b.l.Na,b.l,b):null;t:{var lt=b.i;let gt=-1;for(;;){const At=["count="+M];gt==-1?0<M?(gt=lt[0].g,At.push("ofs="+gt)):gt=0:At.push("ofs="+gt);let Te=!0;for(let Wn=0;Wn<M;Wn++){let Ee=lt[Wn].g;const ss=lt[Wn].map;if(Ee-=gt,0>Ee)gt=Math.max(0,lt[Wn].g-100),Te=!1;else try{wi(ss,At,"req"+Ee+"_")}catch{G&&G(ss)}}if(Te){G=At.join("&");break t}}}return b=b.i.splice(0,M),k.D=b,G}function um(b){if(!b.g&&!b.u){b.Y=1;var k=b.Fa;K||B(),Y||(K(),Y=!0),at.add(k,b),b.v=0}}function Bh(b){return b.g||b.u||3<=b.v?!1:(b.Y++,b.u=Rn(m(b.Fa,b),Uh(b,b.v)),b.v++,!0)}n.Fa=function(){if(this.u=null,cm(this),this.ba&&!(this.M||this.g==null||0>=this.R)){var b=2*this.R;this.j.info("BP detection timer enabled: "+b),this.A=Rn(m(this.ab,this),b)}},n.ab=function(){this.A&&(this.A=null,this.j.info("BP detection timeout reached."),this.j.info("Buffering proxy detected and switch to long-polling!"),this.F=!1,this.M=!0,an(10),Uu(this),cm(this))};function Cl(b){b.A!=null&&(l.clearTimeout(b.A),b.A=null)}function cm(b){b.g=new Us(b,b.j,"rpc",b.Y),b.m===null&&(b.g.H=b.o),b.g.O=0;var k=dr(b.qa);qe(k,"RID","rpc"),qe(k,"SID",b.K),qe(k,"AID",b.T),qe(k,"CI",b.F?"0":"1"),!b.F&&b.ja&&qe(k,"TO",b.ja),qe(k,"TYPE","xmlhttp"),wl(b,k),b.m&&b.o&&ns(k,b.m,b.o),b.L&&(b.g.I=b.L);var M=b.g;b=b.ia,M.L=1,M.v=pl(dr(k)),M.m=null,M.P=!0,lo(M,b)}n.Za=function(){this.C!=null&&(this.C=null,Uu(this),Bh(this),an(19))};function Wu(b){b.C!=null&&(l.clearTimeout(b.C),b.C=null)}function hm(b,k){var M=null;if(b.g==k){Wu(b),Cl(b),b.g=null;var G=2}else if(Rh(b.h,k))M=k.D,Gs(b.h,k),G=1;else return;if(b.G!=0){if(k.o)if(G==1){M=k.m?k.m.length:0,k=Date.now()-k.F;var lt=b.B;G=Yo(),fe(G,new Gn(G,M)),Gu(b)}else um(b);else if(lt=k.s,lt==3||lt==0&&0<k.X||!(G==1&&Kx(b,k)||G==2&&Bh(b)))switch(M&&0<M.length&&(k=b.h,k.i=k.i.concat(M)),lt){case 1:go(b,5);break;case 4:go(b,10);break;case 3:go(b,6);break;default:go(b,2)}}}function Uh(b,k){let M=b.Ta+Math.floor(Math.random()*b.cb);return b.isActive()||(M*=2),M*k}function go(b,k){if(b.j.info("Error code "+k),k==2){var M=m(b.fb,b),G=b.Xa;const lt=!G;G=new $n(G||"//www.google.com/images/cleardot.gif"),l.location&&l.location.protocol=="http"||fl(G,"https"),pl(G),lt?gl(G.toString(),M):Zr(G.toString(),M)}else an(2);b.G=0,b.l&&b.l.sa(k),dm(b),am(b)}n.fb=function(b){b?(this.j.info("Successfully pinged google.com"),an(2)):(this.j.info("Failed to ping google.com"),an(1))};function dm(b){if(b.G=0,b.ka=[],b.l){const k=$h(b.h);(k.length!=0||b.i.length!=0)&&(C(b.ka,k),C(b.ka,b.i),b.h.i.length=0,v(b.i),b.i.length=0),b.l.ra()}}function fm(b,k,M){var G=M instanceof $n?dr(M):new $n(M);if(G.g!="")k&&(G.g=k+"."+G.g),ea(G,G.s);else{var lt=l.location;G=lt.protocol,k=k?k+"."+lt.hostname:lt.hostname,lt=+lt.port;var gt=new $n(null);G&&fl(gt,G),k&&(gt.g=k),lt&&ea(gt,lt),M&&(gt.l=M),G=gt}return M=b.D,k=b.ya,M&&k&&qe(G,M,k),qe(G,"VER",b.la),wl(b,G),G}function pm(b,k,M){if(k&&!b.J)throw Error("Can't create secondary domain capable XhrIo object.");return k=b.Ca&&!b.pa?new Pe(new na({eb:M})):new Pe(b.pa),k.Ha(b.J),k}n.isActive=function(){return!!this.l&&this.l.isActive(this)};function mm(){}n=mm.prototype,n.ua=function(){},n.ta=function(){},n.sa=function(){},n.ra=function(){},n.isActive=function(){return!0},n.Na=function(){};function Hu(){}Hu.prototype.g=function(b,k){return new Ws(b,k)};function Ws(b,k){Fe.call(this),this.g=new Bu(k),this.l=b,this.h=k&&k.messageUrlParams||null,b=k&&k.messageHeaders||null,k&&k.clientProtocolHeaderRequired&&(b?b["X-Client-Protocol"]="webchannel":b={"X-Client-Protocol":"webchannel"}),this.g.o=b,b=k&&k.initMessageHeaders||null,k&&k.messageContentType&&(b?b["X-WebChannel-Content-Type"]=k.messageContentType:b={"X-WebChannel-Content-Type":k.messageContentType}),k&&k.va&&(b?b["X-WebChannel-Client-Profile"]=k.va:b={"X-WebChannel-Client-Profile":k.va}),this.g.S=b,(b=k&&k.Sb)&&!E(b)&&(this.g.m=b),this.v=k&&k.supportsCrossDomainXhr||!1,this.u=k&&k.sendRawJson||!1,(k=k&&k.httpSessionIdParam)&&!E(k)&&(this.g.D=k,b=this.h,b!==null&&k in b&&(b=this.h,k in b&&delete b[k])),this.j=new Ei(this)}x(Ws,Fe),Ws.prototype.m=function(){this.g.l=this.j,this.v&&(this.g.J=!0),this.g.connect(this.l,this.h||void 0)},Ws.prototype.close=function(){Vh(this.g)},Ws.prototype.o=function(b){var k=this.g;if(typeof b=="string"){var M={};M.__data__=b,b=M}else this.u&&(M={},M.__data__=hr(b),b=M);k.i.push(new nm(k.Ya++,b)),k.G==3&&Gu(k)},Ws.prototype.N=function(){this.g.l=null,delete this.j,Vh(this.g),delete this.g,Ws.aa.N.call(this)};function gm(b){oo.call(this),b.__headers__&&(this.headers=b.__headers__,this.statusCode=b.__status__,delete b.__headers__,delete b.__status__);var k=b.__sm__;if(k){t:{for(const M in k){b=M;break t}b=void 0}(this.i=b)&&(b=this.i,k=k!==null&&b in k?k[b]:void 0),this.data=k}else this.data=b}x(gm,oo);function ym(){_h.call(this),this.status=1}x(ym,_h);function Ei(b){this.g=b}x(Ei,mm),Ei.prototype.ua=function(){fe(this.g,"a")},Ei.prototype.ta=function(b){fe(this.g,new gm(b))},Ei.prototype.sa=function(b){fe(this.g,new ym)},Ei.prototype.ra=function(){fe(this.g,"b")},Hu.prototype.createWebChannel=Hu.prototype.g,Ws.prototype.send=Ws.prototype.o,Ws.prototype.open=Ws.prototype.m,Ws.prototype.close=Ws.prototype.close,eR=function(){return new Hu},tR=function(){return Yo()},JN=gi,Nv={mb:0,pb:1,qb:2,Jb:3,Ob:4,Lb:5,Mb:6,Kb:7,Ib:8,Nb:9,PROXY:10,NOPROXY:11,Gb:12,Cb:13,Db:14,Bb:15,Eb:16,Fb:17,ib:18,hb:19,jb:20},Jo.NO_ERROR=0,Jo.TIMEOUT=8,Jo.HTTP_ERROR=6,Bg=Jo,ao.COMPLETE="complete",ZN=ao,Ih.EventType=io,io.OPEN="a",io.CLOSE="b",io.ERROR="c",io.MESSAGE="d",Fe.prototype.listen=Fe.prototype.K,Ld=Ih,Pe.prototype.listenOnce=Pe.prototype.L,Pe.prototype.getLastError=Pe.prototype.Ka,Pe.prototype.getLastErrorCode=Pe.prototype.Ba,Pe.prototype.getStatus=Pe.prototype.Z,Pe.prototype.getResponseJson=Pe.prototype.Oa,Pe.prototype.getResponseText=Pe.prototype.oa,Pe.prototype.send=Pe.prototype.ea,Pe.prototype.setWithCredentials=Pe.prototype.Ha,QN=Pe}).apply(typeof bg<"u"?bg:typeof self<"u"?self:typeof window<"u"?window:{});const L_="@firebase/firestore",P_="4.7.17";/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ds{constructor(t){this.uid=t}isAuthenticated(){return this.uid!=null}toKey(){return this.isAuthenticated()?"uid:"+this.uid:"anonymous-user"}isEqual(t){return t.uid===this.uid}}Ds.UNAUTHENTICATED=new Ds(null),Ds.GOOGLE_CREDENTIALS=new Ds("google-credentials-uid"),Ds.FIRST_PARTY=new Ds("first-party-uid"),Ds.MOCK_USER=new Ds("mock-user");/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let rh="11.9.0";/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Zl=new WN("@firebase/firestore");function Sc(){return Zl.logLevel}function Mt(n,...t){if(Zl.logLevel<=ke.DEBUG){const e=t.map(Pw);Zl.debug(`Firestore (${rh}): ${n}`,...e)}}function Po(n,...t){if(Zl.logLevel<=ke.ERROR){const e=t.map(Pw);Zl.error(`Firestore (${rh}): ${n}`,...e)}}function Lc(n,...t){if(Zl.logLevel<=ke.WARN){const e=t.map(Pw);Zl.warn(`Firestore (${rh}): ${n}`,...e)}}function Pw(n){if(typeof n=="string")return n;try{/**
* @license
* Copyright 2020 Google LLC
*
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
*   http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
*/return function(e){return JSON.stringify(e)}(n)}catch{return n}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Jt(n,t,e){let s="Unexpected state";typeof t=="string"?s=t:e=t,nR(n,s,e)}function nR(n,t,e){let s=`FIRESTORE (${rh}) INTERNAL ASSERTION FAILED: ${t} (ID: ${n.toString(16)})`;if(e!==void 0)try{s+=" CONTEXT: "+JSON.stringify(e)}catch{s+=" CONTEXT: "+e}throw Po(s),new Error(s)}function ze(n,t,e,s){let r="Unexpected state";typeof e=="string"?r=e:s=e,n||nR(t,r,s)}function se(n,t){return n}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const _t={OK:"ok",CANCELLED:"cancelled",UNKNOWN:"unknown",INVALID_ARGUMENT:"invalid-argument",DEADLINE_EXCEEDED:"deadline-exceeded",NOT_FOUND:"not-found",ALREADY_EXISTS:"already-exists",PERMISSION_DENIED:"permission-denied",UNAUTHENTICATED:"unauthenticated",RESOURCE_EXHAUSTED:"resource-exhausted",FAILED_PRECONDITION:"failed-precondition",ABORTED:"aborted",OUT_OF_RANGE:"out-of-range",UNIMPLEMENTED:"unimplemented",INTERNAL:"internal",UNAVAILABLE:"unavailable",DATA_LOSS:"data-loss"};class Ht extends sh{constructor(t,e){super(t,e),this.code=t,this.message=e,this.toString=()=>`${this.name}: [code=${this.code}]: ${this.message}`}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class $a{constructor(){this.promise=new Promise((t,e)=>{this.resolve=t,this.reject=e})}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class sR{constructor(t,e){this.user=e,this.type="OAuth",this.headers=new Map,this.headers.set("Authorization",`Bearer ${t}`)}}class aU{getToken(){return Promise.resolve(null)}invalidateToken(){}start(t,e){t.enqueueRetryable(()=>e(Ds.UNAUTHENTICATED))}shutdown(){}}class lU{constructor(t){this.token=t,this.changeListener=null}getToken(){return Promise.resolve(this.token)}invalidateToken(){}start(t,e){this.changeListener=e,t.enqueueRetryable(()=>e(this.token.user))}shutdown(){this.changeListener=null}}class uU{constructor(t){this.t=t,this.currentUser=Ds.UNAUTHENTICATED,this.i=0,this.forceRefresh=!1,this.auth=null}start(t,e){ze(this.o===void 0,42304);let s=this.i;const r=u=>this.i!==s?(s=this.i,e(u)):Promise.resolve();let i=new $a;this.o=()=>{this.i++,this.currentUser=this.u(),i.resolve(),i=new $a,t.enqueueRetryable(()=>r(this.currentUser))};const o=()=>{const u=i;t.enqueueRetryable(async()=>{await u.promise,await r(this.currentUser)})},l=u=>{Mt("FirebaseAuthCredentialsProvider","Auth detected"),this.auth=u,this.o&&(this.auth.addAuthTokenListener(this.o),o())};this.t.onInit(u=>l(u)),setTimeout(()=>{if(!this.auth){const u=this.t.getImmediate({optional:!0});u?l(u):(Mt("FirebaseAuthCredentialsProvider","Auth not yet detected"),i.resolve(),i=new $a)}},0),o()}getToken(){const t=this.i,e=this.forceRefresh;return this.forceRefresh=!1,this.auth?this.auth.getToken(e).then(s=>this.i!==t?(Mt("FirebaseAuthCredentialsProvider","getToken aborted due to token change."),this.getToken()):s?(ze(typeof s.accessToken=="string",31837,{l:s}),new sR(s.accessToken,this.currentUser)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.auth&&this.o&&this.auth.removeAuthTokenListener(this.o),this.o=void 0}u(){const t=this.auth&&this.auth.getUid();return ze(t===null||typeof t=="string",2055,{h:t}),new Ds(t)}}class cU{constructor(t,e,s){this.P=t,this.T=e,this.I=s,this.type="FirstParty",this.user=Ds.FIRST_PARTY,this.A=new Map}R(){return this.I?this.I():null}get headers(){this.A.set("X-Goog-AuthUser",this.P);const t=this.R();return t&&this.A.set("Authorization",t),this.T&&this.A.set("X-Goog-Iam-Authorization-Token",this.T),this.A}}class hU{constructor(t,e,s){this.P=t,this.T=e,this.I=s}getToken(){return Promise.resolve(new cU(this.P,this.T,this.I))}start(t,e){t.enqueueRetryable(()=>e(Ds.FIRST_PARTY))}shutdown(){}invalidateToken(){}}class V_{constructor(t){this.value=t,this.type="AppCheck",this.headers=new Map,t&&t.length>0&&this.headers.set("x-firebase-appcheck",this.value)}}class dU{constructor(t,e){this.V=e,this.forceRefresh=!1,this.appCheck=null,this.m=null,this.p=null,qB(t)&&t.settings.appCheckToken&&(this.p=t.settings.appCheckToken)}start(t,e){ze(this.o===void 0,3512);const s=i=>{i.error!=null&&Mt("FirebaseAppCheckTokenProvider",`Error getting App Check token; using placeholder token instead. Error: ${i.error.message}`);const o=i.token!==this.m;return this.m=i.token,Mt("FirebaseAppCheckTokenProvider",`Received ${o?"new":"existing"} token.`),o?e(i.token):Promise.resolve()};this.o=i=>{t.enqueueRetryable(()=>s(i))};const r=i=>{Mt("FirebaseAppCheckTokenProvider","AppCheck detected"),this.appCheck=i,this.o&&this.appCheck.addTokenListener(this.o)};this.V.onInit(i=>r(i)),setTimeout(()=>{if(!this.appCheck){const i=this.V.getImmediate({optional:!0});i?r(i):Mt("FirebaseAppCheckTokenProvider","AppCheck not yet detected")}},0)}getToken(){if(this.p)return Promise.resolve(new V_(this.p));const t=this.forceRefresh;return this.forceRefresh=!1,this.appCheck?this.appCheck.getToken(t).then(e=>e?(ze(typeof e.token=="string",44558,{tokenResult:e}),this.m=e.token,new V_(e.token)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.appCheck&&this.o&&this.appCheck.removeTokenListener(this.o),this.o=void 0}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function fU(n){const t=typeof self<"u"&&(self.crypto||self.msCrypto),e=new Uint8Array(n);if(t&&typeof t.getRandomValues=="function")t.getRandomValues(e);else for(let s=0;s<n;s++)e[s]=Math.floor(256*Math.random());return e}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function rR(){return new TextEncoder}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class iR{static newId(){const t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",e=62*Math.floor(4.129032258064516);let s="";for(;s.length<20;){const r=fU(40);for(let i=0;i<r.length;++i)s.length<20&&r[i]<e&&(s+=t.charAt(r[i]%62))}return s}}function he(n,t){return n<t?-1:n>t?1:0}function Rv(n,t){let e=0;for(;e<n.length&&e<t.length;){const s=n.codePointAt(e),r=t.codePointAt(e);if(s!==r){if(s<128&&r<128)return he(s,r);{const i=rR(),o=pU(i.encode(z_(n,e)),i.encode(z_(t,e)));return o!==0?o:he(s,r)}}e+=s>65535?2:1}return he(n.length,t.length)}function z_(n,t){return n.codePointAt(t)>65535?n.substring(t,t+2):n.substring(t,t+1)}function pU(n,t){for(let e=0;e<n.length&&e<t.length;++e)if(n[e]!==t[e])return he(n[e],t[e]);return he(n.length,t.length)}function Pc(n,t,e){return n.length===t.length&&n.every((s,r)=>e(s,t[r]))}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const B_=-62135596800,U_=1e6;class Jn{static now(){return Jn.fromMillis(Date.now())}static fromDate(t){return Jn.fromMillis(t.getTime())}static fromMillis(t){const e=Math.floor(t/1e3),s=Math.floor((t-1e3*e)*U_);return new Jn(e,s)}constructor(t,e){if(this.seconds=t,this.nanoseconds=e,e<0)throw new Ht(_t.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+e);if(e>=1e9)throw new Ht(_t.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+e);if(t<B_)throw new Ht(_t.INVALID_ARGUMENT,"Timestamp seconds out of range: "+t);if(t>=253402300800)throw new Ht(_t.INVALID_ARGUMENT,"Timestamp seconds out of range: "+t)}toDate(){return new Date(this.toMillis())}toMillis(){return 1e3*this.seconds+this.nanoseconds/U_}_compareTo(t){return this.seconds===t.seconds?he(this.nanoseconds,t.nanoseconds):he(this.seconds,t.seconds)}isEqual(t){return t.seconds===this.seconds&&t.nanoseconds===this.nanoseconds}toString(){return"Timestamp(seconds="+this.seconds+", nanoseconds="+this.nanoseconds+")"}toJSON(){return{seconds:this.seconds,nanoseconds:this.nanoseconds}}valueOf(){const t=this.seconds-B_;return String(t).padStart(12,"0")+"."+String(this.nanoseconds).padStart(9,"0")}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ee{static fromTimestamp(t){return new ee(t)}static min(){return new ee(new Jn(0,0))}static max(){return new ee(new Jn(253402300799,999999999))}constructor(t){this.timestamp=t}compareTo(t){return this.timestamp._compareTo(t.timestamp)}isEqual(t){return this.timestamp.isEqual(t.timestamp)}toMicroseconds(){return 1e6*this.timestamp.seconds+this.timestamp.nanoseconds/1e3}toString(){return"SnapshotVersion("+this.timestamp.toString()+")"}toTimestamp(){return this.timestamp}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const G_="__name__";class Di{constructor(t,e,s){e===void 0?e=0:e>t.length&&Jt(637,{offset:e,range:t.length}),s===void 0?s=t.length-e:s>t.length-e&&Jt(1746,{length:s,range:t.length-e}),this.segments=t,this.offset=e,this.len=s}get length(){return this.len}isEqual(t){return Di.comparator(this,t)===0}child(t){const e=this.segments.slice(this.offset,this.limit());return t instanceof Di?t.forEach(s=>{e.push(s)}):e.push(t),this.construct(e)}limit(){return this.offset+this.length}popFirst(t){return t=t===void 0?1:t,this.construct(this.segments,this.offset+t,this.length-t)}popLast(){return this.construct(this.segments,this.offset,this.length-1)}firstSegment(){return this.segments[this.offset]}lastSegment(){return this.get(this.length-1)}get(t){return this.segments[this.offset+t]}isEmpty(){return this.length===0}isPrefixOf(t){if(t.length<this.length)return!1;for(let e=0;e<this.length;e++)if(this.get(e)!==t.get(e))return!1;return!0}isImmediateParentOf(t){if(this.length+1!==t.length)return!1;for(let e=0;e<this.length;e++)if(this.get(e)!==t.get(e))return!1;return!0}forEach(t){for(let e=this.offset,s=this.limit();e<s;e++)t(this.segments[e])}toArray(){return this.segments.slice(this.offset,this.limit())}static comparator(t,e){const s=Math.min(t.length,e.length);for(let r=0;r<s;r++){const i=Di.compareSegments(t.get(r),e.get(r));if(i!==0)return i}return he(t.length,e.length)}static compareSegments(t,e){const s=Di.isNumericId(t),r=Di.isNumericId(e);return s&&!r?-1:!s&&r?1:s&&r?Di.extractNumericId(t).compare(Di.extractNumericId(e)):Rv(t,e)}static isNumericId(t){return t.startsWith("__id")&&t.endsWith("__")}static extractNumericId(t){return Ra.fromString(t.substring(4,t.length-2))}}class un extends Di{construct(t,e,s){return new un(t,e,s)}canonicalString(){return this.toArray().join("/")}toString(){return this.canonicalString()}toUriEncodedString(){return this.toArray().map(encodeURIComponent).join("/")}static fromString(...t){const e=[];for(const s of t){if(s.indexOf("//")>=0)throw new Ht(_t.INVALID_ARGUMENT,`Invalid segment (${s}). Paths must not contain // in them.`);e.push(...s.split("/").filter(r=>r.length>0))}return new un(e)}static emptyPath(){return new un([])}}const mU=/^[_a-zA-Z][_a-zA-Z0-9]*$/;class ws extends Di{construct(t,e,s){return new ws(t,e,s)}static isValidIdentifier(t){return mU.test(t)}canonicalString(){return this.toArray().map(t=>(t=t.replace(/\\/g,"\\\\").replace(/`/g,"\\`"),ws.isValidIdentifier(t)||(t="`"+t+"`"),t)).join(".")}toString(){return this.canonicalString()}isKeyField(){return this.length===1&&this.get(0)===G_}static keyField(){return new ws([G_])}static fromServerFormat(t){const e=[];let s="",r=0;const i=()=>{if(s.length===0)throw new Ht(_t.INVALID_ARGUMENT,`Invalid field path (${t}). Paths must not be empty, begin with '.', end with '.', or contain '..'`);e.push(s),s=""};let o=!1;for(;r<t.length;){const l=t[r];if(l==="\\"){if(r+1===t.length)throw new Ht(_t.INVALID_ARGUMENT,"Path has trailing escape character: "+t);const u=t[r+1];if(u!=="\\"&&u!=="."&&u!=="`")throw new Ht(_t.INVALID_ARGUMENT,"Path has invalid escape sequence: "+t);s+=u,r+=2}else l==="`"?(o=!o,r++):l!=="."||o?(s+=l,r++):(i(),r++)}if(i(),o)throw new Ht(_t.INVALID_ARGUMENT,"Unterminated ` in path: "+t);return new ws(e)}static emptyPath(){return new ws([])}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class qt{constructor(t){this.path=t}static fromPath(t){return new qt(un.fromString(t))}static fromName(t){return new qt(un.fromString(t).popFirst(5))}static empty(){return new qt(un.emptyPath())}get collectionGroup(){return this.path.popLast().lastSegment()}hasCollectionId(t){return this.path.length>=2&&this.path.get(this.path.length-2)===t}getCollectionGroup(){return this.path.get(this.path.length-2)}getCollectionPath(){return this.path.popLast()}isEqual(t){return t!==null&&un.comparator(this.path,t.path)===0}toString(){return this.path.toString()}static comparator(t,e){return un.comparator(t.path,e.path)}static isDocumentKey(t){return t.length%2==0}static fromSegments(t){return new qt(new un(t.slice()))}}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const rf=-1;function gU(n,t){const e=n.toTimestamp().seconds,s=n.toTimestamp().nanoseconds+1,r=ee.fromTimestamp(s===1e9?new Jn(e+1,0):new Jn(e,s));return new Pa(r,qt.empty(),t)}function yU(n){return new Pa(n.readTime,n.key,rf)}class Pa{constructor(t,e,s){this.readTime=t,this.documentKey=e,this.largestBatchId=s}static min(){return new Pa(ee.min(),qt.empty(),rf)}static max(){return new Pa(ee.max(),qt.empty(),rf)}}function xU(n,t){let e=n.readTime.compareTo(t.readTime);return e!==0?e:(e=qt.comparator(n.documentKey,t.documentKey),e!==0?e:he(n.largestBatchId,t.largestBatchId))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const bU="The current tab is not in the required state to perform this operation. It might be necessary to refresh the browser tab.";class vU{constructor(){this.onCommittedListeners=[]}addOnCommittedListener(t){this.onCommittedListeners.push(t)}raiseOnCommittedEvent(){this.onCommittedListeners.forEach(t=>t())}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function ih(n){if(n.code!==_t.FAILED_PRECONDITION||n.message!==bU)throw n;Mt("LocalStore","Unexpectedly lost primary lease")}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Et{constructor(t){this.nextCallback=null,this.catchCallback=null,this.result=void 0,this.error=void 0,this.isDone=!1,this.callbackAttached=!1,t(e=>{this.isDone=!0,this.result=e,this.nextCallback&&this.nextCallback(e)},e=>{this.isDone=!0,this.error=e,this.catchCallback&&this.catchCallback(e)})}catch(t){return this.next(void 0,t)}next(t,e){return this.callbackAttached&&Jt(59440),this.callbackAttached=!0,this.isDone?this.error?this.wrapFailure(e,this.error):this.wrapSuccess(t,this.result):new Et((s,r)=>{this.nextCallback=i=>{this.wrapSuccess(t,i).next(s,r)},this.catchCallback=i=>{this.wrapFailure(e,i).next(s,r)}})}toPromise(){return new Promise((t,e)=>{this.next(t,e)})}wrapUserFunction(t){try{const e=t();return e instanceof Et?e:Et.resolve(e)}catch(e){return Et.reject(e)}}wrapSuccess(t,e){return t?this.wrapUserFunction(()=>t(e)):Et.resolve(e)}wrapFailure(t,e){return t?this.wrapUserFunction(()=>t(e)):Et.reject(e)}static resolve(t){return new Et((e,s)=>{e(t)})}static reject(t){return new Et((e,s)=>{s(t)})}static waitFor(t){return new Et((e,s)=>{let r=0,i=0,o=!1;t.forEach(l=>{++r,l.next(()=>{++i,o&&i===r&&e()},u=>s(u))}),o=!0,i===r&&e()})}static or(t){let e=Et.resolve(!1);for(const s of t)e=e.next(r=>r?Et.resolve(r):s());return e}static forEach(t,e){const s=[];return t.forEach((r,i)=>{s.push(e.call(this,r,i))}),this.waitFor(s)}static mapArray(t,e){return new Et((s,r)=>{const i=t.length,o=new Array(i);let l=0;for(let u=0;u<i;u++){const h=u;e(t[h]).next(d=>{o[h]=d,++l,l===i&&s(o)},d=>r(d))}})}static doWhile(t,e){return new Et((s,r)=>{const i=()=>{t()===!0?e().next(()=>{i()},r):s()};i()})}}function wU(n){const t=n.match(/Android ([\d.]+)/i),e=t?t[1].split(".").slice(0,2).join("."):"-1";return Number(e)}function oh(n){return n.name==="IndexedDbTransactionError"}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class t0{constructor(t,e){this.previousValue=t,e&&(e.sequenceNumberHandler=s=>this.ue(s),this.ce=s=>e.writeSequenceNumber(s))}ue(t){return this.previousValue=Math.max(t,this.previousValue),this.previousValue}next(){const t=++this.previousValue;return this.ce&&this.ce(t),t}}t0.le=-1;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Vw=-1;function e0(n){return n==null}function ay(n){return n===0&&1/n==-1/0}function CU(n){return typeof n=="number"&&Number.isInteger(n)&&!ay(n)&&n<=Number.MAX_SAFE_INTEGER&&n>=Number.MIN_SAFE_INTEGER}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const oR="";function SU(n){let t="";for(let e=0;e<n.length;e++)t.length>0&&(t=W_(t)),t=TU(n.get(e),t);return W_(t)}function TU(n,t){let e=t;const s=n.length;for(let r=0;r<s;r++){const i=n.charAt(r);switch(i){case"\0":e+="";break;case oR:e+="";break;default:e+=i}}return e}function W_(n){return n+oR+""}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function H_(n){let t=0;for(const e in n)Object.prototype.hasOwnProperty.call(n,e)&&t++;return t}function gu(n,t){for(const e in n)Object.prototype.hasOwnProperty.call(n,e)&&t(e,n[e])}function aR(n){for(const t in n)if(Object.prototype.hasOwnProperty.call(n,t))return!1;return!0}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class pn{constructor(t,e){this.comparator=t,this.root=e||vs.EMPTY}insert(t,e){return new pn(this.comparator,this.root.insert(t,e,this.comparator).copy(null,null,vs.BLACK,null,null))}remove(t){return new pn(this.comparator,this.root.remove(t,this.comparator).copy(null,null,vs.BLACK,null,null))}get(t){let e=this.root;for(;!e.isEmpty();){const s=this.comparator(t,e.key);if(s===0)return e.value;s<0?e=e.left:s>0&&(e=e.right)}return null}indexOf(t){let e=0,s=this.root;for(;!s.isEmpty();){const r=this.comparator(t,s.key);if(r===0)return e+s.left.size;r<0?s=s.left:(e+=s.left.size+1,s=s.right)}return-1}isEmpty(){return this.root.isEmpty()}get size(){return this.root.size}minKey(){return this.root.minKey()}maxKey(){return this.root.maxKey()}inorderTraversal(t){return this.root.inorderTraversal(t)}forEach(t){this.inorderTraversal((e,s)=>(t(e,s),!1))}toString(){const t=[];return this.inorderTraversal((e,s)=>(t.push(`${e}:${s}`),!1)),`{${t.join(", ")}}`}reverseTraversal(t){return this.root.reverseTraversal(t)}getIterator(){return new vg(this.root,null,this.comparator,!1)}getIteratorFrom(t){return new vg(this.root,t,this.comparator,!1)}getReverseIterator(){return new vg(this.root,null,this.comparator,!0)}getReverseIteratorFrom(t){return new vg(this.root,t,this.comparator,!0)}}class vg{constructor(t,e,s,r){this.isReverse=r,this.nodeStack=[];let i=1;for(;!t.isEmpty();)if(i=e?s(t.key,e):1,e&&r&&(i*=-1),i<0)t=this.isReverse?t.left:t.right;else{if(i===0){this.nodeStack.push(t);break}this.nodeStack.push(t),t=this.isReverse?t.right:t.left}}getNext(){let t=this.nodeStack.pop();const e={key:t.key,value:t.value};if(this.isReverse)for(t=t.left;!t.isEmpty();)this.nodeStack.push(t),t=t.right;else for(t=t.right;!t.isEmpty();)this.nodeStack.push(t),t=t.left;return e}hasNext(){return this.nodeStack.length>0}peek(){if(this.nodeStack.length===0)return null;const t=this.nodeStack[this.nodeStack.length-1];return{key:t.key,value:t.value}}}class vs{constructor(t,e,s,r,i){this.key=t,this.value=e,this.color=s??vs.RED,this.left=r??vs.EMPTY,this.right=i??vs.EMPTY,this.size=this.left.size+1+this.right.size}copy(t,e,s,r,i){return new vs(t??this.key,e??this.value,s??this.color,r??this.left,i??this.right)}isEmpty(){return!1}inorderTraversal(t){return this.left.inorderTraversal(t)||t(this.key,this.value)||this.right.inorderTraversal(t)}reverseTraversal(t){return this.right.reverseTraversal(t)||t(this.key,this.value)||this.left.reverseTraversal(t)}min(){return this.left.isEmpty()?this:this.left.min()}minKey(){return this.min().key}maxKey(){return this.right.isEmpty()?this.key:this.right.maxKey()}insert(t,e,s){let r=this;const i=s(t,r.key);return r=i<0?r.copy(null,null,null,r.left.insert(t,e,s),null):i===0?r.copy(null,e,null,null,null):r.copy(null,null,null,null,r.right.insert(t,e,s)),r.fixUp()}removeMin(){if(this.left.isEmpty())return vs.EMPTY;let t=this;return t.left.isRed()||t.left.left.isRed()||(t=t.moveRedLeft()),t=t.copy(null,null,null,t.left.removeMin(),null),t.fixUp()}remove(t,e){let s,r=this;if(e(t,r.key)<0)r.left.isEmpty()||r.left.isRed()||r.left.left.isRed()||(r=r.moveRedLeft()),r=r.copy(null,null,null,r.left.remove(t,e),null);else{if(r.left.isRed()&&(r=r.rotateRight()),r.right.isEmpty()||r.right.isRed()||r.right.left.isRed()||(r=r.moveRedRight()),e(t,r.key)===0){if(r.right.isEmpty())return vs.EMPTY;s=r.right.min(),r=r.copy(s.key,s.value,null,null,r.right.removeMin())}r=r.copy(null,null,null,null,r.right.remove(t,e))}return r.fixUp()}isRed(){return this.color}fixUp(){let t=this;return t.right.isRed()&&!t.left.isRed()&&(t=t.rotateLeft()),t.left.isRed()&&t.left.left.isRed()&&(t=t.rotateRight()),t.left.isRed()&&t.right.isRed()&&(t=t.colorFlip()),t}moveRedLeft(){let t=this.colorFlip();return t.right.left.isRed()&&(t=t.copy(null,null,null,null,t.right.rotateRight()),t=t.rotateLeft(),t=t.colorFlip()),t}moveRedRight(){let t=this.colorFlip();return t.left.left.isRed()&&(t=t.rotateRight(),t=t.colorFlip()),t}rotateLeft(){const t=this.copy(null,null,vs.RED,null,this.right.left);return this.right.copy(null,null,this.color,t,null)}rotateRight(){const t=this.copy(null,null,vs.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,t)}colorFlip(){const t=this.left.copy(null,null,!this.left.color,null,null),e=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,t,e)}checkMaxDepth(){const t=this.check();return Math.pow(2,t)<=this.size+1}check(){if(this.isRed()&&this.left.isRed())throw Jt(43730,{key:this.key,value:this.value});if(this.right.isRed())throw Jt(14113,{key:this.key,value:this.value});const t=this.left.check();if(t!==this.right.check())throw Jt(27949);return t+(this.isRed()?0:1)}}vs.EMPTY=null,vs.RED=!0,vs.BLACK=!1;vs.EMPTY=new class{constructor(){this.size=0}get key(){throw Jt(57766)}get value(){throw Jt(16141)}get color(){throw Jt(16727)}get left(){throw Jt(29726)}get right(){throw Jt(36894)}copy(t,e,s,r,i){return this}insert(t,e,s){return new vs(t,e)}remove(t,e){return this}isEmpty(){return!0}inorderTraversal(t){return!1}reverseTraversal(t){return!1}minKey(){return null}maxKey(){return null}isRed(){return!1}checkMaxDepth(){return!0}check(){return 0}};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ts{constructor(t){this.comparator=t,this.data=new pn(this.comparator)}has(t){return this.data.get(t)!==null}first(){return this.data.minKey()}last(){return this.data.maxKey()}get size(){return this.data.size}indexOf(t){return this.data.indexOf(t)}forEach(t){this.data.inorderTraversal((e,s)=>(t(e),!1))}forEachInRange(t,e){const s=this.data.getIteratorFrom(t[0]);for(;s.hasNext();){const r=s.getNext();if(this.comparator(r.key,t[1])>=0)return;e(r.key)}}forEachWhile(t,e){let s;for(s=e!==void 0?this.data.getIteratorFrom(e):this.data.getIterator();s.hasNext();)if(!t(s.getNext().key))return}firstAfterOrEqual(t){const e=this.data.getIteratorFrom(t);return e.hasNext()?e.getNext().key:null}getIterator(){return new q_(this.data.getIterator())}getIteratorFrom(t){return new q_(this.data.getIteratorFrom(t))}add(t){return this.copy(this.data.remove(t).insert(t,!0))}delete(t){return this.has(t)?this.copy(this.data.remove(t)):this}isEmpty(){return this.data.isEmpty()}unionWith(t){let e=this;return e.size<t.size&&(e=t,t=this),t.forEach(s=>{e=e.add(s)}),e}isEqual(t){if(!(t instanceof ts)||this.size!==t.size)return!1;const e=this.data.getIterator(),s=t.data.getIterator();for(;e.hasNext();){const r=e.getNext().key,i=s.getNext().key;if(this.comparator(r,i)!==0)return!1}return!0}toArray(){const t=[];return this.forEach(e=>{t.push(e)}),t}toString(){const t=[];return this.forEach(e=>t.push(e)),"SortedSet("+t.toString()+")"}copy(t){const e=new ts(this.comparator);return e.data=t,e}}class q_{constructor(t){this.iter=t}getNext(){return this.iter.getNext().key}hasNext(){return this.iter.hasNext()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class oi{constructor(t){this.fields=t,t.sort(ws.comparator)}static empty(){return new oi([])}unionWith(t){let e=new ts(ws.comparator);for(const s of this.fields)e=e.add(s);for(const s of t)e=e.add(s);return new oi(e.toArray())}covers(t){for(const e of this.fields)if(e.isPrefixOf(t))return!0;return!1}isEqual(t){return Pc(this.fields,t.fields,(e,s)=>e.isEqual(s))}}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class lR extends Error{constructor(){super(...arguments),this.name="Base64DecodeError"}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Cs{constructor(t){this.binaryString=t}static fromBase64String(t){const e=function(r){try{return atob(r)}catch(i){throw typeof DOMException<"u"&&i instanceof DOMException?new lR("Invalid base64 string: "+i):i}}(t);return new Cs(e)}static fromUint8Array(t){const e=function(r){let i="";for(let o=0;o<r.length;++o)i+=String.fromCharCode(r[o]);return i}(t);return new Cs(e)}[Symbol.iterator](){let t=0;return{next:()=>t<this.binaryString.length?{value:this.binaryString.charCodeAt(t++),done:!1}:{value:void 0,done:!0}}}toBase64(){return function(e){return btoa(e)}(this.binaryString)}toUint8Array(){return function(e){const s=new Uint8Array(e.length);for(let r=0;r<e.length;r++)s[r]=e.charCodeAt(r);return s}(this.binaryString)}approximateByteSize(){return 2*this.binaryString.length}compareTo(t){return he(this.binaryString,t.binaryString)}isEqual(t){return this.binaryString===t.binaryString}}Cs.EMPTY_BYTE_STRING=new Cs("");const EU=new RegExp(/^\d{4}-\d\d-\d\dT\d\d:\d\d:\d\d(?:\.(\d+))?Z$/);function Va(n){if(ze(!!n,39018),typeof n=="string"){let t=0;const e=EU.exec(n);if(ze(!!e,46558,{timestamp:n}),e[1]){let r=e[1];r=(r+"000000000").substr(0,9),t=Number(r)}const s=new Date(n);return{seconds:Math.floor(s.getTime()/1e3),nanos:t}}return{seconds:kn(n.seconds),nanos:kn(n.nanos)}}function kn(n){return typeof n=="number"?n:typeof n=="string"?Number(n):0}function za(n){return typeof n=="string"?Cs.fromBase64String(n):Cs.fromUint8Array(n)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const uR="server_timestamp",cR="__type__",hR="__previous_value__",dR="__local_write_time__";function zw(n){var t,e;return((e=(((t=n==null?void 0:n.mapValue)===null||t===void 0?void 0:t.fields)||{})[cR])===null||e===void 0?void 0:e.stringValue)===uR}function n0(n){const t=n.mapValue.fields[hR];return zw(t)?n0(t):t}function of(n){const t=Va(n.mapValue.fields[dR].timestampValue);return new Jn(t.seconds,t.nanos)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class IU{constructor(t,e,s,r,i,o,l,u,h,d){this.databaseId=t,this.appId=e,this.persistenceKey=s,this.host=r,this.ssl=i,this.forceLongPolling=o,this.autoDetectLongPolling=l,this.longPollingOptions=u,this.useFetchStreams=h,this.isUsingEmulator=d}}const ly="(default)";class af{constructor(t,e){this.projectId=t,this.database=e||ly}static empty(){return new af("","")}get isDefaultDatabase(){return this.database===ly}isEqual(t){return t instanceof af&&t.projectId===this.projectId&&t.database===this.database}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const fR="__type__",_U="__max__",wg={mapValue:{}},pR="__vector__",uy="value";function Ba(n){return"nullValue"in n?0:"booleanValue"in n?1:"integerValue"in n||"doubleValue"in n?2:"timestampValue"in n?3:"stringValue"in n?5:"bytesValue"in n?6:"referenceValue"in n?7:"geoPointValue"in n?8:"arrayValue"in n?9:"mapValue"in n?zw(n)?4:AU(n)?9007199254740991:kU(n)?10:11:Jt(28295,{value:n})}function Ki(n,t){if(n===t)return!0;const e=Ba(n);if(e!==Ba(t))return!1;switch(e){case 0:case 9007199254740991:return!0;case 1:return n.booleanValue===t.booleanValue;case 4:return of(n).isEqual(of(t));case 3:return function(r,i){if(typeof r.timestampValue=="string"&&typeof i.timestampValue=="string"&&r.timestampValue.length===i.timestampValue.length)return r.timestampValue===i.timestampValue;const o=Va(r.timestampValue),l=Va(i.timestampValue);return o.seconds===l.seconds&&o.nanos===l.nanos}(n,t);case 5:return n.stringValue===t.stringValue;case 6:return function(r,i){return za(r.bytesValue).isEqual(za(i.bytesValue))}(n,t);case 7:return n.referenceValue===t.referenceValue;case 8:return function(r,i){return kn(r.geoPointValue.latitude)===kn(i.geoPointValue.latitude)&&kn(r.geoPointValue.longitude)===kn(i.geoPointValue.longitude)}(n,t);case 2:return function(r,i){if("integerValue"in r&&"integerValue"in i)return kn(r.integerValue)===kn(i.integerValue);if("doubleValue"in r&&"doubleValue"in i){const o=kn(r.doubleValue),l=kn(i.doubleValue);return o===l?ay(o)===ay(l):isNaN(o)&&isNaN(l)}return!1}(n,t);case 9:return Pc(n.arrayValue.values||[],t.arrayValue.values||[],Ki);case 10:case 11:return function(r,i){const o=r.mapValue.fields||{},l=i.mapValue.fields||{};if(H_(o)!==H_(l))return!1;for(const u in o)if(o.hasOwnProperty(u)&&(l[u]===void 0||!Ki(o[u],l[u])))return!1;return!0}(n,t);default:return Jt(52216,{left:n})}}function lf(n,t){return(n.values||[]).find(e=>Ki(e,t))!==void 0}function Vc(n,t){if(n===t)return 0;const e=Ba(n),s=Ba(t);if(e!==s)return he(e,s);switch(e){case 0:case 9007199254740991:return 0;case 1:return he(n.booleanValue,t.booleanValue);case 2:return function(i,o){const l=kn(i.integerValue||i.doubleValue),u=kn(o.integerValue||o.doubleValue);return l<u?-1:l>u?1:l===u?0:isNaN(l)?isNaN(u)?0:-1:1}(n,t);case 3:return j_(n.timestampValue,t.timestampValue);case 4:return j_(of(n),of(t));case 5:return Rv(n.stringValue,t.stringValue);case 6:return function(i,o){const l=za(i),u=za(o);return l.compareTo(u)}(n.bytesValue,t.bytesValue);case 7:return function(i,o){const l=i.split("/"),u=o.split("/");for(let h=0;h<l.length&&h<u.length;h++){const d=he(l[h],u[h]);if(d!==0)return d}return he(l.length,u.length)}(n.referenceValue,t.referenceValue);case 8:return function(i,o){const l=he(kn(i.latitude),kn(o.latitude));return l!==0?l:he(kn(i.longitude),kn(o.longitude))}(n.geoPointValue,t.geoPointValue);case 9:return K_(n.arrayValue,t.arrayValue);case 10:return function(i,o){var l,u,h,d;const p=i.fields||{},m=o.fields||{},y=(l=p[uy])===null||l===void 0?void 0:l.arrayValue,x=(u=m[uy])===null||u===void 0?void 0:u.arrayValue,v=he(((h=y==null?void 0:y.values)===null||h===void 0?void 0:h.length)||0,((d=x==null?void 0:x.values)===null||d===void 0?void 0:d.length)||0);return v!==0?v:K_(y,x)}(n.mapValue,t.mapValue);case 11:return function(i,o){if(i===wg.mapValue&&o===wg.mapValue)return 0;if(i===wg.mapValue)return 1;if(o===wg.mapValue)return-1;const l=i.fields||{},u=Object.keys(l),h=o.fields||{},d=Object.keys(h);u.sort(),d.sort();for(let p=0;p<u.length&&p<d.length;++p){const m=Rv(u[p],d[p]);if(m!==0)return m;const y=Vc(l[u[p]],h[d[p]]);if(y!==0)return y}return he(u.length,d.length)}(n.mapValue,t.mapValue);default:throw Jt(23264,{Pe:e})}}function j_(n,t){if(typeof n=="string"&&typeof t=="string"&&n.length===t.length)return he(n,t);const e=Va(n),s=Va(t),r=he(e.seconds,s.seconds);return r!==0?r:he(e.nanos,s.nanos)}function K_(n,t){const e=n.values||[],s=t.values||[];for(let r=0;r<e.length&&r<s.length;++r){const i=Vc(e[r],s[r]);if(i)return i}return he(e.length,s.length)}function zc(n){return $v(n)}function $v(n){return"nullValue"in n?"null":"booleanValue"in n?""+n.booleanValue:"integerValue"in n?""+n.integerValue:"doubleValue"in n?""+n.doubleValue:"timestampValue"in n?function(e){const s=Va(e);return`time(${s.seconds},${s.nanos})`}(n.timestampValue):"stringValue"in n?n.stringValue:"bytesValue"in n?function(e){return za(e).toBase64()}(n.bytesValue):"referenceValue"in n?function(e){return qt.fromName(e).toString()}(n.referenceValue):"geoPointValue"in n?function(e){return`geo(${e.latitude},${e.longitude})`}(n.geoPointValue):"arrayValue"in n?function(e){let s="[",r=!0;for(const i of e.values||[])r?r=!1:s+=",",s+=$v(i);return s+"]"}(n.arrayValue):"mapValue"in n?function(e){const s=Object.keys(e.fields||{}).sort();let r="{",i=!0;for(const o of s)i?i=!1:r+=",",r+=`${o}:${$v(e.fields[o])}`;return r+"}"}(n.mapValue):Jt(61005,{value:n})}function Ug(n){switch(Ba(n)){case 0:case 1:return 4;case 2:return 8;case 3:case 8:return 16;case 4:const t=n0(n);return t?16+Ug(t):16;case 5:return 2*n.stringValue.length;case 6:return za(n.bytesValue).approximateByteSize();case 7:return n.referenceValue.length;case 9:return function(s){return(s.values||[]).reduce((r,i)=>r+Ug(i),0)}(n.arrayValue);case 10:case 11:return function(s){let r=0;return gu(s.fields,(i,o)=>{r+=i.length+Ug(o)}),r}(n.mapValue);default:throw Jt(13486,{value:n})}}function Dv(n){return!!n&&"integerValue"in n}function Bw(n){return!!n&&"arrayValue"in n}function X_(n){return!!n&&"nullValue"in n}function Y_(n){return!!n&&"doubleValue"in n&&isNaN(Number(n.doubleValue))}function Gg(n){return!!n&&"mapValue"in n}function kU(n){var t,e;return((e=(((t=n==null?void 0:n.mapValue)===null||t===void 0?void 0:t.fields)||{})[fR])===null||e===void 0?void 0:e.stringValue)===pR}function jd(n){if(n.geoPointValue)return{geoPointValue:Object.assign({},n.geoPointValue)};if(n.timestampValue&&typeof n.timestampValue=="object")return{timestampValue:Object.assign({},n.timestampValue)};if(n.mapValue){const t={mapValue:{fields:{}}};return gu(n.mapValue.fields,(e,s)=>t.mapValue.fields[e]=jd(s)),t}if(n.arrayValue){const t={arrayValue:{values:[]}};for(let e=0;e<(n.arrayValue.values||[]).length;++e)t.arrayValue.values[e]=jd(n.arrayValue.values[e]);return t}return Object.assign({},n)}function AU(n){return(((n.mapValue||{}).fields||{}).__type__||{}).stringValue===_U}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ur{constructor(t){this.value=t}static empty(){return new Ur({mapValue:{}})}field(t){if(t.isEmpty())return this.value;{let e=this.value;for(let s=0;s<t.length-1;++s)if(e=(e.mapValue.fields||{})[t.get(s)],!Gg(e))return null;return e=(e.mapValue.fields||{})[t.lastSegment()],e||null}}set(t,e){this.getFieldsMap(t.popLast())[t.lastSegment()]=jd(e)}setAll(t){let e=ws.emptyPath(),s={},r=[];t.forEach((o,l)=>{if(!e.isImmediateParentOf(l)){const u=this.getFieldsMap(e);this.applyChanges(u,s,r),s={},r=[],e=l.popLast()}o?s[l.lastSegment()]=jd(o):r.push(l.lastSegment())});const i=this.getFieldsMap(e);this.applyChanges(i,s,r)}delete(t){const e=this.field(t.popLast());Gg(e)&&e.mapValue.fields&&delete e.mapValue.fields[t.lastSegment()]}isEqual(t){return Ki(this.value,t.value)}getFieldsMap(t){let e=this.value;e.mapValue.fields||(e.mapValue={fields:{}});for(let s=0;s<t.length;++s){let r=e.mapValue.fields[t.get(s)];Gg(r)&&r.mapValue.fields||(r={mapValue:{fields:{}}},e.mapValue.fields[t.get(s)]=r),e=r}return e.mapValue.fields}applyChanges(t,e,s){gu(e,(r,i)=>t[r]=i);for(const r of s)delete t[r]}clone(){return new Ur(jd(this.value))}}function mR(n){const t=[];return gu(n.fields,(e,s)=>{const r=new ws([e]);if(Gg(s)){const i=mR(s.mapValue).fields;if(i.length===0)t.push(r);else for(const o of i)t.push(r.child(o))}else t.push(r)}),new oi(t)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ms{constructor(t,e,s,r,i,o,l){this.key=t,this.documentType=e,this.version=s,this.readTime=r,this.createTime=i,this.data=o,this.documentState=l}static newInvalidDocument(t){return new Ms(t,0,ee.min(),ee.min(),ee.min(),Ur.empty(),0)}static newFoundDocument(t,e,s,r){return new Ms(t,1,e,ee.min(),s,r,0)}static newNoDocument(t,e){return new Ms(t,2,e,ee.min(),ee.min(),Ur.empty(),0)}static newUnknownDocument(t,e){return new Ms(t,3,e,ee.min(),ee.min(),Ur.empty(),2)}convertToFoundDocument(t,e){return!this.createTime.isEqual(ee.min())||this.documentType!==2&&this.documentType!==0||(this.createTime=t),this.version=t,this.documentType=1,this.data=e,this.documentState=0,this}convertToNoDocument(t){return this.version=t,this.documentType=2,this.data=Ur.empty(),this.documentState=0,this}convertToUnknownDocument(t){return this.version=t,this.documentType=3,this.data=Ur.empty(),this.documentState=2,this}setHasCommittedMutations(){return this.documentState=2,this}setHasLocalMutations(){return this.documentState=1,this.version=ee.min(),this}setReadTime(t){return this.readTime=t,this}get hasLocalMutations(){return this.documentState===1}get hasCommittedMutations(){return this.documentState===2}get hasPendingWrites(){return this.hasLocalMutations||this.hasCommittedMutations}isValidDocument(){return this.documentType!==0}isFoundDocument(){return this.documentType===1}isNoDocument(){return this.documentType===2}isUnknownDocument(){return this.documentType===3}isEqual(t){return t instanceof Ms&&this.key.isEqual(t.key)&&this.version.isEqual(t.version)&&this.documentType===t.documentType&&this.documentState===t.documentState&&this.data.isEqual(t.data)}mutableCopy(){return new Ms(this.key,this.documentType,this.version,this.readTime,this.createTime,this.data.clone(),this.documentState)}toString(){return`Document(${this.key}, ${this.version}, ${JSON.stringify(this.data.value)}, {createTime: ${this.createTime}}), {documentType: ${this.documentType}}), {documentState: ${this.documentState}})`}}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class cy{constructor(t,e){this.position=t,this.inclusive=e}}function Q_(n,t,e){let s=0;for(let r=0;r<n.position.length;r++){const i=t[r],o=n.position[r];if(i.field.isKeyField()?s=qt.comparator(qt.fromName(o.referenceValue),e.key):s=Vc(o,e.data.field(i.field)),i.dir==="desc"&&(s*=-1),s!==0)break}return s}function Z_(n,t){if(n===null)return t===null;if(t===null||n.inclusive!==t.inclusive||n.position.length!==t.position.length)return!1;for(let e=0;e<n.position.length;e++)if(!Ki(n.position[e],t.position[e]))return!1;return!0}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class hy{constructor(t,e="asc"){this.field=t,this.dir=e}}function NU(n,t){return n.dir===t.dir&&n.field.isEqual(t.field)}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class gR{}class Yn extends gR{constructor(t,e,s){super(),this.field=t,this.op=e,this.value=s}static create(t,e,s){return t.isKeyField()?e==="in"||e==="not-in"?this.createKeyFieldInFilter(t,e,s):new $U(t,e,s):e==="array-contains"?new MU(t,s):e==="in"?new FU(t,s):e==="not-in"?new LU(t,s):e==="array-contains-any"?new PU(t,s):new Yn(t,e,s)}static createKeyFieldInFilter(t,e,s){return e==="in"?new DU(t,s):new OU(t,s)}matches(t){const e=t.data.field(this.field);return this.op==="!="?e!==null&&e.nullValue===void 0&&this.matchesComparison(Vc(e,this.value)):e!==null&&Ba(this.value)===Ba(e)&&this.matchesComparison(Vc(e,this.value))}matchesComparison(t){switch(this.op){case"<":return t<0;case"<=":return t<=0;case"==":return t===0;case"!=":return t!==0;case">":return t>0;case">=":return t>=0;default:return Jt(47266,{operator:this.op})}}isInequality(){return["<","<=",">",">=","!=","not-in"].indexOf(this.op)>=0}getFlattenedFilters(){return[this]}getFilters(){return[this]}}class Xi extends gR{constructor(t,e){super(),this.filters=t,this.op=e,this.Te=null}static create(t,e){return new Xi(t,e)}matches(t){return yR(this)?this.filters.find(e=>!e.matches(t))===void 0:this.filters.find(e=>e.matches(t))!==void 0}getFlattenedFilters(){return this.Te!==null||(this.Te=this.filters.reduce((t,e)=>t.concat(e.getFlattenedFilters()),[])),this.Te}getFilters(){return Object.assign([],this.filters)}}function yR(n){return n.op==="and"}function xR(n){return RU(n)&&yR(n)}function RU(n){for(const t of n.filters)if(t instanceof Xi)return!1;return!0}function Ov(n){if(n instanceof Yn)return n.field.canonicalString()+n.op.toString()+zc(n.value);if(xR(n))return n.filters.map(t=>Ov(t)).join(",");{const t=n.filters.map(e=>Ov(e)).join(",");return`${n.op}(${t})`}}function bR(n,t){return n instanceof Yn?function(s,r){return r instanceof Yn&&s.op===r.op&&s.field.isEqual(r.field)&&Ki(s.value,r.value)}(n,t):n instanceof Xi?function(s,r){return r instanceof Xi&&s.op===r.op&&s.filters.length===r.filters.length?s.filters.reduce((i,o,l)=>i&&bR(o,r.filters[l]),!0):!1}(n,t):void Jt(19439)}function vR(n){return n instanceof Yn?function(e){return`${e.field.canonicalString()} ${e.op} ${zc(e.value)}`}(n):n instanceof Xi?function(e){return e.op.toString()+" {"+e.getFilters().map(vR).join(" ,")+"}"}(n):"Filter"}class $U extends Yn{constructor(t,e,s){super(t,e,s),this.key=qt.fromName(s.referenceValue)}matches(t){const e=qt.comparator(t.key,this.key);return this.matchesComparison(e)}}class DU extends Yn{constructor(t,e){super(t,"in",e),this.keys=wR("in",e)}matches(t){return this.keys.some(e=>e.isEqual(t.key))}}class OU extends Yn{constructor(t,e){super(t,"not-in",e),this.keys=wR("not-in",e)}matches(t){return!this.keys.some(e=>e.isEqual(t.key))}}function wR(n,t){var e;return(((e=t.arrayValue)===null||e===void 0?void 0:e.values)||[]).map(s=>qt.fromName(s.referenceValue))}class MU extends Yn{constructor(t,e){super(t,"array-contains",e)}matches(t){const e=t.data.field(this.field);return Bw(e)&&lf(e.arrayValue,this.value)}}class FU extends Yn{constructor(t,e){super(t,"in",e)}matches(t){const e=t.data.field(this.field);return e!==null&&lf(this.value.arrayValue,e)}}class LU extends Yn{constructor(t,e){super(t,"not-in",e)}matches(t){if(lf(this.value.arrayValue,{nullValue:"NULL_VALUE"}))return!1;const e=t.data.field(this.field);return e!==null&&e.nullValue===void 0&&!lf(this.value.arrayValue,e)}}class PU extends Yn{constructor(t,e){super(t,"array-contains-any",e)}matches(t){const e=t.data.field(this.field);return!(!Bw(e)||!e.arrayValue.values)&&e.arrayValue.values.some(s=>lf(this.value.arrayValue,s))}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class VU{constructor(t,e=null,s=[],r=[],i=null,o=null,l=null){this.path=t,this.collectionGroup=e,this.orderBy=s,this.filters=r,this.limit=i,this.startAt=o,this.endAt=l,this.Ie=null}}function J_(n,t=null,e=[],s=[],r=null,i=null,o=null){return new VU(n,t,e,s,r,i,o)}function Uw(n){const t=se(n);if(t.Ie===null){let e=t.path.canonicalString();t.collectionGroup!==null&&(e+="|cg:"+t.collectionGroup),e+="|f:",e+=t.filters.map(s=>Ov(s)).join(","),e+="|ob:",e+=t.orderBy.map(s=>function(i){return i.field.canonicalString()+i.dir}(s)).join(","),e0(t.limit)||(e+="|l:",e+=t.limit),t.startAt&&(e+="|lb:",e+=t.startAt.inclusive?"b:":"a:",e+=t.startAt.position.map(s=>zc(s)).join(",")),t.endAt&&(e+="|ub:",e+=t.endAt.inclusive?"a:":"b:",e+=t.endAt.position.map(s=>zc(s)).join(",")),t.Ie=e}return t.Ie}function Gw(n,t){if(n.limit!==t.limit||n.orderBy.length!==t.orderBy.length)return!1;for(let e=0;e<n.orderBy.length;e++)if(!NU(n.orderBy[e],t.orderBy[e]))return!1;if(n.filters.length!==t.filters.length)return!1;for(let e=0;e<n.filters.length;e++)if(!bR(n.filters[e],t.filters[e]))return!1;return n.collectionGroup===t.collectionGroup&&!!n.path.isEqual(t.path)&&!!Z_(n.startAt,t.startAt)&&Z_(n.endAt,t.endAt)}function Mv(n){return qt.isDocumentKey(n.path)&&n.collectionGroup===null&&n.filters.length===0}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class s0{constructor(t,e=null,s=[],r=[],i=null,o="F",l=null,u=null){this.path=t,this.collectionGroup=e,this.explicitOrderBy=s,this.filters=r,this.limit=i,this.limitType=o,this.startAt=l,this.endAt=u,this.Ee=null,this.de=null,this.Ae=null,this.startAt,this.endAt}}function zU(n,t,e,s,r,i,o,l){return new s0(n,t,e,s,r,i,o,l)}function CR(n){return new s0(n)}function tk(n){return n.filters.length===0&&n.limit===null&&n.startAt==null&&n.endAt==null&&(n.explicitOrderBy.length===0||n.explicitOrderBy.length===1&&n.explicitOrderBy[0].field.isKeyField())}function BU(n){return n.collectionGroup!==null}function Kd(n){const t=se(n);if(t.Ee===null){t.Ee=[];const e=new Set;for(const i of t.explicitOrderBy)t.Ee.push(i),e.add(i.field.canonicalString());const s=t.explicitOrderBy.length>0?t.explicitOrderBy[t.explicitOrderBy.length-1].dir:"asc";(function(o){let l=new ts(ws.comparator);return o.filters.forEach(u=>{u.getFlattenedFilters().forEach(h=>{h.isInequality()&&(l=l.add(h.field))})}),l})(t).forEach(i=>{e.has(i.canonicalString())||i.isKeyField()||t.Ee.push(new hy(i,s))}),e.has(ws.keyField().canonicalString())||t.Ee.push(new hy(ws.keyField(),s))}return t.Ee}function Vi(n){const t=se(n);return t.de||(t.de=UU(t,Kd(n))),t.de}function UU(n,t){if(n.limitType==="F")return J_(n.path,n.collectionGroup,t,n.filters,n.limit,n.startAt,n.endAt);{t=t.map(r=>{const i=r.dir==="desc"?"asc":"desc";return new hy(r.field,i)});const e=n.endAt?new cy(n.endAt.position,n.endAt.inclusive):null,s=n.startAt?new cy(n.startAt.position,n.startAt.inclusive):null;return J_(n.path,n.collectionGroup,t,n.filters,n.limit,e,s)}}function Fv(n,t,e){return new s0(n.path,n.collectionGroup,n.explicitOrderBy.slice(),n.filters.slice(),t,e,n.startAt,n.endAt)}function r0(n,t){return Gw(Vi(n),Vi(t))&&n.limitType===t.limitType}function SR(n){return`${Uw(Vi(n))}|lt:${n.limitType}`}function Tc(n){return`Query(target=${function(e){let s=e.path.canonicalString();return e.collectionGroup!==null&&(s+=" collectionGroup="+e.collectionGroup),e.filters.length>0&&(s+=`, filters: [${e.filters.map(r=>vR(r)).join(", ")}]`),e0(e.limit)||(s+=", limit: "+e.limit),e.orderBy.length>0&&(s+=`, orderBy: [${e.orderBy.map(r=>function(o){return`${o.field.canonicalString()} (${o.dir})`}(r)).join(", ")}]`),e.startAt&&(s+=", startAt: ",s+=e.startAt.inclusive?"b:":"a:",s+=e.startAt.position.map(r=>zc(r)).join(",")),e.endAt&&(s+=", endAt: ",s+=e.endAt.inclusive?"a:":"b:",s+=e.endAt.position.map(r=>zc(r)).join(",")),`Target(${s})`}(Vi(n))}; limitType=${n.limitType})`}function i0(n,t){return t.isFoundDocument()&&function(s,r){const i=r.key.path;return s.collectionGroup!==null?r.key.hasCollectionId(s.collectionGroup)&&s.path.isPrefixOf(i):qt.isDocumentKey(s.path)?s.path.isEqual(i):s.path.isImmediateParentOf(i)}(n,t)&&function(s,r){for(const i of Kd(s))if(!i.field.isKeyField()&&r.data.field(i.field)===null)return!1;return!0}(n,t)&&function(s,r){for(const i of s.filters)if(!i.matches(r))return!1;return!0}(n,t)&&function(s,r){return!(s.startAt&&!function(o,l,u){const h=Q_(o,l,u);return o.inclusive?h<=0:h<0}(s.startAt,Kd(s),r)||s.endAt&&!function(o,l,u){const h=Q_(o,l,u);return o.inclusive?h>=0:h>0}(s.endAt,Kd(s),r))}(n,t)}function GU(n){return n.collectionGroup||(n.path.length%2==1?n.path.lastSegment():n.path.get(n.path.length-2))}function TR(n){return(t,e)=>{let s=!1;for(const r of Kd(n)){const i=WU(r,t,e);if(i!==0)return i;s=s||r.field.isKeyField()}return 0}}function WU(n,t,e){const s=n.field.isKeyField()?qt.comparator(t.key,e.key):function(i,o,l){const u=o.data.field(i),h=l.data.field(i);return u!==null&&h!==null?Vc(u,h):Jt(42886)}(n.field,t,e);switch(n.dir){case"asc":return s;case"desc":return-1*s;default:return Jt(19790,{direction:n.dir})}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class yu{constructor(t,e){this.mapKeyFn=t,this.equalsFn=e,this.inner={},this.innerSize=0}get(t){const e=this.mapKeyFn(t),s=this.inner[e];if(s!==void 0){for(const[r,i]of s)if(this.equalsFn(r,t))return i}}has(t){return this.get(t)!==void 0}set(t,e){const s=this.mapKeyFn(t),r=this.inner[s];if(r===void 0)return this.inner[s]=[[t,e]],void this.innerSize++;for(let i=0;i<r.length;i++)if(this.equalsFn(r[i][0],t))return void(r[i]=[t,e]);r.push([t,e]),this.innerSize++}delete(t){const e=this.mapKeyFn(t),s=this.inner[e];if(s===void 0)return!1;for(let r=0;r<s.length;r++)if(this.equalsFn(s[r][0],t))return s.length===1?delete this.inner[e]:s.splice(r,1),this.innerSize--,!0;return!1}forEach(t){gu(this.inner,(e,s)=>{for(const[r,i]of s)t(r,i)})}isEmpty(){return aR(this.inner)}size(){return this.innerSize}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const HU=new pn(qt.comparator);function Vo(){return HU}const ER=new pn(qt.comparator);function Pd(...n){let t=ER;for(const e of n)t=t.insert(e.key,e);return t}function IR(n){let t=ER;return n.forEach((e,s)=>t=t.insert(e,s.overlayedDocument)),t}function ql(){return Xd()}function _R(){return Xd()}function Xd(){return new yu(n=>n.toString(),(n,t)=>n.isEqual(t))}const qU=new pn(qt.comparator),jU=new ts(qt.comparator);function xe(...n){let t=jU;for(const e of n)t=t.add(e);return t}const KU=new ts(he);function XU(){return KU}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Ww(n,t){if(n.useProto3Json){if(isNaN(t))return{doubleValue:"NaN"};if(t===1/0)return{doubleValue:"Infinity"};if(t===-1/0)return{doubleValue:"-Infinity"}}return{doubleValue:ay(t)?"-0":t}}function kR(n){return{integerValue:""+n}}function YU(n,t){return CU(t)?kR(t):Ww(n,t)}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class o0{constructor(){this._=void 0}}function QU(n,t,e){return n instanceof dy?function(r,i){const o={fields:{[cR]:{stringValue:uR},[dR]:{timestampValue:{seconds:r.seconds,nanos:r.nanoseconds}}}};return i&&zw(i)&&(i=n0(i)),i&&(o.fields[hR]=i),{mapValue:o}}(e,t):n instanceof uf?NR(n,t):n instanceof cf?RR(n,t):function(r,i){const o=AR(r,i),l=ek(o)+ek(r.Re);return Dv(o)&&Dv(r.Re)?kR(l):Ww(r.serializer,l)}(n,t)}function ZU(n,t,e){return n instanceof uf?NR(n,t):n instanceof cf?RR(n,t):e}function AR(n,t){return n instanceof fy?function(s){return Dv(s)||function(i){return!!i&&"doubleValue"in i}(s)}(t)?t:{integerValue:0}:null}class dy extends o0{}class uf extends o0{constructor(t){super(),this.elements=t}}function NR(n,t){const e=$R(t);for(const s of n.elements)e.some(r=>Ki(r,s))||e.push(s);return{arrayValue:{values:e}}}class cf extends o0{constructor(t){super(),this.elements=t}}function RR(n,t){let e=$R(t);for(const s of n.elements)e=e.filter(r=>!Ki(r,s));return{arrayValue:{values:e}}}class fy extends o0{constructor(t,e){super(),this.serializer=t,this.Re=e}}function ek(n){return kn(n.integerValue||n.doubleValue)}function $R(n){return Bw(n)&&n.arrayValue.values?n.arrayValue.values.slice():[]}function JU(n,t){return n.field.isEqual(t.field)&&function(s,r){return s instanceof uf&&r instanceof uf||s instanceof cf&&r instanceof cf?Pc(s.elements,r.elements,Ki):s instanceof fy&&r instanceof fy?Ki(s.Re,r.Re):s instanceof dy&&r instanceof dy}(n.transform,t.transform)}class t6{constructor(t,e){this.version=t,this.transformResults=e}}class Mo{constructor(t,e){this.updateTime=t,this.exists=e}static none(){return new Mo}static exists(t){return new Mo(void 0,t)}static updateTime(t){return new Mo(t)}get isNone(){return this.updateTime===void 0&&this.exists===void 0}isEqual(t){return this.exists===t.exists&&(this.updateTime?!!t.updateTime&&this.updateTime.isEqual(t.updateTime):!t.updateTime)}}function Wg(n,t){return n.updateTime!==void 0?t.isFoundDocument()&&t.version.isEqual(n.updateTime):n.exists===void 0||n.exists===t.isFoundDocument()}class a0{}function DR(n,t){if(!n.hasLocalMutations||t&&t.fields.length===0)return null;if(t===null)return n.isNoDocument()?new MR(n.key,Mo.none()):new _f(n.key,n.data,Mo.none());{const e=n.data,s=Ur.empty();let r=new ts(ws.comparator);for(let i of t.fields)if(!r.has(i)){let o=e.field(i);o===null&&i.length>1&&(i=i.popLast(),o=e.field(i)),o===null?s.delete(i):s.set(i,o),r=r.add(i)}return new xu(n.key,s,new oi(r.toArray()),Mo.none())}}function e6(n,t,e){n instanceof _f?function(r,i,o){const l=r.value.clone(),u=sk(r.fieldTransforms,i,o.transformResults);l.setAll(u),i.convertToFoundDocument(o.version,l).setHasCommittedMutations()}(n,t,e):n instanceof xu?function(r,i,o){if(!Wg(r.precondition,i))return void i.convertToUnknownDocument(o.version);const l=sk(r.fieldTransforms,i,o.transformResults),u=i.data;u.setAll(OR(r)),u.setAll(l),i.convertToFoundDocument(o.version,u).setHasCommittedMutations()}(n,t,e):function(r,i,o){i.convertToNoDocument(o.version).setHasCommittedMutations()}(0,t,e)}function Yd(n,t,e,s){return n instanceof _f?function(i,o,l,u){if(!Wg(i.precondition,o))return l;const h=i.value.clone(),d=rk(i.fieldTransforms,u,o);return h.setAll(d),o.convertToFoundDocument(o.version,h).setHasLocalMutations(),null}(n,t,e,s):n instanceof xu?function(i,o,l,u){if(!Wg(i.precondition,o))return l;const h=rk(i.fieldTransforms,u,o),d=o.data;return d.setAll(OR(i)),d.setAll(h),o.convertToFoundDocument(o.version,d).setHasLocalMutations(),l===null?null:l.unionWith(i.fieldMask.fields).unionWith(i.fieldTransforms.map(p=>p.field))}(n,t,e,s):function(i,o,l){return Wg(i.precondition,o)?(o.convertToNoDocument(o.version).setHasLocalMutations(),null):l}(n,t,e)}function n6(n,t){let e=null;for(const s of n.fieldTransforms){const r=t.data.field(s.field),i=AR(s.transform,r||null);i!=null&&(e===null&&(e=Ur.empty()),e.set(s.field,i))}return e||null}function nk(n,t){return n.type===t.type&&!!n.key.isEqual(t.key)&&!!n.precondition.isEqual(t.precondition)&&!!function(s,r){return s===void 0&&r===void 0||!(!s||!r)&&Pc(s,r,(i,o)=>JU(i,o))}(n.fieldTransforms,t.fieldTransforms)&&(n.type===0?n.value.isEqual(t.value):n.type!==1||n.data.isEqual(t.data)&&n.fieldMask.isEqual(t.fieldMask))}class _f extends a0{constructor(t,e,s,r=[]){super(),this.key=t,this.value=e,this.precondition=s,this.fieldTransforms=r,this.type=0}getFieldMask(){return null}}class xu extends a0{constructor(t,e,s,r,i=[]){super(),this.key=t,this.data=e,this.fieldMask=s,this.precondition=r,this.fieldTransforms=i,this.type=1}getFieldMask(){return this.fieldMask}}function OR(n){const t=new Map;return n.fieldMask.fields.forEach(e=>{if(!e.isEmpty()){const s=n.data.field(e);t.set(e,s)}}),t}function sk(n,t,e){const s=new Map;ze(n.length===e.length,32656,{Ve:e.length,me:n.length});for(let r=0;r<e.length;r++){const i=n[r],o=i.transform,l=t.data.field(i.field);s.set(i.field,ZU(o,l,e[r]))}return s}function rk(n,t,e){const s=new Map;for(const r of n){const i=r.transform,o=e.data.field(r.field);s.set(r.field,QU(i,o,t))}return s}class MR extends a0{constructor(t,e){super(),this.key=t,this.precondition=e,this.type=2,this.fieldTransforms=[]}getFieldMask(){return null}}class s6 extends a0{constructor(t,e){super(),this.key=t,this.precondition=e,this.type=3,this.fieldTransforms=[]}getFieldMask(){return null}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class r6{constructor(t,e,s,r){this.batchId=t,this.localWriteTime=e,this.baseMutations=s,this.mutations=r}applyToRemoteDocument(t,e){const s=e.mutationResults;for(let r=0;r<this.mutations.length;r++){const i=this.mutations[r];i.key.isEqual(t.key)&&e6(i,t,s[r])}}applyToLocalView(t,e){for(const s of this.baseMutations)s.key.isEqual(t.key)&&(e=Yd(s,t,e,this.localWriteTime));for(const s of this.mutations)s.key.isEqual(t.key)&&(e=Yd(s,t,e,this.localWriteTime));return e}applyToLocalDocumentSet(t,e){const s=_R();return this.mutations.forEach(r=>{const i=t.get(r.key),o=i.overlayedDocument;let l=this.applyToLocalView(o,i.mutatedFields);l=e.has(r.key)?null:l;const u=DR(o,l);u!==null&&s.set(r.key,u),o.isValidDocument()||o.convertToNoDocument(ee.min())}),s}keys(){return this.mutations.reduce((t,e)=>t.add(e.key),xe())}isEqual(t){return this.batchId===t.batchId&&Pc(this.mutations,t.mutations,(e,s)=>nk(e,s))&&Pc(this.baseMutations,t.baseMutations,(e,s)=>nk(e,s))}}class Hw{constructor(t,e,s,r){this.batch=t,this.commitVersion=e,this.mutationResults=s,this.docVersions=r}static from(t,e,s){ze(t.mutations.length===s.length,58842,{fe:t.mutations.length,ge:s.length});let r=function(){return qU}();const i=t.mutations;for(let o=0;o<i.length;o++)r=r.insert(i[o].key,s[o].version);return new Hw(t,e,s,r)}}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class i6{constructor(t,e){this.largestBatchId=t,this.mutation=e}getKey(){return this.mutation.key}isEqual(t){return t!==null&&this.mutation===t.mutation}toString(){return`Overlay{
      largestBatchId: ${this.largestBatchId},
      mutation: ${this.mutation.toString()}
    }`}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class o6{constructor(t,e){this.count=t,this.unchangedNames=e}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var Mn,_e;function a6(n){switch(n){case _t.OK:return Jt(64938);case _t.CANCELLED:case _t.UNKNOWN:case _t.DEADLINE_EXCEEDED:case _t.RESOURCE_EXHAUSTED:case _t.INTERNAL:case _t.UNAVAILABLE:case _t.UNAUTHENTICATED:return!1;case _t.INVALID_ARGUMENT:case _t.NOT_FOUND:case _t.ALREADY_EXISTS:case _t.PERMISSION_DENIED:case _t.FAILED_PRECONDITION:case _t.ABORTED:case _t.OUT_OF_RANGE:case _t.UNIMPLEMENTED:case _t.DATA_LOSS:return!0;default:return Jt(15467,{code:n})}}function FR(n){if(n===void 0)return Po("GRPC error has no .code"),_t.UNKNOWN;switch(n){case Mn.OK:return _t.OK;case Mn.CANCELLED:return _t.CANCELLED;case Mn.UNKNOWN:return _t.UNKNOWN;case Mn.DEADLINE_EXCEEDED:return _t.DEADLINE_EXCEEDED;case Mn.RESOURCE_EXHAUSTED:return _t.RESOURCE_EXHAUSTED;case Mn.INTERNAL:return _t.INTERNAL;case Mn.UNAVAILABLE:return _t.UNAVAILABLE;case Mn.UNAUTHENTICATED:return _t.UNAUTHENTICATED;case Mn.INVALID_ARGUMENT:return _t.INVALID_ARGUMENT;case Mn.NOT_FOUND:return _t.NOT_FOUND;case Mn.ALREADY_EXISTS:return _t.ALREADY_EXISTS;case Mn.PERMISSION_DENIED:return _t.PERMISSION_DENIED;case Mn.FAILED_PRECONDITION:return _t.FAILED_PRECONDITION;case Mn.ABORTED:return _t.ABORTED;case Mn.OUT_OF_RANGE:return _t.OUT_OF_RANGE;case Mn.UNIMPLEMENTED:return _t.UNIMPLEMENTED;case Mn.DATA_LOSS:return _t.DATA_LOSS;default:return Jt(39323,{code:n})}}(_e=Mn||(Mn={}))[_e.OK=0]="OK",_e[_e.CANCELLED=1]="CANCELLED",_e[_e.UNKNOWN=2]="UNKNOWN",_e[_e.INVALID_ARGUMENT=3]="INVALID_ARGUMENT",_e[_e.DEADLINE_EXCEEDED=4]="DEADLINE_EXCEEDED",_e[_e.NOT_FOUND=5]="NOT_FOUND",_e[_e.ALREADY_EXISTS=6]="ALREADY_EXISTS",_e[_e.PERMISSION_DENIED=7]="PERMISSION_DENIED",_e[_e.UNAUTHENTICATED=16]="UNAUTHENTICATED",_e[_e.RESOURCE_EXHAUSTED=8]="RESOURCE_EXHAUSTED",_e[_e.FAILED_PRECONDITION=9]="FAILED_PRECONDITION",_e[_e.ABORTED=10]="ABORTED",_e[_e.OUT_OF_RANGE=11]="OUT_OF_RANGE",_e[_e.UNIMPLEMENTED=12]="UNIMPLEMENTED",_e[_e.INTERNAL=13]="INTERNAL",_e[_e.UNAVAILABLE=14]="UNAVAILABLE",_e[_e.DATA_LOSS=15]="DATA_LOSS";/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const l6=new Ra([4294967295,4294967295],0);function ik(n){const t=rR().encode(n),e=new YN;return e.update(t),new Uint8Array(e.digest())}function ok(n){const t=new DataView(n.buffer),e=t.getUint32(0,!0),s=t.getUint32(4,!0),r=t.getUint32(8,!0),i=t.getUint32(12,!0);return[new Ra([e,s],0),new Ra([r,i],0)]}class qw{constructor(t,e,s){if(this.bitmap=t,this.padding=e,this.hashCount=s,e<0||e>=8)throw new Vd(`Invalid padding: ${e}`);if(s<0)throw new Vd(`Invalid hash count: ${s}`);if(t.length>0&&this.hashCount===0)throw new Vd(`Invalid hash count: ${s}`);if(t.length===0&&e!==0)throw new Vd(`Invalid padding when bitmap length is 0: ${e}`);this.pe=8*t.length-e,this.ye=Ra.fromNumber(this.pe)}we(t,e,s){let r=t.add(e.multiply(Ra.fromNumber(s)));return r.compare(l6)===1&&(r=new Ra([r.getBits(0),r.getBits(1)],0)),r.modulo(this.ye).toNumber()}be(t){return!!(this.bitmap[Math.floor(t/8)]&1<<t%8)}mightContain(t){if(this.pe===0)return!1;const e=ik(t),[s,r]=ok(e);for(let i=0;i<this.hashCount;i++){const o=this.we(s,r,i);if(!this.be(o))return!1}return!0}static create(t,e,s){const r=t%8==0?0:8-t%8,i=new Uint8Array(Math.ceil(t/8)),o=new qw(i,r,e);return s.forEach(l=>o.insert(l)),o}insert(t){if(this.pe===0)return;const e=ik(t),[s,r]=ok(e);for(let i=0;i<this.hashCount;i++){const o=this.we(s,r,i);this.Se(o)}}Se(t){const e=Math.floor(t/8),s=t%8;this.bitmap[e]|=1<<s}}class Vd extends Error{constructor(){super(...arguments),this.name="BloomFilterError"}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class l0{constructor(t,e,s,r,i){this.snapshotVersion=t,this.targetChanges=e,this.targetMismatches=s,this.documentUpdates=r,this.resolvedLimboDocuments=i}static createSynthesizedRemoteEventForCurrentChange(t,e,s){const r=new Map;return r.set(t,kf.createSynthesizedTargetChangeForCurrentChange(t,e,s)),new l0(ee.min(),r,new pn(he),Vo(),xe())}}class kf{constructor(t,e,s,r,i){this.resumeToken=t,this.current=e,this.addedDocuments=s,this.modifiedDocuments=r,this.removedDocuments=i}static createSynthesizedTargetChangeForCurrentChange(t,e,s){return new kf(s,e,xe(),xe(),xe())}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Hg{constructor(t,e,s,r){this.De=t,this.removedTargetIds=e,this.key=s,this.ve=r}}class LR{constructor(t,e){this.targetId=t,this.Ce=e}}class PR{constructor(t,e,s=Cs.EMPTY_BYTE_STRING,r=null){this.state=t,this.targetIds=e,this.resumeToken=s,this.cause=r}}class ak{constructor(){this.Fe=0,this.Me=lk(),this.xe=Cs.EMPTY_BYTE_STRING,this.Oe=!1,this.Ne=!0}get current(){return this.Oe}get resumeToken(){return this.xe}get Be(){return this.Fe!==0}get Le(){return this.Ne}ke(t){t.approximateByteSize()>0&&(this.Ne=!0,this.xe=t)}qe(){let t=xe(),e=xe(),s=xe();return this.Me.forEach((r,i)=>{switch(i){case 0:t=t.add(r);break;case 2:e=e.add(r);break;case 1:s=s.add(r);break;default:Jt(38017,{changeType:i})}}),new kf(this.xe,this.Oe,t,e,s)}Qe(){this.Ne=!1,this.Me=lk()}$e(t,e){this.Ne=!0,this.Me=this.Me.insert(t,e)}Ue(t){this.Ne=!0,this.Me=this.Me.remove(t)}Ke(){this.Fe+=1}We(){this.Fe-=1,ze(this.Fe>=0,3241,{Fe:this.Fe})}Ge(){this.Ne=!0,this.Oe=!0}}class u6{constructor(t){this.ze=t,this.je=new Map,this.He=Vo(),this.Je=Cg(),this.Ye=Cg(),this.Ze=new pn(he)}Xe(t){for(const e of t.De)t.ve&&t.ve.isFoundDocument()?this.et(e,t.ve):this.tt(e,t.key,t.ve);for(const e of t.removedTargetIds)this.tt(e,t.key,t.ve)}nt(t){this.forEachTarget(t,e=>{const s=this.rt(e);switch(t.state){case 0:this.it(e)&&s.ke(t.resumeToken);break;case 1:s.We(),s.Be||s.Qe(),s.ke(t.resumeToken);break;case 2:s.We(),s.Be||this.removeTarget(e);break;case 3:this.it(e)&&(s.Ge(),s.ke(t.resumeToken));break;case 4:this.it(e)&&(this.st(e),s.ke(t.resumeToken));break;default:Jt(56790,{state:t.state})}})}forEachTarget(t,e){t.targetIds.length>0?t.targetIds.forEach(e):this.je.forEach((s,r)=>{this.it(r)&&e(r)})}ot(t){const e=t.targetId,s=t.Ce.count,r=this._t(e);if(r){const i=r.target;if(Mv(i))if(s===0){const o=new qt(i.path);this.tt(e,o,Ms.newNoDocument(o,ee.min()))}else ze(s===1,20013,{expectedCount:s});else{const o=this.ut(e);if(o!==s){const l=this.ct(t),u=l?this.lt(l,t,o):1;if(u!==0){this.st(e);const h=u===2?"TargetPurposeExistenceFilterMismatchBloom":"TargetPurposeExistenceFilterMismatch";this.Ze=this.Ze.insert(e,h)}}}}}ct(t){const e=t.Ce.unchangedNames;if(!e||!e.bits)return null;const{bits:{bitmap:s="",padding:r=0},hashCount:i=0}=e;let o,l;try{o=za(s).toUint8Array()}catch(u){if(u instanceof lR)return Lc("Decoding the base64 bloom filter in existence filter failed ("+u.message+"); ignoring the bloom filter and falling back to full re-query."),null;throw u}try{l=new qw(o,r,i)}catch(u){return Lc(u instanceof Vd?"BloomFilter error: ":"Applying bloom filter failed: ",u),null}return l.pe===0?null:l}lt(t,e,s){return e.Ce.count===s-this.Tt(t,e.targetId)?0:2}Tt(t,e){const s=this.ze.getRemoteKeysForTarget(e);let r=0;return s.forEach(i=>{const o=this.ze.Pt(),l=`projects/${o.projectId}/databases/${o.database}/documents/${i.path.canonicalString()}`;t.mightContain(l)||(this.tt(e,i,null),r++)}),r}It(t){const e=new Map;this.je.forEach((i,o)=>{const l=this._t(o);if(l){if(i.current&&Mv(l.target)){const u=new qt(l.target.path);this.Et(u).has(o)||this.dt(o,u)||this.tt(o,u,Ms.newNoDocument(u,t))}i.Le&&(e.set(o,i.qe()),i.Qe())}});let s=xe();this.Ye.forEach((i,o)=>{let l=!0;o.forEachWhile(u=>{const h=this._t(u);return!h||h.purpose==="TargetPurposeLimboResolution"||(l=!1,!1)}),l&&(s=s.add(i))}),this.He.forEach((i,o)=>o.setReadTime(t));const r=new l0(t,e,this.Ze,this.He,s);return this.He=Vo(),this.Je=Cg(),this.Ye=Cg(),this.Ze=new pn(he),r}et(t,e){if(!this.it(t))return;const s=this.dt(t,e.key)?2:0;this.rt(t).$e(e.key,s),this.He=this.He.insert(e.key,e),this.Je=this.Je.insert(e.key,this.Et(e.key).add(t)),this.Ye=this.Ye.insert(e.key,this.At(e.key).add(t))}tt(t,e,s){if(!this.it(t))return;const r=this.rt(t);this.dt(t,e)?r.$e(e,1):r.Ue(e),this.Ye=this.Ye.insert(e,this.At(e).delete(t)),this.Ye=this.Ye.insert(e,this.At(e).add(t)),s&&(this.He=this.He.insert(e,s))}removeTarget(t){this.je.delete(t)}ut(t){const e=this.rt(t).qe();return this.ze.getRemoteKeysForTarget(t).size+e.addedDocuments.size-e.removedDocuments.size}Ke(t){this.rt(t).Ke()}rt(t){let e=this.je.get(t);return e||(e=new ak,this.je.set(t,e)),e}At(t){let e=this.Ye.get(t);return e||(e=new ts(he),this.Ye=this.Ye.insert(t,e)),e}Et(t){let e=this.Je.get(t);return e||(e=new ts(he),this.Je=this.Je.insert(t,e)),e}it(t){const e=this._t(t)!==null;return e||Mt("WatchChangeAggregator","Detected inactive target",t),e}_t(t){const e=this.je.get(t);return e&&e.Be?null:this.ze.Rt(t)}st(t){this.je.set(t,new ak),this.ze.getRemoteKeysForTarget(t).forEach(e=>{this.tt(t,e,null)})}dt(t,e){return this.ze.getRemoteKeysForTarget(t).has(e)}}function Cg(){return new pn(qt.comparator)}function lk(){return new pn(qt.comparator)}const c6={asc:"ASCENDING",desc:"DESCENDING"},h6={"<":"LESS_THAN","<=":"LESS_THAN_OR_EQUAL",">":"GREATER_THAN",">=":"GREATER_THAN_OR_EQUAL","==":"EQUAL","!=":"NOT_EQUAL","array-contains":"ARRAY_CONTAINS",in:"IN","not-in":"NOT_IN","array-contains-any":"ARRAY_CONTAINS_ANY"},d6={and:"AND",or:"OR"};class f6{constructor(t,e){this.databaseId=t,this.useProto3Json=e}}function Lv(n,t){return n.useProto3Json||e0(t)?t:{value:t}}function py(n,t){return n.useProto3Json?`${new Date(1e3*t.seconds).toISOString().replace(/\.\d*/,"").replace("Z","")}.${("000000000"+t.nanoseconds).slice(-9)}Z`:{seconds:""+t.seconds,nanos:t.nanoseconds}}function VR(n,t){return n.useProto3Json?t.toBase64():t.toUint8Array()}function p6(n,t){return py(n,t.toTimestamp())}function zi(n){return ze(!!n,49232),ee.fromTimestamp(function(e){const s=Va(e);return new Jn(s.seconds,s.nanos)}(n))}function jw(n,t){return Pv(n,t).canonicalString()}function Pv(n,t){const e=function(r){return new un(["projects",r.projectId,"databases",r.database])}(n).child("documents");return t===void 0?e:e.child(t)}function zR(n){const t=un.fromString(n);return ze(HR(t),10190,{key:t.toString()}),t}function Vv(n,t){return jw(n.databaseId,t.path)}function Q1(n,t){const e=zR(t);if(e.get(1)!==n.databaseId.projectId)throw new Ht(_t.INVALID_ARGUMENT,"Tried to deserialize key from different project: "+e.get(1)+" vs "+n.databaseId.projectId);if(e.get(3)!==n.databaseId.database)throw new Ht(_t.INVALID_ARGUMENT,"Tried to deserialize key from different database: "+e.get(3)+" vs "+n.databaseId.database);return new qt(UR(e))}function BR(n,t){return jw(n.databaseId,t)}function m6(n){const t=zR(n);return t.length===4?un.emptyPath():UR(t)}function zv(n){return new un(["projects",n.databaseId.projectId,"databases",n.databaseId.database]).canonicalString()}function UR(n){return ze(n.length>4&&n.get(4)==="documents",29091,{key:n.toString()}),n.popFirst(5)}function uk(n,t,e){return{name:Vv(n,t),fields:e.value.mapValue.fields}}function g6(n,t){let e;if("targetChange"in t){t.targetChange;const s=function(h){return h==="NO_CHANGE"?0:h==="ADD"?1:h==="REMOVE"?2:h==="CURRENT"?3:h==="RESET"?4:Jt(39313,{state:h})}(t.targetChange.targetChangeType||"NO_CHANGE"),r=t.targetChange.targetIds||[],i=function(h,d){return h.useProto3Json?(ze(d===void 0||typeof d=="string",58123),Cs.fromBase64String(d||"")):(ze(d===void 0||d instanceof Buffer||d instanceof Uint8Array,16193),Cs.fromUint8Array(d||new Uint8Array))}(n,t.targetChange.resumeToken),o=t.targetChange.cause,l=o&&function(h){const d=h.code===void 0?_t.UNKNOWN:FR(h.code);return new Ht(d,h.message||"")}(o);e=new PR(s,r,i,l||null)}else if("documentChange"in t){t.documentChange;const s=t.documentChange;s.document,s.document.name,s.document.updateTime;const r=Q1(n,s.document.name),i=zi(s.document.updateTime),o=s.document.createTime?zi(s.document.createTime):ee.min(),l=new Ur({mapValue:{fields:s.document.fields}}),u=Ms.newFoundDocument(r,i,o,l),h=s.targetIds||[],d=s.removedTargetIds||[];e=new Hg(h,d,u.key,u)}else if("documentDelete"in t){t.documentDelete;const s=t.documentDelete;s.document;const r=Q1(n,s.document),i=s.readTime?zi(s.readTime):ee.min(),o=Ms.newNoDocument(r,i),l=s.removedTargetIds||[];e=new Hg([],l,o.key,o)}else if("documentRemove"in t){t.documentRemove;const s=t.documentRemove;s.document;const r=Q1(n,s.document),i=s.removedTargetIds||[];e=new Hg([],i,r,null)}else{if(!("filter"in t))return Jt(11601,{Vt:t});{t.filter;const s=t.filter;s.targetId;const{count:r=0,unchangedNames:i}=s,o=new o6(r,i),l=s.targetId;e=new LR(l,o)}}return e}function y6(n,t){let e;if(t instanceof _f)e={update:uk(n,t.key,t.value)};else if(t instanceof MR)e={delete:Vv(n,t.key)};else if(t instanceof xu)e={update:uk(n,t.key,t.data),updateMask:I6(t.fieldMask)};else{if(!(t instanceof s6))return Jt(16599,{ft:t.type});e={verify:Vv(n,t.key)}}return t.fieldTransforms.length>0&&(e.updateTransforms=t.fieldTransforms.map(s=>function(i,o){const l=o.transform;if(l instanceof dy)return{fieldPath:o.field.canonicalString(),setToServerValue:"REQUEST_TIME"};if(l instanceof uf)return{fieldPath:o.field.canonicalString(),appendMissingElements:{values:l.elements}};if(l instanceof cf)return{fieldPath:o.field.canonicalString(),removeAllFromArray:{values:l.elements}};if(l instanceof fy)return{fieldPath:o.field.canonicalString(),increment:l.Re};throw Jt(20930,{transform:o.transform})}(0,s))),t.precondition.isNone||(e.currentDocument=function(r,i){return i.updateTime!==void 0?{updateTime:p6(r,i.updateTime)}:i.exists!==void 0?{exists:i.exists}:Jt(27497)}(n,t.precondition)),e}function x6(n,t){return n&&n.length>0?(ze(t!==void 0,14353),n.map(e=>function(r,i){let o=r.updateTime?zi(r.updateTime):zi(i);return o.isEqual(ee.min())&&(o=zi(i)),new t6(o,r.transformResults||[])}(e,t))):[]}function b6(n,t){return{documents:[BR(n,t.path)]}}function v6(n,t){const e={structuredQuery:{}},s=t.path;let r;t.collectionGroup!==null?(r=s,e.structuredQuery.from=[{collectionId:t.collectionGroup,allDescendants:!0}]):(r=s.popLast(),e.structuredQuery.from=[{collectionId:s.lastSegment()}]),e.parent=BR(n,r);const i=function(h){if(h.length!==0)return WR(Xi.create(h,"and"))}(t.filters);i&&(e.structuredQuery.where=i);const o=function(h){if(h.length!==0)return h.map(d=>function(m){return{field:Ec(m.field),direction:S6(m.dir)}}(d))}(t.orderBy);o&&(e.structuredQuery.orderBy=o);const l=Lv(n,t.limit);return l!==null&&(e.structuredQuery.limit=l),t.startAt&&(e.structuredQuery.startAt=function(h){return{before:h.inclusive,values:h.position}}(t.startAt)),t.endAt&&(e.structuredQuery.endAt=function(h){return{before:!h.inclusive,values:h.position}}(t.endAt)),{gt:e,parent:r}}function w6(n){let t=m6(n.parent);const e=n.structuredQuery,s=e.from?e.from.length:0;let r=null;if(s>0){ze(s===1,65062);const d=e.from[0];d.allDescendants?r=d.collectionId:t=t.child(d.collectionId)}let i=[];e.where&&(i=function(p){const m=GR(p);return m instanceof Xi&&xR(m)?m.getFilters():[m]}(e.where));let o=[];e.orderBy&&(o=function(p){return p.map(m=>function(x){return new hy(Ic(x.field),function(C){switch(C){case"ASCENDING":return"asc";case"DESCENDING":return"desc";default:return}}(x.direction))}(m))}(e.orderBy));let l=null;e.limit&&(l=function(p){let m;return m=typeof p=="object"?p.value:p,e0(m)?null:m}(e.limit));let u=null;e.startAt&&(u=function(p){const m=!!p.before,y=p.values||[];return new cy(y,m)}(e.startAt));let h=null;return e.endAt&&(h=function(p){const m=!p.before,y=p.values||[];return new cy(y,m)}(e.endAt)),zU(t,r,o,i,l,"F",u,h)}function C6(n,t){const e=function(r){switch(r){case"TargetPurposeListen":return null;case"TargetPurposeExistenceFilterMismatch":return"existence-filter-mismatch";case"TargetPurposeExistenceFilterMismatchBloom":return"existence-filter-mismatch-bloom";case"TargetPurposeLimboResolution":return"limbo-document";default:return Jt(28987,{purpose:r})}}(t.purpose);return e==null?null:{"goog-listen-tags":e}}function GR(n){return n.unaryFilter!==void 0?function(e){switch(e.unaryFilter.op){case"IS_NAN":const s=Ic(e.unaryFilter.field);return Yn.create(s,"==",{doubleValue:NaN});case"IS_NULL":const r=Ic(e.unaryFilter.field);return Yn.create(r,"==",{nullValue:"NULL_VALUE"});case"IS_NOT_NAN":const i=Ic(e.unaryFilter.field);return Yn.create(i,"!=",{doubleValue:NaN});case"IS_NOT_NULL":const o=Ic(e.unaryFilter.field);return Yn.create(o,"!=",{nullValue:"NULL_VALUE"});case"OPERATOR_UNSPECIFIED":return Jt(61313);default:return Jt(60726)}}(n):n.fieldFilter!==void 0?function(e){return Yn.create(Ic(e.fieldFilter.field),function(r){switch(r){case"EQUAL":return"==";case"NOT_EQUAL":return"!=";case"GREATER_THAN":return">";case"GREATER_THAN_OR_EQUAL":return">=";case"LESS_THAN":return"<";case"LESS_THAN_OR_EQUAL":return"<=";case"ARRAY_CONTAINS":return"array-contains";case"IN":return"in";case"NOT_IN":return"not-in";case"ARRAY_CONTAINS_ANY":return"array-contains-any";case"OPERATOR_UNSPECIFIED":return Jt(58110);default:return Jt(50506)}}(e.fieldFilter.op),e.fieldFilter.value)}(n):n.compositeFilter!==void 0?function(e){return Xi.create(e.compositeFilter.filters.map(s=>GR(s)),function(r){switch(r){case"AND":return"and";case"OR":return"or";default:return Jt(1026)}}(e.compositeFilter.op))}(n):Jt(30097,{filter:n})}function S6(n){return c6[n]}function T6(n){return h6[n]}function E6(n){return d6[n]}function Ec(n){return{fieldPath:n.canonicalString()}}function Ic(n){return ws.fromServerFormat(n.fieldPath)}function WR(n){return n instanceof Yn?function(e){if(e.op==="=="){if(Y_(e.value))return{unaryFilter:{field:Ec(e.field),op:"IS_NAN"}};if(X_(e.value))return{unaryFilter:{field:Ec(e.field),op:"IS_NULL"}}}else if(e.op==="!="){if(Y_(e.value))return{unaryFilter:{field:Ec(e.field),op:"IS_NOT_NAN"}};if(X_(e.value))return{unaryFilter:{field:Ec(e.field),op:"IS_NOT_NULL"}}}return{fieldFilter:{field:Ec(e.field),op:T6(e.op),value:e.value}}}(n):n instanceof Xi?function(e){const s=e.getFilters().map(r=>WR(r));return s.length===1?s[0]:{compositeFilter:{op:E6(e.op),filters:s}}}(n):Jt(54877,{filter:n})}function I6(n){const t=[];return n.fields.forEach(e=>t.push(e.canonicalString())),{fieldPaths:t}}function HR(n){return n.length>=4&&n.get(0)==="projects"&&n.get(2)==="databases"}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ea{constructor(t,e,s,r,i=ee.min(),o=ee.min(),l=Cs.EMPTY_BYTE_STRING,u=null){this.target=t,this.targetId=e,this.purpose=s,this.sequenceNumber=r,this.snapshotVersion=i,this.lastLimboFreeSnapshotVersion=o,this.resumeToken=l,this.expectedCount=u}withSequenceNumber(t){return new Ea(this.target,this.targetId,this.purpose,t,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,this.expectedCount)}withResumeToken(t,e){return new Ea(this.target,this.targetId,this.purpose,this.sequenceNumber,e,this.lastLimboFreeSnapshotVersion,t,null)}withExpectedCount(t){return new Ea(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,t)}withLastLimboFreeSnapshotVersion(t){return new Ea(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,t,this.resumeToken,this.expectedCount)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class _6{constructor(t){this.wt=t}}function k6(n){const t=w6({parent:n.parent,structuredQuery:n.structuredQuery});return n.limitType==="LAST"?Fv(t,t.limit,"L"):t}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class A6{constructor(){this.Cn=new N6}addToCollectionParentIndex(t,e){return this.Cn.add(e),Et.resolve()}getCollectionParents(t,e){return Et.resolve(this.Cn.getEntries(e))}addFieldIndex(t,e){return Et.resolve()}deleteFieldIndex(t,e){return Et.resolve()}deleteAllFieldIndexes(t){return Et.resolve()}createTargetIndexes(t,e){return Et.resolve()}getDocumentsMatchingTarget(t,e){return Et.resolve(null)}getIndexType(t,e){return Et.resolve(0)}getFieldIndexes(t,e){return Et.resolve([])}getNextCollectionGroupToUpdate(t){return Et.resolve(null)}getMinOffset(t,e){return Et.resolve(Pa.min())}getMinOffsetFromCollectionGroup(t,e){return Et.resolve(Pa.min())}updateCollectionGroup(t,e,s){return Et.resolve()}updateIndexEntries(t,e){return Et.resolve()}}class N6{constructor(){this.index={}}add(t){const e=t.lastSegment(),s=t.popLast(),r=this.index[e]||new ts(un.comparator),i=!r.has(s);return this.index[e]=r.add(s),i}has(t){const e=t.lastSegment(),s=t.popLast(),r=this.index[e];return r&&r.has(s)}getEntries(t){return(this.index[t]||new ts(un.comparator)).toArray()}}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const ck={didRun:!1,sequenceNumbersCollected:0,targetsRemoved:0,documentsRemoved:0},qR=41943040;class ir{static withCacheSize(t){return new ir(t,ir.DEFAULT_COLLECTION_PERCENTILE,ir.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT)}constructor(t,e,s){this.cacheSizeCollectionThreshold=t,this.percentileToCollect=e,this.maximumSequenceNumbersToCollect=s}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */ir.DEFAULT_COLLECTION_PERCENTILE=10,ir.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT=1e3,ir.DEFAULT=new ir(qR,ir.DEFAULT_COLLECTION_PERCENTILE,ir.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT),ir.DISABLED=new ir(-1,0,0);/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Bc{constructor(t){this.ur=t}next(){return this.ur+=2,this.ur}static cr(){return new Bc(0)}static lr(){return new Bc(-1)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const hk="LruGarbageCollector",R6=1048576;function dk([n,t],[e,s]){const r=he(n,e);return r===0?he(t,s):r}class $6{constructor(t){this.Er=t,this.buffer=new ts(dk),this.dr=0}Ar(){return++this.dr}Rr(t){const e=[t,this.Ar()];if(this.buffer.size<this.Er)this.buffer=this.buffer.add(e);else{const s=this.buffer.last();dk(e,s)<0&&(this.buffer=this.buffer.delete(s).add(e))}}get maxValue(){return this.buffer.last()[0]}}class D6{constructor(t,e,s){this.garbageCollector=t,this.asyncQueue=e,this.localStore=s,this.Vr=null}start(){this.garbageCollector.params.cacheSizeCollectionThreshold!==-1&&this.mr(6e4)}stop(){this.Vr&&(this.Vr.cancel(),this.Vr=null)}get started(){return this.Vr!==null}mr(t){Mt(hk,`Garbage collection scheduled in ${t}ms`),this.Vr=this.asyncQueue.enqueueAfterDelay("lru_garbage_collection",t,async()=>{this.Vr=null;try{await this.localStore.collectGarbage(this.garbageCollector)}catch(e){oh(e)?Mt(hk,"Ignoring IndexedDB error during garbage collection: ",e):await ih(e)}await this.mr(3e5)})}}class O6{constructor(t,e){this.gr=t,this.params=e}calculateTargetCount(t,e){return this.gr.pr(t).next(s=>Math.floor(e/100*s))}nthSequenceNumber(t,e){if(e===0)return Et.resolve(t0.le);const s=new $6(e);return this.gr.forEachTarget(t,r=>s.Rr(r.sequenceNumber)).next(()=>this.gr.yr(t,r=>s.Rr(r))).next(()=>s.maxValue)}removeTargets(t,e,s){return this.gr.removeTargets(t,e,s)}removeOrphanedDocuments(t,e){return this.gr.removeOrphanedDocuments(t,e)}collect(t,e){return this.params.cacheSizeCollectionThreshold===-1?(Mt("LruGarbageCollector","Garbage collection skipped; disabled"),Et.resolve(ck)):this.getCacheSize(t).next(s=>s<this.params.cacheSizeCollectionThreshold?(Mt("LruGarbageCollector",`Garbage collection skipped; Cache size ${s} is lower than threshold ${this.params.cacheSizeCollectionThreshold}`),ck):this.wr(t,e))}getCacheSize(t){return this.gr.getCacheSize(t)}wr(t,e){let s,r,i,o,l,u,h;const d=Date.now();return this.calculateTargetCount(t,this.params.percentileToCollect).next(p=>(p>this.params.maximumSequenceNumbersToCollect?(Mt("LruGarbageCollector",`Capping sequence numbers to collect down to the maximum of ${this.params.maximumSequenceNumbersToCollect} from ${p}`),r=this.params.maximumSequenceNumbersToCollect):r=p,o=Date.now(),this.nthSequenceNumber(t,r))).next(p=>(s=p,l=Date.now(),this.removeTargets(t,s,e))).next(p=>(i=p,u=Date.now(),this.removeOrphanedDocuments(t,s))).next(p=>(h=Date.now(),Sc()<=ke.DEBUG&&Mt("LruGarbageCollector",`LRU Garbage Collection
	Counted targets in ${o-d}ms
	Determined least recently used ${r} in `+(l-o)+`ms
	Removed ${i} targets in `+(u-l)+`ms
	Removed ${p} documents in `+(h-u)+`ms
Total Duration: ${h-d}ms`),Et.resolve({didRun:!0,sequenceNumbersCollected:r,targetsRemoved:i,documentsRemoved:p})))}}function M6(n,t){return new O6(n,t)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class F6{constructor(){this.changes=new yu(t=>t.toString(),(t,e)=>t.isEqual(e)),this.changesApplied=!1}addEntry(t){this.assertNotApplied(),this.changes.set(t.key,t)}removeEntry(t,e){this.assertNotApplied(),this.changes.set(t,Ms.newInvalidDocument(t).setReadTime(e))}getEntry(t,e){this.assertNotApplied();const s=this.changes.get(e);return s!==void 0?Et.resolve(s):this.getFromCache(t,e)}getEntries(t,e){return this.getAllFromCache(t,e)}apply(t){return this.assertNotApplied(),this.changesApplied=!0,this.applyChanges(t)}assertNotApplied(){}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *//**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class L6{constructor(t,e){this.overlayedDocument=t,this.mutatedFields=e}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class P6{constructor(t,e,s,r){this.remoteDocumentCache=t,this.mutationQueue=e,this.documentOverlayCache=s,this.indexManager=r}getDocument(t,e){let s=null;return this.documentOverlayCache.getOverlay(t,e).next(r=>(s=r,this.remoteDocumentCache.getEntry(t,e))).next(r=>(s!==null&&Yd(s.mutation,r,oi.empty(),Jn.now()),r))}getDocuments(t,e){return this.remoteDocumentCache.getEntries(t,e).next(s=>this.getLocalViewOfDocuments(t,s,xe()).next(()=>s))}getLocalViewOfDocuments(t,e,s=xe()){const r=ql();return this.populateOverlays(t,r,e).next(()=>this.computeViews(t,e,r,s).next(i=>{let o=Pd();return i.forEach((l,u)=>{o=o.insert(l,u.overlayedDocument)}),o}))}getOverlayedDocuments(t,e){const s=ql();return this.populateOverlays(t,s,e).next(()=>this.computeViews(t,e,s,xe()))}populateOverlays(t,e,s){const r=[];return s.forEach(i=>{e.has(i)||r.push(i)}),this.documentOverlayCache.getOverlays(t,r).next(i=>{i.forEach((o,l)=>{e.set(o,l)})})}computeViews(t,e,s,r){let i=Vo();const o=Xd(),l=function(){return Xd()}();return e.forEach((u,h)=>{const d=s.get(h.key);r.has(h.key)&&(d===void 0||d.mutation instanceof xu)?i=i.insert(h.key,h):d!==void 0?(o.set(h.key,d.mutation.getFieldMask()),Yd(d.mutation,h,d.mutation.getFieldMask(),Jn.now())):o.set(h.key,oi.empty())}),this.recalculateAndSaveOverlays(t,i).next(u=>(u.forEach((h,d)=>o.set(h,d)),e.forEach((h,d)=>{var p;return l.set(h,new L6(d,(p=o.get(h))!==null&&p!==void 0?p:null))}),l))}recalculateAndSaveOverlays(t,e){const s=Xd();let r=new pn((o,l)=>o-l),i=xe();return this.mutationQueue.getAllMutationBatchesAffectingDocumentKeys(t,e).next(o=>{for(const l of o)l.keys().forEach(u=>{const h=e.get(u);if(h===null)return;let d=s.get(u)||oi.empty();d=l.applyToLocalView(h,d),s.set(u,d);const p=(r.get(l.batchId)||xe()).add(u);r=r.insert(l.batchId,p)})}).next(()=>{const o=[],l=r.getReverseIterator();for(;l.hasNext();){const u=l.getNext(),h=u.key,d=u.value,p=_R();d.forEach(m=>{if(!i.has(m)){const y=DR(e.get(m),s.get(m));y!==null&&p.set(m,y),i=i.add(m)}}),o.push(this.documentOverlayCache.saveOverlays(t,h,p))}return Et.waitFor(o)}).next(()=>s)}recalculateAndSaveOverlaysForDocumentKeys(t,e){return this.remoteDocumentCache.getEntries(t,e).next(s=>this.recalculateAndSaveOverlays(t,s))}getDocumentsMatchingQuery(t,e,s,r){return function(o){return qt.isDocumentKey(o.path)&&o.collectionGroup===null&&o.filters.length===0}(e)?this.getDocumentsMatchingDocumentQuery(t,e.path):BU(e)?this.getDocumentsMatchingCollectionGroupQuery(t,e,s,r):this.getDocumentsMatchingCollectionQuery(t,e,s,r)}getNextDocuments(t,e,s,r){return this.remoteDocumentCache.getAllFromCollectionGroup(t,e,s,r).next(i=>{const o=r-i.size>0?this.documentOverlayCache.getOverlaysForCollectionGroup(t,e,s.largestBatchId,r-i.size):Et.resolve(ql());let l=rf,u=i;return o.next(h=>Et.forEach(h,(d,p)=>(l<p.largestBatchId&&(l=p.largestBatchId),i.get(d)?Et.resolve():this.remoteDocumentCache.getEntry(t,d).next(m=>{u=u.insert(d,m)}))).next(()=>this.populateOverlays(t,h,i)).next(()=>this.computeViews(t,u,h,xe())).next(d=>({batchId:l,changes:IR(d)})))})}getDocumentsMatchingDocumentQuery(t,e){return this.getDocument(t,new qt(e)).next(s=>{let r=Pd();return s.isFoundDocument()&&(r=r.insert(s.key,s)),r})}getDocumentsMatchingCollectionGroupQuery(t,e,s,r){const i=e.collectionGroup;let o=Pd();return this.indexManager.getCollectionParents(t,i).next(l=>Et.forEach(l,u=>{const h=function(p,m){return new s0(m,null,p.explicitOrderBy.slice(),p.filters.slice(),p.limit,p.limitType,p.startAt,p.endAt)}(e,u.child(i));return this.getDocumentsMatchingCollectionQuery(t,h,s,r).next(d=>{d.forEach((p,m)=>{o=o.insert(p,m)})})}).next(()=>o))}getDocumentsMatchingCollectionQuery(t,e,s,r){let i;return this.documentOverlayCache.getOverlaysForCollection(t,e.path,s.largestBatchId).next(o=>(i=o,this.remoteDocumentCache.getDocumentsMatchingQuery(t,e,s,i,r))).next(o=>{i.forEach((u,h)=>{const d=h.getKey();o.get(d)===null&&(o=o.insert(d,Ms.newInvalidDocument(d)))});let l=Pd();return o.forEach((u,h)=>{const d=i.get(u);d!==void 0&&Yd(d.mutation,h,oi.empty(),Jn.now()),i0(e,h)&&(l=l.insert(u,h))}),l})}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class V6{constructor(t){this.serializer=t,this.kr=new Map,this.qr=new Map}getBundleMetadata(t,e){return Et.resolve(this.kr.get(e))}saveBundleMetadata(t,e){return this.kr.set(e.id,function(r){return{id:r.id,version:r.version,createTime:zi(r.createTime)}}(e)),Et.resolve()}getNamedQuery(t,e){return Et.resolve(this.qr.get(e))}saveNamedQuery(t,e){return this.qr.set(e.name,function(r){return{name:r.name,query:k6(r.bundledQuery),readTime:zi(r.readTime)}}(e)),Et.resolve()}}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class z6{constructor(){this.overlays=new pn(qt.comparator),this.Qr=new Map}getOverlay(t,e){return Et.resolve(this.overlays.get(e))}getOverlays(t,e){const s=ql();return Et.forEach(e,r=>this.getOverlay(t,r).next(i=>{i!==null&&s.set(r,i)})).next(()=>s)}saveOverlays(t,e,s){return s.forEach((r,i)=>{this.St(t,e,i)}),Et.resolve()}removeOverlaysForBatchId(t,e,s){const r=this.Qr.get(s);return r!==void 0&&(r.forEach(i=>this.overlays=this.overlays.remove(i)),this.Qr.delete(s)),Et.resolve()}getOverlaysForCollection(t,e,s){const r=ql(),i=e.length+1,o=new qt(e.child("")),l=this.overlays.getIteratorFrom(o);for(;l.hasNext();){const u=l.getNext().value,h=u.getKey();if(!e.isPrefixOf(h.path))break;h.path.length===i&&u.largestBatchId>s&&r.set(u.getKey(),u)}return Et.resolve(r)}getOverlaysForCollectionGroup(t,e,s,r){let i=new pn((h,d)=>h-d);const o=this.overlays.getIterator();for(;o.hasNext();){const h=o.getNext().value;if(h.getKey().getCollectionGroup()===e&&h.largestBatchId>s){let d=i.get(h.largestBatchId);d===null&&(d=ql(),i=i.insert(h.largestBatchId,d)),d.set(h.getKey(),h)}}const l=ql(),u=i.getIterator();for(;u.hasNext()&&(u.getNext().value.forEach((h,d)=>l.set(h,d)),!(l.size()>=r)););return Et.resolve(l)}St(t,e,s){const r=this.overlays.get(s.key);if(r!==null){const o=this.Qr.get(r.largestBatchId).delete(s.key);this.Qr.set(r.largestBatchId,o)}this.overlays=this.overlays.insert(s.key,new i6(e,s));let i=this.Qr.get(e);i===void 0&&(i=xe(),this.Qr.set(e,i)),this.Qr.set(e,i.add(s.key))}}/**
 * @license
 * Copyright 2024 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class B6{constructor(){this.sessionToken=Cs.EMPTY_BYTE_STRING}getSessionToken(t){return Et.resolve(this.sessionToken)}setSessionToken(t,e){return this.sessionToken=e,Et.resolve()}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Kw{constructor(){this.$r=new ts(as.Ur),this.Kr=new ts(as.Wr)}isEmpty(){return this.$r.isEmpty()}addReference(t,e){const s=new as(t,e);this.$r=this.$r.add(s),this.Kr=this.Kr.add(s)}Gr(t,e){t.forEach(s=>this.addReference(s,e))}removeReference(t,e){this.zr(new as(t,e))}jr(t,e){t.forEach(s=>this.removeReference(s,e))}Hr(t){const e=new qt(new un([])),s=new as(e,t),r=new as(e,t+1),i=[];return this.Kr.forEachInRange([s,r],o=>{this.zr(o),i.push(o.key)}),i}Jr(){this.$r.forEach(t=>this.zr(t))}zr(t){this.$r=this.$r.delete(t),this.Kr=this.Kr.delete(t)}Yr(t){const e=new qt(new un([])),s=new as(e,t),r=new as(e,t+1);let i=xe();return this.Kr.forEachInRange([s,r],o=>{i=i.add(o.key)}),i}containsKey(t){const e=new as(t,0),s=this.$r.firstAfterOrEqual(e);return s!==null&&t.isEqual(s.key)}}class as{constructor(t,e){this.key=t,this.Zr=e}static Ur(t,e){return qt.comparator(t.key,e.key)||he(t.Zr,e.Zr)}static Wr(t,e){return he(t.Zr,e.Zr)||qt.comparator(t.key,e.key)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class U6{constructor(t,e){this.indexManager=t,this.referenceDelegate=e,this.mutationQueue=[],this.nr=1,this.Xr=new ts(as.Ur)}checkEmpty(t){return Et.resolve(this.mutationQueue.length===0)}addMutationBatch(t,e,s,r){const i=this.nr;this.nr++,this.mutationQueue.length>0&&this.mutationQueue[this.mutationQueue.length-1];const o=new r6(i,e,s,r);this.mutationQueue.push(o);for(const l of r)this.Xr=this.Xr.add(new as(l.key,i)),this.indexManager.addToCollectionParentIndex(t,l.key.path.popLast());return Et.resolve(o)}lookupMutationBatch(t,e){return Et.resolve(this.ei(e))}getNextMutationBatchAfterBatchId(t,e){const s=e+1,r=this.ti(s),i=r<0?0:r;return Et.resolve(this.mutationQueue.length>i?this.mutationQueue[i]:null)}getHighestUnacknowledgedBatchId(){return Et.resolve(this.mutationQueue.length===0?Vw:this.nr-1)}getAllMutationBatches(t){return Et.resolve(this.mutationQueue.slice())}getAllMutationBatchesAffectingDocumentKey(t,e){const s=new as(e,0),r=new as(e,Number.POSITIVE_INFINITY),i=[];return this.Xr.forEachInRange([s,r],o=>{const l=this.ei(o.Zr);i.push(l)}),Et.resolve(i)}getAllMutationBatchesAffectingDocumentKeys(t,e){let s=new ts(he);return e.forEach(r=>{const i=new as(r,0),o=new as(r,Number.POSITIVE_INFINITY);this.Xr.forEachInRange([i,o],l=>{s=s.add(l.Zr)})}),Et.resolve(this.ni(s))}getAllMutationBatchesAffectingQuery(t,e){const s=e.path,r=s.length+1;let i=s;qt.isDocumentKey(i)||(i=i.child(""));const o=new as(new qt(i),0);let l=new ts(he);return this.Xr.forEachWhile(u=>{const h=u.key.path;return!!s.isPrefixOf(h)&&(h.length===r&&(l=l.add(u.Zr)),!0)},o),Et.resolve(this.ni(l))}ni(t){const e=[];return t.forEach(s=>{const r=this.ei(s);r!==null&&e.push(r)}),e}removeMutationBatch(t,e){ze(this.ri(e.batchId,"removed")===0,55003),this.mutationQueue.shift();let s=this.Xr;return Et.forEach(e.mutations,r=>{const i=new as(r.key,e.batchId);return s=s.delete(i),this.referenceDelegate.markPotentiallyOrphaned(t,r.key)}).next(()=>{this.Xr=s})}sr(t){}containsKey(t,e){const s=new as(e,0),r=this.Xr.firstAfterOrEqual(s);return Et.resolve(e.isEqual(r&&r.key))}performConsistencyCheck(t){return this.mutationQueue.length,Et.resolve()}ri(t,e){return this.ti(t)}ti(t){return this.mutationQueue.length===0?0:t-this.mutationQueue[0].batchId}ei(t){const e=this.ti(t);return e<0||e>=this.mutationQueue.length?null:this.mutationQueue[e]}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class G6{constructor(t){this.ii=t,this.docs=function(){return new pn(qt.comparator)}(),this.size=0}setIndexManager(t){this.indexManager=t}addEntry(t,e){const s=e.key,r=this.docs.get(s),i=r?r.size:0,o=this.ii(e);return this.docs=this.docs.insert(s,{document:e.mutableCopy(),size:o}),this.size+=o-i,this.indexManager.addToCollectionParentIndex(t,s.path.popLast())}removeEntry(t){const e=this.docs.get(t);e&&(this.docs=this.docs.remove(t),this.size-=e.size)}getEntry(t,e){const s=this.docs.get(e);return Et.resolve(s?s.document.mutableCopy():Ms.newInvalidDocument(e))}getEntries(t,e){let s=Vo();return e.forEach(r=>{const i=this.docs.get(r);s=s.insert(r,i?i.document.mutableCopy():Ms.newInvalidDocument(r))}),Et.resolve(s)}getDocumentsMatchingQuery(t,e,s,r){let i=Vo();const o=e.path,l=new qt(o.child("__id-9223372036854775808__")),u=this.docs.getIteratorFrom(l);for(;u.hasNext();){const{key:h,value:{document:d}}=u.getNext();if(!o.isPrefixOf(h.path))break;h.path.length>o.length+1||xU(yU(d),s)<=0||(r.has(d.key)||i0(e,d))&&(i=i.insert(d.key,d.mutableCopy()))}return Et.resolve(i)}getAllFromCollectionGroup(t,e,s,r){Jt(9500)}si(t,e){return Et.forEach(this.docs,s=>e(s))}newChangeBuffer(t){return new W6(this)}getSize(t){return Et.resolve(this.size)}}class W6 extends F6{constructor(t){super(),this.Br=t}applyChanges(t){const e=[];return this.changes.forEach((s,r)=>{r.isValidDocument()?e.push(this.Br.addEntry(t,r)):this.Br.removeEntry(s)}),Et.waitFor(e)}getFromCache(t,e){return this.Br.getEntry(t,e)}getAllFromCache(t,e){return this.Br.getEntries(t,e)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class H6{constructor(t){this.persistence=t,this.oi=new yu(e=>Uw(e),Gw),this.lastRemoteSnapshotVersion=ee.min(),this.highestTargetId=0,this._i=0,this.ai=new Kw,this.targetCount=0,this.ui=Bc.cr()}forEachTarget(t,e){return this.oi.forEach((s,r)=>e(r)),Et.resolve()}getLastRemoteSnapshotVersion(t){return Et.resolve(this.lastRemoteSnapshotVersion)}getHighestSequenceNumber(t){return Et.resolve(this._i)}allocateTargetId(t){return this.highestTargetId=this.ui.next(),Et.resolve(this.highestTargetId)}setTargetsMetadata(t,e,s){return s&&(this.lastRemoteSnapshotVersion=s),e>this._i&&(this._i=e),Et.resolve()}Tr(t){this.oi.set(t.target,t);const e=t.targetId;e>this.highestTargetId&&(this.ui=new Bc(e),this.highestTargetId=e),t.sequenceNumber>this._i&&(this._i=t.sequenceNumber)}addTargetData(t,e){return this.Tr(e),this.targetCount+=1,Et.resolve()}updateTargetData(t,e){return this.Tr(e),Et.resolve()}removeTargetData(t,e){return this.oi.delete(e.target),this.ai.Hr(e.targetId),this.targetCount-=1,Et.resolve()}removeTargets(t,e,s){let r=0;const i=[];return this.oi.forEach((o,l)=>{l.sequenceNumber<=e&&s.get(l.targetId)===null&&(this.oi.delete(o),i.push(this.removeMatchingKeysForTargetId(t,l.targetId)),r++)}),Et.waitFor(i).next(()=>r)}getTargetCount(t){return Et.resolve(this.targetCount)}getTargetData(t,e){const s=this.oi.get(e)||null;return Et.resolve(s)}addMatchingKeys(t,e,s){return this.ai.Gr(e,s),Et.resolve()}removeMatchingKeys(t,e,s){this.ai.jr(e,s);const r=this.persistence.referenceDelegate,i=[];return r&&e.forEach(o=>{i.push(r.markPotentiallyOrphaned(t,o))}),Et.waitFor(i)}removeMatchingKeysForTargetId(t,e){return this.ai.Hr(e),Et.resolve()}getMatchingKeysForTargetId(t,e){const s=this.ai.Yr(e);return Et.resolve(s)}containsKey(t,e){return Et.resolve(this.ai.containsKey(e))}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class jR{constructor(t,e){this.ci={},this.overlays={},this.li=new t0(0),this.hi=!1,this.hi=!0,this.Pi=new B6,this.referenceDelegate=t(this),this.Ti=new H6(this),this.indexManager=new A6,this.remoteDocumentCache=function(r){return new G6(r)}(s=>this.referenceDelegate.Ii(s)),this.serializer=new _6(e),this.Ei=new V6(this.serializer)}start(){return Promise.resolve()}shutdown(){return this.hi=!1,Promise.resolve()}get started(){return this.hi}setDatabaseDeletedListener(){}setNetworkEnabled(){}getIndexManager(t){return this.indexManager}getDocumentOverlayCache(t){let e=this.overlays[t.toKey()];return e||(e=new z6,this.overlays[t.toKey()]=e),e}getMutationQueue(t,e){let s=this.ci[t.toKey()];return s||(s=new U6(e,this.referenceDelegate),this.ci[t.toKey()]=s),s}getGlobalsCache(){return this.Pi}getTargetCache(){return this.Ti}getRemoteDocumentCache(){return this.remoteDocumentCache}getBundleCache(){return this.Ei}runTransaction(t,e,s){Mt("MemoryPersistence","Starting transaction:",t);const r=new q6(this.li.next());return this.referenceDelegate.di(),s(r).next(i=>this.referenceDelegate.Ai(r).next(()=>i)).toPromise().then(i=>(r.raiseOnCommittedEvent(),i))}Ri(t,e){return Et.or(Object.values(this.ci).map(s=>()=>s.containsKey(t,e)))}}class q6 extends vU{constructor(t){super(),this.currentSequenceNumber=t}}class Xw{constructor(t){this.persistence=t,this.Vi=new Kw,this.mi=null}static fi(t){return new Xw(t)}get gi(){if(this.mi)return this.mi;throw Jt(60996)}addReference(t,e,s){return this.Vi.addReference(s,e),this.gi.delete(s.toString()),Et.resolve()}removeReference(t,e,s){return this.Vi.removeReference(s,e),this.gi.add(s.toString()),Et.resolve()}markPotentiallyOrphaned(t,e){return this.gi.add(e.toString()),Et.resolve()}removeTarget(t,e){this.Vi.Hr(e.targetId).forEach(r=>this.gi.add(r.toString()));const s=this.persistence.getTargetCache();return s.getMatchingKeysForTargetId(t,e.targetId).next(r=>{r.forEach(i=>this.gi.add(i.toString()))}).next(()=>s.removeTargetData(t,e))}di(){this.mi=new Set}Ai(t){const e=this.persistence.getRemoteDocumentCache().newChangeBuffer();return Et.forEach(this.gi,s=>{const r=qt.fromPath(s);return this.pi(t,r).next(i=>{i||e.removeEntry(r,ee.min())})}).next(()=>(this.mi=null,e.apply(t)))}updateLimboDocument(t,e){return this.pi(t,e).next(s=>{s?this.gi.delete(e.toString()):this.gi.add(e.toString())})}Ii(t){return 0}pi(t,e){return Et.or([()=>Et.resolve(this.Vi.containsKey(e)),()=>this.persistence.getTargetCache().containsKey(t,e),()=>this.persistence.Ri(t,e)])}}class my{constructor(t,e){this.persistence=t,this.yi=new yu(s=>SU(s.path),(s,r)=>s.isEqual(r)),this.garbageCollector=M6(this,e)}static fi(t,e){return new my(t,e)}di(){}Ai(t){return Et.resolve()}forEachTarget(t,e){return this.persistence.getTargetCache().forEachTarget(t,e)}pr(t){const e=this.br(t);return this.persistence.getTargetCache().getTargetCount(t).next(s=>e.next(r=>s+r))}br(t){let e=0;return this.yr(t,s=>{e++}).next(()=>e)}yr(t,e){return Et.forEach(this.yi,(s,r)=>this.Dr(t,s,r).next(i=>i?Et.resolve():e(r)))}removeTargets(t,e,s){return this.persistence.getTargetCache().removeTargets(t,e,s)}removeOrphanedDocuments(t,e){let s=0;const r=this.persistence.getRemoteDocumentCache(),i=r.newChangeBuffer();return r.si(t,o=>this.Dr(t,o,e).next(l=>{l||(s++,i.removeEntry(o,ee.min()))})).next(()=>i.apply(t)).next(()=>s)}markPotentiallyOrphaned(t,e){return this.yi.set(e,t.currentSequenceNumber),Et.resolve()}removeTarget(t,e){const s=e.withSequenceNumber(t.currentSequenceNumber);return this.persistence.getTargetCache().updateTargetData(t,s)}addReference(t,e,s){return this.yi.set(s,t.currentSequenceNumber),Et.resolve()}removeReference(t,e,s){return this.yi.set(s,t.currentSequenceNumber),Et.resolve()}updateLimboDocument(t,e){return this.yi.set(e,t.currentSequenceNumber),Et.resolve()}Ii(t){let e=t.key.toString().length;return t.isFoundDocument()&&(e+=Ug(t.data.value)),e}Dr(t,e,s){return Et.or([()=>this.persistence.Ri(t,e),()=>this.persistence.getTargetCache().containsKey(t,e),()=>{const r=this.yi.get(e);return Et.resolve(r!==void 0&&r>s)}])}getCacheSize(t){return this.persistence.getRemoteDocumentCache().getSize(t)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Yw{constructor(t,e,s,r){this.targetId=t,this.fromCache=e,this.ds=s,this.As=r}static Rs(t,e){let s=xe(),r=xe();for(const i of e.docChanges)switch(i.type){case 0:s=s.add(i.doc.key);break;case 1:r=r.add(i.doc.key)}return new Yw(t,e.fromCache,s,r)}}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class j6{constructor(){this._documentReadCount=0}get documentReadCount(){return this._documentReadCount}incrementDocumentReadCount(t){this._documentReadCount+=t}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class K6{constructor(){this.Vs=!1,this.fs=!1,this.gs=100,this.ps=function(){return Gz()?8:wU(Bz())>0?6:4}()}initialize(t,e){this.ys=t,this.indexManager=e,this.Vs=!0}getDocumentsMatchingQuery(t,e,s,r){const i={result:null};return this.ws(t,e).next(o=>{i.result=o}).next(()=>{if(!i.result)return this.bs(t,e,r,s).next(o=>{i.result=o})}).next(()=>{if(i.result)return;const o=new j6;return this.Ss(t,e,o).next(l=>{if(i.result=l,this.fs)return this.Ds(t,e,o,l.size)})}).next(()=>i.result)}Ds(t,e,s,r){return s.documentReadCount<this.gs?(Sc()<=ke.DEBUG&&Mt("QueryEngine","SDK will not create cache indexes for query:",Tc(e),"since it only creates cache indexes for collection contains","more than or equal to",this.gs,"documents"),Et.resolve()):(Sc()<=ke.DEBUG&&Mt("QueryEngine","Query:",Tc(e),"scans",s.documentReadCount,"local documents and returns",r,"documents as results."),s.documentReadCount>this.ps*r?(Sc()<=ke.DEBUG&&Mt("QueryEngine","The SDK decides to create cache indexes for query:",Tc(e),"as using cache indexes may help improve performance."),this.indexManager.createTargetIndexes(t,Vi(e))):Et.resolve())}ws(t,e){if(tk(e))return Et.resolve(null);let s=Vi(e);return this.indexManager.getIndexType(t,s).next(r=>r===0?null:(e.limit!==null&&r===1&&(e=Fv(e,null,"F"),s=Vi(e)),this.indexManager.getDocumentsMatchingTarget(t,s).next(i=>{const o=xe(...i);return this.ys.getDocuments(t,o).next(l=>this.indexManager.getMinOffset(t,s).next(u=>{const h=this.vs(e,l);return this.Cs(e,h,o,u.readTime)?this.ws(t,Fv(e,null,"F")):this.Fs(t,h,e,u)}))})))}bs(t,e,s,r){return tk(e)||r.isEqual(ee.min())?Et.resolve(null):this.ys.getDocuments(t,s).next(i=>{const o=this.vs(e,i);return this.Cs(e,o,s,r)?Et.resolve(null):(Sc()<=ke.DEBUG&&Mt("QueryEngine","Re-using previous result from %s to execute query: %s",r.toString(),Tc(e)),this.Fs(t,o,e,gU(r,rf)).next(l=>l))})}vs(t,e){let s=new ts(TR(t));return e.forEach((r,i)=>{i0(t,i)&&(s=s.add(i))}),s}Cs(t,e,s,r){if(t.limit===null)return!1;if(s.size!==e.size)return!0;const i=t.limitType==="F"?e.last():e.first();return!!i&&(i.hasPendingWrites||i.version.compareTo(r)>0)}Ss(t,e,s){return Sc()<=ke.DEBUG&&Mt("QueryEngine","Using full collection scan to execute query:",Tc(e)),this.ys.getDocumentsMatchingQuery(t,e,Pa.min(),s)}Fs(t,e,s,r){return this.ys.getDocumentsMatchingQuery(t,s,r).next(i=>(e.forEach(o=>{i=i.insert(o.key,o)}),i))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Qw="LocalStore",X6=3e8;class Y6{constructor(t,e,s,r){this.persistence=t,this.Ms=e,this.serializer=r,this.xs=new pn(he),this.Os=new yu(i=>Uw(i),Gw),this.Ns=new Map,this.Bs=t.getRemoteDocumentCache(),this.Ti=t.getTargetCache(),this.Ei=t.getBundleCache(),this.Ls(s)}Ls(t){this.documentOverlayCache=this.persistence.getDocumentOverlayCache(t),this.indexManager=this.persistence.getIndexManager(t),this.mutationQueue=this.persistence.getMutationQueue(t,this.indexManager),this.localDocuments=new P6(this.Bs,this.mutationQueue,this.documentOverlayCache,this.indexManager),this.Bs.setIndexManager(this.indexManager),this.Ms.initialize(this.localDocuments,this.indexManager)}collectGarbage(t){return this.persistence.runTransaction("Collect garbage","readwrite-primary",e=>t.collect(e,this.xs))}}function Q6(n,t,e,s){return new Y6(n,t,e,s)}async function KR(n,t){const e=se(n);return await e.persistence.runTransaction("Handle user change","readonly",s=>{let r;return e.mutationQueue.getAllMutationBatches(s).next(i=>(r=i,e.Ls(t),e.mutationQueue.getAllMutationBatches(s))).next(i=>{const o=[],l=[];let u=xe();for(const h of r){o.push(h.batchId);for(const d of h.mutations)u=u.add(d.key)}for(const h of i){l.push(h.batchId);for(const d of h.mutations)u=u.add(d.key)}return e.localDocuments.getDocuments(s,u).next(h=>({ks:h,removedBatchIds:o,addedBatchIds:l}))})})}function Z6(n,t){const e=se(n);return e.persistence.runTransaction("Acknowledge batch","readwrite-primary",s=>{const r=t.batch.keys(),i=e.Bs.newChangeBuffer({trackRemovals:!0});return function(l,u,h,d){const p=h.batch,m=p.keys();let y=Et.resolve();return m.forEach(x=>{y=y.next(()=>d.getEntry(u,x)).next(v=>{const C=h.docVersions.get(x);ze(C!==null,48541),v.version.compareTo(C)<0&&(p.applyToRemoteDocument(v,h),v.isValidDocument()&&(v.setReadTime(h.commitVersion),d.addEntry(v)))})}),y.next(()=>l.mutationQueue.removeMutationBatch(u,p))}(e,s,t,i).next(()=>i.apply(s)).next(()=>e.mutationQueue.performConsistencyCheck(s)).next(()=>e.documentOverlayCache.removeOverlaysForBatchId(s,r,t.batch.batchId)).next(()=>e.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(s,function(l){let u=xe();for(let h=0;h<l.mutationResults.length;++h)l.mutationResults[h].transformResults.length>0&&(u=u.add(l.batch.mutations[h].key));return u}(t))).next(()=>e.localDocuments.getDocuments(s,r))})}function XR(n){const t=se(n);return t.persistence.runTransaction("Get last remote snapshot version","readonly",e=>t.Ti.getLastRemoteSnapshotVersion(e))}function J6(n,t){const e=se(n),s=t.snapshotVersion;let r=e.xs;return e.persistence.runTransaction("Apply remote event","readwrite-primary",i=>{const o=e.Bs.newChangeBuffer({trackRemovals:!0});r=e.xs;const l=[];t.targetChanges.forEach((d,p)=>{const m=r.get(p);if(!m)return;l.push(e.Ti.removeMatchingKeys(i,d.removedDocuments,p).next(()=>e.Ti.addMatchingKeys(i,d.addedDocuments,p)));let y=m.withSequenceNumber(i.currentSequenceNumber);t.targetMismatches.get(p)!==null?y=y.withResumeToken(Cs.EMPTY_BYTE_STRING,ee.min()).withLastLimboFreeSnapshotVersion(ee.min()):d.resumeToken.approximateByteSize()>0&&(y=y.withResumeToken(d.resumeToken,s)),r=r.insert(p,y),function(v,C,S){return v.resumeToken.approximateByteSize()===0||C.snapshotVersion.toMicroseconds()-v.snapshotVersion.toMicroseconds()>=X6?!0:S.addedDocuments.size+S.modifiedDocuments.size+S.removedDocuments.size>0}(m,y,d)&&l.push(e.Ti.updateTargetData(i,y))});let u=Vo(),h=xe();if(t.documentUpdates.forEach(d=>{t.resolvedLimboDocuments.has(d)&&l.push(e.persistence.referenceDelegate.updateLimboDocument(i,d))}),l.push(tG(i,o,t.documentUpdates).next(d=>{u=d.qs,h=d.Qs})),!s.isEqual(ee.min())){const d=e.Ti.getLastRemoteSnapshotVersion(i).next(p=>e.Ti.setTargetsMetadata(i,i.currentSequenceNumber,s));l.push(d)}return Et.waitFor(l).next(()=>o.apply(i)).next(()=>e.localDocuments.getLocalViewOfDocuments(i,u,h)).next(()=>u)}).then(i=>(e.xs=r,i))}function tG(n,t,e){let s=xe(),r=xe();return e.forEach(i=>s=s.add(i)),t.getEntries(n,s).next(i=>{let o=Vo();return e.forEach((l,u)=>{const h=i.get(l);u.isFoundDocument()!==h.isFoundDocument()&&(r=r.add(l)),u.isNoDocument()&&u.version.isEqual(ee.min())?(t.removeEntry(l,u.readTime),o=o.insert(l,u)):!h.isValidDocument()||u.version.compareTo(h.version)>0||u.version.compareTo(h.version)===0&&h.hasPendingWrites?(t.addEntry(u),o=o.insert(l,u)):Mt(Qw,"Ignoring outdated watch update for ",l,". Current version:",h.version," Watch version:",u.version)}),{qs:o,Qs:r}})}function eG(n,t){const e=se(n);return e.persistence.runTransaction("Get next mutation batch","readonly",s=>(t===void 0&&(t=Vw),e.mutationQueue.getNextMutationBatchAfterBatchId(s,t)))}function nG(n,t){const e=se(n);return e.persistence.runTransaction("Allocate target","readwrite",s=>{let r;return e.Ti.getTargetData(s,t).next(i=>i?(r=i,Et.resolve(r)):e.Ti.allocateTargetId(s).next(o=>(r=new Ea(t,o,"TargetPurposeListen",s.currentSequenceNumber),e.Ti.addTargetData(s,r).next(()=>r))))}).then(s=>{const r=e.xs.get(s.targetId);return(r===null||s.snapshotVersion.compareTo(r.snapshotVersion)>0)&&(e.xs=e.xs.insert(s.targetId,s),e.Os.set(t,s.targetId)),s})}async function Bv(n,t,e){const s=se(n),r=s.xs.get(t),i=e?"readwrite":"readwrite-primary";try{e||await s.persistence.runTransaction("Release target",i,o=>s.persistence.referenceDelegate.removeTarget(o,r))}catch(o){if(!oh(o))throw o;Mt(Qw,`Failed to update sequence numbers for target ${t}: ${o}`)}s.xs=s.xs.remove(t),s.Os.delete(r.target)}function fk(n,t,e){const s=se(n);let r=ee.min(),i=xe();return s.persistence.runTransaction("Execute query","readwrite",o=>function(u,h,d){const p=se(u),m=p.Os.get(d);return m!==void 0?Et.resolve(p.xs.get(m)):p.Ti.getTargetData(h,d)}(s,o,Vi(t)).next(l=>{if(l)return r=l.lastLimboFreeSnapshotVersion,s.Ti.getMatchingKeysForTargetId(o,l.targetId).next(u=>{i=u})}).next(()=>s.Ms.getDocumentsMatchingQuery(o,t,e?r:ee.min(),e?i:xe())).next(l=>(sG(s,GU(t),l),{documents:l,$s:i})))}function sG(n,t,e){let s=n.Ns.get(t)||ee.min();e.forEach((r,i)=>{i.readTime.compareTo(s)>0&&(s=i.readTime)}),n.Ns.set(t,s)}class pk{constructor(){this.activeTargetIds=XU()}js(t){this.activeTargetIds=this.activeTargetIds.add(t)}Hs(t){this.activeTargetIds=this.activeTargetIds.delete(t)}zs(){const t={activeTargetIds:this.activeTargetIds.toArray(),updateTimeMs:Date.now()};return JSON.stringify(t)}}class rG{constructor(){this.xo=new pk,this.Oo={},this.onlineStateHandler=null,this.sequenceNumberHandler=null}addPendingMutation(t){}updateMutationState(t,e,s){}addLocalQueryTarget(t,e=!0){return e&&this.xo.js(t),this.Oo[t]||"not-current"}updateQueryState(t,e,s){this.Oo[t]=e}removeLocalQueryTarget(t){this.xo.Hs(t)}isLocalQueryTarget(t){return this.xo.activeTargetIds.has(t)}clearQueryState(t){delete this.Oo[t]}getAllActiveQueryTargets(){return this.xo.activeTargetIds}isActiveQueryTarget(t){return this.xo.activeTargetIds.has(t)}start(){return this.xo=new pk,Promise.resolve()}handleUserChange(t,e,s){}setOnlineState(t){}shutdown(){}writeSequenceNumber(t){}notifyBundleLoaded(t){}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class iG{No(t){}shutdown(){}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const mk="ConnectivityMonitor";class gk{constructor(){this.Bo=()=>this.Lo(),this.ko=()=>this.qo(),this.Qo=[],this.$o()}No(t){this.Qo.push(t)}shutdown(){window.removeEventListener("online",this.Bo),window.removeEventListener("offline",this.ko)}$o(){window.addEventListener("online",this.Bo),window.addEventListener("offline",this.ko)}Lo(){Mt(mk,"Network connectivity changed: AVAILABLE");for(const t of this.Qo)t(0)}qo(){Mt(mk,"Network connectivity changed: UNAVAILABLE");for(const t of this.Qo)t(1)}static C(){return typeof window<"u"&&window.addEventListener!==void 0&&window.removeEventListener!==void 0}}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let Sg=null;function Uv(){return Sg===null?Sg=function(){return 268435456+Math.round(2147483648*Math.random())}():Sg++,"0x"+Sg.toString(16)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Z1="RestConnection",oG={BatchGetDocuments:"batchGet",Commit:"commit",RunQuery:"runQuery",RunAggregationQuery:"runAggregationQuery"};class aG{get Uo(){return!1}constructor(t){this.databaseInfo=t,this.databaseId=t.databaseId;const e=t.ssl?"https":"http",s=encodeURIComponent(this.databaseId.projectId),r=encodeURIComponent(this.databaseId.database);this.Ko=e+"://"+t.host,this.Wo=`projects/${s}/databases/${r}`,this.Go=this.databaseId.database===ly?`project_id=${s}`:`project_id=${s}&database_id=${r}`}zo(t,e,s,r,i){const o=Uv(),l=this.jo(t,e.toUriEncodedString());Mt(Z1,`Sending RPC '${t}' ${o}:`,l,s);const u={"google-cloud-resource-prefix":this.Wo,"x-goog-request-params":this.Go};this.Ho(u,r,i);const{host:h}=new URL(l),d=Fw(h);return this.Jo(t,l,u,s,d).then(p=>(Mt(Z1,`Received RPC '${t}' ${o}: `,p),p),p=>{throw Lc(Z1,`RPC '${t}' ${o} failed with error: `,p,"url: ",l,"request:",s),p})}Yo(t,e,s,r,i,o){return this.zo(t,e,s,r,i)}Ho(t,e,s){t["X-Goog-Api-Client"]=function(){return"gl-js/ fire/"+rh}(),t["Content-Type"]="text/plain",this.databaseInfo.appId&&(t["X-Firebase-GMPID"]=this.databaseInfo.appId),e&&e.headers.forEach((r,i)=>t[i]=r),s&&s.headers.forEach((r,i)=>t[i]=r)}jo(t,e){const s=oG[t];return`${this.Ko}/v1/${e}:${s}`}terminate(){}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class lG{constructor(t){this.Zo=t.Zo,this.Xo=t.Xo}e_(t){this.t_=t}n_(t){this.r_=t}i_(t){this.s_=t}onMessage(t){this.o_=t}close(){this.Xo()}send(t){this.Zo(t)}__(){this.t_()}a_(){this.r_()}u_(t){this.s_(t)}c_(t){this.o_(t)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const $s="WebChannelConnection";class uG extends aG{constructor(t){super(t),this.l_=[],this.forceLongPolling=t.forceLongPolling,this.autoDetectLongPolling=t.autoDetectLongPolling,this.useFetchStreams=t.useFetchStreams,this.longPollingOptions=t.longPollingOptions}Jo(t,e,s,r,i){const o=Uv();return new Promise((l,u)=>{const h=new QN;h.setWithCredentials(!0),h.listenOnce(ZN.COMPLETE,()=>{try{switch(h.getLastErrorCode()){case Bg.NO_ERROR:const p=h.getResponseJson();Mt($s,`XHR for RPC '${t}' ${o} received:`,JSON.stringify(p)),l(p);break;case Bg.TIMEOUT:Mt($s,`RPC '${t}' ${o} timed out`),u(new Ht(_t.DEADLINE_EXCEEDED,"Request time out"));break;case Bg.HTTP_ERROR:const m=h.getStatus();if(Mt($s,`RPC '${t}' ${o} failed with status:`,m,"response text:",h.getResponseText()),m>0){let y=h.getResponseJson();Array.isArray(y)&&(y=y[0]);const x=y==null?void 0:y.error;if(x&&x.status&&x.message){const v=function(S){const E=S.toLowerCase().replace(/_/g,"-");return Object.values(_t).indexOf(E)>=0?E:_t.UNKNOWN}(x.status);u(new Ht(v,x.message))}else u(new Ht(_t.UNKNOWN,"Server responded with status "+h.getStatus()))}else u(new Ht(_t.UNAVAILABLE,"Connection failed."));break;default:Jt(9055,{h_:t,streamId:o,P_:h.getLastErrorCode(),T_:h.getLastError()})}}finally{Mt($s,`RPC '${t}' ${o} completed.`)}});const d=JSON.stringify(r);Mt($s,`RPC '${t}' ${o} sending request:`,r),h.send(e,"POST",d,s,15)})}I_(t,e,s){const r=Uv(),i=[this.Ko,"/","google.firestore.v1.Firestore","/",t,"/channel"],o=eR(),l=tR(),u={httpSessionIdParam:"gsessionid",initMessageHeaders:{},messageUrlParams:{database:`projects/${this.databaseId.projectId}/databases/${this.databaseId.database}`},sendRawJson:!0,supportsCrossDomainXhr:!0,internalChannelParams:{forwardChannelRequestTimeoutMs:6e5},forceLongPolling:this.forceLongPolling,detectBufferingProxy:this.autoDetectLongPolling},h=this.longPollingOptions.timeoutSeconds;h!==void 0&&(u.longPollingTimeout=Math.round(1e3*h)),this.useFetchStreams&&(u.useFetchStreams=!0),this.Ho(u.initMessageHeaders,e,s),u.encodeInitMessageHeaders=!0;const d=i.join("");Mt($s,`Creating RPC '${t}' stream ${r}: ${d}`,u);const p=o.createWebChannel(d,u);this.E_(p);let m=!1,y=!1;const x=new lG({Zo:C=>{y?Mt($s,`Not sending because RPC '${t}' stream ${r} is closed:`,C):(m||(Mt($s,`Opening RPC '${t}' stream ${r} transport.`),p.open(),m=!0),Mt($s,`RPC '${t}' stream ${r} sending:`,C),p.send(C))},Xo:()=>p.close()}),v=(C,S,E)=>{C.listen(S,_=>{try{E(_)}catch(I){setTimeout(()=>{throw I},0)}})};return v(p,Ld.EventType.OPEN,()=>{y||(Mt($s,`RPC '${t}' stream ${r} transport opened.`),x.__())}),v(p,Ld.EventType.CLOSE,()=>{y||(y=!0,Mt($s,`RPC '${t}' stream ${r} transport closed`),x.u_(),this.d_(p))}),v(p,Ld.EventType.ERROR,C=>{y||(y=!0,Lc($s,`RPC '${t}' stream ${r} transport errored. Name:`,C.name,"Message:",C.message),x.u_(new Ht(_t.UNAVAILABLE,"The operation could not be completed")))}),v(p,Ld.EventType.MESSAGE,C=>{var S;if(!y){const E=C.data[0];ze(!!E,16349);const _=E,I=(_==null?void 0:_.error)||((S=_[0])===null||S===void 0?void 0:S.error);if(I){Mt($s,`RPC '${t}' stream ${r} received error:`,I);const O=I.status;let P=function(R){const $=Mn[R];if($!==void 0)return FR($)}(O),D=I.message;P===void 0&&(P=_t.INTERNAL,D="Unknown error status: "+O+" with message "+I.message),y=!0,x.u_(new Ht(P,D)),p.close()}else Mt($s,`RPC '${t}' stream ${r} received:`,E),x.c_(E)}}),v(l,JN.STAT_EVENT,C=>{C.stat===Nv.PROXY?Mt($s,`RPC '${t}' stream ${r} detected buffering proxy`):C.stat===Nv.NOPROXY&&Mt($s,`RPC '${t}' stream ${r} detected no buffering proxy`)}),setTimeout(()=>{x.a_()},0),x}terminate(){this.l_.forEach(t=>t.close()),this.l_=[]}E_(t){this.l_.push(t)}d_(t){this.l_=this.l_.filter(e=>e===t)}}function J1(){return typeof document<"u"?document:null}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function u0(n){return new f6(n,!0)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class YR{constructor(t,e,s=1e3,r=1.5,i=6e4){this.xi=t,this.timerId=e,this.A_=s,this.R_=r,this.V_=i,this.m_=0,this.f_=null,this.g_=Date.now(),this.reset()}reset(){this.m_=0}p_(){this.m_=this.V_}y_(t){this.cancel();const e=Math.floor(this.m_+this.w_()),s=Math.max(0,Date.now()-this.g_),r=Math.max(0,e-s);r>0&&Mt("ExponentialBackoff",`Backing off for ${r} ms (base delay: ${this.m_} ms, delay with jitter: ${e} ms, last attempt: ${s} ms ago)`),this.f_=this.xi.enqueueAfterDelay(this.timerId,r,()=>(this.g_=Date.now(),t())),this.m_*=this.R_,this.m_<this.A_&&(this.m_=this.A_),this.m_>this.V_&&(this.m_=this.V_)}b_(){this.f_!==null&&(this.f_.skipDelay(),this.f_=null)}cancel(){this.f_!==null&&(this.f_.cancel(),this.f_=null)}w_(){return(Math.random()-.5)*this.m_}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const yk="PersistentStream";class QR{constructor(t,e,s,r,i,o,l,u){this.xi=t,this.S_=s,this.D_=r,this.connection=i,this.authCredentialsProvider=o,this.appCheckCredentialsProvider=l,this.listener=u,this.state=0,this.v_=0,this.C_=null,this.F_=null,this.stream=null,this.M_=0,this.x_=new YR(t,e)}O_(){return this.state===1||this.state===5||this.N_()}N_(){return this.state===2||this.state===3}start(){this.M_=0,this.state!==4?this.auth():this.B_()}async stop(){this.O_()&&await this.close(0)}L_(){this.state=0,this.x_.reset()}k_(){this.N_()&&this.C_===null&&(this.C_=this.xi.enqueueAfterDelay(this.S_,6e4,()=>this.q_()))}Q_(t){this.U_(),this.stream.send(t)}async q_(){if(this.N_())return this.close(0)}U_(){this.C_&&(this.C_.cancel(),this.C_=null)}K_(){this.F_&&(this.F_.cancel(),this.F_=null)}async close(t,e){this.U_(),this.K_(),this.x_.cancel(),this.v_++,t!==4?this.x_.reset():e&&e.code===_t.RESOURCE_EXHAUSTED?(Po(e.toString()),Po("Using maximum backoff delay to prevent overloading the backend."),this.x_.p_()):e&&e.code===_t.UNAUTHENTICATED&&this.state!==3&&(this.authCredentialsProvider.invalidateToken(),this.appCheckCredentialsProvider.invalidateToken()),this.stream!==null&&(this.W_(),this.stream.close(),this.stream=null),this.state=t,await this.listener.i_(e)}W_(){}auth(){this.state=1;const t=this.G_(this.v_),e=this.v_;Promise.all([this.authCredentialsProvider.getToken(),this.appCheckCredentialsProvider.getToken()]).then(([s,r])=>{this.v_===e&&this.z_(s,r)},s=>{t(()=>{const r=new Ht(_t.UNKNOWN,"Fetching auth token failed: "+s.message);return this.j_(r)})})}z_(t,e){const s=this.G_(this.v_);this.stream=this.H_(t,e),this.stream.e_(()=>{s(()=>this.listener.e_())}),this.stream.n_(()=>{s(()=>(this.state=2,this.F_=this.xi.enqueueAfterDelay(this.D_,1e4,()=>(this.N_()&&(this.state=3),Promise.resolve())),this.listener.n_()))}),this.stream.i_(r=>{s(()=>this.j_(r))}),this.stream.onMessage(r=>{s(()=>++this.M_==1?this.J_(r):this.onNext(r))})}B_(){this.state=5,this.x_.y_(async()=>{this.state=0,this.start()})}j_(t){return Mt(yk,`close with error: ${t}`),this.stream=null,this.close(4,t)}G_(t){return e=>{this.xi.enqueueAndForget(()=>this.v_===t?e():(Mt(yk,"stream callback skipped by getCloseGuardedDispatcher."),Promise.resolve()))}}}class cG extends QR{constructor(t,e,s,r,i,o){super(t,"listen_stream_connection_backoff","listen_stream_idle","health_check_timeout",e,s,r,o),this.serializer=i}H_(t,e){return this.connection.I_("Listen",t,e)}J_(t){return this.onNext(t)}onNext(t){this.x_.reset();const e=g6(this.serializer,t),s=function(i){if(!("targetChange"in i))return ee.min();const o=i.targetChange;return o.targetIds&&o.targetIds.length?ee.min():o.readTime?zi(o.readTime):ee.min()}(t);return this.listener.Y_(e,s)}Z_(t){const e={};e.database=zv(this.serializer),e.addTarget=function(i,o){let l;const u=o.target;if(l=Mv(u)?{documents:b6(i,u)}:{query:v6(i,u).gt},l.targetId=o.targetId,o.resumeToken.approximateByteSize()>0){l.resumeToken=VR(i,o.resumeToken);const h=Lv(i,o.expectedCount);h!==null&&(l.expectedCount=h)}else if(o.snapshotVersion.compareTo(ee.min())>0){l.readTime=py(i,o.snapshotVersion.toTimestamp());const h=Lv(i,o.expectedCount);h!==null&&(l.expectedCount=h)}return l}(this.serializer,t);const s=C6(this.serializer,t);s&&(e.labels=s),this.Q_(e)}X_(t){const e={};e.database=zv(this.serializer),e.removeTarget=t,this.Q_(e)}}class hG extends QR{constructor(t,e,s,r,i,o){super(t,"write_stream_connection_backoff","write_stream_idle","health_check_timeout",e,s,r,o),this.serializer=i}get ea(){return this.M_>0}start(){this.lastStreamToken=void 0,super.start()}W_(){this.ea&&this.ta([])}H_(t,e){return this.connection.I_("Write",t,e)}J_(t){return ze(!!t.streamToken,31322),this.lastStreamToken=t.streamToken,ze(!t.writeResults||t.writeResults.length===0,55816),this.listener.na()}onNext(t){ze(!!t.streamToken,12678),this.lastStreamToken=t.streamToken,this.x_.reset();const e=x6(t.writeResults,t.commitTime),s=zi(t.commitTime);return this.listener.ra(s,e)}ia(){const t={};t.database=zv(this.serializer),this.Q_(t)}ta(t){const e={streamToken:this.lastStreamToken,writes:t.map(s=>y6(this.serializer,s))};this.Q_(e)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class dG{}class fG extends dG{constructor(t,e,s,r){super(),this.authCredentials=t,this.appCheckCredentials=e,this.connection=s,this.serializer=r,this.sa=!1}oa(){if(this.sa)throw new Ht(_t.FAILED_PRECONDITION,"The client has already been terminated.")}zo(t,e,s,r){return this.oa(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(([i,o])=>this.connection.zo(t,Pv(e,s),r,i,o)).catch(i=>{throw i.name==="FirebaseError"?(i.code===_t.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),i):new Ht(_t.UNKNOWN,i.toString())})}Yo(t,e,s,r,i){return this.oa(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(([o,l])=>this.connection.Yo(t,Pv(e,s),r,o,l,i)).catch(o=>{throw o.name==="FirebaseError"?(o.code===_t.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),o):new Ht(_t.UNKNOWN,o.toString())})}terminate(){this.sa=!0,this.connection.terminate()}}class pG{constructor(t,e){this.asyncQueue=t,this.onlineStateHandler=e,this.state="Unknown",this._a=0,this.aa=null,this.ua=!0}ca(){this._a===0&&(this.la("Unknown"),this.aa=this.asyncQueue.enqueueAfterDelay("online_state_timeout",1e4,()=>(this.aa=null,this.ha("Backend didn't respond within 10 seconds."),this.la("Offline"),Promise.resolve())))}Pa(t){this.state==="Online"?this.la("Unknown"):(this._a++,this._a>=1&&(this.Ta(),this.ha(`Connection failed 1 times. Most recent error: ${t.toString()}`),this.la("Offline")))}set(t){this.Ta(),this._a=0,t==="Online"&&(this.ua=!1),this.la(t)}la(t){t!==this.state&&(this.state=t,this.onlineStateHandler(t))}ha(t){const e=`Could not reach Cloud Firestore backend. ${t}
This typically indicates that your device does not have a healthy Internet connection at the moment. The client will operate in offline mode until it is able to successfully connect to the backend.`;this.ua?(Po(e),this.ua=!1):Mt("OnlineStateTracker",e)}Ta(){this.aa!==null&&(this.aa.cancel(),this.aa=null)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Jl="RemoteStore";class mG{constructor(t,e,s,r,i){this.localStore=t,this.datastore=e,this.asyncQueue=s,this.remoteSyncer={},this.Ia=[],this.Ea=new Map,this.da=new Set,this.Aa=[],this.Ra=i,this.Ra.No(o=>{s.enqueueAndForget(async()=>{bu(this)&&(Mt(Jl,"Restarting streams for network reachability change."),await async function(u){const h=se(u);h.da.add(4),await Af(h),h.Va.set("Unknown"),h.da.delete(4),await c0(h)}(this))})}),this.Va=new pG(s,r)}}async function c0(n){if(bu(n))for(const t of n.Aa)await t(!0)}async function Af(n){for(const t of n.Aa)await t(!1)}function ZR(n,t){const e=se(n);e.Ea.has(t.targetId)||(e.Ea.set(t.targetId,t),eC(e)?tC(e):ah(e).N_()&&Jw(e,t))}function Zw(n,t){const e=se(n),s=ah(e);e.Ea.delete(t),s.N_()&&JR(e,t),e.Ea.size===0&&(s.N_()?s.k_():bu(e)&&e.Va.set("Unknown"))}function Jw(n,t){if(n.ma.Ke(t.targetId),t.resumeToken.approximateByteSize()>0||t.snapshotVersion.compareTo(ee.min())>0){const e=n.remoteSyncer.getRemoteKeysForTarget(t.targetId).size;t=t.withExpectedCount(e)}ah(n).Z_(t)}function JR(n,t){n.ma.Ke(t),ah(n).X_(t)}function tC(n){n.ma=new u6({getRemoteKeysForTarget:t=>n.remoteSyncer.getRemoteKeysForTarget(t),Rt:t=>n.Ea.get(t)||null,Pt:()=>n.datastore.serializer.databaseId}),ah(n).start(),n.Va.ca()}function eC(n){return bu(n)&&!ah(n).O_()&&n.Ea.size>0}function bu(n){return se(n).da.size===0}function t$(n){n.ma=void 0}async function gG(n){n.Va.set("Online")}async function yG(n){n.Ea.forEach((t,e)=>{Jw(n,t)})}async function xG(n,t){t$(n),eC(n)?(n.Va.Pa(t),tC(n)):n.Va.set("Unknown")}async function bG(n,t,e){if(n.Va.set("Online"),t instanceof PR&&t.state===2&&t.cause)try{await async function(r,i){const o=i.cause;for(const l of i.targetIds)r.Ea.has(l)&&(await r.remoteSyncer.rejectListen(l,o),r.Ea.delete(l),r.ma.removeTarget(l))}(n,t)}catch(s){Mt(Jl,"Failed to remove targets %s: %s ",t.targetIds.join(","),s),await gy(n,s)}else if(t instanceof Hg?n.ma.Xe(t):t instanceof LR?n.ma.ot(t):n.ma.nt(t),!e.isEqual(ee.min()))try{const s=await XR(n.localStore);e.compareTo(s)>=0&&await function(i,o){const l=i.ma.It(o);return l.targetChanges.forEach((u,h)=>{if(u.resumeToken.approximateByteSize()>0){const d=i.Ea.get(h);d&&i.Ea.set(h,d.withResumeToken(u.resumeToken,o))}}),l.targetMismatches.forEach((u,h)=>{const d=i.Ea.get(u);if(!d)return;i.Ea.set(u,d.withResumeToken(Cs.EMPTY_BYTE_STRING,d.snapshotVersion)),JR(i,u);const p=new Ea(d.target,u,h,d.sequenceNumber);Jw(i,p)}),i.remoteSyncer.applyRemoteEvent(l)}(n,e)}catch(s){Mt(Jl,"Failed to raise snapshot:",s),await gy(n,s)}}async function gy(n,t,e){if(!oh(t))throw t;n.da.add(1),await Af(n),n.Va.set("Offline"),e||(e=()=>XR(n.localStore)),n.asyncQueue.enqueueRetryable(async()=>{Mt(Jl,"Retrying IndexedDB access"),await e(),n.da.delete(1),await c0(n)})}function e$(n,t){return t().catch(e=>gy(n,e,t))}async function h0(n){const t=se(n),e=Ua(t);let s=t.Ia.length>0?t.Ia[t.Ia.length-1].batchId:Vw;for(;vG(t);)try{const r=await eG(t.localStore,s);if(r===null){t.Ia.length===0&&e.k_();break}s=r.batchId,wG(t,r)}catch(r){await gy(t,r)}n$(t)&&s$(t)}function vG(n){return bu(n)&&n.Ia.length<10}function wG(n,t){n.Ia.push(t);const e=Ua(n);e.N_()&&e.ea&&e.ta(t.mutations)}function n$(n){return bu(n)&&!Ua(n).O_()&&n.Ia.length>0}function s$(n){Ua(n).start()}async function CG(n){Ua(n).ia()}async function SG(n){const t=Ua(n);for(const e of n.Ia)t.ta(e.mutations)}async function TG(n,t,e){const s=n.Ia.shift(),r=Hw.from(s,t,e);await e$(n,()=>n.remoteSyncer.applySuccessfulWrite(r)),await h0(n)}async function EG(n,t){t&&Ua(n).ea&&await async function(s,r){if(function(o){return a6(o)&&o!==_t.ABORTED}(r.code)){const i=s.Ia.shift();Ua(s).L_(),await e$(s,()=>s.remoteSyncer.rejectFailedWrite(i.batchId,r)),await h0(s)}}(n,t),n$(n)&&s$(n)}async function xk(n,t){const e=se(n);e.asyncQueue.verifyOperationInProgress(),Mt(Jl,"RemoteStore received new credentials");const s=bu(e);e.da.add(3),await Af(e),s&&e.Va.set("Unknown"),await e.remoteSyncer.handleCredentialChange(t),e.da.delete(3),await c0(e)}async function IG(n,t){const e=se(n);t?(e.da.delete(2),await c0(e)):t||(e.da.add(2),await Af(e),e.Va.set("Unknown"))}function ah(n){return n.fa||(n.fa=function(e,s,r){const i=se(e);return i.oa(),new cG(s,i.connection,i.authCredentials,i.appCheckCredentials,i.serializer,r)}(n.datastore,n.asyncQueue,{e_:gG.bind(null,n),n_:yG.bind(null,n),i_:xG.bind(null,n),Y_:bG.bind(null,n)}),n.Aa.push(async t=>{t?(n.fa.L_(),eC(n)?tC(n):n.Va.set("Unknown")):(await n.fa.stop(),t$(n))})),n.fa}function Ua(n){return n.ga||(n.ga=function(e,s,r){const i=se(e);return i.oa(),new hG(s,i.connection,i.authCredentials,i.appCheckCredentials,i.serializer,r)}(n.datastore,n.asyncQueue,{e_:()=>Promise.resolve(),n_:CG.bind(null,n),i_:EG.bind(null,n),na:SG.bind(null,n),ra:TG.bind(null,n)}),n.Aa.push(async t=>{t?(n.ga.L_(),await h0(n)):(await n.ga.stop(),n.Ia.length>0&&(Mt(Jl,`Stopping write stream with ${n.Ia.length} pending writes`),n.Ia=[]))})),n.ga}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class nC{constructor(t,e,s,r,i){this.asyncQueue=t,this.timerId=e,this.targetTimeMs=s,this.op=r,this.removalCallback=i,this.deferred=new $a,this.then=this.deferred.promise.then.bind(this.deferred.promise),this.deferred.promise.catch(o=>{})}get promise(){return this.deferred.promise}static createAndSchedule(t,e,s,r,i){const o=Date.now()+s,l=new nC(t,e,o,r,i);return l.start(s),l}start(t){this.timerHandle=setTimeout(()=>this.handleDelayElapsed(),t)}skipDelay(){return this.handleDelayElapsed()}cancel(t){this.timerHandle!==null&&(this.clearTimeout(),this.deferred.reject(new Ht(_t.CANCELLED,"Operation cancelled"+(t?": "+t:""))))}handleDelayElapsed(){this.asyncQueue.enqueueAndForget(()=>this.timerHandle!==null?(this.clearTimeout(),this.op().then(t=>this.deferred.resolve(t))):Promise.resolve())}clearTimeout(){this.timerHandle!==null&&(this.removalCallback(this),clearTimeout(this.timerHandle),this.timerHandle=null)}}function sC(n,t){if(Po("AsyncQueue",`${t}: ${n}`),oh(n))return new Ht(_t.UNAVAILABLE,`${t}: ${n}`);throw n}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Rc{static emptySet(t){return new Rc(t.comparator)}constructor(t){this.comparator=t?(e,s)=>t(e,s)||qt.comparator(e.key,s.key):(e,s)=>qt.comparator(e.key,s.key),this.keyedMap=Pd(),this.sortedSet=new pn(this.comparator)}has(t){return this.keyedMap.get(t)!=null}get(t){return this.keyedMap.get(t)}first(){return this.sortedSet.minKey()}last(){return this.sortedSet.maxKey()}isEmpty(){return this.sortedSet.isEmpty()}indexOf(t){const e=this.keyedMap.get(t);return e?this.sortedSet.indexOf(e):-1}get size(){return this.sortedSet.size}forEach(t){this.sortedSet.inorderTraversal((e,s)=>(t(e),!1))}add(t){const e=this.delete(t.key);return e.copy(e.keyedMap.insert(t.key,t),e.sortedSet.insert(t,null))}delete(t){const e=this.get(t);return e?this.copy(this.keyedMap.remove(t),this.sortedSet.remove(e)):this}isEqual(t){if(!(t instanceof Rc)||this.size!==t.size)return!1;const e=this.sortedSet.getIterator(),s=t.sortedSet.getIterator();for(;e.hasNext();){const r=e.getNext().key,i=s.getNext().key;if(!r.isEqual(i))return!1}return!0}toString(){const t=[];return this.forEach(e=>{t.push(e.toString())}),t.length===0?"DocumentSet ()":`DocumentSet (
  `+t.join(`  
`)+`
)`}copy(t,e){const s=new Rc;return s.comparator=this.comparator,s.keyedMap=t,s.sortedSet=e,s}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class bk{constructor(){this.pa=new pn(qt.comparator)}track(t){const e=t.doc.key,s=this.pa.get(e);s?t.type!==0&&s.type===3?this.pa=this.pa.insert(e,t):t.type===3&&s.type!==1?this.pa=this.pa.insert(e,{type:s.type,doc:t.doc}):t.type===2&&s.type===2?this.pa=this.pa.insert(e,{type:2,doc:t.doc}):t.type===2&&s.type===0?this.pa=this.pa.insert(e,{type:0,doc:t.doc}):t.type===1&&s.type===0?this.pa=this.pa.remove(e):t.type===1&&s.type===2?this.pa=this.pa.insert(e,{type:1,doc:s.doc}):t.type===0&&s.type===1?this.pa=this.pa.insert(e,{type:2,doc:t.doc}):Jt(63341,{Vt:t,ya:s}):this.pa=this.pa.insert(e,t)}wa(){const t=[];return this.pa.inorderTraversal((e,s)=>{t.push(s)}),t}}class Uc{constructor(t,e,s,r,i,o,l,u,h){this.query=t,this.docs=e,this.oldDocs=s,this.docChanges=r,this.mutatedKeys=i,this.fromCache=o,this.syncStateChanged=l,this.excludesMetadataChanges=u,this.hasCachedResults=h}static fromInitialDocuments(t,e,s,r,i){const o=[];return e.forEach(l=>{o.push({type:0,doc:l})}),new Uc(t,e,Rc.emptySet(e),o,s,r,!0,!1,i)}get hasPendingWrites(){return!this.mutatedKeys.isEmpty()}isEqual(t){if(!(this.fromCache===t.fromCache&&this.hasCachedResults===t.hasCachedResults&&this.syncStateChanged===t.syncStateChanged&&this.mutatedKeys.isEqual(t.mutatedKeys)&&r0(this.query,t.query)&&this.docs.isEqual(t.docs)&&this.oldDocs.isEqual(t.oldDocs)))return!1;const e=this.docChanges,s=t.docChanges;if(e.length!==s.length)return!1;for(let r=0;r<e.length;r++)if(e[r].type!==s[r].type||!e[r].doc.isEqual(s[r].doc))return!1;return!0}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class _G{constructor(){this.ba=void 0,this.Sa=[]}Da(){return this.Sa.some(t=>t.va())}}class kG{constructor(){this.queries=vk(),this.onlineState="Unknown",this.Ca=new Set}terminate(){(function(e,s){const r=se(e),i=r.queries;r.queries=vk(),i.forEach((o,l)=>{for(const u of l.Sa)u.onError(s)})})(this,new Ht(_t.ABORTED,"Firestore shutting down"))}}function vk(){return new yu(n=>SR(n),r0)}async function AG(n,t){const e=se(n);let s=3;const r=t.query;let i=e.queries.get(r);i?!i.Da()&&t.va()&&(s=2):(i=new _G,s=t.va()?0:1);try{switch(s){case 0:i.ba=await e.onListen(r,!0);break;case 1:i.ba=await e.onListen(r,!1);break;case 2:await e.onFirstRemoteStoreListen(r)}}catch(o){const l=sC(o,`Initialization of query '${Tc(t.query)}' failed`);return void t.onError(l)}e.queries.set(r,i),i.Sa.push(t),t.Fa(e.onlineState),i.ba&&t.Ma(i.ba)&&rC(e)}async function NG(n,t){const e=se(n),s=t.query;let r=3;const i=e.queries.get(s);if(i){const o=i.Sa.indexOf(t);o>=0&&(i.Sa.splice(o,1),i.Sa.length===0?r=t.va()?0:1:!i.Da()&&t.va()&&(r=2))}switch(r){case 0:return e.queries.delete(s),e.onUnlisten(s,!0);case 1:return e.queries.delete(s),e.onUnlisten(s,!1);case 2:return e.onLastRemoteStoreUnlisten(s);default:return}}function RG(n,t){const e=se(n);let s=!1;for(const r of t){const i=r.query,o=e.queries.get(i);if(o){for(const l of o.Sa)l.Ma(r)&&(s=!0);o.ba=r}}s&&rC(e)}function $G(n,t,e){const s=se(n),r=s.queries.get(t);if(r)for(const i of r.Sa)i.onError(e);s.queries.delete(t)}function rC(n){n.Ca.forEach(t=>{t.next()})}var Gv,wk;(wk=Gv||(Gv={})).xa="default",wk.Cache="cache";class DG{constructor(t,e,s){this.query=t,this.Oa=e,this.Na=!1,this.Ba=null,this.onlineState="Unknown",this.options=s||{}}Ma(t){if(!this.options.includeMetadataChanges){const s=[];for(const r of t.docChanges)r.type!==3&&s.push(r);t=new Uc(t.query,t.docs,t.oldDocs,s,t.mutatedKeys,t.fromCache,t.syncStateChanged,!0,t.hasCachedResults)}let e=!1;return this.Na?this.La(t)&&(this.Oa.next(t),e=!0):this.ka(t,this.onlineState)&&(this.qa(t),e=!0),this.Ba=t,e}onError(t){this.Oa.error(t)}Fa(t){this.onlineState=t;let e=!1;return this.Ba&&!this.Na&&this.ka(this.Ba,t)&&(this.qa(this.Ba),e=!0),e}ka(t,e){if(!t.fromCache||!this.va())return!0;const s=e!=="Offline";return(!this.options.Qa||!s)&&(!t.docs.isEmpty()||t.hasCachedResults||e==="Offline")}La(t){if(t.docChanges.length>0)return!0;const e=this.Ba&&this.Ba.hasPendingWrites!==t.hasPendingWrites;return!(!t.syncStateChanged&&!e)&&this.options.includeMetadataChanges===!0}qa(t){t=Uc.fromInitialDocuments(t.query,t.docs,t.mutatedKeys,t.fromCache,t.hasCachedResults),this.Na=!0,this.Oa.next(t)}va(){return this.options.source!==Gv.Cache}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class r${constructor(t){this.key=t}}class i${constructor(t){this.key=t}}class OG{constructor(t,e){this.query=t,this.Ha=e,this.Ja=null,this.hasCachedResults=!1,this.current=!1,this.Ya=xe(),this.mutatedKeys=xe(),this.Za=TR(t),this.Xa=new Rc(this.Za)}get eu(){return this.Ha}tu(t,e){const s=e?e.nu:new bk,r=e?e.Xa:this.Xa;let i=e?e.mutatedKeys:this.mutatedKeys,o=r,l=!1;const u=this.query.limitType==="F"&&r.size===this.query.limit?r.last():null,h=this.query.limitType==="L"&&r.size===this.query.limit?r.first():null;if(t.inorderTraversal((d,p)=>{const m=r.get(d),y=i0(this.query,p)?p:null,x=!!m&&this.mutatedKeys.has(m.key),v=!!y&&(y.hasLocalMutations||this.mutatedKeys.has(y.key)&&y.hasCommittedMutations);let C=!1;m&&y?m.data.isEqual(y.data)?x!==v&&(s.track({type:3,doc:y}),C=!0):this.ru(m,y)||(s.track({type:2,doc:y}),C=!0,(u&&this.Za(y,u)>0||h&&this.Za(y,h)<0)&&(l=!0)):!m&&y?(s.track({type:0,doc:y}),C=!0):m&&!y&&(s.track({type:1,doc:m}),C=!0,(u||h)&&(l=!0)),C&&(y?(o=o.add(y),i=v?i.add(d):i.delete(d)):(o=o.delete(d),i=i.delete(d)))}),this.query.limit!==null)for(;o.size>this.query.limit;){const d=this.query.limitType==="F"?o.last():o.first();o=o.delete(d.key),i=i.delete(d.key),s.track({type:1,doc:d})}return{Xa:o,nu:s,Cs:l,mutatedKeys:i}}ru(t,e){return t.hasLocalMutations&&e.hasCommittedMutations&&!e.hasLocalMutations}applyChanges(t,e,s,r){const i=this.Xa;this.Xa=t.Xa,this.mutatedKeys=t.mutatedKeys;const o=t.nu.wa();o.sort((d,p)=>function(y,x){const v=C=>{switch(C){case 0:return 1;case 2:case 3:return 2;case 1:return 0;default:return Jt(20277,{Vt:C})}};return v(y)-v(x)}(d.type,p.type)||this.Za(d.doc,p.doc)),this.iu(s),r=r!=null&&r;const l=e&&!r?this.su():[],u=this.Ya.size===0&&this.current&&!r?1:0,h=u!==this.Ja;return this.Ja=u,o.length!==0||h?{snapshot:new Uc(this.query,t.Xa,i,o,t.mutatedKeys,u===0,h,!1,!!s&&s.resumeToken.approximateByteSize()>0),ou:l}:{ou:l}}Fa(t){return this.current&&t==="Offline"?(this.current=!1,this.applyChanges({Xa:this.Xa,nu:new bk,mutatedKeys:this.mutatedKeys,Cs:!1},!1)):{ou:[]}}_u(t){return!this.Ha.has(t)&&!!this.Xa.has(t)&&!this.Xa.get(t).hasLocalMutations}iu(t){t&&(t.addedDocuments.forEach(e=>this.Ha=this.Ha.add(e)),t.modifiedDocuments.forEach(e=>{}),t.removedDocuments.forEach(e=>this.Ha=this.Ha.delete(e)),this.current=t.current)}su(){if(!this.current)return[];const t=this.Ya;this.Ya=xe(),this.Xa.forEach(s=>{this._u(s.key)&&(this.Ya=this.Ya.add(s.key))});const e=[];return t.forEach(s=>{this.Ya.has(s)||e.push(new i$(s))}),this.Ya.forEach(s=>{t.has(s)||e.push(new r$(s))}),e}au(t){this.Ha=t.$s,this.Ya=xe();const e=this.tu(t.documents);return this.applyChanges(e,!0)}uu(){return Uc.fromInitialDocuments(this.query,this.Xa,this.mutatedKeys,this.Ja===0,this.hasCachedResults)}}const iC="SyncEngine";class MG{constructor(t,e,s){this.query=t,this.targetId=e,this.view=s}}class FG{constructor(t){this.key=t,this.cu=!1}}class LG{constructor(t,e,s,r,i,o){this.localStore=t,this.remoteStore=e,this.eventManager=s,this.sharedClientState=r,this.currentUser=i,this.maxConcurrentLimboResolutions=o,this.lu={},this.hu=new yu(l=>SR(l),r0),this.Pu=new Map,this.Tu=new Set,this.Iu=new pn(qt.comparator),this.Eu=new Map,this.du=new Kw,this.Au={},this.Ru=new Map,this.Vu=Bc.lr(),this.onlineState="Unknown",this.mu=void 0}get isPrimaryClient(){return this.mu===!0}}async function PG(n,t,e=!0){const s=h$(n);let r;const i=s.hu.get(t);return i?(s.sharedClientState.addLocalQueryTarget(i.targetId),r=i.view.uu()):r=await o$(s,t,e,!0),r}async function VG(n,t){const e=h$(n);await o$(e,t,!0,!1)}async function o$(n,t,e,s){const r=await nG(n.localStore,Vi(t)),i=r.targetId,o=n.sharedClientState.addLocalQueryTarget(i,e);let l;return s&&(l=await zG(n,t,i,o==="current",r.resumeToken)),n.isPrimaryClient&&e&&ZR(n.remoteStore,r),l}async function zG(n,t,e,s,r){n.fu=(p,m,y)=>async function(v,C,S,E){let _=C.view.tu(S);_.Cs&&(_=await fk(v.localStore,C.query,!1).then(({documents:D})=>C.view.tu(D,_)));const I=E&&E.targetChanges.get(C.targetId),O=E&&E.targetMismatches.get(C.targetId)!=null,P=C.view.applyChanges(_,v.isPrimaryClient,I,O);return Sk(v,C.targetId,P.ou),P.snapshot}(n,p,m,y);const i=await fk(n.localStore,t,!0),o=new OG(t,i.$s),l=o.tu(i.documents),u=kf.createSynthesizedTargetChangeForCurrentChange(e,s&&n.onlineState!=="Offline",r),h=o.applyChanges(l,n.isPrimaryClient,u);Sk(n,e,h.ou);const d=new MG(t,e,o);return n.hu.set(t,d),n.Pu.has(e)?n.Pu.get(e).push(t):n.Pu.set(e,[t]),h.snapshot}async function BG(n,t,e){const s=se(n),r=s.hu.get(t),i=s.Pu.get(r.targetId);if(i.length>1)return s.Pu.set(r.targetId,i.filter(o=>!r0(o,t))),void s.hu.delete(t);s.isPrimaryClient?(s.sharedClientState.removeLocalQueryTarget(r.targetId),s.sharedClientState.isActiveQueryTarget(r.targetId)||await Bv(s.localStore,r.targetId,!1).then(()=>{s.sharedClientState.clearQueryState(r.targetId),e&&Zw(s.remoteStore,r.targetId),Wv(s,r.targetId)}).catch(ih)):(Wv(s,r.targetId),await Bv(s.localStore,r.targetId,!0))}async function UG(n,t){const e=se(n),s=e.hu.get(t),r=e.Pu.get(s.targetId);e.isPrimaryClient&&r.length===1&&(e.sharedClientState.removeLocalQueryTarget(s.targetId),Zw(e.remoteStore,s.targetId))}async function GG(n,t,e){const s=YG(n);try{const r=await function(o,l){const u=se(o),h=Jn.now(),d=l.reduce((y,x)=>y.add(x.key),xe());let p,m;return u.persistence.runTransaction("Locally write mutations","readwrite",y=>{let x=Vo(),v=xe();return u.Bs.getEntries(y,d).next(C=>{x=C,x.forEach((S,E)=>{E.isValidDocument()||(v=v.add(S))})}).next(()=>u.localDocuments.getOverlayedDocuments(y,x)).next(C=>{p=C;const S=[];for(const E of l){const _=n6(E,p.get(E.key).overlayedDocument);_!=null&&S.push(new xu(E.key,_,mR(_.value.mapValue),Mo.exists(!0)))}return u.mutationQueue.addMutationBatch(y,h,S,l)}).next(C=>{m=C;const S=C.applyToLocalDocumentSet(p,v);return u.documentOverlayCache.saveOverlays(y,C.batchId,S)})}).then(()=>({batchId:m.batchId,changes:IR(p)}))}(s.localStore,t);s.sharedClientState.addPendingMutation(r.batchId),function(o,l,u){let h=o.Au[o.currentUser.toKey()];h||(h=new pn(he)),h=h.insert(l,u),o.Au[o.currentUser.toKey()]=h}(s,r.batchId,e),await Nf(s,r.changes),await h0(s.remoteStore)}catch(r){const i=sC(r,"Failed to persist write");e.reject(i)}}async function a$(n,t){const e=se(n);try{const s=await J6(e.localStore,t);t.targetChanges.forEach((r,i)=>{const o=e.Eu.get(i);o&&(ze(r.addedDocuments.size+r.modifiedDocuments.size+r.removedDocuments.size<=1,22616),r.addedDocuments.size>0?o.cu=!0:r.modifiedDocuments.size>0?ze(o.cu,14607):r.removedDocuments.size>0&&(ze(o.cu,42227),o.cu=!1))}),await Nf(e,s,t)}catch(s){await ih(s)}}function Ck(n,t,e){const s=se(n);if(s.isPrimaryClient&&e===0||!s.isPrimaryClient&&e===1){const r=[];s.hu.forEach((i,o)=>{const l=o.view.Fa(t);l.snapshot&&r.push(l.snapshot)}),function(o,l){const u=se(o);u.onlineState=l;let h=!1;u.queries.forEach((d,p)=>{for(const m of p.Sa)m.Fa(l)&&(h=!0)}),h&&rC(u)}(s.eventManager,t),r.length&&s.lu.Y_(r),s.onlineState=t,s.isPrimaryClient&&s.sharedClientState.setOnlineState(t)}}async function WG(n,t,e){const s=se(n);s.sharedClientState.updateQueryState(t,"rejected",e);const r=s.Eu.get(t),i=r&&r.key;if(i){let o=new pn(qt.comparator);o=o.insert(i,Ms.newNoDocument(i,ee.min()));const l=xe().add(i),u=new l0(ee.min(),new Map,new pn(he),o,l);await a$(s,u),s.Iu=s.Iu.remove(i),s.Eu.delete(t),oC(s)}else await Bv(s.localStore,t,!1).then(()=>Wv(s,t,e)).catch(ih)}async function HG(n,t){const e=se(n),s=t.batch.batchId;try{const r=await Z6(e.localStore,t);u$(e,s,null),l$(e,s),e.sharedClientState.updateMutationState(s,"acknowledged"),await Nf(e,r)}catch(r){await ih(r)}}async function qG(n,t,e){const s=se(n);try{const r=await function(o,l){const u=se(o);return u.persistence.runTransaction("Reject batch","readwrite-primary",h=>{let d;return u.mutationQueue.lookupMutationBatch(h,l).next(p=>(ze(p!==null,37113),d=p.keys(),u.mutationQueue.removeMutationBatch(h,p))).next(()=>u.mutationQueue.performConsistencyCheck(h)).next(()=>u.documentOverlayCache.removeOverlaysForBatchId(h,d,l)).next(()=>u.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(h,d)).next(()=>u.localDocuments.getDocuments(h,d))})}(s.localStore,t);u$(s,t,e),l$(s,t),s.sharedClientState.updateMutationState(t,"rejected",e),await Nf(s,r)}catch(r){await ih(r)}}function l$(n,t){(n.Ru.get(t)||[]).forEach(e=>{e.resolve()}),n.Ru.delete(t)}function u$(n,t,e){const s=se(n);let r=s.Au[s.currentUser.toKey()];if(r){const i=r.get(t);i&&(e?i.reject(e):i.resolve(),r=r.remove(t)),s.Au[s.currentUser.toKey()]=r}}function Wv(n,t,e=null){n.sharedClientState.removeLocalQueryTarget(t);for(const s of n.Pu.get(t))n.hu.delete(s),e&&n.lu.gu(s,e);n.Pu.delete(t),n.isPrimaryClient&&n.du.Hr(t).forEach(s=>{n.du.containsKey(s)||c$(n,s)})}function c$(n,t){n.Tu.delete(t.path.canonicalString());const e=n.Iu.get(t);e!==null&&(Zw(n.remoteStore,e),n.Iu=n.Iu.remove(t),n.Eu.delete(e),oC(n))}function Sk(n,t,e){for(const s of e)s instanceof r$?(n.du.addReference(s.key,t),jG(n,s)):s instanceof i$?(Mt(iC,"Document no longer in limbo: "+s.key),n.du.removeReference(s.key,t),n.du.containsKey(s.key)||c$(n,s.key)):Jt(19791,{pu:s})}function jG(n,t){const e=t.key,s=e.path.canonicalString();n.Iu.get(e)||n.Tu.has(s)||(Mt(iC,"New document in limbo: "+e),n.Tu.add(s),oC(n))}function oC(n){for(;n.Tu.size>0&&n.Iu.size<n.maxConcurrentLimboResolutions;){const t=n.Tu.values().next().value;n.Tu.delete(t);const e=new qt(un.fromString(t)),s=n.Vu.next();n.Eu.set(s,new FG(e)),n.Iu=n.Iu.insert(e,s),ZR(n.remoteStore,new Ea(Vi(CR(e.path)),s,"TargetPurposeLimboResolution",t0.le))}}async function Nf(n,t,e){const s=se(n),r=[],i=[],o=[];s.hu.isEmpty()||(s.hu.forEach((l,u)=>{o.push(s.fu(u,t,e).then(h=>{var d;if((h||e)&&s.isPrimaryClient){const p=h?!h.fromCache:(d=e==null?void 0:e.targetChanges.get(u.targetId))===null||d===void 0?void 0:d.current;s.sharedClientState.updateQueryState(u.targetId,p?"current":"not-current")}if(h){r.push(h);const p=Yw.Rs(u.targetId,h);i.push(p)}}))}),await Promise.all(o),s.lu.Y_(r),await async function(u,h){const d=se(u);try{await d.persistence.runTransaction("notifyLocalViewChanges","readwrite",p=>Et.forEach(h,m=>Et.forEach(m.ds,y=>d.persistence.referenceDelegate.addReference(p,m.targetId,y)).next(()=>Et.forEach(m.As,y=>d.persistence.referenceDelegate.removeReference(p,m.targetId,y)))))}catch(p){if(!oh(p))throw p;Mt(Qw,"Failed to update sequence numbers: "+p)}for(const p of h){const m=p.targetId;if(!p.fromCache){const y=d.xs.get(m),x=y.snapshotVersion,v=y.withLastLimboFreeSnapshotVersion(x);d.xs=d.xs.insert(m,v)}}}(s.localStore,i))}async function KG(n,t){const e=se(n);if(!e.currentUser.isEqual(t)){Mt(iC,"User change. New user:",t.toKey());const s=await KR(e.localStore,t);e.currentUser=t,function(i,o){i.Ru.forEach(l=>{l.forEach(u=>{u.reject(new Ht(_t.CANCELLED,o))})}),i.Ru.clear()}(e,"'waitForPendingWrites' promise is rejected due to a user change."),e.sharedClientState.handleUserChange(t,s.removedBatchIds,s.addedBatchIds),await Nf(e,s.ks)}}function XG(n,t){const e=se(n),s=e.Eu.get(t);if(s&&s.cu)return xe().add(s.key);{let r=xe();const i=e.Pu.get(t);if(!i)return r;for(const o of i){const l=e.hu.get(o);r=r.unionWith(l.view.eu)}return r}}function h$(n){const t=se(n);return t.remoteStore.remoteSyncer.applyRemoteEvent=a$.bind(null,t),t.remoteStore.remoteSyncer.getRemoteKeysForTarget=XG.bind(null,t),t.remoteStore.remoteSyncer.rejectListen=WG.bind(null,t),t.lu.Y_=RG.bind(null,t.eventManager),t.lu.gu=$G.bind(null,t.eventManager),t}function YG(n){const t=se(n);return t.remoteStore.remoteSyncer.applySuccessfulWrite=HG.bind(null,t),t.remoteStore.remoteSyncer.rejectFailedWrite=qG.bind(null,t),t}class yy{constructor(){this.kind="memory",this.synchronizeTabs=!1}async initialize(t){this.serializer=u0(t.databaseInfo.databaseId),this.sharedClientState=this.bu(t),this.persistence=this.Su(t),await this.persistence.start(),this.localStore=this.Du(t),this.gcScheduler=this.vu(t,this.localStore),this.indexBackfillerScheduler=this.Cu(t,this.localStore)}vu(t,e){return null}Cu(t,e){return null}Du(t){return Q6(this.persistence,new K6,t.initialUser,this.serializer)}Su(t){return new jR(Xw.fi,this.serializer)}bu(t){return new rG}async terminate(){var t,e;(t=this.gcScheduler)===null||t===void 0||t.stop(),(e=this.indexBackfillerScheduler)===null||e===void 0||e.stop(),this.sharedClientState.shutdown(),await this.persistence.shutdown()}}yy.provider={build:()=>new yy};class QG extends yy{constructor(t){super(),this.cacheSizeBytes=t}vu(t,e){ze(this.persistence.referenceDelegate instanceof my,46915);const s=this.persistence.referenceDelegate.garbageCollector;return new D6(s,t.asyncQueue,e)}Su(t){const e=this.cacheSizeBytes!==void 0?ir.withCacheSize(this.cacheSizeBytes):ir.DEFAULT;return new jR(s=>my.fi(s,e),this.serializer)}}class Hv{async initialize(t,e){this.localStore||(this.localStore=t.localStore,this.sharedClientState=t.sharedClientState,this.datastore=this.createDatastore(e),this.remoteStore=this.createRemoteStore(e),this.eventManager=this.createEventManager(e),this.syncEngine=this.createSyncEngine(e,!t.synchronizeTabs),this.sharedClientState.onlineStateHandler=s=>Ck(this.syncEngine,s,1),this.remoteStore.remoteSyncer.handleCredentialChange=KG.bind(null,this.syncEngine),await IG(this.remoteStore,this.syncEngine.isPrimaryClient))}createEventManager(t){return function(){return new kG}()}createDatastore(t){const e=u0(t.databaseInfo.databaseId),s=function(i){return new uG(i)}(t.databaseInfo);return function(i,o,l,u){return new fG(i,o,l,u)}(t.authCredentials,t.appCheckCredentials,s,e)}createRemoteStore(t){return function(s,r,i,o,l){return new mG(s,r,i,o,l)}(this.localStore,this.datastore,t.asyncQueue,e=>Ck(this.syncEngine,e,0),function(){return gk.C()?new gk:new iG}())}createSyncEngine(t,e){return function(r,i,o,l,u,h,d){const p=new LG(r,i,o,l,u,h);return d&&(p.mu=!0),p}(this.localStore,this.remoteStore,this.eventManager,this.sharedClientState,t.initialUser,t.maxConcurrentLimboResolutions,e)}async terminate(){var t,e;await async function(r){const i=se(r);Mt(Jl,"RemoteStore shutting down."),i.da.add(5),await Af(i),i.Ra.shutdown(),i.Va.set("Unknown")}(this.remoteStore),(t=this.datastore)===null||t===void 0||t.terminate(),(e=this.eventManager)===null||e===void 0||e.terminate()}}Hv.provider={build:()=>new Hv};/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *//**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ZG{constructor(t){this.observer=t,this.muted=!1}next(t){this.muted||this.observer.next&&this.Mu(this.observer.next,t)}error(t){this.muted||(this.observer.error?this.Mu(this.observer.error,t):Po("Uncaught Error in snapshot listener:",t.toString()))}xu(){this.muted=!0}Mu(t,e){setTimeout(()=>{this.muted||t(e)},0)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Ga="FirestoreClient";class JG{constructor(t,e,s,r,i){this.authCredentials=t,this.appCheckCredentials=e,this.asyncQueue=s,this.databaseInfo=r,this.user=Ds.UNAUTHENTICATED,this.clientId=iR.newId(),this.authCredentialListener=()=>Promise.resolve(),this.appCheckCredentialListener=()=>Promise.resolve(),this._uninitializedComponentsProvider=i,this.authCredentials.start(s,async o=>{Mt(Ga,"Received user=",o.uid),await this.authCredentialListener(o),this.user=o}),this.appCheckCredentials.start(s,o=>(Mt(Ga,"Received new app check token=",o),this.appCheckCredentialListener(o,this.user)))}get configuration(){return{asyncQueue:this.asyncQueue,databaseInfo:this.databaseInfo,clientId:this.clientId,authCredentials:this.authCredentials,appCheckCredentials:this.appCheckCredentials,initialUser:this.user,maxConcurrentLimboResolutions:100}}setCredentialChangeListener(t){this.authCredentialListener=t}setAppCheckTokenChangeListener(t){this.appCheckCredentialListener=t}terminate(){this.asyncQueue.enterRestrictedMode();const t=new $a;return this.asyncQueue.enqueueAndForgetEvenWhileRestricted(async()=>{try{this._onlineComponents&&await this._onlineComponents.terminate(),this._offlineComponents&&await this._offlineComponents.terminate(),this.authCredentials.shutdown(),this.appCheckCredentials.shutdown(),t.resolve()}catch(e){const s=sC(e,"Failed to shutdown persistence");t.reject(s)}}),t.promise}}async function tv(n,t){n.asyncQueue.verifyOperationInProgress(),Mt(Ga,"Initializing OfflineComponentProvider");const e=n.configuration;await t.initialize(e);let s=e.initialUser;n.setCredentialChangeListener(async r=>{s.isEqual(r)||(await KR(t.localStore,r),s=r)}),t.persistence.setDatabaseDeletedListener(()=>n.terminate()),n._offlineComponents=t}async function Tk(n,t){n.asyncQueue.verifyOperationInProgress();const e=await tW(n);Mt(Ga,"Initializing OnlineComponentProvider"),await t.initialize(e,n.configuration),n.setCredentialChangeListener(s=>xk(t.remoteStore,s)),n.setAppCheckTokenChangeListener((s,r)=>xk(t.remoteStore,r)),n._onlineComponents=t}async function tW(n){if(!n._offlineComponents)if(n._uninitializedComponentsProvider){Mt(Ga,"Using user provided OfflineComponentProvider");try{await tv(n,n._uninitializedComponentsProvider._offline)}catch(t){const e=t;if(!function(r){return r.name==="FirebaseError"?r.code===_t.FAILED_PRECONDITION||r.code===_t.UNIMPLEMENTED:!(typeof DOMException<"u"&&r instanceof DOMException)||r.code===22||r.code===20||r.code===11}(e))throw e;Lc("Error using user provided cache. Falling back to memory cache: "+e),await tv(n,new yy)}}else Mt(Ga,"Using default OfflineComponentProvider"),await tv(n,new QG(void 0));return n._offlineComponents}async function d$(n){return n._onlineComponents||(n._uninitializedComponentsProvider?(Mt(Ga,"Using user provided OnlineComponentProvider"),await Tk(n,n._uninitializedComponentsProvider._online)):(Mt(Ga,"Using default OnlineComponentProvider"),await Tk(n,new Hv))),n._onlineComponents}function eW(n){return d$(n).then(t=>t.syncEngine)}async function nW(n){const t=await d$(n),e=t.eventManager;return e.onListen=PG.bind(null,t.syncEngine),e.onUnlisten=BG.bind(null,t.syncEngine),e.onFirstRemoteStoreListen=VG.bind(null,t.syncEngine),e.onLastRemoteStoreUnlisten=UG.bind(null,t.syncEngine),e}function sW(n,t,e={}){const s=new $a;return n.asyncQueue.enqueueAndForget(async()=>function(i,o,l,u,h){const d=new ZG({next:m=>{d.xu(),o.enqueueAndForget(()=>NG(i,p)),m.fromCache&&u.source==="server"?h.reject(new Ht(_t.UNAVAILABLE,'Failed to get documents from server. (However, these documents may exist in the local cache. Run again without setting source to "server" to retrieve the cached documents.)')):h.resolve(m)},error:m=>h.reject(m)}),p=new DG(l,d,{includeMetadataChanges:!0,Qa:!0});return AG(i,p)}(await nW(n),n.asyncQueue,t,e,s)),s.promise}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function f$(n){const t={};return n.timeoutSeconds!==void 0&&(t.timeoutSeconds=n.timeoutSeconds),t}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Ek=new Map;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function p$(n,t,e){if(!e)throw new Ht(_t.INVALID_ARGUMENT,`Function ${n}() cannot be called with an empty ${t}.`)}function rW(n,t,e,s){if(t===!0&&s===!0)throw new Ht(_t.INVALID_ARGUMENT,`${n} and ${e} cannot be used together.`)}function Ik(n){if(!qt.isDocumentKey(n))throw new Ht(_t.INVALID_ARGUMENT,`Invalid document reference. Document references must have an even number of segments, but ${n} has ${n.length}.`)}function _k(n){if(qt.isDocumentKey(n))throw new Ht(_t.INVALID_ARGUMENT,`Invalid collection reference. Collection references must have an odd number of segments, but ${n} has ${n.length}.`)}function aC(n){if(n===void 0)return"undefined";if(n===null)return"null";if(typeof n=="string")return n.length>20&&(n=`${n.substring(0,20)}...`),JSON.stringify(n);if(typeof n=="number"||typeof n=="boolean")return""+n;if(typeof n=="object"){if(n instanceof Array)return"an array";{const t=function(s){return s.constructor?s.constructor.name:null}(n);return t?`a custom ${t} object`:"an object"}}return typeof n=="function"?"a function":Jt(12329,{type:typeof n})}function xy(n,t){if("_delegate"in n&&(n=n._delegate),!(n instanceof t)){if(t.name===n.constructor.name)throw new Ht(_t.INVALID_ARGUMENT,"Type does not match the expected instance. Did you pass a reference from a different Firestore SDK?");{const e=aC(n);throw new Ht(_t.INVALID_ARGUMENT,`Expected type '${t.name}', but it was: ${e}`)}}return n}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const m$="firestore.googleapis.com",kk=!0;class Ak{constructor(t){var e,s;if(t.host===void 0){if(t.ssl!==void 0)throw new Ht(_t.INVALID_ARGUMENT,"Can't provide ssl option if host option is not set");this.host=m$,this.ssl=kk}else this.host=t.host,this.ssl=(e=t.ssl)!==null&&e!==void 0?e:kk;if(this.isUsingEmulator=t.emulatorOptions!==void 0,this.credentials=t.credentials,this.ignoreUndefinedProperties=!!t.ignoreUndefinedProperties,this.localCache=t.localCache,t.cacheSizeBytes===void 0)this.cacheSizeBytes=qR;else{if(t.cacheSizeBytes!==-1&&t.cacheSizeBytes<R6)throw new Ht(_t.INVALID_ARGUMENT,"cacheSizeBytes must be at least 1048576");this.cacheSizeBytes=t.cacheSizeBytes}rW("experimentalForceLongPolling",t.experimentalForceLongPolling,"experimentalAutoDetectLongPolling",t.experimentalAutoDetectLongPolling),this.experimentalForceLongPolling=!!t.experimentalForceLongPolling,this.experimentalForceLongPolling?this.experimentalAutoDetectLongPolling=!1:t.experimentalAutoDetectLongPolling===void 0?this.experimentalAutoDetectLongPolling=!0:this.experimentalAutoDetectLongPolling=!!t.experimentalAutoDetectLongPolling,this.experimentalLongPollingOptions=f$((s=t.experimentalLongPollingOptions)!==null&&s!==void 0?s:{}),function(i){if(i.timeoutSeconds!==void 0){if(isNaN(i.timeoutSeconds))throw new Ht(_t.INVALID_ARGUMENT,`invalid long polling timeout: ${i.timeoutSeconds} (must not be NaN)`);if(i.timeoutSeconds<5)throw new Ht(_t.INVALID_ARGUMENT,`invalid long polling timeout: ${i.timeoutSeconds} (minimum allowed value is 5)`);if(i.timeoutSeconds>30)throw new Ht(_t.INVALID_ARGUMENT,`invalid long polling timeout: ${i.timeoutSeconds} (maximum allowed value is 30)`)}}(this.experimentalLongPollingOptions),this.useFetchStreams=!!t.useFetchStreams}isEqual(t){return this.host===t.host&&this.ssl===t.ssl&&this.credentials===t.credentials&&this.cacheSizeBytes===t.cacheSizeBytes&&this.experimentalForceLongPolling===t.experimentalForceLongPolling&&this.experimentalAutoDetectLongPolling===t.experimentalAutoDetectLongPolling&&function(s,r){return s.timeoutSeconds===r.timeoutSeconds}(this.experimentalLongPollingOptions,t.experimentalLongPollingOptions)&&this.ignoreUndefinedProperties===t.ignoreUndefinedProperties&&this.useFetchStreams===t.useFetchStreams}}class d0{constructor(t,e,s,r){this._authCredentials=t,this._appCheckCredentials=e,this._databaseId=s,this._app=r,this.type="firestore-lite",this._persistenceKey="(lite)",this._settings=new Ak({}),this._settingsFrozen=!1,this._emulatorOptions={},this._terminateTask="notTerminated"}get app(){if(!this._app)throw new Ht(_t.FAILED_PRECONDITION,"Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._app}get _initialized(){return this._settingsFrozen}get _terminated(){return this._terminateTask!=="notTerminated"}_setSettings(t){if(this._settingsFrozen)throw new Ht(_t.FAILED_PRECONDITION,"Firestore has already been started and its settings can no longer be changed. You can only modify settings before calling any other methods on a Firestore object.");this._settings=new Ak(t),this._emulatorOptions=t.emulatorOptions||{},t.credentials!==void 0&&(this._authCredentials=function(s){if(!s)return new aU;switch(s.type){case"firstParty":return new hU(s.sessionIndex||"0",s.iamToken||null,s.authTokenFactory||null);case"provider":return s.client;default:throw new Ht(_t.INVALID_ARGUMENT,"makeAuthCredentialsProvider failed due to invalid credential type")}}(t.credentials))}_getSettings(){return this._settings}_getEmulatorOptions(){return this._emulatorOptions}_freezeSettings(){return this._settingsFrozen=!0,this._settings}_delete(){return this._terminateTask==="notTerminated"&&(this._terminateTask=this._terminate()),this._terminateTask}async _restart(){this._terminateTask==="notTerminated"?await this._terminate():this._terminateTask="notTerminated"}toJSON(){return{app:this._app,databaseId:this._databaseId,settings:this._settings}}_terminate(){return function(e){const s=Ek.get(e);s&&(Mt("ComponentProvider","Removing Datastore"),Ek.delete(e),s.terminate())}(this),Promise.resolve()}}function iW(n,t,e,s={}){var r;n=xy(n,d0);const i=Fw(t),o=n._getSettings(),l=Object.assign(Object.assign({},o),{emulatorOptions:n._getEmulatorOptions()}),u=`${t}:${e}`;i&&(Fz(`https://${u}`),zz("Firestore",!0)),o.host!==m$&&o.host!==u&&Lc("Host has been set in both settings() and connectFirestoreEmulator(), emulator host will be used.");const h=Object.assign(Object.assign({},o),{host:u,ssl:i,emulatorOptions:s});if(!ry(h,l)&&(n._setSettings(h),s.mockUserToken)){let d,p;if(typeof s.mockUserToken=="string")d=s.mockUserToken,p=Ds.MOCK_USER;else{d=Lz(s.mockUserToken,(r=n._app)===null||r===void 0?void 0:r.options.projectId);const m=s.mockUserToken.sub||s.mockUserToken.user_id;if(!m)throw new Ht(_t.INVALID_ARGUMENT,"mockUserToken must contain 'sub' or 'user_id' field!");p=new Ds(m)}n._authCredentials=new lU(new sR(d,p))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class f0{constructor(t,e,s){this.converter=e,this._query=s,this.type="query",this.firestore=t}withConverter(t){return new f0(this.firestore,t,this._query)}}class li{constructor(t,e,s){this.converter=e,this._key=s,this.type="document",this.firestore=t}get _path(){return this._key.path}get id(){return this._key.path.lastSegment()}get path(){return this._key.path.canonicalString()}get parent(){return new Da(this.firestore,this.converter,this._key.path.popLast())}withConverter(t){return new li(this.firestore,t,this._key)}}class Da extends f0{constructor(t,e,s){super(t,e,CR(s)),this._path=s,this.type="collection"}get id(){return this._query.path.lastSegment()}get path(){return this._query.path.canonicalString()}get parent(){const t=this._path.popLast();return t.isEmpty()?null:new li(this.firestore,null,new qt(t))}withConverter(t){return new Da(this.firestore,t,this._path)}}function g$(n,t,...e){if(n=ef(n),p$("collection","path",t),n instanceof d0){const s=un.fromString(t,...e);return _k(s),new Da(n,null,s)}{if(!(n instanceof li||n instanceof Da))throw new Ht(_t.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");const s=n._path.child(un.fromString(t,...e));return _k(s),new Da(n.firestore,null,s)}}function oW(n,t,...e){if(n=ef(n),arguments.length===1&&(t=iR.newId()),p$("doc","path",t),n instanceof d0){const s=un.fromString(t,...e);return Ik(s),new li(n,null,new qt(s))}{if(!(n instanceof li||n instanceof Da))throw new Ht(_t.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");const s=n._path.child(un.fromString(t,...e));return Ik(s),new li(n.firestore,n instanceof Da?n.converter:null,new qt(s))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Nk="AsyncQueue";class Rk{constructor(t=Promise.resolve()){this.Ju=[],this.Yu=!1,this.Zu=[],this.Xu=null,this.ec=!1,this.tc=!1,this.nc=[],this.x_=new YR(this,"async_queue_retry"),this.rc=()=>{const s=J1();s&&Mt(Nk,"Visibility state changed to "+s.visibilityState),this.x_.b_()},this.sc=t;const e=J1();e&&typeof e.addEventListener=="function"&&e.addEventListener("visibilitychange",this.rc)}get isShuttingDown(){return this.Yu}enqueueAndForget(t){this.enqueue(t)}enqueueAndForgetEvenWhileRestricted(t){this.oc(),this._c(t)}enterRestrictedMode(t){if(!this.Yu){this.Yu=!0,this.tc=t||!1;const e=J1();e&&typeof e.removeEventListener=="function"&&e.removeEventListener("visibilitychange",this.rc)}}enqueue(t){if(this.oc(),this.Yu)return new Promise(()=>{});const e=new $a;return this._c(()=>this.Yu&&this.tc?Promise.resolve():(t().then(e.resolve,e.reject),e.promise)).then(()=>e.promise)}enqueueRetryable(t){this.enqueueAndForget(()=>(this.Ju.push(t),this.ac()))}async ac(){if(this.Ju.length!==0){try{await this.Ju[0](),this.Ju.shift(),this.x_.reset()}catch(t){if(!oh(t))throw t;Mt(Nk,"Operation failed with retryable error: "+t)}this.Ju.length>0&&this.x_.y_(()=>this.ac())}}_c(t){const e=this.sc.then(()=>(this.ec=!0,t().catch(s=>{throw this.Xu=s,this.ec=!1,Po("INTERNAL UNHANDLED ERROR: ",$k(s)),s}).then(s=>(this.ec=!1,s))));return this.sc=e,e}enqueueAfterDelay(t,e,s){this.oc(),this.nc.indexOf(t)>-1&&(e=0);const r=nC.createAndSchedule(this,t,e,s,i=>this.uc(i));return this.Zu.push(r),r}oc(){this.Xu&&Jt(47125,{cc:$k(this.Xu)})}verifyOperationInProgress(){}async lc(){let t;do t=this.sc,await t;while(t!==this.sc)}hc(t){for(const e of this.Zu)if(e.timerId===t)return!0;return!1}Pc(t){return this.lc().then(()=>{this.Zu.sort((e,s)=>e.targetTimeMs-s.targetTimeMs);for(const e of this.Zu)if(e.skipDelay(),t!=="all"&&e.timerId===t)break;return this.lc()})}Tc(t){this.nc.push(t)}uc(t){const e=this.Zu.indexOf(t);this.Zu.splice(e,1)}}function $k(n){let t=n.message||"";return n.stack&&(t=n.stack.includes(n.message)?n.stack:n.message+`
`+n.stack),t}class lC extends d0{constructor(t,e,s,r){super(t,e,s,r),this.type="firestore",this._queue=new Rk,this._persistenceKey=(r==null?void 0:r.name)||"[DEFAULT]"}async _terminate(){if(this._firestoreClient){const t=this._firestoreClient.terminate();this._queue=new Rk(t),this._firestoreClient=void 0,await t}}}function aW(n,t){const e=typeof n=="object"?n:YB(),s=typeof n=="string"?n:ly,r=HB(e,"firestore").getImmediate({identifier:s});if(!r._initialized){const i=Oz("firestore");i&&iW(r,...i)}return r}function y$(n){if(n._terminated)throw new Ht(_t.FAILED_PRECONDITION,"The client has already been terminated.");return n._firestoreClient||lW(n),n._firestoreClient}function lW(n){var t,e,s;const r=n._freezeSettings(),i=function(l,u,h,d){return new IU(l,u,h,d.host,d.ssl,d.experimentalForceLongPolling,d.experimentalAutoDetectLongPolling,f$(d.experimentalLongPollingOptions),d.useFetchStreams,d.isUsingEmulator)}(n._databaseId,((t=n._app)===null||t===void 0?void 0:t.options.appId)||"",n._persistenceKey,r);n._componentsProvider||!((e=r.localCache)===null||e===void 0)&&e._offlineComponentProvider&&(!((s=r.localCache)===null||s===void 0)&&s._onlineComponentProvider)&&(n._componentsProvider={_offline:r.localCache._offlineComponentProvider,_online:r.localCache._onlineComponentProvider}),n._firestoreClient=new JG(n._authCredentials,n._appCheckCredentials,n._queue,i,n._componentsProvider&&function(l){const u=l==null?void 0:l._online.build();return{_offline:l==null?void 0:l._offline.build(u),_online:u}}(n._componentsProvider))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Gc{constructor(t){this._byteString=t}static fromBase64String(t){try{return new Gc(Cs.fromBase64String(t))}catch(e){throw new Ht(_t.INVALID_ARGUMENT,"Failed to construct data from Base64 string: "+e)}}static fromUint8Array(t){return new Gc(Cs.fromUint8Array(t))}toBase64(){return this._byteString.toBase64()}toUint8Array(){return this._byteString.toUint8Array()}toString(){return"Bytes(base64: "+this.toBase64()+")"}isEqual(t){return this._byteString.isEqual(t._byteString)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class uC{constructor(...t){for(let e=0;e<t.length;++e)if(t[e].length===0)throw new Ht(_t.INVALID_ARGUMENT,"Invalid field name at argument $(i + 1). Field names must not be empty.");this._internalPath=new ws(t)}isEqual(t){return this._internalPath.isEqual(t._internalPath)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class x${constructor(t){this._methodName=t}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class cC{constructor(t,e){if(!isFinite(t)||t<-90||t>90)throw new Ht(_t.INVALID_ARGUMENT,"Latitude must be a number between -90 and 90, but was: "+t);if(!isFinite(e)||e<-180||e>180)throw new Ht(_t.INVALID_ARGUMENT,"Longitude must be a number between -180 and 180, but was: "+e);this._lat=t,this._long=e}get latitude(){return this._lat}get longitude(){return this._long}isEqual(t){return this._lat===t._lat&&this._long===t._long}toJSON(){return{latitude:this._lat,longitude:this._long}}_compareTo(t){return he(this._lat,t._lat)||he(this._long,t._long)}}/**
 * @license
 * Copyright 2024 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class hC{constructor(t){this._values=(t||[]).map(e=>e)}toArray(){return this._values.map(t=>t)}isEqual(t){return function(s,r){if(s.length!==r.length)return!1;for(let i=0;i<s.length;++i)if(s[i]!==r[i])return!1;return!0}(this._values,t._values)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const uW=/^__.*__$/;class cW{constructor(t,e,s){this.data=t,this.fieldMask=e,this.fieldTransforms=s}toMutation(t,e){return this.fieldMask!==null?new xu(t,this.data,this.fieldMask,e,this.fieldTransforms):new _f(t,this.data,e,this.fieldTransforms)}}function b$(n){switch(n){case 0:case 2:case 1:return!0;case 3:case 4:return!1;default:throw Jt(40011,{Ic:n})}}class dC{constructor(t,e,s,r,i,o){this.settings=t,this.databaseId=e,this.serializer=s,this.ignoreUndefinedProperties=r,i===void 0&&this.Ec(),this.fieldTransforms=i||[],this.fieldMask=o||[]}get path(){return this.settings.path}get Ic(){return this.settings.Ic}dc(t){return new dC(Object.assign(Object.assign({},this.settings),t),this.databaseId,this.serializer,this.ignoreUndefinedProperties,this.fieldTransforms,this.fieldMask)}Ac(t){var e;const s=(e=this.path)===null||e===void 0?void 0:e.child(t),r=this.dc({path:s,Rc:!1});return r.Vc(t),r}mc(t){var e;const s=(e=this.path)===null||e===void 0?void 0:e.child(t),r=this.dc({path:s,Rc:!1});return r.Ec(),r}fc(t){return this.dc({path:void 0,Rc:!0})}gc(t){return by(t,this.settings.methodName,this.settings.yc||!1,this.path,this.settings.wc)}contains(t){return this.fieldMask.find(e=>t.isPrefixOf(e))!==void 0||this.fieldTransforms.find(e=>t.isPrefixOf(e.field))!==void 0}Ec(){if(this.path)for(let t=0;t<this.path.length;t++)this.Vc(this.path.get(t))}Vc(t){if(t.length===0)throw this.gc("Document fields must not be empty");if(b$(this.Ic)&&uW.test(t))throw this.gc('Document fields cannot begin and end with "__"')}}class hW{constructor(t,e,s){this.databaseId=t,this.ignoreUndefinedProperties=e,this.serializer=s||u0(t)}bc(t,e,s,r=!1){return new dC({Ic:t,methodName:e,wc:s,path:ws.emptyPath(),Rc:!1,yc:r},this.databaseId,this.serializer,this.ignoreUndefinedProperties)}}function dW(n){const t=n._freezeSettings(),e=u0(n._databaseId);return new hW(n._databaseId,!!t.ignoreUndefinedProperties,e)}function fW(n,t,e,s,r,i={}){const o=n.bc(i.merge||i.mergeFields?2:0,t,e,r);S$("Data must be an object, but it was:",o,s);const l=w$(s,o);let u,h;if(i.merge)u=new oi(o.fieldMask),h=o.fieldTransforms;else if(i.mergeFields){const d=[];for(const p of i.mergeFields){const m=pW(t,p,e);if(!o.contains(m))throw new Ht(_t.INVALID_ARGUMENT,`Field '${m}' is specified in your field mask but missing from your input data.`);gW(d,m)||d.push(m)}u=new oi(d),h=o.fieldTransforms.filter(p=>u.covers(p.field))}else u=null,h=o.fieldTransforms;return new cW(new Ur(l),u,h)}function v$(n,t){if(C$(n=ef(n)))return S$("Unsupported field value:",t,n),w$(n,t);if(n instanceof x$)return function(s,r){if(!b$(r.Ic))throw r.gc(`${s._methodName}() can only be used with update() and set()`);if(!r.path)throw r.gc(`${s._methodName}() is not currently supported inside arrays`);const i=s._toFieldTransform(r);i&&r.fieldTransforms.push(i)}(n,t),null;if(n===void 0&&t.ignoreUndefinedProperties)return null;if(t.path&&t.fieldMask.push(t.path),n instanceof Array){if(t.settings.Rc&&t.Ic!==4)throw t.gc("Nested arrays are not supported");return function(s,r){const i=[];let o=0;for(const l of s){let u=v$(l,r.fc(o));u==null&&(u={nullValue:"NULL_VALUE"}),i.push(u),o++}return{arrayValue:{values:i}}}(n,t)}return function(s,r){if((s=ef(s))===null)return{nullValue:"NULL_VALUE"};if(typeof s=="number")return YU(r.serializer,s);if(typeof s=="boolean")return{booleanValue:s};if(typeof s=="string")return{stringValue:s};if(s instanceof Date){const i=Jn.fromDate(s);return{timestampValue:py(r.serializer,i)}}if(s instanceof Jn){const i=new Jn(s.seconds,1e3*Math.floor(s.nanoseconds/1e3));return{timestampValue:py(r.serializer,i)}}if(s instanceof cC)return{geoPointValue:{latitude:s.latitude,longitude:s.longitude}};if(s instanceof Gc)return{bytesValue:VR(r.serializer,s._byteString)};if(s instanceof li){const i=r.databaseId,o=s.firestore._databaseId;if(!o.isEqual(i))throw r.gc(`Document reference is for database ${o.projectId}/${o.database} but should be for database ${i.projectId}/${i.database}`);return{referenceValue:jw(s.firestore._databaseId||r.databaseId,s._key.path)}}if(s instanceof hC)return function(o,l){return{mapValue:{fields:{[fR]:{stringValue:pR},[uy]:{arrayValue:{values:o.toArray().map(h=>{if(typeof h!="number")throw l.gc("VectorValues must only contain numeric values.");return Ww(l.serializer,h)})}}}}}}(s,r);throw r.gc(`Unsupported field value: ${aC(s)}`)}(n,t)}function w$(n,t){const e={};return aR(n)?t.path&&t.path.length>0&&t.fieldMask.push(t.path):gu(n,(s,r)=>{const i=v$(r,t.Ac(s));i!=null&&(e[s]=i)}),{mapValue:{fields:e}}}function C$(n){return!(typeof n!="object"||n===null||n instanceof Array||n instanceof Date||n instanceof Jn||n instanceof cC||n instanceof Gc||n instanceof li||n instanceof x$||n instanceof hC)}function S$(n,t,e){if(!C$(e)||!function(r){return typeof r=="object"&&r!==null&&(Object.getPrototypeOf(r)===Object.prototype||Object.getPrototypeOf(r)===null)}(e)){const s=aC(e);throw s==="an object"?t.gc(n+" a custom object"):t.gc(n+" "+s)}}function pW(n,t,e){if((t=ef(t))instanceof uC)return t._internalPath;if(typeof t=="string")return T$(n,t);throw by("Field path arguments must be of type string or ",n,!1,void 0,e)}const mW=new RegExp("[~\\*/\\[\\]]");function T$(n,t,e){if(t.search(mW)>=0)throw by(`Invalid field path (${t}). Paths must not contain '~', '*', '/', '[', or ']'`,n,!1,void 0,e);try{return new uC(...t.split("."))._internalPath}catch{throw by(`Invalid field path (${t}). Paths must not be empty, begin with '.', end with '.', or contain '..'`,n,!1,void 0,e)}}function by(n,t,e,s,r){const i=s&&!s.isEmpty(),o=r!==void 0;let l=`Function ${t}() called with invalid data`;e&&(l+=" (via `toFirestore()`)"),l+=". ";let u="";return(i||o)&&(u+=" (found",i&&(u+=` in field ${s}`),o&&(u+=` in document ${r}`),u+=")"),new Ht(_t.INVALID_ARGUMENT,l+n+u)}function gW(n,t){return n.some(e=>e.isEqual(t))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class E${constructor(t,e,s,r,i){this._firestore=t,this._userDataWriter=e,this._key=s,this._document=r,this._converter=i}get id(){return this._key.path.lastSegment()}get ref(){return new li(this._firestore,this._converter,this._key)}exists(){return this._document!==null}data(){if(this._document){if(this._converter){const t=new yW(this._firestore,this._userDataWriter,this._key,this._document,null);return this._converter.fromFirestore(t)}return this._userDataWriter.convertValue(this._document.data.value)}}get(t){if(this._document){const e=this._document.data.field(I$("DocumentSnapshot.get",t));if(e!==null)return this._userDataWriter.convertValue(e)}}}class yW extends E${data(){return super.data()}}function I$(n,t){return typeof t=="string"?T$(n,t):t instanceof uC?t._internalPath:t._delegate._internalPath}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function xW(n){if(n.limitType==="L"&&n.explicitOrderBy.length===0)throw new Ht(_t.UNIMPLEMENTED,"limitToLast() queries require specifying at least one orderBy() clause")}class bW{convertValue(t,e="none"){switch(Ba(t)){case 0:return null;case 1:return t.booleanValue;case 2:return kn(t.integerValue||t.doubleValue);case 3:return this.convertTimestamp(t.timestampValue);case 4:return this.convertServerTimestamp(t,e);case 5:return t.stringValue;case 6:return this.convertBytes(za(t.bytesValue));case 7:return this.convertReference(t.referenceValue);case 8:return this.convertGeoPoint(t.geoPointValue);case 9:return this.convertArray(t.arrayValue,e);case 11:return this.convertObject(t.mapValue,e);case 10:return this.convertVectorValue(t.mapValue);default:throw Jt(62114,{value:t})}}convertObject(t,e){return this.convertObjectMap(t.fields,e)}convertObjectMap(t,e="none"){const s={};return gu(t,(r,i)=>{s[r]=this.convertValue(i,e)}),s}convertVectorValue(t){var e,s,r;const i=(r=(s=(e=t.fields)===null||e===void 0?void 0:e[uy].arrayValue)===null||s===void 0?void 0:s.values)===null||r===void 0?void 0:r.map(o=>kn(o.doubleValue));return new hC(i)}convertGeoPoint(t){return new cC(kn(t.latitude),kn(t.longitude))}convertArray(t,e){return(t.values||[]).map(s=>this.convertValue(s,e))}convertServerTimestamp(t,e){switch(e){case"previous":const s=n0(t);return s==null?null:this.convertValue(s,e);case"estimate":return this.convertTimestamp(of(t));default:return null}}convertTimestamp(t){const e=Va(t);return new Jn(e.seconds,e.nanos)}convertDocumentKey(t,e){const s=un.fromString(t);ze(HR(s),9688,{name:t});const r=new af(s.get(1),s.get(3)),i=new qt(s.popFirst(5));return r.isEqual(e)||Po(`Document ${i} contains a document reference within a different database (${r.projectId}/${r.database}) which is not supported. It will be treated as a reference in the current database (${e.projectId}/${e.database}) instead.`),i}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function vW(n,t,e){let s;return s=n?n.toFirestore(t):t,s}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Tg{constructor(t,e){this.hasPendingWrites=t,this.fromCache=e}isEqual(t){return this.hasPendingWrites===t.hasPendingWrites&&this.fromCache===t.fromCache}}class wW extends E${constructor(t,e,s,r,i,o){super(t,e,s,r,o),this._firestore=t,this._firestoreImpl=t,this.metadata=i}exists(){return super.exists()}data(t={}){if(this._document){if(this._converter){const e=new qg(this._firestore,this._userDataWriter,this._key,this._document,this.metadata,null);return this._converter.fromFirestore(e,t)}return this._userDataWriter.convertValue(this._document.data.value,t.serverTimestamps)}}get(t,e={}){if(this._document){const s=this._document.data.field(I$("DocumentSnapshot.get",t));if(s!==null)return this._userDataWriter.convertValue(s,e.serverTimestamps)}}}class qg extends wW{data(t={}){return super.data(t)}}class CW{constructor(t,e,s,r){this._firestore=t,this._userDataWriter=e,this._snapshot=r,this.metadata=new Tg(r.hasPendingWrites,r.fromCache),this.query=s}get docs(){const t=[];return this.forEach(e=>t.push(e)),t}get size(){return this._snapshot.docs.size}get empty(){return this.size===0}forEach(t,e){this._snapshot.docs.forEach(s=>{t.call(e,new qg(this._firestore,this._userDataWriter,s.key,s,new Tg(this._snapshot.mutatedKeys.has(s.key),this._snapshot.fromCache),this.query.converter))})}docChanges(t={}){const e=!!t.includeMetadataChanges;if(e&&this._snapshot.excludesMetadataChanges)throw new Ht(_t.INVALID_ARGUMENT,"To include metadata changes with your document changes, you must also pass { includeMetadataChanges:true } to onSnapshot().");return this._cachedChanges&&this._cachedChangesIncludeMetadataChanges===e||(this._cachedChanges=function(r,i){if(r._snapshot.oldDocs.isEmpty()){let o=0;return r._snapshot.docChanges.map(l=>{const u=new qg(r._firestore,r._userDataWriter,l.doc.key,l.doc,new Tg(r._snapshot.mutatedKeys.has(l.doc.key),r._snapshot.fromCache),r.query.converter);return l.doc,{type:"added",doc:u,oldIndex:-1,newIndex:o++}})}{let o=r._snapshot.oldDocs;return r._snapshot.docChanges.filter(l=>i||l.type!==3).map(l=>{const u=new qg(r._firestore,r._userDataWriter,l.doc.key,l.doc,new Tg(r._snapshot.mutatedKeys.has(l.doc.key),r._snapshot.fromCache),r.query.converter);let h=-1,d=-1;return l.type!==0&&(h=o.indexOf(l.doc.key),o=o.delete(l.doc.key)),l.type!==1&&(o=o.add(l.doc),d=o.indexOf(l.doc.key)),{type:SW(l.type),doc:u,oldIndex:h,newIndex:d}})}}(this,e),this._cachedChangesIncludeMetadataChanges=e),this._cachedChanges}}function SW(n){switch(n){case 0:return"added";case 2:case 3:return"modified";case 1:return"removed";default:return Jt(61501,{type:n})}}class TW extends bW{constructor(t){super(),this.firestore=t}convertBytes(t){return new Gc(t)}convertReference(t){const e=this.convertDocumentKey(t,this.firestore._databaseId);return new li(this.firestore,null,e)}}function EW(n){n=xy(n,f0);const t=xy(n.firestore,lC),e=y$(t),s=new TW(t);return xW(n._query),sW(e,n._query).then(r=>new CW(t,s,n,r))}function IW(n,t){const e=xy(n.firestore,lC),s=oW(n),r=vW(n.converter,t);return _W(e,[fW(dW(n.firestore),"addDoc",s._key,r,n.converter!==null,{}).toMutation(s._key,Mo.exists(!1))]).then(()=>s)}function _W(n,t){return function(s,r){const i=new $a;return s.asyncQueue.enqueueAndForget(async()=>GG(await eW(s),r,i)),i.promise}(y$(n),t)}(function(t,e=!0){(function(r){rh=r})(XB),oy(new nf("firestore",(s,{instanceIdentifier:r,options:i})=>{const o=s.getProvider("app").getImmediate(),l=new lC(new uU(s.getProvider("auth-internal")),new dU(o,s.getProvider("app-check-internal")),function(h,d){if(!Object.prototype.hasOwnProperty.apply(h.options,["projectId"]))throw new Ht(_t.INVALID_ARGUMENT,'"projectId" not provided in firebase.initializeApp.');return new af(h.options.projectId,d)}(o,r),o);return i=Object.assign({useFetchStreams:e},i),l._setSettings(i),l},"PUBLIC").setMultipleInstances(!0)),Nc(L_,P_,t),Nc(L_,P_,"esm2017")})();var kW="firebase",AW="11.9.0";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */Nc(kW,AW,"app");const NW={apiKey:"AIzaSyDyHN9ZTB_dUG3ixgv4-W8L47xYagIPeBQ",authDomain:"faceattend-e13e2.firebaseapp.com",projectId:"faceattend-e13e2",storageBucket:"faceattend-e13e2.firebasestorage.app",messagingSenderId:"190444851040",appId:"1:190444851040:web:3b0abf464532dcb927d805"},RW=jN(NW),_$=aW(RW);async function $W(n,t){try{return await IW(g$(_$,"absensi"),{name:n,timestamp:t}),!0}catch(e){return console.error("Gagal simpan absensi:",e),!1}}async function DW(){return(await EW(g$(_$,"absensi"))).docs.map(t=>t.data())}function k$({show:n,message:t,type:e="success",onClose:s}){return bt.useEffect(()=>{if(n){const r=setTimeout(()=>{s()},3e3);return()=>clearTimeout(r)}},[n]),n?Ut.jsx("div",{className:`fixed top-1/2 left-1/2 transform -translate-x-1/2 -translate-y-1/2 px-6 py-3 text-white rounded-lg shadow-lg transition-opacity duration-300 z-50 ${e==="success"?"bg-green-500":"bg-red-500"}`,children:t}):null}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const OW=1e-7,MW=1e-4;class A${constructor(t,e){this.backend=t,this.dataMover=e,this.data=new WeakMap,this.dataIdsCount=0}get(t){return this.data.has(t)||this.dataMover.moveData(this.backend,t),this.data.get(t)}set(t,e){this.dataIdsCount++,this.data.set(t,e)}has(t){return this.data.has(t)}delete(t){return this.dataIdsCount--,this.data.delete(t)}numDataIds(){return this.dataIdsCount}}class fC{refCount(t){return rr("refCount")}incRef(t){return rr("incRef")}timerAvailable(){return!0}time(t){return rr("time")}read(t){return rr("read")}readSync(t){return rr("readSync")}readToGPU(t,e){return rr("readToGPU")}numDataIds(){return rr("numDataIds")}disposeData(t,e){return rr("disposeData")}write(t,e,s){return rr("write")}move(t,e,s,r,i){return rr("move")}createTensorFromGPUData(t,e,s){return rr("createTensorFromGPUData")}memory(){return rr("memory")}floatPrecision(){return rr("floatPrecision")}epsilon(){return this.floatPrecision()===32?OW:MW}dispose(){return rr("dispose")}}function rr(n){throw new Error(`'${n}' not yet implemented or not found in the registry. This kernel may not be supported by the tfjs backend you have chosen`)}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function FW(n){let t=n.length,e=0;for(;t>0;)e=Math.random()*t|0,t--,_c(n,t,e)}function tu(n,t,e){return Math.max(n,Math.min(t,e))}function pC(n){return n%2===0?n:n+1}function _c(n,t,e){const s=n[t];n[t]=n[e],n[e]=s}function LW(n){let t=0;for(let e=0;e<n.length;e++)t+=n[e];return t}function U(n,t){if(!n)throw new Error(typeof t=="string"?t:t())}function mC(n,t,e=""){U(Oe(n,t),()=>e+` Shapes ${n} and ${t} must match`)}function gC(n){U(n!=null,()=>"The input to the tensor constructor must be a non-null value.")}function yt(n){if(n.length===0)return 1;let t=n[0];for(let e=1;e<n.length;e++)t*=n[e];return t}function Oe(n,t){if(n===t)return!0;if(n==null||t==null||n.length!==t.length)return!1;for(let e=0;e<n.length;e++)if(n[e]!==t[e])return!1;return!0}function Wc(n){return n%1===0}function qv(n){const t=Math.ceil(Math.sqrt(n));return[t,Math.ceil(n/t)]}function $c(n,t){return t<=n.length?n:n+" ".repeat(t-n.length)}function Dk(n,t=r=>0,e,s){return new Promise((r,i)=>{let o=0;const l=()=>{if(n()){r();return}o++;const u=t(o);if(e!=null&&o>=e){i();return}s!=null?s(l,u):setTimeout(l,u)};l()})}function N$(n,t){let e=1,s=-1;for(let i=0;i<n.length;++i)if(n[i]>=0)e*=n[i];else if(n[i]===-1){if(s!==-1)throw Error(`Shapes can only have 1 implicit size. Found -1 at dim ${s} and dim ${i}`);s=i}else if(n[i]<0)throw Error(`Shapes can not be < 0. Found ${n[i]} at dim ${i}`);if(s===-1){if(t>0&&t!==e)throw Error(`Size(${t}) must match the product of shape ${n}`);return n}if(e===0)throw Error(`Cannot infer the missing size in [${n}] when there are 0 elements`);if(t%e!==0)throw Error(`The implicit shape can't be a fractional number. Got ${t} / ${e}`);const r=n.slice();return r[s]=t/e,r}function le(n,t){const e=t.length;return n=n==null?t.map((s,r)=>r):[].concat(n),U(n.every(s=>s>=-e&&s<e),()=>`All values in axis param must be in range [-${e}, ${e}) but got axis ${n}`),U(n.every(s=>Wc(s)),()=>`All values in axis param must be integers but got axis ${n}`),n.map(s=>s<0?e+s:s)}function Ya(n,t){const e=[],s=[],r=t!=null&&Array.isArray(t)&&t.length===0,i=t==null||r?null:le(t,n).sort();let o=0;for(let l=0;l<n.length;++l){if(i!=null){if(i[o]===l&&n[l]!==1)throw new Error(`Can't squeeze axis ${l} since its dim '${n[l]}' is not 1`);(i[o]==null||i[o]>l)&&n[l]===1&&(e.push(n[l]),s.push(l)),i[o]<=l&&o++}n[l]!==1&&(e.push(n[l]),s.push(l))}return{newShape:e,keptDims:s}}function Ss(n,t){return bn(n,t)}function bn(n,t){let e=null;if(n==null||n==="float32")e=new Float32Array(t);else if(n==="int32")e=new Int32Array(t);else if(n==="bool")e=new Uint8Array(t);else if(n==="string")e=new Array(t);else throw new Error(`Unknown data type ${n}`);return e}function PW(n,t){for(let e=0;e<n.length;e++){const s=n[e];if(isNaN(s)||!isFinite(s))throw Error(`A tensor of type ${t} being uploaded contains ${s}.`)}}function VW(n){return n==="bool"||n==="complex64"||n==="float32"||n==="int32"||n==="string"}function R$(n,t){return!(t==="complex64"||t==="float32"&&n!=="complex64"||t==="int32"&&n!=="float32"&&n!=="complex64"||t==="bool"&&n==="bool")}function vy(n){if(n==="float32"||n==="int32")return 4;if(n==="complex64")return 8;if(n==="bool")return 1;throw new Error(`Unknown dtype ${n}`)}function zW(n){if(n==null)return 0;let t=0;return n.forEach(e=>t+=e.length),t}function Rf(n){return typeof n=="string"||n instanceof String}function BW(n){return typeof n=="boolean"}function jv(n){return typeof n=="number"}function lh(n){return Array.isArray(n)?lh(n[0]):n instanceof Float32Array?"float32":n instanceof Int32Array||n instanceof Uint8Array||n instanceof Uint8ClampedArray?"int32":jv(n)?"float32":Rf(n)?"string":BW(n)?"bool":"float32"}function Kv(n){return!!(n&&n.constructor&&n.call&&n.apply)}function Xv(n,t){for(let e=t;e<n;++e)if(n%e===0)return e;return n}function zt(n){const t=n.length;if(t<2)return[];const e=new Array(t-1);e[t-2]=n[t-1];for(let s=t-3;s>=0;--s)e[s]=e[s+1]*n[s+1];return e}function $$(n,t,e,s=!1){const r=new Array;if(t.length===1){const i=t[0]*(s?2:1);for(let o=0;o<i;o++)r[o]=e[n+o]}else{const i=t[0],o=t.slice(1),l=o.reduce((u,h)=>u*h)*(s?2:1);for(let u=0;u<i;u++)r[u]=$$(n+u*l,o,e,s)}return r}function ui(n,t,e=!1){if(n.length===0)return t[0];const s=n.reduce((r,i)=>r*i)*(e?2:1);if(s===0)return[];if(s!==t.length)throw new Error(`[${n}] does not match the input size ${t.length}${e?" for a complex tensor":""}.`);return $$(0,n,t,e)}function UW(n,t){if(Array.isArray(n))return n;if(t==="float32")return n instanceof Float32Array?n:new Float32Array(n);if(t==="int32")return n instanceof Int32Array?n:new Int32Array(n);if(t==="bool"||t==="string")return Uint8Array.from(new Int32Array(n));throw new Error(`Unknown dtype ${t}`)}function yC(n,t){const e=Ts(n,t);for(let s=0;s<e.length;s++)e[s]=1;return e}function Ts(n,t){if(t==null||t==="float32"||t==="complex64")return new Float32Array(n);if(t==="int32")return new Int32Array(n);if(t==="bool")return new Uint8Array(n);throw new Error(`Unknown data type ${t}`)}function D$(n,t){const e=n.reduce((s,r)=>s*r,1);if(t==null||t==="float32")return ui(n,new Float32Array(e));if(t==="int32")return ui(n,new Int32Array(e));if(t==="bool")return ui(n,new Uint8Array(e));throw new Error(`Unknown data type ${t}`)}function Ho(n){n.forEach(t=>{U(Number.isInteger(t)&&t>=0,()=>`Tensor must have a shape comprised of positive integers but got shape [${n}].`)})}function Bi(n,t,e){if(t===0)return 0;if(t===1)return n[0];let s=n[n.length-1];for(let r=0;r<n.length-1;++r)s+=e[r]*n[r];return s}function uh(n,t,e){if(t===0)return[];if(t===1)return[n];const s=new Array(t);for(let r=0;r<s.length-1;++r)s[r]=Math.floor(n/e[r]),n-=s[r]*e[r];return s[s.length-1]=n,s}function xC(n){return n&&n.then&&typeof n.then=="function"}/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Ok="tfjsflags";class GW{constructor(t){this.global=t,this.flags={},this.flagRegistry={},this.urlFlags={},this.getQueryParams=WW,this.populateURLFlags()}setPlatform(t,e){this.platform!=null&&(dt().getBool("IS_TEST")||dt().getBool("PROD")||console.warn(`Platform ${this.platformName} has already been set. Overwriting the platform with ${t}.`)),this.platformName=t,this.platform=e}registerFlag(t,e,s){if(this.flagRegistry[t]={evaluationFn:e,setHook:s},this.urlFlags[t]!=null){const r=this.urlFlags[t];dt().getBool("IS_TEST")||dt().getBool("PROD")||console.warn(`Setting feature override from URL ${t}: ${r}.`),this.set(t,r)}}async getAsync(t){return t in this.flags?this.flags[t]:(this.flags[t]=await this.evaluateFlag(t),this.flags[t])}get(t){if(t in this.flags)return this.flags[t];const e=this.evaluateFlag(t);if(xC(e))throw new Error(`Flag ${t} cannot be synchronously evaluated. Please use getAsync() instead.`);return this.flags[t]=e,this.flags[t]}getNumber(t){return this.get(t)}getBool(t){return this.get(t)}getString(t){return this.get(t)}getFlags(){return this.flags}get features(){return this.flags}set(t,e){if(this.flagRegistry[t]==null)throw new Error(`Cannot set flag ${t} as it has not been registered.`);this.flags[t]=e,this.flagRegistry[t].setHook!=null&&this.flagRegistry[t].setHook(e)}evaluateFlag(t){if(this.flagRegistry[t]==null)throw new Error(`Cannot evaluate flag '${t}': no evaluation function found.`);return this.flagRegistry[t].evaluationFn()}setFlags(t){this.flags=Object.assign({},t)}reset(){this.flags={},this.urlFlags={},this.populateURLFlags()}populateURLFlags(){if(typeof this.global>"u"||typeof this.global.location>"u"||typeof this.global.location.search>"u")return;const t=this.getQueryParams(this.global.location.search);Ok in t&&t[Ok].split(",").forEach(s=>{const[r,i]=s.split(":");this.urlFlags[r]=qW(r,i)})}}function WW(n){const t={};return n.replace(/[?&]([^=?&]+)(?:=([^&]*))?/g,(e,...s)=>(HW(t,s[0],s[1]),s.join("="))),t}function HW(n,t,e){n[decodeURIComponent(t)]=decodeURIComponent(e||"")}function qW(n,t){const e=t.toLowerCase();return e==="true"||e==="false"?e==="true":`${+e}`===e?+e:t}function dt(){return O$}let O$=null;function jW(n){O$=n}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */let ev;function M$(){if(ev==null){let n;if(typeof window<"u")n=window;else if(typeof global<"u")n=global;else if(typeof process<"u")n=process;else if(typeof self<"u")n=self;else throw new Error("Could not find a global object");ev=n}return ev}function KW(){const n=M$();return n._tfGlobals==null&&(n._tfGlobals=new Map),n._tfGlobals}function bC(n,t){const e=KW();if(e.has(n))return e.get(n);{const s=t();return e.set(n,s),e.get(n)}}const p0="Abs",$f="Acos",Df="Acosh",ch="Add",vC="AddN",wC="All",CC="Any",m0="ArgMax",g0="ArgMin",Of="Asin",Mf="Asinh",Ff="Atan",Lf="Atanh",Pf="Atan2",y0="AvgPool",SC="AvgPoolGrad",x0="AvgPool3D",TC="AvgPool3DGrad",b0="BatchMatMul",v0="BatchToSpaceND",EC="Bincount",IC="BitwiseAnd",XW="BroadcastTo",F$="BroadcastArgs",Vf="Cast",zf="Ceil",Bf="ClipByValue",_C="Complex",w0="ComplexAbs",C0="Concat",S0="Conv2D",kC="Conv2DBackpropFilter",T0="Conv2DBackpropInput",E0="Conv3D",AC="Conv3DBackpropFilterV2",NC="Conv3DBackpropInputV2",Uf="Cos",Gf="Cosh",RC="Cumprod",I0="Cumsum",$C="CropAndResize",DC="DenseBincount",OC="DepthToSpace",_0="DepthwiseConv2dNative",MC="DepthwiseConv2dNativeBackpropFilter",FC="DepthwiseConv2dNativeBackpropInput",L$="Diag",k0="Dilation2D",Yv="Dilation2DBackpropInput",Qv="Dilation2DBackpropFilter",YW="Draw",Wf="RealDiv",LC="Einsum",Hf="Elu",PC="EluGrad",qf="Erf",A0="Equal",jf="Exp",N0="ExpandDims",Kf="Expm1",VC="FFT",zC="Fill",BC="FlipLeftRight",Xf="Floor",Yf="FloorDiv",R0="FusedBatchNorm",$0="GatherV2",P$="GatherNd",D0="Greater",Qf="GreaterEqual",Zf="Identity",UC="IFFT",GC="Imag",Jf="IsFinite",tp="IsInf",ep="IsNan",O0="LeakyRelu",M0="Less",F0="LessEqual",V$="LinSpace",np="Log",sp="Log1p",L0="LogicalAnd",P0="LogicalNot",V0="LogicalOr",QW="LogSoftmax",z0="LRN",WC="LRNGrad",B0="Max",rp="Maximum",U0="MaxPool",HC="MaxPoolGrad",G0="MaxPool3D",qC="MaxPool3DGrad",z$="MaxPoolWithArgmax",W0="Mean",H0="Min",ip="Minimum",q0="MirrorPad",op="Mod",B$="Multinomial",ap="Multiply",j0="Neg",K0="NotEqual",jC="NonMaxSuppressionV3",KC="NonMaxSuppressionV4",XC="NonMaxSuppressionV5",X0="OnesLike",Y0="OneHot",Q0="Pack",Z0="PadV2",lp="Pow",J0="Prelu",tx="Prod",U$="RaggedGather",G$="RaggedRange",W$="RaggedTensorToTensor",YC="Range",QC="Real",up="Reciprocal",cp="Relu",ex="Reshape",nx="ResizeNearestNeighbor",ZC="ResizeNearestNeighborGrad",sx="ResizeBilinear",JC="ResizeBilinearGrad",hp="Relu6",rx="Reverse",dp="Round",fp="Rsqrt",H$="ScatterNd",q$="TensorScatterUpdate",j$="SearchSorted",ix="Select",pp="Selu",ox="Slice",mp="Sin",gp="Sinh",yp="Sign",xp="Sigmoid",bp="Softplus",vp="Sqrt",ax="Sum",lx="SpaceToBatchND",ux="SplitV",cx="Softmax",K$="SparseFillEmptyRows",X$="SparseReshape",Y$="SparseSegmentMean",Q$="SparseSegmentSum",Z$="SparseToDense",wp="SquaredDifference",tS="Square",eS="StaticRegexReplace",nS="StridedSlice",J$="StringNGrams",tD="StringSplit",eD="StringToHashBucketFast",Cp="Sub",Sp="Tan",Tp="Tanh",Ep="Tile",sS="TopK",rS="Transform",Dc="Transpose",iS="Unique",hx="Unpack",dx="UnsortedSegmentSum",fx="ZerosLike",Ip="Step",Zv="FromPixels",oS="RotateWithOffset",wy="_FusedMatMul",Cy="FusedConv2D",nD="FusedDepthwiseConv2D";/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function vr(...n){dt().getBool("IS_TEST")||dt().getBool("PROD")||console.warn(...n)}function ZW(...n){dt().getBool("IS_TEST")||dt().getBool("PROD")||console.log(...n)}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Sy=bC("kernelRegistry",()=>new Map),Jv=bC("gradRegistry",()=>new Map);function tw(n,t){const e=rD(n,t);return Sy.get(e)}function Mk(n){return Jv.get(n)}function Fk(n){const t=Sy.entries(),e=[];for(;;){const{done:s,value:r}=t.next();if(s)break;const[i,o]=r,[l]=i.split("_");l===n&&e.push(o)}return e}function sD(n){const{kernelName:t,backendName:e}=n,s=rD(t,e);Sy.has(s)&&vr(`The kernel '${t}' for backend '${e}' is already registered`),Sy.set(s,n)}function JW(n){const{kernelName:t}=n;Jv.has(t)&&dt().getBool("DEBUG")&&vr(`Overriding the gradient for '${t}'`),Jv.set(t,n)}function rD(n,t){return`${t}_${n}`}/**
 * @license
 * Copyright 2023 Google LLC.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function iD(n){return n instanceof Float32Array||n instanceof Int32Array||n instanceof Uint8Array||n instanceof Uint8ClampedArray}var nv,Lk;function tH(){if(Lk)return nv;Lk=1,nv=t;var n=null;try{n=new WebAssembly.Instance(new WebAssembly.Module(new Uint8Array([0,97,115,109,1,0,0,0,1,13,2,96,0,1,127,96,4,127,127,127,127,1,127,3,7,6,0,1,1,1,1,1,6,6,1,127,1,65,0,11,7,50,6,3,109,117,108,0,1,5,100,105,118,95,115,0,2,5,100,105,118,95,117,0,3,5,114,101,109,95,115,0,4,5,114,101,109,95,117,0,5,8,103,101,116,95,104,105,103,104,0,0,10,191,1,6,4,0,35,0,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,126,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,127,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,128,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,129,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,130,34,4,66,32,135,167,36,0,32,4,167,11])),{}).exports}catch{}function t($,A,V){this.low=$|0,this.high=A|0,this.unsigned=!!V}t.prototype.__isLong__,Object.defineProperty(t.prototype,"__isLong__",{value:!0});function e($){return($&&$.__isLong__)===!0}t.isLong=e;var s={},r={};function i($,A){var V,L,nt;return A?($>>>=0,(nt=0<=$&&$<256)&&(L=r[$],L)?L:(V=l($,($|0)<0?-1:0,!0),nt&&(r[$]=V),V)):($|=0,(nt=-128<=$&&$<128)&&(L=s[$],L)?L:(V=l($,$<0?-1:0,!1),nt&&(s[$]=V),V))}t.fromInt=i;function o($,A){if(isNaN($))return A?E:S;if(A){if($<0)return E;if($>=x)return D}else{if($<=-9223372036854776e3)return N;if($+1>=v)return P}return $<0?o(-$,A).neg():l($%y|0,$/y|0,A)}t.fromNumber=o;function l($,A,V){return new t($,A,V)}t.fromBits=l;var u=Math.pow;function h($,A,V){if($.length===0)throw Error("empty string");if($==="NaN"||$==="Infinity"||$==="+Infinity"||$==="-Infinity")return S;if(typeof A=="number"?(V=A,A=!1):A=!!A,V=V||10,V<2||36<V)throw RangeError("radix");var L;if((L=$.indexOf("-"))>0)throw Error("interior hyphen");if(L===0)return h($.substring(1),A,V).neg();for(var nt=o(u(V,8)),Z=S,W=0;W<$.length;W+=8){var K=Math.min(8,$.length-W),Y=parseInt($.substring(W,W+K),V);if(K<8){var at=o(u(V,K));Z=Z.mul(at).add(o(Y))}else Z=Z.mul(nt),Z=Z.add(o(Y))}return Z.unsigned=A,Z}t.fromString=h;function d($,A){return typeof $=="number"?o($,A):typeof $=="string"?h($,A):l($.low,$.high,typeof A=="boolean"?A:$.unsigned)}t.fromValue=d;var p=65536,m=1<<24,y=p*p,x=y*y,v=x/2,C=i(m),S=i(0);t.ZERO=S;var E=i(0,!0);t.UZERO=E;var _=i(1);t.ONE=_;var I=i(1,!0);t.UONE=I;var O=i(-1);t.NEG_ONE=O;var P=l(-1,2147483647,!1);t.MAX_VALUE=P;var D=l(-1,-1,!0);t.MAX_UNSIGNED_VALUE=D;var N=l(0,-2147483648,!1);t.MIN_VALUE=N;var R=t.prototype;return R.toInt=function(){return this.unsigned?this.low>>>0:this.low},R.toNumber=function(){return this.unsigned?(this.high>>>0)*y+(this.low>>>0):this.high*y+(this.low>>>0)},R.toString=function(A){if(A=A||10,A<2||36<A)throw RangeError("radix");if(this.isZero())return"0";if(this.isNegative())if(this.eq(N)){var V=o(A),L=this.div(V),nt=L.mul(V).sub(this);return L.toString(A)+nt.toInt().toString(A)}else return"-"+this.neg().toString(A);for(var Z=o(u(A,6),this.unsigned),W=this,K="";;){var Y=W.div(Z),at=W.sub(Y.mul(Z)).toInt()>>>0,B=at.toString(A);if(W=Y,W.isZero())return B+K;for(;B.length<6;)B="0"+B;K=""+B+K}},R.getHighBits=function(){return this.high},R.getHighBitsUnsigned=function(){return this.high>>>0},R.getLowBits=function(){return this.low},R.getLowBitsUnsigned=function(){return this.low>>>0},R.getNumBitsAbs=function(){if(this.isNegative())return this.eq(N)?64:this.neg().getNumBitsAbs();for(var A=this.high!=0?this.high:this.low,V=31;V>0&&(A&1<<V)==0;V--);return this.high!=0?V+33:V+1},R.isZero=function(){return this.high===0&&this.low===0},R.eqz=R.isZero,R.isNegative=function(){return!this.unsigned&&this.high<0},R.isPositive=function(){return this.unsigned||this.high>=0},R.isOdd=function(){return(this.low&1)===1},R.isEven=function(){return(this.low&1)===0},R.equals=function(A){return e(A)||(A=d(A)),this.unsigned!==A.unsigned&&this.high>>>31===1&&A.high>>>31===1?!1:this.high===A.high&&this.low===A.low},R.eq=R.equals,R.notEquals=function(A){return!this.eq(A)},R.neq=R.notEquals,R.ne=R.notEquals,R.lessThan=function(A){return this.comp(A)<0},R.lt=R.lessThan,R.lessThanOrEqual=function(A){return this.comp(A)<=0},R.lte=R.lessThanOrEqual,R.le=R.lessThanOrEqual,R.greaterThan=function(A){return this.comp(A)>0},R.gt=R.greaterThan,R.greaterThanOrEqual=function(A){return this.comp(A)>=0},R.gte=R.greaterThanOrEqual,R.ge=R.greaterThanOrEqual,R.compare=function(A){if(e(A)||(A=d(A)),this.eq(A))return 0;var V=this.isNegative(),L=A.isNegative();return V&&!L?-1:!V&&L?1:this.unsigned?A.high>>>0>this.high>>>0||A.high===this.high&&A.low>>>0>this.low>>>0?-1:1:this.sub(A).isNegative()?-1:1},R.comp=R.compare,R.negate=function(){return!this.unsigned&&this.eq(N)?N:this.not().add(_)},R.neg=R.negate,R.add=function(A){e(A)||(A=d(A));var V=this.high>>>16,L=this.high&65535,nt=this.low>>>16,Z=this.low&65535,W=A.high>>>16,K=A.high&65535,Y=A.low>>>16,at=A.low&65535,B=0,j=0,st=0,tt=0;return tt+=Z+at,st+=tt>>>16,tt&=65535,st+=nt+Y,j+=st>>>16,st&=65535,j+=L+K,B+=j>>>16,j&=65535,B+=V+W,B&=65535,l(st<<16|tt,B<<16|j,this.unsigned)},R.subtract=function(A){return e(A)||(A=d(A)),this.add(A.neg())},R.sub=R.subtract,R.multiply=function(A){if(this.isZero())return S;if(e(A)||(A=d(A)),n){var V=n.mul(this.low,this.high,A.low,A.high);return l(V,n.get_high(),this.unsigned)}if(A.isZero())return S;if(this.eq(N))return A.isOdd()?N:S;if(A.eq(N))return this.isOdd()?N:S;if(this.isNegative())return A.isNegative()?this.neg().mul(A.neg()):this.neg().mul(A).neg();if(A.isNegative())return this.mul(A.neg()).neg();if(this.lt(C)&&A.lt(C))return o(this.toNumber()*A.toNumber(),this.unsigned);var L=this.high>>>16,nt=this.high&65535,Z=this.low>>>16,W=this.low&65535,K=A.high>>>16,Y=A.high&65535,at=A.low>>>16,B=A.low&65535,j=0,st=0,tt=0,xt=0;return xt+=W*B,tt+=xt>>>16,xt&=65535,tt+=Z*B,st+=tt>>>16,tt&=65535,tt+=W*at,st+=tt>>>16,tt&=65535,st+=nt*B,j+=st>>>16,st&=65535,st+=Z*at,j+=st>>>16,st&=65535,st+=W*Y,j+=st>>>16,st&=65535,j+=L*B+nt*at+Z*Y+W*K,j&=65535,l(tt<<16|xt,j<<16|st,this.unsigned)},R.mul=R.multiply,R.divide=function(A){if(e(A)||(A=d(A)),A.isZero())throw Error("division by zero");if(n){if(!this.unsigned&&this.high===-2147483648&&A.low===-1&&A.high===-1)return this;var V=(this.unsigned?n.div_u:n.div_s)(this.low,this.high,A.low,A.high);return l(V,n.get_high(),this.unsigned)}if(this.isZero())return this.unsigned?E:S;var L,nt,Z;if(this.unsigned){if(A.unsigned||(A=A.toUnsigned()),A.gt(this))return E;if(A.gt(this.shru(1)))return I;Z=E}else{if(this.eq(N)){if(A.eq(_)||A.eq(O))return N;if(A.eq(N))return _;var W=this.shr(1);return L=W.div(A).shl(1),L.eq(S)?A.isNegative()?_:O:(nt=this.sub(A.mul(L)),Z=L.add(nt.div(A)),Z)}else if(A.eq(N))return this.unsigned?E:S;if(this.isNegative())return A.isNegative()?this.neg().div(A.neg()):this.neg().div(A).neg();if(A.isNegative())return this.div(A.neg()).neg();Z=S}for(nt=this;nt.gte(A);){L=Math.max(1,Math.floor(nt.toNumber()/A.toNumber()));for(var K=Math.ceil(Math.log(L)/Math.LN2),Y=K<=48?1:u(2,K-48),at=o(L),B=at.mul(A);B.isNegative()||B.gt(nt);)L-=Y,at=o(L,this.unsigned),B=at.mul(A);at.isZero()&&(at=_),Z=Z.add(at),nt=nt.sub(B)}return Z},R.div=R.divide,R.modulo=function(A){if(e(A)||(A=d(A)),n){var V=(this.unsigned?n.rem_u:n.rem_s)(this.low,this.high,A.low,A.high);return l(V,n.get_high(),this.unsigned)}return this.sub(this.div(A).mul(A))},R.mod=R.modulo,R.rem=R.modulo,R.not=function(){return l(~this.low,~this.high,this.unsigned)},R.and=function(A){return e(A)||(A=d(A)),l(this.low&A.low,this.high&A.high,this.unsigned)},R.or=function(A){return e(A)||(A=d(A)),l(this.low|A.low,this.high|A.high,this.unsigned)},R.xor=function(A){return e(A)||(A=d(A)),l(this.low^A.low,this.high^A.high,this.unsigned)},R.shiftLeft=function(A){return e(A)&&(A=A.toInt()),(A&=63)===0?this:A<32?l(this.low<<A,this.high<<A|this.low>>>32-A,this.unsigned):l(0,this.low<<A-32,this.unsigned)},R.shl=R.shiftLeft,R.shiftRight=function(A){return e(A)&&(A=A.toInt()),(A&=63)===0?this:A<32?l(this.low>>>A|this.high<<32-A,this.high>>A,this.unsigned):l(this.high>>A-32,this.high>=0?0:-1,this.unsigned)},R.shr=R.shiftRight,R.shiftRightUnsigned=function(A){if(e(A)&&(A=A.toInt()),A&=63,A===0)return this;var V=this.high;if(A<32){var L=this.low;return l(L>>>A|V<<32-A,V>>>A,this.unsigned)}else return A===32?l(V,0,this.unsigned):l(V>>>A-32,0,this.unsigned)},R.shru=R.shiftRightUnsigned,R.shr_u=R.shiftRightUnsigned,R.toSigned=function(){return this.unsigned?l(this.low,this.high,!1):this},R.toUnsigned=function(){return this.unsigned?this:l(this.low,this.high,!0)},R.toBytes=function(A){return A?this.toBytesLE():this.toBytesBE()},R.toBytesLE=function(){var A=this.high,V=this.low;return[V&255,V>>>8&255,V>>>16&255,V>>>24,A&255,A>>>8&255,A>>>16&255,A>>>24]},R.toBytesBE=function(){var A=this.high,V=this.low;return[A>>>24,A>>>16&255,A>>>8&255,A&255,V>>>24,V>>>16&255,V>>>8&255,V&255]},t.fromBytes=function(A,V,L){return L?t.fromBytesLE(A,V):t.fromBytesBE(A,V)},t.fromBytesLE=function(A,V){return new t(A[0]|A[1]<<8|A[2]<<16|A[3]<<24,A[4]|A[5]<<8|A[6]<<16|A[7]<<24,V)},t.fromBytesBE=function(A,V){return new t(A[4]<<24|A[5]<<16|A[6]<<8|A[7],A[0]<<24|A[1]<<16|A[2]<<8|A[3],V)},nv}var oD=tH();const aD=Yy(oD),eH=F4({__proto__:null,default:aD},[oD]);/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Gl=aD||eH;function px(n){return Gl.fromString(n,!0,16)}const lD=px("c3a5c85c97cb3127"),Ul=px("b492b66fbe98f273"),Fs=px("9ae16a3b2f90404f");function ew(n){return n.xor(n.shru(47))}function uD(n,t,e){const s=n.slice(t,t+e);return Gl.fromBytes(Array.from(s),!0,!0)}function Ze(n,t){return uD(n,t,8)}function Pk(n,t){return uD(n,t,4)}function Xn(n,t){return t===0?n:n.shru(t).or(n.shl(64-t))}function Oa(n,t,e=px("9ddfea08eb382d69")){let s=n.xor(t).mul(e);s=s.xor(s.shru(47));let r=t.xor(s).mul(e);return r=r.xor(r.shru(47)),r=r.mul(e),r}function nH(n,t,e,s,r,i){r=r.add(n),i=Xn(i.add(r).add(s),21);const o=r;return r=r.add(t),r=r.add(e),i=i.add(Xn(r,44)),[r.add(s),i.add(o)]}function Eg(n,t,e,s){return nH(Ze(n,t),Ze(n,t+8),Ze(n,t+16),Ze(n,t+24),e,s)}function sH(n,t=n.length){if(t>=8){const e=Fs.add(t*2),s=Ze(n,0).add(Fs),r=Ze(n,t-8),i=Xn(r,37).mul(e).add(s),o=Xn(s,25).add(r).mul(e);return Oa(i,o,e)}if(t>=4){const e=Fs.add(t*2),s=Pk(n,0);return Oa(s.shl(3).add(t),Pk(n,t-4),e)}if(t>0){const e=n[0],s=n[t>>1],r=n[t-1],i=e+(s<<8),o=t+(r<<2);return ew(Fs.mul(i).xor(lD.mul(o))).mul(Fs)}return Fs}function rH(n,t=n.length){const e=Fs.add(t*2),s=Ze(n,0).mul(Ul),r=Ze(n,8),i=Ze(n,t-8).mul(e),o=Ze(n,t-16).mul(Fs);return Oa(Xn(s.add(r),43).add(Xn(i,30)).add(o),s.add(Xn(r.add(Fs),18)).add(i),e)}function iH(n,t=n.length){const e=Fs.add(t*2),s=Ze(n,0).mul(Fs),r=Ze(n,8),i=Ze(n,t-8).mul(e),o=Ze(n,t-16).mul(Fs),l=Xn(s.add(r),43).add(Xn(i,30)).add(o),u=Oa(l,s.add(Xn(r.add(Fs),18)).add(i),e),h=Ze(n,16).mul(e),d=Ze(n,24),p=l.add(Ze(n,t-32)).mul(e),m=u.add(Ze(n,t-24)).mul(e);return Oa(Xn(h.add(d),43).add(Xn(p,30)).add(m),h.add(Xn(d.add(s),18)).add(p),e)}function oH(n,t=n.length){const e=Gl.fromNumber(81,!0);if(t<=32)return t<=16?sH(n,t):rH(n,t);if(t<=64)return iH(n,t);let s=e,r=e.mul(Ul).add(113),i=ew(r.mul(Fs).add(113)).mul(Fs),o=[Gl.UZERO,Gl.UZERO],l=[Gl.UZERO,Gl.UZERO];s=s.mul(Fs).add(Ze(n,0));let u=0;const h=(t-1>>6)*64,d=h+(t-1&63)-63;do s=Xn(s.add(r).add(o[0]).add(Ze(n,u+8)),37).mul(Ul),r=Xn(r.add(o[1]).add(Ze(n,u+48)),42).mul(Ul),s=s.xor(l[1]),r=r.add(o[0]).add(Ze(n,u+40)),i=Xn(i.add(l[0]),33).mul(Ul),o=Eg(n,u,o[1].mul(Ul),s.add(l[0])),l=Eg(n,u+32,i.add(l[1]),r.add(Ze(n,u+16))),[i,s]=[s,i],u+=64;while(u!==h);const p=Ul.add(i.and(255).shl(1));return u=d,l[0]=l[0].add(t-1&63),o[0]=o[0].add(l[0]),l[0]=l[0].add(o[0]),s=Xn(s.add(r).add(o[0]).add(Ze(n,u+8)),37).mul(p),r=Xn(r.add(o[1]).add(Ze(n,u+48)),42).mul(p),s=s.xor(l[1].mul(9)),r=r.add(o[0].mul(9).add(Ze(n,u+40))),i=Xn(i.add(l[0]),33).mul(p),o=Eg(n,u,o[1].mul(p),s.add(l[0])),l=Eg(n,u+32,i.add(l[1]),r.add(Ze(n,u+16))),[i,s]=[s,i],Oa(Oa(o[0],l[0],p).add(ew(r).mul(lD)).add(i),Oa(o[1],l[1],p).add(s),p)}/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Qa(n,t){return t==="string"?Ma(n):vu([n],t)}function aH(n,t){return n instanceof Float32Array&&t==="float32"||n instanceof Int32Array&&t==="int32"||n instanceof Uint8Array&&t==="bool"}function vu(n,t){if(t==="string")throw new Error("Cannot convert a string[] to a TypedArray");if(Array.isArray(n)&&(n=eu(n)),dt().getBool("DEBUG")&&PW(n,t),aH(n,t))return n;if(t==null||t==="float32"||t==="complex64")return new Float32Array(n);if(t==="int32")return new Int32Array(n);if(t==="bool"){const e=new Uint8Array(n.length);for(let s=0;s<e.length;++s)Math.round(n[s])!==0&&(e[s]=1);return e}else throw new Error(`Unknown data type ${t}`)}function qs(){return dt().platform.now()}function Ma(n,t="utf-8"){return t=t||"utf-8",dt().platform.encode(n,t)}function Wa(n,t="utf-8"){return t=t||"utf-8",dt().platform.decode(n,t)}function qr(n){return dt().platform.isTypedArray!=null?dt().platform.isTypedArray(n):iD(n)}function eu(n,t=[],e=!1){if(t==null&&(t=[]),typeof n=="boolean"||typeof n=="number"||typeof n=="string"||xC(n)||n==null||qr(n)&&e)t.push(n);else if(Array.isArray(n)||qr(n))for(let s=0;s<n.length;++s)eu(n[s],t,e);else{let s=-1;for(const r of Object.keys(n))/^([1-9]+[0-9]*|0)$/.test(r)&&(s=Math.max(s,Number(r)));for(let r=0;r<=s;r++)eu(n[r],t,e)}return t}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class lH{constructor(t,e){this.backendTimer=t,this.logger=e,e==null&&(this.logger=new cH)}profileKernel(t,e,s){let r;const i=()=>{r=s()};let o;const l=qs();if(this.backendTimer.timerAvailable())o=this.backendTimer.time(i);else{i();for(const h of r)h.dataSync();o=Promise.resolve({kernelMs:qs()-l})}if(dt().getBool("CHECK_COMPUTATION_FOR_ERRORS"))for(let h=0;h<r.length;h++){const d=r[h];d.data().then(p=>{uH(p,d.dtype,t)})}return{kernelName:t,outputs:r,inputs:e,timeMs:o.then(h=>h.kernelMs),extraInfo:o.then(h=>h.getExtraProfileInfo!=null?h.getExtraProfileInfo():"")}}logKernelProfile(t){const{kernelName:e,outputs:s,timeMs:r,inputs:i,extraInfo:o}=t;s.forEach(l=>{Promise.all([l.data(),r,o]).then(u=>{this.logger.logKernelProfile(e,l,u[0],u[1],i,u[2])})})}}function uH(n,t,e){if(t!=="float32")return!1;for(let s=0;s<n.length;s++){const r=n[s];if(isNaN(r)||!isFinite(r))return console.warn(`Found ${r} in the result of '${e}'`),!0}return!1}class cH{logKernelProfile(t,e,s,r,i,o){const l=typeof r=="number"?$c(`${r}ms`,9):r.error,u=$c(t,25),h=e.rank,d=e.size,p=$c(e.shape.toString(),14);let m="";for(const y in i){const x=i[y];if(x!=null){const v=x.shape||e.shape,C=v.length;m+=`${y}: ${C}D ${C>0?v:""} `}}console.log(`%c${u}	%c${l}	%c${h}D ${p}	%c${d}	%c${m}	%c${o}`,"font-weight:bold","color:red","color:blue","color: orange","color: green","color: steelblue")}}/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function hH(n,t,e){const s={},r={};for(let u=0;u<t.length;u++)s[t[u].id]=!0;for(let u=0;u<n.length;u++){const h=n[u],d=h.inputs;for(const p in d){const m=d[p];let y=!1;for(let x=0;x<t.length;x++)if(s[m.id]){h.outputs.forEach(v=>s[v.id]=!0),y=!0,r[h.id]=!0;break}if(y)break}}const i={};i[e.id]=!0;const o={};for(let u=n.length-1;u>=0;u--){const h=n[u],d=h.inputs;for(let p=0;p<h.outputs.length;p++)if(i[h.outputs[p].id]){for(const m in d)i[d[m].id]=!0,o[h.id]=!0;break}}const l=[];for(let u=0;u<n.length;u++){const h=n[u];if(r[h.id]&&o[h.id]){const d={};for(const m in h.inputs){const y=h.inputs[m];s[y.id]&&(d[m]=y)}const p=Object.assign({},h);p.inputs=d,p.outputs=h.outputs,l.push(p)}}return l}function dH(n,t,e,s){for(let r=t.length-1;r>=0;r--){const i=t[r],o=[];if(i.outputs.forEach(u=>{const h=n[u.id];h!=null?o.push(h):o.push(null)}),i.gradient==null)throw new Error(`Cannot compute gradient: gradient function not found for ${i.kernelName}.`);const l=i.gradient(o);for(const u in i.inputs){if(!(u in l))throw new Error(`Cannot backprop through input ${u}. Available gradients found: ${Object.keys(l)}.`);const h=e(()=>l[u]());if(h.dtype!=="float32")throw new Error(`Error in gradient for op ${i.kernelName}. The gradient of input ${u} must have 'float32' dtype, but has '${h.dtype}'`);const d=i.inputs[u];if(!Oe(h.shape,d.shape))throw new Error(`Error in gradient for op ${i.kernelName}. The gradient of input '${u}' has shape '${h.shape}', which does not match the shape of the input '${d.shape}'`);if(n[d.id]==null)n[d.id]=h;else{const p=n[d.id];n[d.id]=s(p,h),p.dispose()}}}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Vk=20,Dd=3,sv=7;function fH(n,t,e,s){const r=zt(t),i=pH(n,t,e,r),o=t.length,l=jg(n,t,e,r,i),u=["Tensor"];return s&&(u.push(`  dtype: ${e}`),u.push(`  rank: ${o}`),u.push(`  shape: [${t}]`),u.push("  values:")),u.push(l.map(h=>"    "+h).join(`
`)),u.join(`
`)}function pH(n,t,e,s){const r=yt(t),i=s[s.length-1],o=new Array(i).fill(0),l=t.length,u=e==="complex64"?Bd(n):n;if(l>1)for(let h=0;h<r/i;h++){const d=h*i;for(let p=0;p<i;p++)o[p]=Math.max(o[p],zd(u[d+p],0,e).length)}return o}function zd(n,t,e){let s;return Array.isArray(n)?s=`${parseFloat(n[0].toFixed(sv))} + ${parseFloat(n[1].toFixed(sv))}j`:Rf(n)?s=`'${n}'`:e==="bool"?s=cD(n):s=parseFloat(n.toFixed(sv)).toString(),$c(s,t)}function cD(n){return n===0?"false":"true"}function jg(n,t,e,s,r,i=!0){const o=e==="complex64"?2:1,l=t[0],u=t.length;if(u===0){if(e==="complex64"){const v=Bd(n);return[zd(v[0],0,e)]}return e==="bool"?[cD(n[0])]:[n[0].toString()]}if(u===1){if(l>Vk){const C=Dd*o;let S=Array.from(n.slice(0,C)),E=Array.from(n.slice((l-Dd)*o,l*o));return e==="complex64"&&(S=Bd(S),E=Bd(E)),["["+S.map((_,I)=>zd(_,r[I],e)).join(", ")+", ..., "+E.map((_,I)=>zd(_,r[l-Dd+I],e)).join(", ")+"]"]}return["["+(e==="complex64"?Bd(n):Array.from(n)).map((C,S)=>zd(C,r[S],e)).join(", ")+"]"]}const h=t.slice(1),d=s.slice(1),p=s[0]*o,m=[];if(l>Vk){for(let v=0;v<Dd;v++){const C=v*p,S=C+p;m.push(...jg(n.slice(C,S),h,e,d,r,!1))}m.push("...");for(let v=l-Dd;v<l;v++){const C=v*p,S=C+p;m.push(...jg(n.slice(C,S),h,e,d,r,v===l-1))}}else for(let v=0;v<l;v++){const C=v*p,S=C+p;m.push(...jg(n.slice(C,S),h,e,d,r,v===l-1))}const y=u===2?",":"";m[0]="["+(l>0?m[0]+y:"");for(let v=1;v<m.length-1;v++)m[v]=" "+m[v]+y;let x=`,
`;for(let v=2;v<u;v++)x+=`
`;return m[m.length-1]=" "+m[m.length-1]+"]"+(i?"":x),m}function Bd(n){const t=[];for(let e=0;e<n.length;e+=2)t.push([n[e],n[e+1]]);return t}/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class us{constructor(t,e,s){if(this.dtype=e,this.shape=t.slice(),this.size=yt(t),s!=null){const r=s.length;U(r===this.size,()=>`Length of values '${r}' does not match the size inferred by the shape '${this.size}'.`)}if(e==="complex64")throw new Error("complex64 dtype TensorBuffers are not supported. Please create a TensorBuffer for the real and imaginary parts separately and call tf.complex(real, imag).");this.values=s||bn(e,this.size),this.strides=zt(t)}set(t,...e){e.length===0&&(e=[0]),U(e.length===this.rank,()=>`The number of provided coordinates (${e.length}) must match the rank (${this.rank})`);const s=this.locToIndex(e);this.values[s]=t}get(...t){t.length===0&&(t=[0]);let e=0;for(const r of t){if(r<0||r>=this.shape[e]){const i=`Requested out of range element at ${t}.   Buffer shape=${this.shape}`;throw new Error(i)}e++}let s=t[t.length-1];for(let r=0;r<t.length-1;++r)s+=this.strides[r]*t[r];return this.values[s]}locToIndex(t){if(this.rank===0)return 0;if(this.rank===1)return t[0];let e=t[t.length-1];for(let s=0;s<t.length-1;++s)e+=this.strides[s]*t[s];return e}indexToLoc(t){if(this.rank===0)return[];if(this.rank===1)return[t];const e=new Array(this.shape.length);for(let s=0;s<e.length-1;++s)e[s]=Math.floor(t/this.strides[s]),t-=e[s]*this.strides[s];return e[e.length-1]=t,e}get rank(){return this.shape.length}toTensor(){return ri().makeTensor(this.values,this.shape,this.dtype)}}let ri=null,kc=null;function mH(n){ri=n}function gH(n){kc=n}class Fn{constructor(t,e,s,r){this.kept=!1,this.isDisposedInternal=!1,this.shape=t.slice(),this.dtype=e||"float32",this.size=yt(t),this.strides=zt(t),this.dataId=s,this.id=r,this.rankType=this.rank<5?this.rank.toString():"higher"}get rank(){return this.shape.length}async buffer(){const t=await this.data();return kc.buffer(this.shape,this.dtype,t)}bufferSync(){return kc.buffer(this.shape,this.dtype,this.dataSync())}async array(){const t=await this.data();return ui(this.shape,t,this.dtype==="complex64")}arraySync(){return ui(this.shape,this.dataSync(),this.dtype==="complex64")}async data(){this.throwIfDisposed();const t=ri().read(this.dataId);if(this.dtype==="string"){const e=await t;try{return e.map(s=>Wa(s))}catch{throw new Error("Failed to decode the string bytes into utf-8. To get the original bytes, call tensor.bytes().")}}return t}dataToGPU(t){return this.throwIfDisposed(),ri().readToGPU(this.dataId,t)}dataSync(){this.throwIfDisposed();const t=ri().readSync(this.dataId);if(this.dtype==="string")try{return t.map(e=>Wa(e))}catch{throw new Error("Failed to decode the string bytes into utf-8. To get the original bytes, call tensor.bytes().")}return t}async bytes(){this.throwIfDisposed();const t=await ri().read(this.dataId);return this.dtype==="string"?t:new Uint8Array(t.buffer)}dispose(){this.isDisposed||(this.kerasMask&&this.kerasMask.dispose(),ri().disposeTensor(this),this.isDisposedInternal=!0)}get isDisposed(){return this.isDisposedInternal}throwIfDisposed(){if(this.isDisposed)throw new Error("Tensor is disposed.")}print(t=!1){return kc.print(this,t)}clone(){return this.throwIfDisposed(),kc.clone(this)}toString(t=!1){const e=this.dataSync();return fH(e,this.shape,this.dtype,t)}cast(t){return this.throwIfDisposed(),kc.cast(this,t)}variable(t=!0,e,s){return this.throwIfDisposed(),ri().makeVariable(this,t,e,s)}}Object.defineProperty(Fn,Symbol.hasInstance,{value:n=>!!n&&n.data!=null&&n.dataSync!=null&&n.throwIfDisposed!=null});function mt(){return bC("Tensor",()=>Fn)}mt();class Ty extends Fn{constructor(t,e,s,r){super(t.shape,t.dtype,t.dataId,r),this.trainable=e,this.name=s}assign(t){if(t.dtype!==this.dtype)throw new Error(`dtype of the new value (${t.dtype}) and previous value (${this.dtype}) must match`);if(!Oe(t.shape,this.shape))throw new Error(`shape of the new value (${t.shape}) and previous value (${this.shape}) must match`);ri().disposeTensor(this),this.dataId=t.dataId,ri().incRef(this,null)}dispose(){ri().disposeVariable(this),this.isDisposedInternal=!0}}Object.defineProperty(Ty,Symbol.hasInstance,{value:n=>n instanceof Fn&&n.assign!=null&&n.assign instanceof Function});/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */var zk;(function(n){n.R0="R0",n.R1="R1",n.R2="R2",n.R3="R3",n.R4="R4",n.R5="R5",n.R6="R6"})(zk||(zk={}));var nw;(function(n){n.float32="float32",n.int32="int32",n.bool="int32",n.complex64="complex64"})(nw||(nw={}));var sw;(function(n){n.float32="float32",n.int32="int32",n.bool="bool",n.complex64="complex64"})(sw||(sw={}));var rw;(function(n){n.float32="float32",n.int32="float32",n.bool="float32",n.complex64="complex64"})(rw||(rw={}));var iw;(function(n){n.float32="complex64",n.int32="complex64",n.bool="complex64",n.complex64="complex64"})(iw||(iw={}));const yH={float32:rw,int32:nw,bool:sw,complex64:iw};function lr(n,t){if(n==="string"||t==="string"){if(n==="string"&&t==="string")return"string";throw new Error(`Can not upcast ${n} with ${t}`)}return yH[n][t]}function aS(n){return lr(n,"int32")}function hD(n){return n!=null&&typeof n=="object"&&"texture"in n&&n.texture instanceof WebGLTexture}function dD(n){return typeof GPUBuffer<"u"&&n!=null&&typeof n=="object"&&"buffer"in n&&n.buffer instanceof GPUBuffer}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function wn(n,t){if(n.dtype===t.dtype)return[n,t];const e=lr(n.dtype,t.dtype);return[n.cast(e),t.cast(e)]}function fD(n){const t=[];return pD(n,t,new Set),t}function pD(n,t,e){if(n==null)return;if(n instanceof Fn){t.push(n);return}if(!xH(n))return;const s=n;for(const r in s){const i=s[r];e.has(i)||(e.add(i),pD(i,t,e))}}function xH(n){return Array.isArray(n)||typeof n=="object"}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function rv(n){return n.kernelName!=null}class Bk{constructor(){this.registeredVariables={},this.nextTapeNodeId=0,this.numBytes=0,this.numTensors=0,this.numStringTensors=0,this.numDataBuffers=0,this.gradientDepth=0,this.kernelDepth=0,this.scopeStack=[],this.numDataMovesStack=[],this.nextScopeId=0,this.tensorInfo=new WeakMap,this.profiling=!1,this.activeProfile={newBytes:0,newTensors:0,peakBytes:0,kernels:[],result:null,get kernelNames(){return Array.from(new Set(this.kernels.map(t=>t.name)))}}}dispose(){for(const t in this.registeredVariables)this.registeredVariables[t].dispose()}}class Hc{constructor(t){this.ENV=t,this.registry={},this.registryFactory={},this.pendingBackendInitId=0,this.state=new Bk}async ready(){if(this.pendingBackendInit!=null)return this.pendingBackendInit.then(()=>{});if(this.backendInstance!=null)return;const t=this.getSortedBackends();for(let e=0;e<t.length;e++){const s=t[e];if(await this.initializeBackend(s).success){await this.setBackend(s);return}}throw new Error("Could not initialize any backends, all backend initializations failed.")}get backend(){if(this.pendingBackendInit!=null)throw new Error(`Backend '${this.backendName}' has not yet been initialized. Make sure to await tf.ready() or await tf.setBackend() before calling other methods`);if(this.backendInstance==null){const{name:t,asyncInit:e}=this.initializeBackendsAndReturnBest();if(e)throw new Error(`The highest priority backend '${t}' has not yet been initialized. Make sure to await tf.ready() or await tf.setBackend() before calling other methods`);this.setBackend(t)}return this.backendInstance}backendNames(){return Object.keys(this.registryFactory)}findBackend(t){if(!(t in this.registry))if(t in this.registryFactory){const{asyncInit:e}=this.initializeBackend(t);if(e)return null}else return null;return this.registry[t]}findBackendFactory(t){return t in this.registryFactory?this.registryFactory[t].factory:null}registerBackend(t,e,s=1){return t in this.registryFactory?(vr(`${t} backend was already registered. Reusing existing backend factory.`),!1):(this.registryFactory[t]={factory:e,priority:s},!0)}async setBackend(t){if(this.registryFactory[t]==null)throw new Error(`Backend name '${t}' not found in registry`);if(this.backendName=t,this.registry[t]==null){this.backendInstance=null;const{success:e,asyncInit:s}=this.initializeBackend(t);if(!(s?await e:e))return!1}return this.backendInstance=this.registry[t],this.setupRegisteredKernels(),this.profiler=new lH(this.backendInstance),!0}setupRegisteredKernels(){Fk(this.backendName).forEach(e=>{e.setupFunc!=null&&e.setupFunc(this.backendInstance)})}disposeRegisteredKernels(t){Fk(t).forEach(s=>{s.disposeFunc!=null&&s.disposeFunc(this.registry[t])})}initializeBackend(t){const e=this.registryFactory[t];if(e==null)throw new Error(`Cannot initialize backend ${t}, no registration found.`);try{const s=e.factory();if(s&&!(s instanceof fC)&&typeof s.then=="function"){const r=++this.pendingBackendInitId,i=s.then(o=>r<this.pendingBackendInitId?!1:(this.registry[t]=o,this.pendingBackendInit=null,!0)).catch(o=>(r<this.pendingBackendInitId||(this.pendingBackendInit=null,vr(`Initialization of backend ${t} failed`),vr(o.stack||o.message)),!1));return this.pendingBackendInit=i,{success:i,asyncInit:!0}}else return this.registry[t]=s,{success:!0,asyncInit:!1}}catch(s){return vr(`Initialization of backend ${t} failed`),vr(s.stack||s.message),{success:!1,asyncInit:!1}}}removeBackend(t){if(!(t in this.registryFactory))throw new Error(`${t} backend not found in registry`);this.backendName===t&&this.pendingBackendInit!=null&&this.pendingBackendInitId++,t in this.registry&&(this.disposeRegisteredKernels(t),this.registry[t].dispose(),delete this.registry[t]),delete this.registryFactory[t],this.backendName===t&&(this.pendingBackendInit=null,this.backendName=null,this.backendInstance=null)}getSortedBackends(){if(Object.keys(this.registryFactory).length===0)throw new Error("No backend found in registry.");return Object.keys(this.registryFactory).sort((t,e)=>this.registryFactory[e].priority-this.registryFactory[t].priority)}initializeBackendsAndReturnBest(){const t=this.getSortedBackends();for(let e=0;e<t.length;e++){const s=t[e],{success:r,asyncInit:i}=this.initializeBackend(s);if(i||r)return{name:s,asyncInit:i}}throw new Error("Could not initialize any backends, all backend initializations failed.")}moveData(t,e){const s=this.state.tensorInfo.get(e),r=s.backend,i=this.readSync(e),o=r.refCount(e);r.disposeData(e,!0),s.backend=t,t.move(e,i,s.shape,s.dtype,o),this.shouldCheckForMemLeaks()&&this.state.numDataMovesStack[this.state.numDataMovesStack.length-1]++}tidy(t,e){let s=null;if(e==null){if(typeof t!="function")throw new Error("Please provide a function to tidy()");e=t}else{if(typeof t!="string"&&!(t instanceof String))throw new Error("When calling with two arguments, the first argument to tidy() must be a string");if(typeof e!="function")throw new Error("When calling with two arguments, the 2nd argument to tidy() must be a function");s=t}let r;return this.scopedRun(()=>this.startScope(s),()=>this.endScope(r),()=>(r=e(),r instanceof Promise&&console.error("Cannot return a Promise inside of tidy."),r))}scopedRun(t,e,s){t();try{const r=s();return e(),r}catch(r){throw e(),r}}nextTensorId(){return Hc.nextTensorId++}nextVariableId(){return Hc.nextVariableId++}clone(t){const e=et.runKernel(Zf,{x:t}),s={x:t},r=o=>({x:()=>{const l="float32",u={x:o},h={dtype:l};return et.runKernel(Vf,u,h)}}),i=[];return this.addTapeNode(this.state.activeScope.name,s,[e],r,i,{}),e}runKernel(t,e,s){if(this.backendName==null&&this.backend,!(tw(t,this.backendName)!=null))throw new Error(`Kernel '${t}' not registered for backend '${this.backendName}'`);return this.runKernelFunc({kernelName:t,inputs:e,attrs:s})}shouldCheckForMemLeaks(){return this.ENV.getBool("IS_TEST")}checkKernelForMemLeak(t,e,s){const r=this.backend.numDataIds();let i=0;s.forEach(u=>{i+=u.dtype==="complex64"?3:1});const o=this.state.numDataMovesStack[this.state.numDataMovesStack.length-1],l=r-e-i-o;if(l>0)throw new Error(`Backend '${this.backendName}' has an internal memory leak (${l} data ids) after running '${t}'`)}runKernelFunc(t){let e,s=[];const r=this.isTapeOn(),i=this.state.numBytes,o=this.state.numTensors;this.shouldCheckForMemLeaks()&&this.state.numDataMovesStack.push(0);let l;this.backendName==null&&this.backend;let u;const h=rv(t)?t.kernelName:this.state.activeScope!=null?this.state.activeScope.name:"";if(rv(t)){const{kernelName:x,inputs:v,attrs:C}=t;this.backendName==null&&this.backend;const S=tw(x,this.backendName);U(S!=null,()=>`Cannot find registered kernel '${x}' for backend '${this.backendName}'`),l=()=>{const E=this.backend.numDataIds();u=S.kernelFunc({inputs:v,attrs:C,backend:this.backend});const _=Array.isArray(u)?u:[u];this.shouldCheckForMemLeaks()&&this.checkKernelForMemLeak(x,E,_);const I=_.map(O=>O.rank!=null?O:this.makeTensorFromTensorInfo(O));if(r){const O=this.getTensorsForGradient(x,v,I);s=this.saveTensorsForBackwardMode(O)}return I}}else{const{forwardFunc:x}=t,v=C=>{r&&(s=C.map(S=>this.keep(this.clone(S))))};l=()=>{const C=this.backend.numDataIds();u=this.tidy(()=>x(this.backend,v));const S=Array.isArray(u)?u:[u];return this.shouldCheckForMemLeaks()&&this.checkKernelForMemLeak(h,C,S),S}}const{inputs:d,attrs:p}=t,m=rv(t)?null:t.backwardsFunc;let y;return this.scopedRun(()=>this.state.kernelDepth++,()=>this.state.kernelDepth--,()=>{!this.ENV.getBool("DEBUG")&&!this.state.profiling?e=l():(y=this.profiler.profileKernel(h,d,()=>l()),this.ENV.getBool("DEBUG")&&this.profiler.logKernelProfile(y),e=y.outputs)}),r&&this.addTapeNode(h,d,e,m,s,p),this.state.profiling&&this.state.activeProfile.kernels.push({name:h,bytesAdded:this.state.numBytes-i,totalBytesSnapshot:this.state.numBytes,tensorsAdded:this.state.numTensors-o,totalTensorsSnapshot:this.state.numTensors,inputShapes:Object.keys(d).map(x=>d[x]!=null?d[x].shape:null),outputShapes:e.map(x=>x.shape),kernelTimeMs:y.timeMs,extraInfo:y.extraInfo}),Array.isArray(u)?e:e[0]}saveTensorsForBackwardMode(t){return t.map(s=>this.keep(this.clone(s)))}getTensorsForGradient(t,e,s){const r=Mk(t);if(r!=null){const i=r.inputsToSave||[],o=r.outputsToSave||[];let l;r.saveAllInputs?(U(Array.isArray(e),()=>"saveAllInputs is true, expected inputs to be an array."),l=Object.keys(e).map(h=>e[h])):l=i.map(h=>e[h]);const u=s.filter((h,d)=>o[d]);return l.concat(u)}return[]}makeTensor(t,e,s,r){if(t==null)throw new Error("Values passed to engine.makeTensor() are null");s=s||"float32",r=r||this.backend;let i=t;s==="string"&&Rf(t[0])&&(i=t.map(u=>Ma(u)));const o=r.write(i,e,s),l=new Fn(e,s,o,this.nextTensorId());if(this.trackTensor(l,r),s==="string"){const u=this.state.tensorInfo.get(o),h=zW(i);this.state.numBytes+=h-u.bytes,u.bytes=h}return l}makeTensorFromDataId(t,e,s,r){s=s||"float32";const i={dataId:t,shape:e,dtype:s};return this.makeTensorFromTensorInfo(i,r)}makeTensorFromTensorInfo(t,e){const{dataId:s,shape:r,dtype:i}=t,o=new Fn(r,i,s,this.nextTensorId());return this.trackTensor(o,e),o}makeVariable(t,e=!0,s,r){s=s||this.nextVariableId().toString(),r!=null&&r!==t.dtype&&(t=t.cast(r));const i=new Ty(t,e,s,this.nextTensorId());if(this.state.registeredVariables[i.name]!=null)throw new Error(`Variable with name ${i.name} was already registered`);return this.state.registeredVariables[i.name]=i,this.incRef(i,this.backend),i}trackTensor(t,e){this.state.numTensors++,t.dtype==="string"&&this.state.numStringTensors++;let s=0;t.dtype!=="complex64"&&t.dtype!=="string"&&(s=t.size*vy(t.dtype)),this.state.numBytes+=s,this.state.tensorInfo.has(t.dataId)||(this.state.numDataBuffers++,this.state.tensorInfo.set(t.dataId,{backend:e||this.backend,dtype:t.dtype,shape:t.shape,bytes:s})),t instanceof Ty||this.track(t)}incRef(t,e){this.trackTensor(t,e),this.backend.incRef(t.dataId)}removeDataId(t,e){this.state.tensorInfo.has(t)&&this.state.tensorInfo.get(t).backend===e&&(this.state.tensorInfo.delete(t),this.state.numDataBuffers--)}disposeTensor(t){if(!this.state.tensorInfo.has(t.dataId))return;const e=this.state.tensorInfo.get(t.dataId);if(this.state.numTensors--,t.dtype==="string"&&(this.state.numStringTensors--,this.state.numBytes-=e.bytes),t.dtype!=="complex64"&&t.dtype!=="string"){const s=t.size*vy(t.dtype);this.state.numBytes-=s}e.backend.disposeData(t.dataId)&&this.removeDataId(t.dataId,e.backend)}disposeVariables(){for(const t in this.state.registeredVariables){const e=this.state.registeredVariables[t];this.disposeVariable(e)}}disposeVariable(t){this.disposeTensor(t),this.state.registeredVariables[t.name]!=null&&delete this.state.registeredVariables[t.name]}memory(){const t=this.backend.memory();return t.numTensors=this.state.numTensors,t.numDataBuffers=this.state.numDataBuffers,t.numBytes=this.state.numBytes,this.state.numStringTensors>0&&(t.unreliable=!0,t.reasons==null&&(t.reasons=[]),t.reasons.push("Memory usage by string tensors is approximate (2 bytes per character)")),t}async profile(t){this.state.profiling=!0;const e=this.state.numBytes,s=this.state.numTensors;this.state.activeProfile.kernels=[],this.state.activeProfile.result=await t(),this.state.profiling=!1,this.state.activeProfile.peakBytes=Math.max(...this.state.activeProfile.kernels.map(r=>r.totalBytesSnapshot)),this.state.activeProfile.newBytes=this.state.numBytes-e,this.state.activeProfile.newTensors=this.state.numTensors-s;for(const r of this.state.activeProfile.kernels)r.kernelTimeMs=await r.kernelTimeMs,r.extraInfo=await r.extraInfo;return this.state.activeProfile}isTapeOn(){return this.state.gradientDepth>0&&this.state.kernelDepth===0}addTapeNode(t,e,s,r,i,o){const l={id:this.state.nextTapeNodeId++,kernelName:t,inputs:e,outputs:s,saved:i},u=Mk(t);u!=null&&(r=u.gradFunc),r!=null&&(l.gradient=h=>(h=h.map((d,p)=>{if(d==null){const m=s[p],y=Ts(m.size,m.dtype);return this.makeTensor(y,m.shape,m.dtype)}return d}),r(h.length>1?h:h[0],i,o))),this.state.activeTape.push(l)}keep(t){return t.kept=!0,t}startTape(){this.state.gradientDepth===0&&(this.state.activeTape=[]),this.state.gradientDepth++}endTape(){this.state.gradientDepth--}startScope(t){const e={track:[],name:"unnamed scope",id:this.state.nextScopeId++};t&&(e.name=t),this.state.scopeStack.push(e),this.state.activeScope=e}endScope(t){const e=fD(t),s=new Set(e.map(i=>i.id));for(let i=0;i<this.state.activeScope.track.length;i++){const o=this.state.activeScope.track[i];!o.kept&&!s.has(o.id)&&o.dispose()}const r=this.state.scopeStack.pop();this.state.activeScope=this.state.scopeStack.length===0?null:this.state.scopeStack[this.state.scopeStack.length-1],e.forEach(i=>{!i.kept&&i.scopeId===r.id&&this.track(i)})}gradients(t,e,s,r=!1){if(U(e.length>0,()=>"gradients() received an empty list of xs."),s!=null&&s.dtype!=="float32")throw new Error(`dy must have 'float32' dtype, but has '${s.dtype}'`);const i=this.scopedRun(()=>this.startTape(),()=>this.endTape(),()=>this.tidy("forward",t));U(i instanceof Fn,()=>"The result y returned by f() must be a tensor.");const o=hH(this.state.activeTape,e,i);if(!r&&o.length===0&&e.length>0)throw new Error("Cannot compute gradient of y=f(x) with respect to x. Make sure that the f you passed encloses all operations that lead from x to y.");return this.tidy("backward",()=>{const l={};l[i.id]=s??bH(i.shape),dH(l,o,h=>this.tidy(h),vH);const u=e.map(h=>l[h.id]);return this.state.gradientDepth===0&&(this.state.activeTape.forEach(h=>{for(const d of h.saved)d.dispose()}),this.state.activeTape=null),{value:i,grads:u}})}customGrad(t){return U(Kv(t),()=>"The f passed in customGrad(f) must be a function."),(...e)=>{U(e.every(l=>l instanceof Fn),()=>"The args passed in customGrad(f)(x1, x2,...) must all be tensors");let s;const r={};e.forEach((l,u)=>{r[u]=l});const i=(l,u)=>(s=t(...e,u),U(s.value instanceof Fn,()=>"The function f passed in customGrad(f) must return an object where `obj.value` is a tensor"),U(Kv(s.gradFunc),()=>"The function f passed in customGrad(f) must return an object where `obj.gradFunc` is a function."),s.value),o=(l,u)=>{const h=s.gradFunc(l,u),d=Array.isArray(h)?h:[h];U(d.length===e.length,()=>"The function f passed in customGrad(f) must return an object where `obj.gradFunc` is a function that returns the same number of tensors as inputs passed to f(...)."),U(d.every(m=>m instanceof Fn),()=>"The function f passed in customGrad(f) must return an object where `obj.gradFunc` is a function that returns a list of only tensors.");const p={};return d.forEach((m,y)=>{p[y]=()=>m}),p};return this.runKernelFunc({forwardFunc:i,backwardsFunc:o,inputs:r})}}readSync(t){return this.state.tensorInfo.get(t).backend.readSync(t)}read(t){return this.state.tensorInfo.get(t).backend.read(t)}readToGPU(t,e){return this.state.tensorInfo.get(t).backend.readToGPU(t,e)}async time(t){const e=qs(),s=await this.backend.time(t);return s.wallMs=qs()-e,s}track(t){return this.state.activeScope!=null&&(t.scopeId=this.state.activeScope.id,this.state.activeScope.track.push(t)),t}get registeredVariables(){return this.state.registeredVariables}reset(){this.pendingBackendInitId++,this.state.dispose(),this.ENV.reset(),this.state=new Bk;for(const t in this.registry)this.disposeRegisteredKernels(t),this.registry[t].dispose(),delete this.registry[t];this.backendName=null,this.backendInstance=null,this.pendingBackendInit=null}}Hc.nextTensorId=0;Hc.nextVariableId=0;function bH(n){const t=yC(yt(n),"float32");return et.makeTensor(t,n,"float32")}function mD(){const n=M$();if(n._tfengine==null){const t=new GW(n);n._tfengine=new Hc(t)}return jW(n._tfengine.ENV),mH(()=>n._tfengine),n._tfengine}const et=mD();function vH(n,t){const e={a:n,b:t};return et.runKernel(ch,e)}/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function wH(){return typeof navigator<"u"&&navigator!=null}function gD(n){if(n||wH()){if(n||(n=navigator),n.product==="ReactNative")return!0;const t=n.userAgent||n.vendor||(typeof window<"u"?window.opera:"");if(!t){const e=n;return e.userAgentData&&e.userAgentData.mobile}return/(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows ce|xda|xiino/i.test(t)||/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\-|your|zeto|zte\-/i.test(t.substr(0,4))}return!1}function yD(){return typeof window<"u"&&window.document!=null||typeof WorkerGlobalScope<"u"}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Ys=dt();Ys.registerFlag("DEBUG",()=>!1,n=>{n&&console.warn("Debugging mode is ON. The output of every math call will be downloaded to CPU and checked for NaNs. This significantly impacts performance.")});Ys.registerFlag("IS_BROWSER",()=>yD());Ys.registerFlag("IS_NODE",()=>typeof process<"u"&&typeof process.versions<"u"&&typeof process.versions.node<"u");Ys.registerFlag("IS_CHROME",()=>typeof navigator<"u"&&navigator!=null&&navigator.userAgent!=null&&/Chrome/.test(navigator.userAgent)&&/Google Inc/.test(navigator.vendor));Ys.registerFlag("IS_SAFARI",()=>typeof navigator<"u"&&navigator!=null&&navigator.userAgent!=null&&/Safari/.test(navigator.userAgent)&&/Apple/.test(navigator.vendor));Ys.registerFlag("PROD",()=>!1);Ys.registerFlag("TENSORLIKE_CHECK_SHAPE_CONSISTENCY",()=>Ys.getBool("DEBUG"));Ys.registerFlag("DEPRECATION_WARNINGS_ENABLED",()=>!0);Ys.registerFlag("IS_TEST",()=>!1);Ys.registerFlag("CHECK_COMPUTATION_FOR_ERRORS",()=>Ys.getBool("DEBUG"));Ys.registerFlag("WRAP_TO_IMAGEBITMAP",()=>!1);Ys.registerFlag("CANVAS2D_WILL_READ_FREQUENTLY_FOR_GPU",()=>!1);Ys.registerFlag("USE_SETTIMEOUTCUSTOM",()=>!1);/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function _p(n,t){let e=n;if(qr(n))return t==="string"?[]:[n.length];if(hD(n)){const r=n.channels||"RGBA";return[n.height,n.width*r.length]}else if(dD(n))return[n.buffer.size/(t==null?4:vy(t))];if(!Array.isArray(n))return[];const s=[];for(;Array.isArray(e)||qr(e)&&t!=="string";)s.push(e.length),e=e[0];return Array.isArray(n)&&dt().getBool("TENSORLIKE_CHECK_SHAPE_CONSISTENCY")&&xD(n,s,[]),s}function xD(n,t,e){if(e=e||[],!Array.isArray(n)&&!qr(n)){U(t.length===0,()=>`Element arr[${e.join("][")}] is a primitive, but should be an array/TypedArray of ${t[0]} elements`);return}U(t.length>0,()=>`Element arr[${e.join("][")}] should be a primitive, but is an array of ${n.length} elements`),U(n.length===t[0],()=>`Element arr[${e.join("][")}] should have ${t[0]} elements, but has ${n.length} elements`);const s=t.slice(1);for(let r=0;r<n.length;++r)xD(n[r],s,e.concat(r))}function Uk(n,t,e,s){if(n!=="string_or_numeric"){if(n==null)throw new Error("Expected dtype cannot be null.");if(n!=="numeric"&&n!==t||n==="numeric"&&t==="string")throw new Error(`Argument '${e}' passed to '${s}' must be ${n} tensor, but got ${t} tensor`)}}function H(n,t,e,s="numeric"){if(n instanceof mt())return Uk(s,n.dtype,t,e),n;let r=lh(n);if(r!=="string"&&["bool","int32","float32"].indexOf(s)>=0&&(r=s),Uk(s,r,t,e),n==null||!qr(n)&&!Array.isArray(n)&&typeof n!="number"&&typeof n!="boolean"&&typeof n!="string"){const u=n==null?"null":n.constructor.name;throw new Error(`Argument '${t}' passed to '${e}' must be a Tensor or TensorLike, but got '${u}'`)}const i=_p(n,r);!qr(n)&&!Array.isArray(n)&&(n=[n]);const l=r!=="string"?vu(n,r):eu(n,[],!0);return et.makeTensor(l,i,r)}function bD(n,t,e,s="numeric"){if(!Array.isArray(n))throw new Error(`Argument ${t} passed to ${e} must be a \`Tensor[]\` or \`TensorLike[]\``);return n.map((i,o)=>H(i,`${t}[${o}]`,e,s))}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const CH="__op";function it(n){const t=Object.keys(n);if(t.length!==1)throw new Error(`Please provide an object with a single key (operation name) mapping to a function. Got an object with ${t.length} keys.`);let e=t[0];const s=n[e];e.endsWith("_")&&(e=e.substring(0,e.length-1)),e=e+CH;const r=(...i)=>{et.startScope(e);try{const o=s(...i);return xC(o)&&console.error("Cannot return a Promise inside of tidy."),et.endScope(o),o}catch(o){throw et.endScope(null),o}};return Object.defineProperty(r,"name",{value:e,configurable:!0}),r}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function SH(n,t){const e=H(n,"real","complex"),s=H(t,"imag","complex");mC(e.shape,s.shape,`real and imag shapes, ${e.shape} and ${s.shape}, must match in call to tf.complex().`);const r={real:e,imag:s};return et.runKernel(_C,r)}const nu=it({complex_:SH});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function kp(n,t,e,s){if(s==null)s=lh(n);else if(s==="complex64")throw new Error("Cannot construct a complex64 tensor directly. Please use tf.complex(real, imag).");if(dD(n)||hD(n)){if(s!=="float32"&&s!=="int32")throw new Error(`Creating tensor from GPU data only supports 'float32'|'int32' dtype, while the dtype is ${s}.`);return et.backend.createTensorFromGPUData(n,t||e,s)}if(!qr(n)&&!Array.isArray(n)&&typeof n!="number"&&typeof n!="boolean"&&typeof n!="string")throw new Error("values passed to tensor(values) must be a number/boolean/string or an array of numbers/booleans/strings, or a TypedArray");if(t!=null){Ho(t);const r=yt(t),i=yt(e);U(r===i,()=>`Based on the provided shape, [${t}], the tensor should have ${r} values but has ${i}`);for(let o=0;o<e.length;++o){const l=e[o],u=o===e.length-1?l!==yt(t.slice(o)):!0;U(e[o]===t[o]||!u,()=>`Error creating a new Tensor. Inferred shape (${e}) does not match the provided shape (${t}). `)}}return!qr(n)&&!Array.isArray(n)&&(n=[n]),t=t||e,n=s!=="string"?vu(n,s):eu(n,[],!0),et.makeTensor(n,t,s)}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Qd(n,t,e){const s=_p(n,e);return kp(n,t,s,e)}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Ey={float32:4,float16:2,int32:4,uint16:2,uint8:1,bool:1,complex64:8};class Za{static join(t){return new Za(t).slice()}constructor(t){if(this.shards=[],this.previousShardIndex=0,t==null||(t instanceof Array||(t=[t]),t=t.map(s=>qr(s)?s.buffer:s),t.length===0))return;this.bufferUniformSize=t[0].byteLength;let e=0;for(let s=0;s<t.length;s++){const r=t[s];s!==t.length-1&&r.byteLength!==this.bufferUniformSize&&(this.bufferUniformSize=void 0);const i=e+r.byteLength;this.shards.push({buffer:r,start:e,end:i}),e=i}this.shards.length===0&&(this.byteLength=0),this.byteLength=this.shards[this.shards.length-1].end}slice(t=0,e=this.byteLength){if(this.shards.length===0)return new ArrayBuffer(0);if(t=isNaN(Number(t))?0:t,e=isNaN(Number(e))?0:e,t=Math.max(0,t),e=Math.min(this.byteLength,e),e<=t)return new ArrayBuffer(0);const s=this.findShardForByte(t);if(s===-1)throw new Error(`Could not find start shard for byte ${t}`);const r=e-t,i=new ArrayBuffer(r),o=new Uint8Array(i);let l=0;for(let u=s;u<this.shards.length;u++){const h=this.shards[u],p=t+l-h.start,m=l,x=Math.min(e,h.end)-h.start,v=new Uint8Array(h.buffer,p,x-p);if(o.set(v,m),l+=v.length,e<h.end)break}return i}findShardForByte(t){if(this.shards.length===0||t<0||t>=this.byteLength)return-1;if(this.bufferUniformSize!=null)return this.previousShardIndex=Math.floor(t/this.bufferUniformSize),this.previousShardIndex;function e(r){return t<r.start?-1:t>=r.end?1:0}if(e(this.shards[this.previousShardIndex])===0)return this.previousShardIndex;const s=TH(this.shards,e);return s===-1?-1:(this.previousShardIndex=s,this.previousShardIndex)}}function TH(n,t){let e=0,s=n.length;for(;e<=s;){const r=Math.floor((s-e)/2)+e,i=t(n[r]);if(i===0)return r;i<0?s=r:e=r+1}return-1}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function $i(){return et}function Gk(){return et.memory()}function ct(n,t){return et.tidy(n,t)}function oe(n){fD(n).forEach(e=>e.dispose())}function Ui(n){return et.keep(n)}function vD(n,t,e=1){return et.registerBackend(n,t,e)}function EH(){return et.backend}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const qc=4;async function Wk(n,t){const e=[],s=[],r=Array.isArray(n)?n.map(o=>o.name):Object.keys(n);for(let o=0;o<r.length;++o){const l=r[o],u=Array.isArray(n)?n[o].tensor:n[l];if(u.dtype!=="float32"&&u.dtype!=="int32"&&u.dtype!=="bool"&&u.dtype!=="string"&&u.dtype!=="complex64")throw new Error(`Unsupported dtype in weight '${l}': ${u.dtype}`);const h={name:l,shape:u.shape,dtype:u.dtype};if(u.dtype==="string"){const d=new Promise(async p=>{const m=await u.bytes(),y=m.reduce((C,S)=>C+S.length,0)+qc*m.length,x=new Uint8Array(y);let v=0;for(let C=0;C<m.length;C++){const S=m[C],E=new Uint8Array(new Uint32Array([S.length]).buffer);x.set(E,v),v+=qc,x.set(S,v),v+=S.length}p(x)});s.push(d)}else s.push(u.data());t!=null&&(h.group=t),e.push(h)}const i=await Promise.all(s);return{data:AH(i),specs:e}}function IH(n,t){const e=new Za(n),s={};let r=0;for(const i of t){const o=_H(i,(l,u)=>e.slice(r+l,r+u));s[i.name]=kH(i,e.slice(r,r+o)),r+=o}return s}function _H(n,t){const e=yt(n.shape);let s;if("quantization"in n){const r=n.quantization;s=Ey[r.dtype]}else if(n.dtype==="string"){let r=0;for(let i=0;i<e;i++)r+=qc+new Uint32Array(t(r,r+qc))[0];return r}else s=Ey[n.dtype];return e*s}function kH(n,t){const e=n.name,s=n.dtype,r=n.shape,i=yt(r);let o,l=0;if("quantization"in n){const u=n.quantization;if(u.dtype==="uint8"||u.dtype==="uint16"){if(!("min"in u&&"scale"in u))throw new Error(`Weight ${n.name} with quantization ${u.dtype} doesn't have corresponding metadata min and scale.`)}else if(u.dtype==="float16"){if(s!=="float32")throw new Error(`Weight ${n.name} is quantized with ${u.dtype} which only supports weights of type float32 not ${s}.`)}else throw new Error(`Weight ${n.name} has unknown quantization dtype ${u.dtype}. Supported quantization dtypes are: 'uint8', 'uint16', and 'float16'.`);const h=Ey[u.dtype],d=u.dtype==="uint8"?new Uint8Array(t):new Uint16Array(t);if(s==="float32")if(u.dtype==="uint8"||u.dtype==="uint16"){o=new Float32Array(d.length);for(let p=0;p<d.length;p++){const m=d[p];o[p]=m*u.scale+u.min}}else if(u.dtype==="float16")o=VH()(d);else throw new Error(`Unsupported quantization type ${u.dtype} for weight type float32.`);else if(s==="int32"){if(u.dtype!=="uint8"&&u.dtype!=="uint16")throw new Error(`Unsupported quantization type ${u.dtype} for weight type int32.`);o=new Int32Array(d.length);for(let p=0;p<d.length;p++){const m=d[p];o[p]=Math.round(m*u.scale+u.min)}}else throw new Error(`Unsupported dtype in weight '${e}': ${s}`);l+=i*h}else if(s==="string"){const u=yt(n.shape);o=[];for(let h=0;h<u;h++){const d=new Uint32Array(t.slice(l,l+qc))[0];l+=qc;const p=new Uint8Array(t.slice(l,l+d));o.push(p),l+=d}}else{const u=Ey[s];if(s==="float32")o=new Float32Array(t);else if(s==="int32")o=new Int32Array(t);else if(s==="bool")o=new Uint8Array(t);else if(s==="complex64"){o=new Float32Array(t);const h=new Float32Array(o.length/2),d=new Float32Array(o.length/2);for(let x=0;x<h.length;x++)h[x]=o[x*2],d[x]=o[x*2+1];const p=Qd(h,r,"float32"),m=Qd(d,r,"float32"),y=nu(p,m);return p.dispose(),m.dispose(),y}else throw new Error(`Unsupported dtype in weight '${e}': ${s}`);l+=i*u}return Qd(o,r,s)}function AH(n){if(n===null)throw new Error(`Invalid input value: ${JSON.stringify(n)}`);let t=0;const e=[];n.forEach(i=>{if(t+=i.byteLength,e.push(i.byteLength===i.buffer.byteLength?i:new i.constructor(i)),!(i instanceof Float32Array||i instanceof Int32Array||i instanceof Uint8Array))throw new Error(`Unsupported TypedArray subtype: ${i.constructor.name}`)});const s=new Uint8Array(t);let r=0;return e.forEach(i=>{s.set(new Uint8Array(i.buffer),r),r+=i.byteLength}),s.buffer}const lS=typeof Buffer<"u"&&(typeof Blob>"u"||typeof atob>"u"||typeof btoa>"u");function Hk(n){return lS?Buffer.byteLength(n,"utf8"):new Blob([n]).size}function NH(n){if(lS)return Buffer.from(n).toString("base64");const t=new Uint8Array(n);let e="";for(let s=0,r=t.length;s<r;s++)e+=String.fromCharCode(t[s]);return btoa(e)}function RH(n){if(lS){const s=Buffer.from(n,"base64");return s.buffer.slice(s.byteOffset,s.byteOffset+s.byteLength)}const t=atob(n),e=new Uint8Array(t.length);for(let s=0;s<t.length;++s)e.set([t.charCodeAt(s)],s);return e.buffer}function $H(n){return Za.join(n)}function DH(n,t){const e={modelTopology:n.modelTopology,format:n.format,generatedBy:n.generatedBy,convertedBy:n.convertedBy,weightsManifest:t};return n.signature!=null&&(e.signature=n.signature),n.userDefinedMetadata!=null&&(e.userDefinedMetadata=n.userDefinedMetadata),n.modelInitializer!=null&&(e.modelInitializer=n.modelInitializer),n.initializerSignature!=null&&(e.initializerSignature=n.initializerSignature),n.trainingConfig!=null&&(e.trainingConfig=n.trainingConfig),e}function OH(n,t,e){const s={modelTopology:n.modelTopology,format:n.format,generatedBy:n.generatedBy,convertedBy:n.convertedBy};if(n.trainingConfig!=null&&(s.trainingConfig=n.trainingConfig),n.weightsManifest!=null){if(!t)throw new Error("modelJSON has weightsManifest but weightSpecs is null");if(!e)throw new Error("modelJSON has weightsManifest but weightData is null");s.weightSpecs=t,s.weightData=e}return n.signature!=null&&(s.signature=n.signature),n.userDefinedMetadata!=null&&(s.userDefinedMetadata=n.userDefinedMetadata),n.modelInitializer!=null&&(s.modelInitializer=n.modelInitializer),n.initializerSignature!=null&&(s.initializerSignature=n.initializerSignature),s}async function MH(n,t){let e,s;return n.weightsManifest!=null&&([e,s]=await t(n.weightsManifest)),OH(n,e,s)}function uS(n){if(n.modelTopology instanceof ArrayBuffer)throw new Error("Expected JSON model topology, received ArrayBuffer.");return{dateSaved:new Date,modelTopologyType:"JSON",modelTopologyBytes:n.modelTopology==null?0:Hk(JSON.stringify(n.modelTopology)),weightSpecsBytes:n.weightSpecs==null?0:Hk(JSON.stringify(n.weightSpecs)),weightDataBytes:n.weightData==null?0:new Za(n.weightData).byteLength}}function qk(n){const t=[];for(const e of n)t.push(...e.weights);return t}function FH(){const n=e=>{let s=e<<13,r=0;for(;(s&8388608)===0;)r-=8388608,s<<=1;return s&=-8388609,r+=947912704,s|r},t=new Uint32Array(2048);t[0]=0;for(let e=1;e<1024;e++)t[e]=n(e);for(let e=1024;e<2048;e++)t[e]=939524096+(e-1024<<13);return t}function LH(){const n=new Uint32Array(64);n[0]=0,n[31]=1199570944,n[32]=2147483648,n[63]=3347054592;for(let t=1;t<31;t++)n[t]=t<<23;for(let t=33;t<63;t++)n[t]=2147483648+(t-32<<23);return n}function PH(){const n=new Uint32Array(64);for(let t=0;t<64;t++)n[t]=1024;return n[0]=n[32]=0,n}function VH(){const n=FH(),t=LH(),e=PH();return s=>{const r=new ArrayBuffer(4*s.length),i=new Uint32Array(r);for(let o=0;o<s.length;o++){const l=s[o],u=n[e[l>>10]+(l&1023)]+t[l>>10];i[o]=u}return new Float32Array(r)}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Kn{constructor(){this.saveRouters=[],this.loadRouters=[]}static getInstance(){return Kn.instance==null&&(Kn.instance=new Kn),Kn.instance}static registerSaveRouter(t){Kn.getInstance().saveRouters.push(t)}static registerLoadRouter(t){Kn.getInstance().loadRouters.push(t)}static getSaveHandlers(t){return Kn.getHandlers(t,"save")}static getLoadHandlers(t,e){return Kn.getHandlers(t,"load",e)}static getHandlers(t,e,s){const r=[];return(e==="load"?Kn.getInstance().loadRouters:Kn.getInstance().saveRouters).forEach(o=>{const l=o(t,s);l!==null&&r.push(l)}),r}}const zH=n=>Kn.getSaveHandlers(n),BH=(n,t)=>Kn.getLoadHandlers(n,t);/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const ow="tensorflowjs",aw=1,jl="models_store",Ia="model_info_store";function wD(){if(!dt().getBool("IS_BROWSER"))throw new Error("Failed to obtain IndexedDB factory because the current environmentis not a web browser.");const n=typeof window>"u"?self:window,t=n.indexedDB||n.mozIndexedDB||n.webkitIndexedDB||n.msIndexedDB||n.shimIndexedDB;if(t==null)throw new Error("The current browser does not appear to support IndexedDB.");return t}function lw(n){const t=n.result;t.createObjectStore(jl,{keyPath:"modelPath"}),t.createObjectStore(Ia,{keyPath:"modelPath"})}class su{constructor(t){if(this.indexedDB=wD(),t==null||!t)throw new Error("For IndexedDB, modelPath must not be null, undefined or empty.");this.modelPath=t}async save(t){if(t.modelTopology instanceof ArrayBuffer)throw new Error("BrowserLocalStorage.save() does not support saving model topology in binary formats yet.");return this.databaseAction(this.modelPath,t)}async load(){return this.databaseAction(this.modelPath)}databaseAction(t,e){return new Promise((s,r)=>{const i=this.indexedDB.open(ow,aw);i.onupgradeneeded=()=>lw(i),i.onsuccess=()=>{const o=i.result;if(e==null){const l=o.transaction(jl,"readonly"),h=l.objectStore(jl).get(this.modelPath);h.onsuccess=()=>{if(h.result==null)return o.close(),r(new Error(`Cannot find model with path '${this.modelPath}' in IndexedDB.`));s(h.result.modelArtifacts)},h.onerror=d=>(o.close(),r(h.error)),l.oncomplete=()=>o.close()}else{e.weightData=Za.join(e.weightData);const l=uS(e),u=o.transaction(Ia,"readwrite");let h=u.objectStore(Ia),d;try{d=h.put({modelPath:this.modelPath,modelArtifactsInfo:l})}catch(m){return r(m)}let p;d.onsuccess=()=>{p=o.transaction(jl,"readwrite");const m=p.objectStore(jl);let y;try{y=m.put({modelPath:this.modelPath,modelArtifacts:e,modelArtifactsInfo:l})}catch(x){return r(x)}y.onsuccess=()=>s({modelArtifactsInfo:l}),y.onerror=x=>{h=u.objectStore(Ia);const v=h.delete(this.modelPath);v.onsuccess=()=>(o.close(),r(y.error)),v.onerror=C=>(o.close(),r(y.error))}},d.onerror=m=>(o.close(),r(d.error)),u.oncomplete=()=>{p==null?o.close():p.oncomplete=()=>o.close()}}},i.onerror=o=>r(i.error)})}}su.URL_SCHEME="indexeddb://";const CD=n=>dt().getBool("IS_BROWSER")&&!Array.isArray(n)&&n.startsWith(su.URL_SCHEME)?UH(n.slice(su.URL_SCHEME.length)):null;Kn.registerSaveRouter(CD);Kn.registerLoadRouter(CD);function UH(n){return new su(n)}function GH(n){return n.startsWith(su.URL_SCHEME)?n.slice(su.URL_SCHEME.length):n}class WH{constructor(){this.indexedDB=wD()}async listModels(){return new Promise((t,e)=>{const s=this.indexedDB.open(ow,aw);s.onupgradeneeded=()=>lw(s),s.onsuccess=()=>{const r=s.result,i=r.transaction(Ia,"readonly"),l=i.objectStore(Ia).getAll();l.onsuccess=()=>{const u={};for(const h of l.result)u[h.modelPath]=h.modelArtifactsInfo;t(u)},l.onerror=u=>(r.close(),e(l.error)),i.oncomplete=()=>r.close()},s.onerror=r=>e(s.error)})}async removeModel(t){return t=GH(t),new Promise((e,s)=>{const r=this.indexedDB.open(ow,aw);r.onupgradeneeded=()=>lw(r),r.onsuccess=()=>{const i=r.result,o=i.transaction(Ia,"readwrite"),l=o.objectStore(Ia),u=l.get(t);let h;u.onsuccess=()=>{if(u.result==null)return i.close(),s(new Error(`Cannot find model with path '${t}' in IndexedDB.`));{const d=l.delete(t),p=()=>{h=i.transaction(jl,"readwrite");const y=h.objectStore(jl).delete(t);y.onsuccess=()=>e(u.result.modelArtifactsInfo),y.onerror=x=>s(u.error)};d.onsuccess=p,d.onerror=m=>(p(),i.close(),s(u.error))}},u.onerror=d=>(i.close(),s(u.error)),o.oncomplete=()=>{h==null?i.close():h.oncomplete=()=>i.close()}},r.onerror=i=>s(r.error)})}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const $o="/",Ac="tensorflowjs_models",SD="info",HH="model_topology",qH="weight_specs",jH="weight_data",KH="model_metadata";function TD(n){return{info:[Ac,n,SD].join($o),topology:[Ac,n,HH].join($o),weightSpecs:[Ac,n,qH].join($o),weightData:[Ac,n,jH].join($o),modelMetadata:[Ac,n,KH].join($o)}}function ED(n){for(const t of Object.values(n))window.localStorage.removeItem(t)}function XH(n){const t=n.split($o);if(t.length<3)throw new Error(`Invalid key format: ${n}`);return t.slice(1,t.length-1).join($o)}function YH(n){return n.startsWith(ru.URL_SCHEME)?n.slice(ru.URL_SCHEME.length):n}class ru{constructor(t){if(!dt().getBool("IS_BROWSER")||typeof window>"u"||typeof window.localStorage>"u")throw new Error("The current environment does not support local storage.");if(this.LS=window.localStorage,t==null||!t)throw new Error("For local storage, modelPath must not be null, undefined or empty.");this.modelPath=t,this.keys=TD(this.modelPath)}async save(t){if(t.modelTopology instanceof ArrayBuffer)throw new Error("BrowserLocalStorage.save() does not support saving model topology in binary formats yet.");{const e=JSON.stringify(t.modelTopology),s=JSON.stringify(t.weightSpecs),r=uS(t),i=Za.join(t.weightData);try{this.LS.setItem(this.keys.info,JSON.stringify(r)),this.LS.setItem(this.keys.topology,e),this.LS.setItem(this.keys.weightSpecs,s),this.LS.setItem(this.keys.weightData,NH(i));const o={format:t.format,generatedBy:t.generatedBy,convertedBy:t.convertedBy,signature:t.signature!=null?t.signature:void 0,userDefinedMetadata:t.userDefinedMetadata!=null?t.userDefinedMetadata:void 0,modelInitializer:t.modelInitializer!=null?t.modelInitializer:void 0,initializerSignature:t.initializerSignature!=null?t.initializerSignature:void 0,trainingConfig:t.trainingConfig!=null?t.trainingConfig:void 0};return this.LS.setItem(this.keys.modelMetadata,JSON.stringify(o)),{modelArtifactsInfo:r}}catch{throw ED(this.keys),new Error(`Failed to save model '${this.modelPath}' to local storage: size quota being exceeded is a possible cause of this failure: modelTopologyBytes=${r.modelTopologyBytes}, weightSpecsBytes=${r.weightSpecsBytes}, weightDataBytes=${r.weightDataBytes}.`)}}}async load(){const t=JSON.parse(this.LS.getItem(this.keys.info));if(t==null)throw new Error(`In local storage, there is no model with name '${this.modelPath}'`);if(t.modelTopologyType!=="JSON")throw new Error("BrowserLocalStorage does not support loading non-JSON model topology yet.");const e={},s=JSON.parse(this.LS.getItem(this.keys.topology));if(s==null)throw new Error(`In local storage, the topology of model '${this.modelPath}' is missing.`);e.modelTopology=s;const r=JSON.parse(this.LS.getItem(this.keys.weightSpecs));if(r==null)throw new Error(`In local storage, the weight specs of model '${this.modelPath}' are missing.`);e.weightSpecs=r;const i=this.LS.getItem(this.keys.modelMetadata);if(i!=null){const l=JSON.parse(i);e.format=l.format,e.generatedBy=l.generatedBy,e.convertedBy=l.convertedBy,l.signature!=null&&(e.signature=l.signature),l.userDefinedMetadata!=null&&(e.userDefinedMetadata=l.userDefinedMetadata),l.modelInitializer!=null&&(e.modelInitializer=l.modelInitializer),l.initializerSignature!=null&&(e.initializerSignature=l.initializerSignature),l.trainingConfig!=null&&(e.trainingConfig=l.trainingConfig)}const o=this.LS.getItem(this.keys.weightData);if(o==null)throw new Error(`In local storage, the binary weight values of model '${this.modelPath}' are missing.`);return e.weightData=RH(o),e}}ru.URL_SCHEME="localstorage://";const ID=n=>dt().getBool("IS_BROWSER")&&!Array.isArray(n)&&n.startsWith(ru.URL_SCHEME)?QH(n.slice(ru.URL_SCHEME.length)):null;Kn.registerSaveRouter(ID);Kn.registerLoadRouter(ID);function QH(n){return new ru(n)}class ZH{constructor(){U(dt().getBool("IS_BROWSER"),()=>"Current environment is not a web browser"),U(typeof window>"u"||typeof window.localStorage<"u",()=>"Current browser does not appear to support localStorage"),this.LS=window.localStorage}async listModels(){const t={},e=Ac+$o,s=$o+SD;for(let r=0;r<this.LS.length;++r){const i=this.LS.key(r);if(i.startsWith(e)&&i.endsWith(s)){const o=XH(i);t[o]=JSON.parse(this.LS.getItem(i))}}return t}async removeModel(t){t=YH(t);const e=TD(t);if(this.LS.getItem(e.info)==null)throw new Error(`Cannot find model at path '${t}'`);const s=JSON.parse(this.LS.getItem(e.info));return ED(e),s}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const jk="://";class Oi{constructor(){this.managers={}}static getInstance(){return Oi.instance==null&&(Oi.instance=new Oi),Oi.instance}static registerManager(t,e){U(t!=null,()=>"scheme must not be undefined or null."),t.endsWith(jk)&&(t=t.slice(0,t.indexOf(jk))),U(t.length>0,()=>"scheme must not be an empty string.");const s=Oi.getInstance();U(s.managers[t]==null,()=>`A model store manager is already registered for scheme '${t}'.`),s.managers[t]=e}static getManager(t){const e=Oi.getInstance().managers[t];if(e==null)throw new Error(`Cannot find model manager for scheme '${t}'`);return e}static getSchemes(){return Object.keys(Oi.getInstance().managers)}}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class JH{constructor(){this.messageName="setTimeoutCustom",this.functionRefs=[],this.handledMessageCount=0,this.hasEventListener=!1}fetch(t,e){return fetch(t,e)}now(){return performance.now()}encode(t,e){if(e!=="utf-8"&&e!=="utf8")throw new Error(`Browser's encoder only supports utf-8, but got ${e}`);return this.textEncoder==null&&(this.textEncoder=new TextEncoder),this.textEncoder.encode(t)}decode(t,e){return new TextDecoder(e).decode(t)}setTimeoutCustom(t,e){if(typeof window>"u"||!dt().getBool("USE_SETTIMEOUTCUSTOM")){setTimeout(t,e);return}this.functionRefs.push(t),setTimeout(()=>{window.postMessage({name:this.messageName,index:this.functionRefs.length-1},"*")},e),this.hasEventListener||(this.hasEventListener=!0,window.addEventListener("message",s=>{if(s.source===window&&s.data.name===this.messageName){s.stopPropagation();const r=this.functionRefs[s.data.index];r(),this.handledMessageCount++,this.handledMessageCount===this.functionRefs.length&&(this.functionRefs=[],this.handledMessageCount=0)}},!0))}isTypedArray(t){return iD(t)}}if(dt().get("IS_BROWSER")){dt().setPlatform("browser",new JH);try{Oi.registerManager(ru.URL_SCHEME,new ZH)}catch{}try{Oi.registerManager(su.URL_SCHEME,new WH)}catch{}}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const t5={importFetch:()=>require("node-fetch")};let iv;class e5{constructor(){this.util=require("util"),this.textEncoder=new this.util.TextEncoder}fetch(t,e){return dt().global.fetch!=null?dt().global.fetch(t,e):(iv==null&&(iv=t5.importFetch()),iv(t,e))}now(){const t=process.hrtime();return t[0]*1e3+t[1]/1e6}encode(t,e){if(e!=="utf-8"&&e!=="utf8")throw new Error(`Node built-in encoder only supports utf-8, but got ${e}`);return this.textEncoder.encode(t)}decode(t,e){return t.length===0?"":new this.util.TextDecoder(e).decode(t)}isTypedArray(t){return this.util.types.isFloat32Array(t)||this.util.types.isInt32Array(t)||this.util.types.isUint8Array(t)||this.util.types.isUint8ClampedArray(t)}}dt().get("IS_NODE")&&!dt().get("IS_BROWSER")&&dt().setPlatform("node",new e5);/**
 * @license
 * Copyright 2020 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function ae(n,t="float32",e){return t=t||"float32",Ho(n),new us(n,t,e)}/**
 * @license
 * Copyright 2020 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function n5(n,t){const e=H(n,"x","cast");if(!VW(t))throw new Error(`Failed to cast to unknown dtype ${t}`);if(t==="string"&&e.dtype!=="string"||t!=="string"&&e.dtype==="string")throw new Error("Only strings can be casted to strings");const s={x:e},r={dtype:t};return et.runKernel(Vf,s,r)}const Ot=it({cast_:n5});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function s5(n){const e={x:H(n,"x","clone","string_or_numeric")};return et.runKernel(Zf,e)}const Xl=it({clone_:s5});/**
 * @license
 * Copyright 2020 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function r5(n,t=!1){console.log(n.toString(t))}/**
 * @license
 * Copyright 2020 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */mD();const i5={buffer:ae,cast:Ot,clone:Xl,print:r5};gH(i5);/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function o5(n,t){let e=H(n,"a","add"),s=H(t,"b","add");[e,s]=wn(e,s);const r={a:e,b:s};return et.runKernel(ch,r)}const kt=it({add_:o5});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function a5(n,t){let e=H(n,"a","floorDiv"),s=H(t,"b","floorDiv");[e,s]=wn(e,s);const r={a:e,b:s};return et.runKernel(Yf,r)}const _D=it({floorDiv_:a5});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function l5(n,t){let e=H(n,"a","div"),s=H(t,"b","div");if([e,s]=wn(e,s),e.dtype==="int32"&&s.dtype==="int32")return _D(e,s);const r={a:e,b:s},i={};return et.runKernel(Wf,r,i)}const Wt=it({div_:l5});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function u5(n,t){let e=H(n,"a","mul"),s=H(t,"b","mul");[e,s]=wn(e,s);const r={a:e,b:s};return et.runKernel(ap,r)}const J=it({mul_:u5});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function c5(n){const t=H(n,"x","abs");if(t.dtype==="complex64"){const e={x:t};return et.runKernel(w0,e)}else{const e={x:t};return et.runKernel(p0,e)}}const Os=it({abs_:c5});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function h5(n){const e={x:H(n,"x","acos")};return et.runKernel($f,e)}const d5=it({acos_:h5});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function f5(n){const e={x:H(n,"x","acosh")};return et.runKernel(Df,e)}const p5=it({acosh_:f5});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function m5(n,t=null,e=!1){const r={x:H(n,"x","all","bool")},i={axis:t,keepDims:e};return et.runKernel(wC,r,i)}const kD=it({all_:m5});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function g5(n,t=null,e=!1){const r={x:H(n,"x","any","bool")},i={axis:t,keepDims:e};return et.runKernel(CC,r,i)}const uw=it({any_:g5});/**
 * @license
 * Copyright 2020 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function y5(n,t=0){const s={x:H(n,"x","argMax")},r={axis:t};return et.runKernel(m0,s,r)}const hf=it({argMax_:y5});/**
 * @license
 * Copyright 2020 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function x5(n,t=0){const s={x:H(n,"x","argMin")},r={axis:t};return et.runKernel(g0,s,r)}const b5=it({argMin_:x5});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function v5(n){const e={x:H(n,"x","asin")};return et.runKernel(Of,e)}const w5=it({asin_:v5});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function C5(n){const e={x:H(n,"x","asinh")};return et.runKernel(Mf,e)}const S5=it({asinh_:C5});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function T5(n){const e={x:H(n,"x","atan")};return et.runKernel(Ff,e)}const E5=it({atan_:T5});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function I5(n,t){let e=H(n,"a","atan2"),s=H(t,"b","atan2");[e,s]=wn(e,s);const r={a:e,b:s};return et.runKernel(Pf,r)}const _5=it({atan2_:I5});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function k5(n){const e={x:H(n,"x","atanh")};return et.runKernel(Lf,e)}const A5=it({atanh_:k5});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Ap(n,t,e,s,r="NHWC",i){const o=n[3],l=[...t,o],u=jo(r);return cs(n,l,e,i,s,null,null,u)}function Kr(n,t,e,s,r,i,o="channelsLast"){const[l,u]=df(t);let h;if(o==="channelsLast")h=[l,u,n[3],n[3]];else if(o==="channelsFirst")h=[l,u,n[1],n[1]];else throw new Error(`Unknown dataFormat ${o}`);return cs(n,h,e,s,r,i,!1,o)}function qo(n,t,e,s,r,i,o="NDHWC"){const[l,u,h]=cw(t);let d,p;if(o==="NDHWC")p="channelsLast",d=[l,u,h,n[4],n[4]];else if(o==="NCDHW")p="channelsFirst",d=[l,u,h,n[1],n[1]];else throw new Error(`Unknown dataFormat ${o}`);return Ja(n,d,e,s,r,!1,p,i)}function cs(n,t,e,s,r,i,o=!1,l="channelsLast"){let[u,h,d,p]=[-1,-1,-1,-1];if(l==="channelsLast")[u,h,d,p]=n;else if(l==="channelsFirst")[u,p,h,d]=n;else throw new Error(`Unknown dataFormat ${l}`);const[m,y,,x]=t,[v,C]=df(e),[S,E]=df(s),_=Oc(m,S),I=Oc(y,E),{padInfo:O,outHeight:P,outWidth:D}=$5(r,h,d,v,C,_,I,i,l),N=o?x*p:x;let R;return l==="channelsFirst"?R=[u,N,P,D]:l==="channelsLast"&&(R=[u,P,D,N]),{batchSize:u,dataFormat:l,inHeight:h,inWidth:d,inChannels:p,outHeight:P,outWidth:D,outChannels:N,padInfo:O,strideHeight:v,strideWidth:C,filterHeight:m,filterWidth:y,effectiveFilterHeight:_,effectiveFilterWidth:I,dilationHeight:S,dilationWidth:E,inShape:n,outShape:R,filterShape:t}}function Ja(n,t,e,s,r,i=!1,o="channelsLast",l){let[u,h,d,p,m]=[-1,-1,-1,-1,-1];if(o==="channelsLast")[u,h,d,p,m]=n;else if(o==="channelsFirst")[u,m,h,d,p]=n;else throw new Error(`Unknown dataFormat ${o}`);const[y,x,v,,C]=t,[S,E,_]=cw(e),[I,O,P]=cw(s),D=Oc(y,I),N=Oc(x,O),R=Oc(v,P),{padInfo:$,outDepth:A,outHeight:V,outWidth:L}=D5(r,h,d,p,S,E,_,D,N,R,l),nt=i?C*m:C;let Z;return o==="channelsFirst"?Z=[u,nt,A,V,L]:o==="channelsLast"&&(Z=[u,A,V,L,nt]),{batchSize:u,dataFormat:o,inDepth:h,inHeight:d,inWidth:p,inChannels:m,outDepth:A,outHeight:V,outWidth:L,outChannels:nt,padInfo:$,strideDepth:S,strideHeight:E,strideWidth:_,filterDepth:y,filterHeight:x,filterWidth:v,effectiveFilterDepth:D,effectiveFilterHeight:N,effectiveFilterWidth:R,dilationDepth:I,dilationHeight:O,dilationWidth:P,inShape:n,outShape:Z,filterShape:t}}function N5(n,t,e,s,r){s==null&&(s=cS(n,t,e));const i=n[0],o=n[1],l=ff((i-t+2*s)/e+1,r),u=ff((o-t+2*s)/e+1,r);return[l,u]}function R5(n,t,e,s,r,i){r==null&&(r=cS(n,t[0],s[0]));const o=[0,0,0,e];for(let l=0;l<3;l++)n[l]+2*r>=t[l]&&(o[l]=ff((n[l]-t[l]+2*r)/s[l]+1,i));return o}function cS(n,t,e,s=1){const r=Oc(t,s);return Math.floor((n[0]*(e-1)-e+r)/2)}function df(n){return typeof n=="number"?[n,n,n]:n.length===2?[n[0],n[1],1]:n}function cw(n){return typeof n=="number"?[n,n,n]:n}function Oc(n,t){return t<=1?n:n+(n-1)*(t-1)}function $5(n,t,e,s,r,i,o,l,u){let h,d,p;if(typeof n=="number"){h={top:n,bottom:n,left:n,right:n,type:n===0?"VALID":"NUMBER"};const y=N5([t,e],i,s,n,l);d=y[0],p=y[1]}else if(n==="same"){d=Math.ceil(t/s),p=Math.ceil(e/r);const m=Math.max(0,(d-1)*s+i-t),y=Math.max(0,(p-1)*r+o-e),x=Math.floor(m/2),v=m-x,C=Math.floor(y/2),S=y-C;h={top:x,bottom:v,left:C,right:S,type:"SAME"}}else if(n==="valid")h={top:0,bottom:0,left:0,right:0,type:"VALID"},d=Math.ceil((t-i+1)/s),p=Math.ceil((e-o+1)/r);else if(typeof n=="object"){const m=u==="channelsLast"?n[1][0]:n[2][0],y=u==="channelsLast"?n[1][1]:n[2][1],x=u==="channelsLast"?n[2][0]:n[3][0],v=u==="channelsLast"?n[2][1]:n[3][1];h={top:m,bottom:y,left:x,right:v,type:m===0&&y===0&&x===0&&v===0?"VALID":"EXPLICIT"},d=ff((t-i+m+y)/s+1,l),p=ff((e-o+x+v)/r+1,l)}else throw Error(`Unknown padding parameter: ${n}`);return{padInfo:h,outHeight:d,outWidth:p}}function D5(n,t,e,s,r,i,o,l,u,h,d){let p,m,y,x;if(n==="valid"&&(n=0),typeof n=="number"){p={top:n,bottom:n,left:n,right:n,front:n,back:n,type:n===0?"VALID":"NUMBER"};const C=R5([t,e,s,1],[l,u,h],1,[r,i,o],n,d);m=C[0],y=C[1],x=C[2]}else if(n==="same"){m=Math.ceil(t/r),y=Math.ceil(e/i),x=Math.ceil(s/o);const v=(m-1)*r+l-t,C=(y-1)*i+u-e,S=(x-1)*o+h-s,E=Math.floor(v/2),_=v-E,I=Math.floor(C/2),O=C-I,P=Math.floor(S/2),D=S-P;p={top:I,bottom:O,left:P,right:D,front:E,back:_,type:"SAME"}}else throw Error(`Unknown padding parameter: ${n}`);return{padInfo:p,outDepth:m,outHeight:y,outWidth:x}}function ff(n,t){if(!t)return Math.trunc(n);switch(t){case"round":return Math.round(n);case"ceil":return Math.ceil(n);case"floor":return Math.floor(n);default:throw new Error(`Unknown roundingMode ${t}`)}}function iu(n){const[t,e,s]=df(n);return t===1&&e===1&&s===1}function Is(n,t){return iu(n)||iu(t)}function ou(n){return df(n).every(t=>t>0)}function jo(n){if(n==="NHWC")return"channelsLast";if(n==="NCHW")return"channelsFirst";throw new Error(`Unknown dataFormat ${n}`)}function Zs(n,t,e){if(e!=null){if(typeof t=="string")throw Error(`Error in ${n}: pad must be an integer when using dimRoundingMode ${e} but got pad ${t}.`);if(typeof t=="number")U(Wc(t),()=>`Error in ${n}: pad must be an integer when using dimRoundingMode ${e} but got pad ${t}.`);else if(typeof t=="object")t.forEach(s=>{s.forEach(r=>{U(Wc(r),()=>`Error in ${n}: pad must be an integer when using dimRoundingMode ${e} but got pad ${r}.`)})});else throw Error(`Error in ${n}: Unknown padding parameter: ${t}`)}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function O5(n,t){const s={x:H(n,"x","reshape","string_or_numeric")},r={shape:t};return et.runKernel(ex,s,r)}const rt=it({reshape_:O5});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function M5(n,t,e,s,r){const i=H(n,"x","avgPool","float32"),o=1;U(Is(e,o),()=>`Error in avgPool: Either strides or dilations must be 1. Got strides ${e} and dilations '${o}'`);let l=i,u=!1;i.rank===3&&(u=!0,l=rt(i,[1,i.shape[0],i.shape[1],i.shape[2]])),U(l.rank===4,()=>`Error in avgPool: x must be rank 4 but got rank ${l.rank}.`),Zs("avgPool",s,r);const h={x:l},d={filterSize:t,strides:e,pad:s,dimRoundingMode:r};let p=et.runKernel(y0,h,d);return p=Ot(p,i.dtype),u?rt(p,[p.shape[1],p.shape[2],p.shape[3]]):p}const hS=it({avgPool_:M5});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function F5(n,t,e,s,r,i="NDHWC"){const o=H(n,"x","avgPool3d","float32");let l=o,u=!1;o.rank===4&&(u=!0,l=rt(o,[1,o.shape[0],o.shape[1],o.shape[2],o.shape[3]])),U(l.rank===5,()=>`Error in avgPool3d: x must be rank 5 but got rank ${l.rank}.`),U(i==="NDHWC",()=>`Error in avgPool3d: Only NDHWC is currently supported, but got dataFormat of ${i}`),U(typeof e=="number"&&e>0||Array.isArray(e)&&e[0]>0&&e[1]>0&&e[2]>0,()=>`Error in avgPool3d: Stride must be > 0, but got '${e}'`),Zs("avgPool3d",s,r);const h={x:l},d={filterSize:t,strides:e,pad:s,dimRoundingMode:r,dataFormat:i};let p=et.runKernel(x0,h,d);return p=Ot(p,l.dtype),u?rt(p,[p.shape[1],p.shape[2],p.shape[3],p.shape[4]]):p}const L5=it({avgPool3d_:F5});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function P5(n,t=0){U(n.length>=1,()=>"Pass at least one tensor to concat");const e=bD(n,"tensors","concat","string_or_numeric");if(e[0].dtype==="complex64"&&e.forEach(i=>{if(i.dtype!=="complex64")throw new Error(`Cannot concatenate complex64 tensors with a tensor
          with dtype ${i.dtype}. `)}),e.length===1)return Xl(e[0]);const s=e,r={axis:t};return et.runKernel(C0,s,r)}const Xs=it({concat_:P5});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function V5(n,t,e=!1,s=!1){let r=H(n,"a","matMul"),i=H(t,"b","matMul");[r,i]=wn(r,i);const o={a:r,b:i},l={transposeA:e,transposeB:s};return et.runKernel(b0,o,l)}const $e=it({matMul_:V5});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function z5(n){const e={x:H(n,"x","sigmoid","float32")};return et.runKernel(xp,e)}const hh=it({sigmoid_:z5});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function B5(n,t,e){const s=H(n,"x","slice","string_or_numeric");if(s.rank===0)throw new Error("Slicing scalar is not possible");const r={x:s},i={begin:t,size:e};return et.runKernel(ox,r,i)}const Je=it({slice_:B5});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function U5(n){const e={x:H(n,"x","tanh","float32")};return et.runKernel(Tp,e)}const mx=it({tanh_:U5});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function G5(n,t,e){const s=H(n,"x","batchToSpaceND"),r=t.reduce((l,u)=>l*u);U(s.rank>=1+t.length,()=>`input rank is ${s.rank} but should be > than blockShape.length ${t.length}`),U(e.length===t.length,()=>`crops.length is ${e.length} but should be equal to blockShape.length  ${t.length}`),U(s.shape[0]%r===0,()=>`input tensor batch is ${s.shape[0]} but is not divisible by the product of the elements of blockShape ${t.join(" * ")} === ${r}`);const i={x:s},o={blockShape:t,crops:e};return et.runKernel(v0,i,o)}const dS=it({batchToSpaceND_:G5});function W5(n){let t;return n.rank===0||n.rank===1?t=rt(n,[1,1,1,n.size]):n.rank===2?t=rt(n,[1,1,n.shape[0],n.shape[1]]):n.rank===3?t=rt(n,[1,n.shape[0],n.shape[1],n.shape[2]]):t=n,t}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function H5(n,t,e,s,r,i){i==null&&(i=.001);const o=H(n,"x","batchNorm"),l=H(t,"mean","batchNorm"),u=H(e,"variance","batchNorm");let h;r!=null&&(h=H(r,"scale","batchNorm"));let d;s!=null&&(d=H(s,"offset","batchNorm")),U(l.rank===u.rank,()=>"Batch normalization gradient requires mean and variance to have equal ranks."),U(d==null||l.rank===d.rank,()=>"Batch normalization gradient requires mean and offset to have equal ranks."),U(h==null||l.rank===h.rank,()=>"Batch normalization gradient requires mean and scale to have equal ranks.");const m={x:W5(o),scale:h,offset:d,mean:l,variance:u},y={varianceEpsilon:i},x=et.runKernel(R0,m,y);return rt(x,o.shape)}const gx=it({batchNorm_:H5});function q5(n,t,e,s,r,i){const o=H(n,"x","batchNorm"),l=H(t,"mean","batchNorm"),u=H(e,"variance","batchNorm");let h;r!=null&&(h=H(r,"scale","batchNorm"));let d;return s!=null&&(d=H(s,"offset","batchNorm")),U(o.rank===2,()=>`Error in batchNorm2D: x must be rank 2 but got rank ${o.rank}.`),U(l.rank===2||l.rank===1,()=>`Error in batchNorm2D: mean must be rank 2 or rank 1 but got rank ${l.rank}.`),U(u.rank===2||u.rank===1,()=>`Error in batchNorm2D: variance must be rank 2 or rank 1 but got rank ${u.rank}.`),h!=null&&U(h.rank===2||h.rank===1,()=>`Error in batchNorm2D: scale must be rank 2 or rank 1 but got rank ${h.rank}.`),d!=null&&U(d.rank===2||d.rank===1,()=>`Error in batchNorm2D: offset must be rank 2 or rank 1 but got rank ${d.rank}.`),gx(o,l,u,d,h,i)}const j5=it({batchNorm2d_:q5});function K5(n,t,e,s,r,i){const o=H(n,"x","batchNorm"),l=H(t,"mean","batchNorm"),u=H(e,"variance","batchNorm");let h;r!=null&&(h=H(r,"scale","batchNorm"));let d;return s!=null&&(d=H(s,"offset","batchNorm")),U(o.rank===3,()=>`Error in batchNorm3D: x must be rank 3 but got rank ${o.rank}.`),U(l.rank===3||l.rank===1,()=>`Error in batchNorm3D: mean must be rank 3 or rank 1 but got rank ${l.rank}.`),U(u.rank===3||u.rank===1,()=>`Error in batchNorm3D: variance must be rank 3 or rank 1 but got rank ${u.rank}.`),h!=null&&U(h.rank===3||h.rank===1,()=>`Error in batchNorm3D: scale must be rank 3 or rank 1 but got rank ${h.rank}.`),d!=null&&U(d.rank===3||d.rank===1,()=>`Error in batchNorm3D: offset must be rank 3 or rank 1 but got rank ${d.rank}.`),gx(o,l,u,d,h,i)}const X5=it({batchNorm3d_:K5});function Y5(n,t,e,s,r,i){const o=H(n,"x","batchNorm"),l=H(t,"mean","batchNorm"),u=H(e,"variance","batchNorm");let h;r!=null&&(h=H(r,"scale","batchNorm"));let d;return s!=null&&(d=H(s,"offset","batchNorm")),U(o.rank===4,()=>`Error in batchNorm4D: x must be rank 4 but got rank ${o.rank}.`),U(l.rank===4||l.rank===1,()=>`Error in batchNorm4D: mean must be rank 4 or rank 1 but got rank ${l.rank}.`),U(u.rank===4||u.rank===1,()=>`Error in batchNorm4D: variance must be rank 4 or rank 1 but got rank ${u.rank}.`),h!=null&&U(h.rank===4||h.rank===1,()=>`Error in batchNorm4D: scale must be rank 4 or rank 1 but got rank ${h.rank}.`),d!=null&&U(d.rank===4||d.rank===1,()=>`Error in batchNorm4D: offset must be rank 4 or rank 1 but got rank ${d.rank}.`),gx(o,l,u,d,h,i)}const Q5=it({batchNorm4d_:Y5});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Z5(n,t,e){const s=H(n,"x","bincount"),r=H(t,"weights","bincount");U(s.dtype==="int32",()=>`Error in bincount: input dtype must be int32, but got ${s.dtype}`),U(e>=0,()=>`size must be non-negative, but got ${e}.`),U(r.size===s.size||r.size===0,()=>`Error in bincount: weights must have the same size as input or0-length, but got input shape: ${s.shape}, weights shape: ${r.shape}.`);const i={x:s,weights:r},o={size:e};return et.runKernel(EC,i,o)}const J5=it({bincount_:Z5});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function t9(n,t){let e=H(n,"broadcastTo","x");const s=e.shape;if(Ho(t),t.length<e.rank)throw new Error(`broadcastTo(): shape.length=${t.length} < input.rank=${e.rank}.`);if(t.length>e.rank){const h=e.shape.slice();for(;h.length<t.length;)h.unshift(1);e=rt(e,h)}const r=e.shape,i=Array.from(t);for(let h=t.length-1;h>=0;h--)if(r[h]===t[h])i[h]=1;else if(e.shape[h]!==1)throw new Error(`broadcastTo(): [${s}] cannot be broadcast to [${t}].`);if(i.map((h,d)=>h>1?d:-1).filter(h=>h>=0).length===0)return Xl(e);const l={x:e},u={reps:i};return et.runKernel(Ep,l,u)}const Zd=it({broadcastTo_:t9});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function e9(n){const e={x:H(n,"x","ceil","float32")};return et.runKernel(zf,e)}const n9=it({ceil_:e9});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function yx(n,t,e){Ho(n),e=e||lh(t);const s={shape:n,value:t,dtype:e};return et.runKernel(zC,{},s)}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function s9(n,t,e){const s=H(n,"x","clipByValue");if(U(t<=e,()=>`Error in clip: min (${t}) must be less than or equal to max (${e}).`),t===e)return yx(s.shape,t,s.dtype);const r={x:s},i={clipValueMin:t,clipValueMax:e};return et.runKernel(Bf,r,i)}const Sr=it({clipByValue_:s9});function r9(n){return Xs(n,0)}const i9=it({concat1d_:r9});function o9(n,t){return Xs(n,t)}const a9=it({concat2d_:o9});function l9(n,t){return Xs(n,t)}const u9=it({concat3d_:l9});function c9(n,t){return Xs(n,t)}const h9=it({concat4d_:c9});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function d9(n,t,e,s,r="NHWC",i=[1,1],o){const l=H(n,"x","conv2d","float32"),u=H(t,"filter","conv2d","float32");let h=l,d=!1;l.rank===3&&(d=!0,h=rt(l,[1,l.shape[0],l.shape[1],l.shape[2]])),U(h.rank===4,()=>`Error in conv2d: input must be rank 4, but got rank ${h.rank}.`),U(u.rank===4,()=>`Error in conv2d: filter must be rank 4, but got rank ${u.rank}.`),Zs("conv2d",s,o);const p=r==="NHWC"?h.shape[3]:h.shape[1];U(p===u.shape[2],()=>`Error in conv2d: depth of input (${p}) must match input depth for filter ${u.shape[2]}.`),U(Is(e,i),()=>`Error in conv2D: Either strides or dilations must be 1. Got strides ${e} and dilations '${i}'`),U(ou(i),()=>"Error in conv2D: Dilated rates should be larger than 0."),U(ou(e),()=>"Error in conv2D: Strides should be larger than 0.");const m={x:h,filter:u},y={strides:e,pad:s,dataFormat:r,dilations:i,dimRoundingMode:o},x=et.runKernel(S0,m,y);return d?rt(x,[x.shape[1],x.shape[2],x.shape[3]]):x}const au=it({conv2d_:d9});function f9(n,t,e,s,r="NWC",i=1,o){const l=H(n,"x","conv1d"),u=H(t,"filter","conv1d");let h=l,d=!1;l.rank===2&&(d=!0,h=rt(l,[1,l.shape[0],l.shape[1]])),U(h.rank===3,()=>`Error in conv1d: input must be rank 3, but got rank ${h.rank}.`),U(u.rank===3,()=>`Error in conv1d: filter must be rank 3, but got rank ${u.rank}.`),Zs("conv1d",s,o),U(h.shape[2]===u.shape[1],()=>`Error in conv1d: depth of input (${h.shape[2]}) must match input depth for filter ${u.shape[1]}.`),U(Is(e,i),()=>`Error in conv1D: Either stride or dilation must be 1. Got stride ${e} and dilation '${i}'`),U(ou(i),()=>"Error in conv1D: Dilated rates should be larger than 0."),U(ou(e),()=>"Error in conv1D: Stride should be larger than 0."),U(r==="NWC",()=>`Error in conv1d: got dataFormat of ${r} but only NWC is currently supported.`);const p=rt(u,[1,u.shape[0],u.shape[1],u.shape[2]]),m=rt(h,[h.shape[0],1,h.shape[1],h.shape[2]]),C=au(m,p,[1,e],s,"NHWC",[1,i],o);return d?rt(C,[C.shape[2],C.shape[3]]):rt(C,[C.shape[0],C.shape[2],C.shape[3]])}const AD=it({conv1d_:f9});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function p9(n,t,e,s,r,i="NHWC",o){U(n.length===t.rank,()=>`Length of inShape (${n.length}) and rank of dy (${t.rank}) must match`);let l=n,u=t,h=!1;t.rank===3&&(h=!0,u=rt(t,[1,t.shape[0],t.shape[1],t.shape[2]]),l=[1,n[0],n[1],n[2]]),U(l.length===4,()=>`Error in conv2dDerInput: inShape must be length 4, but got length ${l.length}.`),U(u.rank===4,()=>`Error in conv2dDerInput: dy must be rank 4, but got rank ${u.rank}`),U(e.rank===4,()=>`Error in conv2dDerInput: filter must be rank 4, but got rank ${e.rank}`);const d=i==="NHWC"?l[3]:l[1],p=i==="NHWC"?u.shape[3]:u.shape[1];U(d===e.shape[2],()=>`Error in conv2dDerInput: depth of input (${d}) must match input depth for filter ${e.shape[2]}.`),U(p===e.shape[3],()=>`Error in conv2dDerInput: depth of output (${p}) must match output depth for filter ${e.shape[3]}.`),Zs("conv2dDerInput",r,o);const m={dy:u,filter:e},y={strides:s,pad:r,dataFormat:i,dimRoundingMode:o,inputShape:l},x=et.runKernel(T0,m,y);return h?rt(x,[x.shape[1],x.shape[2],x.shape[3]]):x}const fS=it({conv2DBackpropInput_:p9});function m9(n,t,e,s,r,i){const o=H(n,"x","conv2dTranspose"),l=H(t,"filter","conv2dTranspose");return fS(e,o,l,s,r,"NHWC",i)}const ND=it({conv2dTranspose_:m9});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function g9(n,t,e,s,r="NDHWC",i=[1,1,1]){const o=H(n,"x","conv3d"),l=H(t,"filter","conv3d");let u=o,h=!1;o.rank===4&&(h=!0,u=rt(o,[1,o.shape[0],o.shape[1],o.shape[2],o.shape[3]])),U(u.rank===5,()=>`Error in conv3d: input must be rank 5, but got rank ${u.rank}.`),U(l.rank===5,()=>`Error in conv3d: filter must be rank 5, but got rank ${l.rank}.`),U(u.shape[4]===l.shape[3],()=>`Error in conv3d: depth of input (${u.shape[4]}) must match input depth for filter ${l.shape[3]}.`),U(Is(e,i),()=>`Error in conv3D: Either strides or dilations must be 1. Got strides ${e} and dilations '${i}'`),U(r==="NDHWC",()=>`Error in conv3d: got dataFormat of ${r} but only NDHWC is currently supported.`),U(ou(i),()=>"Error in conv3D: Dilated rates should be larger than 0."),U(ou(e),()=>"Error in conv3D: Strides should be larger than 0.");const d={x:u,filter:l},p={strides:e,pad:s,dataFormat:r,dilations:i},m=et.runKernel(E0,d,p);return h?rt(m,[m.shape[1],m.shape[2],m.shape[3],m.shape[4]]):m}const y9=it({conv3d_:g9});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function x9(n,t,e,s,r){U(n.length===t.rank,()=>`Length of inShape (${n.length}) and rank of dy (${t.rank}) must match`);let i=n,o=t,l=!1;t.rank===4&&(l=!0,o=rt(t,[1,t.shape[0],t.shape[1],t.shape[2],t.shape[3]]),i=[1,n[0],n[1],n[2],n[3]]);const u=i[4],h=o.shape[4];U(i.length===5,()=>`Error in conv3dDerInput: inShape must be length 5, but got length ${i.length}.`),U(o.rank===5,()=>`Error in conv3dDerInput: dy must be rank 5, but got rank ${o.rank}`),U(e.rank===5,()=>`Error in conv3dDerInput: filter must be rank 5, but got rank ${e.rank}`),U(u===e.shape[3],()=>`Error in conv3dDerInput: depth of input (${u}) must match input depth for filter ${e.shape[3]}.`),U(h===e.shape[4],()=>`Error in conv3dDerInput: depth of output (${h}) must match output depth for filter ${e.shape[4]}.`);const d={dy:o,filter:e},p={pad:r,strides:s,inputShape:i},m=et.runKernel(NC,d,p);return l?rt(m,[m.shape[1],m.shape[2],m.shape[3],m.shape[4]]):m}const RD=it({conv3DBackpropInput_:x9});function b9(n,t,e,s,r){const i=H(n,"x","conv3dTranspose"),o=H(t,"filter","conv3dTranspose");return RD(e,i,o,s,r)}const v9=it({conv3dTranspose_:b9});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function w9(n){const e={x:H(n,"x","cos","float32")};return et.runKernel(Uf,e)}const pS=it({cos_:w9});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function C9(n){const e={x:H(n,"x","cosh","float32")};return et.runKernel(Gf,e)}const $D=it({cosh_:C9});/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the 'License');
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an 'AS IS' BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function S9(n,t=0,e=!1,s=!1){const i={x:H(n,"x","cumprod")},o={axis:t,exclusive:e,reverse:s};return et.runKernel(RC,i,o)}const hw=it({cumprod_:S9});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function T9(n,t=0,e=!1,s=!1){const i={x:H(n,"x","cumsum")},o={axis:t,exclusive:e,reverse:s};return et.runKernel(I0,i,o)}const DD=it({cumsum_:T9});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function E9(n,t,e,s=!1){const r=H(n,"x","denseBincount"),i=H(t,"weights","denseBincount");U(r.dtype==="int32",()=>`Error in denseBincount: input dtype must be int32, but got ${r.dtype}`),U(r.rank<=2,()=>`Error in denseBincount: input must be at most rank 2, but got rank ${r.rank}.`),U(e>=0,()=>`size must be non-negative, but got ${e}.`),U(i.size===r.size||i.size===0,()=>`Error in denseBincount: weights must have the same shape as x or 0-length, but got x shape: ${r.shape}, weights shape: ${i.shape}.`);const o={x:r,weights:i},l={size:e,binaryOutput:s};return et.runKernel(DC,o,l)}const Kk=it({denseBincount_:E9});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function I9(n,t,e="NHWC"){const s=H(n,"x","depthToSpace","float32"),r=e==="NHWC"?s.shape[1]:s.shape[2],i=e==="NHWC"?s.shape[2]:s.shape[3],o=e==="NHWC"?s.shape[3]:s.shape[1];U(t>1,()=>`blockSize should be > 1 for depthToSpace, but was: ${t}`),U(r*t>=0,()=>`Negative dimension size caused by overflow when multiplying
    ${r} and ${t}  for depthToSpace with input shape
    ${s.shape}`),U(i*t>=0,()=>`Negative dimension size caused by overflow when multiplying
    ${i} and ${t} for depthToSpace with input shape
        ${s.shape}`),U(o%(t*t)===0,()=>`Dimension size must be evenly divisible by ${t*t} but is ${o} for depthToSpace with input shape ${s.shape}`);const l={x:s},u={blockSize:t,dataFormat:e};return et.runKernel(OC,l,u)}const _9=it({depthToSpace_:I9});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function k9(n,t,e,s,r="NHWC",i=[1,1],o){const l=H(n,"x","depthwiseConv2d","float32"),u=H(t,"filter","depthwiseConv2d","float32");let h=l,d=!1;l.rank===3&&(d=!0,h=rt(l,[1,l.shape[0],l.shape[1],l.shape[2]])),U(h.rank===4,()=>`Error in depthwiseConv2d: input must be rank 4, but got rank ${h.rank}.`),U(u.rank===4,()=>`Error in depthwiseConv2d: filter must be rank 4, but got rank ${u.rank}.`);const p=r==="NHWC"?h.shape[3]:h.shape[1];U(p===u.shape[2],()=>`Error in depthwiseConv2d: number of input channels (${p}) must match the inChannels dimension in filter ${u.shape[2]}.`),Zs("depthwiseConv2d",s,o);const m={x:h,filter:u},y={strides:e,pad:s,dataFormat:r,dilations:i,dimRoundingMode:o},x=et.runKernel(_0,m,y);return d?rt(x,[x.shape[1],x.shape[2],x.shape[3]]):x}const mS=it({depthwiseConv2d_:k9});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function A9(n,t,e,s,r=[1,1],i="NHWC"){const o=H(n,"x","dilation2d"),l=H(t,"filter","dilation2d");U(o.rank===3||o.rank===4,()=>`Error in dilation2d: input must be rank 3 or 4, but got rank ${o.rank}.`),U(l.rank===3,()=>`Error in dilation2d: filter must be rank 3, but got rank ${l.rank}.`),U(i==="NHWC",()=>`Error in dilation2d: Only NHWC is currently supported, but got dataFormat of ${i}`);let u=o,h=!1;o.rank===3&&(u=rt(o,[1,o.shape[0],o.shape[1],o.shape[2]]),h=!0),U(u.shape[3]===l.shape[2],()=>`Error in dilation2d:  input and filter must have the same depth: ${u.shape[3]} vs ${l.shape[2]}`);const d={x:u,filter:l},p={strides:e,pad:s,dilations:r},m=et.runKernel(k0,d,p);return h?rt(m,[m.shape[1],m.shape[2],m.shape[3]]):m}const N9=it({dilation2d_:A9});/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function jc(n,t){const e=n.length,s=[];for(let r=0;r<e;r++){const i=e-1-r,o=n[i]||1;(t[t.length-1-r]||1)>1&&o===1&&s.unshift(i)}return s}function Bn(n,t){const e=[];for(let s=0;s<t.length;s++){const r=n[n.length-s-1],i=t.length-s-1,o=t[i];(r==null||r===1&&o>1)&&e.unshift(i)}return e}function ne(n,t){const e=Math.max(n.length,t.length),s=new Array(e);for(let r=0;r<e;r++){let i=n[n.length-r-1];i==null&&(i=1);let o=t[t.length-r-1];if(o==null&&(o=1),i===1)s[e-r-1]=o;else if(o===1)s[e-r-1]=i;else if(i!==o){const l=`Operands could not be broadcast together with shapes ${n} and ${t}.`;throw Error(l)}else s[e-r-1]=i}return s}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function R9(n,t){let e=H(n,"a","equal","string_or_numeric"),s=H(t,"b","equal","string_or_numeric");[e,s]=wn(e,s),ne(e.shape,s.shape);const r={a:e,b:s};return et.runKernel(A0,r)}const Yi=it({equal_:R9});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function $9(n,t,e){const s=H(t,"a","where"),r=H(e,"b","where"),i=H(n,"condition","where","bool"),o=ne(ne(i.shape,s.shape),r.shape),l=Zd(i,o),u=Zd(s,o),h=Zd(r,o),d={condition:l,t:u,e:h};return et.runKernel(ix,d)}const Ps=it({where_:$9});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function D9(n){const e={x:H(n,"x","zerosLike")};return et.runKernel(fx,e)}const we=it({zerosLike_:D9});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function O9(n,t){let e=H(n,"a","div"),s=H(t,"b","div");[e,s]=wn(e,s);const r=Wt(e,s),i=we(r),o=Yi(s,i);return Ps(o,i,r)}const M9=it({divNoNan_:O9});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function F9(n,t){const e=H(n,"t1","dot"),s=H(t,"t2","dot");U((e.rank===1||e.rank===2)&&(s.rank===1||s.rank===2),()=>`Error in dot: inputs must all be rank 1 or 2, but got ranks ${e.rank} and ${s.rank}.`);const r=e.rank===1?e.size:e.shape[1],i=s.rank===1?s.size:s.shape[0];if(U(r===i,()=>`Error in dot: inner dimensions of inputs must match, but got ${r} and ${i}.`),e.rank===1&&s.rank===1){const o=rt(e,[1,-1]),l=rt(s,[-1,1]),u=$e(o,l);return rt(u,[])}else if(e.rank===1&&s.rank===2){const o=rt(e,[1,-1]),l=rt(s,[s.shape[0],s.shape[1]]),u=$e(o,l);return rt(u,[u.size])}else if(e.rank===2&&s.rank===1){const o=rt(s,[-1,1]),l=$e(e,o);return rt(l,[l.size])}else{const o=rt(s,[s.shape[0],s.shape[1]]);return $e(e,o)}}const L9=it({dot_:F9});/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function P9(n,...t){const e=t.map((r,i)=>H(r,`tensors${i}`,"einsum")),s={equation:n};return et.runKernel(LC,e,s)}const Od=it({einsum_:P9});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function V9(n){const e={x:H(n,"x","elu","float32")};return et.runKernel(Hf,e)}const xx=it({elu_:V9});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function z9(n){let t=H(n,"x","erf");U(t.dtype==="int32"||t.dtype==="float32",()=>"Input dtype must be `int32` or `float32`."),t.dtype==="int32"&&(t=Ot(t,"float32"));const e={x:t};return et.runKernel(qf,e)}const OD=it({erf_:z9});/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function gS(n,t){for(let e=0;e<n.length;++e)if(n[n.length-e-1]!==t-1-e)return!1;return!0}function MD(n,t,e){const s=n.length+t.length,r=[];let i=0,o=0;for(let l=0;l<s;l++)e.indexOf(l)===-1?r.push(n[i++]):r.push(t[o++]);return r}function es(n,t){const e=[],s=n.length;for(let i=0;i<s;i++)t.indexOf(i)===-1&&e.push(n[i]);const r=t.map(i=>n[i]);return[e,r]}function Nn(n,t){const e=t.map(s=>1);return MD(n,e,t)}function hs(n,t,e){U(gS(t,e),()=>`${n} supports only inner-most axes for now. Got axes ${t} and rank-${e} input.`)}function hn(n,t){if(gS(n,t))return null;const e=[];for(let s=0;s<t;++s)n.indexOf(s)===-1&&e.push(s);return n.forEach(s=>e.push(s)),e}function tl(n){return n.map((t,e)=>[e,t]).sort((t,e)=>t[1]-e[1]).map(t=>t[0])}function Cn(n,t){const e=[];for(let s=t-n;s<t;++s)e.push(s);return e}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function B9(n,t=null,e=!1){const r={x:H(n,"x","max")},i={reductionIndices:t,keepDims:e};return et.runKernel(B0,r,i)}const ci=it({max_:B9});/**
 * @license
 * Copyright 2020 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function U9(n,t=null,e=!1){const r={x:H(n,"x","min")},i={axis:t,keepDims:e};return et.runKernel(H0,r,i)}const Iy=it({min_:U9});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function G9(n,t){let e=H(n,"base","pow"),s=H(t,"exp","pow");[e,s]=wn(e,s);const r={a:e,b:s};return et.runKernel(lp,r)}const lu=it({pow_:G9});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function De(n,t){if((qr(n)&&t!=="string"||Array.isArray(n))&&t!=="complex64")throw new Error("Error creating a new Scalar: value must be a primitive (number|boolean|string)");if(t==="string"&&qr(n)&&!(n instanceof Uint8Array))throw new Error("When making a scalar from encoded string, the value must be `Uint8Array`.");return kp(n,[],[],t)}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function W9(n){const e={x:H(n,"x","sqrt","float32")};return et.runKernel(vp,e)}const Es=it({sqrt_:W9});/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function H9(n){const t=H(n,"x","square"),e={};return et.runKernel("Square",{x:t},e)}const nn=it({square_:H9});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function q9(n,t=null,e=!1){let s=H(n,"x","sum");s.dtype==="bool"&&(s=Ot(s,"int32"));const r={x:s},i={axis:t,keepDims:e};return et.runKernel(ax,r,i)}const Gt=it({sum_:q9});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function j9(n,t="euclidean",e=null,s=!1){n=H(n,"x","norm");const r=FD(n,t,e);let i=r.shape;if(s){const o=le(e,n.shape);i=Nn(r.shape,o)}return rt(r,i)}function FD(n,t,e=null){if(n.rank===0)return Os(n);if(n.rank!==1&&e===null)return FD(rt(n,[-1]),t,e);if(n.rank===1||typeof e=="number"||Array.isArray(e)&&e.length===1){if(t===1)return Gt(Os(n),e);if(t===1/0)return ci(Os(n),e);if(t===-1/0)return Iy(Os(n),e);if(t==="euclidean"||t===2)return Es(Gt(lu(Os(n),De(2,"int32")),e));throw new Error(`Error in norm: invalid ord value: ${t}`)}if(Array.isArray(e)&&e.length===2){if(t===1)return ci(Gt(Os(n),e[0]),e[1]-1);if(t===1/0)return ci(Gt(Os(n),e[1]),e[0]);if(t===-1/0)return Iy(Gt(Os(n),e[1]),e[0]);if(t==="fro"||t==="euclidean")return Es(Gt(nn(n),e));throw new Error(`Error in norm: invalid ord value: ${t}`)}throw new Error(`Error in norm: invalid axis: ${e}`)}const bx=it({norm_:j9});/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function K9(n,t=null,e=!1){return bx(n,"euclidean",t,e)}const X9=it({euclideanNorm_:K9});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Y9(n){const e={x:H(n,"x","exp")};return et.runKernel(jf,e)}const Qi=it({exp_:Y9});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Q9(n,t=0){const e=H(n,"x","expandDims","string_or_numeric");U(t<=e.rank,()=>"Axis must be <= rank of the tensor");const s={input:e},r={dim:t};return et.runKernel(N0,s,r)}const js=it({expandDims_:Q9});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Z9(n){const e={x:H(n,"x","expm1")};return et.runKernel(Kf,e)}const J9=it({expm1_:Z9});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function tq(n,t){const e=H(n,"x","tile","string_or_numeric");U(e.rank===t.length,()=>`Error in transpose: rank of input ${e.rank} must match length of reps ${t}.`);const s={x:e},r={reps:t};return et.runKernel(Ep,s,r)}const ai=it({tile_:tq});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function eq(n,t,e,s="float32"){t==null&&(t=n);const r=ae([n,t],s),i=n<=t?n:t;for(let l=0;l<i;++l)r.set(1,l,l);const o=rt(r.toTensor(),[n,t]);if(e==null)return o;if(e.length===1)return ai(js(o,0),[e[0],1,1]);if(e.length===2)return ai(js(js(o,0),0),[e[0],e[1],1,1]);if(e.length===3)return ai(js(js(js(o,0),0),0),[e[0],e[1],e[2],1,1]);throw new Error(`eye() currently supports only 1D and 2D batchShapes, but received ${e.length}D.`)}const LD=it({eye_:eq});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function nq(n){const e={x:H(n,"x","floor","float32")};return et.runKernel(Xf,e)}const vx=it({floor_:nq});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function sq(n,t,e=0,s=0){const r=H(n,"x","gather"),i=H(t,"indices","gather","int32"),o={x:r,indices:i},l={axis:e,batchDims:s};return et.runKernel($0,o,l)}const yS=it({gather_:sq});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function rq(n,t){let e=H(n,"a","greater","string_or_numeric"),s=H(t,"b","greater","string_or_numeric");[e,s]=wn(e,s),ne(e.shape,s.shape);const r={a:e,b:s};return et.runKernel(D0,r)}const Tr=it({greater_:rq});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function iq(n,t){let e=H(n,"a","greaterEqual","string_or_numeric"),s=H(t,"b","greaterEqual","string_or_numeric");[e,s]=wn(e,s),ne(e.shape,s.shape);const r={a:e,b:s};return et.runKernel(Qf,r)}const wu=it({greaterEqual_:iq});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function oq(n){const e={input:H(n,"input","imag")};return et.runKernel(GC,e)}const xS=it({imag_:oq});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function aq(n){const e={x:H(n,"x","isFinite")};return et.runKernel(Jf,e)}const lq=it({isFinite_:aq});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function uq(n){const e={x:H(n,"x","isInf")};return et.runKernel(tp,e)}const cq=it({isInf_:uq});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function hq(n){const e={x:H(n,"x","isNaN")};return et.runKernel(ep,e)}const dq=it({isNaN_:hq});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function fq(n,t=.2){const s={x:H(n,"x","leakyRelu")},r={alpha:t};return et.runKernel(O0,s,r)}const bS=it({leakyRelu_:fq});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function pq(n,t){let e=H(n,"a","less","string_or_numeric"),s=H(t,"b","less","string_or_numeric");[e,s]=wn(e,s),ne(e.shape,s.shape);const r={a:e,b:s};return et.runKernel(M0,r)}const _y=it({less_:pq});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function mq(n,t){let e=H(n,"a","lessEqual","string_or_numeric"),s=H(t,"b","lessEqual","string_or_numeric");[e,s]=wn(e,s),ne(e.shape,s.shape);const r={a:e,b:s};return et.runKernel(F0,r)}const dh=it({lessEqual_:mq});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function gq(n,t=5,e=1,s=1,r=.5){const i=H(n,"x","localResponseNormalization");U(i.rank===4||i.rank===3,()=>`Error in localResponseNormalization: x must be rank 3 or 4 but got
               rank ${i.rank}.`),U(Wc(t),()=>`Error in localResponseNormalization: depthRadius must be an integer but got depthRadius ${t}.`);let o=i,l=!1;i.rank===3&&(l=!0,o=rt(i,[1,i.shape[0],i.shape[1],i.shape[2]]));const u={x:o},h={depthRadius:t,bias:e,alpha:s,beta:r},d=et.runKernel(z0,u,h);return l?rt(d,[d.shape[1],d.shape[2],d.shape[3]]):d}const yq=it({localResponseNormalization_:gq});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function xq(n){const e={x:H(n,"x","log","float32")};return et.runKernel(np,e)}const Zi=it({log_:xq});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function bq(n){const e={x:H(n,"x","log1p")};return et.runKernel(sp,e)}const PD=it({log1p_:bq});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function vq(n,t){U(Kv(n),()=>"The f passed in variableGrads(f) must be a function"),U(t==null||Array.isArray(t)&&t.every(h=>h instanceof Ty),()=>"The varList passed in variableGrads(f, varList) must be an array of variables");const e=t!=null;if(!e){t=[];for(const h in et.registeredVariables)t.push(et.registeredVariables[h])}const s=e?t.filter(h=>!h.trainable):null,r=t.length;t=t.filter(h=>h.trainable),U(t.length>0,()=>`variableGrads() expects at least one of the input variables to be trainable, but none of the ${r} variables is trainable.`);const i=!0,{value:o,grads:l}=et.gradients(n,t,null,i);U(l.some(h=>h!=null),()=>"Cannot find a connection between any variable and the result of the loss function y=f(x). Please make sure the operations that use variables are inside the function f passed to minimize()."),U(o.rank===0,()=>`The f passed in variableGrads(f) must return a scalar, but it returned a rank-${o.rank} tensor`);const u={};return t.forEach((h,d)=>{l[d]!=null&&(u[h.name]=l[d])}),s!=null&&s.forEach(h=>u[h.name]=null),{value:o,grads:u}}function Kc(n){return et.customGrad(n)}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function wq(n){const e={x:H(n,"x","neg")};return et.runKernel(j0,e)}const vn=it({neg_:wq});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Cq(n){const e={x:H(n,"x","softplus")};return et.runKernel(bp,e)}const Np=it({softplus_:Cq});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Sq(n){const t=H(n,"x","logSigmoid");return Kc(s=>({value:vn(Np(vn(s))),gradFunc:o=>J(o,hh(vn(s)))}))(t)}const Tq=it({logSigmoid_:Sq});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Eq(n,t){let e=H(n,"a","sub"),s=H(t,"b","sub");[e,s]=wn(e,s);const r={a:e,b:s};return et.runKernel(Cp,r)}const Yt=it({sub_:Eq});/**
 * @license
 * Copyright 2020 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Iq(n,t=-1){const e=H(n,"logits","logSoftmax");if(t===-1&&(t=e.rank-1),t!==e.rank-1)throw Error(`Log Softmax along a non-last dimension is not yet supported. Logits was rank ${e.rank} and axis was ${t}`);return Kc((r,i)=>{const l=ci(r,t,!0),u=Yt(r,l),h=Yt(Ot(u,"float32"),Zi(Gt(Qi(u),t,!0)));return i([h]),{value:h,gradFunc:(p,m)=>{const[y]=m,x=!0,v=Qi(y);return Yt(p,J(Gt(p,t,x),v))}}})(e)}const VD=it({logSoftmax_:Iq});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function _q(n,t=null,e=!1){const s=H(n,"x","logSumExp"),r=le(t,s.shape),i=ci(s,r,!0),o=Yt(s,i),l=Qi(o),u=Gt(l,r),h=Zi(u),d=kt(rt(i,h.shape),h);if(e){const p=Nn(d.shape,r);return rt(d,p)}return d}const zD=it({logSumExp_:_q});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function kq(n,t){const e=H(n,"a","logicalAnd","bool"),s=H(t,"b","logicalAnd","bool");ne(e.shape,s.shape);const r={a:e,b:s};return et.runKernel(L0,r)}const zo=it({logicalAnd_:kq});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Aq(n){const e={x:H(n,"x","logicalNot","bool")};return et.runKernel(P0,e)}const vS=it({logicalNot_:Aq});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Nq(n,t){const e=H(n,"a","logicalOr","bool"),s=H(t,"b","logicalOr","bool");ne(e.shape,s.shape);const r={a:e,b:s};return et.runKernel(V0,r)}const BD=it({logicalOr_:Nq});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Rq(n,t){const e=H(n,"a","logicalXor","bool"),s=H(t,"b","logicalXor","bool");return ne(e.shape,s.shape),zo(BD(n,t),vS(zo(n,t)))}const $q=it({logicalXor_:Rq});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Dq(n,t,e,s,r){const i=H(n,"x","maxPool"),o=1;let l=i,u=!1;i.rank===3&&(u=!0,l=rt(i,[1,i.shape[0],i.shape[1],i.shape[2]])),U(l.rank===4,()=>`Error in maxPool: input must be rank 4 but got rank ${l.rank}.`),U(Is(e,o),()=>`Error in maxPool: Either strides or dilations must be 1. Got strides ${e} and dilations '${o}'`),Zs("maxPool",s,r);const h={x:l},d={filterSize:t,strides:e,pad:s,dimRoundingMode:r},p=et.runKernel(U0,h,d);return u?rt(p,[p.shape[1],p.shape[2],p.shape[3]]):p}const wS=it({maxPool_:Dq});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Oq(n,t=[1,1,1],e,s,r,i="NDHWC"){const o=H(n,"x","maxPool3d");let l=o,u=!1;o.rank===4&&(u=!0,l=rt(o,[1,o.shape[0],o.shape[1],o.shape[2],o.shape[3]])),U(l.rank===5,()=>`Error in maxPool3d: x must be rank 5 but got rank ${l.rank}.`),U(i==="NDHWC",()=>`Error in maxPool3d: Only NDHWC is currently supported, but got dataFormat of ${i}`),Zs("maxPool3d",s,r);const h={x:l},d={filterSize:t,strides:e,pad:s,dimRoundingMode:r,dataFormat:i},p=et.runKernel(G0,h,d);return u?rt(p,[p.shape[1],p.shape[2],p.shape[3],p.shape[4]]):p}const Mq=it({maxPool3d_:Oq});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Fq(n,t){let e=H(n,"a","maximum"),s=H(t,"b","maximum");[e,s]=wn(e,s),e.dtype==="bool"&&(e=Ot(e,"int32"),s=Ot(s,"int32")),ne(e.shape,s.shape);const r={a:e,b:s};return et.runKernel(rp,r)}const el=it({maximum_:Fq});/**
 * @license
 * Copyright 2020 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Lq(n,t=null,e=!1){const r={x:H(n,"x","mean")},i={axis:t,keepDims:e};return et.runKernel(W0,r,i)}const An=it({mean_:Lq});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Qn(n,t="float32"){if(Ho(n),t==="complex64"){const s=Qn(n,"float32"),r=Qn(n,"float32");return nu(s,r)}const e=Ts(yt(n),t);return et.makeTensor(e,n,t)}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function nl(n,t="float32"){if(Ho(n),t==="complex64"){const s=nl(n,"float32"),r=Qn(n,"float32");return nu(s,r)}const e=yC(yt(n),t);return et.makeTensor(e,n,t)}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Pq(n,t){let e=H(n,"a","minimum"),s=H(t,"b","minimum");[e,s]=wn(e,s),e.dtype==="bool"&&(e=Ot(e,"int32"),s=Ot(s,"int32")),ne(e.shape,s.shape);const r={a:e,b:s};return et.runKernel(ip,r)}const pf=it({minimum_:Pq});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Vq(n,t,e){U(e==="reflect"||e==="symmetric",()=>`Invalid mode. Mode must be either reflect or symmetric. Got ${e}.`);const s=H(n,"x","mirrorPad");if(s.rank===0)throw new Error("mirrorPad(scalar) is not defined. Pass non-scalar to mirrorPad");U(t.length===s.rank,()=>`Padding doesn't match input. Must be ${s.rank}. Got ${t.length}.`);const r=e==="reflect"?1:0;for(let l=0;l<s.rank;l++)U(t[l].length===2,()=>"Invalid number of paddings. Must be length of 2 each."),U(t[l][0]>=0&&t[l][0]<=s.shape[l]-r&&t[l][1]>=0&&t[l][1]<=s.shape[l]-r,()=>`Padding in dimension ${l} cannot be greater than or equal to ${s.shape[l]-r} or less than 0 for input of shape ${s.shape}`);const i={paddings:t,mode:e},o={x:s};return et.runKernel(q0,o,i)}const zq=it({mirrorPad_:Vq});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Bq(n,t){let e=H(n,"a","mod"),s=H(t,"b","mod");[e,s]=wn(e,s);const r={a:e,b:s};return et.runKernel(op,r)}const Uq=it({mod_:Bq});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Gq(n,t=null,e=!1){n=H(n,"x","moments");const s=le(t,n.shape),r=An(n,s,e);let i=r.shape;e||(i=Nn(r.shape,s));const o=nn(Yt(Ot(n,"float32"),rt(r,i))),l=An(o,s,e);return{mean:r,variance:l}}const CS=it({moments_:Gq});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Wq(n,t){let e=H(n,"a","notEqual","string_or_numeric"),s=H(t,"b","notEqual","string_or_numeric");[e,s]=wn(e,s),ne(e.shape,s.shape);const r={a:e,b:s};return et.runKernel(K0,r)}const ky=it({notEqual_:Wq});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Hq(n,t,e=1,s=0,r="int32"){if(t<2)throw new Error(`Error in oneHot: depth must be >=2, but it is ${t}`);const o={indices:H(n,"indices","oneHot","int32")},l={dtype:r,depth:t,onValue:e,offValue:s};return et.runKernel(Y0,o,l)}const UD=it({oneHot_:Hq});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function qq(n){const e={x:H(n,"x","onesLike")};return et.runKernel(X0,e)}const jr=it({onesLike_:qq});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function jq(n,t,e=0){const s=H(n,"x","pad");if(s.rank===0)throw new Error("pad(scalar) is not defined. Pass non-scalar to pad");const r={paddings:t,constantValue:e},i={x:s};return et.runKernel(Z0,i,r)}const SS=it({pad_:jq});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Kq(n,t,e){const s=H(n,"x","spaceToBatchND");U(s.rank>=1+t.length,()=>`input rank ${s.rank} should be > than [blockShape] ${t.length}`),U(e.length===t.length,()=>`paddings.shape[0] ${e.length} must be equal to [blockShape] ${t.length}`),U(s.shape.reduce((o,l,u)=>u>0&&u<=t.length?o&&(l+e[u-1][0]+e[u-1][1])%t[u-1]===0:o,!0),()=>`input spatial dimensions ${s.shape.slice(1)} with paddings ${e.toString()} must be divisible by blockShapes ${t.toString()}`);const r={x:s},i={blockShape:t,paddings:e};return et.runKernel(lx,r,i)}const TS=it({spaceToBatchND_:Kq});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Xq(n,t,e,s,r,i,o){r==null&&(r=[1,1]),i==null&&(i=1),s===0&&(s="valid");const l=H(n,"x","maxPool");let u=l,h=!1;l.rank===3&&(h=!0,u=rt(l,[1,l.shape[0],l.shape[1],l.shape[2]])),U(Is(i,r),()=>`Error in pool: Either strides or dilations must be 1. Got strides ${i} and dilations '${r}'`);const d=Kr(u.shape,t,i,r,s),p=[d.dilationHeight,d.dilationWidth];let m;s==="same"?m=Qq([d.filterHeight,d.filterWidth],p):m=[[0,0],[0,0]];const y=p[0]===1&&p[1]===1,[x,v]=Yq([d.inHeight,d.inWidth],p,m),C=y?s:"valid",S=y?u:TS(u,p,x),_=(e==="avg"?()=>hS(S,t,i,C,o):()=>wS(S,t,i,C,o))(),I=y?_:dS(_,p,v);return h?rt(I,[I.shape[1],I.shape[2],I.shape[3]]):I}function Yq(n,t,e){const s=e.map(d=>d[0]),r=e.map(d=>d[1]),i=n.concat(s,r),o=t.map((d,p)=>(d-i[p]%d)%d),l=r.map((d,p)=>d+o[p]),u=t.map((d,p)=>[s[p],l[p]]),h=t.map((d,p)=>[0,o[p]]);return[u,h]}function Qq(n,t){const s=n.map((o,l)=>o+(o-1)*(t[l]-1)).map(o=>o-1),r=s.map(o=>Math.floor(o/2)),i=s.map((o,l)=>o-r[l]);return s.map((o,l)=>[r[l],i[l]])}const Zq=it({pool_:Xq});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Jq(n,t){const e=H(n,"x","prelu"),s=H(t,"alpha","prelu"),r={x:e,alpha:s};return et.runKernel(J0,r)}const ES=it({prelu_:Jq});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function tj(n,t=null,e=!1){let s=H(n,"x","prod");s.dtype==="bool"&&(s=Ot(s,"int32"));const r={x:s},i={axis:t,keepDims:e};return et.runKernel(tx,r,i)}const ej=it({prod_:tj});var Kg={exports:{}},nj=Kg.exports,Xk;function sj(){return Xk||(Xk=1,function(n){(function(t,e,s){function r(u){var h=this,d=l();h.next=function(){var p=2091639*h.s0+h.c*23283064365386963e-26;return h.s0=h.s1,h.s1=h.s2,h.s2=p-(h.c=p|0)},h.c=1,h.s0=d(" "),h.s1=d(" "),h.s2=d(" "),h.s0-=d(u),h.s0<0&&(h.s0+=1),h.s1-=d(u),h.s1<0&&(h.s1+=1),h.s2-=d(u),h.s2<0&&(h.s2+=1),d=null}function i(u,h){return h.c=u.c,h.s0=u.s0,h.s1=u.s1,h.s2=u.s2,h}function o(u,h){var d=new r(u),p=h&&h.state,m=d.next;return m.int32=function(){return d.next()*4294967296|0},m.double=function(){return m()+(m()*2097152|0)*11102230246251565e-32},m.quick=m,p&&(typeof p=="object"&&i(p,d),m.state=function(){return i(d,{})}),m}function l(){var u=4022871197,h=function(d){d=String(d);for(var p=0;p<d.length;p++){u+=d.charCodeAt(p);var m=.02519603282416938*u;u=m>>>0,m-=u,m*=u,u=m>>>0,m-=u,u+=m*4294967296}return(u>>>0)*23283064365386963e-26};return h}e&&e.exports?e.exports=o:this.alea=o})(nj,n)}(Kg)),Kg.exports}var Xg={exports:{}},rj=Xg.exports,Yk;function ij(){return Yk||(Yk=1,function(n){(function(t,e,s){function r(l){var u=this,h="";u.x=0,u.y=0,u.z=0,u.w=0,u.next=function(){var p=u.x^u.x<<11;return u.x=u.y,u.y=u.z,u.z=u.w,u.w^=u.w>>>19^p^p>>>8},l===(l|0)?u.x=l:h+=l;for(var d=0;d<h.length+64;d++)u.x^=h.charCodeAt(d)|0,u.next()}function i(l,u){return u.x=l.x,u.y=l.y,u.z=l.z,u.w=l.w,u}function o(l,u){var h=new r(l),d=u&&u.state,p=function(){return(h.next()>>>0)/4294967296};return p.double=function(){do var m=h.next()>>>11,y=(h.next()>>>0)/4294967296,x=(m+y)/(1<<21);while(x===0);return x},p.int32=h.next,p.quick=p,d&&(typeof d=="object"&&i(d,h),p.state=function(){return i(h,{})}),p}e&&e.exports?e.exports=o:this.xor128=o})(rj,n)}(Xg)),Xg.exports}var Yg={exports:{}},oj=Yg.exports,Qk;function aj(){return Qk||(Qk=1,function(n){(function(t,e,s){function r(l){var u=this,h="";u.next=function(){var p=u.x^u.x>>>2;return u.x=u.y,u.y=u.z,u.z=u.w,u.w=u.v,(u.d=u.d+362437|0)+(u.v=u.v^u.v<<4^(p^p<<1))|0},u.x=0,u.y=0,u.z=0,u.w=0,u.v=0,l===(l|0)?u.x=l:h+=l;for(var d=0;d<h.length+64;d++)u.x^=h.charCodeAt(d)|0,d==h.length&&(u.d=u.x<<10^u.x>>>4),u.next()}function i(l,u){return u.x=l.x,u.y=l.y,u.z=l.z,u.w=l.w,u.v=l.v,u.d=l.d,u}function o(l,u){var h=new r(l),d=u&&u.state,p=function(){return(h.next()>>>0)/4294967296};return p.double=function(){do var m=h.next()>>>11,y=(h.next()>>>0)/4294967296,x=(m+y)/(1<<21);while(x===0);return x},p.int32=h.next,p.quick=p,d&&(typeof d=="object"&&i(d,h),p.state=function(){return i(h,{})}),p}e&&e.exports?e.exports=o:this.xorwow=o})(oj,n)}(Yg)),Yg.exports}var Qg={exports:{}},lj=Qg.exports,Zk;function uj(){return Zk||(Zk=1,function(n){(function(t,e,s){function r(l){var u=this;u.next=function(){var d=u.x,p=u.i,m,y;return m=d[p],m^=m>>>7,y=m^m<<24,m=d[p+1&7],y^=m^m>>>10,m=d[p+3&7],y^=m^m>>>3,m=d[p+4&7],y^=m^m<<7,m=d[p+7&7],m=m^m<<13,y^=m^m<<9,d[p]=y,u.i=p+1&7,y};function h(d,p){var m,y=[];if(p===(p|0))y[0]=p;else for(p=""+p,m=0;m<p.length;++m)y[m&7]=y[m&7]<<15^p.charCodeAt(m)+y[m+1&7]<<13;for(;y.length<8;)y.push(0);for(m=0;m<8&&y[m]===0;++m);for(m==8?y[7]=-1:y[m],d.x=y,d.i=0,m=256;m>0;--m)d.next()}h(u,l)}function i(l,u){return u.x=l.x.slice(),u.i=l.i,u}function o(l,u){l==null&&(l=+new Date);var h=new r(l),d=u&&u.state,p=function(){return(h.next()>>>0)/4294967296};return p.double=function(){do var m=h.next()>>>11,y=(h.next()>>>0)/4294967296,x=(m+y)/(1<<21);while(x===0);return x},p.int32=h.next,p.quick=p,d&&(d.x&&i(d,h),p.state=function(){return i(h,{})}),p}e&&e.exports?e.exports=o:this.xorshift7=o})(lj,n)}(Qg)),Qg.exports}var Zg={exports:{}},cj=Zg.exports,Jk;function hj(){return Jk||(Jk=1,function(n){(function(t,e,s){function r(l){var u=this;u.next=function(){var d=u.w,p=u.X,m=u.i,y,x;return u.w=d=d+1640531527|0,x=p[m+34&127],y=p[m=m+1&127],x^=x<<13,y^=y<<17,x^=x>>>15,y^=y>>>12,x=p[m]=x^y,u.i=m,x+(d^d>>>16)|0};function h(d,p){var m,y,x,v,C,S=[],E=128;for(p===(p|0)?(y=p,p=null):(p=p+"\0",y=0,E=Math.max(E,p.length)),x=0,v=-32;v<E;++v)p&&(y^=p.charCodeAt((v+32)%p.length)),v===0&&(C=y),y^=y<<10,y^=y>>>15,y^=y<<4,y^=y>>>13,v>=0&&(C=C+1640531527|0,m=S[v&127]^=y+C,x=m==0?x+1:0);for(x>=128&&(S[(p&&p.length||0)&127]=-1),x=127,v=4*128;v>0;--v)y=S[x+34&127],m=S[x=x+1&127],y^=y<<13,m^=m<<17,y^=y>>>15,m^=m>>>12,S[x]=y^m;d.w=C,d.X=S,d.i=x}h(u,l)}function i(l,u){return u.i=l.i,u.w=l.w,u.X=l.X.slice(),u}function o(l,u){l==null&&(l=+new Date);var h=new r(l),d=u&&u.state,p=function(){return(h.next()>>>0)/4294967296};return p.double=function(){do var m=h.next()>>>11,y=(h.next()>>>0)/4294967296,x=(m+y)/(1<<21);while(x===0);return x},p.int32=h.next,p.quick=p,d&&(d.X&&i(d,h),p.state=function(){return i(h,{})}),p}e&&e.exports?e.exports=o:this.xor4096=o})(cj,n)}(Zg)),Zg.exports}var Jg={exports:{}},dj=Jg.exports,tA;function fj(){return tA||(tA=1,function(n){(function(t,e,s){function r(l){var u=this,h="";u.next=function(){var p=u.b,m=u.c,y=u.d,x=u.a;return p=p<<25^p>>>7^m,m=m-y|0,y=y<<24^y>>>8^x,x=x-p|0,u.b=p=p<<20^p>>>12^m,u.c=m=m-y|0,u.d=y<<16^m>>>16^x,u.a=x-p|0},u.a=0,u.b=0,u.c=-1640531527,u.d=1367130551,l===Math.floor(l)?(u.a=l/4294967296|0,u.b=l|0):h+=l;for(var d=0;d<h.length+20;d++)u.b^=h.charCodeAt(d)|0,u.next()}function i(l,u){return u.a=l.a,u.b=l.b,u.c=l.c,u.d=l.d,u}function o(l,u){var h=new r(l),d=u&&u.state,p=function(){return(h.next()>>>0)/4294967296};return p.double=function(){do var m=h.next()>>>11,y=(h.next()>>>0)/4294967296,x=(m+y)/(1<<21);while(x===0);return x},p.int32=h.next,p.quick=p,d&&(typeof d=="object"&&i(d,h),p.state=function(){return i(h,{})}),p}e&&e.exports?e.exports=o:this.tychei=o})(dj,n)}(Jg)),Jg.exports}var ty={exports:{}};const pj={},mj=Object.freeze(Object.defineProperty({__proto__:null,default:pj},Symbol.toStringTag,{value:"Module"})),gj=L4(mj);var yj=ty.exports,eA;function xj(){return eA||(eA=1,function(n){(function(t,e,s){var r=256,i=6,o=52,l="random",u=s.pow(r,i),h=s.pow(2,o),d=h*2,p=r-1,m;function y(I,O,P){var D=[];O=O==!0?{entropy:!0}:O||{};var N=S(C(O.entropy?[I,_(e)]:I??E(),3),D),R=new x(D),$=function(){for(var A=R.g(i),V=u,L=0;A<h;)A=(A+L)*r,V*=r,L=R.g(1);for(;A>=d;)A/=2,V/=2,L>>>=1;return(A+L)/V};return $.int32=function(){return R.g(4)|0},$.quick=function(){return R.g(4)/4294967296},$.double=$,S(_(R.S),e),(O.pass||P||function(A,V,L,nt){return nt&&(nt.S&&v(nt,R),A.state=function(){return v(R,{})}),L?(s[l]=A,V):A})($,N,"global"in O?O.global:this==s,O.state)}function x(I){var O,P=I.length,D=this,N=0,R=D.i=D.j=0,$=D.S=[];for(P||(I=[P++]);N<r;)$[N]=N++;for(N=0;N<r;N++)$[N]=$[R=p&R+I[N%P]+(O=$[N])],$[R]=O;(D.g=function(A){for(var V,L=0,nt=D.i,Z=D.j,W=D.S;A--;)V=W[nt=p&nt+1],L=L*r+W[p&(W[nt]=W[Z=p&Z+V])+(W[Z]=V)];return D.i=nt,D.j=Z,L})(r)}function v(I,O){return O.i=I.i,O.j=I.j,O.S=I.S.slice(),O}function C(I,O){var P=[],D=typeof I,N;if(O&&D=="object")for(N in I)try{P.push(C(I[N],O-1))}catch{}return P.length?P:D=="string"?I:I+"\0"}function S(I,O){for(var P=I+"",D,N=0;N<P.length;)O[p&N]=p&(D^=O[p&N]*19)+P.charCodeAt(N++);return _(O)}function E(){try{var I;return m&&(I=m.randomBytes)?I=I(r):(I=new Uint8Array(r),(t.crypto||t.msCrypto).getRandomValues(I)),_(I)}catch{var O=t.navigator,P=O&&O.plugins;return[+new Date,t,P,t.screen,_(e)]}}function _(I){return String.fromCharCode.apply(0,I)}if(S(s.random(),e),n.exports){n.exports=y;try{m=gj}catch{}}else s["seed"+l]=y})(typeof self<"u"?self:yj,[],Math)}(ty)),ty.exports}var ov,nA;function bj(){if(nA)return ov;nA=1;var n=sj(),t=ij(),e=aj(),s=uj(),r=hj(),i=fj(),o=xj();return o.alea=n,o.xor128=t,o.xorwow=e,o.xorshift7=s,o.xor4096=r,o.tychei=i,ov=o,ov}var IS=bj();/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class GD{constructor(t,e,s,r,i){this.mean=t,this.stdDev=e,this.dtype=s,this.nextVal=NaN,this.truncated=r,this.truncated&&(this.upper=this.mean+this.stdDev*2,this.lower=this.mean-this.stdDev*2);const o=i||Math.random();this.random=IS.alea(o.toString())}nextValue(){if(!isNaN(this.nextVal)){const r=this.nextVal;return this.nextVal=NaN,r}let t,e,s=!1;for(;!s;){let r,i,o;do r=2*this.random()-1,i=2*this.random()-1,o=r*r+i*i;while(o>=1||o===0);const l=Math.sqrt(-2*Math.log(o)/o);t=this.mean+this.stdDev*r*l,e=this.mean+this.stdDev*i*l,(!this.truncated||this.isValidTruncated(t))&&(s=!0)}return(!this.truncated||this.isValidTruncated(e))&&(this.nextVal=this.convertValue(e)),this.convertValue(t)}convertValue(t){return this.dtype==null||this.dtype==="float32"?t:Math.round(t)}isValidTruncated(t){return t<=this.upper&&t>=this.lower}}class vj{constructor(t=0,e=1,s,r){if(this.canReturnFloat=()=>this.dtype==null||this.dtype==="float32",this.min=t,this.range=e-t,this.dtype=s,r==null&&(r=Math.random()),typeof r=="number"&&(r=r.toString()),!this.canReturnFloat()&&this.range<=1)throw new Error(`The difference between ${t} - ${e} <= 1 and dtype is not float`);this.random=IS.alea(r)}convertValue(t){return this.canReturnFloat()?t:Math.round(t)}nextValue(){return this.convertValue(this.min+this.range*this.random())}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function wj(n,t=0,e=1,s,r){if(Ho(n),s!=null&&s==="bool")throw new Error(`Unsupported data type ${s}`);const i=new GD(t,e,s,!1,r),o=ae(n,s);for(let l=0;l<o.values.length;l++)o.values[l]=i.nextValue();return o.toTensor()}const Cj=it({randomNormal_:wj});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Sj(n,t=0,e=1,s="float32",r){Ho(n);const i=ae(n,s),o=new vj(t,e,null,r);for(let l=0;l<i.values.length;l++)i.values[l]=o.nextValue();return i.toTensor()}const Rp=it({randomUniform_:Sj});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function mf(n,t,e=1,s="float32"){if(e===0)throw new Error("Cannot have a step of zero");const r={start:n,stop:t,step:e,dtype:s};return et.runKernel(YC,{},r)}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Tj(n){const e={input:H(n,"input","real")};return et.runKernel(QC,e)}const Ay=it({real_:Tj});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Ej(n){const e={x:H(n,"x","reciprocal")};return et.runKernel(up,e)}const Ij=it({reciprocal_:Ej});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function _j(n){const e={x:H(n,"x","relu")};return et.runKernel(cp,e)}const Cu=it({relu_:_j});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function kj(n){const e={x:H(n,"x","relu6")};return et.runKernel(hp,e)}const WD=it({relu6_:kj});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Aj(n,t){const s={x:H(n,"x","reverse")},r={dims:t};return et.runKernel(rx,s,r)}const uu=it({reverse_:Aj});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Nj(n){const e={x:H(n,"x","round")};return et.runKernel(dp,e)}const HD=it({round_:Nj});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Rj(n){const e={x:H(n,"x","rsqrt","float32")};return et.runKernel(fp,e)}const qD=it({rsqrt_:Rj});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function $j(n){const e={x:H(n,"x","selu")};return et.runKernel(pp,e)}const jD=it({selu_:$j});function Dj(n,t,e,s,r,i=[1,1],o="NHWC"){const l=H(n,"x","separableConv2d"),u=H(t,"depthwiseFilter","separableConv2d"),h=H(e,"pointwiseFilter","separableConv2d");let d=l,p=!1;if(l.rank===3&&(p=!0,d=rt(l,[1,l.shape[0],l.shape[1],l.shape[2]])),o==="NCHW")throw new Error("separableConv2d currently does not support dataFormat NCHW; only NHWC is supported");U(d.rank===4,()=>`Error in separableConv2d: input must be rank 4, but got rank ${d.rank}.`),U(u.rank===4,()=>`Error in separableConv2d: depthwise filter must be rank 4, but got rank ${u.rank}.`),U(h.rank===4,()=>`Error in separableConv2d: pointwise filter must be rank 4, but got rank ${u.rank}.`),U(h.shape[0]===1,()=>`Error in separableConv2d: the first dimension of pointwise filter  must be 1, but got ${h.shape[0]}.`),U(h.shape[1]===1,()=>`Error in separableConv2d: the second dimension of pointwise filter must be 1, but got ${h.shape[1]}.`);const m=u.shape[2],y=u.shape[3];U(h.shape[2]===m*y,()=>`Error in separableConv2d: the third dimension of pointwise filter must be ${m*y}, but got ${h.shape[2]}.`);const x=mS(d,u,s,r,o,i),C=au(x,h,1,"valid",o);return p?rt(C,[C.shape[1],C.shape[2],C.shape[3]]):C}const KD=it({separableConv2d_:Dj});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Oj(n){const e={x:H(n,"x","sign")};return et.runKernel(yp,e)}const Mj=it({sign_:Oj});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Fj(n){const e={x:H(n,"x","sin","float32")};return et.runKernel(mp,e)}const XD=it({sin_:Fj});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Lj(n){const e={x:H(n,"x","sinh")};return et.runKernel(gp,e)}const YD=it({sinh_:Lj});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Pj(n,t,e){const s=H(n,"x","slice1d");return U(s.rank===1,()=>`slice1d expects a rank-1 tensor, but got a rank-${s.rank} tensor`),Je(s,[t],[e])}const _S=it({slice1d_:Pj});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Vj(n,t,e){const s=H(n,"x","slice2d");return U(s.rank===2,()=>`slice2d expects a rank-2 tensor, but got a rank-${s.rank} tensor`),Je(s,t,e)}const QD=it({slice2d_:Vj});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function zj(n,t,e){const s=H(n,"x","slice3d");return U(s.rank===3,()=>`slice3d expects a rank-3 tensor, but got a rank-${s.rank} tensor`),Je(s,t,e)}const kS=it({slice3d_:zj});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Bj(n,t,e){const s=H(n,"x","slice4d");return U(s.rank===4,()=>`slice4d expects a rank-4 tensor, but got a rank-${s.rank} tensor`),Je(s,t,e)}const Ny=it({slice4d_:Bj});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Uj(n,t=-1){const e=H(n,"logits","softmax","float32");if(t===-1&&(t=e.rank-1),t!==e.rank-1)throw Error(`Softmax along a non-last dimension is not yet supported. Logits was rank ${e.rank} and dim was ${t}`);const s={logits:e},r={dim:t};return et.runKernel(cx,s,r)}const AS=it({softmax_:Uj});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Gj(n){U(n.dtype==="complex64",()=>`The dtype for tf.spectral.fft() must be complex64 but got ${n.dtype}.`);const t={input:n};return et.runKernel(VC,t)}const ZD=it({fft_:Gj});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Wj(n){U(n.dtype==="complex64",()=>`The dtype for tf.spectral.ifft() must be complex64 but got ${n.dtype}.`);const t={input:n};return et.runKernel(UC,t)}const dw=it({ifft_:Wj});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Hj(n){const t=n.shape[n.shape.length-1],e=n.size/t;let s;if(t<=2){const r=rt(n,[e,t]);s=dw(r)}else{const r=[e,2*(t-1)],i=rt(Ay(n),[e,t]),o=rt(xS(n),[e,t]),l=uu(Je(i,[0,1],[e,t-2]),1),u=J(uu(Je(o,[0,1],[e,t-2]),1),De(-1)),h=Xs([i,l],1),d=Xs([o,u],1),p=rt(nu(h,d),[r[0],r[1]]);s=dw(p)}if(s=Ay(s),n.rank===3&&n.shape[0]!==0){const r=s,i=n.shape[0];s=rt(s,[i,s.shape[0]/i,s.shape[1]]),r.dispose()}return s}const qj=it({irfft_:Hj});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function jj(n,t,e=0){const r={x:H(n,"x","split")},i={numOrSizeSplits:t,axis:e};return et.runKernel(ux,r,i)}const Cr=it({split_:jj});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Kj(n,t){U(n.dtype==="float32",()=>`The dtype for rfft() must be real value but got ${n.dtype}`);let e=n.shape[n.shape.length-1];const s=n.size/e;let r;if(t!=null&&t<e){const x=n.shape.map(C=>0),v=n.shape.map(C=>C);v[n.shape.length-1]=t,r=Je(n,x,v),e=t}else if(t!=null&&t>e){const x=n.shape.map(v=>v);x[n.shape.length-1]=t-e,r=Xs([n,Qn(x)],n.shape.length-1),e=t}else r=n;const i=we(r),o=rt(nu(r,i),[s,e]),l=ZD(o),u=Math.floor(e/2)+1,h=Ay(l),d=xS(l),p=Cr(h,[u,e-u],h.shape.length-1),m=Cr(d,[u,e-u],d.shape.length-1),y=r.shape.slice();return y[r.shape.length-1]=u,rt(nu(p[0],m[0]),y)}const Xj=it({rfft_:Kj});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Yj(n,t){let e=H(n,"a","squaredDifference"),s=H(t,"b","squaredDifference");[e,s]=wn(e,s),ne(e.shape,s.shape);const r={a:e,b:s},i={};return et.runKernel(wp,r,i)}const Qj=it({squaredDifference_:Yj});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Zj(n,t){const e=H(n,"x","squeeze","string_or_numeric");return rt(e,Ya(e.shape,t).newShape)}const $p=it({squeeze_:Zj});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Jj(n,t=0){const e=bD(n,"tensors","stack","string_or_numeric");U(e.length>=1,()=>"Pass at least one tensor to tf.stack"),e.length>0&&U(t<=e[0].rank,()=>"Axis must be <= rank of the tensor");const s=e,r={axis:t};return et.runKernel(Q0,s,r)}const Bo=it({stack_:Jj});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function t8(n,t=0){const s={x:H(n,"x","step")},r={alpha:t};return et.runKernel(Ip,s,r)}const Dp=it({step_:t8});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function e8(n,t,e,s,r=0,i=0,o=0,l=0,u=0){const d={x:H(n,"x","stridedSlice","string_or_numeric")},p={begin:t,end:e,strides:s,beginMask:r,endMask:i,ellipsisMask:o,newAxisMask:l,shrinkAxisMask:u};return et.runKernel(nS,d,p)}const n8=it({stridedSlice_:e8});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function s8(n){const e={x:H(n,"x","tan","float32")};return et.runKernel(Sp,e)}const r8=it({tan_:s8});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function ar(n,t){gC(n);const e=_p(n,t);if(e.length!==1)throw new Error("tensor1d() requires values to be a flat/TypedArray");return kp(n,null,e,t)}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function av(n,t,e){if(gC(n),t!=null&&t.length!==2)throw new Error("tensor2d() requires shape to have two numbers");const s=_p(n,e);if(s.length!==2&&s.length!==1)throw new Error("tensor2d() requires values to be number[][] or flat/TypedArray");if(s.length===1&&t==null)throw new Error("tensor2d() requires shape to be provided when `values` are a flat/TypedArray");return kp(n,t,s,e)}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function i8(n,t,e){if(gC(n),t!=null&&t.length!==3)throw new Error("tensor3d() requires shape to have three numbers");const s=_p(n,e);if(s.length!==3&&s.length!==1)throw new Error("tensor3d() requires values to be number[][][] or flat/TypedArray");if(s.length===1&&t==null)throw new Error("tensor3d() requires shape to be provided when `values` are a flat array");return kp(n,t,s,e)}function JD(n,t,e){const s=t.rank>1?t.shape[t.rank-1]:1,r=t.rank>1?t.rank-1:1,i=`Must have updates.shape = indices.shape[:batchDim] + shape[sliceDim:], got updates.shape: ${e.shape}, indices.shape: ${t.shape}, shape: ${n}, sliceDim: ${s}, and batchDim: ${r}.`;if(e.rank<r)throw new Error(i+` update.rank < ${r}. `);if(n.length<s+(e.rank-r))throw new Error(i+` Output shape length < ${s+(e.rank-r)}`);if(e.rank!==r+n.length-s)throw new Error(i+` update.rank != ${r+n.length-s}`);for(let o=0;o<r;++o)if(e.shape[o]!==t.shape[o])throw new Error(i+` updates.shape[${o}] (${e.shape[o]}) != indices.shape[${o}] (${t.shape[o]}).`);for(let o=0;o<e.rank-r;++o)if(e.shape[o+r]!==n[o+s])throw new Error(i+` updates.shape[${o+r}] (${e.shape[o+r]}) != shape[${o+r}] (${n[o+r]})`)}function o8(n,t,e){if(t.rank<1)throw new Error(`tf.scatterND() expects the indices to be rank 1 or higher, but the rank was ${t.rank}.`);if(n.rank<1)throw new Error(`tf.scatterND() expects the updates to be rank 1 or higher, but the rank was ${n.rank}.`);if(t.dtype!=="int32")throw new Error(`The dtype of 'indices' should be int32, but got dtype: ${t.dtype}`);if(e.length<1)throw new Error(`Output rank must be greater or equal to 1, but got shape: ${e}`);if(e.length===0){if(t.size===0)throw new Error(`Indices specified for empty output. indices shape: ${t.shape}`);if(n.size===0)throw new Error(`Updates specified for empty output. updates shape: ${n.shape}`)}JD(e,t,n)}function Su(n,t,e){const s=t.shape.length,r=s>1?t.shape[s-1]:1,i=e.length;let o=1;for(let p=r;p<i;++p)o*=e[p];const l=r<1?1:r,u=yt(t.shape)/l,h=[...zt(e.slice(0,r)),1],d=yt(e);return{sliceRank:r,numUpdates:u,sliceSize:o,strides:h,outputSize:d}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function a8(n,t=1,e=!0){const s=H(n,"x","topk");if(s.rank===0)throw new Error("topk() expects the input to be of rank 1 or higher");const r=s.shape[s.shape.length-1];if(t<0)throw new Error(`'k' passed to topk() must be >= 0 but got ${t}`);if(t>r)throw new Error(`'k' passed to topk() must be <= the last dimension (${r}) but got ${t}`);const i={x:s},o={k:t,sorted:e},[l,u]=et.runKernel(sS,i,o);return{values:l,indices:u}}const l8=it({topk_:a8});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function u8(n,t=0,e=1,s,r){if(Ho(n),s!=null&&s==="bool")throw new Error("Unsupported data type $ { dtype }");const i=new GD(t,e,s,!0,r),o=ae(n,s);for(let l=0;l<o.values.length;l++)o.values[l]=i.nextValue();return o.toTensor()}const tO=it({truncatedNormal_:u8});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function c8(n,t=0){const e=H(n,"x","unique","string_or_numeric");U(e.rank>0,()=>"The input tensor must be at least 1D");const s={x:e},r={axis:t},[i,o]=et.runKernel(iS,s,r);return{values:i,indices:o}}const h8=it({unique_:c8});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function d8(n,t,e){const s=H(n,"x","unsortedSegmentSum"),r=H(t,"segmentIds","unsortedSegmentSum","int32");U(Wc(e),()=>"numSegments must be of dtype int");const i={x:s,segmentIds:r},o={numSegments:e};return et.runKernel(dx,i,o)}const eO=it({unsortedSegmentSum_:d8});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function f8(n,t=0){const e=H(n,"x","unstack","string_or_numeric");U(t>=-e.shape.length&&t<e.shape.length,()=>`Axis = ${t} is not in [-${e.shape.length}, ${e.shape.length})`);const s={value:e},r={axis:t};return et.runKernel(hx,s,r)}const cu=it({unstack_:f8});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function p8(n,t=!0,e,s){return et.makeVariable(n,t,e,s)}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function nO(n,t){const e=[];for(let i=0;i<t.length;i++)t[i]&&e.push(i);const s=ae(n,"int32"),r=ae([e.length,n.length],"int32");for(let i=0;i<e.length;i++){const o=s.indexToLoc(e[i]),l=i*n.length;r.values.set(o,l)}return r.toTensor()}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function m8(n,t,e){const s=H(n,"x","transpose");if(t==null&&(t=s.shape.map((o,l)=>l).reverse()),U(s.rank===t.length,()=>`Error in transpose: rank of input ${s.rank} must match length of perm ${t}.`),t.forEach(o=>{U(o>=0&&o<s.rank,()=>`All entries in 'perm' must be between 0 and ${s.rank-1} but got ${t}`)}),s.rank<=1)return s.clone();const r={x:s},i={perm:t};return s.dtype==="complex64"?ct(()=>{let o=Ay(s),l=xS(s);return o=et.runKernel(Dc,{x:o},i),l=et.runKernel(Dc,{x:l},i),e&&(l=vn(l)),nu(o,l)}):et.runKernel(Dc,r,i)}const ve=it({transpose_:m8});/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function g8(n,t){if(t==null)return n.shape.slice();if(Oe(n.shape,t))return t;if(n.shape.length===t.length){const e=[];for(let s=0;s<n.shape.length;s++)t[s]==null&&n.shape[s]!=null?e.push(n.shape[s]):e.push(t[s]);return e}return t}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function y8(n,t,e,s){const r=H(n,"x","dropout");if(U(r.dtype==="float32",()=>`x has to be a floating point tensor since it's going to be scaled, but got a ${r.dtype} tensor instead.`),U(t>=0&&t<1,()=>`rate must be a float in the range [0, 1), but got ${t}.`),t===0)return n instanceof Fn?r.clone():r;const i=g8(r,e),o=1-t,l=Wt(vx(kt(Rp(i,0,1,"float32",s),o)),o);return J(r,l)}const x8=it({dropout_:y8});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function b8(n,t,e,s,r,i="NHWC",o){let l=n;n.rank===3&&(l=rt(n,[1,n.shape[0],n.shape[1],n.shape[2]]));let u=t;u.rank===3&&(u=rt(t,[1,t.shape[0],t.shape[1],t.shape[2]])),U(l.rank===4,()=>`Error in conv2dDerFilter: input must be rank 4, but got shape ${l.shape}.`),U(u.rank===4,()=>`Error in conv2dDerFilter: dy must be rank 4, but got shape ${u.shape}.`),U(e.length===4,()=>`Error in conv2dDerFilter: filterShape must be length 4, but got ${e}.`);const h=i==="NHWC"?l.shape[3]:l.shape[1],d=i==="NHWC"?u.shape[3]:u.shape[1];U(h===e[2],()=>`Error in conv2dDerFilter: depth of input ${h}) must match input depth in filter (${e[2]}.`),U(d===e[3],()=>`Error in conv2dDerFilter: depth of dy (${d}) must match output depth for filter (${e[3]}).`),Zs("conv2dDerFilter",r,o);const p={x:l,dy:u},m={strides:s,pad:r,dataFormat:i,dimRoundingMode:o,filterShape:e};return et.runKernel(kC,p,m)}const NS=it({conv2DBackpropFilter_:b8});/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function RS(n,t,e){if(e==null||e==="linear")return n;if(e==="relu")return J(n,Dp(t));throw new Error(`Cannot compute gradient for fused activation ${e}.`)}function $S(n,t){let e=t;const s=Bn(n.shape,t.shape);return s.length>0&&(e=Gt(e,s)),rt(e,n.shape)}function DS(n,t,e,s){if(t==="linear")return n;if(t==="relu")return Cu(n);if(t==="elu")return xx(n);if(t==="relu6")return WD(n);if(t==="prelu")return ES(n,e);if(t==="leakyrelu")return bS(n,s);if(t==="sigmoid")return hh(n);throw new Error(`Unknown fused activation ${t}.`)}const OS=(n,t)=>!(n>0)||t==="linear";/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function v8({x:n,filter:t,strides:e,pad:s,dataFormat:r="NHWC",dilations:i=[1,1],dimRoundingMode:o,bias:l,activation:u="linear",preluActivationWeights:h,leakyreluAlpha:d}){if(u=u||"linear",OS(et.state.gradientDepth,u)===!1){U(r==="NHWC",()=>`Error in fused conv2d: got dataFormat of ${r} but only NHWC is currently supported for the case of gradient depth is 0 and the activation is not linear.`);let P=au(n,t,e,s,r,i,o);return l!=null&&(P=kt(P,l)),DS(P,u,h,d)}const p=H(n,"x","conv2d","float32"),m=H(t,"filter","conv2d","float32");let y=p,x=!1;p.rank===3&&(x=!0,y=rt(p,[1,p.shape[0],p.shape[1],p.shape[2]])),U(y.rank===4,()=>`Error in fused conv2d: input must be rank 4, but got rank ${y.rank}.`),U(m.rank===4,()=>`Error in fused conv2d: filter must be rank 4, but got rank ${m.rank}.`),Zs("fused conv2d",s,o);const v=r==="NHWC"?y.shape[3]:y.shape[1];U(m.shape[2]===v,()=>`Error in conv2d: depth of input (${v}) must match input depth for filter ${m.shape[2]}.`),U(Is(e,i),()=>`Error in conv2D: Either strides or dilations must be 1. Got strides ${e} and dilations '${i}'`);const C=cs(y.shape,m.shape,e,i,s,o);let S;l!=null&&(S=H(l,"bias","fused conv2d"),[S]=wn(S,p),r==="NHWC"?ne(C.outShape,S.shape):(U(S.shape.length<=1,()=>`Error in fused conv2d: only supports scalar or 1-D Tensor bias for NCHW format but got the bias of rank-${S.shape.length}.`),U(S.shape.length===0||S.shape[0]===C.outChannels||S.shape[0]===1,()=>`Error in fused conv2d: bias shape (${S.shape}) is not compatible with the number of output channels (${C.outChannels})`)));let E;if(h!=null){const P=h.shape;if(U(P.length<=1||P.length===3,()=>`Error in fused conv2d: only supports scalar, 1-D Tensor or 3-D Tensor PReLU activation weights but got a tensor of rank-${P.length}.`),P.length===1)U(P[0]===1||P[0]===C.outChannels,()=>`Error in fused conv2d: PReLU activation weights (${P}) is not compatible with the number of output channels (${C.outChannels}).`);else if(P.length===3)try{ne(P,C.outShape)}catch{const N=`Error in fused conv2d: PReLU activation weights (${P}) is not compatible with the output shape of the conv2d (${C.outShape}).`;throw Error(N)}E=H(h,"prelu weights","fused conv2d")}const _=(P,D)=>{U(r==="NHWC",()=>`Error in gradient of fused conv2D: got dataFormat of ${r} but only NHWC is currently supported.`);const[N,R,$,A]=D,V=RS(P,$,u);U(iu(i),()=>`Error in gradient of fused conv2D: dilation rates greater than 1 are not yet supported in gradients. Got dilations '${i}'`);const L=fS(R.shape,V,N,e,s),nt=NS(R,V,N.shape,e,s),Z=[L,nt];if(A!=null){const W=$S(A,V);Z.push(W)}return Z},I={x:y,filter:m,bias:S,preluActivationWeights:E},O={strides:e,pad:s,dataFormat:r,dilations:i,dimRoundingMode:o,activation:u,leakyreluAlpha:d};return l==null?Kc((D,N,R)=>{let $=et.runKernel(Cy,I,O);return R([N,D,$]),x&&($=rt($,[$.shape[1],$.shape[2],$.shape[3]])),{value:$,gradFunc:_}})(y,m):Kc((D,N,R,$)=>{let A=et.runKernel(Cy,I,O);return $([N,D,A,R]),x&&(A=rt(A,[A.shape[1],A.shape[2],A.shape[3]])),{value:A,gradFunc:_}})(y,m,S)}const w8=it({fusedConv2d_:v8});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function C8(n,t,e,s,r,i=[1,1],o){let l=n;n.rank===3&&(l=rt(n,[1,n.shape[0],n.shape[1],n.shape[2]]));let u=t;u.rank===3&&(u=rt(t,[1,t.shape[0],t.shape[1],t.shape[2]]));const h={x:l,dy:u},d={strides:s,pad:r,dimRoundingMode:o,dilations:i,filterShape:e};return et.runKernel(MC,h,d)}const S8=it({depthwiseConv2dNativeBackpropFilter_:C8});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function T8(n,t,e,s,r,i=[1,1],o){let l=t,u=!1;t.rank===3&&(u=!0,l=rt(t,[1,t.shape[0],t.shape[1],t.shape[2]]));const h={dy:l,filter:e},d={strides:s,pad:r,dimRoundingMode:o,dilations:i,inputShape:n},p=et.runKernel(FC,h,d);return u?rt(p,[p.shape[1],p.shape[2],p.shape[3]]):p}const E8=it({depthwiseConv2dNativeBackpropInput_:T8});/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function I8({a:n,b:t,transposeA:e=!1,transposeB:s=!1,bias:r,activation:i="linear",preluActivationWeights:o,leakyreluAlpha:l=.2}){if(OS(et.state.gradientDepth,i)===!1){let A=$e(n,t,e,s);return r!=null&&(A=kt(A,r)),DS(A,i,o,l)}let u=H(n,"a","fused matMul"),h=H(t,"b","fused matMul");[u,h]=wn(u,h);const d=e?u.shape[u.rank-2]:u.shape[u.rank-1],p=s?h.shape[h.rank-1]:h.shape[h.rank-2],m=e?u.shape[u.rank-1]:u.shape[u.rank-2],y=s?h.shape[h.rank-2]:h.shape[h.rank-1],x=u.shape.slice(0,-2),v=h.shape.slice(0,-2),C=yt(x),S=yt(v);U(d===p,()=>`Error in fused matMul: inner shapes (${d}) and (${p}) of Tensors with shapes ${u.shape} and ${h.shape} and transposeA=${e} and transposeB=${s} must match.`);const _=ne(u.shape.slice(0,-2),h.shape.slice(0,-2)).concat([m,y]),I=e?rt(u,[C,d,m]):rt(u,[C,m,d]),O=s?rt(h,[S,y,p]):rt(h,[S,p,y]);let P;r!=null&&(P=H(r,"bias","fused matMul"),[P]=wn(P,u),ne(_,P.shape));let D;o!=null&&(D=H(o,"prelu weights","fused matMul"));const N=(A,V)=>{const[L,nt,Z,W]=V,K=RS(rt(A,Z.shape),Z,i);let Y,at;if(!e&&!s?(Y=$e(K,nt,!1,!0),at=$e(L,K,!0,!1)):!e&&s?(Y=$e(K,nt,!1,!1),at=$e(K,L,!0,!1)):e&&!s?(Y=$e(nt,K,!1,!0),at=$e(L,K,!1,!1)):(Y=$e(nt,K,!0,!0),at=$e(K,L,!0,!0)),r!=null){const B=$S(W,K);return[Y,at,B]}else return[Y,at]},R={a:I,b:O,bias:P,preluActivationWeights:D},$={transposeA:e,transposeB:s,activation:i,leakyreluAlpha:l};return r==null?Kc((V,L,nt)=>{const Z=et.runKernel(wy,R,$);return nt([V,L,Z]),{value:rt(Z,_),gradFunc:N}})(I,O):Kc((V,L,nt,Z)=>{const W=et.runKernel(wy,R,$);return Z([V,L,W,nt]),{value:rt(W,_),gradFunc:N}})(I,O,P)}const sA=it({fusedMatMul_:I8});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function _8(n,t,e,s,r="bilinear",i=0){const o=H(n,"image","cropAndResize"),l=H(t,"boxes","cropAndResize","float32"),u=H(e,"boxInd","cropAndResize","int32"),h=l.shape[0];U(o.rank===4,()=>`Error in cropAndResize: image must be rank 4,but got rank ${o.rank}.`),U(l.rank===2&&l.shape[1]===4,()=>`Error in cropAndResize: boxes must be have size [${h},4] but had shape ${l.shape}.`),U(u.rank===1&&u.shape[0]===h,()=>`Error in cropAndResize: boxInd must be have size [${h}] but had shape ${l.shape}.`),U(s.length===2,()=>`Error in cropAndResize: cropSize must be of length 2, but got length ${s.length}.`),U(s[0]>=1&&s[1]>=1,()=>`cropSize must be atleast [1,1], but was ${s}`),U(r==="bilinear"||r==="nearest",()=>`method must be bilinear or nearest, but was ${r}`);const d={image:o,boxes:l,boxInd:u},p={method:r,extrapolationValue:i,cropSize:s};return et.runKernel($C,d,p)}const k8=it({cropAndResize_:_8});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function A8(n){const t=H(n,"image","flipLeftRight","float32");U(t.rank===4,()=>`Error in flipLeftRight: image must be rank 4,but got rank ${t.rank}.`);const e={image:t};return et.runKernel(BC,e,{})}const N8=it({flipLeftRight_:A8});/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function R8(n){const t=H(n,"image","grayscaleToRGB"),e=t.rank-1,s=t.shape[e];U(t.rank>=2,()=>`Error in grayscaleToRGB: images must be at least rank 2, but got rank ${t.rank}.`),U(s===1,()=>`Error in grayscaleToRGB: last dimension of a grayscale image should be size 1, but got size ${s}.`);const r=new Array(t.rank);return r.fill(1,0,e),r[e]=3,ai(t,r)}const $8=it({grayscaleToRGB_:R8});/**
 * @license
 * Copyright 2023 Google LLC.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function D8(n){const t=H(n,"image","RGBToGrayscale"),e=t.rank-1,s=t.shape[e];U(t.rank>=2,()=>`Error in RGBToGrayscale: images must be at least rank 2, but got rank ${t.rank}.`),U(s===3,()=>`Error in RGBToGrayscale: last dimension of an RGB image should be size 3, but got size ${s}.`);const r=t.dtype,i=Ot(t,"float32"),o=ar([.2989,.587,.114]);let l;switch(t.rank){case 2:l=Od("ij,j->i",i,o);break;case 3:l=Od("ijk,k->ij",i,o);break;case 4:l=Od("ijkl,l->ijk",i,o);break;case 5:l=Od("ijklm,m->ijkl",i,o);break;case 6:l=Od("ijklmn,n->ijklm",i,o);break;default:throw new Error("Not a valid tensor rank.")}return l=js(l,-1),Ot(l,r)}const O8=it({rgbToGrayscale_:D8});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function M8(n,t,e=0,s=.5){const r=H(n,"image","rotateWithOffset","float32");U(r.rank===4,()=>`Error in rotateWithOffset: image must be rank 4,but got rank ${r.rank}.`);const i={image:r},o={radians:t,fillValue:e,center:s};return et.runKernel(oS,i,o)}const F8=it({rotateWithOffset_:M8});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function fh(n,t,e,s,r,i){s==null&&(s=.5),r==null&&(r=Number.NEGATIVE_INFINITY),i==null&&(i=0);const o=n.shape[0];return e=Math.min(e,o),U(0<=s&&s<=1,()=>`iouThreshold must be in [0, 1], but was '${s}'`),U(n.rank===2,()=>`boxes must be a 2D tensor, but was of rank '${n.rank}'`),U(n.shape[1]===4,()=>`boxes must have 4 columns, but 2nd dimension was ${n.shape[1]}`),U(t.rank===1,()=>"scores must be a 1D tensor"),U(t.shape[0]===o,()=>`scores has incompatible shape with boxes. Expected ${o}, but was ${t.shape[0]}`),U(0<=i&&i<=1,()=>`softNmsSigma must be in [0, 1], but was '${i}'`),{maxOutputSize:e,iouThreshold:s,scoreThreshold:r,softNmsSigma:i}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function L8(n,t,e,s=.5,r=Number.NEGATIVE_INFINITY){const i=H(n,"boxes","nonMaxSuppression","float32"),o=H(t,"scores","nonMaxSuppression","float32"),l=fh(i,o,e,s,r);e=l.maxOutputSize,s=l.iouThreshold,r=l.scoreThreshold;const u={maxOutputSize:e,iouThreshold:s,scoreThreshold:r};return et.runKernel(jC,{boxes:i,scores:o},u)}const P8=it({nonMaxSuppression_:L8});/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function V8(n,t,e){const s=z8(n,t,e),r=s<0?-(s+1):s;n.splice(r,0,t)}function z8(n,t,e){return U8(n,t,e||B8)}function B8(n,t){return n>t?1:n<t?-1:0}function U8(n,t,e){let s=0,r=n.length,i=0,o=!1;for(;s<r;){i=s+(r-s>>>1);const l=e(t,n[i]);l>0?s=i+1:(r=i,o=!l)}return o?s:-s-1}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function MS(n,t,e,s,r){return PS(n,t,e,s,r,0)}function FS(n,t,e,s,r,i){return PS(n,t,e,s,r,0,!1,i,!0)}function LS(n,t,e,s,r,i){return PS(n,t,e,s,r,i,!0)}function PS(n,t,e,s,r,i,o=!1,l=!1,u=!1){const h=[];for(let C=0;C<t.length;C++)t[C]>r&&h.push({score:t[C],boxIndex:C,suppressBeginIndex:0});h.sort(rA);const d=i>0?-.5/i:0,p=[],m=[];for(;p.length<e&&h.length>0;){const C=h.pop(),{score:S,boxIndex:E,suppressBeginIndex:_}=C;if(S<r)break;let I=!1;for(let O=p.length-1;O>=_;--O){const P=G8(n,E,p[O]);if(P>=s){I=!0;break}if(C.score=C.score*W8(s,d,P),C.score<=r)break}C.suppressBeginIndex=p.length,I||(C.score===S?(p.push(E),m.push(C.score)):C.score>r&&V8(h,C,rA))}const y=p.length,x=e-y;l&&x>0&&(p.push(...new Array(x).fill(0)),m.push(...new Array(x).fill(0)));const v={selectedIndices:p};return o&&(v.selectedScores=m),u&&(v.validOutputs=y),v}function G8(n,t,e){const s=n.subarray(t*4,t*4+4),r=n.subarray(e*4,e*4+4),i=Math.min(s[0],s[2]),o=Math.min(s[1],s[3]),l=Math.max(s[0],s[2]),u=Math.max(s[1],s[3]),h=Math.min(r[0],r[2]),d=Math.min(r[1],r[3]),p=Math.max(r[0],r[2]),m=Math.max(r[1],r[3]),y=(l-i)*(u-o),x=(p-h)*(m-d);if(y<=0||x<=0)return 0;const v=Math.max(i,h),C=Math.max(o,d),S=Math.min(l,p),E=Math.min(u,m),_=Math.max(S-v,0)*Math.max(E-C,0);return _/(y+x-_)}function W8(n,t,e){const s=Math.exp(t*e*e);return e<=n?s:0}function rA(n,t){return n.score-t.score||n.score===t.score&&t.boxIndex-n.boxIndex}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */async function H8(n,t,e,s=.5,r=Number.NEGATIVE_INFINITY){const i=H(n,"boxes","nonMaxSuppressionAsync"),o=H(t,"scores","nonMaxSuppressionAsync"),l=fh(i,o,e,s,r);e=l.maxOutputSize,s=l.iouThreshold,r=l.scoreThreshold;const u=await Promise.all([i.data(),o.data()]),h=u[0],d=u[1],{selectedIndices:p}=MS(h,d,e,s,r);return i!==n&&i.dispose(),o!==t&&o.dispose(),ar(p,"int32")}const q8=H8;/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function j8(n,t,e,s=.5,r=Number.NEGATIVE_INFINITY,i=0){const o=H(n,"boxes","nonMaxSuppression"),l=H(t,"scores","nonMaxSuppression"),u=fh(o,l,e,s,r,i);e=u.maxOutputSize,s=u.iouThreshold,r=u.scoreThreshold,i=u.softNmsSigma;const h={boxes:o,scores:l},d={maxOutputSize:e,iouThreshold:s,scoreThreshold:r,softNmsSigma:i},p=et.runKernel(XC,h,d);return{selectedIndices:p[0],selectedScores:p[1]}}const K8=it({nonMaxSuppressionWithScore_:j8});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */async function X8(n,t,e,s=.5,r=Number.NEGATIVE_INFINITY,i=0){const o=H(n,"boxes","nonMaxSuppressionAsync"),l=H(t,"scores","nonMaxSuppressionAsync"),u=fh(o,l,e,s,r,i);e=u.maxOutputSize,s=u.iouThreshold,r=u.scoreThreshold,i=u.softNmsSigma;const h=await Promise.all([o.data(),l.data()]),d=h[0],p=h[1],{selectedIndices:m,selectedScores:y}=LS(d,p,e,s,r,i);return o!==n&&o.dispose(),l!==t&&l.dispose(),{selectedIndices:ar(m,"int32"),selectedScores:ar(y)}}const Y8=X8;/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Q8(n,t,e,s=.5,r=Number.NEGATIVE_INFINITY,i=!1){const o=H(n,"boxes","nonMaxSuppression"),l=H(t,"scores","nonMaxSuppression"),u=fh(o,l,e,s,r,null),h=u.maxOutputSize,d=u.iouThreshold,p=u.scoreThreshold,m={boxes:o,scores:l},y={maxOutputSize:h,iouThreshold:d,scoreThreshold:p,padToMaxOutputSize:i},x=et.runKernel(KC,m,y);return{selectedIndices:x[0],validOutputs:x[1]}}const Z8=it({nonMaxSuppressionPadded_:Q8});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */async function J8(n,t,e,s=.5,r=Number.NEGATIVE_INFINITY,i=!1){const o=H(n,"boxes","nonMaxSuppressionAsync"),l=H(t,"scores","nonMaxSuppressionAsync"),u=fh(o,l,e,s,r,null),h=u.maxOutputSize,d=u.iouThreshold,p=u.scoreThreshold,[m,y]=await Promise.all([o.data(),l.data()]),{selectedIndices:x,validOutputs:v}=FS(m,y,h,d,p,i);return o!==n&&o.dispose(),l!==t&&l.dispose(),{selectedIndices:ar(x,"int32"),validOutputs:De(v,"int32")}}const t7=J8;/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function e7(n,t,e=!1,s=!1){const r=H(n,"images","resizeBilinear");U(r.rank===3||r.rank===4,()=>`Error in resizeBilinear: x must be rank 3 or 4, but got rank ${r.rank}.`),U(t.length===2,()=>`Error in resizeBilinear: new shape must 2D, but got shape ${t}.`),U(s===!1||e===!1,()=>"Error in resizeBilinear: If halfPixelCenters is true, alignCorners must be false.");let i=r,o=!1;r.rank===3&&(o=!0,i=rt(r,[1,r.shape[0],r.shape[1],r.shape[2]]));const l={images:i},u={alignCorners:e,halfPixelCenters:s,size:t},h=et.runKernel(sx,l,u);return o?rt(h,[h.shape[1],h.shape[2],h.shape[3]]):h}const sO=it({resizeBilinear_:e7});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function n7(n,t,e=!1,s=!1){const r=H(n,"images","resizeNearestNeighbor");U(r.rank===3||r.rank===4,()=>`Error in resizeNearestNeighbor: x must be rank 3 or 4, but got rank ${r.rank}.`),U(t.length===2,()=>`Error in resizeNearestNeighbor: new shape must 2D, but got shape ${t}.`),U(r.dtype==="float32"||r.dtype==="int32",()=>"`images` must have `int32` or `float32` as dtype"),U(s===!1||e===!1,()=>"Error in resizeNearestNeighbor: If halfPixelCenters is true, alignCorners must be false.");let i=r,o=!1;r.rank===3&&(o=!0,i=rt(r,[1,r.shape[0],r.shape[1],r.shape[2]]));const l={images:i},u={alignCorners:e,halfPixelCenters:s,size:t},h=et.runKernel(nx,l,u);return o?rt(h,[h.shape[1],h.shape[2],h.shape[3]]):h}const rO=it({resizeNearestNeighbor_:n7});/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * https://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function s7(n,t="binary",e=!1,s=.5){const r=H(n,"image","threshold"),i=.2989,o=.587,l=.114,u=r.shape[0]*r.shape[1];let h=J(ar([s]),255),d,p,m,y;if(U(r.rank===3,()=>`Error in threshold: image must be rank 3,but got rank ${r.rank}.`),U(r.shape[2]===3||r.shape[2]===1,()=>`Error in threshold: image color channel must be equal to 3 or 1but got ${r.shape[2]}.`),U(r.dtype==="int32"||r.dtype==="float32",()=>`Error in dtype: image dtype must be int32 or float32,but got dtype ${r.dtype}.`),U(t==="otsu"||t==="binary",()=>`Method must be binary or otsu, but was ${t}`),r.shape[2]===3){[d,p,m]=Cr(r,[1,1,1],-1);const C=J(d,i),S=J(p,o),E=J(m,l);y=kt(kt(C,S),E)}else y=n;if(t==="otsu"){const C=J5(Ot(HD(y),"int32"),Qd([]),256);h=r7(C,u)}const x=e?dh(y,h):Tr(y,h);return Ot(J(x,255),"int32")}function r7(n,t){let e=ar([-1]),s=ar([0]),r=ar([0]),i,o,l,u,h,d;for(let p=0;p<n.size-1;p++){i=Je(n,0,p+1),o=Je(n,p+1),h=Wt(Gt(i),t),d=Wt(Gt(o),t);const m=Gt(J(i,mf(0,i.size)));l=Wt(m,Gt(i));const y=yx(o.shape,i.size),x=kt(mf(0,o.size),y),v=J(o,x);u=Wt(Gt(v),Gt(o));const C=Yt(l,u),S=Yt(l,u),E=J(h,d);r=J(J(E,C),S);const _=Tr(r,s);s=Ps(_,r,s),e=Ps(_,ar([p]),e)}return e}const i7=it({threshold_:s7});/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function o7(n,t,e="nearest",s="constant",r=0,i){const o=H(n,"image","transform","float32"),l=H(t,"transforms","transform","float32");U(o.rank===4,()=>`Error in transform: image must be rank 4,but got rank ${o.rank}.`),U(l.rank===2&&(l.shape[0]===o.shape[0]||l.shape[0]===1)&&l.shape[1]===8,()=>"Error in transform: Input transform should be batch x 8 or 1 x 8"),U(i==null||i.length===2,()=>`Error in transform: outputShape must be [height, width] or null, but got ${i}.`);const u={image:o,transforms:l},h={interpolation:e,fillMode:s,fillValue:r,outputShape:i};return et.runKernel(rS,u,h)}const a7=it({transform_:o7});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function l7(n,t,e){const s=H(n,"a","bandPart");U(s.rank>=2,()=>`bandPart(): Rank must be at least 2, got ${s.rank}.`);const r=s.shape,[i,o]=s.shape.slice(-2);let l,u;typeof t=="number"?(U(t%1===0,()=>`bandPart(): numLower must be an integer, got ${t}.`),U(t<=i,()=>`bandPart(): numLower (${t}) must not be greater than the number of rows (${i}).`),l=H(t<0?i:t,"numLower","bandPart")):(U(t.dtype==="int32",()=>"bandPart(): numLower's dtype must be an int32."),l=Ps(_y(t,0),i,pf(t,i))),typeof e=="number"?(U(e%1===0,()=>`bandPart(): numUpper must be an integer, got ${e}.`),U(e<=o,()=>`bandPart(): numUpper (${e}) must not be greater than the number of columns (${o}).`),u=H(e<0?o:e,"numUpper","bandPart")):(U(e.dtype==="int32",()=>"bandPart(): numUpper's dtype must be an int32."),u=Ps(_y(e,0),o,pf(e,o)));const h=rt(mf(0,i,1,"int32"),[-1,1]),d=mf(0,o,1,"int32"),p=Yt(h,d),m=zo(dh(p,l),wu(p,vn(u))),y=Qn([i,o],s.dtype);return rt(Bo(cu(rt(s,[-1,i,o])).map(x=>Ps(m,x,y))),r)}const u7=it({bandPart_:l7});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function c7(n){let t;if(Array.isArray(n)){t=!1,U(n!=null&&n.length>0,()=>"Gram-Schmidt process: input must not be null, undefined, or empty");const r=n[0].shape[0];for(let i=1;i<n.length;++i)U(n[i].shape[0]===r,()=>`Gram-Schmidt: Non-unique lengths found in the input vectors: (${n[i].shape[0]} vs. ${r})`)}else t=!0,n=Cr(n,n.shape[0],0).map(r=>$p(r,[0]));U(n.length<=n[0].shape[0],()=>`Gram-Schmidt: Number of vectors (${n.length}) exceeds number of dimensions (${n[0].shape[0]}).`);const e=[],s=n;for(let r=0;r<n.length;++r)e.push(et.tidy(()=>{let i=s[r];if(r>0)for(let o=0;o<r;++o){const l=J(Gt(J(e[o],i)),e[o]);i=Yt(i,l)}return Wt(i,bx(i,"euclidean"))}));return t?Bo(e,0):e}const h7=it({gramSchmidt_:c7});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function d7(n,t=!1){if(U(n.rank>=2,()=>`qr() requires input tensor to have a rank >= 2, but got rank ${n.rank}`),n.rank===2)return iA(n,t);{const e=n.shape.slice(0,n.shape.length-2).reduce((u,h)=>u*h),s=cu(rt(n,[e,n.shape[n.shape.length-2],n.shape[n.shape.length-1]]),0),r=[],i=[];s.forEach(u=>{const[h,d]=iA(u,t);r.push(h),i.push(d)});const o=rt(Bo(r,0),n.shape),l=rt(Bo(i,0),n.shape);return[o,l]}}function iA(n,t=!1){return et.tidy(()=>{U(n.shape.length===2,()=>`qr2d() requires a 2D Tensor, but got a ${n.shape.length}D Tensor.`);const e=n.shape[0],s=n.shape[1];let r=LD(e),i=Xl(n);const o=av([[1]],[1,1]);let l=Xl(o);const u=e>=s?s:e;for(let h=0;h<u;++h){const d=i,p=l,m=r;[l,i,r]=et.tidy(()=>{const y=Je(i,[h,h],[e-h,1]),x=bx(y),v=Je(i,[h,h],[1,1]),C=Ps(Tr(v,0),av([[-1]]),av([[1]])),S=Yt(v,J(C,x)),E=Wt(y,S);E.shape[0]===1?l=Xl(o):l=Xs([o,Je(E,[1,0],[E.shape[0]-1,E.shape[1]])],0);const _=vn(Wt($e(C,S),x)),I=Je(i,[h,0],[e-h,s]),O=J(_,l),P=ve(l);if(h===0)i=Yt(I,$e(O,$e(P,I)));else{const R=Yt(I,$e(O,$e(P,I)));i=Xs([Je(i,[0,0],[h,s]),R],0)}const D=ve(O),N=Je(r,[0,h],[e,r.shape[1]-h]);if(h===0)r=Yt(N,$e($e(N,l),D));else{const R=Yt(N,$e($e(N,l),D));r=Xs([Je(r,[0,0],[e,h]),R],1)}return[l,i,r]}),oe([d,p,m])}return!t&&e>s&&(r=Je(r,[0,0],[e,s]),i=Je(i,[0,0],[s,s])),[r,i]})}const f7=it({qr_:d7});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Do={flipLeftRight:N8,grayscaleToRGB:$8,resizeNearestNeighbor:rO,resizeBilinear:sO,rgbToGrayscale:O8,rotateWithOffset:F8,cropAndResize:k8,nonMaxSuppression:P8,nonMaxSuppressionAsync:q8,nonMaxSuppressionWithScore:K8,nonMaxSuppressionWithScoreAsync:Y8,nonMaxSuppressionPadded:Z8,nonMaxSuppressionPaddedAsync:t7,threshold:i7,transform:a7},p7={bandPart:u7,gramSchmidt:h7,qr:f7};/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const m7=new Map,g7=new Map;class ph{getClassName(){return this.constructor.className}static fromConfig(t,e){return new t(e)}}class Gr{constructor(){this.classNameMap={}}static getMap(){return Gr.instance==null&&(Gr.instance=new Gr),Gr.instance}static register(t){Gr.getMap().classNameMap[t.className]=[t,t.fromConfig]}}function It(n,t,e){U(n.className!=null,()=>"Class being registered does not have the static className property defined."),U(typeof n.className=="string",()=>"className is required to be a string, but got type "+typeof n.className),U(n.className.length>0,()=>"Class being registered has an empty-string as its className, which is disallowed."),typeof t>"u"&&(t="Custom"),typeof e>"u"&&(e=n.className);const s=e,r=t+">"+s;return Gr.register(n),m7.set(r,n),g7.set(n,r),n}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class sl extends ph{minimize(t,e=!1,s){const{value:r,grads:i}=this.computeGradients(t,s);if(s!=null){const o=s.map(l=>({name:l.name,tensor:i[l.name]}));this.applyGradients(o)}else this.applyGradients(i);return oe(i),e?r:(r.dispose(),null)}get iterations(){return this.iterations_==null&&(this.iterations_=0),this.iterations_}incrementIterations(){this.iterations_=this.iterations+1}computeGradients(t,e){return vq(t,e)}dispose(){this.iterations_!=null&&oe(this.iterations_)}async saveIterations(){return this.iterations_==null&&(this.iterations_=0),{name:"iter",tensor:De(this.iterations_,"int32")}}async getWeights(){throw new Error("getWeights() is not implemented for this optimizer yet.")}async setWeights(t){throw new Error(`setWeights() is not implemented for this optimizer class ${this.getClassName()}`)}async extractIterations(t){return this.iterations_=(await t[0].tensor.data())[0],t.slice(1)}}Object.defineProperty(sl,Symbol.hasInstance,{value:n=>n.minimize!=null&&n.computeGradients!=null&&n.applyGradients!=null});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class iO extends sl{static get className(){return"Adadelta"}constructor(t,e,s=null){super(),this.learningRate=t,this.rho=e,this.epsilon=s,this.accumulatedGrads=[],this.accumulatedUpdates=[],s==null&&(this.epsilon=et.backend.epsilon())}applyGradients(t){(Array.isArray(t)?t.map(s=>s.name):Object.keys(t)).forEach((s,r)=>{const i=et.registeredVariables[s],o=!1;this.accumulatedGrads[r]==null&&(this.accumulatedGrads[r]={originalName:`${s}/accum_grad`,variable:ct(()=>we(i).variable(o))}),this.accumulatedUpdates[r]==null&&(this.accumulatedUpdates[r]={originalName:`${s}/accum_var`,variable:ct(()=>we(i).variable(o))});const l=Array.isArray(t)?t[r].tensor:t[s];if(l==null)return;const u=this.accumulatedGrads[r].variable,h=this.accumulatedUpdates[r].variable;ct(()=>{const d=kt(J(u,this.rho),J(nn(l),1-this.rho)),p=J(Wt(Es(kt(h,this.epsilon)),Es(kt(u,this.epsilon))),l),m=kt(J(h,this.rho),J(nn(p),1-this.rho));u.assign(d),h.assign(m);const y=kt(J(p,-this.learningRate),i);i.assign(y)})}),this.incrementIterations()}dispose(){this.accumulatedUpdates!=null&&(oe(this.accumulatedGrads.map(t=>t.variable)),oe(this.accumulatedUpdates.map(t=>t.variable)))}async getWeights(){const t=[...this.accumulatedGrads,...this.accumulatedUpdates];return[await this.saveIterations()].concat(t.map(e=>({name:e.originalName,tensor:e.variable})))}async setWeights(t){t=await this.extractIterations(t);const e=t.length/2,s=!1;this.accumulatedGrads=t.slice(0,e).map(r=>({originalName:r.name,variable:r.tensor.variable(s)})),this.accumulatedUpdates=t.slice(e,e*2).map(r=>({originalName:r.name,variable:r.tensor.variable(s)}))}getConfig(){return{learningRate:this.learningRate,rho:this.rho,epsilon:this.epsilon}}static fromConfig(t,e){return new t(e.learningRate,e.rho,e.epsilon)}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class oO extends sl{static get className(){return"Adagrad"}constructor(t,e=.1){super(),this.learningRate=t,this.initialAccumulatorValue=e,this.accumulatedGrads=[]}applyGradients(t){(Array.isArray(t)?t.map(s=>s.name):Object.keys(t)).forEach((s,r)=>{const i=et.registeredVariables[s];this.accumulatedGrads[r]==null&&(this.accumulatedGrads[r]={originalName:`${s}/accumulator`,variable:ct(()=>yx(i.shape,this.initialAccumulatorValue).variable(!1))});const o=Array.isArray(t)?t[r].tensor:t[s];if(o==null)return;const l=this.accumulatedGrads[r].variable;ct(()=>{const u=kt(l,nn(o));l.assign(u);const h=kt(J(Wt(o,Es(kt(u,et.backend.epsilon()))),-this.learningRate),i);i.assign(h)})}),this.incrementIterations()}dispose(){this.accumulatedGrads!=null&&oe(this.accumulatedGrads.map(t=>t.variable))}async getWeights(){return[await this.saveIterations()].concat(this.accumulatedGrads.map(t=>({name:t.originalName,tensor:t.variable})))}async setWeights(t){t=await this.extractIterations(t);const e=!1;this.accumulatedGrads=t.map(s=>({originalName:s.name,variable:s.tensor.variable(e)}))}getConfig(){return{learningRate:this.learningRate,initialAccumulatorValue:this.initialAccumulatorValue}}static fromConfig(t,e){return new t(e.learningRate,e.initialAccumulatorValue)}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class aO extends sl{static get className(){return"Adam"}constructor(t,e,s,r=null){super(),this.learningRate=t,this.beta1=e,this.beta2=s,this.epsilon=r,this.accumulatedFirstMoment=[],this.accumulatedSecondMoment=[],ct(()=>{this.accBeta1=De(e).variable(),this.accBeta2=De(s).variable()}),r==null&&(this.epsilon=et.backend.epsilon())}applyGradients(t){const e=Array.isArray(t)?t.map(s=>s.name):Object.keys(t);ct(()=>{const s=Yt(1,this.accBeta1),r=Yt(1,this.accBeta2);e.forEach((i,o)=>{const l=et.registeredVariables[i],u=!1;this.accumulatedFirstMoment[o]==null&&(this.accumulatedFirstMoment[o]={originalName:`${i}/m`,variable:ct(()=>we(l).variable(u))}),this.accumulatedSecondMoment[o]==null&&(this.accumulatedSecondMoment[o]={originalName:`${i}/v`,variable:ct(()=>we(l).variable(u))});const h=Array.isArray(t)?t[o].tensor:t[i];if(h==null)return;const d=this.accumulatedFirstMoment[o].variable,p=this.accumulatedSecondMoment[o].variable,m=kt(J(d,this.beta1),J(h,1-this.beta1)),y=kt(J(p,this.beta2),J(nn(h),1-this.beta2)),x=Wt(m,s),v=Wt(y,r);d.assign(m),p.assign(y);const C=kt(J(Wt(x,kt(Es(v),this.epsilon)),-this.learningRate),l);l.assign(C)}),this.accBeta1.assign(J(this.accBeta1,this.beta1)),this.accBeta2.assign(J(this.accBeta2,this.beta2))}),this.incrementIterations()}dispose(){this.accBeta1.dispose(),this.accBeta2.dispose(),this.accumulatedFirstMoment!=null&&oe(this.accumulatedFirstMoment.map(t=>t.variable)),this.accumulatedSecondMoment!=null&&oe(this.accumulatedSecondMoment.map(t=>t.variable))}async getWeights(){const t=[...this.accumulatedFirstMoment,...this.accumulatedSecondMoment];return[await this.saveIterations()].concat(t.map(e=>({name:e.originalName,tensor:e.variable})))}async setWeights(t){t=await this.extractIterations(t),ct(()=>{this.accBeta1.assign(lu(this.beta1,this.iterations_+1)),this.accBeta2.assign(lu(this.beta2,this.iterations_+1))});const e=t.length/2,s=!1;this.accumulatedFirstMoment=t.slice(0,e).map(r=>({originalName:r.name,variable:r.tensor.variable(s)})),this.accumulatedSecondMoment=t.slice(e,e*2).map(r=>({originalName:r.name,variable:r.tensor.variable(s)}))}getConfig(){return{learningRate:this.learningRate,beta1:this.beta1,beta2:this.beta2,epsilon:this.epsilon}}static fromConfig(t,e){return new t(e.learningRate,e.beta1,e.beta2,e.epsilon)}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class lO extends sl{static get className(){return"Adamax"}constructor(t,e,s,r=null,i=0){super(),this.learningRate=t,this.beta1=e,this.beta2=s,this.epsilon=r,this.decay=i,this.accumulatedFirstMoment=[],this.accumulatedWeightedInfNorm=[],ct(()=>{this.iteration=De(0).variable(),this.accBeta1=De(e).variable()}),r==null&&(this.epsilon=et.backend.epsilon())}applyGradients(t){const e=Array.isArray(t)?t.map(s=>s.name):Object.keys(t);ct(()=>{const s=Yt(1,this.accBeta1),r=Wt(-this.learningRate,kt(J(this.iteration,this.decay),1));e.forEach((i,o)=>{const l=et.registeredVariables[i],u=!1;this.accumulatedFirstMoment[o]==null&&(this.accumulatedFirstMoment[o]={originalName:`${i}/m`,variable:we(l).variable(u)}),this.accumulatedWeightedInfNorm[o]==null&&(this.accumulatedWeightedInfNorm[o]={originalName:`${i}/v`,variable:we(l).variable(u)});const h=Array.isArray(t)?t[o].tensor:t[i];if(h==null)return;const d=this.accumulatedFirstMoment[o].variable,p=this.accumulatedWeightedInfNorm[o].variable,m=kt(J(d,this.beta1),J(h,1-this.beta1)),y=J(p,this.beta2),x=Os(h),v=el(y,x);d.assign(m),p.assign(v);const C=kt(J(Wt(r,s),Wt(m,kt(v,this.epsilon))),l);l.assign(C)}),this.iteration.assign(kt(this.iteration,1)),this.accBeta1.assign(J(this.accBeta1,this.beta1))}),this.incrementIterations()}dispose(){this.accBeta1.dispose(),this.iteration.dispose(),this.accumulatedFirstMoment!=null&&oe(this.accumulatedFirstMoment.map(t=>t.variable)),this.accumulatedWeightedInfNorm!=null&&oe(this.accumulatedWeightedInfNorm.map(t=>t.variable))}async getWeights(){throw new Error("getWeights() is not implemented for Adamax yet.")}async setWeights(t){throw new Error("setWeights() is not implemented for Adamax yet.")}getConfig(){return{learningRate:this.learningRate,beta1:this.beta1,beta2:this.beta2,epsilon:this.epsilon,decay:this.decay}}static fromConfig(t,e){return new t(e.learningRate,e.beta1,e.beta2,e.epsilon,e.decay)}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class VS extends sl{static get className(){return"SGD"}constructor(t){super(),this.learningRate=t,this.setLearningRate(t)}applyGradients(t){(Array.isArray(t)?t.map(s=>s.name):Object.keys(t)).forEach((s,r)=>{const i=Array.isArray(t)?t[r].tensor:t[s];if(i==null)return;const o=et.registeredVariables[s];ct(()=>{const l=kt(J(this.c,i),o);o.assign(l)})}),this.incrementIterations()}setLearningRate(t){this.learningRate=t,this.c!=null&&this.c.dispose(),this.c=Ui(De(-t))}dispose(){this.c.dispose()}async getWeights(){return[await this.saveIterations()]}async setWeights(t){if(t=await this.extractIterations(t),t.length!==0)throw new Error("SGD optimizer does not have settable weights.")}getConfig(){return{learningRate:this.learningRate}}static fromConfig(t,e){return new t(e.learningRate)}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class uO extends VS{static get className(){return"Momentum"}constructor(t,e,s=!1){super(t),this.learningRate=t,this.momentum=e,this.useNesterov=s,this.accumulations=[],this.m=De(this.momentum)}applyGradients(t){(Array.isArray(t)?t.map(s=>s.name):Object.keys(t)).forEach((s,r)=>{const i=et.registeredVariables[s];this.accumulations[r]==null&&(this.accumulations[r]={originalName:`${s}/momentum`,variable:ct(()=>we(i).variable(!1))});const o=this.accumulations[r].variable,l=Array.isArray(t)?t[r].tensor:t[s];l!=null&&ct(()=>{let u;const h=kt(J(this.m,o),l);this.useNesterov?u=kt(J(this.c,kt(l,J(h,this.m))),i):u=kt(J(this.c,h),i),o.assign(h),i.assign(u)})}),this.incrementIterations()}dispose(){this.m.dispose(),this.accumulations!=null&&oe(this.accumulations.map(t=>t.variable))}setMomentum(t){this.momentum=t}async getWeights(){return[await this.saveIterations()].concat(this.accumulations.map(t=>({name:t.originalName,tensor:t.variable})))}async setWeights(t){t=await this.extractIterations(t);const e=!1;this.accumulations=t.map(s=>({originalName:s.name,variable:s.tensor.variable(e)}))}getConfig(){return{learningRate:this.learningRate,momentum:this.momentum,useNesterov:this.useNesterov}}static fromConfig(t,e){return new t(e.learningRate,e.momentum,e.useNesterov)}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class cO extends sl{static get className(){return"RMSProp"}constructor(t,e=.9,s=0,r=null,i=!1){if(super(),this.learningRate=t,this.decay=e,this.momentum=s,this.epsilon=r,this.accumulatedMeanSquares=[],this.accumulatedMoments=[],this.accumulatedMeanGrads=[],this.centered=i,r==null&&(this.epsilon=et.backend.epsilon()),t==null)throw new Error("learningRate for RMSPropOptimizer must be defined.")}applyGradients(t){(Array.isArray(t)?t.map(s=>s.name):Object.keys(t)).forEach((s,r)=>{const i=et.registeredVariables[s],o=!1;this.accumulatedMeanSquares[r]==null&&(this.accumulatedMeanSquares[r]={originalName:`${s}/rms`,variable:ct(()=>we(i).variable(o))}),this.accumulatedMoments[r]==null&&(this.accumulatedMoments[r]={originalName:`${s}/momentum`,variable:ct(()=>we(i).variable(o))}),this.accumulatedMeanGrads[r]==null&&this.centered&&(this.accumulatedMeanGrads[r]={originalName:`${s}/mg`,variable:ct(()=>we(i).variable(o))});const l=Array.isArray(t)?t[r].tensor:t[s];if(l==null)return;const u=this.accumulatedMeanSquares[r].variable,h=this.accumulatedMoments[r].variable;ct(()=>{const d=kt(J(u,this.decay),J(nn(l),1-this.decay));if(this.centered){const p=this.accumulatedMeanGrads[r].variable,m=kt(J(p,this.decay),J(l,1-this.decay)),y=Wt(J(l,this.learningRate),Es(Yt(d,kt(nn(m),this.epsilon)))),x=kt(J(h,this.momentum),y);u.assign(d),p.assign(m),h.assign(x);const v=Yt(i,x);i.assign(v)}else{const p=kt(J(u,this.decay),J(nn(l),1-this.decay)),m=kt(J(h,this.momentum),Wt(J(l,this.learningRate),Es(kt(p,this.epsilon))));u.assign(p),h.assign(m);const y=Yt(i,m);i.assign(y)}})}),this.incrementIterations()}dispose(){this.accumulatedMeanSquares!=null&&oe(this.accumulatedMeanSquares.map(t=>t.variable)),this.accumulatedMeanGrads!=null&&this.centered&&oe(this.accumulatedMeanGrads.map(t=>t.variable)),this.accumulatedMoments!=null&&oe(this.accumulatedMoments.map(t=>t.variable))}async getWeights(){const t=[...this.accumulatedMeanSquares,...this.accumulatedMoments];return this.centered&&t.push(...this.accumulatedMeanGrads),[await this.saveIterations()].concat(t.map(e=>({name:e.originalName,tensor:e.variable})))}async setWeights(t){t=await this.extractIterations(t);const e=this.centered?t.length/3:t.length/2,s=!1;this.accumulatedMeanSquares=t.slice(0,e).map(r=>({originalName:r.name,variable:r.tensor.variable(s)})),this.accumulatedMoments=t.slice(e,e*2).map(r=>({originalName:r.name,variable:r.tensor.variable(s)})),this.centered&&(this.accumulatedMeanGrads=t.slice(e*2,e*3).map(r=>({originalName:r.name,variable:r.tensor.variable(s)})))}getConfig(){return{learningRate:this.learningRate,decay:this.decay,momentum:this.momentum,epsilon:this.epsilon,centered:this.centered}}static fromConfig(t,e){return new t(e.learningRate,e.decay,e.momentum,e.epsilon,e.centered)}}/**
 * @license
 * Copyright 2022 Google LLC.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const y7=[iO,oO,aO,lO,uO,cO,VS];function x7(){for(const n of y7)It(n)}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function oA(n,t,e,s){o(n),e=e??0,s=s??1,l(e,s);let r=0;const i=u=>(u.then(h=>{const d=e+ ++r/n.length*(s-e);return t(d),h}),u);function o(u){U(u!=null&&Array.isArray(u)&&u.length>0,()=>"promises must be a none empty array")}function l(u,h){U(u>=0&&u<=1,()=>`Progress fraction must be in range [0, 1], but got startFraction ${u}`),U(h>=0&&h<=1,()=>`Progress fraction must be in range [0, 1], but got endFraction ${h}`),U(h>=u,()=>`startFraction must be no more than endFraction, but got startFraction ${u} and endFraction ${h}`)}return Promise.all(n.map(i))}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */async function b7(n,t){t==null&&(t={});const e=t.fetchFunc==null?dt().platform.fetch:t.fetchFunc,s=n.map(p=>e(p,t.requestInit,{isBinary:!0})),l=(t.onProgress==null?await Promise.all(s):await oA(s,t.onProgress,0,.5)).map(p=>p.arrayBuffer());return t.onProgress==null?await Promise.all(l):await oA(l,t.onProgress,.5,1)}function v7(n,t){var e;const s=t.fetchFunc==null?dt().platform.fetch:t.fetchFunc;let r=0,i;return(e=t.onProgress)===null||e===void 0||e.call(t,0),new ReadableStream({pull:async o=>{for(var l;r<n.length;){i||(i=(await s(n[r],t.requestInit,{isBinary:!0})).body.getReader());const{done:u,value:h}=await i.read();if(u){r++,i=void 0,(l=t.onProgress)===null||l===void 0||l.call(t,r/n.length);continue}o.enqueue(h);return}o.close()}})}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const w7="application/octet-stream",C7="application/json";class zS{constructor(t,e){if(this.DEFAULT_METHOD="POST",e==null&&(e={}),this.weightPathPrefix=e.weightPathPrefix,this.weightUrlConverter=e.weightUrlConverter,e.fetchFunc!=null?(U(typeof e.fetchFunc=="function",()=>"Must pass a function that matches the signature of `fetch` (see https://developer.mozilla.org/en-US/docs/Web/API/Fetch_API)"),this.fetch=e.fetchFunc):this.fetch=dt().platform.fetch,U(t!=null&&t.length>0,()=>"URL path for http must not be null, undefined or empty."),Array.isArray(t)&&U(t.length===2,()=>`URL paths for http must have a length of 2, (actual length is ${t.length}).`),this.path=t,e.requestInit!=null&&e.requestInit.body!=null)throw new Error("requestInit is expected to have no pre-existing body, but has one.");this.requestInit=e.requestInit||{},this.loadOptions=e}async save(t){if(t.modelTopology instanceof ArrayBuffer)throw new Error("BrowserHTTPRequest.save() does not support saving model topology in binary formats yet.");const e=Object.assign({method:this.DEFAULT_METHOD},this.requestInit);e.body=new FormData;const s=[{paths:["./model.weights.bin"],weights:t.weightSpecs}],r=DH(t,s);if(e.body.append("model.json",new Blob([JSON.stringify(r)],{type:C7}),"model.json"),t.weightData!=null){const o=Za.join(t.weightData);e.body.append("model.weights.bin",new Blob([o],{type:w7}),"model.weights.bin")}const i=await this.fetch(this.path,e);if(i.ok)return{modelArtifactsInfo:uS(t),responses:[i]};throw new Error(`BrowserHTTPRequest.save() failed due to HTTP response status ${i.status}.`)}async loadModelJSON(){const t=await this.fetch(this.path,this.requestInit);if(!t.ok)throw new Error(`Request to ${this.path} failed with status code ${t.status}. Please verify this URL points to the model JSON of the model to load.`);let e;try{e=await t.json()}catch{let o=`Failed to parse model JSON of response from ${this.path}.`;throw this.path.endsWith(".pb")?o+=" Your path contains a .pb file extension. Support for .pb models have been removed in TensorFlow.js 1.0 in favor of .json models. You can re-convert your Python TensorFlow model using the TensorFlow.js 1.0 conversion scripts or you can convert your.pb models with the 'pb2json'NPM script in the tensorflow/tfjs-converter repository.":o+=" Please make sure the server is serving valid JSON for this request.",new Error(o)}const s=e.modelTopology,r=e.weightsManifest;if(s==null&&r==null)throw new Error(`The JSON from HTTP path ${this.path} contains neither model topology or manifest for weights.`);return e}async load(){if(this.loadOptions.streamWeights)return this.loadStream();const t=await this.loadModelJSON();return MH(t,e=>this.loadWeights(e))}async loadStream(){const t=await this.loadModelJSON(),e=await this.getWeightUrls(t.weightsManifest),s=qk(t.weightsManifest),r=()=>v7(e,this.loadOptions);return Object.assign(Object.assign({},t),{weightSpecs:s,getWeightStream:r})}async getWeightUrls(t){const e=Array.isArray(this.path)?this.path[1]:this.path,[s,r]=S7(e),i=this.weightPathPrefix||s,o=[],l=[];for(const u of t)for(const h of u.paths)this.weightUrlConverter!=null?l.push(this.weightUrlConverter(h)):o.push(i+h+r);return this.weightUrlConverter&&o.push(...await Promise.all(l)),o}async loadWeights(t){const e=await this.getWeightUrls(t),s=qk(t),r=await b7(e,this.loadOptions);return[s,r]}}zS.URL_SCHEME_REGEX=/^https?:\/\//;function S7(n){const t=n.lastIndexOf("/"),e=n.lastIndexOf("?"),s=n.substring(0,t),r=e>t?n.substring(e):"";return[s+"/",r]}function aA(n){return n.match(zS.URL_SCHEME_REGEX)!=null}const hO=(n,t)=>{if(typeof fetch>"u"&&(t==null||t.fetchFunc==null))return null;{let e=!0;if(Array.isArray(n)?e=n.every(s=>aA(s)):e=aA(n),e)return dO(n,t)}return null};Kn.registerSaveRouter(hO);Kn.registerLoadRouter(hO);function dO(n,t){return new zS(n,t)}function T7(n,t){return dO(n,t)}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */let Pl;function E7(n,t=3){if(t>4)throw new Error("Cannot construct Tensor with more than 4 channels from pixels.");if(n==null)throw new Error("pixels passed to tf.browser.fromPixels() can not be null");let e=!1,s=!1,r=!1,i=!1,o=!1,l=!1;if(n.data instanceof Uint8Array)e=!0;else if(typeof ImageData<"u"&&n instanceof ImageData)s=!0;else if(typeof HTMLVideoElement<"u"&&n instanceof HTMLVideoElement)r=!0;else if(typeof HTMLImageElement<"u"&&n instanceof HTMLImageElement)i=!0;else if(n.getContext!=null)o=!0;else if(typeof ImageBitmap<"u"&&n instanceof ImageBitmap)l=!0;else throw new Error(`pixels passed to tf.browser.fromPixels() must be either an HTMLVideoElement, HTMLImageElement, HTMLCanvasElement, ImageData in browser, or OffscreenCanvas, ImageData in webworker or {data: Uint32Array, width: number, height: number}, but was ${n.constructor.name}`);if(tw(Zv,et.backendName)!=null){const x={pixels:n},v={numChannels:t};return et.runKernel(Zv,x,v)}const[h,d]=r?[n.videoWidth,n.videoHeight]:[n.width,n.height];let p;if(o)p=n.getContext("2d").getImageData(0,0,h,d).data;else if(s||e)p=n.data;else if(i||r||l){if(Pl==null)if(typeof document>"u")if(typeof OffscreenCanvas<"u"&&typeof OffscreenCanvasRenderingContext2D<"u")Pl=new OffscreenCanvas(1,1).getContext("2d");else throw new Error("Cannot parse input in current context. Reason: OffscreenCanvas Context2D rendering is not supported.");else Pl=document.createElement("canvas").getContext("2d",{willReadFrequently:!0});Pl.canvas.width=h,Pl.canvas.height=d,Pl.drawImage(n,0,0,h,d),p=Pl.getImageData(0,0,h,d).data}let m;if(t===4)m=new Int32Array(p);else{const x=h*d;m=new Int32Array(x*t);for(let v=0;v<x;v++)for(let C=0;C<t;++C)m[v*t+C]=p[v*4+C]}return i8(m,[d,h,t],"int32")}const I7=it({fromPixels_:E7});function BS(n,t){const e=n.shape.length,s=t.shape.length;if(e<1)throw new Error(`tf.gatherND() expects the input to be rank 1 or higher, but the rank was ${e}.`);if(s<1)throw new Error(`tf.gatherND() expects the indices to be rank 1 or higher, but the rank was ${s}.`);if(t.dtype!=="int32")throw new Error(`tf.gatherND() expects the indices to be int32 type, but the dtype was ${t.dtype}.`);if(t.shape[s-1]>e)throw new Error(`index innermost dimension length must be <= tensor rank; saw: ${t.shape[s-1]} vs. ${e}`);if(yt(n.shape)===0)throw new Error(`Requested more than 0 entries, but input is empty. Input shape: ${n.shape}.`);const r=t.shape,i=r[r.length-1];let o=1;for(let p=0;p<r.length-1;++p)o*=r[p];const l=n.shape,u=r.slice();u.pop();let h=1;for(let p=i;p<e;++p)h*=l[p],u.push(l[p]);const d=[...zt(n.shape).map(p=>p/h),1].slice(0,i);return[u,o,h,d]}/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const fw=-2,_7=-1;function US(n,t,e){const s=n.shape.length;U(s===t.length,()=>`Error in slice${s}D: Length of begin ${t} must match the rank of the array (${s}).`),U(s===e.length,()=>`Error in slice${s}D: Length of size ${e} must match the rank of the array (${s}).`);for(let r=0;r<s;++r)U(t[r]+e[r]<=n.shape[r],()=>`Error in slice${s}D: begin[${r}] + size[${r}] (${t[r]+e[r]}) would overflow input.shape[${r}] (${n.shape[r]})`)}function k7(n){const t=[];let e=0;for(;n>0;)n&1&&t.push(e),n/=2,e++;return t}function GS(n,t,e){const s=[];for(let r=0;r<n.length;r++)s[r]=Math.ceil((t[r]-n[r])/e[r]);return s}function fO(n,t,e,s){const r=[...n];for(let i=r.length;i<s.length;i++)r.push(1);for(let i=0;i<e;i++)i===0?r[t]=1:(r.splice(t,0,1),r.pop());return r}function pO(n,t,e){return e<=n?e:e-(t-1)}function mO(n,t){const e=[];for(let s=0;s<n;s++)e.push(t+s);return e}function A7(n,t,e,s,r,i,o,l,u){const h=n.length;let d=new Array(h),p=new Array(h),m=new Array(h);if(t.length&&e>0){const y=t[0],x=e+1;d=gO(o,y,x,s,n),p=yO(l,y,x,r,n),m=fO(i,y,x,n)}else for(let y=0;y<h;y++)d[y]=bO(o,s,i,n,y,u),p[y]=vO(l,r,i,n,y,u),m[y]=xO(i,y,u);return{begin:d,end:p,strides:m}}function gO(n,t,e,s,r){const i=[...r],o=mO(e,t);for(let l=0;l<i.length;l++)if(o.indexOf(l)>-1)i[l]=0;else{const u=pO(t,e,l);let h=s[u];n&1<<u&&(h=0),i[l]=h}return i}function yO(n,t,e,s,r){const i=[...r],o=mO(e,t);for(let l=0;l<i.length;l++)if(o.indexOf(l)>-1)i[l]=Number.MAX_SAFE_INTEGER;else{const u=pO(t,e,l);let h=s[u];n&1<<u&&(h=Number.MAX_SAFE_INTEGER),i[l]=h}for(let l=0;l<i.length;l++){const u=r[l];i[l]<0&&(i[l]+=u),i[l]=tu(0,i[l],r[l])}return i}function xO(n,t,e){let s=n[t];return(e&1<<t||s==null)&&(s=1),s}function bO(n,t,e,s,r,i){let o=t[r];const l=e[r]||1;(n&1<<r||i&1<<r||o==null)&&(l>0?o=Number.MIN_SAFE_INTEGER:o=Number.MAX_SAFE_INTEGER);const u=s[r];return o<0&&(o+=u),o=tu(0,o,u-1),o}function vO(n,t,e,s,r,i){let o=t[r];const l=e[r]||1;(n&1<<r||i&1<<r||o==null)&&(l>0?o=Number.MAX_SAFE_INTEGER:o=Number.MIN_SAFE_INTEGER);const u=s[r];return o<0&&(o+=u),l>0?o=tu(0,o,u):o=tu(-1,o,u-1),o}function WS(n,t,e){let s=e.length;for(let r=0;r<e.length;r++)if(e[r]>1){s=r;break}for(let r=s+1;r<e.length;r++)if(t[r]>0||e[r]!==n[r])return!1;return!0}function HS(n,t){let e=n.length>0?n[n.length-1]:1;for(let s=0;s<n.length-1;s++)e+=n[s]*t[s];return e}function wx(n,t,e){let s;const r=n.shape.length;typeof t=="number"?s=[t,...new Array(r-1).fill(0)]:t.length<r?s=t.concat(new Array(r-t.length).fill(0)):s=t.slice(),s.forEach(o=>{U(o!==-1,()=>"slice() does not support negative begin indexing.")});let i;return e==null?i=new Array(r).fill(-1):typeof e=="number"?i=[e,...new Array(r-1).fill(-1)]:e.length<r?i=e.concat(new Array(r-e.length).fill(-1)):i=e,i=i.map((o,l)=>o>=0?o:(U(o===-1,()=>`Negative size values should be exactly -1 but got ${o} for the slice() size at index ${l}.`),n.shape[l]-s[l])),[s,i]}function qS(n,t,e,s,r,i,o,l,u){let h;if(s==null?(h=new Array(t.length),h.fill(1)):h=s,o!=null&&(o&o-1)!==0)throw new Error("Multiple ellipses in slice is not allowed.");let d=!1;const p={dims:h.length,numAddAxisAfterEllipsis:0,begin:t.slice(),end:e.slice(),strides:h.slice(),beginMask:r,endMask:i,ellipsisMask:o,newAxisMask:l,shrinkAxisMask:u};for(let _=0;_<p.dims;_++)d&&(1<<_&l)!==0&&p.numAddAxisAfterEllipsis++,1<<_&o&&(d=!0);d||(p.ellipsisMask|=1<<p.dims,p.dims++);const m={dims:n.length,beginMask:0,endMask:0,beginValid:!1,endValid:!1};N7(p,m);let y=!0,x=!0,v=!0;const C=[],S=[];for(let _=0;_<n.length;++_){if(m.strides[_]===0)throw Error(`strides[${_}] must be non-zero`);const I=!!(m.shrinkAxisMask&1<<_),O=n[_];if(O===-1){C.push(I?1:-1);continue}const P=[m.beginMask&1<<_,m.endMask&1<<_],D=[m.strides[_]>0?0:-1,m.strides[_]>0?O:O-1];if(I&&m.strides[_]<=0)throw Error("only stride 1 allowed on non-range indexing.");v=v&&m.strides[_]===1;const N=!!(m.beginMask&1<<_&&m.endMask&1<<_);if(m.beginValid&&m.endValid){if(I){const V=m.begin[_]<0?O+m.begin[_]:m.begin[_];if(m.begin[_]=V,m.end[_]=m.begin[_]+1,V<0||V>=O)throw Error(`slice index ${m.begin[_]} of dimension ${_} out of bounds.`)}else m.begin[_]=lA(m.begin[_],0,m.strides[_],O,P,D),m.end[_]=lA(m.end[_],1,m.strides[_],O,P,D);const A=m.strides[_]===1&&m.begin[_]===0&&m.end[_]===O;y=y&&A,x=x&&(_===0&&m.strides[_]===1||A)}else y=y&&m.strides[_]===1&&N,x=x&&(_===0&&m.strides[_]===1||N);let R,$=!1;if(m.beginValid&&m.endValid?(R=m.end[_]-m.begin[_],$=!0):I?(R=1,$=!0):N&&O>=0&&(m.strides[_]<0?R=-O:R=O,$=!0),$){let A;R===0||R<0!=m.strides[_]<0?A=0:A=Math.trunc(R/m.strides[_])+(R%m.strides[_]!==0?1:0),C.push(A)}else C.push(-1)}for(let _=0;_<m.finalShapeGatherIndices.length;++_){const I=m.finalShapeGatherIndices[_];I>=0?S.push(C[I]):I===fw&&S.push(1)}return{finalShapeSparse:S.filter((_,I)=>m.finalShapeGatherIndices[I]!==fw),finalShape:S,isIdentity:y,sliceDim0:x,isSimpleSlice:v,begin:m.begin,end:m.end,strides:m.strides}}function N7(n,t){t.beginMask=0,t.endMask=0,t.shrinkAxisMask=0;let e=0;t.beginValid=n.begin!=null,t.endValid=n.end!=null,t.begin=new Array(t.dims),t.end=new Array(t.dims),t.strides=new Array(t.dims),t.finalShapeGatherIndices=[],t.finalShapeGatherIndicesSparse=[],t.inputShapeGatherIndicesSparse=new Array(t.dims);for(let s=0;s<n.dims;s++)if(1<<s&n.ellipsisMask){const r=Math.min(t.dims-(n.dims-s)+1+n.numAddAxisAfterEllipsis,t.dims);for(;e<r;e++)t.begin[e]=0,t.end[e]=0,t.strides[e]=1,t.beginMask|=1<<e,t.endMask|=1<<e,t.finalShapeGatherIndices.push(e),t.finalShapeGatherIndicesSparse.push(-1),t.inputShapeGatherIndicesSparse[e]=s}else if(1<<s&n.newAxisMask)t.finalShapeGatherIndices.push(fw),t.finalShapeGatherIndicesSparse.push(-1);else{if(e===t.begin.length)throw Error(`Index out of range using input dim ${e}; input has only ${t.dims} dims, ${t.begin.length}.`);n.begin!=null&&(t.begin[e]=n.begin[s]),n.end!=null&&(t.end[e]=n.end[s]),t.strides[e]=n.strides[s],n.beginMask&1<<s&&(t.beginMask|=1<<e),n.endMask&1<<s&&(t.endMask|=1<<e),n.shrinkAxisMask&1<<s?(t.finalShapeGatherIndices.push(_7),t.finalShapeGatherIndicesSparse.push(-1),t.shrinkAxisMask|=1<<e):(t.finalShapeGatherIndices.push(e),t.finalShapeGatherIndicesSparse.push(s)),t.inputShapeGatherIndicesSparse[e]=s,e++}}function lA(n,t,e,s,r,i){if(r[t])return e>0?i[t]:i[t+1&1];{const o=n<0?s+n:n;return o<i[0]?i[0]:o>i[1]?i[1]:o}}const R7=Object.freeze(Object.defineProperty({__proto__:null,assertParamsValid:US,computeFlatOffset:HS,computeOutShape:GS,getNormalizedAxes:A7,isSliceContinous:WS,maskToAxes:k7,parseSliceParams:wx,sliceInfo:qS,startForAxis:bO,startIndicesWithElidedDims:gO,stopForAxis:vO,stopIndicesWithElidedDims:yO,stridesForAxis:xO,stridesWithElidedDims:fO},Symbol.toStringTag,{value:"Module"}));/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class $7{static sgd(t){return new VS(t)}static momentum(t,e,s=!1){return new uO(t,e,s)}static rmsprop(t,e=.9,s=0,r=null,i=!1){return new cO(t,e,s,r,i)}static adam(t=.001,e=.9,s=.999,r=null){return new aO(t,e,s,r)}static adadelta(t=.001,e=.95,s=null){return new iO(t,e,s)}static adamax(t=.002,e=.9,s=.999,r=null,i=0){return new lO(t,e,s,r,i)}static adagrad(t,e=.1){return new oO(t,e)}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const vc=$7;/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const D7=typeof requestAnimationFrame<"u"?requestAnimationFrame:typeof setImmediate<"u"?setImmediate:n=>n();function wO(){return new Promise(n=>D7(()=>n()))}/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function jS(n,t){const e=n[0].length;n.forEach((r,i)=>{U(r.length===e,()=>`Error in concat${e}D: rank of tensors[${i}] must be the same as the rank of the rest (${e})`)}),U(t>=0&&t<e,()=>`Error in concat${e}D: axis must be between 0 and ${e-1}.`);const s=n[0];n.forEach((r,i)=>{for(let o=0;o<e;o++)U(o===t||r[o]===s[o],()=>`Error in concat${e}D: Shape of tensors[${i}] (${r}) does not match the shape of the rest (${s}) along the non-concatenated axis ${i}.`)})}function Gi(n,t){const e=n[0].slice();for(let s=1;s<n.length;s++)e[t]+=n[s][t];return e}/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */var ii;(function(n){n[n.FIRST_DIM_SIZE=0]="FIRST_DIM_SIZE",n[n.VALUE_ROWIDS=1]="VALUE_ROWIDS",n[n.ROW_LENGTHS=2]="ROW_LENGTHS",n[n.ROW_SPLITS=3]="ROW_SPLITS",n[n.ROW_LIMITS=4]="ROW_LIMITS",n[n.ROW_STARTS=5]="ROW_STARTS"})(ii||(ii={}));function CO(n,t,e){let s=new Array;if(e==null&&t==null)return s;if(t==null)for(;s.length<n+e.length;)s.push(-1);else s=t.slice();if(e==null)return s;if(n+e.length!==s.length)throw new Error(`rt input.shape and shape=${t} are incompatible: rt input.rank = ${n+e.length}, but shape.rank = ${s.length}`);for(let r=1;r<e.length;++r){const i=e[r],o=s[s.length-e.length+r],l=s[o];if(i>=0)if(l>=0){if(l!==i)throw new Error(`rt input.shape and shape=${t} are incompatible: rt input.shape[${r+n}] = ${i} but shape[${r+n}] = ${l}`)}else s[o]=i}return s}function SO(n){const t={FIRST_DIM_SIZE:ii.FIRST_DIM_SIZE,VALUE_ROWIDS:ii.VALUE_ROWIDS,ROW_LENGTHS:ii.ROW_LENGTHS,ROW_SPLITS:ii.ROW_SPLITS,ROW_LIMITS:ii.ROW_LIMITS,ROW_STARTS:ii.ROW_STARTS},e=[];for(const s of n)if(s in t)e.push(t[s]);else break;return e}function TO(n){return n.length===0?0:n[0]===ii.FIRST_DIM_SIZE?n.length-1:n.length}function EO(n,t){if(n==null||t==null)return;const e=n.length,s=t.length;if(e>=s)throw new Error(`defaultValue.shape=${n} and ragged tensor flatValues.shape=${t}, are incompatible: defaultValue.rank = ${e} must be less than ragged tensor input flatValues.rank = ${s})`);for(let r=0;r<Math.min(e,s-1);++r){const i=n[r],o=t[r+1];if(i>=0&&o>=0&&i!==1&&i!==o)throw new Error(`defaultValue.shape=${n}, and ragged tensor input flatValues.shape=${t} are incompatible: defaultValue.shape[${r-n.length}] = ${i} but ragged tensor input.flatValues.shape[${r-n.length}] = ${o}`)}}/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const KS=30;function Cx(n){return n<=KS?n:Xv(n,Math.floor(Math.sqrt(n)))}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function XS(n,t,e){const s=e*(typeof n=="number"?n:n[0]),r=t*(typeof n=="number"?n:n[1]);return[s,r]}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Op(n,t,e,s=!0){let r=[];if(s)r=r.concat(t.slice(0)),r.push(n[0]/e),r=r.concat(n.slice(1));else{r=r.concat(n[0]);const i=t.length;for(let o=0;o<i;++o)r=r.concat([n[o+1]/t[o],t[o]]);r=r.concat(n.slice(i+1))}return r}function Mp(n,t,e=!0){const s=[];if(e){s.push(t);for(let r=t+1;r<n;++r)r<=2*t?(s.push(r),s.push(r-(t+1))):s.push(r)}else{const r=[],i=[];for(let o=1;o<n;++o)o>=t*2+1||o%2===1?i.push(o):r.push(o);s.push(...r),s.push(0),s.push(...i)}return s}function Fp(n,t,e,s=!0){const r=[];s?r.push(n[0]/e):r.push(n[0]*e);for(let i=1;i<n.length;++i)i<=t.length?s?r.push(t[i-1]*n[i]):r.push(n[i]/t[i-1]):r.push(n[i]);return r}function YS(n,t){const e=[0];for(let s=0;s<t;++s)e.push(n[s][0]);return e}function QS(n,t,e){const s=n.slice(0,1);for(let r=0;r<e;++r)s.push(n[r+1]-t[r][0]-t[r][1]);return s}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Sx=1.7580993408473768,Tx=1.0507009873554805;/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const ZS=.3275911,JS=.254829592,tT=-.284496736,eT=1.421413741,nT=-1.453152027,sT=1.061405429;/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Uo(n,t){if(n.length!==t.length)throw new Error(`Cannot merge real and imag arrays of different lengths. real:${n.length}, imag: ${t.length}.`);const e=new Float32Array(n.length*2);for(let s=0;s<e.length;s+=2)e[s]=n[s/2],e[s+1]=t[s/2];return e}function IO(n){const t=new Float32Array(n.length/2),e=new Float32Array(n.length/2);for(let s=0;s<n.length;s+=2)t[s/2]=n[s],e[s/2]=n[s+1];return{real:t,imag:e}}function _O(n){const t=Math.ceil(n.length/4),e=new Float32Array(t),s=new Float32Array(t);for(let r=0;r<n.length;r+=4)e[Math.floor(r/4)]=n[r],s[Math.floor(r/4)]=n[r+1];return{real:e,imag:s}}function kO(n){const t=Math.floor(n.length/4),e=new Float32Array(t),s=new Float32Array(t);for(let r=2;r<n.length;r+=4)e[Math.floor(r/4)]=n[r],s[Math.floor(r/4)]=n[r+1];return{real:e,imag:s}}function rT(n,t){const e=n[t*2],s=n[t*2+1];return{real:e,imag:s}}function AO(n,t,e,s){n[s*2]=t,n[s*2+1]=e}function NO(n,t){const e=new Float32Array(n/2),s=new Float32Array(n/2);for(let r=0;r<Math.ceil(n/2);r++){const i=(t?2:-2)*Math.PI*(r/n);e[r]=Math.cos(i),s[r]=Math.sin(i)}return{real:e,imag:s}}function RO(n,t,e){const s=(e?2:-2)*Math.PI*(n/t),r=Math.cos(s),i=Math.sin(s);return{real:r,imag:i}}/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const lv="->",O7=/->/g,uA=",",cA="...";function iT(n,t){n=n.replace(/\s/g,"");const e=(n.length-n.replace(O7,"").length)/lv.length;if(e<1)throw new Error("Equations without an arrow are not supported.");if(e>1)throw new Error(`Equation must contain exactly one arrow ("${lv}").`);const[s,r]=n.split(lv);U(s.indexOf(cA)===-1,()=>`The ellipsis notation ("${cA}") is not supported yet.`);const i=s.split(uA),o=i.length;if(t!==o)throw new Error(`Expected ${o} input tensors, received ${t}`);if(o>2)throw new Error("Support for more than 2 input tensors is not implemented yet.");const l=[];for(let m=0;m<r.length;++m){const y=r[m];if(!i.some(x=>x.indexOf(y)!==-1))throw new Error(`Output subscripts contain the label ${y} not present in the input subscripts.`);l.indexOf(y)===-1&&l.push(y)}for(let m=0;m<s.length;++m){const y=s[m];l.indexOf(y)===-1&&y!==uA&&l.push(y)}const u=new Array(i.length);for(let m=0;m<o;++m){if(new Set(i[m].split("")).size!==i[m].length)throw new Error(`Found duplicate axes in input component ${i[m]}. Support for duplicate axes in input is not implemented yet.`);u[m]=[];for(let y=0;y<i[m].length;++y)u[m].push(l.indexOf(i[m][y]))}const h=l.length,d=r.length,p=[];for(let m=d;m<h;++m)p.push(m);return{allDims:l,summedDims:p,idDims:u}}function oT(n,t){let e=new Array(n);e.fill(-1);for(let r=0;r<t.length;++r)e[t[r]]=r;const s=[];for(let r=0;r<n;++r)e[r]===-1&&s.push(r);return e=e.filter(r=>r!==-1),{permutationIndices:e,expandDims:s}}function aT(n,t,e){const s=new Array(n);for(let r=0;r<e.length;++r){const i=e[r].shape;for(let o=0;o<t[r].length;++o)s[t[r][o]]===void 0?s[t[r][o]]=i[o]:U(s[t[r][o]]===i[o],()=>`Expected dimension ${s[t[r][o]]} at axis ${o} of input shaped ${JSON.stringify(i)}, but got dimension ${i[o]}`)}}function lT(n,t){const e=n,s=[];let r=0;n.length===0&&e.push(-1),r=n.length+1;for(let o=0;o<r;++o)s.push([]);const i=[];for(let o=0;o<e.length;++o){const l=e[o],u=M7(t,l);for(const h of u)i.indexOf(h)===-1&&(s[o].push(h),i.push(h))}return{path:e,steps:s}}function uT(n){return n.every((t,e)=>t===e)}function M7(n,t){const e=[];for(let s=0;s<n.length;++s)(n[s].length===0||n[s].indexOf(t)!==-1||t===-1)&&e.push(s);return e}function cT(n,t,e=0){let s=[];if(typeof t=="number")U(n.shape[e]%t===0,()=>"Number of splits must evenly divide the axis."),s=new Array(t).fill(n.shape[e]/t);else{const r=t.reduce((o,l)=>(l===-1&&(o+=1),o),0);U(r<=1,()=>"There should be only one negative value in split array.");const i=t.indexOf(-1);if(i!==-1){const o=t.reduce((l,u)=>u>0?l+u:l);t[i]=n.shape[e]-o}U(n.shape[e]===t.reduce((o,l)=>o+l),()=>"The sum of sizes must match the size of the axis dimension."),s=t}return s}/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function $O(n){return`Received SparseTensor with denseShape[0] = 0 but
  indices.shape[0] = ${n}`}function DO(n,t){return`indices(${n}, 0) is invalid: ${t} < 0`}function OO(n,t,e){return`indices(${n}, 0) is invalid: ${t} >= ${e}`}/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function MO(n,t){return`only one output dimension may be -1, not both ${n} and ${t}`}function FO(n,t){return`size ${n} must be non-negative, not ${t}`}function LO(){return"reshape cannot infer the missing input size for an empty tensor unless all specified input sizes are non-zero"}function PO(n,t){const e=yt(n),s=yt(t);return`Input to reshape is a SparseTensor with ${e}
  dense values, but the requested shape requires a multiple of ${s}. inputShape=${n} outputShape= ${t}`}function VO(n,t){const e=yt(n),s=yt(t);return`Input to reshape is a tensor with ${e} dense values, but the requested shape has ${s}. inputShape=${n} outputShape=${t}`}/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function pw(){return"segment ids must be >= 0"}function zO(){return"segment ids are not increasing"}function BO(n,t){return`Segment id ${n} out of range [0, ${t}), possibly because segmentIds input is not sorted.`}function UO(n,t,e){return`Bad: indices[${n}] == ${t} out of range [0, ${e})`}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function GO(n,t){let e=!1,s;for(n<=KS?(s=n,e=!0):s=Xv(n,Math.floor(Math.sqrt(n)));!e;)s>t||s===n?e=!0:s=Xv(n,s+1);return s}function WO(n,t,e){const s=[],r=n.length;for(let i=0;i<r;i++)i!==t?s.push(n[i]):s.push(e);return s}function hT(n,t,e,s){const r=t.shape.length,i=n.shape.length;if(s!==0&&(s<-r||s>r))throw new Error(`Expect batchDims in the range of [-${r}, ${r}], but got ${s}`);if(s<0&&(s+=r),s>i)throw new Error(`batchDims (${s}) must be less than rank(x) (
    ${i}).`);if(e<s)throw new Error(`batchDims (${s}) must be less than or equal to axis (${e}).`);for(let p=0;p<s;++p)if(n.shape[p]!==t.shape[p])throw new Error(`x.shape[${p}]: ${n.shape[p]} should be equal to indices.shape[${p}]: ${t.shape[p]}.`);const o=n.shape[e],l=[];let u=1,h=1,d=1;for(let p=0;p<s;++p)l.push(n.shape[p]),u*=n.shape[p];for(let p=s;p<e;p++)l.push(n.shape[p]),h*=n.shape[p];for(let p=s;p<r;p++)l.push(t.shape[p]);for(let p=e+1;p<i;p++)l.push(n.shape[p]),d*=n.shape[p];return{batchSize:u,sliceSize:d,outerSize:h,dimSize:o,outputShape:l}}const F7=Object.freeze(Object.defineProperty({__proto__:null,collectGatherOpShapeInfo:hT,computeOutShape:WO,segOpComputeOptimalWindowSize:GO},Symbol.toStringTag,{value:"Module"}));/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Go(n){try{return n.map(t=>Wa(t))}catch(t){throw new Error(`Failed to decode encoded string bytes into utf-8, error: ${t}`)}}function HO(n){return n.map(t=>Ma(t))}const L7=Object.freeze(Object.defineProperty({__proto__:null,ERF_A1:JS,ERF_A2:tT,ERF_A3:eT,ERF_A4:nT,ERF_A5:sT,ERF_P:ZS,PARALLELIZE_THRESHOLD:KS,get RowPartitionType(){return ii},SELU_SCALE:Tx,SELU_SCALEALPHA:Sx,applyActivation:DS,assertAndGetBroadcastShape:ne,assertAxesAreInnerMostDims:hs,assertParamsConsistent:jS,assignToTypedArray:AO,axesAreInnerMostDims:gS,calculateShapes:Su,checkEinsumDimSizes:aT,checkPadOnDimRoundingMode:Zs,combineLocations:MD,combineRaggedTensorToTensorShapes:CO,complexWithEvenIndex:_O,complexWithOddIndex:kO,computeConv2DInfo:cs,computeConv3DInfo:Ja,computeDefaultPad:cS,computeDilation2DInfo:Ap,computeOptimalWindowSize:Cx,computeOutAndReduceShapes:es,computeOutShape:Gi,computePool2DInfo:Kr,computePool3DInfo:qo,convertConv2DDataFormat:jo,decodeEinsumEquation:iT,eitherStridesOrDilationsAreOne:Is,expandShapeToKeepDim:Nn,exponent:RO,exponents:NO,fromStringArrayToUint8:HO,fromUint8ToStringArray:Go,getAxesPermutation:hn,getBroadcastDims:jc,getComplexWithIndex:rT,getEinsumComputePath:lT,getEinsumPermutation:oT,getFusedBiasGradient:$S,getFusedDyActivation:RS,getImageCenter:XS,getInnerMostAxes:Cn,getPermuted:Mp,getRaggedRank:TO,getReductionAxes:Bn,getReshaped:Op,getReshapedPermuted:Fp,getRowPartitionTypesHelper:SO,getSliceBeginCoords:YS,getSliceSize:QS,getSparseFillEmptyRowsIndicesDenseShapeMismatch:$O,getSparseFillEmptyRowsNegativeIndexErrorMessage:DO,getSparseFillEmptyRowsOutOfRangeIndexErrorMessage:OO,getSparseReshapeEmptyTensorZeroOutputDimErrorMessage:LO,getSparseReshapeInputOutputMismatchErrorMessage:VO,getSparseReshapeInputOutputMultipleErrorMessage:PO,getSparseReshapeMultipleNegativeOneOutputDimErrorMessage:MO,getSparseReshapeNegativeOutputDimErrorMessage:FO,getSparseSegmentReductionIndicesOutOfRangeErrorMessage:UO,getSparseSegmentReductionNegativeSegmentIdsErrorMessage:pw,getSparseSegmentReductionNonIncreasingSegmentIdsErrorMessage:zO,getSparseSegmentReductionSegmentIdOutOfRangeErrorMessage:BO,getUndoAxesPermutation:tl,isIdentityPermutation:uT,log:ZW,mergeRealAndImagArrays:Uo,prepareAndValidate:BS,prepareSplitSize:cT,segment_util:F7,shouldFuse:OS,slice_util:R7,splitRealAndImagArrays:IO,stridesOrDilationsArePositive:ou,tupleValuesAreOne:iu,upcastType:lr,validateDefaultValueShape:EO,validateInput:o8,validateUpdateShape:JD,warn:vr},Symbol.toStringTag,{value:"Module"}));/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */x7();/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const qO={kernelName:p0,inputsToSave:["x"],gradFunc:(n,t)=>{const[e]=t;return{x:()=>J(n,Dp(Ot(e,"float32"),-1))}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const P7={kernelName:$f,inputsToSave:["x"],gradFunc:(n,t)=>{const[e]=t;return{x:()=>{const s=nn(Ot(e,"float32")),r=Es(Yt(De(1),s));return vn(Wt(n,r))}}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const V7={kernelName:Df,inputsToSave:["x"],gradFunc:(n,t)=>{const[e]=t;return{x:()=>{const s=Es(Yt(nn(Ot(e,"float32")),1));return Wt(n,s)}}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const z7={kernelName:ch,inputsToSave:["a","b"],gradFunc:(n,t)=>{const[e,s]=t,r=ne(e.shape,s.shape);return{a:()=>{let l=n;const u=Bn(e.shape,r);return u.length>0&&(l=Gt(l,u)),rt(l,e.shape)},b:()=>{let l=n;const u=Bn(s.shape,r);return u.length>0&&(l=Gt(l,u)),rt(l,s.shape)}}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const B7={kernelName:vC,saveAllInputs:!0,gradFunc:(n,t)=>{const e={};return t.forEach((s,r)=>{e[r]=()=>n.clone()}),e}};/**
 * @license
 * Copyright 2020 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const U7={kernelName:m0,inputsToSave:["x"],gradFunc:(n,t)=>{const[e]=t;return{x:()=>we(e)}}};/**
 * @license
 * Copyright 2020 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const G7={kernelName:g0,inputsToSave:["x"],gradFunc:(n,t)=>{const[e]=t;return{x:()=>we(e)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const W7={kernelName:Of,inputsToSave:["x"],gradFunc:(n,t)=>{const[e]=t;return{x:()=>Wt(n,Es(Yt(De(1),nn(Ot(e,"float32")))))}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const H7={kernelName:Mf,inputsToSave:["x"],gradFunc:(n,t)=>{const[e]=t;return{x:()=>{const s=Es(kt(De(1),nn(Ot(e,"float32"))));return Wt(n,s)}}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const q7={kernelName:Pf,inputsToSave:["a","b"],gradFunc:(n,t)=>{const[e,s]=t,r=ne(e.shape,s.shape);return{a:()=>{const l=kt(nn(e),nn(s));let u=J(n,Wt(s,l));const h=Bn(e.shape,r);return h.length>0&&(u=Gt(u,h)),rt(u,e.shape)},b:()=>{const l=kt(nn(e),nn(s));let u=vn(J(n,Wt(e,l)));const h=Bn(s.shape,r);return h.length>0&&(u=Gt(u,h)),rt(u,s.shape)}}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const j7={kernelName:Ff,inputsToSave:["x"],gradFunc:(n,t)=>{const[e]=t;return{x:()=>Wt(n,kt(nn(Ot(e,"float32")),1))}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const K7={kernelName:Lf,inputsToSave:["x"],gradFunc:(n,t)=>{const[e]=t;return{x:()=>Wt(n,Yt(De(1),nn(Ot(e,"float32"))))}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function X7(n,t,e,s,r,i){const o=H(n,"dy","avgPool3dGrad"),l=H(t,"input","avgPool3dGrad");let u=o,h=l,d=!1;l.rank===4&&(d=!0,u=rt(o,[1,o.shape[0],o.shape[1],o.shape[2],o.shape[3]]),h=rt(l,[1,l.shape[0],l.shape[1],l.shape[2],l.shape[3]])),U(u.rank===5,()=>`Error in avgPool3dGrad: dy must be rank 5 but got rank ${u.rank}.`),U(h.rank===5,()=>`Error in avgPool3dGrad: input must be rank 5 but got rank ${h.rank}.`),Zs("avgPool3dGrad",r,i);const p={dy:u,input:h},m={filterSize:e,strides:s,pad:r,dimRoundingMode:i},y=et.runKernel(TC,p,m);return d?rt(y,[y.shape[1],y.shape[2],y.shape[3],y.shape[4]]):y}const Y7=it({avgPool3dGrad_:X7});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Q7={kernelName:x0,inputsToSave:["x"],gradFunc:(n,t,e)=>{const[s]=t,{filterSize:r,strides:i,pad:o,dimRoundingMode:l}=e;return{x:()=>Y7(n,s,r,i,o,l)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Z7(n,t,e,s,r){const i=H(n,"dy","avgPoolGrad"),o=H(t,"input","avgPoolGrad");U(o.rank===i.rank,()=>`Rank of input (${o.rank}) does not match rank of dy (${i.rank})`);let l=o,u=i,h=!1;o.rank===3&&(h=!0,l=rt(o,[1,o.shape[0],o.shape[1],o.shape[2]]),u=rt(i,[1,i.shape[0],i.shape[1],i.shape[2]])),U(u.rank===4,()=>`Error in avgPoolGrad: dy must be rank 4 but got rank ${u.rank}.`),U(l.rank===4,()=>`Error in avgPoolGrad: input must be rank 4 but got rank ${l.rank}.`);const d={dy:u,input:l},p={filterSize:e,strides:s,pad:r},m=et.runKernel(SC,d,p);return h?rt(m,[m.shape[1],m.shape[2],m.shape[3]]):m}const J7=it({avgPoolGrad_:Z7});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const tK={kernelName:y0,inputsToSave:["x"],gradFunc:(n,t,e)=>{const[s]=t,{filterSize:r,strides:i,pad:o}=e;return{x:()=>J7(n,s,r,i,o)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const eK={kernelName:b0,inputsToSave:["a","b"],gradFunc:(n,t,e)=>{const[s,r]=t,{transposeA:i,transposeB:o}=e;return!i&&!o?{a:()=>$e(n,r,!1,!0),b:()=>$e(s,n,!0,!1)}:!i&&o?{a:()=>$e(n,r,!1,!1),b:()=>$e(n,s,!0,!1)}:i&&!o?{a:()=>$e(r,n,!1,!0),b:()=>$e(s,n,!1,!1)}:{a:()=>$e(r,n,!0,!0),b:()=>$e(n,s,!0,!0)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const nK={kernelName:v0,gradFunc:(n,t,e)=>{const{blockShape:s,crops:r}=e;return{x:()=>TS(n,s,r)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const sK={kernelName:XW,gradFunc:(n,t,e)=>{const s=e,r=s.inputShape,i=s.shape,o=Array.from(i);for(let u=r.length-1;u>=0;u--)if(r[u]===i[u])o[u]=1;else if(r[u]!==1)throw new Error(`broadcastTo(): [${r}] cannot be broadcast to [${i}].`);const l=[];for(let u=0;u<o.length;u++)o[u]>1&&l.push(u);return{x:()=>Gt(n,l,!0)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const rK={kernelName:Vf,gradFunc:n=>({x:()=>n.clone()})};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const iK={kernelName:zf,gradFunc:n=>({x:()=>we(n)})};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const oK={kernelName:Bf,inputsToSave:["x"],gradFunc:(n,t,e)=>{const[s]=t,{clipValueMin:r,clipValueMax:i}=e;return{x:()=>Ps(zo(wu(s,r),dh(s,i)),n,we(n))}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const aK={kernelName:w0,inputsToSave:["x"],gradFunc:qO.gradFunc};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const lK={kernelName:C0,saveAllInputs:!0,gradFunc:(n,t,e)=>{const s=t.map(u=>u.shape),{axis:r}=e,i=le(r,t[0].shape)[0],o=s.map(u=>u[i]);return Cr(n,o,i).map(u=>()=>u)}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const uK={kernelName:S0,inputsToSave:["x","filter"],gradFunc:(n,t,e)=>{const[s,r]=t,{dilations:i,strides:o,pad:l,dataFormat:u}=e;return U(iu(i),()=>`Error in gradient of conv2D: dilation rates greater than 1 are not yet supported in gradients. Got dilations '${i}'`),{x:()=>fS(s.shape,n,r,o,l,u),filter:()=>NS(s,n,r.shape,o,l,u)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const cK={kernelName:T0,inputsToSave:["dy","filter"],gradFunc:(n,t,e)=>{const[s,r]=t,{strides:i,pad:o,dataFormat:l,dimRoundingMode:u}=e;return{dy:()=>au(n,r,i,o,l,1,u),filter:()=>NS(n,s,r.shape,i,o,l,u)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function hK(n,t,e,s,r){let i=n;n.rank===4&&(i=rt(n,[1,n.shape[0],n.shape[1],n.shape[2],n.shape[3]]));let o=t;o.rank===4&&(o=rt(t,[1,t.shape[0],t.shape[1],t.shape[2],t.shape[3]])),U(i.rank===5,()=>`Error in conv3dDerFilter: input must be rank 5, but got shape ${i.shape}.`),U(o.rank===5,()=>`Error in conv3dDerFilter: dy must be rank 5, but got shape ${o.shape}.`),U(e.length===5,()=>`Error in conv3dDerFilter: filterShape must be length 5, but got ${e}.`),U(i.shape[4]===e[3],()=>`Error in conv3dDerFilter: depth of input ${i.shape[4]}) must match input depth in filter (${e[3]}.`),U(o.shape[4]===e[4],()=>`Error in conv3dDerFilter: depth of dy (${o.shape[4]}) must match output depth for filter (${e[4]}).`);const l={x:i,dy:o},u={strides:s,pad:r,filterShape:e};return et.runKernel(AC,l,u)}const dK=it({conv3DBackpropFilter_:hK});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const fK={kernelName:E0,inputsToSave:["x","filter"],gradFunc:(n,t,e)=>{const{dilations:s,strides:r,pad:i}=e;U(iu(s),()=>`Error in gradient of conv3D: dilation rates greater than 1 are not yet supported in gradients. Got dilations '${s}'`);const[o,l]=t;return{x:()=>RD(o.shape,n,l,r,i),filter:()=>dK(o,n,l.shape,r,i)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const pK={kernelName:Uf,inputsToSave:["x"],gradFunc:(n,t)=>{const[e]=t;return{x:()=>J(vn(XD(Ot(e,"float32"))),n)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const mK={kernelName:Gf,inputsToSave:["x"],gradFunc:(n,t)=>{const[e]=t;return{x:()=>J(YD(Ot(e,"float32")),n)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const gK={kernelName:I0,inputsToSave:["x"],gradFunc:(n,t,e)=>{const[s]=t,{axis:r,exclusive:i,reverse:o}=e;return{x:()=>{const l=hn([r],s.rank);let u=DD(n,r,i,!o);return l!=null&&(u=ve(u,l)),u}}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const yK={kernelName:_0,inputsToSave:["x","filter"],gradFunc:(n,t,e)=>{const{dilations:s,strides:r,pad:i,dimRoundingMode:o}=e,l=s??[1,1];U(iu(l),()=>`Error in gradient of depthwiseConv2dNative: dilation rates greater than 1 are not yet supported. Got dilations '${l}'`);const[u,h]=t;return U(u.rank===4,()=>`Error in gradient of depthwiseConv2dNative: input must be rank 4, but got rank ${u.rank}.`),U(h.rank===4,()=>`Error in gradient of depthwiseConv2dNative: filter must be rank 4, but got rank ${h.rank}.`),U(u.shape[3]===h.shape[2],()=>`Error in gradient of depthwiseConv2d: number of input channels (${u.shape[3]}) must match the inChannels dimension in filter ${h.shape[2]}.`),U(Is(r,l),()=>`Error in gradient of depthwiseConv2d: Either strides or dilations must be  1. Got strides ${r} and dilations '${l}'.`),Zs("depthwiseConv2d",i,o),{x:()=>E8(u.shape,n,h,r,i,l,o),filter:()=>S8(u,n,h.shape,r,i,l,o)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const xK={kernelName:k0,inputsToSave:["x","filter"],gradFunc:(n,t,e)=>{const[s,r]=t,i={x:s,filter:r,dy:n},o={x:s,filter:r,dy:n};return{x:()=>et.runKernel(Yv,i,e),filter:()=>et.runKernel(Qv,o,e)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const bK={kernelName:Hf,outputsToSave:[!0],gradFunc:(n,t)=>{const[e]=t,s={dy:n,y:e};return{x:()=>et.runKernel(PC,s)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const vK={kernelName:qf,inputsToSave:["x"],gradFunc:(n,t)=>{const[e]=t,s=J(Qi(vn(nn(e))),2/Math.sqrt(Math.PI));return{x:()=>J(n,s)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const wK={kernelName:jf,outputsToSave:[!0],gradFunc:(n,t)=>{const[e]=t;return{x:()=>J(n,e)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const CK={kernelName:N0,inputsToSave:["input"],gradFunc:(n,t)=>{const[e]=t;return{input:()=>rt(n,e.shape)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const SK={kernelName:Kf,inputsToSave:["x"],gradFunc:(n,t)=>{const[e]=t;return{x:()=>J(n,Qi(e))}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const TK={kernelName:Xf,gradFunc:n=>({x:()=>we(n)})};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const EK={kernelName:Yf,inputsToSave:["a","b"],gradFunc:(n,t)=>{const[e,s]=t,r=ne(e.shape,s.shape);return{a:()=>{const l=Wt(n,Ot(s,"float32")),u=Bn(e.shape,r);return u.length>0?rt(Gt(l,u),e.shape):l},b:()=>{let l=J(n,Ot(e,"float32"));const u=Bn(s.shape,r);u.length>0&&(l=rt(Gt(l,u),s.shape));const h=nn(s);return vn(Wt(l,Ot(h,"float32")))}}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const IK={kernelName:R0,inputsToSave:["x","mean","variance","scale"],gradFunc:(n,t,e)=>{const{varianceEpsilon:s}=e,[r,i,o,l]=t,u=l??De(1),h=Bn(i.shape,r.shape),d=[];if(i.rank===1){for(let I=0;I<r.shape.length-1;++I)d.push(r.shape[I]);d.push(1)}const p=Yt(r,i),m=J(n,u),y=qD(kt(o,De(s))),x=J(J(J(y,y),y),De(-.5));return{x:()=>i.rank===1?rt(J(J(n,ai(rt(y,[1,1,1,i.shape[0]]),d)),u),r.shape):rt(J(J(n,y),u),r.shape),mean:()=>{let I=J(J(y,De(-1)),m);return i.rank===1&&(I=Gt(I,h)),rt(I,i.shape)},variance:()=>{let I=J(J(x,p),m);return i.rank===1&&(I=Gt(I,h)),rt(I,i.shape)},scale:()=>{const I=J(p,y);let O=J(n,I);return i.rank===1&&(O=Gt(O,h)),rt(O,i.shape)},offset:()=>{let I=n;return i.rank===1&&(I=Gt(I,h)),rt(I,i.shape)}}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const _K={kernelName:$0,inputsToSave:["x","indices"],gradFunc:(n,t,e)=>{const[s,r]=t,{axis:i,batchDims:o}=e,l=le(i,s.shape)[0],u=(h,d,p)=>()=>{const m=h.shape,y=d.size,x=m.slice(0,l),v=x.length,C=m.slice(i,m.length).slice(1),S=C.length,E=hA(0,v),_=hA(v+1,v+1+S),I=dA([x,[y],C]),O=rt(p,I),P=rt(d,[y]),D=dA([[v],E,_]),N=ve(O,D);let R=eO(N,P,h.shape[l]);const $=tl(D);return R=ve(R,$),R};if(o===1){const h=s.shape[0],d=s.split(h,0);return{x:()=>Bo(d.map((y,x)=>u(y,r.slice(x,1),n.slice(x,1))())).reshape(s.shape),indices:()=>r}}else return{x:u(s,r,n),indices:()=>r}}};function hA(n,t){const e=[];for(let s=n;s<t;++s)e.push(s);return e}function dA(n){const t=[];for(let e=0;e<n.length;++e)for(let s=0;s<n[e].length;++s)t.push(n[e][s]);return t}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const kK={kernelName:Qf,inputsToSave:["a","b"],gradFunc:(n,t)=>{const[e,s]=t;return{a:()=>we(e),b:()=>we(s)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const AK={kernelName:Zf,gradFunc:n=>({x:()=>Ot(n,"float32")})};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const NK={kernelName:Jf,gradFunc:n=>({x:()=>we(n)})};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const RK={kernelName:tp,gradFunc:n=>({x:()=>we(n)})};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const $K={kernelName:ep,gradFunc:n=>({x:()=>we(n)})};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const DK={kernelName:O0,inputsToSave:["x"],gradFunc:(n,t,e)=>{const[s]=t,{alpha:r}=e,i=Tr(s,0);return{x:()=>Ps(i,n,J(n,r))}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const OK={kernelName:sp,inputsToSave:["x"],gradFunc:(n,t)=>{const[e]=t;return{x:()=>Wt(n,kt(e,1))}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const MK={kernelName:np,inputsToSave:["x"],gradFunc:(n,t)=>{const[e]=t;return{x:()=>Wt(n,Ot(e,"float32"))}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const FK={kernelName:QW,inputsToSave:[],outputsToSave:[!0],gradFunc:(n,t,e)=>{const[s]=t,{axis:r}=e;return{logits:()=>{const o=Qi(s);return Yt(n,J(Gt(n,r,!0),o))}}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function LK(n,t,e,s=5,r=1,i=1,o=.5){const l={x:n,y:t,dy:e},u={depthRadius:s,bias:r,alpha:i,beta:o};return et.runKernel(WC,l,u)}const PK=it({localResponseNormalizationBackprop_:LK});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const VK={kernelName:z0,inputsToSave:["x"],outputsToSave:[!0],gradFunc:(n,t,e)=>{const[s,r]=t,{depthRadius:i,bias:o,alpha:l,beta:u}=e;return{x:()=>PK(s,r,n,i,o,l,u)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function jO(n,t,e,s){return t.rank<e.rank&&(t=rt(t,Nn(t.shape,s))),n.rank<e.rank&&(n=rt(n,Nn(n.shape,s))),{x:()=>J(n,Ot(Yi(e,t),n.dtype))}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const fA={kernelName:B0,inputsToSave:["x"],outputsToSave:[!0],gradFunc:(n,t,e)=>{const s=e,{reductionIndices:r}=s,i=t[0],o=t[1],l=le(r,i.shape),u=jO(n,o,i,l);return{x:()=>u.x()}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const zK={kernelName:rp,inputsToSave:["a","b"],gradFunc:(n,t)=>{const[e,s]=t;return{a:()=>J(n,Ot(wu(e,s),"float32")),b:()=>J(n,Ot(_y(e,s),"float32"))}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function BK(n,t,e,s,r,i,o){const l=H(n,"dy","maxPool3dGrad"),u=H(t,"input","maxPool3dGrad"),h=H(e,"output","maxPool3dGrad");let d=l,p=u,m=h,y=!1;u.rank===4&&(y=!0,d=rt(l,[1,l.shape[0],l.shape[1],l.shape[2],l.shape[3]]),p=rt(u,[1,u.shape[0],u.shape[1],u.shape[2],u.shape[3]]),m=rt(h,[1,h.shape[0],h.shape[1],h.shape[2],h.shape[3]])),U(d.rank===5,()=>`Error in maxPool3dGrad: dy must be rank 5 but got rank ${d.rank}.`),U(p.rank===5,()=>`Error in maxPool3dGrad: input must be rank 5 but got rank ${p.rank}.`),U(m.rank===5,()=>`Error in maxPool3dGrad: output must be rank 5 but got rank ${m.rank}.`),Zs("maxPool3dGrad",i,o);const x={dy:d,input:p,output:m},v={filterSize:s,strides:r,pad:i,dimRoundingMode:o},C=et.runKernel(qC,x,v);return y?rt(C,[C.shape[1],C.shape[2],C.shape[3],C.shape[4]]):C}const UK=it({maxPool3dGrad_:BK});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const GK={kernelName:G0,inputsToSave:["x"],outputsToSave:[!0],gradFunc:(n,t,e)=>{const[s,r]=t,{filterSize:i,strides:o,pad:l,dimRoundingMode:u}=e;return{x:()=>UK(n,s,r,i,o,l,u)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function WK(n,t,e,s,r,i,o){const l=H(n,"dy","maxPoolGrad"),u=H(t,"input","maxPoolGrad"),h=H(e,"output","maxPoolGrad");U(u.rank===l.rank,()=>`Rank of input (${u.rank}) does not match rank of dy (${l.rank})`),U(l.rank===4,()=>`Error in maxPoolGrad: dy must be rank 4 but got rank ${l.rank}.`),U(u.rank===4,()=>`Error in maxPoolGrad: input must be rank 4 but got rank ${u.rank}.`),Zs("maxPoolGrad",i,o);const d={dy:l,input:u,output:h},p={filterSize:s,strides:r,pad:i,dimRoundingMode:o};return et.runKernel(HC,d,p)}const HK=it({maxPoolGrad_:WK});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const qK={kernelName:U0,inputsToSave:["x"],outputsToSave:[!0],gradFunc:(n,t,e)=>{const[s,r]=t,{filterSize:i,strides:o,pad:l}=e;return{x:()=>HK(n,s,r,i,o,l)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const jK={kernelName:W0,inputsToSave:["x"],gradFunc:(n,t,e)=>{const[s]=t,{axis:r}=e,i=le(r,s.shape),l=es(s.shape,i)[1],u=yt(l);return{x:()=>{const d=s.shape.slice();i.forEach(y=>{d[y]=1});const p=rt(n,d);return Wt(J(p,nl(s.shape,"float32")),u)}}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const KK={kernelName:H0,inputsToSave:["x"],outputsToSave:[!0],gradFunc:(n,t,e)=>{const s=e,{axis:r}=s,[i,o]=t,l=le(r,i.shape),u=jO(n,o,i,l);return{x:()=>u.x()}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const XK={kernelName:ip,inputsToSave:["a","b"],gradFunc:(n,t)=>{const[e,s]=t;return{a:()=>J(n,Ot(dh(e,s),"float32")),b:()=>J(n,Ot(Tr(e,s),"float32"))}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const YK={kernelName:q0,inputsToSave:["x"],gradFunc:(n,t,e)=>{const s=t[0],{paddings:r}=e,i=r.map(o=>o[0]);return{x:()=>Je(n,i,s.shape)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const QK={kernelName:op,inputsToSave:["a","b"],gradFunc:(n,t)=>{const[e,s]=t,r=ne(e.shape,s.shape);return{a:()=>{const l=Bn(e.shape,r);return l.length>0?rt(Gt(n,l),e.shape):n},b:()=>{const l=J(n,vn(vx(Wt(e,s)))),u=Bn(s.shape,r);return u.length>0?rt(Gt(l,u),s.shape):l}}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const ZK={kernelName:ap,inputsToSave:["a","b"],gradFunc:(n,t)=>{const[e,s]=t,r=ne(e.shape,s.shape);return{a:()=>{const l=J(n,Ot(s,"float32")),u=Bn(e.shape,r);return u.length>0?rt(Gt(l,u),e.shape):l},b:()=>{const l=J(n,Ot(e,"float32")),u=Bn(s.shape,r);return u.length>0?rt(Gt(l,u),s.shape):l}}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const JK={kernelName:j0,gradFunc:n=>({x:()=>vn(n)})};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const tX={kernelName:Y0,inputsToSave:["indices"],gradFunc:(n,t)=>{const e=t[0];return{indices:()=>Qn(e.shape,"float32")}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const eX={kernelName:X0,gradFunc:n=>({x:()=>we(n)})};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const nX={kernelName:Q0,saveAllInputs:!0,gradFunc:(n,t,e)=>{const{axis:s}=e;return cu(n,s).map(i=>()=>i)}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const pA={kernelName:Z0,inputsToSave:["x"],gradFunc:(n,t,e)=>{const s=t[0],{paddings:r}=e,i=r.map(o=>o[0]);return{x:()=>Je(n,i,s.shape)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const sX={kernelName:lp,inputsToSave:["a","b"],outputsToSave:[!0],gradFunc:(n,t)=>{const[e,s,r]=t,i=e,o=s,l=ne(i.shape,o.shape);return{a:()=>{const d=Ot(o,"float32");let p=J(n,J(d,lu(i,Yt(d,De(1)))));const m=Bn(i.shape,l);return m.length>0&&(p=Gt(p,m)),rt(p,i.shape)},b:()=>{const d=Tr(i,0),p=Ps(d,Zi(i),we(i));let m=J(n,J(r,p));const y=Bn(o.shape,l);return y.length>0&&(m=Gt(m,y)),rt(m,o.shape)}}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const rX={kernelName:J0,inputsToSave:["x","alpha"],gradFunc:(n,t)=>{const[e,s]=t,r=Tr(e,0);return{x:()=>Ps(r,n,J(n,s)),alpha:()=>{let i=Ps(r,we(n),J(n,e));const o=Bn(s.shape,n.shape);return o.length>0&&(i=Gt(i,o)),rt(i,s.shape)}}}};/**
 * @license
 * Copyright 2022 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function iX(n,t,e){const s=n.shape.slice();s[e]=1;const r=rt(t,s),i=hw(n,e,!0,!1),o=hw(n,e,!0,!0),l=J(i,o);return J(r,l)}function oX(n,t,e){const s=n.shape.length,r=s-e.length,i=hn(e,s);let o=n;i!=null&&(o=ve(n,i));const l=o.shape.slice(),h=l.splice(s-e.length,e.length).reduce((m,y)=>m*y,1);l.push(h);const d=o.reshape(l);let p=iX(d,t,r);if(p=p.reshape(o.shape),i!=null){const m=tl(i);p=ve(p,m)}return p}const aX={kernelName:tx,inputsToSave:["x"],gradFunc:(n,t,e)=>{const[s]=t,{axis:r}=e;let i=[];return r==null?i=s.shape.map((o,l)=>l):typeof r=="number"?i=[r]:i=r,{x:()=>oX(s,n,i)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const lX={kernelName:Wf,inputsToSave:["a","b"],gradFunc:(n,t)=>{const[e,s]=t,r=ne(e.shape,s.shape);return{a:()=>{const l=Wt(n,Ot(s,"float32")),u=Bn(e.shape,r);return u.length>0?rt(Gt(l,u),e.shape):l},b:()=>{let l=J(n,Ot(e,"float32"));const u=Bn(s.shape,r);u.length>0&&(l=rt(Gt(l,u),s.shape));const h=nn(s);return vn(Wt(l,Ot(h,"float32")))}}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const uX={kernelName:up,inputsToSave:["x"],gradFunc:(n,t)=>{const[e]=t;return{x:()=>Wt(n,vn(nn(e)))}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const cX={kernelName:hp,inputsToSave:["x"],gradFunc:(n,t)=>{const[e]=t,s=J(dh(e,6),Dp(e));return{x:()=>J(n,Ot(s,"float32"))}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const hX={kernelName:cp,inputsToSave:["x"],gradFunc:(n,t)=>{const[e]=t;return{x:()=>J(n,Ot(Dp(e),"float32"))}}};/**
 * @license
 * Copyright 2020 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const dX={kernelName:ex,inputsToSave:["x"],gradFunc:(n,t)=>{const[e]=t;return{x:()=>rt(n,e.shape)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const fX={kernelName:sx,inputsToSave:["images"],gradFunc:(n,t,e)=>{const[s]=t,r={dy:n,images:s};return{images:()=>et.runKernel(JC,r,e)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const pX={kernelName:nx,inputsToSave:["images"],gradFunc:(n,t,e)=>{const[s]=t,r={dy:n,images:s};return{images:()=>et.runKernel(ZC,r,e)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const mX={kernelName:rx,gradFunc:(n,t,e)=>{const{dims:s}=e,r=le(s,n.shape);return{x:()=>uu(n,r)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const gX={kernelName:dp,gradFunc:n=>({x:()=>we(n)})};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const yX={kernelName:fp,inputsToSave:["x"],gradFunc:(n,t)=>{const[e]=t;return{x:()=>vn(Wt(n,J(lu(e,1.5),2)))}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const xX={kernelName:ix,inputsToSave:["condition"],gradFunc:(n,t)=>{const[e]=t;return{condition:()=>Ot(we(e),"float32"),t:()=>J(n,Ot(e,n.dtype)),e:()=>J(n,Ot(vS(e),n.dtype))}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const bX={kernelName:pp,inputsToSave:["x"],gradFunc:(n,t)=>{const[e]=t;return{x:()=>{const s=Tr(e,De(0)),r=De(Sx),i=De(Tx),o=J(n,i),l=J(J(n,r),Qi(Ot(e,"float32")));return Ps(s,o,l)}}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const vX={kernelName:xp,outputsToSave:[!0],gradFunc:(n,t)=>{const[e]=t;return{x:()=>J(n,J(e,Yt(De(1),e)))}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const wX={kernelName:yp,gradFunc:n=>({x:()=>we(n)})};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const CX={kernelName:mp,inputsToSave:["x"],gradFunc:(n,t)=>{const[e]=t;return{x:()=>J(pS(Ot(e,"float32")),n)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const SX={kernelName:gp,inputsToSave:["x"],gradFunc:(n,t)=>{const[e]=t;return{x:()=>J($D(Ot(e,"float32")),n)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const TX={kernelName:ox,inputsToSave:["x"],gradFunc:(n,t,e)=>{const[s]=t,{begin:r,size:i}=e,o=s.shape,[l,u]=wx(s,r,i),h=[];for(let d=0;d<n.rank;d++)h.push([l[d],o[d]-l[d]-u[d]]);return{x:()=>SS(n,h)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const EX={kernelName:cx,outputsToSave:[!0],gradFunc:(n,t,e)=>{const[s]=t,{dim:r}=e,i=!0,o=J(n,s);return{logits:()=>Yt(o,J(Gt(o,[r],i),s))}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const IX={kernelName:bp,inputsToSave:["x"],gradFunc:(n,t)=>{const[e]=t;return{x:()=>J(n,hh(e))}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const mA={kernelName:lx,gradFunc:(n,t,e)=>{const{blockShape:s,paddings:r}=e;return{x:()=>dS(n,s,r)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const gA={kernelName:ux,gradFunc:(n,t,e)=>{const{axis:s}=e;return{x:()=>Xs(n,s)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const _X={kernelName:vp,inputsToSave:["x"],gradFunc:(n,t)=>{const[e]=t;return{x:()=>Wt(n,J(Es(Ot(e,"float32")),2))}}};/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const kX={kernelName:tS,inputsToSave:["x"],gradFunc:(n,t)=>{const[e]=t;return{x:()=>J(n,J(Ot(e,"float32"),2))}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const AX={kernelName:wp,inputsToSave:["a","b"],gradFunc:(n,t)=>{const[e,s]=t,r=De(2);return{a:()=>J(n,J(r,Yt(e,s))),b:()=>J(n,J(r,Yt(s,e)))}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const NX={kernelName:Ip,gradFunc:n=>({x:()=>we(n)})};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const RX={kernelName:Cp,inputsToSave:["a","b"],gradFunc:(n,t)=>{const[e,s]=t,r=ne(e.shape,s.shape);return{a:()=>{let l=n;const u=Bn(e.shape,r);return u.length>0&&(l=Gt(l,u)),rt(l,e.shape)},b:()=>{let l=n;const u=Bn(s.shape,r);return u.length>0&&(l=Gt(l,u)),rt(vn(l),s.shape)}}}};/**
 * @license
 * Copyright 2020 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const $X={kernelName:ax,inputsToSave:["x"],gradFunc:(n,t,e)=>{const[s]=t,r=s.shape.slice(),{axis:i}=e;le(i,s.shape).forEach(h=>{r[h]=1});const l=rt(n,r),u=J(l,nl(s.shape,"float32"));return{x:()=>u}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const DX={kernelName:Sp,inputsToSave:["x"],gradFunc:(n,t)=>{const[e]=t;return{x:()=>Wt(n,nn(pS(e)))}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const OX={kernelName:Tp,outputsToSave:[!0],gradFunc:(n,t)=>{const[e]=t;return{x:()=>J(Yt(De(1),nn(e)),n)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const MX={kernelName:Ep,inputsToSave:["x"],gradFunc:(n,t,e)=>{const[s]=t,{reps:r}=e;return{x:()=>{let o=we(s);if(s.rank===1)for(let l=0;l<r[0];++l)o=kt(o,Je(n,[l*s.shape[0]],[s.shape[0]]));else if(s.rank===2)for(let l=0;l<r[0];++l)for(let u=0;u<r[1];++u)o=kt(o,Je(n,[l*s.shape[0],u*s.shape[1]],[s.shape[0],s.shape[1]]));else if(s.rank===3)for(let l=0;l<r[0];++l)for(let u=0;u<r[1];++u)for(let h=0;h<r[2];++h)o=kt(o,Je(n,[l*s.shape[0],u*s.shape[1],h*s.shape[2]],[s.shape[0],s.shape[1],s.shape[2]]));else if(s.rank===4)for(let l=0;l<r[0];++l)for(let u=0;u<r[1];++u)for(let h=0;h<r[2];++h)for(let d=0;d<r[3];++d)o=kt(o,Je(n,[l*s.shape[0],u*s.shape[1],h*s.shape[2],d*s.shape[3]],[s.shape[0],s.shape[1],s.shape[2],s.shape[3]]));else throw new Error(`Gradient for tile operation is not implemented for rank-${s.rank} tensors yet.`);return o}}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const FX={kernelName:Dc,gradFunc:(n,t,e)=>{const s=e,{perm:r}=s,i=tl(r);return{x:()=>ve(n,i)}}};/**
 * @license
 * Copyright 2020 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const LX={kernelName:hx,gradFunc:(n,t,e)=>{const s=e,{axis:r}=s;return{value:()=>Bo(n,r)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const PX={kernelName:dx,inputsToSave:["segmentIds"],gradFunc:(n,t)=>{const[e]=t;return{x:()=>VX(n,e)}}};function VX(n,t){const e=el(t,we(t)),s=yS(n,e);let r=wu(t,De(0,"int32"));const i=s.rank-r.rank;for(let l=0;l<i;++l)r=js(r,l+1);r=zo(r,nl(s.shape,"bool"));const o=we(s);return Ps(r,s,o)}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const zX={kernelName:fx,gradFunc:n=>({x:()=>we(n)})};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const BX=[qO,P7,V7,z7,B7,U7,G7,W7,H7,q7,j7,K7,Q7,tK,eK,nK,sK,rK,iK,oK,aK,lK,cK,uK,fK,pK,mK,gK,yK,xK,lX,bK,vK,wK,CK,SK,EK,TK,IK,_K,kK,AK,NK,RK,$K,DK,OK,MK,FK,VK,fA,fA,zK,GK,qK,jK,KK,XK,YK,QK,ZK,JK,tX,eX,nX,pA,pA,sX,rX,aX,uX,cX,hX,dX,fX,pX,mX,gX,yX,xX,bX,vX,wX,CX,SX,TX,EX,IX,mA,mA,gA,gA,_X,AX,kX,NX,RX,$X,DX,OX,MX,FX,LX,PX,zX];for(const n of BX)JW(n);/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */mt().prototype.abs=function(){return this.throwIfDisposed(),Os(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */mt().prototype.acos=function(){return this.throwIfDisposed(),d5(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */mt().prototype.acosh=function(){return this.throwIfDisposed(),p5(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */mt().prototype.add=function(n){return this.throwIfDisposed(),kt(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */mt().prototype.all=function(n,t){return this.throwIfDisposed(),kD(this,n,t)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */mt().prototype.any=function(n,t){return this.throwIfDisposed(),uw(this,n,t)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */mt().prototype.argMax=function(n){return this.throwIfDisposed(),hf(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */mt().prototype.argMin=function(n){return this.throwIfDisposed(),b5(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */mt().prototype.asScalar=function(){return this.throwIfDisposed(),U(this.size===1,()=>"The array must have only 1 element."),rt(this,[])};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */mt().prototype.asType=function(n){return this.throwIfDisposed(),Ot(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */mt().prototype.as1D=function(){return this.throwIfDisposed(),rt(this,[this.size])};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */mt().prototype.as2D=function(n,t){return this.throwIfDisposed(),rt(this,[n,t])};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */mt().prototype.as3D=function(n,t,e){return this.throwIfDisposed(),rt(this,[n,t,e])};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */mt().prototype.as4D=function(n,t,e,s){return this.throwIfDisposed(),rt(this,[n,t,e,s])};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */mt().prototype.as5D=function(n,t,e,s,r){return this.throwIfDisposed(),rt(this,[n,t,e,s,r])};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */mt().prototype.asin=function(){return this.throwIfDisposed(),w5(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */mt().prototype.asinh=function(){return this.throwIfDisposed(),S5(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */mt().prototype.atan=function(){return this.throwIfDisposed(),E5(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */mt().prototype.atan2=function(n){return this.throwIfDisposed(),_5(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */mt().prototype.atanh=function(){return this.throwIfDisposed(),A5(this)};mt().prototype.avgPool=function(n,t,e,s){return this.throwIfDisposed(),hS(this,n,t,e,s)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */mt().prototype.batchToSpaceND=function(n,t){return this.throwIfDisposed(),dS(this,n,t)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */mt().prototype.batchNorm=function(n,t,e,s,r){return this.throwIfDisposed(),gx(this,n,t,e,s,r)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */mt().prototype.broadcastTo=function(n){return this.throwIfDisposed(),Zd(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */mt().prototype.cast=function(n){return this.throwIfDisposed(),Ot(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */mt().prototype.ceil=function(){return this.throwIfDisposed(),n9(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */mt().prototype.clipByValue=function(n,t){return this.throwIfDisposed(),Sr(this,n,t)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */mt().prototype.concat=function(n,t){return this.throwIfDisposed(),n instanceof Fn&&(n=[n]),Xs([this,...n],t)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */mt().prototype.conv1d=function(n,t,e,s,r,i){return this.throwIfDisposed(),AD(this,n,t,e,s,r,i)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */mt().prototype.conv2dTranspose=function(n,t,e,s,r){return this.throwIfDisposed(),ND(this,n,t,e,s,r)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */mt().prototype.conv2d=function(n,t,e,s,r,i){return this.throwIfDisposed(),au(this,n,t,e,s,r,i)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */mt().prototype.cos=function(){return this.throwIfDisposed(),pS(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */mt().prototype.cosh=function(){return this.throwIfDisposed(),$D(this)};/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the 'License');
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an 'AS IS' BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */mt().prototype.cumprod=function(n,t,e){return this.throwIfDisposed(),hw(this,n,t,e)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */mt().prototype.cumsum=function(n,t,e){return this.throwIfDisposed(),DD(this,n,t,e)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */mt().prototype.depthToSpace=function(n,t){return this.throwIfDisposed(),_9(this,n,t)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */mt().prototype.depthwiseConv2d=function(n,t,e,s,r,i){return this.throwIfDisposed(),mS(this,n,t,e,s,r,i)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */mt().prototype.dilation2d=function(n,t,e,s,r){return this.throwIfDisposed(),N9(this,n,t,e,s,r)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */mt().prototype.divNoNan=function(n){return this.throwIfDisposed(),M9(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */mt().prototype.div=function(n){return this.throwIfDisposed(),Wt(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */mt().prototype.dot=function(n){return this.throwIfDisposed(),L9(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */mt().prototype.elu=function(){return this.throwIfDisposed(),xx(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */mt().prototype.equal=function(n){return this.throwIfDisposed(),Yi(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */mt().prototype.erf=function(){return this.throwIfDisposed(),OD(this)};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */mt().prototype.euclideanNorm=function(n,t){return this.throwIfDisposed(),X9(this,n,t)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */mt().prototype.exp=function(){return this.throwIfDisposed(),Qi(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */mt().prototype.expandDims=function(n){return this.throwIfDisposed(),js(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */mt().prototype.expm1=function(){return this.throwIfDisposed(),J9(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */mt().prototype.fft=function(){return this.throwIfDisposed(),ZD(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */mt().prototype.flatten=function(){return this.throwIfDisposed(),rt(this,[this.size])};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */mt().prototype.floor=function(){return this.throwIfDisposed(),vx(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */mt().prototype.floorDiv=function(n){return this.throwIfDisposed(),_D(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */mt().prototype.gather=function(n,t,e){return this.throwIfDisposed(),yS(this,n,t,e)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */mt().prototype.greaterEqual=function(n){return this.throwIfDisposed(),wu(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */mt().prototype.greater=function(n){return this.throwIfDisposed(),Tr(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */mt().prototype.ifft=function(){return this.throwIfDisposed(),dw(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */mt().prototype.irfft=function(){return this.throwIfDisposed(),qj(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */mt().prototype.isFinite=function(){return this.throwIfDisposed(),lq(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */mt().prototype.isInf=function(){return this.throwIfDisposed(),cq(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */mt().prototype.isNaN=function(){return this.throwIfDisposed(),dq(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */mt().prototype.leakyRelu=function(n){return this.throwIfDisposed(),bS(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */mt().prototype.lessEqual=function(n){return this.throwIfDisposed(),dh(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */mt().prototype.less=function(n){return this.throwIfDisposed(),_y(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */mt().prototype.localResponseNormalization=function(n,t,e,s){return this.throwIfDisposed(),yq(this,n,t,e,s)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */mt().prototype.logSigmoid=function(){return this.throwIfDisposed(),Tq(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */mt().prototype.logSoftmax=function(n){return this.throwIfDisposed(),VD(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */mt().prototype.logSumExp=function(n,t){return this.throwIfDisposed(),zD(this,n,t)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */mt().prototype.log=function(){return this.throwIfDisposed(),Zi(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */mt().prototype.log1p=function(){return this.throwIfDisposed(),PD(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */mt().prototype.logicalAnd=function(n){return this.throwIfDisposed(),zo(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */mt().prototype.logicalNot=function(){return this.throwIfDisposed(),vS(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */mt().prototype.logicalOr=function(n){return this.throwIfDisposed(),BD(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */mt().prototype.logicalXor=function(n){return this.throwIfDisposed(),$q(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */mt().prototype.matMul=function(n,t,e){return this.throwIfDisposed(),$e(this,n,t,e)};mt().prototype.maxPool=function(n,t,e,s){return this.throwIfDisposed(),wS(this,n,t,e,s)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */mt().prototype.max=function(n,t){return this.throwIfDisposed(),ci(this,n,t)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */mt().prototype.maximum=function(n){return this.throwIfDisposed(),el(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */mt().prototype.mean=function(n,t){return this.throwIfDisposed(),An(this,n,t)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */mt().prototype.min=function(n,t){return this.throwIfDisposed(),Iy(this,n,t)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */mt().prototype.minimum=function(n){return this.throwIfDisposed(),pf(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */mt().prototype.mirrorPad=function(n,t){return this.throwIfDisposed(),zq(this,n,t)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */mt().prototype.mod=function(n){return this.throwIfDisposed(),Uq(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */mt().prototype.mul=function(n){return this.throwIfDisposed(),J(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */mt().prototype.neg=function(){return this.throwIfDisposed(),vn(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */mt().prototype.norm=function(n,t,e){return this.throwIfDisposed(),bx(this,n,t,e)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */mt().prototype.notEqual=function(n){return this.throwIfDisposed(),ky(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */mt().prototype.oneHot=function(n,t=1,e=0){return this.throwIfDisposed(),UD(this,n,t,e)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */mt().prototype.onesLike=function(){return this.throwIfDisposed(),jr(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */mt().prototype.pad=function(n,t){return this.throwIfDisposed(),SS(this,n,t)};mt().prototype.pool=function(n,t,e,s,r,i){return this.throwIfDisposed(),Zq(this,n,t,e,s,r,i)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */mt().prototype.pow=function(n){return this.throwIfDisposed(),lu(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */mt().prototype.prelu=function(n){return this.throwIfDisposed(),ES(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */mt().prototype.prod=function(n,t){return this.throwIfDisposed(),ej(this,n,t)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */mt().prototype.reciprocal=function(){return this.throwIfDisposed(),Ij(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */mt().prototype.relu=function(){return this.throwIfDisposed(),Cu(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */mt().prototype.relu6=function(){return this.throwIfDisposed(),WD(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */mt().prototype.reshapeAs=function(n){return this.throwIfDisposed(),rt(this,n.shape)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */mt().prototype.reshape=function(n){return this.throwIfDisposed(),rt(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */mt().prototype.resizeBilinear=function(n,t,e){return this.throwIfDisposed(),sO(this,n,t,e)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */mt().prototype.resizeNearestNeighbor=function(n,t,e){return this.throwIfDisposed(),rO(this,n,t,e)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */mt().prototype.reverse=function(n){return this.throwIfDisposed(),uu(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */mt().prototype.rfft=function(){return this.throwIfDisposed(),Xj(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */mt().prototype.round=function(){return this.throwIfDisposed(),HD(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */mt().prototype.rsqrt=function(){return this.throwIfDisposed(),qD(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */mt().prototype.selu=function(){return this.throwIfDisposed(),jD(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */mt().prototype.separableConv2d=function(n,t,e,s,r,i){return this.throwIfDisposed(),KD(this,n,t,e,s,r,i)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */mt().prototype.sigmoid=function(){return this.throwIfDisposed(),hh(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */mt().prototype.sign=function(){return this.throwIfDisposed(),Mj(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */mt().prototype.sin=function(){return this.throwIfDisposed(),XD(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */mt().prototype.sinh=function(){return this.throwIfDisposed(),YD(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */mt().prototype.slice=function(n,t){return this.throwIfDisposed(),Je(this,n,t)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */mt().prototype.softmax=function(n){return this.throwIfDisposed(),AS(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */mt().prototype.softplus=function(){return this.throwIfDisposed(),Np(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */mt().prototype.spaceToBatchND=function(n,t){return this.throwIfDisposed(),TS(this,n,t)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */mt().prototype.split=function(n,t){return this.throwIfDisposed(),Cr(this,n,t)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */mt().prototype.sqrt=function(){return this.throwIfDisposed(),Es(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */mt().prototype.square=function(){return this.throwIfDisposed(),nn(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */mt().prototype.squaredDifference=function(n){return this.throwIfDisposed(),Qj(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */mt().prototype.squeeze=function(n){return this.throwIfDisposed(),$p(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */mt().prototype.stack=function(n,t){this.throwIfDisposed();const e=n instanceof Fn?[this,n]:[this,...n];return Bo(e,t)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */mt().prototype.step=function(n){return this.throwIfDisposed(),Dp(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */mt().prototype.stridedSlice=function(n,t,e,s,r,i,o,l){return this.throwIfDisposed(),n8(this,n,t,e,s,r,i,o,l)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */mt().prototype.sub=function(n){return this.throwIfDisposed(),Yt(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */mt().prototype.sum=function(n,t){return this.throwIfDisposed(),Gt(this,n,t)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */mt().prototype.tan=function(){return this.throwIfDisposed(),r8(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */mt().prototype.tanh=function(){return this.throwIfDisposed(),mx(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */mt().prototype.tile=function(n){return this.throwIfDisposed(),ai(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */mt().prototype.toBool=function(){return this.throwIfDisposed(),Ot(this,"bool")};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */mt().prototype.toFloat=function(){return this.throwIfDisposed(),Ot(this,"float32")};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */mt().prototype.toInt=function(){return this.throwIfDisposed(),Ot(this,"int32")};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */mt().prototype.topk=function(n,t){return this.throwIfDisposed(),l8(this,n,t)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */mt().prototype.transpose=function(n){return this.throwIfDisposed(),ve(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */mt().prototype.unique=function(n){return this.throwIfDisposed(),h8(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */mt().prototype.unsortedSegmentSum=function(n,t){return this.throwIfDisposed(),eO(this,n,t)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */mt().prototype.unstack=function(n){return this.throwIfDisposed(),cu(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */mt().prototype.where=function(n,t){return this.throwIfDisposed(),Ps(n,this,t)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */mt().prototype.zerosLike=function(){return this.throwIfDisposed(),we(this)};/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */class Mi extends Error{constructor(t){super(t),Object.setPrototypeOf(this,Mi.prototype)}}class Wr extends Error{constructor(t){super(t),Object.setPrototypeOf(this,Wr.prototype)}}class X extends Error{constructor(t){super(t),Object.setPrototypeOf(this,X.prototype)}}class re extends Error{constructor(t){super(t),Object.setPrototypeOf(this,re.prototype)}}class dT extends Error{constructor(t){super(t),Object.setPrototypeOf(this,dT.prototype)}}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */class KO{constructor(t){this.maxEntries=t||100,this.cache=new Map}get(t){let e;return this.cache.has(t)&&(e=this.cache.get(t),this.cache.delete(t),this.cache.set(t,e)),e}put(t,e){if(this.cache.has(t))this.cache.delete(t);else if(this.cache.size>=this.maxEntries){const s=this.cache.keys().next().value;this.cache.delete(s)}this.cache.set(t,e)}getMaxEntries(){return this.maxEntries}setMaxEntries(t){if(t<0)throw new Error(`The maxEntries of LRU caches must be at least 0, but got ${t}.`);if(this.maxEntries>t)for(let e=0;e<this.maxEntries-t;e++){const s=this.cache.keys().next().value;this.cache.delete(s)}this.maxEntries=t}}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function hu(n,t){if(Array.isArray(n)){let e=[];for(let s=0;s<t;s++)e=e.concat(n);return e}else{const e=new Array(t);return e.fill(n),e}}function Fi(n,t){if(!n)throw new dT(t)}function yA(n,t){let e=0;for(const s of n)s===t&&e++;return e}function Ks(n){return n.length===1?n[0]:n}function Ve(n){return Array.isArray(n)?n:[n]}function Ro(n){const e=n.replace(/(.)([A-Z][a-z0-9]+)/g,"$1_$2").replace(/([a-z])([A-Z])/g,"$1_$2").toLowerCase();return e[0]!=="_"?e:"private"+e}function Wl(n){return n.length<=1||n.indexOf("_")===-1?n:n.replace(/[_]+(\w|$)/g,(t,e)=>e.toUpperCase())}let Vr={};function fT(n){if(n==null)return null;const t={};return t.className=n.getClassName(),t.config=n.getConfig(),t}function mw(n){if(!(n==null||typeof n!="object"))if(Array.isArray(n))n.forEach(t=>mw(t));else{const t=Object.keys(n);for(const e of t){const s=n[e];s!=null&&typeof s=="object"&&(!Array.isArray(s)&&s.type==="ndarray"&&typeof s.value=="number"?n[e]=s.value:mw(s))}}}function Lp(n,t={},e={},s="object",r=!1){if(typeof n=="string"){const i=n;let o;if(i in e)o=e[i];else if(i in Vr)o=Vr[i];else if(o=t[i],o==null)throw new X(`Unknown ${s}: ${n}. This may be due to one of the following reasons:
1. The ${s} is defined in Python, in which case it needs to be ported to TensorFlow.js or your JavaScript code.
2. The custom ${s} is defined in JavaScript, but is not registered properly with tf.serialization.registerClass().`);return o}else{const i=n;if(i.className==null||i.config==null)throw new X(`${s}: Improper config format: ${JSON.stringify(i)}.
'className' and 'config' must set.`);const o=i.className;let l,u;if(o in e?[l,u]=e[o]:o in Vr?[l,u]=Vr.className:o in t&&([l,u]=t[o]),l==null)throw new X(`Unknown ${s}: ${o}. This may be due to one of the following reasons:
1. The ${s} is defined in Python, in which case it needs to be ported to TensorFlow.js or your JavaScript code.
2. The custom ${s} is defined in JavaScript, but is not registered properly with tf.serialization.registerClass().`);if(u!=null){const h={};for(const y of Object.keys(Vr))h[y]=Vr[y];for(const y of Object.keys(e))h[y]=e[y];const d=i.config;d.customObjects=h;const p=Object.assign({},Vr);for(const y of Object.keys(e))Vr[y]=e[y];mw(i.config);const m=u(l,i.config,e,r);return Vr=Object.assign({},p),m}else{const h=Object.assign({},Vr);for(const p of Object.keys(e))Vr[p]=e[p];const d=new l(i.config);return Vr=Object.assign({},h),d}}}function UX(n,t){return n<t?-1:n>t?1:0}function Ig(n,t){return-1*UX(n,t)}function Fa(n){if(n==null)return n;const t=[];for(const e of n)t.indexOf(e)===-1&&t.push(e);return t}function GX(n){if(n==null)throw new X(`Invalid value in obj: ${JSON.stringify(n)}`);for(const t in n)if(n.hasOwnProperty(t))return!1;return!0}function Tu(n,t,e){if(e!=null&&n.indexOf(e)<0)throw new X(`${e} is not a valid ${t}.  Valid values are ${n} or null/undefined.`)}function pT(n,t,e=0,s=1/0){return Fi(e>=0),Fi(s>=e),Array.isArray(n)&&n.length>=e&&n.length<=s&&n.every(r=>typeof r===t)}function Zn(n,t){Array.isArray(n)?(U(n.length>0,()=>`${t} is unexpectedly an empty array.`),n.forEach((e,s)=>Zn(e,`element ${s+1} of ${t}`))):U(Number.isInteger(n)&&n>0,()=>`Expected ${t} to be a positive integer, but got ${XO(n)}.`)}function XO(n){return n===null?"null":Array.isArray(n)?"["+n.map(t=>XO(t)).join(",")+"]":typeof n=="string"?`"${n}"`:`${n}`}function WX(n,t,e){let s=e!=null?e():qs(),r;return(...o)=>{const l=e!=null?e():qs();return l-s<t||(s=l,r=n(...o)),r}}function YO(n){return n==="relu"?"relu":n==="linear"?"linear":n==="elu"?"elu":null}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */let HX=0;function QO(){return HX++}const _g={};function Ex(n=""){return n in _g||(_g[n]=0),_g[n]+=1,n+_g[n].toString()}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */const qX=["channelsFirst","channelsLast"],jX=["nearest","bilinear"],KX=["valid","same","causal"],XX=["max","avg"],YX=["sum","mul","concat","ave"];/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */const wc=new Map;function Sn(n){Tu(qX,"DataFormat",n)}function QX(n){Tu(jX,"InterpolationFormat",n)}function Er(n){Tu(KX,"PaddingMode",n)}function ZO(n){Tu(XX,"PoolMode",n)}const Jd=[],xA="/";function Yl(n,t){Jd.push(n);try{const e=t();return Jd.pop(),e}catch(e){throw Jd.pop(),e}}function ZX(){return Jd.length===0?"":Jd.join(xA)+xA}function JO(n){if(!eM(n))throw new Error("Not a valid tensor name: '"+n+"'");return ZX()+n}function tM(n){if(!eM(n))throw new Error("Not a valid tensor name: '"+n+"'");wc.has(n)||wc.set(n,0);const t=wc.get(n);if(wc.set(n,wc.get(n)+1),t>0){const e=`${n}_${t}`;return wc.set(e,1),e}else return n}const JX=new RegExp(/^[A-Za-z0-9][-A-Za-z0-9\._\/]*$/);function eM(n){return!!n.match(JX)}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function tY(n){return n===parseInt(n.toString(),10)}function La(n,t,e){t==null&&(t=0),e==null&&(e=n.length);let s=1;for(let r=t;r<e;++r)s*=n[r];return s}function Xc(n){if(n.length===0)return Number.NaN;let t=Number.POSITIVE_INFINITY;for(let e=0;e<n.length;e++){const s=n[e];s<t&&(t=s)}return t}function Ha(n){if(n.length===0)return Number.NaN;let t=Number.NEGATIVE_INFINITY;for(let e=0;e<n.length;e++){const s=n[e];s>t&&(t=s)}return t}function di(n,t){if(t<n)throw new X(`end (${t}) < begin (${n}) is forbidden.`);const e=[];for(let s=n;s<t;++s)e.push(s);return e}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */let uv;function Ln(){return uv==null&&(uv=EH().epsilon()),uv}function fi(){return"channelsLast"}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function Wi(n,t){return Ot(n,t)}function Pp(n,t=-1){const e=n.shape.slice();return t<0&&(t=e.length+t+1),e.splice(t,0,1),rt(n,e)}function eY(n,t){return ct(()=>{if(n.shape.length!==2)throw new X(`repeat() expects a rank-2 tensor, but received a rank-${n.shape.length} tensor.`);const e=Pp(n,1);return gw(e,[1,t,1])})}function nY(n){const t=[La(n.shape)];return rt(n,t)}function sY(n){if(n.rank<=1)throw new X(`batchFlatten requires a minimum rank of 2. Got rank: ${n.rank}.`);const t=[n.shape[0],La(n.shape,1)];return rt(n,t)}function Ql(n,t,e){return ct(()=>{switch(n.rank){case 1:return _S(n,t,e);case 2:return QD(n,[t,0],[e,n.shape[1]]);case 3:return kS(n,[t,0,0],[e,n.shape[1],n.shape[2]]);case 4:return Ny(n,[t,0,0,0],[e,n.shape[1],n.shape[2],n.shape[3]]);case 5:return Je(n,[t,0,0,0,0],[e,n.shape[1],n.shape[2],n.shape[3],n.shape[4]]);case 6:return Je(n,[t,0,0,0,0,0],[e,n.shape[1],n.shape[2],n.shape[3],n.shape[4],n.shape[5]]);default:throw new X(`sliceAlongFirstAxis() received an unsupported tensor rank: ${n.rank}`)}})}function cv(n,t,e){return ct(()=>{switch(n.rank){case 1:return _S(n,t,e);case 2:return QD(n,[0,t],[n.shape[0],e]);case 3:return kS(n,[0,0,t],[n.shape[0],n.shape[1],e]);case 4:return Ny(n,[0,0,0,t],[n.shape[0],n.shape[1],n.shape[2],e]);default:throw new X(`sliceAlongLastAxis() received an unsupported tensor rank: ${n.rank}`)}})}function kg(n,t,e,s){return ct(()=>{switch(n.rank){case 1:return _S(n,t,e);case 2:switch(s){case 1:return Ql(n,t,e);case 2:return cv(n,t,e);default:throw new X(`The axis is not within the rank of the tensor ${s}`)}case 3:switch(s){case 1:return Ql(n,t,e);case 2:return kS(n,[0,t,0],[n.shape[0],e,n.shape[2]]);case 3:return cv(n,t,e);default:throw new X(`The axis is not within the rank of the tensor ${s}`)}case 4:switch(s){case 1:return Ql(n,t,e);case 2:return Ny(n,[0,t,0,0],[n.shape[0],e,n.shape[2],n.shape[3]]);case 3:return Ny(n,[0,0,t,0],[n.shape[0],n.shape[1],e,n.shape[3]]);case 4:return cv(n,t,e);default:throw new X(`The axis is not within the rank of the tensor ${s}`)}default:throw new X(`sliceAlongLastAxis() received an unsupported tensor rank: ${n.rank}`)}})}function mT(n,t=-1){let e;return t<0&&(e=n[0].rank,e!==0?t=e:t=0),t===n[0].rank&&(t=-1),Xs(n,t)}function bA(n,t){switch(n.rank){case 1:return i9([n,t]);case 2:return a9([n,t],0);case 3:return u9([n,t],0);case 4:return h9([n,t],0);default:throw new X(`concatAlongFirstAxis() received an unsupported tensor rank: ${n.rank}`)}}function gw(n,t){if(Array.isArray(t)||(t=[t]),n.rank!==t.length)throw new X(`The length of input n (${t.length}) does not match the number of dimensions in input x (${n.rank})`);return ai(n,t)}function Ix(n,t=0,e=1,s,r){return Cj(n,t,e,s,r)}function Hi(n,t,e,s){if(n.rank<2||t.rank<2)throw new re(`dot requires both inputs to be rank >= 2 but got x shape = ${n.shape} and y shape = ${t.shape}`);if(t.rank>=3){const r=n.shape.slice(-1)[0],i=t.shape.slice(-2)[0];if(r!==i)throw new re(`If rank y >= 3, then the second last dim of y must equal the last dim of x but got x shape = ${n.shape} and  y shape = ${t.shape}`)}if(n.rank===2&&t.rank===2)return sA({a:n,b:t,transposeA:!1,transposeB:!1,bias:s?yw(n.rank,s,fi()):null,activation:e});{const r=n.shape.slice(),i=r.pop();n=rt(n,[-1,i]);const o=t.shape.slice(),l=o.pop(),u=o.pop(),h=[...o,l],d=Array.from({length:t.rank},(x,v)=>v===0?t.rank-2:v<=t.rank-2?v-1:v);t=rt(ve(t,d),[u,-1]);const p=[...r,...h];return rt(sA({a:n,b:t,transposeA:!1,transposeB:!1,bias:s?yw(n.rank,s,fi()):null,activation:e}),p)}}function nM(n,t,e){return ct(()=>(Array.isArray(t)?t=ar(t,"int32"):t=Ot(t,"int32"),yS(n,t,e)))}function Vp(n){return J(n,n)}function yw(n,t,e){const s=t.shape;if(t.rank!==1&&t.rank!==n)throw new X(`Unexpected bias dimensions: ${t.rank}; expected it to be 1 or ${n}`);if(n===5){if(e==="channelsFirst")return s.length===1?rt(t,[1,s[0],1,1,1]):rt(t,[1,s[3],s[0],s[1],s[2]]);if(e==="channelsLast")return s.length===1?rt(t,[1,1,1,1,s[0]]):rt(t,[1].concat(s))}else if(n===4){if(e==="channelsFirst")return s.length===1?rt(t,[1,s[0],1,1]):rt(t,[1,s[2],s[0],s[1]]);if(e==="channelsLast")return s.length===1?rt(t,[1,1,1,s[0]]):rt(t,[1].concat(s))}else if(n===3){if(e==="channelsFirst")return s.length===1?rt(t,[1,s[0],1]):rt(t,[1,s[1],s[0]]);if(e==="channelsLast")return s.length===1?rt(t,[1,1,s[0]]):rt(t,[1].concat(s))}else if(n<3)return t;throw new X(`Unsupported input rank by biasAdd: ${t.rank}`)}function mi(n,t,e){return ct(()=>(e==null&&(e=fi()),Sn(e),kt(n,yw(n.rank,t,e))))}function rY(n,t=1){if(t!==1)throw new re(`Support for alpha values other than 1 (${t}) is not implemented yet.`);return xx(n)}function iY(n){return ct(()=>Wt(n,kt(Os(n),1)))}function sM(n,t,e,s){return ct(()=>x8(n,t,e,s))}function oY(n){return ct(()=>{const t=kt(.5,J(.2,n));return Sr(t,0,1)})}function zp(n,t,e=!1){return e?n():t()}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */const aY=["fanIn","fanOut","fanAvg"],lY=["normal","uniform","truncatedNormal"];/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function uY(n){Tu(aY,"FanMode",n)}function cY(n){Tu(lY,"Distribution",n)}class Xr extends ph{fromConfigUsesCustomObjects(){return!1}getConfig(){return{}}}class rM extends Xr{apply(t,e){return Qn(t,e)}}rM.className="Zeros";It(rM);class gT extends Xr{apply(t,e){return nl(t,e)}}gT.className="Ones";It(gT);class iM extends Xr{constructor(t){if(super(),typeof t!="object")throw new X(`Expected argument of type ConstantConfig but got ${t}`);if(t.value===void 0)throw new X(`config must have value set but got ${t}`);this.value=t.value}apply(t,e){return ct(()=>J(De(this.value),nl(t,e)))}getConfig(){return{value:this.value}}}iM.className="Constant";It(iM);class oM extends Xr{constructor(t){super(),this.DEFAULT_MINVAL=-.05,this.DEFAULT_MAXVAL=.05,this.minval=t.minval||this.DEFAULT_MINVAL,this.maxval=t.maxval||this.DEFAULT_MAXVAL,this.seed=t.seed}apply(t,e){return Rp(t,this.minval,this.maxval,e,this.seed)}getConfig(){return{minval:this.minval,maxval:this.maxval,seed:this.seed}}}oM.className="RandomUniform";It(oM);class aM extends Xr{constructor(t){super(),this.DEFAULT_MEAN=0,this.DEFAULT_STDDEV=.05,this.mean=t.mean||this.DEFAULT_MEAN,this.stddev=t.stddev||this.DEFAULT_STDDEV,this.seed=t.seed}apply(t,e){if(e=e||"float32",e!=="float32"&&e!=="int32")throw new re(`randomNormal does not support dType ${e}.`);return Ix(t,this.mean,this.stddev,e,this.seed)}getConfig(){return{mean:this.mean,stddev:this.stddev,seed:this.seed}}}aM.className="RandomNormal";It(aM);class lM extends Xr{constructor(t){super(),this.DEFAULT_MEAN=0,this.DEFAULT_STDDEV=.05,this.mean=t.mean||this.DEFAULT_MEAN,this.stddev=t.stddev||this.DEFAULT_STDDEV,this.seed=t.seed}apply(t,e){if(e=e||"float32",e!=="float32"&&e!=="int32")throw new re(`truncatedNormal does not support dType ${e}.`);return tO(t,this.mean,this.stddev,e,this.seed)}getConfig(){return{mean:this.mean,stddev:this.stddev,seed:this.seed}}}lM.className="TruncatedNormal";It(lM);class uM extends Xr{constructor(t){super(),this.gain=t.gain!=null?t.gain:1}apply(t,e){return ct(()=>{if(t.length!==2||t[0]!==t[1])throw new X("Identity matrix initializer can only be used for 2D square matrices.");return J(this.gain,LD(t[0]))})}getConfig(){return{gain:this.gain}}}uM.className="Identity";It(uM);function hY(n,t="channelsLast"){let e,s;if(Sn(t),n.length===2)e=n[0],s=n[1];else if([3,4,5].indexOf(n.length)!==-1){if(t==="channelsFirst"){const r=La(n,2);e=n[1]*r,s=n[0]*r}else if(t==="channelsLast"){const r=La(n,0,n.length-2);e=n[n.length-2]*r,s=n[n.length-1]*r}}else{const r=La(n);e=Math.sqrt(r),s=Math.sqrt(r)}return[e,s]}class ur extends Xr{constructor(t){if(super(),t.scale<0)throw new X(`scale must be a positive float. Got: ${t.scale}`);this.scale=t.scale==null?1:t.scale,this.mode=t.mode==null?"fanIn":t.mode,uY(this.mode),this.distribution=t.distribution==null?"normal":t.distribution,cY(this.distribution),this.seed=t.seed}apply(t,e){const s=hY(t),r=s[0],i=s[1];let o=this.scale;if(this.mode==="fanIn"?o/=Math.max(1,r):this.mode==="fanOut"?o/=Math.max(1,i):o/=Math.max(1,(r+i)/2),this.distribution==="normal"){const l=Math.sqrt(o);if(e=e||"float32",e!=="float32"&&e!=="int32")throw new re(`${this.getClassName()} does not support dType ${e}.`);return tO(t,0,l,e,this.seed)}else{const l=Math.sqrt(3*o);return Rp(t,-l,l,e,this.seed)}}getConfig(){return{scale:this.scale,mode:this.mode,distribution:this.distribution,seed:this.seed}}}ur.className="VarianceScaling";It(ur);class yT extends ur{constructor(t){super({scale:1,mode:"fanAvg",distribution:"uniform",seed:t==null?null:t.seed})}getClassName(){return ur.className}}yT.className="GlorotUniform";It(yT);class xT extends ur{constructor(t){super({scale:1,mode:"fanAvg",distribution:"normal",seed:t==null?null:t.seed})}getClassName(){return ur.className}}xT.className="GlorotNormal";It(xT);class bT extends ur{constructor(t){super({scale:2,mode:"fanIn",distribution:"normal",seed:t==null?null:t.seed})}getClassName(){return ur.className}}bT.className="HeNormal";It(bT);class vT extends ur{constructor(t){super({scale:2,mode:"fanIn",distribution:"uniform",seed:t==null?null:t.seed})}getClassName(){return ur.className}}vT.className="HeUniform";It(vT);class wT extends ur{constructor(t){super({scale:1,mode:"fanIn",distribution:"normal",seed:t==null?null:t.seed})}getClassName(){return ur.className}}wT.className="LeCunNormal";It(wT);class CT extends ur{constructor(t){super({scale:1,mode:"fanIn",distribution:"uniform",seed:t==null?null:t.seed})}getClassName(){return ur.className}}CT.className="LeCunUniform";It(CT);class cM extends Xr{constructor(t){super(),this.DEFAULT_GAIN=1,this.ELEMENTS_WARN_SLOW=2e3,this.gain=t.gain==null?this.DEFAULT_GAIN:t.gain,this.seed=t.seed}apply(t,e){return ct(()=>{if(t.length<2)throw new re("Shape must be at least 2D.");if(e!=="int32"&&e!=="float32"&&e!==void 0)throw new TypeError(`Unsupported data type ${e}.`);e=e;const s=yt(t.slice(0,-1)),r=t[t.length-1],i=s*r;i>this.ELEMENTS_WARN_SLOW&&console.warn(`Orthogonal initializer is being called on a matrix with more than ${this.ELEMENTS_WARN_SLOW} (${i}) elements: Slowness may result.`);const o=[Math.max(r,s),Math.min(r,s)],l=Ix(o,0,1,e,this.seed),u=p7.qr(l,!1);let h=u[0];const p=u[1].flatten().stridedSlice([0],[Math.min(r,s)*Math.min(r,s)],[Math.min(r,s)+1]);return h=J(h,p.sign()),s<r&&(h=h.transpose()),J(De(this.gain),h.reshape(t))})}getConfig(){return{gain:this.gain,seed:this.seed}}}cM.className="Orthogonal";It(cM);const vA={constant:"Constant",glorotNormal:"GlorotNormal",glorotUniform:"GlorotUniform",heNormal:"HeNormal",heUniform:"HeUniform",identity:"Identity",leCunNormal:"LeCunNormal",leCunUniform:"LeCunUniform",ones:"Ones",orthogonal:"Orthogonal",randomNormal:"RandomNormal",randomUniform:"RandomUniform",truncatedNormal:"TruncatedNormal",varianceScaling:"VarianceScaling",zeros:"Zeros"};function wA(n,t={}){return Lp(n,Gr.getMap().classNameMap,t,"initializer")}function cn(n){return fT(n)}function rn(n){if(typeof n=="string"){const t=n in vA?vA[n]:n;if(t==="GlorotNormal")return new xT;if(t==="GlorotUniform")return new yT;if(t==="HeNormal")return new bT;if(t==="HeUniform")return new vT;if(t==="LeCunNormal")return new wT;if(t==="LeCunUniform")return new CT;{const e={};return e.className=t,e.config={},wA(e)}}else return n instanceof Xr?n:wA(n)}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function xw(n){return Array.isArray(n)&&Array.isArray(n[0])}function Ry(n){return n.length===0?[]:Array.isArray(n[0])?n:[n]}function Zt(n){let t;if(Array.isArray(n)){if(n.length!==1)throw new X(`Expected Tensor length to be 1; got ${n.length}`);t=n[0]}else t=n;return t}function Ae(n){if(Array.isArray(n)&&Array.isArray(n[0])){if(n.length===1)return n=n,n[0];throw new X(`Expected exactly 1 Shape; got ${n.length}`)}else return n}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function $y(n){let t=0;for(const e of n)e.shape.length===0?t+=1:t+=e.shape.reduce((s,r)=>s*r);return t}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */const CA="Variable";class dY{constructor(t,e="float32",s=CA,r=!0,i=null){this.dtype=e??"float32",this.shape=t.shape,this.id=QO(),s=s??CA,this.originalName=JO(s),this.name=tM(this.originalName),this.trainable_=r,this.constraint=i,this.val=p8(t,this.trainable_,this.name,this.dtype)}read(){return this.assertNotDisposed(),this.val}write(t){return this.assertNotDisposed(),fY(this.val,t),this.val.id!==t.id&&(this.val.assign(t),this.constraint!=null&&this.val.assign(this.constraint.apply(this.val))),this}dispose(){this.assertNotDisposed(),this.val.dispose()}assertNotDisposed(){if(this.val.isDisposed)throw new Error(`LayersVariable ${this.name} is already disposed.`)}get trainable(){return this.trainable_}set trainable(t){this.trainable_=t,this.val.trainable=t}}function fY(n,t){if(n.shape.toString()!==t.shape.toString())throw new Error("Shape mismatch: "+JSON.stringify(n.shape)+" vs. "+JSON.stringify(t.shape))}function bw(n){return n.map(t=>t.read())}function ST(n){n.forEach(t=>{t[0].write(t[1])})}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */class Pn{constructor(t){this.dtype=t.dtype,this.shape=t.shape,t.shape!=null?this.ndim=t.shape.length:this.ndim=t.ndim,this.maxNDim=t.maxNDim,this.minNDim=t.minNDim,this.axes=t.axes||{}}}class Ji{constructor(t,e,s,r,i,o,l){this.dtype=t,this.shape=e,this.sourceLayer=s,this.inputs=r,this.callArgs=i,this.outputTensorIndex=l,this.id=QO(),o!=null&&(this.originalName=JO(o),this.name=tM(this.originalName)),this.rank=e.length}}let pY=0;class _x{constructor(t,e){this.callArgs=e,this.id=pY++,this.outboundLayer=t.outboundLayer,this.inboundLayers=t.inboundLayers,this.nodeIndices=t.nodeIndices,this.tensorIndices=t.tensorIndices,this.inputTensors=t.inputTensors,this.outputTensors=t.outputTensors,this.inputMasks=t.inputMasks,this.outputMasks=t.outputMasks,this.inputShapes=t.inputShapes,this.outputShapes=t.outputShapes;for(const s of t.inboundLayers)s!=null&&s.outboundNodes.push(this);t.outboundLayer.inboundNodes.push(this)}getConfig(){const t=[];for(const e of this.inboundLayers)e!=null?t.push(e.name):t.push(null);return{outboundLayer:this.outboundLayer?this.outboundLayer.name:null,inboundLayers:t,nodeIndices:this.nodeIndices,tensorIndices:this.tensorIndices}}}let mY=0;class ue extends ph{constructor(t={}){super(),this._callHook=null,this._addedWeightNames=[],this._stateful=!1,this.id=mY++,this.activityRegularizer=null,this.inputSpec=null,this.supportsMasking=!1,this._trainableWeights=[],this._nonTrainableWeights=[],this._losses=[],this._updates=[],this._built=!1,this.inboundNodes=[],this.outboundNodes=[];let e=t.name;if(!e){const s=this.getClassName();e=Ro(s)+"_"+Ex(s)}if(this.name=e,this.trainable_=t.trainable==null?!0:t.trainable,t.inputShape!=null||t.batchInputShape!=null){let s;if(t.batchInputShape!=null)s=t.batchInputShape;else if(t.inputShape!=null){let i=null;t.batchSize!=null&&(i=t.batchSize),s=[i].concat(t.inputShape)}this.batchInputShape=s;let r=t.dtype;r==null&&(r=t.inputDType),r==null&&(r="float32"),this.dtype=r}t.weights!=null?this.initialWeights=t.weights:this.initialWeights=null,this._refCount=null,this.fastWeightInitDuringBuild=!1}static nodeKey(t,e){return t.name+"_ib-"+e.toString()}getNodeAtIndex(t,e){if(this.inboundNodes.length===0)throw new Wr(`The layer has never been called and thus has no defined ${e}.`);if(this.inboundNodes.length<=t)throw new X(`Asked to get ${e} at node ${t}, but the layer has only ${this.inboundNodes.length} inbound nodes.`);return this.inboundNodes[t]}getInputAt(t){return Ks(this.getNodeAtIndex(t,"input").inputTensors)}getOutputAt(t){return Ks(this.getNodeAtIndex(t,"output").outputTensors)}get input(){if(this.inboundNodes.length>1)throw new Mi(`Layer ${this.name} has multiple inbound nodes, hence the notion of "layer input" is ill-defined. Use \`getInputAt(nodeIndex)\` instead.`);if(this.inboundNodes.length===0)throw new Mi(`Layer ${this.name} is not connected, no input to return.`);return Ks(this.getNodeAtIndex(0,"input").inputTensors)}get output(){if(this.inboundNodes.length===0)throw new Mi(`Layer ${this.name} has no inbound nodes.`);if(this.inboundNodes.length>1)throw new Mi(`Layer ${this.name} has multiple inbound nodes, hence the notion of "layer output" is ill-defined. Use \`getOutputAt(nodeIndex)\` instead.`);return Ks(this.getNodeAtIndex(0,"output").outputTensors)}get losses(){return this._losses}calculateLosses(){return this.losses.map(t=>t())}get updates(){return this._updates}get built(){return this._built}set built(t){this._built=t}get trainable(){return this.trainable_}set trainable(t){this._trainableWeights.forEach(e=>e.trainable=t),this.trainable_=t}get trainableWeights(){return this.trainable_?this._trainableWeights.filter(t=>t.trainable):[]}set trainableWeights(t){this._trainableWeights=t}get nonTrainableWeights(){return this.trainable?this._trainableWeights.filter(t=>!t.trainable).concat(this._nonTrainableWeights):this._trainableWeights.concat(this._nonTrainableWeights)}set nonTrainableWeights(t){this._nonTrainableWeights=t}get weights(){return this.trainableWeights.concat(this.nonTrainableWeights)}get stateful(){return this._stateful}resetStates(){if(!this.stateful)throw new Error("Cannot call the resetStates() method of a non-stateful Layer object.")}assertInputCompatibility(t){const e=Ve(t);if(this.inputSpec==null||this.inputSpec.length===0)return;const s=Ve(this.inputSpec);if(e.length!==s.length)throw new X(`Layer ${this.name} expects ${s.length} inputs, but it received ${e.length} input tensors. Input received: ${t}`);for(let r=0;r<e.length;r++){const i=e[r],o=s[r];if(o==null)continue;const l=i.rank;if(o.ndim!=null&&l!==o.ndim)throw new X(`Input ${r} is incompatible with layer ${this.name}: expected ndim=${o.ndim}, found ndim=${l}`);if(o.maxNDim!=null&&l>o.maxNDim)throw new X(`Input ${r} is incompatible with layer ${this.name}: expected max_ndim=${o.maxNDim}, found ndim=${l}`);if(o.minNDim!=null&&l<o.minNDim)throw new X(`Input ${r} is incompatible with layer ${this.name}: expected min_ndim=${o.minNDim}, found ndim=${l}.`);if(o.dtype!=null&&i.dtype!==o.dtype)throw new X(`Input ${r} is incompatible with layer ${this.name} : expected dtype=${o.dtype}, found dtype=${i.dtype}.`);if(o.axes){const u=i.shape;for(const h in o.axes){const d=Number(h),p=o.axes[h],m=d>=0?u[d]:u[u.length+d];if(p!=null&&[p,null].indexOf(m)===-1)throw new X(`Input ${r} is incompatible with layer ${this.name}: expected axis ${d} of input shape to have value ${p} but got shape ${u}.`)}}if(o.shape!=null)for(let u=0;u<o.shape.length;++u){const h=o.shape[u],d=i.shape[u];if(h!=null&&d!=null&&h!==d)throw new X(`Input ${r} is incompatible with layer ${this.name}: expected shape=${o.shape}, found shape=${i.shape}.`)}}}call(t,e){return t}invokeCallHook(t,e){this._callHook!=null&&this._callHook(t,e)}setCallHook(t){this._callHook=t}clearCallHook(){this._callHook=null}apply(t,e){e=e||{},this.assertNotDisposed();const s=Ve(t),r=xY(t),i=bY(t);if(r===i)throw new X("Arguments to apply() must be all SymbolicTensors or all Tensors");return Yl(this.name,()=>{if(!this.built){this.assertInputCompatibility(t);const o=[];for(const l of Ve(t))o.push(l.shape);this.build(Ks(o)),this.built=!0,this.initialWeights&&this.setWeights(this.initialWeights),this._refCount===null&&i&&(this._refCount=1)}if(this.assertInputCompatibility(t),i){let o=this.call(t,e);this.supportsMasking&&this.setMaskMetadata(t,o);const l=Ve(o),u=[];for(let h of l)s.indexOf(h)!==-1&&(h=h.clone()),u.push(h);if(o=Ks(u),this.activityRegularizer!=null)throw new re("Layer invocation in the presence of activity regularizer(s) is not supported yet.");return o}else{const o=gY(t),l=this.computeOutputShape(o);let u;const h=yY(t);if(this.warnOnIncompatibleInputShape(Array.isArray(t)?o[0]:o),l!=null&&l.length>0&&Array.isArray(l[0])?u=l.map((d,p)=>new Ji(h,d,this,Ve(t),e,this.name,p)):u=new Ji(h,l,this,Ve(t),e,this.name),this.addInboundNode(t,u,null,null,o,l,e),this._refCount++,this.activityRegularizer!=null)throw new re("Layer invocation in the presence of activity regularizer(s) is not supported yet.");return u}})}warnOnIncompatibleInputShape(t){if(this.batchInputShape!=null)if(t.length!==this.batchInputShape.length)console.warn(`The rank of the input tensor provided (shape: ${JSON.stringify(t)}) does not match that of the batchInputShape (${JSON.stringify(this.batchInputShape)}) of the layer ${this.name}`);else{let e=!1;this.batchInputShape.forEach((s,r)=>{s!=null&&t[r]!=null&&t[r]!==s&&(e=!0)}),e&&console.warn(`The shape of the input tensor (${JSON.stringify(t)}) does not match the expectation of layer ${this.name}: ${JSON.stringify(this.batchInputShape)}`)}}get outputShape(){if(this.inboundNodes==null||this.inboundNodes.length===0)throw new Mi(`The layer ${this.name} has never been called and thus has no defined output shape.`);const t=[];for(const e of this.inboundNodes){const s=JSON.stringify(e.outputShapes);t.indexOf(s)===-1&&t.push(s)}if(t.length===1){const e=this.inboundNodes[0].outputShapes;return Array.isArray(e)&&Array.isArray(e[0])&&e.length===1?e[0]:e}else throw new Mi(`The layer ${this.name} has multiple inbound nodes with different output shapes. Hence the notion of "output shape" is ill-defined for the layer.`)}countParams(){if(!this.built)throw new Wr(`You tried to call countParams() on ${this.name}, but the layer is not built yet. Build it first by calling build(batchInputShape).`);return $y(this.weights)}build(t){this.built=!0}getWeights(t=!1){return bw(t?this.trainableWeights:this.weights)}setWeights(t){ct(()=>{const e=this.weights;if(e.length!==t.length)throw new X(`You called setWeights(weights) on layer "${this.name}" with a weight list of length ${t.length}, but the layer was expecting ${e.length} weights. Provided weights: ${t}...`);if(e.length===0)return;const s=[],r=bw(e);for(let i=0;i<r.length;++i){const o=r[i],l=e[i],u=t[i];if(!Oe(o.shape,u.shape))throw new X(`Layer weight shape ${o.shape} not compatible with provided weight shape ${u.shape}`);s.push([l,u])}ST(s)})}addWeight(t,e,s,r,i,o,l,u){if(this._addedWeightNames.indexOf(t)!==-1)throw new X(`Duplicate weight name ${t} for layer ${this.name}`);this._addedWeightNames.push(t),s==null&&(s="float32"),this.fastWeightInitDuringBuild&&(r=u!=null?u():rn("zeros"));const h=r.apply(e,s),d=new dY(h,s,t,o,l);return h.dispose(),i!=null&&this.addLoss(()=>i.apply(d.read())),o==null&&(o=!0),o?this._trainableWeights.push(d):this._nonTrainableWeights.push(d),d}setFastWeightInitDuringBuild(t){this.fastWeightInitDuringBuild=t}addLoss(t){t==null||Array.isArray(t)&&t.length===0||(t=Ve(t),this._losses!==void 0&&this._losses!==null&&this.losses.push(...t))}computeOutputShape(t){return t}computeMask(t,e){if(!this.supportsMasking){if(e!=null)if(Array.isArray(e))e.forEach(s=>{if(s!=null)throw new TypeError(`Layer ${this.name} does not support masking, but was passed an inputMask.`)});else throw new TypeError(`Layer ${this.name} does not support masking, but was passed an inputMask.`);return null}return e}setMaskMetadata(t,e,s){if(!this.supportsMasking)return;const r=this.computeMask(t,s),i=Ve(e),o=Ve(r);if(i.length!==o.length)throw new Error(`${this.name} outputs ${i.length} tensors but ${i.length} masks for those tensors`);for(let l=0;l<i.length;l++)i[l].kerasMask=o[l]}addInboundNode(t,e,s,r,i,o,l=null){const u=Ve(t);e=Ve(e),s=Ve(s),r=Ve(r),i=Ry(i),o=Ry(o);const h=[],d=[],p=[];for(const m of u)h.push(m.sourceLayer),d.push(m.nodeIndex),p.push(m.tensorIndex);new _x({outboundLayer:this,inboundLayers:h,nodeIndices:d,tensorIndices:p,inputTensors:u,outputTensors:e,inputMasks:s,outputMasks:r,inputShapes:i,outputShapes:o},l);for(let m=0;m<e.length;m++)e[m].sourceLayer=this,e[m].nodeIndex=this.inboundNodes.length-1,e[m].tensorIndex=m}getConfig(){const t={name:this.name,trainable:this.trainable};return this.batchInputShape!=null&&(t.batchInputShape=this.batchInputShape),this.dtype!=null&&(t.dtype=this.dtype),t}disposeWeights(){return this.weights.forEach(t=>t.dispose()),this.weights.length}assertNotDisposed(){if(this._refCount===0)throw new Error(`Layer '${this.name}' is already disposed.`)}dispose(){if(!this.built)throw new Error(`Cannot dispose Layer ${this.name} because it has not been built yet.`);if(this._refCount===null)throw new Error(`Cannot dispose Layer ${this.name} because it has not been used yet.`);this.assertNotDisposed();let t=0;return--this._refCount===0&&(t=this.disposeWeights()),{refCountAfterDispose:this._refCount,numDisposedVariables:t}}}function gY(n){n=Ve(n);const t=[];for(const e of n)t.push(e.shape);return Ks(t)}function yY(n){return"float32"}function hM(n,t,e){if((t==null||e!=null&&e>0)&&(t=n.sourceLayer,e=n.nodeIndex),t.inboundNodes.length===0)return[n];{const s=t.inboundNodes[e];if(s.inboundLayers.length===0)return s.inputTensors;{const r=[];for(let i=0;i<s.inboundLayers.length;i++){const o=s.inputTensors[i],l=s.inboundLayers[i],u=s.nodeIndices[i],h=hM(o,l,u);for(const d of h)r.indexOf(d)===-1&&r.push(d)}return r}}}function xY(n){let t=!0;for(const e of Ve(n))if(!(e instanceof Ji)){t=!1;break}return t}function bY(n){let t=!0;for(const e of Ve(n))if(e instanceof Ji){t=!1;break}return t}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */class Bp extends ue{constructor(t){if(super({dtype:t.dtype,name:t.name!=null?t.name:Ex("input").toString()}),t.batchSize==null&&(t.batchSize=null),t.sparse==null&&(t.sparse=!1),this.trainable=!1,this.built=!0,this.sparse=t.sparse,t.inputShape!=null&&t.batchInputShape!=null)throw new X("Only provide the inputShape OR batchInputShape argument to inputLayer, not both at the same time.");let e=t.batchInputShape;if(e==null){if(t.inputShape==null)throw new X("An InputLayer should be passed either a `batchInputShape` or an `inputShape`.");e=[t.batchSize].concat(t.inputShape)}else if(t.batchSize!=null)throw new X("Cannot specify batchSize if batchInputShape is specified when creating an InputLayer.");const s=t.dtype||"float32";this.batchInputShape=e,this.dtype=s,this.inputSpec=[{shape:e}];const r=new Ji(this.dtype,this.batchInputShape,this,[],{},this.name);r.nodeIndex=0,r.tensorIndex=0,new _x({outboundLayer:this,inboundLayers:[],nodeIndices:[],tensorIndices:[],inputTensors:[r],outputTensors:[r],inputMasks:[null],outputMasks:[null],inputShapes:[e],outputShapes:[e]})}apply(t,e){throw new X(`Cannot pass any input to an InputLayer's apply() method. InputLayer name: ${this.name}`)}dispose(){return{refCountAfterDispose:this._refCount,numDisposedVariables:0}}getConfig(){return{batchInputShape:this.batchInputShape,dtype:this.dtype,sparse:this.sparse,name:this.name}}}Bp.className="InputLayer";It(Bp);function vY(n){if(n.batchShape==null&&n.shape==null)throw new Error("Please provide to Input either a `shape` or a `batchShape` argument. Note that `shape` does not include the batch dimension.");if(n.batchShape!=null&&n.shape!=null)throw new X("Please provide either a `shape` or `batchShape` argument to Input, but not both.");let t=n.batchShape;n.shape!=null&&t==null&&(t=[null].concat(n.shape));let e=n.dtype;return e==null&&(e="float32"),new Bp({batchInputShape:t,name:n.name,dtype:e,sparse:n.sparse}).inboundNodes[0].outputTensors[0]}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function wY(n,t){if(n.dtype==null||n.dtype===t.dtype)return t;try{return Ot(t,n.dtype)}catch{throw new X(`The dtype of the feed (${t.dtype}) can not be cast to the dtype of the key '${n.name}' (${n.dtype}).`)}}class _a{constructor(t){if(this.id2Value={},this.id2Mask={},this.name2Id={},t instanceof _a)for(const e in t.id2Value)this.id2Value[e]=t.id2Value[e],e in t.id2Mask&&(this.id2Mask[e]=t.id2Mask[e]);else{if(t==null)return;for(const e of t)this.add(e.key,e.value)}}add(t,e,s){if(this.id2Value[t.id]==null)this.id2Value[t.id]=wY(t,e),this.name2Id[t.name]=t.id,s!=null&&(this.id2Mask[t.id]=s);else throw new X(`Duplicate key: name=${t.name}, id=${t.id}`);return this}addFeed(t){this.add(t.key,t.value)}hasKey(t){return this.id2Value[t.id]!=null}names(){return Object.keys(this.name2Id)}getValue(t){if(t instanceof Ji){if(this.id2Value[t.id]==null)throw new X(`Nonexistent key: ${t.name}`);return this.id2Value[t.id]}else{const e=this.name2Id[t];if(e==null)throw new X(`Feed dict has no SymbolicTensor name: ${t}`);return this.id2Value[e]}}getMask(t){if(t instanceof Ji){if(this.id2Value[t.id]==null)throw new X(`Nonexistent key: ${t.name}`);return this.id2Mask[t.id]}else{const e=this.name2Id[t];if(e==null)throw new X(`Feed dict has no SymbolicTensor name: ${t}`);return this.id2Mask[e]}}disposeMasks(){this.id2Mask!=null&&oe(this.id2Mask)}}const Dy=new KO,Oy=new KO;function CY(n){Dy!=null&&Dy.setMaxEntries(n),Oy!=null&&Oy.setMaxEntries(n)}function Ud(n,t,e,s){const r=e==null?!1:e.training,i=Array.isArray(n),o=i?n:[n],l=o.map(x=>x.name),u=[],h=t.names();for(const x of l)h.indexOf(x)!==-1?u.push(t.getValue(x)):u.push(null);const d=l.join(",")+"|"+t.names().sort().join(",");let p=Dy.get(d),m;if(p==null){const x=SY(o,t);p=x.sorted,m=x.recipientCounts,Dy.put(d,p),Oy.put(d,m)}m={},r||Object.assign(m,Oy.get(d));const y=new _a(t);for(let x=0;x<p.length;++x){const v=p[x],C=v.sourceLayer;if(C instanceof Bp)continue;const S=[],E=[],_=[];let I=!1;for(const R of v.inputs){const $=y.getValue(R),A=y.getMask(R);S.push($),E.push(A),A!=null&&(I=!0),r||(m[R.name]--,m[R.name]===0&&!t.hasKey(R)&&l.indexOf(R.name)===-1&&!$.isDisposed&&R.sourceLayer.stateful!==!0&&_.push($))}I&&(e=e||{},e.mask=E[0]);const O=Ve(C.apply(S,e));let P=null;C.supportsMasking&&(P=C.computeMask(S,E));const D=EY(v),N=Array.isArray(D)?D:[D];for(let R=0;R<N.length;++R){y.hasKey(N[R])||y.add(N[R],O[R],Array.isArray(P)?P[0]:P);const $=l.indexOf(N[R].name);$!==-1&&(u[$]=O[R])}r||oe(_)}return y.disposeMasks(),i?u:u[0]}function SY(n,t){U(n!=null&&n.length>0,()=>"Expected at least one fetch, got none");let e=[],s={};if(n.length===1){const r=SA(n[0],t);e=r.sorted,s=r.recipientMap}else{const r=new Set;for(const i of n){const{sorted:o,recipientMap:l}=SA(i,t);for(const u of o)r.has(u.name)||(e.push(u),r.add(u.name));for(const u in l)s[u]==null&&(s[u]=new Set),l[u].forEach(h=>s[u].add(h))}}return{sorted:e,recipientCounts:TY(s)}}function TY(n){const t={};for(const e in n)t[e]=n[e].size;return t}function SA(n,t){const e=new Set,s=[],r={};for(const l of t.names())e.add(l);const i=[],o=[];for(i.push(n);i.length>0;){const l=i[i.length-1];if(e.has(l.name)){i.pop();continue}const u=o[o.length-1]===i.length-1;if(l.inputs.length===0||u)i.pop(),s.push(l),e.add(l.name),u&&o.pop();else{o.push(i.length-1);for(const h of l.inputs)r[h.name]==null&&(r[h.name]=new Set),r[h.name].add(l.name),!e.has(h.name)&&i.push(h)}}return{sorted:s,recipientMap:r}}function EY(n){let t;if(n.sourceLayer.inboundNodes.length===1)t=n.sourceLayer.output;else{let e=null;for(let s=0;s<n.sourceLayer.inboundNodes.length;++s)for(const r of n.sourceLayer.inboundNodes[s].outputTensors)if(r.id===n.id){e=s;break}t=n.sourceLayer.getOutputAt(e)}return t}/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const IY=dt();IY.registerFlag("TOPOLOGICAL_SORT_CACHE_MAX_ENTRIES",()=>100,CY);/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function TT(n,t){return ct(()=>Es(Gt(J(n,n),t,!0)))}class Up extends ph{getConfig(){return{}}}class dM extends Up{constructor(t){super(),this.defaultMaxValue=2,this.defaultAxis=0,this.maxValue=t.maxValue!=null?t.maxValue:this.defaultMaxValue,this.axis=t.axis!=null?t.axis:this.defaultAxis}apply(t){return ct(()=>{const e=TT(t,this.axis),s=Sr(e,0,this.maxValue);return J(t,Wt(s,kt(Ln(),e)))})}getConfig(){return{maxValue:this.maxValue,axis:this.axis}}}dM.className="MaxNorm";It(dM);class fM extends Up{constructor(t){super(),this.defaultAxis=0,this.axis=t.axis!=null?t.axis:this.defaultAxis}apply(t){return ct(()=>Wt(t,kt(Ln(),TT(t,this.axis))))}getConfig(){return{axis:this.axis}}}fM.className="UnitNorm";It(fM);class pM extends Up{apply(t){return Cu(t)}}pM.className="NonNeg";It(pM);class mM extends Up{constructor(t){super(),this.defaultMinValue=0,this.defaultMaxValue=1,this.defaultRate=1,this.defaultAxis=0,this.minValue=t.minValue!=null?t.minValue:this.defaultMinValue,this.maxValue=t.maxValue!=null?t.maxValue:this.defaultMaxValue,this.rate=t.rate!=null?t.rate:this.defaultRate,this.axis=t.axis!=null?t.axis:this.defaultAxis}apply(t){return ct(()=>{const e=TT(t,this.axis),s=kt(J(this.rate,Sr(e,this.minValue,this.maxValue)),J(1-this.rate,e));return J(t,Wt(s,kt(Ln(),e)))})}getConfig(){return{minValue:this.minValue,maxValue:this.maxValue,rate:this.rate,axis:this.axis}}}mM.className="MinMaxNorm";It(mM);const TA={maxNorm:"MaxNorm",minMaxNorm:"MinMaxNorm",nonNeg:"NonNeg",unitNorm:"UnitNorm"};function Vn(n){return fT(n)}function EA(n,t={}){return Lp(n,Gr.getMap().classNameMap,t,"constraint")}function zn(n){if(n==null)return null;if(typeof n=="string"){const e={className:n in TA?TA[n]:n,config:{}};return EA(e)}else return n instanceof Up?n:EA(n)}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */async function Vl(n){if(n==null)return;const t=[],e=[],s=[];for(const r in n){const i=n[r];if(typeof i!="number"){const o=i;t.push(o.data()),e.push(r),s.push(o)}}if(t.length>0){const r=await Promise.all(t);for(let i=0;i<r.length;++i)n[e[i]]=r[i][0];oe(s)}}function gM(n){if(n!=null)for(const t in n){const e=n[t];typeof e!="number"&&e.dispose()}}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */var IA;(function(n){n[n.SILENT=0]="SILENT",n[n.VERBOSE=1]="VERBOSE"})(IA||(IA={}));const _Y=125;class gf{constructor(){this.validationData=null}setParams(t){this.params=t}async onEpochBegin(t,e){}async onEpochEnd(t,e){}async onBatchBegin(t,e){}async onBatchEnd(t,e){}async onTrainBegin(t){}async onTrainEnd(t){}setModel(t){}}class kY{constructor(t,e=10){t==null&&(t=[]),this.callbacks=t,this.queueLength=e}append(t){this.callbacks.push(t)}setParams(t){for(const e of this.callbacks)e.setParams(t)}setModel(t){for(const e of this.callbacks)e.setModel(t)}async onEpochBegin(t,e){e==null&&(e={});for(const s of this.callbacks)await s.onEpochBegin(t,e)}async onEpochEnd(t,e){e==null&&(e={});for(const s of this.callbacks)await s.onEpochEnd(t,e)}async onBatchBegin(t,e){e==null&&(e={});for(const s of this.callbacks)await s.onBatchBegin(t,e)}async onBatchEnd(t,e){e==null&&(e={});for(const s of this.callbacks)await s.onBatchEnd(t,e)}async onTrainBegin(t){t==null&&(t={});for(const e of this.callbacks)await e.onTrainBegin(t)}async onTrainEnd(t){t==null&&(t={});for(const e of this.callbacks)await e.onTrainEnd(t)}}class AY extends gf{constructor(){super()}async onEpochBegin(t){this.seen=0,this.totals={}}async onBatchEnd(t,e){e==null&&(e={});const s=e.size==null?0:e.size;this.seen+=s;for(const r in e){const i=e[r];if(typeof i=="number")this.totals.hasOwnProperty(r)||(this.totals[r]=0),this.totals[r]=this.totals[r]+i*s;else{let o;r in this.totals?o=this.totals[r]:this.totals[r]=0;const l=ct(()=>kt(this.totals[r],J(i,s)));this.totals[r]=l,o!=null&&o.dispose()}}}async onEpochEnd(t,e){if(e!=null)for(const s of this.params.metrics)this.totals[s]!=null&&(typeof this.totals[s]=="number"?e[s]=this.totals[s]/this.seen:ct(()=>{const r=J(Wt(1,this.seen),this.totals[s]);e[s]=r,this.totals[s].dispose(),Ui(e[s])}))}}class NY extends gf{async onTrainBegin(t){this.epoch=[],this.history={}}async onEpochEnd(t,e){e==null&&(e={}),this.epoch.push(t);for(const s in e)this.history[s]==null&&(this.history[s]=[]),this.history[s].push(e[s])}async syncData(){const t=[],e=[],s=[];for(const i in this.history){const o=this.history[i];for(let l=0;l<o.length;++l)if(typeof o[l]!="number"){const u=o[l];t.push(u.data()),e.push(i),s.push(l)}}const r=await Promise.all(t);for(let i=0;i<r.length;++i)this.history[e[i]][s[i]].dispose(),this.history[e[i]][s[i]]=r[i][0]}}class RY extends gf{constructor(t,e){if(super(),this.currentEpoch=0,this.nowFunc=t.nowFunc,this.nextFrameFunc=t.nextFrameFunc||wO,this.yieldEvery=e||"auto",this.yieldEvery==="auto"&&(this.yieldEvery=_Y),this.yieldEvery==="never"&&t.onYield!=null)throw new Error("yieldEvery is `never` but you provided an `onYield` callback. Either change `yieldEvery` or remove the callback");jv(this.yieldEvery)&&(this.maybeWait=WX(this.maybeWait.bind(this),this.yieldEvery,this.nowFunc)),this.trainBegin=t.onTrainBegin,this.trainEnd=t.onTrainEnd,this.epochBegin=t.onEpochBegin,this.epochEnd=t.onEpochEnd,this.batchBegin=t.onBatchBegin,this.batchEnd=t.onBatchEnd,this.yield=t.onYield}async maybeWait(t,e,s){const r=[];this.yield!=null&&(await Vl(s),r.push(this.yield(t,e,s))),r.push(this.nextFrameFunc()),await Promise.all(r)}async onEpochBegin(t,e){this.currentEpoch=t,this.epochBegin!=null&&(await Vl(e),await this.epochBegin(t,e))}async onEpochEnd(t,e){const s=[];this.epochEnd!=null&&(await Vl(e),s.push(this.epochEnd(t,e))),this.yieldEvery==="epoch"&&s.push(this.nextFrameFunc()),await Promise.all(s)}async onBatchBegin(t,e){this.batchBegin!=null&&(await Vl(e),await this.batchBegin(t,e))}async onBatchEnd(t,e){const s=[];this.batchEnd!=null&&(await Vl(e),s.push(this.batchEnd(t,e))),this.yieldEvery==="batch"?s.push(this.nextFrameFunc()):jv(this.yieldEvery)&&s.push(this.maybeWait(this.currentEpoch,t,e)),await Promise.all(s)}async onTrainBegin(t){this.trainBegin!=null&&(await Vl(t),await this.trainBegin(t))}async onTrainEnd(t){this.trainEnd!=null&&(await Vl(t),await this.trainEnd(t))}}function yM(n,t){return n==null&&(n={}),n instanceof gf?[n]:Array.isArray(n)&&n[0]instanceof gf?n:Ve(n).map(s=>new RY(s,t))}class Br{constructor(){}static registerCallbackConstructor(t,e){U(t>=0&&Number.isInteger(t),()=>`Verbosity level is expected to be an integer >= 0, but got ${t}`),Br.checkForDuplicate(e),Br.constructors[t]==null&&(Br.constructors[t]=[]),Br.constructors[t].push(e)}static checkForDuplicate(t){for(const e in Br.constructors)Br.constructors[+e].forEach(r=>{if(r===t)throw new X("Duplicate callback constructor.")})}static clear(){Br.constructors={}}static createCallbacks(t){const e=[];for(const s in Br.constructors){const r=+s;t>=r&&e.push(...Br.constructors[r])}return e.map(s=>new s)}}Br.constructors={};function xM(n,t,e,s,r,i,o,l,u){const h=new NY,d=[new AY,...Br.createCallbacks(t)];n!=null&&d.push(...n),d.push(h);const p=new kY(d);return p.setParams({epochs:e,initialEpoch:s,samples:r,steps:i,batchSize:o,verbose:t,doValidation:l,metrics:u}),{callbackList:p,history:h}}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function qi(n,t={},e=!1){return Lp(n,Gr.getMap().classNameMap,t,"layer",e)}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function My(n,t){return ct(()=>{n.dtype!=="float32"&&(n=Ot(n,"float32"));const e=Gt(Vp(n),t,!0),s=yx(e.shape,Ln()),r=Es(el(e,s));return Wt(n,r)})}function kx(n,t){return ct(()=>An(Vp(Yt(t,n)),-1))}function ET(n,t){return ct(()=>An(Os(Yt(t,n)),-1))}function IT(n,t){return ct(()=>{const e=Yt(n,t),s=Sr(Os(n),Ln(),Number.MAX_VALUE),r=Os(Wt(e,s));return J(100,An(r,-1))})}function $Y(n,t){return ct(()=>{const e=Sr(t,Ln(),Number.MAX_VALUE),s=Zi(kt(1,e)),r=Sr(n,Ln(),Number.MAX_VALUE),i=Zi(kt(1,r));return An(Vp(Yt(s,i)),-1)})}function DY(n,t){return ct(()=>{const e=el(0,Yt(1,J(n,t)));return An(Vp(e),-1)})}function OY(n,t){return ct(()=>{const e=el(0,Yt(1,J(n,t)));return An(e,-1)})}function MY(n,t){return ct(()=>{const e=Gt(J(n,t),-1),s=ci(J(Yt(1,n),t),-1);return el(0,kt(1,Yt(s,e)))})}function FY(n,t){return ct(()=>{const e=Math.log(2),s=Yt(t,n),r=Yt(kt(s,Np(J(-2,s))),e);return An(r,-1)})}function yf(n,t,e=!1){return ct(()=>{if(e)t=AS(t);else{const s=Gt(t,t.shape.length-1,!0);t=Wt(t,s)}return t=Sr(t,Ln(),1-Ln()),vn(Gt(J(Ot(n,"float32"),Zi(t)),t.shape.length-1))})}function Fy(n,t,e=!1){return ct(()=>{const s=Ot(vx(nY(n)),"int32");t=Sr(t,Ln(),1-Ln());const r=t.shape,i=rt(UD(s,r[r.length-1]),r);return yf(i,t,e)})}function LY(n,t){if(!Oe(n.shape,t.shape))throw new X(`logits and labels must have the same shape, but got shapes ${JSON.stringify(n.shape)} and ${JSON.stringify(t.shape)}`);return ct(()=>{const e=Cu(t),s=vn(Os(t));return kt(Yt(e,J(t,n)),PD(Qi(s)))})}function Ax(n,t){return ct(()=>{let e;return e=Sr(t,Ln(),1-Ln()),e=Zi(Wt(e,Yt(1,e))),An(LY(n,e),-1)})}function PY(n,t){return ct(()=>{const e=Sr(n,Ln(),1),s=Sr(t,Ln(),1);return Gt(J(n,Zi(Wt(e,s))),-1)})}function VY(n,t){return ct(()=>{const e=Zi(kt(Ln(),t));return An(Yt(t,J(n,e)),-1)})}function bM(n,t){return ct(()=>{const e=My(n,-1),s=My(t,-1),r=J(e,s);return vn(Gt(r,-1))})}const Ly={meanSquaredError:kx,meanAbsoluteError:ET,meanAbsolutePercentageError:IT,meanSquaredLogarithmicError:$Y,squaredHinge:DY,hinge:OY,categoricalHinge:MY,logcosh:FY,categoricalCrossentropy:yf,sparseCategoricalCrossentropy:Fy,binaryCrossentropy:Ax,kullbackLeiblerDivergence:PY,poisson:VY,cosineProximity:bM};function hv(n){if(typeof n=="string"){if(n in Ly)return Ly[n];let t=`Unknown loss ${n}`;throw n.toLowerCase().includes("softmaxcrossentropy")&&(t=`Unknown loss ${n}. Use "categoricalCrossentropy" as the string name for tf.losses.softmaxCrossEntropy`),new X(t)}else return n}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function vM(n,t){return ct(()=>{const e=J(.5,jr(t)),s=Wi(Tr(t,e),n.dtype);return An(Yi(n,s),-1)})}function wM(n,t){return ct(()=>Wi(Yi(hf(n,-1),hf(t,-1)),"float32"))}function zY(n,t){return ct(()=>Ot(Gt(zo(Yi(n,1),Yi(t,1))),"float32"))}function BY(n,t){return ct(()=>Ot(Gt(zo(Yi(n,0),Yi(t,1))),"float32"))}function UY(n,t){return ct(()=>{const e=zY(n,t),s=BY(n,t),r=kt(e,s);return Ot(Ps(Tr(r,0),Wt(e,r),0),"float32")})}function GY(n,t){return Ax(n,t)}function WY(n,t){return n.rank===t.rank&&(n=$p(n,[n.rank-1])),t=hf(t,-1),t.dtype!==n.dtype&&(t=Ot(t,n.dtype)),Ot(Yi(n,t),"float32")}const HY=kx,qY=kx,jY=ET,KY=ET,XY=IT,YY=IT,CM=yf,QY=bM,SM=Fy,Py={binaryAccuracy:vM,categoricalAccuracy:wM,precision:UY,categoricalCrossentropy:CM,sparseCategoricalCrossentropy:SM,mse:HY,MSE:qY,mae:jY,MAE:KY,mape:XY,MAPE:YY,cosine:QY};function ZY(n){if(typeof n=="string"&&n in Py)return Py[n];if(typeof n!="string"&&n!=null)return n;throw new X(`Unknown metric ${n}`)}function Ag(n){if(Fi(n!==null,`Unknown LossOrMetricFn ${n}`),typeof n=="string")return n;{let t;for(const e of Object.keys(Ly))if(Ly[e]===n){t=e;break}if(t!==void 0)return t;for(const e of Object.keys(Py))if(Py[e]===n){t=e;break}return t!==void 0?t:n.name}}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function JY(n){const t={Adagrad:()=>vc.adagrad(.01),Adadelta:()=>vc.adadelta(1,.95,Ln()),Adam:()=>vc.adam(.001,.9,.999,Ln()),Adamax:()=>vc.adamax(.002,.9,.999,Ln(),0),RMSProp:()=>vc.rmsprop(.001,.9,0,Ln()),SGD:()=>vc.sgd(.01)};if(t.adagrad=t.Adagrad,t.adadelta=t.Adadelta,t.adam=t.Adam,t.adamax=t.Adamax,t.rmsprop=t.RMSProp,t.sgd=t.SGD,n in t)return t[n]();throw new X(`Unknown Optimizer ${n}`)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */const _A=1*1024*1024;function kA(n,t,e=!1){if(n==null||typeof n!="object"||Object.getPrototypeOf(n)!==Object.prototype||!vw(n))throw new Error("User-defined metadata is expected to be a JSON object, but is not.");if(e){const s=JSON.stringify(n);s.length>_A&&console.warn(`User-defined metadata of model "${t}" is too large in size (length=${s.length} when serialized). It is not recommended to store such large objects in user-defined metadata. Please make sure its serialized length is <= ${_A}.`)}}function vw(n){if(n===null)return!0;if(typeof n=="object")if(Object.getPrototypeOf(n)===Object.prototype){const t=Object.keys(n);for(const e of t)if(typeof e!="string"||!vw(n[e]))return!1;return!0}else if(Array.isArray(n)){for(const t of n)if(!vw(t))return!1;return!0}else return!1;else{const t=typeof n;return t==="string"||t==="number"||t==="boolean"}}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function tQ(n,t,e,s=console.log){const r=nQ(n),i=["Layer (type)","Input Shape","Output shape","Param #"];r?(t=t||90,e=e||[.32,.61,.89,1]):(t=t||115,e=e||[.24,.48,.7,.8,1]),e[e.length-1]<=1&&(e=e.map(d=>Math.floor(t*d)));let o;if(!r){i.push("Receives inputs"),o=[];for(const d in n.nodesByDepth)o.push(...n.nodesByDepth[d])}s("_".repeat(t)),Vy(i,e,s),s("=".repeat(t));const l=n.layers;for(let d=0;d<l.length;++d)r?sQ(l[d],e,s):rQ(l[d],e,o,s),s((d===l.length-1?"=":"_").repeat(t));n.checkTrainableWeightsConsistency();const u=eQ(n),h=$y(n.nonTrainableWeights);s(`Total params: ${u+h}`),s(`Trainable params: ${u}`),s(`Non-trainable params: ${h}`),s("_".repeat(t))}function eQ(n){let t;return n.collectedTrainableWeights!=null?t=$y(n.collectedTrainableWeights):t=$y(n.trainableWeights),t}function nQ(n){let t=!0;const e=[],s=[];for(const r in n.nodesByDepth)e.push(n.nodesByDepth[r]);for(const r of e){if(r.length>1||r.length===1&&r[0].inboundLayers.length>1){t=!1;break}s.push(...r)}if(t)for(const r of n.layers){let i=!1;for(const o of r.inboundNodes)if(s.indexOf(o)!==-1)if(i){t=!1;break}else i=!0;if(!t)break}return t}function Vy(n,t,e=console.log){let s="";for(let r=0;r<n.length;++r)r>0&&(s=s.slice(0,s.length-1)+" "),s+=n[r],s=s.slice(0,t[r]),s+=" ".repeat(t[r]-s.length);e(s)}function sQ(n,t,e){let s,r;try{r=n.inboundNodes.map(u=>JSON.stringify(u.inputShapes)).join(",")}catch{r="multiple"}try{s=JSON.stringify(n.outputShape)}catch{s="multiple"}const i=n.name,o=n.getClassName(),l=[`${i} (${o})`,r,s,n.countParams().toString()];Vy(l,t,e)}function rQ(n,t,e,s){let r,i;try{i=n.inboundNodes.map(p=>JSON.stringify(p.inputShapes)).join(",")}catch{i="multiple"}try{r=JSON.stringify(n.outputShape)}catch{r="multiple"}const o=[];for(const p of n.inboundNodes)if(!(e!=null&&e.length>0&&e.indexOf(p)===-1))for(let m=0;m<p.inboundLayers.length;++m){const y=p.inboundLayers[m].name,x=p.nodeIndices[m],v=p.tensorIndices[m];o.push(`${y}[${x}][${v}]`)}const l=n.name,u=n.getClassName(),h=o.length===0?"":o[0],d=[`${l} (${u})`,i,r,n.countParams().toString(),h];Vy(d,t,s);for(let p=1;p<o.length;++p)Vy(["","","","",o[p]],t,s)}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function TM(n,t,e){return(n==="inboundNodes"||n==="outputLayers"||n==="inputLayers")&&t===0&&typeof e=="string"}function zy(n,t){if(n===null)return null;if(typeof n=="string")return Wl(n);if(typeof n=="number"||typeof n=="boolean")return n;if(n instanceof Array){const e=[],s=n.length;for(let r=0;r<s;++r){const i=n[r];TM(t,r,i)?e.push(i):e.push(zy(i,t))}return e}else{const e={};for(const s of Object.keys(n)){const r=n[s];if(s==="name"&&typeof r=="string")e[s]=r;else{const i=Wl(s);e[i]=zy(r,i)}}return e}}function ww(n,t){if(n==null)return null;if(typeof n=="string")return Ro(n);if(typeof n=="number"||typeof n=="boolean")return n;if(n instanceof Array){const e=[],s=n.length;for(let r=0;r<s;++r){const i=n[r];TM(t,r,i)?e.push(i):e.push(ww(i,t))}return e}else{const e={};for(const s of Object.keys(n)){const r=n[s],i=Ro(s);(s==="name"||s==="className")&&typeof r=="string"?e[i]=r:e[i]=ww(r,s)}return e}}/** @license See the LICENSE file. */const EM="4.22.0";/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */const iQ=n=>{const t=Object.keys(n);if(t.length===0)return!1;const e=t[0].split("/");return!isNaN(parseInt(e[e.length-1],10))};class si extends ue{constructor(t){if(super({}),this.containerNodes=new Set,this.name=t.name,this.name==null){const E=this.getClassName().toLowerCase();this.name=Ex(E)}if(this.supportsMasking=!1,this.trainable_=!0,Array.isArray(t.inputs)?this.inputs=t.inputs.slice():this.inputs=[t.inputs],Array.isArray(t.outputs)?this.outputs=t.outputs.slice():this.outputs=[t.outputs],Fa(this.inputs).length!==this.inputs.length)throw new X(`The list of inputs passed to the model is redundant. All inputs should only appear once. Found: ${this.inputs.map(E=>E.name)}`);Fa(this.outputs).length!==this.outputs.length&&console.warn(`The list of outputs passed to the model is redundant. All outputs should only appear once. Found: ${this.outputs.map(E=>E.name)}`),this.inputLayers=[],this.inputLayersNodeIndices=[],this.inputLayersTensorIndices=[],this.outputLayers=[],this.outputLayersNodeIndices=[],this.outputLayersTensorIndices=[],this.layers=[],this.internalContainerRefs=[];for(const E of this.outputs){const _=E.sourceLayer,I=E.nodeIndex,O=E.tensorIndex;this.outputLayers.push(_),this.outputLayersNodeIndices.push(I),this.outputLayersTensorIndices.push(O)}for(const E of this.inputs){const _=E.sourceLayer,I=E.nodeIndex,O=E.tensorIndex;Fi(I===0,"input layer has >1 nodes"),Fi(O===0,"input layer has >1 tensors"),this.inputLayers.push(_),this.inputLayersNodeIndices.push(I),this.inputLayersTensorIndices.push(O)}this.inputNames=[],this.outputNames=[],this.feedInputShapes=[],this.feedInputNames=[],this.feedOutputNames=[];for(let E=0;E<this.inputLayers.length;E++){const _=this.inputLayers[E];if(!(_ instanceof Bp))throw new TypeError(`Input layers to a LayersModel must be InputLayer objects. Received inputs: ${t.inputs}. Input ${E} (0-based) originates from layer type ${_.getClassName()}.`);this.inputNames.push(_.name),this.feedInputShapes.push(_.batchInputShape),this.feedInputNames.push(_.name)}for(const E of this.outputLayers)this.outputNames.push(E.name);this.internalInputShapes=this.inputs.map(E=>E.shape),this.internalOutputShapes=this.outputs.map(E=>E.shape);const e={},s={},r={},i={},o={},l=[],u=(E,_,I,O,P,D)=>{(O==null||P==null||D==null)&&(O=E.sourceLayer,P=E.nodeIndex,D=E.tensorIndex);const N=O.inboundNodes[P];if(I.indexOf(N)!==-1)throw new Wr(`The tensor ${E.name} at layer "${O.name}" is part of a cycle.`);if(_.indexOf(N)!==-1)return;this.containerNodes.add(si.nodeKey(O,P)),O.id in o||(o[O.id]=Object.keys(o).length),I.indexOf(N)===-1&&I.push(N);const R=N.inboundLayers.length;for(let $=0;$<R;$++){const A=N.inputTensors[$],V=N.inboundLayers[$],L=N.nodeIndices[$],nt=N.tensorIndices[$];u(A,_,I,V,L,nt)}for(_.push(N);I.indexOf(N)>=0;)I.splice(I.indexOf(N),1);l.push(N)},h=[],d=[];for(const E of this.outputs)u(E,h,d);const p=l.slice().reverse();for(const E of p){s[E.id]=E,E.id in e||(e[E.id]=0);let _=e[E.id];const I=r[E.outboundLayer.id]==null?0:r[E.outboundLayer.id];_=Math.max(_,I),r[E.outboundLayer.id]=_,i[E.outboundLayer.id]=E.outboundLayer,e[E.id]=_;for(let O=0;O<E.inboundLayers.length;O++){const P=E.inboundLayers[O],D=E.nodeIndices[O],N=P.inboundNodes[D],R=e[N.id]==null?0:e[N.id];e[N.id]=Math.max(_+1,R),s[N.id]=N}}const m={};for(const E in e){const _=e[E];_ in m||(m[_]=[]),m[_].push(s[E])}const y={};for(const E in r){const _=r[E];_ in y||(y[_]=[]),y[_].push(i[E])}let x=Object.keys(y).map(E=>parseInt(E,10)).sort(Ig);this.layers=[];for(const E of x){const _=y[E];_.sort((I,O)=>{const P=o[I.id],D=o[O.id];return P<D?-1:P>D?1:0});for(const I of _)I instanceof si&&this.internalContainerRefs.push(I),this.layers.push(I)}this.layersByDepth=y,x=Object.keys(m).map(E=>parseInt(E,10)).sort(Ig);const v=this.inputs.slice(),C=[];for(const E of x)for(const _ of m[E]){const I=_.outboundLayer;if(I!=null){for(const O of _.inputTensors)if(v.indexOf(O)===-1)throw new Wr(`Graph disconnected: cannot obtain value for tensor ${O} at layer "${I.name}". The following previous layers were accessed without issue: ${C}`);for(const O of _.outputTensors)v.push(O);C.push(I.name)}}this.nodesByDepth=m;const S=this.layers.map(E=>E.name);for(const E of S){const _=S.filter(I=>I===E).length;if(_!==1)throw new Wr(`The name "${E}" is used ${_} times in the model. All layer names should be unique. Layer names: `+JSON.stringify(S))}this.outboundNodes=[],this.inboundNodes=[],new _x({outboundLayer:this,inboundLayers:[],nodeIndices:[],tensorIndices:[],inputTensors:this.inputs,outputTensors:this.outputs,inputMasks:this.inputs.map(E=>null),outputMasks:this.outputs.map(E=>null),inputShapes:this.inputs.map(E=>E.shape),outputShapes:this.outputs.map(E=>E.shape)}),this.built=!0,this._refCount=1}assertNotDisposed(){if(this._refCount===0)throw new Error(`Container '${this.name}' is already disposed.`)}dispose(){this.assertNotDisposed();const t={refCountAfterDispose:null,numDisposedVariables:0};if(--this._refCount===0){for(const e of this.layers)t.numDisposedVariables+=e.dispose().numDisposedVariables;for(const e of this.internalContainerRefs)t.numDisposedVariables+=e.dispose().numDisposedVariables}return t.refCountAfterDispose=this._refCount,t}get trainable(){return this.trainable_}set trainable(t){this.layers.forEach(e=>{e._trainableWeights.forEach(s=>s.trainable=t)}),this.trainable_=t}get trainableWeights(){if(this._trainableWeights.length>0)throw new X("Container instance unexpectedly contains _trainableWeights.The trainable weights of a Container are a union of the trainable weights of its consituent Layers. Its own _trainableWeights must remain an empty Array.");if(!this.trainable)return[];let t=[];for(const e of this.layers)t=t.concat(e.trainableWeights);return t}get nonTrainableWeights(){const t=[];for(const e of this.layers)t.push(...e.nonTrainableWeights);if(!this.trainable){const e=[];for(const s of this.layers)e.push(...s.trainableWeights);return e.concat(t)}return t}get weights(){return this.trainableWeights.concat(this.nonTrainableWeights)}loadWeights(t,e=!0){const s={};let r=0;const i=iQ(t);i&&this.parseWeights(t);for(const l of this.layers)for(const[u,h]of l.weights.entries()){const d=i?`${h.name.split("/").slice(0,-1).join("/")+"/"}${u}`:h.originalName;if(s[d]!=null)throw new X(`Duplicate weight name: ${d}`);s[d]=h,r++}const o=[];for(const l in t){let u=l;if(s[l]==null){const h=l.split("/");u=h.slice(0,-2).concat([h[h.length-1]]).join("/")}if(s[u]!=null)o.push([s[u],t[l]]);else if(e)throw new X(`Provided weight data has no target variable: ${l}`);delete s[u]}if(e){const l=[];for(const u in s)l.push(u);if(l.length>0)throw new X(`${l.length} of ${r} weights are not set: ${l}`)}ST(o)}parseWeights(t){for(const e in Object.keys(t)){const s=e.split("/"),r=["vars","layer_checkpoint_dependencies"],i=s.map(o=>o.startsWith("_")?o.slice(1):o).filter(o=>!r.includes(o)).join("/");i!==e&&(t[i]=t[e],delete t[e])}}updatedConfig(){const t=this.getConfig(),e={};return e.className=this.getClassName(),e.config=t,e.kerasVersion=`tfjs-layers ${EM}`,e.backend="TensorFlow.js",e}toJSON(t,e=!0){const s=ww(this.updatedConfig());return e?JSON.stringify(s):s}call(t,e){return ct(()=>{t=Ve(t);const s=new _a;for(let r=0;r<this.inputs.length;++r)s.add(this.inputs[r],t[r]);return Ud(this.outputs,s,e)})}computeMask(t,e){return ct(()=>{t=Ve(t);let s;return e==null?s=hu(null,t.length):s=Ve(e),this.runInternalGraph(t,s)[1]})}computeOutputShape(t){const e=Ry(t);if(e.length!==this.inputLayers.length)throw new X(`Invalid inputShape argument ${t}: model has ${this.inputLayers.length} tensor inputs.`);const s={};for(let l=0;l<e.length;l++){const u=this.inputLayers[l],h=e[l],d=u.name+"_0_0";s[d]=h}const r=Object.keys(this.nodesByDepth).map(l=>parseInt(l,10)).sort(Ig);if(r.length>1)for(const l of r){const u=this.nodesByDepth[l];for(const h of u){const d=h.outboundLayer;if(this.inputLayers.map(v=>v.id).indexOf(d.id)!==-1)continue;const p=[];for(let v=0;v<h.inboundLayers.length;v++){const C=h.inboundLayers[v],S=h.nodeIndices[v],E=h.tensorIndices[v],_=`${C.name}_${S}_${E}`,I=s[_];p.push(I)}const m=d.computeOutputShape(Ks(p)),y=Ry(m),x=d.inboundNodes.indexOf(h);for(let v=0;v<y.length;v++){const C=`${d.name}_${x}_${v}`;s[C]=y[v]}}}const i=[],o=[];for(let l=0;l<this.outputLayers.length;l++){const u=this.outputLayers[l],h=this.outputLayersNodeIndices[l],d=this.outputLayersTensorIndices[l],p=`${u.name}_${h}_${d}`;o.push(p)}for(let l=0;l<o.length;l++){const u=o[l];Fi(u in s),i.push(s[u])}return Ks(i)}runInternalGraph(t,e){e==null&&(e=hu(null,t.length));const s={};for(let u=0;u<this.inputs.length;++u){const h=this.inputs[u],d=t[u],p=e[u];s[h.id]=[d,p]}const r=Object.keys(this.nodesByDepth).map(u=>parseInt(u,10)).sort(Ig);for(const u of r){const h=this.nodesByDepth[u];for(const d of h){const p=d.outboundLayer,m=d.inputTensors,y=d.outputTensors,x=new Array;for(const v of m)v.id in s&&x.push(s[v.id]);if(x.length===m.length){let v={},C,S,E,_;if(d.callArgs!=null&&(v=d.callArgs),x.length===1){const[I,O]=x[0];v.mask==null&&(v.mask=O),E=Ve(p.call(I,v)),_=Ve(p.computeMask(I,O)),C=[I],S=[O]}else C=x.map(I=>I[0]),S=x.map(I=>I[1]),v.mask==null&&(v.mask=S),E=Ve(p.call(C,v)),_=Ve(p.computeMask(C,S));if(p.activityRegularizer)throw new re("LayersModel invocation with concrete Tensor value(s) in the presence of activity regularizer(s) is not supported yet.");for(let I=0;I<y.length;++I){const O=y[I],P=E[I],D=_[I];s[O.id]=[P,D]}}}}const i=[],o=[],l=[];for(const u of this.outputs){Fi(u.id in s,`Could not compute output ${u.name} : ${u.id}`);const[h,d]=s[u.id];l.push(h.shape),i.push(h),o.push(d)}return[i,o,l]}buildNodeConversionMap(t){const e={};let s;for(const r of this.layers){s=r instanceof si?1:0;for(let i=0;i<r.inboundNodes.length;i++){const o=si.nodeKey(r,i);this.containerNodes.has(o)&&(e[o]=s,s+=1)}}return e}getLayer(t,e){if(e!=null)return this.findLayer(e);if(t==null)throw new X("Provide either a layer name or layer index");if(typeof t=="number")return this.findLayer(t);for(const s of this.layers)if(s.name===t)return s;throw new X(`No such layer: ${t}`)}findLayer(t){if(this.layers.length<=t)throw new X(`Was asked to retrieve layer at index ${t}, but model only has ${this.layers.length} layer(s).`);return this.layers[t]}calculateLosses(){return ct(()=>{const t=[];for(const e of this.layers)for(let s=0;s<e.inboundNodes.length;++s){const r=si.nodeKey(e,s);this.containerNodes.has(r)&&t.push(...e.calculateLosses())}return t})}getConfig(){const t={name:this.name},e=this.buildNodeConversionMap(this.layers),s=[];for(const o of this.layers){const l=o.getClassName(),u=o.getConfig(),h=[];for(let p=0;p<o.inboundNodes.length;p++){const m=o.inboundNodes[p],y=si.nodeKey(o,p);let x={};if(this.containerNodes.has(y)){if(m.callArgs)try{JSON.stringify(m.callArgs),x=m.callArgs}catch{console.warn(`Layer ${o.name} was passed non-serializable keyword arguments: ${m.callArgs}. They will not be included in the serialized model (and thus will be missing at deserialization time).`),x={}}if(m.inboundLayers.length>0){const v=[];for(let C=0;C<m.inboundLayers.length;C++){const S=m.inboundLayers[C],E=m.nodeIndices[C],_=m.tensorIndices[C],I=si.nodeKey(S,E);let O=e[I];O==null&&(O=0),v.push([S.name,O,_,x])}h.push(v)}}}const d={};d.name=o.name,d.className=l,d.config=u,d.inboundNodes=h,s.push(d)}t.layers=s;const r=[];for(let o=0;o<this.inputLayers.length;o++){const l=this.inputLayers[o],u=this.inputLayersNodeIndices[o],h=si.nodeKey(l,u);if(!this.containerNodes.has(h))continue;let d=e[h];d==null&&(d=0);const p=this.inputLayersTensorIndices[o];r.push([l.name,d,p])}t.inputLayers=r;const i=[];for(let o=0;o<this.outputLayers.length;o++){const l=this.outputLayers[o],u=this.outputLayersNodeIndices[o],h=si.nodeKey(l,u);if(!this.containerNodes.has(h))continue;let d=e[h];d==null&&(d=0);const p=this.outputLayersTensorIndices[o];i.push([l.name,d,p])}return t.outputLayers=i,t}static fromConfig(t,e,s={},r=!1){const i={},o={};function l(C,S){C.name in o?o[C.name].push(S):o[C.name]=[S]}function u(C,S){const E=[];let _;for(const I of S){const O=I[0],P=I[1],D=I[2];if(_=I[3]==null?{}:I[3],!(O in i)){l(C,S);return}const N=i[O];if(N.inboundNodes.length<=P){l(C,S);return}const R=N.inboundNodes[P];E.push(R.outputTensors[D])}E.length>0&&C.apply(Ks(E),_)}function h(C){const S=C.name,E=qi(C,e.customObjects!=null?e.customObjects:{});E.setFastWeightInitDuringBuild(r),i[S]=E,C.inboundNodes.forEach(I=>{if(!(I instanceof Array))throw new X(`Corrupted configuration, expected array for nodeData: ${I}`);l(E,I)})}const d=e.name,p=e.layers;for(const C of p)h(C);for(;!GX(o);)for(const C of p){const S=i[C.name];if(S.name in o){const E=o[S.name];delete o[S.name];for(const _ of E)u(S,_)}}const m=[],y=[],x=e.inputLayers;for(const C of x){const S=C[0],E=C[1],_=C[2];Fi(S in i);const O=i[S].inboundNodes[E].outputTensors;m.push(O[_])}const v=e.outputLayers;for(const C of v){const S=C[0],E=C[1],_=C[2];Fi(S in i);const O=i[S].inboundNodes[E].outputTensors;y.push(O[_])}return new t({inputs:m,outputs:y,name:d})}get stateful(){if(this._stateful)throw new X("Container instance unexpectedly has _stateful = true. The statefulness of a Container is determined by the Layers it contains. Its _stateful property must remain the default false.");for(const t of this.layers)if(t.stateful)return!0;return!1}resetStates(){ct(()=>{this.layers.forEach(t=>{t.stateful&&t.resetStates()})})}}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function oQ(n,t,e){const s=t.length;if(n==null||Array.isArray(n)&&n.length===0)return t.map(r=>null);if(s===1)return Array.isArray(n)&&n.length===1?n:typeof n=="object"&&t[0]in n?[n[t[0]]]:[n];if(Array.isArray(n)){if(n.length!==s)throw new Error(`Provided ${e} is an array of ${n.length} element(s), but the model has ${s} outputs. Make sure a set of weights is provided for each model output.`);return n}else if(typeof n=="object"&&Object.keys(n).length>0&&typeof n[Object.keys(n)[0]]=="object"){const r=[];return t.forEach(i=>{i in n?r.push(n[i]):r.push(null)}),r}else throw new Error(`The model has multiple (${s}) outputs, so ${e} must be either an array with ${s} elements or an object with ${t} keys. Provided ${e} not understood: ${JSON.stringify(n)}`)}function IM(n,t){return oQ(n,t,"classWeight")}async function _M(n,t,e,s){if(e!=null){const r=ct(()=>{if(n.shape.length===1)return Xl(n);if(n.shape.length===2){if(n.shape[1]>1)return hf(n,1);if(n.shape[1]===1)return rt(n,[n.shape[0]]);throw new Error(`Encountered unexpected last-dimension size (${n.shape[1]}) during handling of class weights. The size is expected to be >= 1.`)}else throw new Error(`Unexpected rank of target (y) tensor (${n.rank}) during handling of class weights. The rank is expected to be 1 or 2.`)}),i=Array.from(await r.data());oe(r);const o=[];return i.forEach(l=>{if(e[l]==null)throw new Error(`classWeight must contain all classes in the training data. The class ${l} exists in the data but not in classWeight`);o.push(e[l])}),ar(o,"float32")}else return null}function aQ(n,t){return J(n,t)}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */const lQ=32;function kM(n,t){let e,s;const r=t;e=r.xs,s=r.ys,U(e!=null&&s!=null,()=>`A Dataset iterator for fitDataset() is expected to generate objects of the form \`{xs: xVal, ys: yVal}\`, where the two values may be \`tf.Tensor\`, an array of Tensors, or a map of string to Tensor.  The provided Dataset instead generates ${t}`);const i=AA("input",n.inputNames,e),o=AA("output",n.outputNames,s),l=i[0].shape[0];U(i.length===n.inputs.length,()=>`LayersModel has ${n.inputs.length} inputs, but the dataset provides ${i.length} inputs.  (Expected input keys: ${JSON.stringify(n.inputNames)})`),U(o.length===n.outputs.length,()=>`LayersModel has ${n.outputs.length} outputs, but the dataset provides ${o.length} outputs.  (Expected output keys: ${JSON.stringify(n.outputNames)})`);for(let u=0;u<i.length;u++)U(i[u].shape[0]===l,()=>`Batch size mismatch: input ${n.inputNames[u]} has ${i[u].shape[0]}; expected  ${l} based on input ${n.inputNames[0]}.`);for(let u=0;u<o.length;u++)U(o[u].shape[0]===l,()=>`Batch size mismatch: output ${n.outputNames[u]} has ${o[u].shape[0]}; expected  ${l} based on input ${n.inputNames[0]}.`);return{xs:i,ys:o}}function AA(n,t,e){if(e instanceof Fn)return[e];if(Array.isArray(e))return U(e.length===t.length,()=>`Received an array of ${e.length} Tensors, but expected ${t.length} to match the ${n} keys ${t}.`),e;{const s=[];for(const r of t){if(e[r]==null)throw new X(`The feature data generated by the dataset lacks the required ${n} key '${r}'.`);s.push(e[r])}return s}}function uQ(n){if(n.length===3)throw new re("Validation with sample weights is not implemented yet.");return{xs:n[0],ys:n[1]}}async function cQ(n,t,e){const s=e.batchesPerEpoch!=null;if(U(n.optimizer!=null,()=>"You must compile a model before training/testing. Use LayersModel.compile(modelCompileConfig)."),U(e!=null,()=>"For fitDataset(), the 2nd argument (config) is required, but it is not provided in this call."),U(e.epochs!=null&&e.epochs>0&&Number.isInteger(e.epochs),()=>`For fitDataset(), config.epochs is expected to be a positive integer, but got ${e.epochs}`),U(!s||e.batchesPerEpoch>0&&Number.isInteger(e.batchesPerEpoch),()=>`For fitDataset(), config.batchesPerEpoch is expected to be a positive integer if specified, but got ${e.batchesPerEpoch}`),U(e.validationSplit==null,()=>"`validationSplit` is not supported by `fitDataset()`. Use validationData instead."),n.isTraining)throw new Error("Cannot start training because another fit() call is ongoing.");n.isTraining=!0;try{const r=e.validationData!=null;let i,o;if(r)if(NA(e.validationData))U(e.validationBatches==null||e.validationBatches>0&&Number.isInteger(e.validationBatches),()=>`For fitDataset() with dataset-based validation, config.validationBatches is expected not to be provided, or to be a positive integer, but got ${e.validationBatches}`);else{const C=uQ(e.validationData);i=C.xs,o=C.ys}const l=n.makeTrainFunction(),u=n.getDedupedMetricsNames();let h;r?h=u.slice().concat(u.map(C=>"val_"+C)):h=u.slice();const d=yM(e.callbacks,e.yieldEvery),p=e.verbose==null?1:e.verbose,{callbackList:m,history:y}=xM(d,p,e.epochs,null,null,hQ(t,e),null,r,h);m.setModel(n),n.history=y,await m.onTrainBegin(),n.stopTraining_=!1;let x=e.initialEpoch==null?0:e.initialEpoch,v=await t.iterator();for(;x<e.epochs;){const C={};await m.onEpochBegin(x);let S=0,E=0;for(s||(v=await t.iterator());!s||S<e.batchesPerEpoch;){const _=await v.next();if(s&&_.done){console.warn(`You provided \`batchesPerEpoch\` as ${e.batchesPerEpoch}, but your dataset iterator ran out of data after ${S} batches; interrupting training. Make sure that your dataset can generate at least \`batchesPerEpoch * epochs\` batches (in this case, ${e.batchesPerEpoch*e.epochs} batches). You may need to use the repeat() function when building your dataset.`);break}if(_.value!=null){const{xs:I,ys:O}=kM(n,_.value),P={};P.batch=E,P.size=I[0].shape[0],await m.onBatchBegin(E,P);const D=[];if(e.classWeight!=null){const $=IM(e.classWeight,n.outputNames);for(let A=0;A<$.length;++A)D.push(await _M(O[A],null,$[A]))}const N=I.concat(O).concat(D),R=l(N);oe(N);for(let $=0;$<u.length;++$){const A=u[$],V=R[$];P[A]=V,Ui(V)}await m.onBatchEnd(E,P),gM(P),E++,S++}if(s?S>=e.batchesPerEpoch:_.done){if(r){let I;NA(e.validationData)?I=Ve(await n.evaluateDataset(e.validationData,{batches:e.validationBatches})):I=Ve(n.evaluate(i,o,{batchSize:e.validationBatchSize==null?lQ:e.validationBatchSize,verbose:0}));for(let O=0;O<n.metricsNames.length;++O)C[`val_${n.metricsNames[O]}`]=I[O]}break}if(n.stopTraining_)break}if(await m.onEpochEnd(x,C),x++,n.stopTraining_)break}return await m.onTrainEnd(),await n.history.syncData(),n.history}finally{n.isTraining=!1}}function hQ(n,t){let e=null;return t.batchesPerEpoch!=null?e=t.batchesPerEpoch:Number.isFinite(n.size)&&(e=n.size),e}function NA(n){return typeof n.iterator=="function"}function dQ(n){return typeof n.next=="function"}async function fQ(n,t,e){e=e||{};const s=e.batches!=null,r=n.testFunction;let i=[];if(e.verbose>0)throw new re("Verbose mode is not implemented yet.");U(!s||e.batches>0&&Number.isInteger(e.batches),()=>`Test loop expects \`batches\` to be a positive integer, but received ${JSON.stringify(e.batches)}`);const o=dQ(t)?t:await t.iterator();let l=0,u=0;for(;!s||u<e.batches;){const h=await o.next();if(i=ct(()=>{if(h.value){const{xs:d,ys:p}=kM(n,h.value),m=d.concat(p),y=ct(()=>r(m));if(oe(m),u===0)for(let v=0;v<y.length;++v)i.push(De(0));const x=m[0].shape[0];for(let v=0;v<y.length;++v){const C=y[v],S=i[v];i[v]=ct(()=>kt(i[v],J(x,C))),u>0&&oe(S)}oe(y),l+=x,++u}return i}),h.done){s&&console.warn(`Your dataset iterator ran out of data during evaluateDataset(). Interrupting evalution. Make sure that your dataset can generate at least \`batches\` batches (in this case, ${e.batches} batches). You may need to use the repeat() function when building your dataset.`);break}}for(let h=0;h<i.length;++h){const d=i[h];i[h]=Wt(i[h],l),oe(d)}return Ks(i)}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function dv(n){U(n>0&&Number.isInteger(n),()=>`batchSize is required to be a positive integer, but got ${n}`)}function Md(n,t,e){return n==null?[null]:Array.isArray(n)?n.map(s=>Ql(s,t,e-t)):Ql(n,t,e-t)}function Cw(n,t){return ct(()=>n==null?null:Array.isArray(n)?n.map(e=>Cw(e,t)):nM(n,t.dtype==="int32"?t:Ot(t,"int32")))}function fv(n,t){const e=[];let s=0,r=null;for(;s<n;)r=s+t,r>=n&&(r=n),e.push([s,r]),s=r;return e}function AM(n){const t=[];n instanceof Fn&&(n=[n]);for(let e=0;e<n.length;++e){const s=n[e];if(s.rank===1)t.push(Pp(s,1));else{if(s.rank===0)throw new Error("Expected tensor to be at least 1D, but received a 0D tensor (scalar).");t.push(s)}}return t}function ni(n,t){if(n==null)return;const e=[];if(t instanceof Fn)e.push(t.id);else if(Array.isArray(t))t.forEach(r=>e.push(r.id));else if(t!=null)for(const r in t){const i=t[r];e.push(i.id)}const s=[];if(n instanceof Fn)e.indexOf(n.id)===-1&&s.push(n);else if(Array.isArray(n))n.forEach(r=>{e.indexOf(r.id)===-1&&s.push(r)});else if(n!=null)for(const r in n){const i=n[r];e.indexOf(i.id)===-1&&s.push(i)}s.forEach(r=>{r.isDisposed||r.dispose()})}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function pQ(n){return n instanceof Fn}function Sw(n){return Array.isArray(n)}function RA(n){return!pQ(n)&&!Sw(n)}function $A(n,t,e,s=!0,r=""){if(t==null||t.length===0){if(n!=null){let o=!1;if(Sw(n)&&n.length>0)o=!0;else if(RA(n)){for(const l in n)if(n.hasOwnProperty(l)){o=!0;break}}else o=!0;if(o)throw new X(`Error when checking model ${r} expected no data, but got ${n}`)}return[]}if(n==null)return t.map(o=>null);let i;if(RA(n)){n=n,i=[];for(const o of t){if(n[o]==null)throw new X(`No data provided for "${o}". Need data for each key in: ${t}`);i.push(n[o])}}else if(Sw(n)){if(n=n,n.length!==t.length)throw new X(`Error when checking model ${r}: the Array of Tensors that you are passing to your model is not the size the model expected. Expected to see ${t.length} Tensor(s), but instead got the following list of Tensor(s): ${n}`);i=n}else{if(n=n,t.length>1)throw new X(`The model ${r} expects ${t.length} Tensor(s), but only received one Tensor. Found: Tensor with shape ${n.shape}`);i=[n]}if(i=AM(i),e!=null)for(let o=0;o<t.length;++o){if(e[o]==null)continue;const l=i[o];if(l.shape.length!==e[o].length)throw new X(`Error when checking ${r}: expected ${t[o]} to have ${e[o].length} dimension(s). but got array with shape ${l.shape}`);for(let u=0;u<e[o].length;++u){if(u===0&&!s)continue;const h=l.shape[u],d=e[o][u];if(d!=null&&d>=0&&h!==d)throw new X(`${r} expected a batch of elements where each example has shape [${e[o].slice(1,e[o].length)}] (i.e.,tensor shape [*,${e[o].slice(1,e[o].length)}]) but the ${r} received an input with ${l.shape[0]} examples, each with shape [${l.shape.slice(1,l.shape.length)}] (tensor shape [${l.shape}])`)}}return i}function mQ(n,t,e){const s=Fa(n.map(i=>i.shape[0]));s.sort();const r=Fa(t.map(i=>i.shape[0]));if(r.sort(),s.length>1)throw new X(`All input Tensors (x) should have the same number of samples. Got array shapes: ${JSON.stringify(n.map(i=>i.shape))}`);if(r.length>1)throw new X(`All target Tensors (y) should have the same number of samples. Got array shapes: ${JSON.stringify(t.map(i=>i.shape))}`);if(s.length>0&&r.length>0&&!Oe(s,r))throw new X(`Input Tensors should have the same number of samples as target Tensors. Found ${s[0]} input sample(s) and ${r[0]} target sample(s).`)}function gQ(n,t,e){const s=[kx,Ax,yf];for(let r=0;r<n.length;++r){const i=n[r],o=t[r],l=e[r];if(o!=null){if(o===yf&&i.shape[i.shape.length-1]===1)throw new X(`You are passing a target array of shape ${i.shape} while using a loss 'categorical_crossentropy'. 'categorical_crossentropy'expects targets to be binary matrices (1s and 0s) of shape [samples, classes].`);if(s.indexOf(o)!==-1){const u=i.shape.slice(1),h=l.slice(1);for(let d=0;d<u.length;++d){const p=u[d],m=h[d];if(m!=null&&p!==m)throw new X(`A target Tensor with shape ${i.shape} was passed for an output of shape ${l}, while using a loss function that expects targets to have the same shape as the output.`)}}}}}function DA(n,t,e,s=!0,r=""){let i;if(Array.isArray(n)){if(n.length!==t.length)throw new X(`Error when checking model ${r}: the Array of Tensors that you are passing to your model is not the size the the model expected. Expected to see ${t.length} Tensor(s), but instead got ${n.length} Tensors(s).`);i=n}else{if(t.length>1)throw new X(`The model expects ${t.length} ${r} Tensors, but only received one Tensor. Found: array with shape ${JSON.stringify(n.shape)}.`);i=[n]}if(e!=null)for(let o=0;o<t.length;++o){if(e[o]==null)continue;const l=i[o];if(l.shape.length!==e[o].length)throw new X(`Error when checking ${r}: expected ${t[o]} to have ${e[o].length} dimension(s), but got array with shape ${JSON.stringify(l.shape)}`);for(let u=0;u<e[o].length;++u){if(u===0&&!s)continue;const h=l.shape[u],d=e[o][u];if(d!=null&&d!==h)throw new X(`Error when checking ${r}: expected ${t[o]} to have shape ${JSON.stringify(e[o])} but got array with shape ${JSON.stringify(l.shape)}.`)}}}function yQ(n,t){if(n==null||Array.isArray(n)&&n.length===0)return t.map(s=>[]);let e;if(typeof n=="string"||typeof n=="function")e=[n];else if(Array.isArray(n)||typeof n=="object")e=n;else throw new TypeError(`Type of metrics argument not understood. Expected an string,function, Array, or Object, found: ${n}`);if(Array.isArray(e))return t.map(s=>e);{const s=[];for(const r of t){let i=e.hasOwnProperty(r)?e[r]:[];Array.isArray(i)||(i=[i]),s.push(i)}return s}}const xQ="layers-model";class Mc extends si{constructor(t){super(t),this.isTraining=!1}summary(t,e,s=console.log){if(!this.built)throw new X("This model has never been called, thus its weights have not been created yet. So no summary can be displayed. Build the model first (e.g., by calling it on some test data).");tQ(this,t,e,s)}compile(t){if(t.loss==null&&(t.loss=[]),this.loss=t.loss,typeof t.optimizer=="string")this.optimizer_=JY(t.optimizer),this.isOptimizerOwned=!0;else{if(!(t.optimizer instanceof sl))throw new X("User-defined optimizer must be an instance of tf.Optimizer.");this.optimizer_=t.optimizer,this.isOptimizerOwned=!1}let e=[];if(!Array.isArray(t.loss)&&typeof t.loss!="string"&&typeof t.loss!="function"){t.loss=t.loss;for(const o in t.loss)if(this.outputNames.indexOf(o)===-1)throw new X(`Unknown entry in loss dictionary: "${o}". Only expected the following keys: ${this.outputNames}`);for(const o of this.outputNames)t.loss[o]==null&&console.warn(`Output "${o}" is missing from loss dictionary. We assume this was done on purpose, and we will not be expecting data to be passed to ${o} during training`),e.push(hv(t.loss[o]))}else if(Array.isArray(t.loss)){if(t.loss.length!==this.outputs.length)throw new X(`When passing an Array as loss, it should have one entry per model output. The model has ${this.outputs.length} output(s), but you passed loss=${t.loss}.`);e=t.loss.map(l=>hv(l))}else{const o=hv(t.loss);this.outputs.forEach(l=>{e.push(o)})}this.lossFunctions=e,this.feedOutputNames=[],this.feedOutputShapes=[],this.feedLossFns=[];for(let o=0;o<this.outputs.length;++o){const l=this.internalOutputShapes[o],u=this.outputNames[o];this.feedOutputNames.push(u),this.feedOutputShapes.push(l),this.feedLossFns.push(this.lossFunctions[o])}const s=[];this.metrics=t.metrics,this.metricsNames=["loss"],this.metricsTensors=[],Yl("loss",()=>{for(let o=0;o<this.outputs.length;++o){if(s.indexOf(o)!==-1)continue;const l=this.lossFunctions[o];this.outputs.length>1&&(this.metricsTensors.push([l,o]),this.metricsNames.push(this.outputNames[o]+"_loss"))}});const r=yQ(t.metrics,this.outputNames),i=(o,l,u)=>{this.outputNames.length>1&&(l=this.outputNames[o]+"_"+l),this.metricsNames.push(l),this.metricsTensors.push([u,o])};Yl("metric",()=>{for(let o=0;o<this.outputs.length;++o){if(s.indexOf(o)!==-1)continue;const l=r[o];(h=>{const d="";let p,m,y;for(const x of h){if(typeof x=="string"&&["accuracy","acc","crossentropy","ce"].indexOf(x)!==-1){const C=this.internalOutputShapes[o];C[C.length-1]===1||this.lossFunctions[o]===Ax?["accuracy","acc"].indexOf(x)!==-1?m=vM:["crossentropy","ce"].indexOf(x)!==-1&&(m=GY):this.lossFunctions[o]===Fy?["accuracy","acc"].indexOf(x)!==-1?m=WY:["crossentropy","ce"].indexOf(x)!==-1&&(m=SM):["accuracy","acc"].indexOf(x)!==-1?m=wM:["crossentropy","ce"].indexOf(x)!==-1&&(m=CM);let S;["accuracy","acc"].indexOf(x)!==-1?S="acc":["crossentropy","ce"].indexOf(x)!==-1&&(S="ce"),y=m,p=d+S}else y=ZY(x),p=d+Ag(x);let v;Yl(p,()=>{v=y}),i(o,p,v)}})(l)}}),this.collectedTrainableWeights=this.trainableWeights}checkTrainableWeightsConsistency(){this.collectedTrainableWeights!=null&&this.trainableWeights.length!==this.collectedTrainableWeights.length&&console.warn("Discrepancy between trainableweights and collected trainable weights. Did you set `model.trainable` without calling `model.compile()` afterwards?")}evaluate(t,e,s={}){const r=s.batchSize==null?32:s.batchSize;dv(r);const o=this.standardizeUserDataXY(t,e,!0,r);try{const l=o[0].concat(o[1]);this.makeTestFunction();const u=this.testFunction,h=this.testLoop(u,l,r,s.verbose,s.steps);return Ks(h)}finally{ni(o[0],t),ni(o[1],e)}}async evaluateDataset(t,e){return this.makeTestFunction(),fQ(this,t,e)}checkNumSamples(t,e,s,r="steps"){let i;if(s!=null){if(i=null,e!=null)throw new X(`If ${r} is set, batchSize must be null or undefined.Got batchSize = ${e}`)}else if(t!=null)Array.isArray(t)?i=t[0].shape[0]:i=t.shape[0];else throw new X(`Either the input data should have a defined shape, or ${r} shoud be specified.`);return i}execute(t,e){if(Array.isArray(e)&&e.length===0)throw new X("`outputs` is an empty Array, which is not allowed.");const s=Array.isArray(e),r=s?e:[e],i=this.retrieveSymbolicTensors(r),o=new _a;if(t instanceof Fn&&(t=[t]),Array.isArray(t)){if(t.length!==this.inputs.length)throw new X(`The number of inputs provided (${t.length}) does not match the number of inputs of this model (${this.inputs.length}).`);for(let u=0;u<this.inputs.length;++u)o.add(this.inputs[u],t[u])}else for(const u of this.inputs){const h=t[u.name];if(h==null)throw new X(`No value is provided for the model's input ${u.name}`);o.add(u,h)}const l=Ud(i,o);return s?l:l[0]}retrieveSymbolicTensors(t){const e=hu(null,t.length);let s=t.length;for(const r of this.layers){const i=Array.isArray(r.output)?r.output:[r.output],o=i.map(l=>l.name);for(let l=0;l<t.length;++l){const u=o.indexOf(t[l]);if(u!==-1&&(e[l]=i[u],s--),s===0)break}if(s===0)break}if(s>0){const r=[];throw e.forEach((i,o)=>{i==null&&r.push(t[o])}),new X(`Cannot find SymbolicTensors for output name(s): ${JSON.stringify(r)}`)}return e}predictLoop(t,e=32,s=!1){return ct(()=>{const r=this.checkNumSamples(t);if(s)throw new re("Verbose predictLoop() is not implemented yet.");const i=fv(r,e),o=this.outputs.map(l=>[]);for(let l=0;l<i.length;++l)ct(()=>{const h=i[l][0],d=i[l][1],p=Md(t,h,d),m=[];if(Array.isArray(p))for(let x=0;x<p.length;++x)m.push({key:this.inputs[x],value:p[x]});else m.push({key:this.inputs[0],value:p});const y=new _a(m);return Ud(this.outputs,y)}).forEach((h,d)=>o[d].push(h));return Ks(o.map(l=>Xs(l,0)))})}predict(t,e={}){const s=AM(t);DA(s,this.inputNames,this.feedInputShapes,!1);try{const r=e.batchSize==null?32:e.batchSize;return dv(r),this.predictLoop(s,r)}finally{ni(s,t)}}predictOnBatch(t){DA(t,this.inputNames,this.feedInputShapes,!0);const e=(Array.isArray(t)?t[0]:t).shape[0];return this.predictLoop(t,e)}standardizeUserDataXY(t,e,s=!0,r){if(this.optimizer_==null)throw new Wr("You must compile a model before training/testing. Use LayersModel.compile(modelCompileArgs).");const i=[];for(let o=0;o<this.feedOutputShapes.length;++o){const l=this.feedOutputShapes[o];this.feedLossFns[o]===Fy?i.push(l.slice(0,l.length-1).concat([1])):i.push(l)}if(t=$A(t,this.feedInputNames,this.feedInputShapes,!1,"input"),e=$A(e,this.feedOutputNames,i,!1,"target"),mQ(t,e),gQ(e,this.feedLossFns,this.feedOutputShapes),this.stateful&&r!=null&&r>0&&t[0].shape[0]%r!==0)throw new X(`In a stateful network, you should only pass inputs with a number of samples that is divisible by the batch size ${r}. Found: ${t[0].shape[0]} sample(s).`);return[t,e]}async standardizeUserData(t,e,s,r,i=!0,o){const[l,u]=this.standardizeUserDataXY(t,e,i,o);if(s!=null)throw new Error("sample weight is not supported yet.");let h=null;if(r!=null){const d=IM(r,this.outputNames);h=[];for(let p=0;p<d.length;++p)h.push(await _M(u[p],null,d[p]))}return[l,u,h]}testLoop(t,e,s,r=0,i){return ct(()=>{const o=this.checkNumSamples(e,s,i,"steps"),l=[];if(r>0)throw new re("Verbose mode is not implemented yet.");if(i!=null)throw new re("steps mode in testLoop() is not implemented yet");{const u=fv(o,s),h=ar(di(0,o));for(let d=0;d<u.length;++d){const p=u[d][0],m=u[d][1],y=Ql(h,p,m-p),x=Cw(e,y),v=t(x);if(d===0)for(let C=0;C<v.length;++C)l.push(De(0));for(let C=0;C<v.length;++C){const S=v[C];l[C]=kt(l[C],J(m-p,S))}}for(let d=0;d<l.length;++d)l[d]=Wt(l[d],o)}return l})}getDedupedMetricsNames(){const t=this.metricsNames,e=[];for(let s=0;s<t.length;++s){const r=t[s];let i=r;if(yA(t,r)>1){const o=yA(t.slice(0,s),r);i+=`_${o}`}e.push(i)}return e}makeTrainFunction(){return t=>{const e=[],s=t.slice(0,this.inputs.length),r=t.slice(this.inputs.length,this.inputs.length+this.outputs.length),i=t.slice(this.inputs.length+this.outputs.length,this.inputs.length+this.outputs.length*2),o=[],l=()=>{const p=[];for(let v=0;v<this.inputs.length;++v)p.push({key:this.inputs[v],value:s[v]});const m=new _a(p),y=Ud(this.outputs,m,{training:!0});let x;for(let v=0;v<this.lossFunctions.length;++v){const C=this.lossFunctions[v];let S=C(r[v],y[v]);i[v]!=null&&(S=aQ(S,i[v]));const E=An(S);e.push(E),v===0?x=S:x=kt(x,S)}for(let v=0;v<this.metricsTensors.length;++v){let C;if(this.outputs.length>1&&v<this.outputs.length)C=e[v];else{const S=this.metricsTensors[v][0],E=this.metricsTensors[v][1];C=An(S(r[E],y[E]))}Ui(C),o.push(C)}return x=An(x),this.calculateLosses().forEach(v=>{x=kt(x,v)}),x},u=this.collectedTrainableWeights.map(p=>p.read());return[this.optimizer_.minimize(l,!0,u)].concat(o)}}makeTestFunction(){this.testFunction=t=>ct(()=>{const e=[];let s;const r=t.slice(0,this.inputs.length),i=t.slice(this.inputs.length,this.inputs.length+this.outputs.length),o=[];for(let h=0;h<this.inputs.length;++h)o.push({key:this.inputs[h],value:r[h]});const l=new _a(o),u=Ud(this.outputs,l);for(let h=0;h<this.lossFunctions.length;++h){const d=this.lossFunctions[h],p=An(d(i[h],u[h]));h===0?s=p:s=kt(s,p),e.push(s)}for(let h=0;h<this.metricsTensors.length;++h){const d=this.metricsTensors[h][0],p=this.metricsTensors[h][1],m=An(d(i[p],u[p]));e.push(m)}return e})}async fit(t,e,s={}){if(this.isTraining)throw new Error("Cannot start training because another fit() call is ongoing.");this.isTraining=!0;let r,i,o,l,u,h,d,p,m;try{const y=s.batchSize==null?32:s.batchSize;dv(y);const v=await this.standardizeUserData(t,e,s.sampleWeight,s.classWeight,!1,y);r=v[0],i=v[1],m=v[2];let C=!1,S;if(s.validationData!=null&&s.validationData.length>0){if(C=!0,s.validationData.length===2)u=s.validationData[0],h=s.validationData[1];else throw s.validationData.length===3?new re("validationData including sample weights is not supported yet."):new X(`When passing validation data, it must contain 2 (valX, valY) or 3 (valX, valY, valSampleWeight) items; ${s.validationData} is invalid.`);const $=await this.standardizeUserData(u,h,null,null,!0,y);d=$[0],p=$[1],S=d.concat(p)}else if(s.validationSplit!=null&&s.validationSplit>0&&s.validationSplit<1){C=!0;const R=Math.floor(r[0].shape[0]*(1-s.validationSplit)),$=r[0].shape[0];d=Md(r,R,$),o=r,r=Md(r,0,R),p=Md(i,R,$),l=i,i=Md(i,0,R),S=d.concat(p)}else s.validationSteps!=null&&(C=!0);const E=r.concat(i).concat(m);this.checkTrainableWeightsConsistency();const _=this.makeTrainFunction(),I=this.getDedupedMetricsNames();let O,P;C?(this.makeTestFunction(),O=this.testFunction,P=I.slice().concat(I.map(R=>"val_"+R))):(O=null,S=[],P=I.slice());const D=yM(s.callbacks,s.yieldEvery);return await this.fitLoop(_,E,I,y,s.epochs,s.verbose,D,O,S,s.shuffle,P,s.initialEpoch,null,null)}finally{this.isTraining=!1,ni(r,t),ni(i,e),ni(o,t),ni(l,e),ni(d,u),ni(p,h),m!=null&&oe(m)}}async fitLoop(t,e,s,r,i,o,l,u,h,d,p,m,y,x){r==null&&(r=32),i==null&&(i=1),d==null&&(d=!0),m==null&&(m=0);let v=!1;if(u!=null&&h!=null&&(v=!0),x!=null&&(v=!0,y==null))throw new X("Can only use `validationSteps` when doing step-wise training, i.e., `stepsPerEpoch` must be set.");const C=this.checkNumSamples(e,r,y,"steps_per_epoch");let S;C!=null&&(S=di(0,C)),o==null&&(o=1);const{callbackList:E,history:_}=xM(l,o,i,m,C,y,r,v,p);E.setModel(this),this.history=_,await E.onTrainBegin(),this.stopTraining_=!1;for(let I=m;I<i;++I){await E.onEpochBegin(I);const O={};if(y!=null)throw new re("stepsPerEpoch mode is not implemented yet.");{if(d==="batch")throw new re("batch shuffling is not implemneted yet");d&&FW(S);const P=ar(S),D=fv(C,r);for(let N=0;N<D.length;++N){const R={};if(await E.onBatchBegin(N,R),ct(()=>{const $=D[N][0],A=D[N][1],V=Ql(P,$,A-$);R.batch=N,R.size=A-$;const L=Cw(e,V),nt=t(L);for(let Z=0;Z<s.length;++Z){const W=s[Z],K=nt[Z];R[W]=K,Ui(K)}if(N===D.length-1&&v){const Z=this.testLoop(u,h,r);for(let W=0;W<s.length;++W){const K=s[W],Y=Z[W];Ui(Y),O["val_"+K]=Y}}}),await E.onBatchEnd(N,R),gM(R),this.stopTraining_)break}P.dispose()}if(await E.onEpochEnd(I,O),this.stopTraining_)break}return await E.onTrainEnd(),await this.history.syncData(),this.history}async fitDataset(t,e){return cQ(this,t,e)}async trainOnBatch(t,e){const s=await this.standardizeUserData(t,e),r=s[0],i=s[1],l=this.makeTrainFunction()(r.concat(i)),u=[];for(const h of l){const d=await h.data();u.push(d[0])}return oe(l),ni(s[0],t),ni(s[1],e),Ks(u)}getNamedWeights(t){const e=[],s=t!=null&&t.trainableOnly,r=s?this.trainableWeights:this.weights,i=this.getWeights(s);for(let o=0;o<r.length;++o)s&&!r[o].trainable||e.push({name:r[o].originalName,tensor:i[o]});return e}set stopTraining(t){this.stopTraining_=t}get stopTraining(){return this.stopTraining_}get optimizer(){return this.optimizer_}set optimizer(t){this.optimizer_!==t&&(this.optimizer_=t,this.isOptimizerOwned=!1)}dispose(){const t=super.dispose();if(t.refCountAfterDispose===0&&this.optimizer!=null&&this.isOptimizerOwned){const e=Gk().numTensors;this.optimizer_.dispose(),t.numDisposedVariables+=e-Gk().numTensors}return t}getLossIdentifiers(){let t;if(typeof this.loss=="string")t=Ro(this.loss);else if(Array.isArray(this.loss)){for(const e of this.loss)if(typeof e!="string")throw new Error("Serialization of non-string loss is not supported.");t=this.loss.map(e=>Ro(e))}else{const e=Object.keys(this.loss);t={};const s=this.loss;for(const r of e)if(typeof s[r]=="string")t[r]=Ro(s[r]);else throw new Error("Serialization of non-string loss is not supported.")}return t}getMetricIdentifiers(){if(typeof this.metrics=="string"||typeof this.metrics=="function")return[Ro(Ag(this.metrics))];if(Array.isArray(this.metrics))return this.metrics.map(t=>Ro(Ag(t)));{const t={};for(const e in this.metrics)t[e]=Ro(Ag(this.metrics[e]));return t}}getTrainingConfig(){return{loss:this.getLossIdentifiers(),metrics:this.getMetricIdentifiers(),optimizer_config:{class_name:this.optimizer.getClassName(),config:this.optimizer.getConfig()}}}loadTrainingConfig(t){if(t.weighted_metrics!=null)throw new Error("Loading weight_metrics is not supported yet.");if(t.loss_weights!=null)throw new Error("Loading loss_weights is not supported yet.");if(t.sample_weight_mode!=null)throw new Error("Loading sample_weight_mode is not supported yet.");const e=zy(t.optimizer_config),s=qi(e);let r;if(typeof t.loss=="string")r=Wl(t.loss);else if(Array.isArray(t.loss))r=t.loss.map(o=>Wl(o));else if(t.loss!=null){r={};for(const o in t.loss)r[o]=Wl(t.loss[o])}let i;if(Array.isArray(t.metrics))i=t.metrics.map(o=>Wl(o));else if(t.metrics!=null){i={};for(const o in t.metrics)i[o]=Wl(t.metrics[o])}this.compile({loss:r,metrics:i,optimizer:s})}async save(t,e){if(typeof t=="string"){const h=zH(t);if(h.length===0)throw new X(`Cannot find any save handlers for URL '${t}'`);if(h.length>1)throw new X(`Found more than one (${h.length}) save handlers for URL '${t}'`);t=h[0]}if(t.save==null)throw new X("LayersModel.save() cannot proceed because the IOHandler provided does not have the `save` attribute defined.");const s=await Wk(this.getNamedWeights(e)),l={modelTopology:this.toJSON(null,!1),format:xQ,generatedBy:`TensorFlow.js tfjs-layers v${EM}`,convertedBy:null};if((e==null?!1:e.includeOptimizer)&&this.optimizer!=null){l.trainingConfig=this.getTrainingConfig();const h="optimizer",{data:d,specs:p}=await Wk(await this.optimizer.getWeights(),h);s.specs.push(...p),s.data=$H([s.data,d])}return this.userDefinedMetadata!=null&&(kA(this.userDefinedMetadata,this.name,!0),l.userDefinedMetadata=this.userDefinedMetadata),l.weightData=s.data,l.weightSpecs=s.specs,t.save(l)}setUserDefinedMetadata(t){kA(t,this.name),this.userDefinedMetadata=t}getUserDefinedMetadata(){return this.userDefinedMetadata}}Mc.className="Model";It(Mc);class NM extends Mc{}NM.className="Functional";It(NM);/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */async function bQ(n,t){if(t==null&&(t={}),typeof n=="string"){const e=BH(n,t);if(e.length===0)e.push(T7(n,t));else if(e.length>1)throw new X(`Found more than one (${e.length}) load handlers for URL '${n}'`);n=e[0]}return vQ(n,void 0,t)}async function vQ(n,t,e){if(e==null&&(e={}),n.load==null)throw new X("Cannot proceed with model loading because the IOHandler provided does not have the `load` method implemented.");const s=await n.load();let r=s.modelTopology;r.model_config!=null&&(r=r.model_config);const i=e.strict==null?!0:e.strict,o=s.weightData!=null&&s.weightSpecs!=null&&i,l=qi(zy(r),t,o),u=s.trainingConfig;if(u!=null&&l.loadTrainingConfig(u),s.userDefinedMetadata!=null&&l.setUserDefinedMetadata(s.userDefinedMetadata),s.weightData!=null){if(s.weightSpecs==null)throw new X("LayersModel artifacts contains weight data, but not weight specs. Therefore loading of weights cannot proceed.");const{modelWeights:h,optimizerWeights:d}=wQ(s.weightData,s.weightSpecs);l.loadWeights(h,i),l.optimizer!=null&&d.length>0&&await l.optimizer.setWeights(d),oe(h),oe(d.map(p=>p.tensor))}return l}function wQ(n,t){const e=IH(n,t),s={},r=[];return t.forEach(i=>{i.group==="optimizer"?r.push({name:i.name,tensor:e[i.name]}):s[i.name]=e[i.name]}),{modelWeights:s,optimizerWeights:r}}class xf extends Mc{constructor(t){if(super({inputs:[],outputs:[]}),t=t||{},this.trainable=!0,this.built=!1,this.name=t.name!=null?t.name:Ex("sequential_"),t.layers!=null)for(const e of t.layers)this.add(e)}checkShape(t){if(t.inboundNodes[0].outputTensors[0].shape.some(s=>s<0))throw new X(`Negative dimension size caused by adding layer ${t.name} with input shape [${t.inboundNodes[0].inputTensors[0].shape}]`)}add(t){const e=t instanceof xf||t instanceof Mc;let s;if(e){if(s=t,s.outputs.length!==1)throw new X("All layers in a Sequential model should have a single output tensor. For multi-output layers, use the functional API.");if(s.inputs.length!==1)throw new X("All layers in a Sequential model should have a single input tensor. For multi-input layers, use the functional API.")}if(this.outputs.length===0){if(t.inboundNodes.length===0){if(t.batchInputShape==null)throw new X("The first layer in a Sequential model must get an `inputShape` or `batchInputShape` argument.");const r=vY({batchShape:t.batchInputShape,dtype:t.dtype,name:t.name+"_input"});t.apply(r)}if(e)this.outputs=s.outputs,this.inputs=s.inputs;else{if(t.inboundNodes.length!==1)throw new X(`A layer added to a Sequential model must not already be connected somewhere else. LayersModel received layer ${t.name} which has ${t.inboundNodes.length} pre-existing inbound connections.`);if(t.inboundNodes[0].outputTensors.length!==1)throw new X("All layers in a Sequential model should have a single output tensor. For multi-output layers, use the functional API.");this.checkShape(t),this.outputs=[t.inboundNodes[0].outputTensors[0]],this.inputs=hM(this.outputs[0])}this.inboundNodes=[],new _x({outboundLayer:this,inboundLayers:[],nodeIndices:[],tensorIndices:[],inputTensors:this.inputs,outputTensors:this.outputs,inputMasks:hu(null,this.inputs.length),outputMasks:[null],inputShapes:this.inputs.map(r=>r.shape),outputShapes:this.outputs[0].shape})}else{const r=t.apply(this.outputs[0]);if(Array.isArray(r))throw new TypeError("All layers in a Sequential model should have a single output tensor. For multi-output layers, use the functional API.");this.checkShape(t),this.outputs=[r],this.inboundNodes[0].outputTensors=this.outputs,this.inboundNodes[0].outputShapes=[this.outputs[0].shape]}this.layers.push(t),this.built=!1}pop(){if(this.layers.length===0)throw new TypeError("There are no layers in the model.");if(this.layers.pop(),this.layers.length===0)this.outputs=[],this.inboundNodes=[],this.outboundNodes=[];else{const t=this.layers.length-1;this.layers[t].outboundNodes=[],this.outputs=[this.layers[t].output],this.inboundNodes[0].outputTensors=this.outputs,this.inboundNodes[0].outputShapes=[this.outputs[0].shape]}}call(t,e){return this.model==null&&this.build(),this.model.call(t,e)}build(t){if(Ae(t),this.inputs.length===0||this.outputs.length===0)throw new TypeError("Sequential model cannot be built: model is empty. Add some layers first.");this.model=new Mc({inputs:this.inputs,outputs:this.outputs[0],name:this.name+"_model"}),this.model.trainable=this.trainable,this.supportsMasking=this.model.supportsMasking,this.inputLayers=this.model.inputLayers,this.inputLayersNodeIndices=this.model.inputLayersNodeIndices,this.inputLayersTensorIndices=this.model.inputLayersTensorIndices,this.outputLayers=this.model.outputLayers,this.outputLayersNodeIndices=this.model.outputLayersNodeIndices,this.outputLayersTensorIndices=this.model.outputLayersTensorIndices,this.nodesByDepth=this.model.nodesByDepth,this.containerNodes=this.model.containerNodes,this.outputNames=this.model.outputNames,this.inputNames=this.model.inputNames,this.built=!0}countParams(){return this.built||this.build(),super.countParams()}summary(t,e,s=console.log){this.built||this.build(),super.summary(t,e,s)}setWeights(t){this.model==null&&this.build(),this.model.setWeights(t)}evaluate(t,e,s={}){if(!this.built)throw new Wr("The model needs to be compiled before being used.");return this.model.evaluate(t,e,s)}async evaluateDataset(t,e){if(!this.built)throw new Wr("The model needs to be compiled before being used.");return this.model.evaluateDataset(t,e)}predict(t,e={}){return this.model==null&&this.build(),this.model.predict(t,e)}predictOnBatch(t){return this.model==null&&this.build(),this.model.predictOnBatch(t)}compile(t){this.build(),this.model.compile(t),this.optimizer_=this.model.optimizer,this.isOptimizerOwned=this.model.isOptimizerOwned,this.loss=this.model.loss,this.metrics=this.model.metrics,this.metricsTensors=this.model.metricsTensors,this.metricsNames=this.model.metricsNames}get optimizer(){return this.model==null?void 0:this.model.optimizer}set optimizer(t){this.model.optimizer=t}async fit(t,e,s={}){if(!this.built)throw new Wr("The model needs to be compiled before being used.");return this.model.fit(t,e,s)}async fitDataset(t,e){if(!this.built)throw new Wr("The model needs to be compiled before being used.");return this.model.fitDataset(t,e)}async trainOnBatch(t,e){return this.model.trainOnBatch(t,e)}static fromConfig(t,e,s={},r=!1){let i,o={};if(e instanceof Array){if(e[0].className==null||e[0].className==="Merge")throw new X("Legacy serialization format not supported yet.");i=e}else U(e.layers!=null,()=>"When the config data for a Sequential model is not an Array, it must be an Object that contains the 'layers' field."),i=e.layers,delete e.layers,o=e;const l=new t(o);if(!(l instanceof xf))throw new re(`Sequential.fromConfig called on non-Sequential input: ${l}`);for(const u of i){const d=qi(u,void 0,r);r&&d.setFastWeightInitDuringBuild(!0),l.add(d)}return l}set stopTraining(t){if(this.model==null)throw new X("Cannot set the stopTraining property of a sequential model before it is compiled.");this.model.stopTraining=t}get stopTraining(){if(this.model==null)throw new X("Cannot get the stopTraining property of a sequential model before it is compiled.");return this.model.stopTraining}getConfig(){const t=[];for(const e of this.layers){const s={};s.className=e.getClassName(),s.config=e.getConfig(),t.push(s)}return{name:this.name,layers:t}}}xf.className="Sequential";It(xf);/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */let _s=class extends ph{getConfig(){return{}}};class RM extends _s{apply(t,e=1){return rY(t,e)}}RM.className="elu";It(RM);class $M extends _s{apply(t){return jD(t)}}$M.className="selu";It($M);class DM extends _s{apply(t){return Cu(t)}}DM.className="relu";It(DM);class OM extends _s{apply(t){return ct(()=>pf(6,Cu(t)))}}OM.className="relu6";It(OM);class MM extends _s{apply(t){return t}}MM.className="linear";It(MM);class FM extends _s{apply(t){return hh(t)}}FM.className="sigmoid";It(FM);class LM extends _s{apply(t){return oY(t)}}LM.className="hardSigmoid";It(LM);class PM extends _s{apply(t){return Np(t)}}PM.className="softplus";It(PM);class VM extends _s{apply(t){return iY(t)}}VM.className="softsign";It(VM);class zM extends _s{apply(t){return mx(t)}}zM.className="tanh";It(zM);let _T=class extends _s{apply(t,e=-1){return AS(t,e)}};_T.className="softmax";It(_T);class BM extends _s{apply(t,e=-1){return VD(t,e)}}BM.className="logSoftmax";It(BM);class UM extends _s{apply(t){return ct(()=>ct(()=>{const e=Math.sqrt(2),s=J(.5,kt(1,OD(Wt(t,e))));return J(t,s)}))}}UM.className="gelu";It(UM);class GM extends _s{apply(t){return ct(()=>J(.5,J(t,kt(1,mx(J(Es(Wt(2,Math.PI)),kt(t,J(.044715,lu(t,3)))))))))}}GM.className="gelu_new";It(GM);class WM extends _s{apply(t){return ct(()=>J(t,mx(Np(t))))}}WM.className="mish";It(WM);class HM extends _s{apply(t,e=1){return ct(()=>J(hh(J(t,e)),t))}}HM.className="swish";It(HM);function qa(n){return n.getClassName()}function pv(n,t={}){return Lp(n,Gr.getMap().classNameMap,t,"activation")}function ja(n){if(n==null){const t={};return t.className="linear",t.config={},pv(t)}if(typeof n=="string"){const t={};return t.className=n,t.config={},pv(t)}else return n instanceof _s?n:pv(n)}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function CQ(n){if(n!=null&&typeof n!="object")throw new Error(`Argument to L1L2 regularizer's constructor is expected to be an object, but received: ${n}`)}class qM extends ph{}class jM extends qM{constructor(t){super(),CQ(t),this.l1=t==null||t.l1==null?.01:t.l1,this.l2=t==null||t.l2==null?.01:t.l2,this.hasL1=this.l1!==0,this.hasL2=this.l2!==0}apply(t){return ct(()=>{let e=Qn([1]);return this.hasL1&&(e=kt(e,Gt(J(this.l1,Os(t))))),this.hasL2&&(e=kt(e,Gt(J(this.l2,Vp(t))))),rt(e,[])})}getConfig(){return{l1:this.l1,l2:this.l2}}static fromConfig(t,e){return new t({l1:e.l1,l2:e.l2})}}jM.className="L1L2";It(jM);const OA={l1l2:"L1L2"};function Ye(n){return fT(n)}function MA(n,t={}){return Lp(n,Gr.getMap().classNameMap,t,"regularizer")}function on(n){if(n==null)return null;if(typeof n=="string"){const e={className:n in OA?OA[n]:n,config:{}};return MA(e)}else return n instanceof qM?n:MA(n)}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */class KM extends ue{constructor(t){super(t??{}),this.supportsMasking=!0,t!=null&&(this.maxValue=t.maxValue)}call(t,e){t=Zt(t);let s=Cu(t);return this.maxValue!=null&&(s=Sr(s,0,this.maxValue)),s}computeOutputShape(t){return t}getConfig(){const t={maxValue:this.maxValue},e=super.getConfig();return Object.assign(t,e),t}}KM.className="ReLU";It(KM);class XM extends ue{constructor(t){super(t??{}),this.DEFAULT_ALPHA=.3,t==null&&(t={}),this.alpha=t.alpha==null?this.DEFAULT_ALPHA:t.alpha}call(t,e){const s=Zt(t);return bS(s,this.alpha)}computeOutputShape(t){return t}getConfig(){const t={alpha:this.alpha},e=super.getConfig();return Object.assign(t,e),t}}XM.className="LeakyReLU";It(XM);class YM extends ue{constructor(t){if(super(t??{}),this.DEFAULT_ALPHA_INITIALIZER="zeros",t==null&&(t={}),this.supportsMasking=!0,this.alphaInitializer=rn(t.alphaInitializer||this.DEFAULT_ALPHA_INITIALIZER),this.alphaRegularizer=on(t.alphaRegularizer),this.alphaConstraint=zn(t.alphaConstraint),t.sharedAxes==null)this.sharedAxes=null;else if(Array.isArray(t.sharedAxes))this.sharedAxes=t.sharedAxes;else if(typeof t.sharedAxes=="number")this.sharedAxes=[t.sharedAxes];else throw new X(`Expected sharedAxes to be a number or an array of numbers, but got ${t.sharedAxes}`)}build(t){t=Ae(t);const e=t.slice(1);if(this.sharedAxes!=null)for(const r of this.sharedAxes)e[r-1]=1;this.alpha=this.addWeight("alpha",e,"float32",this.alphaInitializer,this.alphaRegularizer,!0,this.alphaConstraint);const s={};if(this.sharedAxes!=null)for(let r=1;r<t.length;++r)s[r]=t[r];this.inputSpec=[new Pn({ndim:t.length,axes:s})],this.built=!0}call(t,e){return t=Zt(t),ES(t,this.alpha.read())}getConfig(){const t={alphaInitializer:cn(this.alphaInitializer),alphaRegularizer:Ye(this.alphaRegularizer),alphaConstraint:Vn(this.alphaConstraint),sharedAxes:this.sharedAxes},e=super.getConfig();return Object.assign(t,e),t}}YM.className="PReLU";It(YM);let QM=class extends ue{constructor(t){if(super(t??{}),this.DEFAULT_ALPHA=1,t==null&&(t={}),t.alpha!=null&&t.alpha!==this.DEFAULT_ALPHA)throw new re(`Non-default alpha value (${t.alpha}) is not supported by the ELU layer yet.`);this.alpha=t.alpha==null?this.DEFAULT_ALPHA:t.alpha}call(t,e){const s=Zt(t);return xx(s)}computeOutputShape(t){return t}getConfig(){const t={alpha:this.alpha},e=super.getConfig();return Object.assign(t,e),t}};QM.className="ELU";It(QM);class ZM extends ue{constructor(t){super(t??{}),this.DEFAULT_THETA=1,t==null&&(t={}),this.theta=t.theta==null?this.DEFAULT_THETA:t.theta}call(t,e){const s=Zt(t);return J(s,Ot(Tr(s,this.theta),"float32"))}computeOutputShape(t){return t}getConfig(){const t={theta:this.theta},e=super.getConfig();return Object.assign(t,e),t}}ZM.className="ThresholdedReLU";It(ZM);class JM extends ue{constructor(t){super(t??{}),this.DEFAULT_AXIS=1,t==null&&(t={}),this.softmax=new _T().apply,this.axis=t.axis==null?this.DEFAULT_AXIS:t.axis}call(t,e){return ct(()=>{let s=Zt(t);const r=e.mask;if(r!=null){const i=J(Yt(nl(s.shape),Ot(r,s.dtype)),De(-1e9));s=kt(s,i)}return this.axis instanceof Array?this.axis.length>1?Qi(Yt(s,zD(s,this.axis,!0))):this.softmax(s,this.axis[0]):this.softmax(s,this.axis)})}computeOutputShape(t){return t}getConfig(){const t={axis:this.axis},e=super.getConfig();return Object.assign(t,e),t}}JM.className="Softmax";It(JM);/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function Fc(n,t,e){if(typeof n=="number")return hu(n,t);if(n.length!==t)throw new X(`The ${e} argument must be an integer or tuple of ${t} integers. Received: ${n.length} elements.`);for(let s=0;s<t;++s){const r=n[s];if(!tY(r))throw new X(`The ${e} argument must be an integer or tuple of ${t} integers. Received: ${JSON.stringify(n)} including a non-integer number ${r}`)}return n}function hi(n,t,e,s,r=1){if(n==null)return n;const i=t+(t-1)*(r-1);let o;return e==="same"?o=n:o=n-i+1,Math.floor((o+s-1)/s)}function Li(n,t,e,s){if(n==null)return null;if(s==="valid")n=n*t+Ha([e-t,0]);else if(s==="same")n=n*t;else throw new X(`Unsupport padding mode: ${s}.`);return n}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function kT(n,t){return ct(()=>(Sn(t),t==="channelsFirst"?ve(n,[0,2,3,1]):n))}function t3(n,t){return ct(()=>(Sn(t),t==="channelsFirst"?ve(n,[0,2,3,4,1]):n))}function SQ(n,t,e,s=1,r="valid",i,o=1){return ct(()=>{if(i==null&&(i=fi()),Sn(i),n.shape.length!==3)throw new X(`The input of a conv1dWithBias operation should be 3, but is ${n.shape.length} instead.`);if(t.shape.length!==3)throw new X(`The kernel for a conv1dWithBias operation should be 3, but is ${t.shape.length} instead`);if(e!=null&&e.shape.length!==1)throw new X(`The bias for a conv1dWithBias operation should be 1, but is ${e.shape.length} instead`);if(i==="channelsFirst"&&(n=ve(n,[0,2,1])),r==="causal")throw new re("The support for CAUSAL padding mode in conv1dWithBias is not implemented yet.");let l=AD(n,t,s,r==="same"?"same":"valid","NWC",o);return e!=null&&(l=mi(l,e)),l})}function FA(n,t,e,s=[1,1],r="valid",i,o,l=null){return ct(()=>{if(i==null&&(i=fi()),Sn(i),n.rank!==3&&n.rank!==4)throw new X(`conv2dWithBiasActivation expects input to be of rank 3 or 4, but received ${n.rank}.`);if(t.rank!==3&&t.rank!==4)throw new X(`conv2dWithBiasActivation expects kernel to be of rank 3 or 4, but received ${n.rank}.`);let u=kT(n,i);if(r==="causal")throw new re("The support for CAUSAL padding mode in conv1dWithBias is not implemented yet.");return u=w8({x:u,filter:t,strides:s,pad:r==="same"?"same":"valid",dilations:o,dataFormat:"NHWC",bias:e,activation:l}),i==="channelsFirst"&&(u=ve(u,[0,3,1,2])),u})}function TQ(n,t,e,s=[1,1,1],r="valid",i,o){return ct(()=>{if(i==null&&(i=fi()),Sn(i),n.rank!==4&&n.rank!==5)throw new X(`conv3dWithBias expects input to be of rank 4 or 5, but received ${n.rank}.`);if(t.rank!==4&&t.rank!==5)throw new X(`conv3dWithBias expects kernel to be of rank 4 or 5, but received ${n.rank}.`);let l=t3(n,i);if(r==="causal")throw new re("The support for CAUSAL padding mode in conv3dWithBias is not implemented yet.");return l=y9(l,t,s,r==="same"?"same":"valid","NDHWC",o),e!=null&&(l=mi(l,e)),i==="channelsFirst"&&(l=ve(l,[0,4,1,2,3])),l})}class Nx extends ue{constructor(t,e){if(super(e),this.bias=null,this.DEFAULT_KERNEL_INITIALIZER="glorotNormal",this.DEFAULT_BIAS_INITIALIZER="zeros",Nx.verifyArgs(e),this.rank=t,Zn(this.rank,"rank"),this.rank!==1&&this.rank!==2&&this.rank!==3)throw new re(`Convolution layer for rank other than 1, 2, or 3 (${this.rank}) is not implemented yet.`);if(this.kernelSize=Fc(e.kernelSize,t,"kernelSize"),this.strides=Fc(e.strides==null?1:e.strides,t,"strides"),this.padding=e.padding==null?"valid":e.padding,Er(this.padding),this.dataFormat=e.dataFormat==null?"channelsLast":e.dataFormat,Sn(this.dataFormat),this.activation=ja(e.activation),this.useBias=e.useBias==null?!0:e.useBias,this.biasInitializer=rn(e.biasInitializer||this.DEFAULT_BIAS_INITIALIZER),this.biasConstraint=zn(e.biasConstraint),this.biasRegularizer=on(e.biasRegularizer),this.activityRegularizer=on(e.activityRegularizer),this.dilationRate=Fc(e.dilationRate==null?1:e.dilationRate,t,"dilationRate"),this.rank===1&&Array.isArray(this.dilationRate)&&this.dilationRate.length!==1)throw new X(`dilationRate must be a number or an array of a single number for 1D convolution, but received ${JSON.stringify(this.dilationRate)}`);if(this.rank===2){if(typeof this.dilationRate=="number")this.dilationRate=[this.dilationRate,this.dilationRate];else if(this.dilationRate.length!==2)throw new X(`dilationRate must be a number or array of two numbers for 2D convolution, but received ${JSON.stringify(this.dilationRate)}`)}else if(this.rank===3){if(typeof this.dilationRate=="number")this.dilationRate=[this.dilationRate,this.dilationRate,this.dilationRate];else if(this.dilationRate.length!==3)throw new X(`dilationRate must be a number or array of three numbers for 3D convolution, but received ${JSON.stringify(this.dilationRate)}`)}}static verifyArgs(t){if(Fi("kernelSize"in t,"required key 'kernelSize' not in config"),typeof t.kernelSize!="number"&&!pT(t.kernelSize,"number",1,3))throw new X(`BaseConv expects config.kernelSize to be number or number[] with length 1, 2, or 3, but received ${JSON.stringify(t.kernelSize)}.`)}getConfig(){const t={kernelSize:this.kernelSize,strides:this.strides,padding:this.padding,dataFormat:this.dataFormat,dilationRate:this.dilationRate,activation:qa(this.activation),useBias:this.useBias,biasInitializer:cn(this.biasInitializer),biasRegularizer:Ye(this.biasRegularizer),activityRegularizer:Ye(this.activityRegularizer),biasConstraint:Vn(this.biasConstraint)},e=super.getConfig();return Object.assign(t,e),t}}class mh extends Nx{constructor(t,e){super(t,e),this.kernel=null,mh.verifyArgs(e),this.filters=e.filters,Zn(this.filters,"filters"),this.kernelInitializer=rn(e.kernelInitializer||this.DEFAULT_KERNEL_INITIALIZER),this.kernelConstraint=zn(e.kernelConstraint),this.kernelRegularizer=on(e.kernelRegularizer)}build(t){t=Ae(t);const e=this.dataFormat==="channelsFirst"?1:t.length-1;if(t[e]==null)throw new X(`The channel dimension of the input should be defined. Found ${t[e]}`);const s=t[e],r=this.kernelSize.concat([s,this.filters]);this.kernel=this.addWeight("kernel",r,null,this.kernelInitializer,this.kernelRegularizer,!0,this.kernelConstraint),this.useBias&&(this.bias=this.addWeight("bias",[this.filters],null,this.biasInitializer,this.biasRegularizer,!0,this.biasConstraint)),this.inputSpec=[{ndim:this.rank+2,axes:{[e]:s}}],this.built=!0}call(t,e){return ct(()=>{t=Zt(t);let s;const r=this.bias==null?null:this.bias.read(),i=YO(this.activation.getClassName());if(i!=null&&this.rank===2)s=FA(t,this.kernel.read(),r,this.strides,this.padding,this.dataFormat,this.dilationRate,i);else{if(this.rank===1)s=SQ(t,this.kernel.read(),r,this.strides[0],this.padding,this.dataFormat,this.dilationRate[0]);else if(this.rank===2)s=FA(t,this.kernel.read(),r,this.strides,this.padding,this.dataFormat,this.dilationRate);else if(this.rank===3)s=TQ(t,this.kernel.read(),r,this.strides,this.padding,this.dataFormat,this.dilationRate);else throw new re("convolutions greater than 3D are not implemented yet.");this.activation!=null&&(s=this.activation.apply(s))}return s})}computeOutputShape(t){t=Ae(t);const e=[],s=this.dataFormat==="channelsLast"?t.slice(1,t.length-1):t.slice(2);for(let i=0;i<s.length;++i){const o=hi(s[i],this.kernelSize[i],this.padding,this.strides[i],typeof this.dilationRate=="number"?this.dilationRate:this.dilationRate[i]);e.push(o)}let r=[t[0]];return this.dataFormat==="channelsLast"?(r=r.concat(e),r.push(this.filters)):(r.push(this.filters),r=r.concat(e)),r}getConfig(){const t={filters:this.filters,kernelInitializer:cn(this.kernelInitializer),kernelRegularizer:Ye(this.kernelRegularizer),kernelConstraint:Vn(this.kernelConstraint)},e=super.getConfig();return Object.assign(t,e),t}static verifyArgs(t){if(!("filters"in t)||typeof t.filters!="number"||t.filters<1)throw new X(`Convolution layer expected config.filters to be a 'number' > 0 but got ${JSON.stringify(t.filters)}`)}}class Gp extends mh{constructor(t){super(2,t),Gp.verifyArgs(t)}getConfig(){const t=super.getConfig();return delete t.rank,t}static verifyArgs(t){if(typeof t.kernelSize!="number"&&!pT(t.kernelSize,"number",1,2))throw new X(`Conv2D expects config.kernelSize to be number or number[] with length 1 or 2, but received ${JSON.stringify(t.kernelSize)}.`)}}Gp.className="Conv2D";It(Gp);class Wp extends mh{constructor(t){super(3,t),Wp.verifyArgs(t)}getConfig(){const t=super.getConfig();return delete t.rank,t}static verifyArgs(t){if(typeof t.kernelSize!="number"&&!(Array.isArray(t.kernelSize)&&(t.kernelSize.length===1||t.kernelSize.length===3)))throw new X(`Conv3D expects config.kernelSize to be number or [number, number, number], but received ${JSON.stringify(t.kernelSize)}.`)}}Wp.className="Conv3D";It(Wp);class e3 extends Gp{constructor(t){if(super(t),this.inputSpec=[new Pn({ndim:4})],this.padding!=="same"&&this.padding!=="valid")throw new X(`Conv2DTranspose currently supports only padding modes 'same' and 'valid', but received padding mode ${this.padding}`)}build(t){if(t=Ae(t),t.length!==4)throw new X("Input should have rank 4; Received input shape: "+JSON.stringify(t));const e=this.dataFormat==="channelsFirst"?1:t.length-1;if(t[e]==null)throw new X("The channel dimension of the inputs should be defined. Found `None`.");const s=t[e],r=this.kernelSize.concat([this.filters,s]);this.kernel=this.addWeight("kernel",r,"float32",this.kernelInitializer,this.kernelRegularizer,!0,this.kernelConstraint),this.useBias&&(this.bias=this.addWeight("bias",[this.filters],"float32",this.biasInitializer,this.biasRegularizer,!0,this.biasConstraint)),this.inputSpec=[new Pn({ndim:4,axes:{[e]:s}})],this.built=!0}call(t,e){return ct(()=>{let s=Zt(t);if(s.shape.length!==4)throw new X(`Conv2DTranspose.call() expects input tensor to be rank-4, but received a tensor of rank-${s.shape.length}`);const r=s.shape,i=r[0];let o,l;this.dataFormat==="channelsFirst"?(o=2,l=3):(o=1,l=2);const u=r[o],h=r[l],d=this.kernelSize[0],p=this.kernelSize[1],m=this.strides[0],y=this.strides[1],x=Li(u,m,d,this.padding),v=Li(h,y,p,this.padding),C=[i,x,v,this.filters];this.dataFormat!=="channelsLast"&&(s=ve(s,[0,2,3,1]));let S=ND(s,this.kernel.read(),C,this.strides,this.padding);return this.dataFormat!=="channelsLast"&&(S=ve(S,[0,3,1,2])),this.bias!=null&&(S=mi(S,this.bias.read(),this.dataFormat)),this.activation!=null&&(S=this.activation.apply(S)),S})}computeOutputShape(t){t=Ae(t);const e=t.slice();let s,r,i;this.dataFormat==="channelsFirst"?(s=1,r=2,i=3):(s=3,r=1,i=2);const o=this.kernelSize[0],l=this.kernelSize[1],u=this.strides[0],h=this.strides[1];return e[s]=this.filters,e[r]=Li(e[r],u,o,this.padding),e[i]=Li(e[i],h,l,this.padding),e}getConfig(){const t=super.getConfig();return delete t.dilationRate,t}}e3.className="Conv2DTranspose";It(e3);class n3 extends Wp{constructor(t){if(super(t),this.inputSpec=[new Pn({ndim:5})],this.padding!=="same"&&this.padding!=="valid")throw new X(`Conv3DTranspose currently supports only padding modes 'same' and 'valid', but received padding mode ${this.padding}`)}build(t){if(t=Ae(t),t.length!==5)throw new X("Input should have rank 5; Received input shape: "+JSON.stringify(t));const e=this.dataFormat==="channelsFirst"?1:t.length-1;if(t[e]==null)throw new X("The channel dimension of the inputs should be defined. Found `None`.");const s=t[e],r=this.kernelSize.concat([this.filters,s]);this.kernel=this.addWeight("kernel",r,"float32",this.kernelInitializer,this.kernelRegularizer,!0,this.kernelConstraint),this.useBias&&(this.bias=this.addWeight("bias",[this.filters],"float32",this.biasInitializer,this.biasRegularizer,!0,this.biasConstraint)),this.inputSpec=[new Pn({ndim:5,axes:{[e]:s}})],this.built=!0}call(t,e){return ct(()=>{let s=Zt(t);if(s.shape.length!==5)throw new X(`Conv3DTranspose.call() expects input tensor to be rank-4, but received a tensor of rank-${s.shape.length}`);const r=s.shape,i=r[0];let o,l,u;this.dataFormat==="channelsFirst"?(u=2,o=3,l=4):(u=1,o=2,l=3);const h=r[u],d=r[o],p=r[l],m=this.kernelSize[0],y=this.kernelSize[1],x=this.kernelSize[2],v=this.strides[0],C=this.strides[1],S=this.strides[2],E=Li(h,v,m,this.padding),_=Li(d,C,y,this.padding),I=Li(p,S,x,this.padding),O=[i,E,_,I,this.filters];this.dataFormat!=="channelsLast"&&(s=ve(s,[0,2,3,4,1]));let P=v9(s,this.kernel.read(),O,this.strides,this.padding);return this.dataFormat!=="channelsLast"&&(P=ve(P,[0,4,1,2,3])),this.bias!==null&&(P=mi(P,this.bias.read(),this.dataFormat)),this.activation!==null&&(P=this.activation.apply(P)),P})}computeOutputShape(t){t=Ae(t);const e=t.slice();let s,r,i,o;this.dataFormat==="channelsFirst"?(s=1,r=2,i=3,o=4):(s=4,r=1,i=2,o=3);const l=this.kernelSize[0],u=this.kernelSize[1],h=this.kernelSize[2],d=this.strides[0],p=this.strides[1],m=this.strides[2];return e[s]=this.filters,e[r]=Li(e[r],d,l,this.padding),e[i]=Li(e[i],p,u,this.padding),e[o]=Li(e[o],m,h,this.padding),e}getConfig(){const t=super.getConfig();return delete t.dilationRate,t}}n3.className="Conv3DTranspose";It(n3);class s3 extends mh{constructor(t,e){if(super(t,e),this.DEFAULT_DEPTHWISE_INITIALIZER="glorotUniform",this.DEFAULT_POINTWISE_INITIALIZER="glorotUniform",this.depthwiseKernel=null,this.pointwiseKernel=null,e.filters==null)throw new X("The `filters` configuration field is required by SeparableConv, but is unspecified.");if(e.kernelInitializer!=null||e.kernelRegularizer!=null||e.kernelConstraint!=null)throw new X("Fields kernelInitializer, kernelRegularizer and kernelConstraint are invalid for SeparableConv2D. Use depthwiseInitializer, depthwiseRegularizer, depthwiseConstraint, pointwiseInitializer, pointwiseRegularizer and pointwiseConstraint instead.");if(e.padding!=null&&e.padding!=="same"&&e.padding!=="valid")throw new X(`SeparableConv${this.rank}D supports only padding modes: 'same' and 'valid', but received ${JSON.stringify(e.padding)}`);this.depthMultiplier=e.depthMultiplier==null?1:e.depthMultiplier,this.depthwiseInitializer=rn(e.depthwiseInitializer||this.DEFAULT_DEPTHWISE_INITIALIZER),this.depthwiseRegularizer=on(e.depthwiseRegularizer),this.depthwiseConstraint=zn(e.depthwiseConstraint),this.pointwiseInitializer=rn(e.depthwiseInitializer||this.DEFAULT_POINTWISE_INITIALIZER),this.pointwiseRegularizer=on(e.pointwiseRegularizer),this.pointwiseConstraint=zn(e.pointwiseConstraint)}build(t){if(t=Ae(t),t.length<this.rank+2)throw new X(`Inputs to SeparableConv${this.rank}D should have rank ${this.rank+2}, but received input shape: ${JSON.stringify(t)}`);const e=this.dataFormat==="channelsFirst"?1:t.length-1;if(t[e]==null||t[e]<0)throw new X(`The channel dimension of the inputs should be defined, but found ${JSON.stringify(t[e])}`);const s=t[e],r=this.kernelSize.concat([s,this.depthMultiplier]),i=[];for(let l=0;l<this.rank;++l)i.push(1);i.push(s*this.depthMultiplier,this.filters);const o=!0;this.depthwiseKernel=this.addWeight("depthwise_kernel",r,"float32",this.depthwiseInitializer,this.depthwiseRegularizer,o,this.depthwiseConstraint),this.pointwiseKernel=this.addWeight("pointwise_kernel",i,"float32",this.pointwiseInitializer,this.pointwiseRegularizer,o,this.pointwiseConstraint),this.useBias?this.bias=this.addWeight("bias",[this.filters],"float32",this.biasInitializer,this.biasRegularizer,o,this.biasConstraint):this.bias=null,this.inputSpec=[new Pn({ndim:this.rank+2,axes:{[e]:s}})],this.built=!0}call(t,e){return ct(()=>{t=Zt(t);let s;if(this.rank===1)throw new re("1D separable convolution is not implemented yet.");return this.rank===2&&(this.dataFormat==="channelsFirst"&&(t=ve(t,[0,2,3,1])),s=KD(t,this.depthwiseKernel.read(),this.pointwiseKernel.read(),this.strides,this.padding,this.dilationRate,"NHWC")),this.useBias&&(s=mi(s,this.bias.read(),this.dataFormat)),this.activation!=null&&(s=this.activation.apply(s)),this.dataFormat==="channelsFirst"&&(s=ve(s,[0,3,1,2])),s})}getConfig(){const t=super.getConfig();return delete t.rank,delete t.kernelInitializer,delete t.kernelRegularizer,delete t.kernelConstraint,t.depthwiseInitializer=cn(this.depthwiseInitializer),t.pointwiseInitializer=cn(this.pointwiseInitializer),t.depthwiseRegularizer=Ye(this.depthwiseRegularizer),t.pointwiseRegularizer=Ye(this.pointwiseRegularizer),t.depthwiseConstraint=Vn(this.depthwiseConstraint),t.pointwiseConstraint=Vn(this.pointwiseConstraint),t}}s3.className="SeparableConv";class r3 extends s3{constructor(t){super(2,t)}}r3.className="SeparableConv2D";It(r3);class Rx extends mh{constructor(t){super(1,t),Rx.verifyArgs(t),this.inputSpec=[{ndim:3}]}getConfig(){const t=super.getConfig();return delete t.rank,delete t.dataFormat,t}static verifyArgs(t){if(typeof t.kernelSize!="number"&&!pT(t.kernelSize,"number",1,1))throw new X(`Conv1D expects config.kernelSize to be number or number[] with length 1, but received ${JSON.stringify(t.kernelSize)}.`)}}Rx.className="Conv1D";It(Rx);class i3 extends ue{constructor(t){super(t),typeof t.cropping=="number"?this.cropping=[[t.cropping,t.cropping],[t.cropping,t.cropping]]:typeof t.cropping[0]=="number"?this.cropping=[[t.cropping[0],t.cropping[0]],[t.cropping[1],t.cropping[1]]]:this.cropping=t.cropping,this.dataFormat=t.dataFormat===void 0?"channelsLast":t.dataFormat,this.inputSpec=[{ndim:4}]}computeOutputShape(t){return this.dataFormat==="channelsFirst"?[t[0],t[1],t[2]-this.cropping[0][0]-this.cropping[0][1],t[3]-this.cropping[1][0]-this.cropping[1][1]]:[t[0],t[1]-this.cropping[0][0]-this.cropping[0][1],t[2]-this.cropping[1][0]-this.cropping[1][1],t[3]]}call(t,e){return ct(()=>{if(t=Zt(t),this.dataFormat==="channelsLast"){const s=kg(t,this.cropping[0][0],t.shape[1]-this.cropping[0][0]-this.cropping[0][1],2);return kg(s,this.cropping[1][0],t.shape[2]-this.cropping[1][1]-this.cropping[1][0],3)}else{const s=kg(t,this.cropping[0][0],t.shape[2]-this.cropping[0][0]-this.cropping[0][1],3);return kg(s,this.cropping[1][0],t.shape[3]-this.cropping[1][1]-this.cropping[1][0],4)}})}getConfig(){const t={cropping:this.cropping,dataFormat:this.dataFormat},e=super.getConfig();return Object.assign(t,e),t}}i3.className="Cropping2D";It(i3);class o3 extends ue{constructor(t){super(t),this.DEFAULT_SIZE=[2,2],this.inputSpec=[{ndim:4}],this.size=t.size==null?this.DEFAULT_SIZE:t.size,this.dataFormat=t.dataFormat==null?"channelsLast":t.dataFormat,Sn(this.dataFormat),this.interpolation=t.interpolation==null?"nearest":t.interpolation,QX(this.interpolation)}computeOutputShape(t){if(this.dataFormat==="channelsFirst"){const e=t[2]==null?null:this.size[0]*t[2],s=t[3]==null?null:this.size[1]*t[3];return[t[0],t[1],e,s]}else{const e=t[1]==null?null:this.size[0]*t[1],s=t[2]==null?null:this.size[1]*t[2];return[t[0],e,s,t[3]]}}call(t,e){return ct(()=>{let s=Zt(t);const r=s.shape;if(this.dataFormat==="channelsFirst"){s=ve(s,[0,2,3,1]);const i=this.size[0]*r[2],o=this.size[1]*r[3],l=this.interpolation==="nearest"?Do.resizeNearestNeighbor(s,[i,o]):Do.resizeBilinear(s,[i,o]);return ve(l,[0,3,1,2])}else{const i=this.size[0]*r[1],o=this.size[1]*r[2];return this.interpolation==="nearest"?Do.resizeNearestNeighbor(s,[i,o]):Do.resizeBilinear(s,[i,o])}})}getConfig(){const t={size:this.size,dataFormat:this.dataFormat,interpolation:this.interpolation},e=super.getConfig();return Object.assign(t,e),t}}o3.className="UpSampling2D";It(o3);/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function EQ(n,t,e=[1,1],s="valid",r,i){return ct(()=>{r==null&&(r=fi()),Sn(r);let o=kT(n,r);if(n.rank!==4)throw new X(`Input for depthwiseConv2d is required to be 4-D, but is instead ${n.rank}-D`);if(t.rank!==4)throw new X(`depthwiseKernel is required to be 4-D, but is instead ${t.rank}-D`);return o=mS(o,t,e,s==="same"?"same":"valid","NHWC",i),r==="channelsFirst"&&(o=ve(o,[0,3,1,2])),o})}class a3 extends Nx{constructor(t){super(2,t),this.depthwiseKernel=null,this.depthMultiplier=t.depthMultiplier==null?1:t.depthMultiplier,this.depthwiseInitializer=rn(t.depthwiseInitializer||this.DEFAULT_KERNEL_INITIALIZER),this.depthwiseConstraint=zn(t.depthwiseConstraint),this.depthwiseRegularizer=on(t.depthwiseRegularizer)}build(t){if(t=Ae(t),t.length<4)throw new X(`Inputs to DepthwiseConv2D should have rank 4. Received input shape: ${JSON.stringify(t)}.`);const e=this.dataFormat==="channelsFirst"?1:3;if(t[e]==null||t[e]<0)throw new X(`The channel dimension of the inputs to DepthwiseConv2D should be defined, but is not (${t[e]}).`);const s=t[e],r=[this.kernelSize[0],this.kernelSize[1],s,this.depthMultiplier];this.depthwiseKernel=this.addWeight("depthwise_kernel",r,null,this.depthwiseInitializer,this.depthwiseRegularizer,!0,this.depthwiseConstraint),this.useBias?this.bias=this.addWeight("bias",[s*this.depthMultiplier],null,this.biasInitializer,this.biasRegularizer,!0,this.biasConstraint):this.bias=null,this.built=!0}call(t,e){return ct(()=>{t=Zt(t);let s=EQ(t,this.depthwiseKernel.read(),this.strides,this.padding,this.dataFormat,null);return this.useBias&&(s=mi(s,this.bias.read(),this.dataFormat)),this.activation!=null&&(s=this.activation.apply(s)),s})}computeOutputShape(t){t=Ae(t);const e=this.dataFormat==="channelsFirst"?t[2]:t[1],s=this.dataFormat==="channelsFirst"?t[3]:t[2],r=this.dataFormat==="channelsFirst"?t[1]*this.depthMultiplier:t[3]*this.depthMultiplier,i=hi(e,this.kernelSize[0],this.padding,this.strides[0]),o=hi(s,this.kernelSize[1],this.padding,this.strides[1]);return this.dataFormat==="channelsFirst"?[t[0],r,i,o]:[t[0],i,o,r]}getConfig(){const t=super.getConfig();return t.depthMultiplier=this.depthMultiplier,t.depthwiseInitializer=cn(this.depthwiseInitializer),t.depthwiseRegularizer=Ye(this.depthwiseRegularizer),t.depthwiseConstraint=Vn(this.depthwiseRegularizer),t}}a3.className="DepthwiseConv2D";It(a3);/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function l3(n,t,e,s){if(Array.isArray(n)){if(t!=null||e!=null)throw new X("When inputs is an array, neither initialState or constants should be provided");s!=null&&(e=n.slice(n.length-s,n.length),n=n.slice(0,n.length-s)),n.length>1&&(t=n.slice(1,n.length)),n=n[0]}function r(i){return i==null||Array.isArray(i)?i:[i]}return t=r(t),e=r(e),{inputs:n,initialState:t,constants:e}}function u3(n,t,e,s=!1,r,i,o=!1,l=!1){return ct(()=>{const u=t.shape.length;if(u<3)throw new X(`Input should be at least 3D, but is ${u}D.`);const h=[1,0].concat(di(2,u));t=ve(t,h),o&&console.warn("Backend rnn(): the unroll = true option is not applicable to the imperative deeplearn.js backend."),r!=null&&(r=Ot(Ot(r,"bool"),"float32"),r.rank===u-1&&(r=js(r,-1)),r=ve(r,h)),s&&(t=uu(t,0),r!=null&&(r=uu(r,0)));const d=[];let p,m=e;const y=t.shape[0],x=cu(t);let v;r!=null&&(v=cu(r));for(let S=0;S<y;++S){const E=x[S],_=ct(()=>n(E,m));if(r==null)p=_[0],m=_[1];else{const I=ct(()=>{const O=v[S],P=Yt(jr(O),O),D=kt(J(_[0],O),J(m[0],P)),N=m.map((R,$)=>kt(J(_[1][$],O),J(R,P)));return{output:D,newStates:N}});p=I.output,m=I.newStates}l&&d.push(p)}let C;return l&&(C=Bo(d,1)),[p,C,m]})}class rl extends ue{constructor(t){super(t);let e;if(t.cell==null)throw new X("cell property is missing for the constructor of RNN.");if(Array.isArray(t.cell)?e=new RT({cells:t.cell}):e=t.cell,e.stateSize==null)throw new X("The RNN cell should have an attribute `stateSize` (tuple of integers, one integer per RNN state).");this.cell=e,this.returnSequences=t.returnSequences==null?!1:t.returnSequences,this.returnState=t.returnState==null?!1:t.returnState,this.goBackwards=t.goBackwards==null?!1:t.goBackwards,this._stateful=t.stateful==null?!1:t.stateful,this.unroll=t.unroll==null?!1:t.unroll,this.supportsMasking=!0,this.inputSpec=[new Pn({ndim:3})],this.stateSpec=null,this.states_=null,this.numConstants=null,this.keptStates=[]}getStates(){if(this.states_==null){const t=Array.isArray(this.cell.stateSize)?this.cell.stateSize.length:1;return di(0,t).map(e=>null)}else return this.states_}setStates(t){this.states_=t}computeOutputShape(t){xw(t)&&(t=t[0]),t=t;let e=this.cell.stateSize;Array.isArray(e)||(e=[e]);const s=e[0];let r;if(this.returnSequences?r=[t[0],t[1],s]:r=[t[0],s],this.returnState){const i=[];for(const o of e)i.push([t[0],o]);return[r].concat(i)}else return r}computeMask(t,e){return ct(()=>{Array.isArray(e)&&(e=e[0]);const s=this.returnSequences?e:null;if(this.returnState){const r=this.states.map(i=>null);return[s].concat(r)}else return s})}get states(){if(this.states_==null){const t=Array.isArray(this.cell.stateSize)?this.cell.stateSize.length:1,e=[];for(let s=0;s<t;++s)e.push(null);return e}else return this.states_}set states(t){this.states_=t}build(t){if(this.numConstants!=null)throw new re("Constants support is not implemented in RNN yet.");xw(t)&&(t=t[0]),t=t;const e=this.stateful?t[0]:null,s=t.slice(2);this.inputSpec[0]=new Pn({shape:[e,null,...s]});const r=[t[0]].concat(t.slice(2));this.cell.build(r);let i;if(Array.isArray(this.cell.stateSize)?i=this.cell.stateSize:i=[this.cell.stateSize],this.stateSpec!=null){if(!Oe(this.stateSpec.map(o=>o.shape[o.shape.length-1]),i))throw new X(`An initialState was passed that is not compatible with cell.stateSize. Received stateSpec=${this.stateSpec}; However cell.stateSize is ${this.cell.stateSize}`)}else this.stateSpec=i.map(o=>new Pn({shape:[null,o]}));this.stateful&&this.resetStates()}resetStates(t,e=!1){ct(()=>{if(!this.stateful)throw new Mi("Cannot call resetStates() on an RNN Layer that is not stateful.");const s=this.inputSpec[0].shape[0];if(s==null)throw new X("If an RNN is stateful, it needs to know its batch size. Specify the batch size of your input tensors: \n- If using a Sequential model, specify the batch size by passing a `batchInputShape` option to your first layer.\n- If using the functional API, specify the batch size by passing a `batchShape` option to your Input layer.");if(this.states_==null)Array.isArray(this.cell.stateSize)?this.states_=this.cell.stateSize.map(r=>Qn([s,r])):this.states_=[Qn([s,this.cell.stateSize])];else if(t==null)oe(this.states_),this.keptStates!=null&&(oe(this.keptStates),this.keptStates=[]),Array.isArray(this.cell.stateSize)?this.states_=this.cell.stateSize.map(r=>Qn([s,r])):this.states_[0]=Qn([s,this.cell.stateSize]);else{if(Array.isArray(t)||(t=[t]),t.length!==this.states_.length)throw new X(`Layer ${this.name} expects ${this.states_.length} state(s), but it received ${t.length} state value(s). Input received: ${t}`);e===!0?this.keptStates.push(this.states_.slice()):oe(this.states_);for(let r=0;r<this.states_.length;++r){const i=t[r],o=Array.isArray(this.cell.stateSize)?this.cell.stateSize[r]:this.cell.stateSize,l=[s,o];if(!Oe(i.shape,l))throw new X(`State ${r} is incompatible with layer ${this.name}: expected shape=${l}, received shape=${i.shape}`);this.states_[r]=i}}this.states_=this.states_.map(r=>Ui(r.clone()))})}apply(t,e){let s=e==null?null:e.initialState,r=e==null?null:e.constants;e==null&&(e={});const i=l3(t,s,r,this.numConstants);t=i.inputs,s=i.initialState,r=i.constants;let o=[],l=[];if(s!=null){e.initialState=s,o=o.concat(s),this.stateSpec=[];for(const h of s)this.stateSpec.push(new Pn({shape:h.shape}));l=l.concat(this.stateSpec)}if(r!=null&&(e.constants=r,o=o.concat(r),this.numConstants=r.length),o[0]instanceof Ji){const h=[t].concat(o),d=this.inputSpec.concat(l),p=this.inputSpec;this.inputSpec=d;const m=super.apply(h,e);return this.inputSpec=p,m}else return super.apply(t,e)}call(t,e){return ct(()=>{const s=e==null?null:e.mask,r=e==null?null:e.training;let i=e==null?null:e.initialState;t=Zt(t),i==null&&(this.stateful?i=this.states_:i=this.getInitialState(t));const o=Array.isArray(this.cell.stateSize)?this.cell.stateSize.length:1;if(i.length!==o)throw new X(`RNN Layer has ${o} state(s) but was passed ${i.length} initial state(s).`);this.unroll&&console.warn("Ignoring unroll = true for RNN layer, due to imperative backend.");const l={training:r},h=u3((x,v)=>{const C=this.cell.call([x].concat(v),l);return[C[0],C.slice(1)]},t,i,this.goBackwards,s,null,this.unroll,this.returnSequences),d=h[0],p=h[1],m=h[2];this.stateful&&this.resetStates(m,r);const y=this.returnSequences?p:d;return this.returnState?[y].concat(m):y})}getInitialState(t){return ct(()=>{let e=Qn(t.shape);return e=Gt(e,[1,2]),e=Pp(e),Array.isArray(this.cell.stateSize)?this.cell.stateSize.map(s=>s>1?gw(e,[1,s]):e):this.cell.stateSize>1?[gw(e,[1,this.cell.stateSize])]:[e]})}get trainableWeights(){return this.trainable?this.cell.trainableWeights:[]}get nonTrainableWeights(){return this.trainable?this.cell.nonTrainableWeights:this.cell.weights}setFastWeightInitDuringBuild(t){super.setFastWeightInitDuringBuild(t),this.cell!=null&&this.cell.setFastWeightInitDuringBuild(t)}getConfig(){const t=super.getConfig(),e={returnSequences:this.returnSequences,returnState:this.returnState,goBackwards:this.goBackwards,stateful:this.stateful,unroll:this.unroll};this.numConstants!=null&&(e.numConstants=this.numConstants);const s=this.cell.getConfig();return this.getClassName()===rl.className&&(e.cell={className:this.cell.getClassName(),config:s}),Object.assign(Object.assign(Object.assign({},s),t),e)}static fromConfig(t,e,s={}){const r=e.cell,i=qi(r,s);return new t(Object.assign(e,{cell:i}))}}rl.className="RNN";It(rl);class $x extends ue{}class AT extends $x{constructor(t){super(t),this.DEFAULT_ACTIVATION="tanh",this.DEFAULT_KERNEL_INITIALIZER="glorotNormal",this.DEFAULT_RECURRENT_INITIALIZER="orthogonal",this.DEFAULT_BIAS_INITIALIZER="zeros",this.units=t.units,Zn(this.units,"units"),this.activation=ja(t.activation==null?this.DEFAULT_ACTIVATION:t.activation),this.useBias=t.useBias==null?!0:t.useBias,this.kernelInitializer=rn(t.kernelInitializer||this.DEFAULT_KERNEL_INITIALIZER),this.recurrentInitializer=rn(t.recurrentInitializer||this.DEFAULT_RECURRENT_INITIALIZER),this.biasInitializer=rn(t.biasInitializer||this.DEFAULT_BIAS_INITIALIZER),this.kernelRegularizer=on(t.kernelRegularizer),this.recurrentRegularizer=on(t.recurrentRegularizer),this.biasRegularizer=on(t.biasRegularizer),this.kernelConstraint=zn(t.kernelConstraint),this.recurrentConstraint=zn(t.recurrentConstraint),this.biasConstraint=zn(t.biasConstraint),this.dropout=Xc([1,Ha([0,t.dropout==null?0:t.dropout])]),this.recurrentDropout=Xc([1,Ha([0,t.recurrentDropout==null?0:t.recurrentDropout])]),this.dropoutFunc=t.dropoutFunc,this.stateSize=this.units,this.dropoutMask=null,this.recurrentDropoutMask=null}build(t){t=Ae(t),this.kernel=this.addWeight("kernel",[t[t.length-1],this.units],null,this.kernelInitializer,this.kernelRegularizer,!0,this.kernelConstraint),this.recurrentKernel=this.addWeight("recurrent_kernel",[this.units,this.units],null,this.recurrentInitializer,this.recurrentRegularizer,!0,this.recurrentConstraint),this.useBias?this.bias=this.addWeight("bias",[this.units],null,this.biasInitializer,this.biasRegularizer,!0,this.biasConstraint):this.bias=null,this.built=!0}call(t,e){return ct(()=>{if(t=t,t.length!==2)throw new X(`SimpleRNNCell expects 2 input Tensors, got ${t.length}.`);let s=t[1];t=t[0];const r=e.training==null?!1:e.training;0<this.dropout&&this.dropout<1&&this.dropoutMask==null&&(this.dropoutMask=Ka({ones:()=>jr(t),rate:this.dropout,training:r,dropoutFunc:this.dropoutFunc})),0<this.recurrentDropout&&this.recurrentDropout<1&&this.recurrentDropoutMask==null&&(this.recurrentDropoutMask=Ka({ones:()=>jr(s),rate:this.recurrentDropout,training:r,dropoutFunc:this.dropoutFunc}));let i;const o=this.dropoutMask,l=this.recurrentDropoutMask;o!=null?i=Hi(J(t,o),this.kernel.read()):i=Hi(t,this.kernel.read()),this.bias!=null&&(i=mi(i,this.bias.read())),l!=null&&(s=J(s,l));let u=kt(i,Hi(s,this.recurrentKernel.read()));return this.activation!=null&&(u=this.activation.apply(u)),[u,u]})}getConfig(){const t=super.getConfig(),e={units:this.units,activation:qa(this.activation),useBias:this.useBias,kernelInitializer:cn(this.kernelInitializer),recurrentInitializer:cn(this.recurrentInitializer),biasInitializer:cn(this.biasInitializer),kernelRegularizer:Ye(this.kernelRegularizer),recurrentRegularizer:Ye(this.recurrentRegularizer),biasRegularizer:Ye(this.biasRegularizer),activityRegularizer:Ye(this.activityRegularizer),kernelConstraint:Vn(this.kernelConstraint),recurrentConstraint:Vn(this.recurrentConstraint),biasConstraint:Vn(this.biasConstraint),dropout:this.dropout,recurrentDropout:this.recurrentDropout};return Object.assign(Object.assign({},t),e)}}AT.className="SimpleRNNCell";It(AT);class c3 extends rl{constructor(t){t.cell=new AT(t),super(t)}call(t,e){return ct(()=>{this.cell.dropoutMask!=null&&(oe(this.cell.dropoutMask),this.cell.dropoutMask=null),this.cell.recurrentDropoutMask!=null&&(oe(this.cell.recurrentDropoutMask),this.cell.recurrentDropoutMask=null);const s=e==null?null:e.mask,r=e==null?null:e.training,i=e==null?null:e.initialState;return super.call(t,{mask:s,training:r,initialState:i})})}static fromConfig(t,e){return new t(e)}}c3.className="SimpleRNN";It(c3);class NT extends $x{constructor(t){if(super(t),this.DEFAULT_ACTIVATION="tanh",this.DEFAULT_RECURRENT_ACTIVATION="hardSigmoid",this.DEFAULT_KERNEL_INITIALIZER="glorotNormal",this.DEFAULT_RECURRENT_INITIALIZER="orthogonal",this.DEFAULT_BIAS_INITIALIZER="zeros",t.resetAfter)throw new X("GRUCell does not support reset_after parameter set to true.");this.units=t.units,Zn(this.units,"units"),this.activation=ja(t.activation===void 0?this.DEFAULT_ACTIVATION:t.activation),this.recurrentActivation=ja(t.recurrentActivation===void 0?this.DEFAULT_RECURRENT_ACTIVATION:t.recurrentActivation),this.useBias=t.useBias==null?!0:t.useBias,this.kernelInitializer=rn(t.kernelInitializer||this.DEFAULT_KERNEL_INITIALIZER),this.recurrentInitializer=rn(t.recurrentInitializer||this.DEFAULT_RECURRENT_INITIALIZER),this.biasInitializer=rn(t.biasInitializer||this.DEFAULT_BIAS_INITIALIZER),this.kernelRegularizer=on(t.kernelRegularizer),this.recurrentRegularizer=on(t.recurrentRegularizer),this.biasRegularizer=on(t.biasRegularizer),this.kernelConstraint=zn(t.kernelConstraint),this.recurrentConstraint=zn(t.recurrentConstraint),this.biasConstraint=zn(t.biasConstraint),this.dropout=Xc([1,Ha([0,t.dropout==null?0:t.dropout])]),this.recurrentDropout=Xc([1,Ha([0,t.recurrentDropout==null?0:t.recurrentDropout])]),this.dropoutFunc=t.dropoutFunc,this.implementation=t.implementation,this.stateSize=this.units,this.dropoutMask=null,this.recurrentDropoutMask=null}build(t){t=Ae(t);const e=t[t.length-1];this.kernel=this.addWeight("kernel",[e,this.units*3],null,this.kernelInitializer,this.kernelRegularizer,!0,this.kernelConstraint),this.recurrentKernel=this.addWeight("recurrent_kernel",[this.units,this.units*3],null,this.recurrentInitializer,this.recurrentRegularizer,!0,this.recurrentConstraint),this.useBias?this.bias=this.addWeight("bias",[this.units*3],null,this.biasInitializer,this.biasRegularizer,!0,this.biasConstraint):this.bias=null,this.built=!0}call(t,e){return ct(()=>{if(t=t,t.length!==2)throw new X(`GRUCell expects 2 input Tensors (inputs, h, c), got ${t.length}.`);const s=e.training==null?!1:e.training;let r=t[1];t=t[0],0<this.dropout&&this.dropout<1&&this.dropoutMask==null&&(this.dropoutMask=Ka({ones:()=>jr(t),rate:this.dropout,training:s,count:3,dropoutFunc:this.dropoutFunc})),0<this.recurrentDropout&&this.recurrentDropout<1&&this.recurrentDropoutMask==null&&(this.recurrentDropoutMask=Ka({ones:()=>jr(r),rate:this.recurrentDropout,training:s,count:3,dropoutFunc:this.dropoutFunc}));const i=this.dropoutMask,o=this.recurrentDropoutMask;let l,u,h;0<this.dropout&&this.dropout<1&&(t=J(t,i[0]));let d=Hi(t,this.kernel.read());this.useBias&&(d=mi(d,this.bias.read())),0<this.recurrentDropout&&this.recurrentDropout<1&&(r=J(r,o[0]));const p=this.recurrentKernel.read(),[m,y]=Cr(p,[2*this.units,this.units],p.rank-1),x=Hi(r,m),[v,C,S]=Cr(d,3,d.rank-1),[E,_]=Cr(x,2,x.rank-1);l=this.recurrentActivation.apply(kt(v,E)),u=this.recurrentActivation.apply(kt(C,_));const I=Hi(J(u,r),y);h=this.activation.apply(kt(S,I));const O=kt(J(l,r),J(kt(1,vn(l)),h));return[O,O]})}getConfig(){const t=super.getConfig(),e={units:this.units,activation:qa(this.activation),recurrentActivation:qa(this.recurrentActivation),useBias:this.useBias,kernelInitializer:cn(this.kernelInitializer),recurrentInitializer:cn(this.recurrentInitializer),biasInitializer:cn(this.biasInitializer),kernelRegularizer:Ye(this.kernelRegularizer),recurrentRegularizer:Ye(this.recurrentRegularizer),biasRegularizer:Ye(this.biasRegularizer),activityRegularizer:Ye(this.activityRegularizer),kernelConstraint:Vn(this.kernelConstraint),recurrentConstraint:Vn(this.recurrentConstraint),biasConstraint:Vn(this.biasConstraint),dropout:this.dropout,recurrentDropout:this.recurrentDropout,implementation:this.implementation,resetAfter:!1};return Object.assign(Object.assign({},t),e)}}NT.className="GRUCell";It(NT);class h3 extends rl{constructor(t){t.implementation===0&&console.warn("`implementation=0` has been deprecated, and now defaults to `implementation=1`. Please update your layer call."),t.cell=new NT(t),super(t)}call(t,e){return ct(()=>{this.cell.dropoutMask!=null&&(oe(this.cell.dropoutMask),this.cell.dropoutMask=null),this.cell.recurrentDropoutMask!=null&&(oe(this.cell.recurrentDropoutMask),this.cell.recurrentDropoutMask=null);const s=e==null?null:e.mask,r=e==null?null:e.training,i=e==null?null:e.initialState;return super.call(t,{mask:s,training:r,initialState:i})})}static fromConfig(t,e){return e.implmentation===0&&(e.implementation=1),new t(e)}}h3.className="GRU";It(h3);class Dx extends $x{constructor(t){super(t),this.DEFAULT_ACTIVATION="tanh",this.DEFAULT_RECURRENT_ACTIVATION="hardSigmoid",this.DEFAULT_KERNEL_INITIALIZER="glorotNormal",this.DEFAULT_RECURRENT_INITIALIZER="orthogonal",this.DEFAULT_BIAS_INITIALIZER="zeros",this.units=t.units,Zn(this.units,"units"),this.activation=ja(t.activation===void 0?this.DEFAULT_ACTIVATION:t.activation),this.recurrentActivation=ja(t.recurrentActivation===void 0?this.DEFAULT_RECURRENT_ACTIVATION:t.recurrentActivation),this.useBias=t.useBias==null?!0:t.useBias,this.kernelInitializer=rn(t.kernelInitializer||this.DEFAULT_KERNEL_INITIALIZER),this.recurrentInitializer=rn(t.recurrentInitializer||this.DEFAULT_RECURRENT_INITIALIZER),this.biasInitializer=rn(t.biasInitializer||this.DEFAULT_BIAS_INITIALIZER),this.unitForgetBias=t.unitForgetBias,this.kernelRegularizer=on(t.kernelRegularizer),this.recurrentRegularizer=on(t.recurrentRegularizer),this.biasRegularizer=on(t.biasRegularizer),this.kernelConstraint=zn(t.kernelConstraint),this.recurrentConstraint=zn(t.recurrentConstraint),this.biasConstraint=zn(t.biasConstraint),this.dropout=Xc([1,Ha([0,t.dropout==null?0:t.dropout])]),this.recurrentDropout=Xc([1,Ha([0,t.recurrentDropout==null?0:t.recurrentDropout])]),this.dropoutFunc=t.dropoutFunc,this.implementation=t.implementation,this.stateSize=[this.units,this.units],this.dropoutMask=null,this.recurrentDropoutMask=null}build(t){var e;t=Ae(t);const s=t[t.length-1];this.kernel=this.addWeight("kernel",[s,this.units*4],null,this.kernelInitializer,this.kernelRegularizer,!0,this.kernelConstraint),this.recurrentKernel=this.addWeight("recurrent_kernel",[this.units,this.units*4],null,this.recurrentInitializer,this.recurrentRegularizer,!0,this.recurrentConstraint);let r;if(this.useBias){if(this.unitForgetBias){const i=this.biasInitializer,o=this.units;r=new(e=class extends Xr{apply(u,h){const d=i.apply([o]),p=new gT().apply([o]),m=i.apply([o*2]);return bA(bA(d,p),m)}},e.className="CustomInit",e)}else r=this.biasInitializer;this.bias=this.addWeight("bias",[this.units*4],null,r,this.biasRegularizer,!0,this.biasConstraint)}else this.bias=null;this.built=!0}call(t,e){return ct(()=>{const s=e.training==null?!1:e.training;if(t=t,t.length!==3)throw new X(`LSTMCell expects 3 input Tensors (inputs, h, c), got ${t.length}.`);let r=t[1];const i=t[2];t=t[0],0<this.dropout&&this.dropout<1&&this.dropoutMask==null&&(this.dropoutMask=Ka({ones:()=>jr(t),rate:this.dropout,training:s,count:4,dropoutFunc:this.dropoutFunc})),0<this.recurrentDropout&&this.recurrentDropout<1&&this.recurrentDropoutMask==null&&(this.recurrentDropoutMask=Ka({ones:()=>jr(r),rate:this.recurrentDropout,training:s,count:4,dropoutFunc:this.dropoutFunc}));const o=this.dropoutMask,l=this.recurrentDropoutMask;let u,h,d,p;0<this.dropout&&this.dropout<1&&(t=J(t,o[0]));let m=Hi(t,this.kernel.read());0<this.recurrentDropout&&this.recurrentDropout<1&&(r=J(r,l[0])),m=kt(m,Hi(r,this.recurrentKernel.read())),this.useBias&&(m=mi(m,this.bias.read()));const[y,x,v,C]=Cr(m,4,m.rank-1);u=this.recurrentActivation.apply(y),h=this.recurrentActivation.apply(x),d=kt(J(h,i),J(u,this.activation.apply(v))),p=this.recurrentActivation.apply(C);const S=J(p,this.activation.apply(d));return[S,S,d]})}getConfig(){const t=super.getConfig(),e={units:this.units,activation:qa(this.activation),recurrentActivation:qa(this.recurrentActivation),useBias:this.useBias,kernelInitializer:cn(this.kernelInitializer),recurrentInitializer:cn(this.recurrentInitializer),biasInitializer:cn(this.biasInitializer),unitForgetBias:this.unitForgetBias,kernelRegularizer:Ye(this.kernelRegularizer),recurrentRegularizer:Ye(this.recurrentRegularizer),biasRegularizer:Ye(this.biasRegularizer),activityRegularizer:Ye(this.activityRegularizer),kernelConstraint:Vn(this.kernelConstraint),recurrentConstraint:Vn(this.recurrentConstraint),biasConstraint:Vn(this.biasConstraint),dropout:this.dropout,recurrentDropout:this.recurrentDropout,implementation:this.implementation};return Object.assign(Object.assign({},t),e)}}Dx.className="LSTMCell";It(Dx);class d3 extends rl{constructor(t){t.implementation===0&&console.warn("`implementation=0` has been deprecated, and now defaults to `implementation=1`. Please update your layer call."),t.cell=new Dx(t),super(t)}call(t,e){return ct(()=>{this.cell.dropoutMask!=null&&(oe(this.cell.dropoutMask),this.cell.dropoutMask=null),this.cell.recurrentDropoutMask!=null&&(oe(this.cell.recurrentDropoutMask),this.cell.recurrentDropoutMask=null);const s=e==null?null:e.mask,r=e==null?null:e.training,i=e==null?null:e.initialState;return super.call(t,{mask:s,training:r,initialState:i})})}static fromConfig(t,e){return e.implmentation===0&&(e.implementation=1),new t(e)}}d3.className="LSTM";It(d3);class RT extends $x{constructor(t){super(t),this.cells=t.cells}get stateSize(){const t=[];for(const e of this.cells.slice().reverse())Array.isArray(e.stateSize)?t.push(...e.stateSize):t.push(e.stateSize);return t}call(t,e){return ct(()=>{t=t;let s=t.slice(1);const r=[];for(const l of this.cells.slice().reverse())Array.isArray(l.stateSize)?r.push(s.splice(0,l.stateSize.length)):r.push(s.splice(0,1));r.reverse();const i=[];let o;for(let l=0;l<this.cells.length;++l){const u=this.cells[l];s=r[l],l===0?o=[t[0]].concat(s):o=[o[0]].concat(s),o=u.call(o,e),i.push(o.slice(1))}s=[];for(const l of i.slice().reverse())s.push(...l);return[o[0]].concat(s)})}build(t){xw(t)&&(t=t[0]),t=t;let e;this.cells.forEach((s,r)=>{Yl(`RNNCell_${r}`,()=>{s.build(t),Array.isArray(s.stateSize)?e=s.stateSize[0]:e=s.stateSize,t=[t[0],e]})}),this.built=!0}getConfig(){const t=super.getConfig(),e=i=>({className:i.getClassName(),config:i.getConfig()}),r={cells:this.cells.map(e)};return Object.assign(Object.assign({},t),r)}static fromConfig(t,e,s={}){const r=[];for(const i of e.cells)r.push(qi(i,s));return new t({cells:r})}get trainableWeights(){if(!this.trainable)return[];const t=[];for(const e of this.cells)t.push(...e.trainableWeights);return t}get nonTrainableWeights(){const t=[];for(const e of this.cells)t.push(...e.nonTrainableWeights);if(!this.trainable){const e=[];for(const s of this.cells)e.push(...s.trainableWeights);return e.concat(t)}return t}getWeights(){const t=[];for(const e of this.cells)t.push(...e.weights);return bw(t)}setWeights(t){const e=[];for(const s of this.cells){const r=s.weights.length,i=t.splice(r);for(let o=0;o<s.weights.length;++o)e.push([s.weights[o],i[o]])}ST(e)}}RT.className="StackedRNNCells";It(RT);function Ka(n){const{ones:t,rate:e,training:s=!1,count:r=1,dropoutFunc:i}=n,o=()=>i!=null?i(t(),e):sM(t(),e),l=()=>zp(o,t,s);return!r||r<=1?Ui(l().clone()):Array(r).fill(void 0).map(l).map(h=>Ui(h.clone()))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */var IQ=function(n,t){var e={};for(var s in n)Object.prototype.hasOwnProperty.call(n,s)&&t.indexOf(s)<0&&(e[s]=n[s]);if(n!=null&&typeof Object.getOwnPropertySymbols=="function")for(var r=0,s=Object.getOwnPropertySymbols(n);r<s.length;r++)t.indexOf(s[r])<0&&Object.prototype.propertyIsEnumerable.call(n,s[r])&&(e[s[r]]=n[s[r]]);return e};class f3 extends rl{constructor(t){if(t.unroll)throw new re("Unrolling is not possible with convolutional RNNs.");if(Array.isArray(t.cell))throw new re("It is not possible at the moment to stack convolutional cells.");super(t),this.inputSpec=[new Pn({ndim:5})]}call(t,e){return ct(()=>{if(this.cell.dropoutMask!=null&&(oe(this.cell.dropoutMask),this.cell.dropoutMask=null),this.cell.recurrentDropoutMask!=null&&(oe(this.cell.recurrentDropoutMask),this.cell.recurrentDropoutMask=null),e&&e.constants)throw new X("ConvRNN2D cell does not support constants");const s=e==null?null:e.mask,r=e==null?null:e.training,i=e==null?null:e.initialState;return super.call(t,{mask:s,training:r,initialState:i})})}computeOutputShape(t){let e=this.computeSingleOutputShape(t);return this.returnSequences||(e=[e[0],...e.slice(2)]),this.returnState&&(e=[e,...Array(2).fill([t[0],...e.slice(-3)])]),e}getInitialState(t){return ct(()=>{const{stateSize:e}=this.cell,s=t.shape,r=this.computeSingleOutputShape(s),i=[r[0],...r.slice(2)],o=Qn(i);return Array.isArray(e)?Array(e.length).fill(o):[o]})}resetStates(t,e=!1){ct(()=>{if(!this.stateful)throw new Mi("Cannot call resetStates() on an RNN Layer that is not stateful.");const s=this.inputSpec[0].shape,r=this.computeSingleOutputShape(s),i=[r[0],...r.slice(2)];if(s[0]==null)throw new X("If an RNN is stateful, it needs to know its batch size. Specify the batch size of your input tensors: \n- If using a Sequential model, specify the batch size by passing a `batchInputShape` option to your first layer.\n- If using the functional API, specify the batch size by passing a `batchShape` option to your Input layer.");if(this.getStates()==null)Array.isArray(this.cell.stateSize)?this.states_=this.cell.stateSize.map(()=>Qn(i)):this.states_=[Qn(i)];else if(t==null)oe(this.states_),this.keptStates!=null&&(oe(this.keptStates),this.keptStates=[]),Array.isArray(this.cell.stateSize)?this.states_=this.cell.stateSize.map(()=>Qn(i)):this.states_[0]=Qn(i);else{if(Array.isArray(t)||(t=[t]),t.length!==this.states_.length)throw new X(`Layer ${this.name} expects ${this.states_.length} state(s), but it received ${t.length} state value(s). Input received: ${t}`);e?this.keptStates.push(this.states_.slice()):oe(this.states_);for(let l=0;l<this.states_.length;++l){const u=t[l],h=i;if(!Oe(u.shape,h))throw new X(`State ${l} is incompatible with layer ${this.name}: expected shape=${h}, received shape=${u.shape}`);this.states_[l]=u}}this.states_=this.states_.map(l=>Ui(l.clone()))})}computeSingleOutputShape(t){const{dataFormat:e,filters:s,kernelSize:r,padding:i,strides:o,dilationRate:l}=this.cell,u=e==="channelsFirst",h=t[u?3:2],d=t[u?4:3],p=hi(h,r[0],i,o[0],l[0]),m=hi(d,r[1],i,o[1],l[1]);return[...t.slice(0,2),...u?[s,p,m]:[p,m,s]]}}f3.className="ConvRNN2D";class $T extends Dx{constructor(t){const{filters:e,kernelSize:s,strides:r,padding:i,dataFormat:o,dilationRate:l}=t;super(Object.assign(Object.assign({},t),{units:e})),this.filters=e,Zn(this.filters,"filters"),this.kernelSize=Fc(s,2,"kernelSize"),this.kernelSize.forEach(u=>Zn(u,"kernelSize")),this.strides=Fc(r||1,2,"strides"),this.strides.forEach(u=>Zn(u,"strides")),this.padding=i||"valid",Er(this.padding),this.dataFormat=o||"channelsLast",Sn(this.dataFormat),this.dilationRate=Fc(l||1,2,"dilationRate"),this.dilationRate.forEach(u=>Zn(u,"dilationRate"))}build(t){var e;t=Ae(t);const s=this.dataFormat==="channelsFirst"?1:t.length-1;if(t[s]==null)throw new X(`The channel dimension of the input should be defined. Found ${t[s]}`);const r=t[s],i=4,o=this.kernelSize.concat([r,this.filters*i]);this.kernel=this.addWeight("kernel",o,null,this.kernelInitializer,this.kernelRegularizer,!0,this.kernelConstraint);const l=this.kernelSize.concat([this.filters,this.filters*i]);if(this.recurrentKernel=this.addWeight("recurrent_kernel",l,null,this.recurrentInitializer,this.recurrentRegularizer,!0,this.recurrentConstraint),this.useBias){let u;if(this.unitForgetBias){const h=this.biasInitializer,d=this.filters;u=new(e=class extends Xr{apply(m,y){const x=h.apply([d]),v=nl([d]),C=h.apply([d*2]);return mT([x,v,C])}},e.className="CustomInit",e)}else u=this.biasInitializer;this.bias=this.addWeight("bias",[this.filters*i],null,u,this.biasRegularizer,!0,this.biasConstraint)}this.built=!0}call(t,e){return ct(()=>{if(t.length!==3)throw new X(`ConvLSTM2DCell expects 3 input Tensors (inputs, h, c), got ${t.length}.`);const s=e.training||!1,r=t[0],i=t[1],o=t[2],l=4;0<this.dropout&&this.dropout<1&&this.dropoutMask==null&&(this.dropoutMask=Ka({ones:()=>jr(r),rate:this.dropout,training:s,count:l,dropoutFunc:this.dropoutFunc}));const u=this.dropoutMask,h=(B,j,st)=>!j||!j[st]?B:J(j[st],B);let d=h(r,u,0),p=h(r,u,1),m=h(r,u,2),y=h(r,u,3);0<this.recurrentDropout&&this.recurrentDropout<1&&this.recurrentDropoutMask==null&&(this.recurrentDropoutMask=Ka({ones:()=>jr(i),rate:this.recurrentDropout,training:s,count:l,dropoutFunc:this.dropoutFunc}));const x=this.recurrentDropoutMask;let v=h(i,x,0),C=h(i,x,1),S=h(i,x,2),E=h(i,x,3);const _=3,[I,O,P,D]=Cr(this.kernel.read(),l,_),[N,R,$,A]=this.useBias?Cr(this.bias.read(),l):[null,null,null,null];d=this.inputConv(d,I,N,this.padding),p=this.inputConv(p,O,R,this.padding),m=this.inputConv(m,P,$,this.padding),y=this.inputConv(y,D,A,this.padding);const[V,L,nt,Z]=Cr(this.recurrentKernel.read(),l,_);v=this.recurrentConv(v,V),C=this.recurrentConv(C,L),S=this.recurrentConv(S,nt),E=this.recurrentConv(E,Z);const W=this.recurrentActivation.apply(kt(d,v)),K=this.recurrentActivation.apply(kt(p,C)),Y=kt(J(K,o),J(W,this.activation.apply(kt(m,S)))),at=J(this.recurrentActivation.apply(kt(y,E)),this.activation.apply(Y));return[at,at,Y]})}getConfig(){const t=super.getConfig(),{units:e}=t,s=IQ(t,["units"]),r={filters:this.filters,kernelSize:this.kernelSize,padding:this.padding,dataFormat:this.dataFormat,dilationRate:this.dilationRate,strides:this.strides};return Object.assign(Object.assign({},s),r)}inputConv(t,e,s,r){const i=au(t,e,this.strides,r||"valid",this.dataFormat==="channelsFirst"?"NCHW":"NHWC",this.dilationRate);return s?mi(i,s,this.dataFormat):i}recurrentConv(t,e){return au(t,e,1,"same",this.dataFormat==="channelsFirst"?"NCHW":"NHWC")}}$T.className="ConvLSTM2DCell";It($T);class p3 extends f3{constructor(t){const e=new $T(t);super(Object.assign(Object.assign({},t),{cell:e}))}static fromConfig(t,e){return new t(e)}}p3.className="ConvLSTM2D";It(p3);/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */class DT extends ue{constructor(t){super(t),this.rate=Math.max(Math.min(t.rate,1),0),this.noiseShape=t.noiseShape,this.seed=t.seed,this.supportsMasking=!0}getNoiseShape(t){if(this.noiseShape==null)return this.noiseShape;const e=t.shape,s=[];for(let r=0;r<this.noiseShape.length;++r)s.push(this.noiseShape[r]==null?e[r]:this.noiseShape[r]);return s}call(t,e){return ct(()=>{this.invokeCallHook(t,e);const s=Zt(t);if(0<this.rate&&this.rate<1){const r=e.training==null?!1:e.training,i=this.getNoiseShape(s);return zp(()=>sM(s,this.rate,i,this.seed),()=>s,r)}return t})}getConfig(){const t={rate:this.rate,noiseShape:this.noiseShape,seed:this.seed},e=super.getConfig();return Object.assign(t,e),t}dispose(){return super.dispose()}}DT.className="Dropout";It(DT);class m3 extends DT{constructor(t){super(t),this.inputSpec=[{ndim:3}]}getNoiseShape(t){const e=t.shape;return[e[0],1,e[2]]}}m3.className="SpatialDropout1D";It(m3);class g3 extends ue{constructor(t){if(super(t),this.activation=null,this.useBias=!0,this.kernel=null,this.bias=null,this.DEFAULT_KERNEL_INITIALIZER="glorotNormal",this.DEFAULT_BIAS_INITIALIZER="zeros",t.batchInputShape==null&&t.inputShape==null&&t.inputDim!=null){let e=null;t.batchSize!=null&&(e=t.batchSize),this.batchInputShape=[e,t.inputDim]}this.units=t.units,Zn(this.units,"units"),this.activation=ja(t.activation),t.useBias!=null&&(this.useBias=t.useBias),this.kernelInitializer=rn(t.kernelInitializer||this.DEFAULT_KERNEL_INITIALIZER),this.biasInitializer=rn(t.biasInitializer||this.DEFAULT_BIAS_INITIALIZER),this.kernelConstraint=zn(t.kernelConstraint),this.biasConstraint=zn(t.biasConstraint),this.kernelRegularizer=on(t.kernelRegularizer),this.biasRegularizer=on(t.biasRegularizer),this.activityRegularizer=on(t.activityRegularizer),this.supportsMasking=!0,this.inputSpec=[{minNDim:2}]}build(t){t=Ae(t);const e=t[t.length-1];this.kernel==null&&(this.kernel=this.addWeight("kernel",[e,this.units],null,this.kernelInitializer,this.kernelRegularizer,!0,this.kernelConstraint),this.useBias&&(this.bias=this.addWeight("bias",[this.units],null,this.biasInitializer,this.biasRegularizer,!0,this.biasConstraint))),this.inputSpec=[{minNDim:2,axes:{[-1]:e}}],this.built=!0}computeOutputShape(t){t=Ae(t);const e=t.slice();return e[e.length-1]=this.units,e}call(t,e){return ct(()=>{this.invokeCallHook(t,e);const s=Zt(t),r=YO(this.activation.getClassName());let i;return r!=null?i=Hi(s,this.kernel.read(),r,this.bias?this.bias.read():null):(i=Hi(s,this.kernel.read()),this.bias!=null&&(i=mi(i,this.bias.read())),this.activation!=null&&(i=this.activation.apply(i))),i})}getConfig(){const t={units:this.units,activation:qa(this.activation),useBias:this.useBias,kernelInitializer:cn(this.kernelInitializer),biasInitializer:cn(this.biasInitializer),kernelRegularizer:Ye(this.kernelRegularizer),biasRegularizer:Ye(this.biasRegularizer),activityRegularizer:Ye(this.activityRegularizer),kernelConstraint:Vn(this.kernelConstraint),biasConstraint:Vn(this.biasConstraint)},e=super.getConfig();return Object.assign(t,e),t}}g3.className="Dense";It(g3);class y3 extends ue{constructor(t){t=t||{},super(t),this.inputSpec=[{minNDim:3}],this.dataFormat=t.dataFormat}computeOutputShape(t){t=Ae(t);for(const e of t.slice(1))if(e==null)throw new X(`The shape of the input to "Flatten" is not fully defined (got ${t.slice(1)}). Make sure to pass a complete "input_shape" or "batch_input_shape" argument to the first layer in your model.`);return[t[0],La(t,1)]}call(t,e){return ct(()=>{this.invokeCallHook(t,e);let s=Zt(t);if(this.dataFormat==="channelsFirst"&&s.rank>1){const r=[0];for(let i=2;i<s.rank;++i)r.push(i);r.push(1),s=ve(s,r)}return sY(s)})}getConfig(){const t={};this.dataFormat!=null&&(t.dataFormat=this.dataFormat);const e=super.getConfig();return Object.assign(t,e),t}}y3.className="Flatten";It(y3);class x3 extends ue{constructor(t){super(t),this.supportsMasking=!0,this.activation=ja(t.activation)}call(t,e){return ct(()=>{this.invokeCallHook(t,e);const s=Zt(t);return this.activation.apply(s)})}getConfig(){const t={activation:qa(this.activation)},e=super.getConfig();return Object.assign(t,e),t}}x3.className="Activation";It(x3);class b3 extends ue{constructor(t){super(t),this.n=t.n,this.inputSpec=[{ndim:2}]}computeOutputShape(t){return[t[0],this.n,t[1]]}call(t,e){return ct(()=>(t=Zt(t),eY(t,this.n)))}getConfig(){const t={n:this.n},e=super.getConfig();return Object.assign(t,e),t}}b3.className="RepeatVector";It(b3);class v3 extends ue{constructor(t){super(t),this.targetShape=t.targetShape;for(let e=0;e<this.targetShape.length;++e)this.isUnknown(this.targetShape[e])&&(this.targetShape[e]=null)}isUnknown(t){return t<0||t==null}fixUnknownDimension(t,e){const s="Total size of new array must be unchanged.",r=e.slice();let i=1,o=null;for(let u=0;u<r.length;++u){const h=r[u];if(this.isUnknown(h))if(o===null)o=u;else throw new X("Can only specifiy one unknown dimension.");else i*=h}const l=La(t);if(o!==null){if(i===0||l%i!==0)throw new X(s);r[o]=l/i}else if(l!==i)throw new X(s);return r}computeOutputShape(t){let e=!1;for(let s=0;s<t.length;++s)if(this.isUnknown(t[s])){e=!0;break}return e?t.slice(0,1).concat(this.targetShape):t.slice(0,1).concat(this.fixUnknownDimension(t.slice(1),this.targetShape))}call(t,e){return ct(()=>{this.invokeCallHook(t,e);const s=Zt(t),r=s.shape,i=r.slice(0,1).concat(this.fixUnknownDimension(r.slice(1),this.targetShape));return rt(s,i)})}getConfig(){const t={targetShape:this.targetShape},e=super.getConfig();return Object.assign(t,e),t}}v3.className="Reshape";It(v3);class w3 extends ue{constructor(t){if(super(t),t.dims==null)throw new Error("Required configuration field `dims` is missing during Permute constructor call.");if(!Array.isArray(t.dims))throw new Error(`Permute constructor requires \`dims\` to be an Array, but received ${t.dims} instead.`);const e=di(1,t.dims.length+1);if(!Oe(t.dims.slice().sort(),e))throw new Error("Invalid permutation `dims`: "+JSON.stringify(t.dims)+" `dims` must contain consecutive integers starting from 1.");this.dims=t.dims,this.dimsIncludingBatch=[0].concat(this.dims),this.inputSpec=[new Pn({ndim:this.dims.length+1})]}computeOutputShape(t){t=Ae(t);const e=t.slice();return this.dims.forEach((s,r)=>{e[r+1]=t[s]}),e}call(t,e){return ve(Zt(t),this.dimsIncludingBatch)}getConfig(){const t={dims:this.dims},e=super.getConfig();return Object.assign(t,e),t}}w3.className="Permute";It(w3);class C3 extends ue{constructor(t){super(t??{}),this.supportsMasking=!0,t!=null?this.maskValue=t.maskValue==null?0:t.maskValue:this.maskValue=0}computeOutputShape(t){return t}getConfig(){const t=super.getConfig(),e={maskValue:this.maskValue};return Object.assign(e,t),e}computeMask(t,e){const s=Zt(t);return uw(ky(s,this.maskValue),-1)}call(t,e){return ct(()=>{this.invokeCallHook(t,e);const s=Zt(t),o=uw(ky(s,this.maskValue),-1,!0);return J(s,Ot(o,s.dtype))})}}C3.className="Masking";It(C3);/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */class S3 extends ue{constructor(t){if(super(t),this.embeddings=null,this.DEFAULT_EMBEDDINGS_INITIALIZER="randomUniform",t.batchInputShape==null&&t.inputShape==null){let e=null;t.batchSize!=null&&(e=t.batchSize),t.inputLength==null?this.batchInputShape=[e,null]:this.batchInputShape=[e].concat(Ve(t.inputLength))}this.inputDim=t.inputDim,Zn(this.inputDim,"inputDim"),this.outputDim=t.outputDim,Zn(this.outputDim,"outputDim"),this.embeddingsInitializer=rn(t.embeddingsInitializer||this.DEFAULT_EMBEDDINGS_INITIALIZER),this.embeddingsRegularizer=on(t.embeddingsRegularizer),this.activityRegularizer=on(t.activityRegularizer),this.embeddingsConstraint=zn(t.embeddingsConstraint),this.maskZero=t.maskZero,this.supportsMasking=t.maskZero,this.inputLength=t.inputLength}build(t){this.embeddings=this.addWeight("embeddings",[this.inputDim,this.outputDim],this.dtype,this.embeddingsInitializer,this.embeddingsRegularizer,!0,this.embeddingsConstraint),this.built=!0}warnOnIncompatibleInputShape(t){}computeMask(t,e){return ct(()=>this.maskZero?(t=Zt(t),ky(t,we(t))):null)}computeOutputShape(t){if(t=Ae(t),this.inputLength==null)return[...t,this.outputDim];const e=Ve(this.inputLength);if(e.length!==t.length-1)throw new X(`"inputLength" is ${this.inputLength}, but received input shape has shape ${t}`);{let s=0;for(let r=0;r<e.length;++r){const i=e[r],o=t[r+1];if(i!=null&&o!=null&&i!==o)throw new X(`"inputLength" is ${this.inputLength}, but received input shape has shape ${t}`);i==null&&(e[s]=o),s++}}return[t[0],...e,this.outputDim]}call(t,e){return ct(()=>{this.invokeCallHook(t,e);let s=Zt(t);s.dtype!=="int32"&&(s=Wi(s,"int32"));const r=nM(this.embeddings.read(),rt(s,[s.size]));return rt(r,Ae(this.computeOutputShape(s.shape)))})}getConfig(){const t={inputDim:this.inputDim,outputDim:this.outputDim,embeddingsInitializer:cn(this.embeddingsInitializer),embeddingsRegularizer:Ye(this.embeddingsRegularizer),activityRegularizer:Ye(this.activityRegularizer),embeddingsConstraint:Vn(this.embeddingsConstraint),maskZero:this.maskZero,inputLength:this.inputLength},e=super.getConfig();return Object.assign(t,e),t}}S3.className="Embedding";It(S3);/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */class Eu extends ue{constructor(t){super(t||{}),this.supportsMasking=!0}mergeFunction(t){throw new re}computeElementwiseOpOutputShape(t,e){if(t==null||e==null)return null;if(t.length<e.length)return this.computeElementwiseOpOutputShape(e,t);if(e.length===0)return t;const s=t.slice(0,t.length-e.length);for(let r=0;r<e.length;++r){const i=t[t.length-e.length+r],o=e[r];if(i==null||o==null||i<0||o<0)s.push(null);else if(i===1)s.push(o);else if(o===1)s.push(i);else{if(i!==o)throw new X("Operands could not be broadcast together with shapes "+JSON.stringify(t)+" "+JSON.stringify(e));s.push(i)}}return s}build(t){if(Array.isArray(t)&&!Array.isArray(t[0])&&(t=[Ae(t)]),t=t,t.length<2)throw new X(`A merge layer should be called on an Array of at least 2 inputs. Got ${t.length} input(s).`);let e=[];for(const i of t)i!=null&&i[0]!==null&&e.push(i[0]);if(e=Fa(e),e.length>1)throw new X(`Can not merge tensors with different batch sizes. Got tensors with shapes: ${JSON.stringify(t)}.`);let s=t[0]==null?null:t[0].slice(1);for(let i=1;i<t.length;++i){const o=t[i]==null?null:t[i].slice(1);s=this.computeElementwiseOpOutputShape(s,o)}const r=t.map(i=>i.length);t.indexOf(null)===-1&&Fa(r).length===1?this.reshapeRequired=!1:this.reshapeRequired=!0}call(t,e){return ct(()=>{if(t=t,this.reshapeRequired){const s=[],r=t.map(i=>i.rank);if(r.indexOf(null)===-1){const i=Ha(r);for(let o of t){const l=o.rank;for(let u=0;u<i-l;++u)o=Pp(o,1);s.push(o)}return this.mergeFunction(s)}else{let i=!1;for(const u of t){const h=u.rank;if(h==null){const d=u.shape,p=d[0],m=d.slice(1).concat([p]);let y=rt(u,[p].concat(La(d.slice(1))));y=ve(y,[1,0]),y=rt(y,m),s.push(y),i=!0}else if(h>1){const d=di(1,h).concat([0]);s.push(ve(u,d)),i=!0}else s.push(u)}let o=this.mergeFunction(s);const l=o.rank;if(i){if(l==null){const u=o.shape,h=u.length,d=u[h-1],p=[d].concat(u.slice(0,u.length-1));o=rt(ve(rt(o,[-1,d]),[1,0]),p)}else if(l>1){const u=[l-1].concat(di(0,l-1));o=ve(o,u)}}return o}}else return this.mergeFunction(t)})}computeOutputShape(t){t=t;let e;t[0]==null?e=null:e=t[0].slice(1);for(let r=1;r<t.length;++r){const i=t[r]==null?null:t[r].slice(1);e=this.computeElementwiseOpOutputShape(e,i)}let s=[];for(const r of t)r!=null&&r[0]!==null&&s.push(r[0]);return s=Fa(s),s.length===1?e=s.concat(e):e=[null].concat(e),e}computeMask(t,e){return ct(()=>{if(e==null)return null;if(!Array.isArray(e))throw new X("`mask` should be an Array");if(!Array.isArray(t))throw new X("`inputs` should be an Array");if(e.length!==t.length)throw new X(`The Array 'inputs' and 'mask' are expected to have the same length, but have different lengths (${t.length} vs ${e.length})`);if(e.every(r=>r==null))return null;e=e.map(r=>r==null?r:js(r,0));let s=e[0];for(let r=1;r<e.length-1;++r)s=zo(s,e[r]);return s})}}class T3 extends Eu{constructor(t){super(t)}mergeFunction(t){return ct(()=>{let e=t[0].clone();for(let s=1;s<t.length;++s)e=kt(e,t[s]);return e})}}T3.className="Add";It(T3);class E3 extends Eu{constructor(t){super(t)}mergeFunction(t){return ct(()=>{let e=t[0].clone();for(let s=1;s<t.length;++s)e=J(e,t[s]);return e})}}E3.className="Multiply";It(E3);class I3 extends Eu{constructor(t){super(t)}mergeFunction(t){return ct(()=>{let e=t[0].clone();for(let s=1;s<t.length;++s)e=kt(e,t[s]);return J(1/t.length,e)})}}I3.className="Average";It(I3);class _3 extends Eu{constructor(t){super(t)}mergeFunction(t){return ct(()=>{let e=t[0];for(let s=1;s<t.length;++s)e=el(e,t[s]);return e})}}_3.className="Maximum";It(_3);class k3 extends Eu{constructor(t){super(t)}mergeFunction(t){return ct(()=>{let e=t[0];for(let s=1;s<t.length;++s)e=pf(e,t[s]);return e})}}k3.className="Minimum";It(k3);class A3 extends Eu{constructor(t){super(t),this.DEFAULT_AXIS=-1,t==null&&(t={}),this.axis=t.axis==null?this.DEFAULT_AXIS:t.axis,this.supportsMasking=!0,this.reshapeRequired=!1}build(t){if(!(Array.isArray(t)&&Array.isArray(t[0]))||t.length===1)throw new X("A `Concatenate` layer should be called on a list of at least 2 inputs");t=t;let e=!0;for(const r of t)if(r!=null){e=!1;break}if(e)return;const s=[];for(let r=0;r<t.length;++r){const i=t[r].slice();i.splice(this.axis,1);let o=!1;for(const l of s)if(Oe(l,i)){o=!0;break}o||s.push(i)}if(s.length>1)throw new X("A `Concatenate` layer requires inputs with matching shapes except for the concat axis. Got input shapes: "+JSON.stringify(t))}mergeFunction(t){return ct(()=>mT(t,this.axis))}computeOutputShape(t){if(!(Array.isArray(t)&&Array.isArray(t[0])))throw new X("A `Concatenate` layer should be called on a list of inputs.");const e=t,s=e[0].slice(),r=this.axis<0?s.length+this.axis:this.axis;for(const i of e.slice(1)){if(s[r]==null||i[r]==null){s[r]=null;break}s[r]+=i[r]}return s}computeMask(t,e){if(e==null)return null;if(!Array.isArray(e))throw new X("`mask` should be an array for Concatenate");if(!Array.isArray(t))throw new X("`inputs` should be an array for Concatenate");if(e.length!==t.length)throw new X(`Mismatch in the length of mask (${e.length}) and the legnth of inputs (${t.length})`);return ct(()=>{let s=!0;if(e.forEach(o=>{if(o!=null){s=!1;return}}),s)return null;const r=[];for(let o=0;o<t.length;++o)e[o]==null?r.push(Ot(jr(t[o]),"bool")):e[o].rank<t[o].rank?r.push(js(e[o],-1)):r.push(e[o]);const i=Xs(r,this.axis);return kD(i,-1,!1)})}getConfig(){const t={axis:this.axis},e=super.getConfig();return Object.assign(t,e),t}}A3.className="Concatenate";It(A3);function Fd(n,t){for(;n<0;)n+=t;return n}function _Q(n,t,e){if(n.shape.length>3||t.shape.length>3)throw new re("batchDot is not implemented for tensors of 4D or higher rank yet");if(U(n.shape.length>=2,()=>`batchDot requires the rank of x to be >= 2, but got ${n.shape.length}`),U(n.shape.length>=2,()=>`batchDot requires the rank of y to be >= 2, but got ${t.shape.length}`),typeof e=="number"&&(e=[e,e]),n.dtype==="complex64"||t.dtype==="complex64")throw new re("batchDot is not implemented for complex64-type Tensors yet.");const s=n.shape.length,r=t.shape.length;e==null&&(e=[s-1,r-2]);const i=e;return ct(()=>{let o;if(s>r){o=s-r;const u=[];for(let h=0;h<o;++h)u.push(1);t=rt(t,t.shape.concat(u))}else if(r>s){o=r-s;const u=[];for(let h=0;h<o;++h)u.push(1);n=rt(n,n.shape.concat(u))}else o=0;let l;if(n.shape.length===2&&t.shape.length===2)i[0]===i[1]?l=Gt(J(n,t),i[0]):l=Gt(J(ve(n,[1,0]),t),i[1]);else{const u=i[0]!==n.shape.length-1,h=i[1]===t.shape.length-1;l=$e(n,t,u,h)}if(o>0){let u;s>r?u=s+r-3:u=s-1;const h=[];for(let d=u;d<u+o;++d)h.push(d);l=$p(l,h)}return l.shape.length===1&&(l=js(l,1)),l})}class N3 extends Eu{constructor(t){super(t),this.axes=t.axes,this.normalize=t.normalize==null?!1:t.normalize,this.supportsMasking=!0,this.reshapeRequired=!1}build(t){U(Array.isArray(t)&&t.length===2&&Array.isArray(t[0])&&Array.isArray(t[1]),()=>"A `Dot` layer should be called on a list of exactly 2 inputs.");const e=t[0],s=t[1];if(e.length>3||s.length>3)throw new re("Dot layer does not support tensors of 4D or higher rank yet.");const r=this.interpretAxes(e,s);if(e[r[0]]!==s[r[1]])throw new X(`Dimension incompatibility: ${e[r[0]]} !== ${s[r[1]]}`)}mergeFunction(t){if(t.length!==2)throw new X(`A \`Dot\` layer must be called on exactly 2 inputs, but received ${t.length} input(s).`);let e=t[0],s=t[1],r;return Array.isArray(this.axes)?r=this.axes.map((i,o)=>Fd(i,t[o].shape.length)):r=[Fd(this.axes,e.shape.length),Fd(this.axes,s.shape.length)],this.normalize&&(e=My(e,r[0]),s=My(s,r[1])),_Q(e,s,r)}interpretAxes(t,e){let s;return Array.isArray(this.axes)?s=this.axes:s=[Fd(this.axes,t.length),Fd(this.axes,e.length)],s}computeOutputShape(t){U(Array.isArray(t)&&t.length===2&&Array.isArray(t[0])&&Array.isArray(t[1]),()=>"A `Dot` layer should be called on a list of exactly 2 inputs.");const e=t[0].slice(),s=t[1].slice();if(e.length>3||s.length>3)throw new re("Dot layer does not support tensors of 4D or higher rank yet.");const r=this.interpretAxes(e,s);e.splice(r[0],1),s.splice(r[1],1),s.splice(0,1);const i=e.concat(s);return i.length===1&&i.push(1),i}computeMask(t,e){return null}getConfig(){const t={axes:this.axes,normalize:this.normalize},e=super.getConfig();return Object.assign(t,e),t}}N3.className="Dot";It(N3);/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */class R3 extends ue{constructor(t){super(t),this.supportsMasking=!0,this.stddev=t.stddev}computeOutputShape(t){return t}getConfig(){const t=super.getConfig(),e={stddev:this.stddev};return Object.assign(e,t),e}call(t,e){return ct(()=>{this.invokeCallHook(t,e);const s=Zt(t);return zp(()=>kt(Ix(s.shape,0,this.stddev),s),()=>s,e.training||!1)})}}R3.className="GaussianNoise";It(R3);class $3 extends ue{constructor(t){super(t),this.supportsMasking=!0,this.rate=t.rate}computeOutputShape(t){return t}getConfig(){const t=super.getConfig(),e={rate:this.rate};return Object.assign(e,t),e}call(t,e){return ct(()=>{this.invokeCallHook(t,e);const s=Zt(t);return this.rate>0&&this.rate<1?zp(()=>{const i=Math.sqrt(this.rate/(1-this.rate));return J(s,Ix(s.shape,1,i))},()=>s,e.training||!1):s})}}$3.className="GaussianDropout";It($3);class D3 extends ue{constructor(t){super(t),this.supportsMasking=!0,this.rate=t.rate,this.noiseShape=t.noiseShape}_getNoiseShape(t){return this.noiseShape||Zt(t).shape}computeOutputShape(t){return t}getConfig(){const t=super.getConfig(),e={rate:this.rate};return Object.assign(e,t),e}call(t,e){return ct(()=>{if(this.rate<1&&this.rate>0){const s=this._getNoiseShape(t);return zp(()=>{const i=Zt(t),l=-1.6732632423543772*1.0507009873554805;let u=wu(Rp(s),this.rate);u=Wi(u,"float32");const h=((1-this.rate)*(1+this.rate*l**2))**-.5,d=-h*l*this.rate,p=kt(J(i,u),J(kt(u,-1),l));return kt(J(p,h),d)},()=>Zt(t),e.training||!1)}return t})}}D3.className="AlphaDropout";It(D3);/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function bf(n,t,e,s,r,i=.001){let o;if(n.rank===2)o=j5(n,t,e,s,r,i);else if(n.rank===3)o=X5(n,t,e,s,r,i);else if(n.rank===4)o=Q5(n,t,e,s,r,i);else throw new re(`batchNormalization is not implemented for array of rank ${n.rank} yet`);return o}function kQ(n,t,e,s,r=.001){return ct(()=>{const i=CS(n,s),o=i.mean,l=i.variance;return[bf(n,o,l,e,t,r),o,l]})}function AQ(n,t,e,s,r=.001){return ct(()=>{const i=CS(n,s),o=i.mean,l=i.variance,u=[];for(const x of di(0,n.rank))s.indexOf(x)!==-1?u.push(1):u.push(n.shape[x]);const h=rt(o,u),d=rt(l,u),p=t==null?null:rt(t,u),m=e==null?null:rt(e,u);return[bf(n,h,d,m,p,r),o,l]})}function NQ(n,t,e,s,r=.001){return Oe(s.slice().sort(),di(0,n.rank-1))?kQ(n,t,e,s,r):AQ(n,t,e,s,r)}class O3 extends ue{constructor(t){t==null&&(t={}),super(t),this.supportsMasking=!0,this.axis=t.axis==null?-1:t.axis,this.momentum=t.momentum==null?.99:t.momentum,this.epsilon=t.epsilon==null?.001:t.epsilon,this.center=t.center==null?!0:t.center,this.scale=t.scale==null?!0:t.scale,this.betaInitializer=rn(t.betaInitializer||"zeros"),this.gammaInitializer=rn(t.gammaInitializer||"ones"),this.movingMeanInitializer=rn(t.movingMeanInitializer||"zeros"),this.movingVarianceInitializer=rn(t.movingVarianceInitializer||"ones"),this.betaConstraint=zn(t.betaConstraint),this.gammaConstraint=zn(t.gammaConstraint),this.betaRegularizer=on(t.betaRegularizer),this.gammaRegularizer=on(t.gammaRegularizer)}build(t){t=Ae(t);const e=this.axis>=0?this.axis:this.axis+t.length,s=t[e];if(s==null)throw new X(`Axis ${e} of input tensor should have a defined dimension but the layer received an input with shape ${JSON.stringify(t)}.`);this.inputSpec=[new Pn({ndim:t.length,axes:{[e]:s}})];const r=[s];this.scale&&(this.gamma=this.addWeight("gamma",r,null,this.gammaInitializer,this.gammaRegularizer,!0,this.gammaConstraint)),this.center&&(this.beta=this.addWeight("beta",r,null,this.betaInitializer,this.betaRegularizer,!0,this.betaConstraint)),this.movingMean=this.addWeight("moving_mean",r,null,this.movingMeanInitializer,null,!1),this.movingVariance=this.addWeight("moving_variance",r,null,this.movingVarianceInitializer,null,!1),this.built=!0}call(t,e){return ct(()=>{const s=e.training==null?!1:e.training,r=Zt(t),i=r.shape,o=i.length,l=di(0,o),u=this.axis>=0?this.axis:this.axis+o;l.splice(u,1);const h=hu(1,o);h[u]=i[u];const d=l.slice();d.sort();const p=!Oe(d,di(0,o).slice(0,o-1)),m=()=>{if(p){const E=rt(this.movingMean.read(),h),_=rt(this.movingVariance.read(),h),I=this.center?rt(this.beta.read(),h):null,O=this.scale?rt(this.gamma.read(),h):null;return bf(r,E,_,I,O,this.epsilon)}else return bf(r,this.movingMean.read(),this.movingVariance.read(),this.beta==null?null:this.beta.read(),this.gamma==null?null:this.gamma.read(),this.epsilon)};if(!s)return m();const[y,x,v]=NQ(r,this.gamma.read(),this.beta.read(),l,this.epsilon),C=(E,_,I)=>{ct(()=>{const O=1-I,P=E.read(),D=J(Yt(P,_),O);E.write(Yt(P,D))})};return(()=>{C(this.movingMean,x,this.momentum),C(this.movingVariance,v,this.momentum)})(),y})}getConfig(){const t={axis:this.axis,momentum:this.momentum,epsilon:this.epsilon,center:this.center,scale:this.scale,betaInitializer:cn(this.betaInitializer),gammaInitializer:cn(this.gammaInitializer),movingMeanInitializer:cn(this.movingMeanInitializer),movingVarianceInitializer:cn(this.movingVarianceInitializer),betaRegularizer:Ye(this.betaRegularizer),gammaRegularizer:Ye(this.gammaRegularizer),betaConstraint:Vn(this.betaConstraint),gammaConstraint:Vn(this.gammaConstraint)},e=super.getConfig();return Object.assign(t,e),t}}O3.className="BatchNormalization";It(O3);class M3 extends ue{constructor(t){if(t==null&&(t={}),super(t),this.axis=t.axis==null?-1:t.axis,typeof this.axis=="number"){if(!Number.isInteger(this.axis))throw new Error(`Expected axis to be an integer, but received ${this.axis}`)}else if(Array.isArray(this.axis)){for(const e of this.axis)if(!Number.isInteger(e))throw new Error(`Expected axis to be an array of integers, but received ${JSON.stringify(this.axis)}`)}else throw new Error(`Expected axis to be an integer or an array of integers, but received ${JSON.stringify(this.axis)}`);this.epsilon=t.epsilon==null?.001:t.epsilon,this.center=t.center==null?!0:t.center,this.scale=t.scale==null?!0:t.scale,this.betaInitializer=rn(t.betaInitializer||"zeros"),this.gammaInitializer=rn(t.gammaInitializer||"ones"),this.betaRegularizer=on(t.betaRegularizer),this.gammaRegularizer=on(t.gammaRegularizer),this.supportsMasking=!0}build(t){t=Ae(t);const e=t.length;typeof this.axis=="number"&&(this.axis=[this.axis]);for(let i=0;i<this.axis.length;++i)this.axis[i]<0&&(this.axis[i]+=e);for(const i of this.axis)if(i<0||i>=e)throw new Error(`Invalid axis: ${i}`);if(this.axis.length!==Fa(this.axis).length)throw new Error(`Found duplicate axes in: ${this.axis}`);const s=this.axis.map(i=>t[i]),r=!0;this.scale?this.gamma=this.addWeight("gamma",s,"float32",this.gammaInitializer,this.gammaRegularizer,r):this.gamma=null,this.center?this.beta=this.addWeight("beta",s,"float32",this.betaInitializer,this.betaRegularizer,r):this.beta=null,this.built=!0}call(t,e){const s=Zt(t),r=s.shape,i=r.length;return ct(()=>{let{mean:l,variance:u}=CS(s,this.axis,!0);const h=hu(1,i);for(const v of this.axis)h[v]=r[v];const d=v=>v!=null&&v.shape.length!==i?rt(v,h):v;let p=this.scale?d(this.gamma.read()):null,m=this.center?d(this.beta.read()):null;const y=[],x=[];for(let v=0;v<i;++v)this.axis.indexOf(v)!==-1?(y.push(r[v]),x.push(1)):(y.push(1),x.push(r[v]));return l=ai(l,y),u=ai(u,y),p!=null&&(p=ai(p,x)),m!=null&&(m=ai(m,x)),bf(s,l,u,m,p,this.epsilon)})}getConfig(){const t={axis:this.axis,epsilon:this.epsilon,center:this.center,scale:this.scale,betaInitializer:cn(this.betaInitializer),gammaInitializer:cn(this.gammaInitializer),betaRegularizer:Ye(this.betaRegularizer),gammaRegularizer:Ye(this.gammaRegularizer)},e=super.getConfig();return Object.assign(t,e),t}}M3.className="LayerNormalization";It(M3);/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function RQ(n,t,e){return ct(()=>{if(n.rank!==4)throw new X(`temporalPadding expects input tensor to be 4-D, but received a ${n.rank}-D tensor.`);if(t==null&&(t=[[1,1],[1,1]]),t.length!==2||t[0].length!==2||t[1].length!==2)throw new X("spatial2dPadding expects `padding` to be an Array of two Arrays, each of which is an Array of two integers.");if(e==null&&(e=fi()),e!=="channelsLast"&&e!=="channelsFirst")throw new X(`Unknown data format: ${e}. Supported data formats are 'channelsLast' and 'channelsFirst.`);let s;return e==="channelsFirst"?s=[[0,0],[0,0],t[0],t[1]]:s=[[0,0],t[0],t[1],[0,0]],SS(n,s)})}class F3 extends ue{constructor(t){if(t==null&&(t={}),super(t),this.dataFormat=t.dataFormat==null?fi():t.dataFormat,t.padding==null)this.padding=[[1,1],[1,1]];else if(typeof t.padding=="number")this.padding=[[t.padding,t.padding],[t.padding,t.padding]];else{if(t.padding=t.padding,t.padding.length!==2)throw new X(`ZeroPadding2D expects padding to be a length-2 array, but received a length-${t.padding.length} array.`);let e,s;if(typeof t.padding[0]=="number")e=[t.padding[0],t.padding[0]],s=[t.padding[1],t.padding[1]];else{if(t.padding=t.padding,t.padding[0].length!==2)throw new X(`ZeroPadding2D expects height padding to be a length-2 array, but received a length-${t.padding[0].length} array.`);if(e=t.padding[0],t.padding[1].length!==2)throw new X(`ZeroPadding2D expects width padding to be a length-2 array, but received a length-${t.padding[1].length} array.`);s=t.padding[1]}this.padding=[e,s]}this.inputSpec=[new Pn({ndim:4})]}computeOutputShape(t){t=Ae(t);let e,s;return this.dataFormat==="channelsFirst"?(t[2]!=null&&t[2]>=0?e=t[2]+this.padding[0][0]+this.padding[0][1]:e=null,t[3]!=null&&t[3]>=0?s=t[3]+this.padding[1][0]+this.padding[1][1]:s=null,[t[0],t[1],e,s]):(t[1]!=null&&t[1]>=0?e=t[1]+this.padding[0][0]+this.padding[0][1]:e=null,t[2]!=null&&t[2]>=0?s=t[2]+this.padding[1][0]+this.padding[1][1]:s=null,[t[0],e,s,t[3]])}call(t,e){return ct(()=>RQ(Zt(t),this.padding,this.dataFormat))}getConfig(){const t={padding:this.padding,dataFormat:this.dataFormat},e=super.getConfig();return Object.assign(t,e),t}}F3.className="ZeroPadding2D";It(F3);/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function Ox(n,t,e,s,r,i){return ct(()=>{Sn(r),ZO(i),Er(s),e==null&&(e=[1,1]),s==null&&(s="valid"),r==null&&(r=fi()),i==null&&(i="max"),n=kT(n,r);let o;const l=s==="same"?"same":"valid";return i==="max"?o=wS(n,t,e,l):o=hS(n,t,e,l),r==="channelsFirst"&&(o=ve(o,[0,3,1,2])),o})}function L3(n,t,e,s,r,i){return ct(()=>{Sn(r),ZO(i),Er(s),e==null&&(e=[1,1,1]),s==null&&(s="valid"),r==null&&(r=fi()),i==null&&(i="max"),n=t3(n,r);let o;const l=s==="same"?"same":"valid";return i==="max"?o=Mq(n,t,e,l):o=L5(n,t,e,l),r==="channelsFirst"&&(o=ve(o,[0,4,1,2,3])),o})}class P3 extends ue{constructor(t){if(t.poolSize==null&&(t.poolSize=2),super(t),typeof t.poolSize=="number")this.poolSize=[t.poolSize];else if(Array.isArray(t.poolSize)&&t.poolSize.length===1&&typeof t.poolSize[0]=="number")this.poolSize=t.poolSize;else throw new X(`poolSize for 1D convolutional layer must be a number or an Array of a single number, but received ${JSON.stringify(t.poolSize)}`);if(Zn(this.poolSize,"poolSize"),t.strides==null)this.strides=this.poolSize;else if(typeof t.strides=="number")this.strides=[t.strides];else if(Array.isArray(t.strides)&&t.strides.length===1&&typeof t.strides[0]=="number")this.strides=t.strides;else throw new X(`strides for 1D convolutional layer must be a number or an Array of a single number, but received ${JSON.stringify(t.strides)}`);Zn(this.strides,"strides"),this.padding=t.padding==null?"valid":t.padding,Er(this.padding),this.inputSpec=[new Pn({ndim:3})]}computeOutputShape(t){t=Ae(t);const e=hi(t[1],this.poolSize[0],this.padding,this.strides[0]);return[t[0],e,t[2]]}call(t,e){return ct(()=>{this.invokeCallHook(t,e),t=Pp(Zt(t),2);const s=this.poolingFunction(Zt(t),[this.poolSize[0],1],[this.strides[0],1],this.padding,"channelsLast");return $p(s,[2])})}getConfig(){const t={poolSize:this.poolSize,padding:this.padding,strides:this.strides},e=super.getConfig();return Object.assign(t,e),t}}class V3 extends P3{constructor(t){super(t)}poolingFunction(t,e,s,r,i){return Sn(i),Er(r),Ox(t,e,s,r,i,"max")}}V3.className="MaxPooling1D";It(V3);class z3 extends P3{constructor(t){super(t)}poolingFunction(t,e,s,r,i){return Sn(i),Er(r),Ox(t,e,s,r,i,"avg")}}z3.className="AveragePooling1D";It(z3);class B3 extends ue{constructor(t){if(t.poolSize==null&&(t.poolSize=[2,2]),super(t),this.poolSize=Array.isArray(t.poolSize)?t.poolSize:[t.poolSize,t.poolSize],t.strides==null)this.strides=this.poolSize;else if(Array.isArray(t.strides)){if(t.strides.length!==2)throw new X(`If the strides property of a 2D pooling layer is an Array, it is expected to have a length of 2, but received length ${t.strides.length}.`);this.strides=t.strides}else this.strides=[t.strides,t.strides];Zn(this.poolSize,"poolSize"),Zn(this.strides,"strides"),this.padding=t.padding==null?"valid":t.padding,this.dataFormat=t.dataFormat==null?"channelsLast":t.dataFormat,Sn(this.dataFormat),Er(this.padding),this.inputSpec=[new Pn({ndim:4})]}computeOutputShape(t){t=Ae(t);let e=this.dataFormat==="channelsFirst"?t[2]:t[1],s=this.dataFormat==="channelsFirst"?t[3]:t[2];return e=hi(e,this.poolSize[0],this.padding,this.strides[0]),s=hi(s,this.poolSize[1],this.padding,this.strides[1]),this.dataFormat==="channelsFirst"?[t[0],t[1],e,s]:[t[0],e,s,t[3]]}call(t,e){return ct(()=>(this.invokeCallHook(t,e),this.poolingFunction(Zt(t),this.poolSize,this.strides,this.padding,this.dataFormat)))}getConfig(){const t={poolSize:this.poolSize,padding:this.padding,strides:this.strides,dataFormat:this.dataFormat},e=super.getConfig();return Object.assign(t,e),t}}class U3 extends B3{constructor(t){super(t)}poolingFunction(t,e,s,r,i){return Sn(i),Er(r),Ox(t,e,s,r,i,"max")}}U3.className="MaxPooling2D";It(U3);class G3 extends B3{constructor(t){super(t)}poolingFunction(t,e,s,r,i){return Sn(i),Er(r),Ox(t,e,s,r,i,"avg")}}G3.className="AveragePooling2D";It(G3);class W3 extends ue{constructor(t){if(t.poolSize==null&&(t.poolSize=[2,2,2]),super(t),this.poolSize=Array.isArray(t.poolSize)?t.poolSize:[t.poolSize,t.poolSize,t.poolSize],t.strides==null)this.strides=this.poolSize;else if(Array.isArray(t.strides)){if(t.strides.length!==3)throw new X(`If the strides property of a 3D pooling layer is an Array, it is expected to have a length of 3, but received length ${t.strides.length}.`);this.strides=t.strides}else this.strides=[t.strides,t.strides,t.strides];Zn(this.poolSize,"poolSize"),Zn(this.strides,"strides"),this.padding=t.padding==null?"valid":t.padding,this.dataFormat=t.dataFormat==null?"channelsLast":t.dataFormat,Sn(this.dataFormat),Er(this.padding),this.inputSpec=[new Pn({ndim:5})]}computeOutputShape(t){t=Ae(t);let e=this.dataFormat==="channelsFirst"?t[2]:t[1],s=this.dataFormat==="channelsFirst"?t[3]:t[2],r=this.dataFormat==="channelsFirst"?t[4]:t[3];return e=hi(e,this.poolSize[0],this.padding,this.strides[0]),s=hi(s,this.poolSize[1],this.padding,this.strides[1]),r=hi(r,this.poolSize[2],this.padding,this.strides[2]),this.dataFormat==="channelsFirst"?[t[0],t[1],e,s,r]:[t[0],e,s,r,t[4]]}call(t,e){return ct(()=>(this.invokeCallHook(t,e),this.poolingFunction(Zt(t),this.poolSize,this.strides,this.padding,this.dataFormat)))}getConfig(){const t={poolSize:this.poolSize,padding:this.padding,strides:this.strides,dataFormat:this.dataFormat},e=super.getConfig();return Object.assign(t,e),t}}class H3 extends W3{constructor(t){super(t)}poolingFunction(t,e,s,r,i){return Sn(i),Er(r),L3(t,e,s,r,i,"max")}}H3.className="MaxPooling3D";It(H3);class q3 extends W3{constructor(t){super(t)}poolingFunction(t,e,s,r,i){return Sn(i),Er(r),L3(t,e,s,r,i,"avg")}}q3.className="AveragePooling3D";It(q3);class j3 extends ue{constructor(t){super(t),this.inputSpec=[new Pn({ndim:3})]}computeOutputShape(t){return[t[0],t[2]]}call(t,e){throw new re}}class K3 extends j3{constructor(t){super(t||{})}call(t,e){return ct(()=>{const s=Zt(t);return An(s,1)})}}K3.className="GlobalAveragePooling1D";It(K3);class X3 extends j3{constructor(t){super(t||{})}call(t,e){return ct(()=>{const s=Zt(t);return ci(s,1)})}}X3.className="GlobalMaxPooling1D";It(X3);class Y3 extends ue{constructor(t){super(t),this.dataFormat=t.dataFormat==null?"channelsLast":t.dataFormat,Sn(this.dataFormat),this.inputSpec=[new Pn({ndim:4})]}computeOutputShape(t){return t=t,this.dataFormat==="channelsLast"?[t[0],t[3]]:[t[0],t[1]]}call(t,e){throw new re}getConfig(){const t={dataFormat:this.dataFormat},e=super.getConfig();return Object.assign(t,e),t}}class Q3 extends Y3{call(t,e){return ct(()=>{const s=Zt(t);return this.dataFormat==="channelsLast"?An(s,[1,2]):An(s,[2,3])})}}Q3.className="GlobalAveragePooling2D";It(Q3);class Z3 extends Y3{call(t,e){return ct(()=>{const s=Zt(t);return this.dataFormat==="channelsLast"?ci(s,[1,2]):ci(s,[2,3])})}}Z3.className="GlobalMaxPooling2D";It(Z3);/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */class J3 extends ue{constructor(t){super(t),this.layer=t.layer}build(t){this.built=!0}get trainable(){return this.layer!=null?this.layer.trainable:!1}set trainable(t){this.layer!=null&&(this.layer.trainable=t)}get trainableWeights(){return this.layer.trainableWeights}get nonTrainableWeights(){return this.layer.nonTrainableWeights}get updates(){return this.layer._updates}get losses(){return this.layer.losses}getWeights(){return this.layer.getWeights()}setWeights(t){this.layer.setWeights(t)}getConfig(){const t={layer:{className:this.layer.getClassName(),config:this.layer.getConfig()}},e=super.getConfig();return Object.assign(t,e),t}setFastWeightInitDuringBuild(t){super.setFastWeightInitDuringBuild(t),this.layer!=null&&this.layer.setFastWeightInitDuringBuild(t)}static fromConfig(t,e,s={}){const r=e.layer,i=qi(r,s);delete e.layer;const o={layer:i};return Object.assign(o,e),new t(o)}}class tF extends J3{constructor(t){super(t),this.supportsMasking=!0}build(t){if(t=Ae(t),t.length<3)throw new X(`TimeDistributed layer expects an input shape >= 3D, but received input shape ${JSON.stringify(t)}`);this.inputSpec=[{shape:t}];const e=[t[0]].concat(t.slice(2));this.layer.built||(this.layer.build(e),this.layer.built=!0),super.build(t)}computeOutputShape(t){t=Ae(t);const e=[t[0]].concat(t.slice(2)),s=this.layer.computeOutputShape(e),r=t[1];return[s[0],r].concat(s.slice(1))}call(t,e){return ct(()=>(t=Zt(t),u3((o,l)=>[Zt(this.layer.call(o,e)),[]],t,[],!1,null,null,!1,!0)[1]))}}tF.className="TimeDistributed";It(tF);function $Q(n){Tu(YX,"BidirectionalMergeMode",n)}const DQ="concat";class eF extends J3{constructor(t){super(t);const e=t.layer.getConfig(),s={};s.className=t.layer.getClassName(),s.config=e,this.forwardLayer=qi(s),e.goBackwards=e.goBackwards!==!0;const r={};if(r.className=t.layer.getClassName(),r.config=e,this.backwardLayer=qi(r),this.forwardLayer.name="forward_"+this.forwardLayer.name,this.backwardLayer.name="backward_"+this.backwardLayer.name,this.mergeMode=t.mergeMode===void 0?DQ:t.mergeMode,$Q(this.mergeMode),t.weights)throw new re("weights support is not implemented for Bidirectional layer yet.");this._stateful=t.layer.stateful,this.returnSequences=t.layer.returnSequences,this.returnState=t.layer.returnState,this.supportsMasking=!0,this._trainable=!0,this.inputSpec=t.layer.inputSpec,this.numConstants=null}get trainable(){return this._trainable}set trainable(t){this._trainable=t,this.forwardLayer!=null&&(this.forwardLayer.trainable=t),this.backwardLayer!=null&&(this.backwardLayer.trainable=t)}getWeights(){return this.forwardLayer.getWeights().concat(this.backwardLayer.getWeights())}setWeights(t){const e=t.length,s=Math.floor(e/2);this.forwardLayer.setWeights(t.slice(0,s)),this.backwardLayer.setWeights(t.slice(s))}computeOutputShape(t){let e=this.forwardLayer.computeOutputShape(t);Array.isArray(e)&&Array.isArray(e[0])||(e=[e]),e=e;let s,r,i;return this.returnState&&(i=e.slice(1)),s=e[0],s=s,this.mergeMode==="concat"?(s[s.length-1]*=2,r=[s]):this.mergeMode==null?r=[s,s.slice()]:r=[s],this.returnState?this.mergeMode==null?r.concat(i).concat(i.slice()):[s].concat(i).concat(i.slice()):Ks(r)}apply(t,e){let s=e==null?null:e.initialState,r=e==null?null:e.constants;e==null&&(e={});const i=l3(t,s,r,this.numConstants);if(t=i.inputs,s=i.initialState,r=i.constants,Array.isArray(t)&&(s=t.slice(1),t=t[0]),(s==null||s.length===0)&&r==null)return super.apply(t,e);const o=[],l=[];if(s!=null){const h=s.length;if(h%2>0)throw new X("When passing `initialState` to a Bidrectional RNN, the state should be an Array containing the states of the underlying RNNs.");e.initialState=s,o.push(...s);const d=s.map(p=>new Pn({shape:p.shape}));this.forwardLayer.stateSpec=d.slice(0,h/2),this.backwardLayer.stateSpec=d.slice(h/2),l.push(...d)}if(r!=null)throw new re("Support for constants in Bidirectional layers is not implemented yet.");const u=o[0]instanceof Ji;for(const h of o)if(h instanceof Ji!==u)throw new X("The initial state of a Bidirectional layer cannot be specified as a mix of symbolic and non-symbolic tensors");if(u){const h=[t].concat(o),d=this.inputSpec.concat(l),p=this.inputSpec;this.inputSpec=d;const m=super.apply(h,e);return this.inputSpec=p,m}else return super.apply(t,e)}call(t,e){return ct(()=>{const s=e.initialState;let r,i;if(s==null)r=this.forwardLayer.call(t,e),i=this.backwardLayer.call(t,e);else{const u=s.slice(0,s.length/2),h=s.slice(s.length/2);r=this.forwardLayer.call(t,Object.assign(e,{initialState:u})),i=this.backwardLayer.call(t,Object.assign(e,{initialState:h}))}let o;this.returnState&&(Array.isArray(r)&&(o=r.slice(1).concat(i.slice(1))),r=r[0],i=i[0]),this.returnSequences&&(i=uu(i,1));let l;return this.mergeMode==="concat"?l=mT([r,i]):this.mergeMode==="sum"?l=kt(r,i):this.mergeMode==="ave"?l=J(.5,kt(r,i)):this.mergeMode==="mul"?l=J(r,i):this.mergeMode==null&&(l=[r,i]),this.returnState?this.mergeMode==null?l.concat(o):[l].concat(o):l})}resetStates(t){this.forwardLayer.resetStates(),this.backwardLayer.resetStates()}build(t){Yl(this.forwardLayer.name,()=>{this.forwardLayer.build(t)}),Yl(this.backwardLayer.name,()=>{this.backwardLayer.build(t)}),this.built=!0}computeMask(t,e){Array.isArray(e)&&(e=e[0]);let s;if(this.returnSequences?this.mergeMode==null?s=[e,e]:s=e:this.mergeMode==null?s=[null,null]:s=null,this.returnState){const i=this.forwardLayer.states.map(o=>null);return Array.isArray(s)?s.concat(i).concat(i):[s].concat(i).concat(i)}else return s}get trainableWeights(){return this.forwardLayer.trainableWeights.concat(this.backwardLayer.trainableWeights)}get nonTrainableWeights(){return this.forwardLayer.nonTrainableWeights.concat(this.backwardLayer.nonTrainableWeights)}setFastWeightInitDuringBuild(t){super.setFastWeightInitDuringBuild(t),this.forwardLayer!=null&&this.forwardLayer.setFastWeightInitDuringBuild(t),this.backwardLayer!=null&&this.backwardLayer.setFastWeightInitDuringBuild(t)}getConfig(){const t={mergeMode:this.mergeMode},e=super.getConfig();return Object.assign(t,e),t}static fromConfig(t,e){const s=qi(e.layer);if(delete e.layer,e.numConstants!=null)throw new re("Deserialization of a Bidirectional layer with numConstants present is not supported yet.");const r=e;return r.layer=s,new t(r)}}eF.className="Bidirectional";It(eF);/**
 * @license
 * Copyright 2022 CodeSmith LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */class nF extends ue{constructor(t){super(t),this.scale=t.scale,t.offset?this.offset=t.offset:this.offset=0}getConfig(){const t={scale:this.scale,offset:this.offset},e=super.getConfig();return Object.assign(t,e),t}call(t,e){return ct(()=>(t=Zt(t),t.dtype!=="float32"&&(t=Wi(t,"float32")),kt(J(t,this.scale),this.offset)))}}nF.className="Rescaling";It(nF);/**
 * @license
 * Copyright 2022 CodeSmith LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */const{resizeBilinear:OQ,cropAndResize:MQ}=Do;class sF extends ue{constructor(t){super(t),this.height=t.height,this.width=t.width}centerCrop(t,e,s,r,i,o,l,u){return ct(()=>{let h,d=!1;const p=e/o,m=s/l,y=(r+e)/o,x=(i+s)/l,v=[p,m,y,x],C=[];t.rank===3?(d=!0,h=Bo([t])):h=t;for(let O=0;O<h.shape[0];O++)C.push(v);const S=Qd(C,[C.length,4]),E=mf(0,C.length,1,"int32"),I=MQ(h,S,E,[r,i],"nearest");return Wi(d?Zt(cu(I)):I,u)})}upsize(t,e,s,r){return ct(()=>{const i=OQ(t,[e,s]);return Wi(i,r)})}call(t,e){return ct(()=>{const s=Zt(t),r=s.dtype,i=s.shape,o=i[i.length-3],l=i[i.length-2];let u=0;o!==this.height&&(u=Math.floor((o-this.height)/2));let h=0;return l!==this.width&&(h=Math.floor((l-this.width)/2),h===0&&(h=1)),u>=0&&h>=0?this.centerCrop(s,u,h,this.height,this.width,o,l,r):this.upsize(t,this.height,this.width,r)})}getConfig(){const t={height:this.height,width:this.width},e=super.getConfig();return Object.assign(t,e),t}computeOutputShape(t){t=Ae(t);const e=t.length-3,s=t.length-2;return t[e]=this.height,t[s]=this.width,t}}sF.className="CenterCrop";It(sF);/**
 * @license
 * Copyright 2022 CodeSmith LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function FQ(n,t,e,s){let r=Zt(n);if(r.dtype!=="int32"&&(r=Wi(r,"int32")),t==="int")return r;const i=r.shape;if(r.rank===0&&(r=js(r,-1)),t==="oneHot"&&r.shape[r.shape.length-1]!==1&&(r=js(r,-1)),r.rank>2)throw new X(`When outputMode is not int, maximum output rank is 2 Received outputMode ${t} and input shape ${i} which would result in output rank ${r.rank}.`);const o=["multiHot","oneHot"].includes(t),l=r;let u;if(typeof s<"u"&&t==="count"?u=Kk(l,s,e,o):u=Kk(l,[],e,o),t!=="tfIdf")return u;if(s)return J(u,s);throw new X("When outputMode is 'tfIdf', weights must be provided.")}/**
 * @license
 * Copyright 2022 CodeSmith LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */class rF extends ue{constructor(t){super(t),this.numTokens=t.numTokens,t.outputMode?this.outputMode=t.outputMode:this.outputMode="multiHot"}getConfig(){const t={numTokens:this.numTokens,outputMode:this.outputMode},e=super.getConfig();return Object.assign(t,e),t}computeOutputShape(t){return t=Ae(t),t==null?[this.numTokens]:this.outputMode==="oneHot"&&t[t.length-1]!==1?(t.push(this.numTokens),t):(t[t.length-1]=this.numTokens,t)}call(t,e){return ct(()=>{t=Zt(t),t.dtype!=="int32"&&(t=Wi(t,"int32"));let s;if(typeof e.countWeights<"u"){if(this.outputMode!=="count")throw new X(`countWeights is not used when outputMode !== count.
              Received countWeights=${e.countWeights}`);s=Zt(e.countWeights)}const r=ci(t),i=Iy(t),o=Tr(this.numTokens,r).bufferSync().get(0),l=wu(i,0).bufferSync().get(0);if(!(o&&l))throw new X(`Input values must be between 0 < values <= numTokens with numTokens=${this.numTokens}`);return FQ(t,this.outputMode,this.numTokens,s)})}}rF.className="CategoryEncoding";It(rF);/**
 * @license
 * Copyright 2022 CodeSmith LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */const LQ=["bilinear","nearest"],LA=new Set(LQ);class iF extends ue{constructor(t){if(super(t),this.height=t.height,this.width=t.width,t.interpolation)if(LA.has(t.interpolation))this.interpolation=t.interpolation;else throw new X(`Invalid interpolation parameter: ${t.interpolation} is not implemented`);else this.interpolation="bilinear";this.cropToAspectRatio=!!t.cropToAspectRatio}computeOutputShape(t){t=Ae(t);const e=t[2];return[this.height,this.width,e]}getConfig(){const t={height:this.height,width:this.width,interpolation:this.interpolation,cropToAspectRatio:this.cropToAspectRatio},e=super.getConfig();return Object.assign(t,e),t}call(t,e){return ct(()=>{const s=[this.height,this.width];if(this.interpolation==="bilinear")return Do.resizeBilinear(t,s,!this.cropToAspectRatio);if(this.interpolation==="nearest")return Do.resizeNearestNeighbor(t,s,!this.cropToAspectRatio);throw new Error(`Interpolation is ${this.interpolation} but only ${[...LA]} are supported`)})}}iF.className="Resizing";It(iF);/**
 * @license
 * Copyright 2023 CodeSmith LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */class oF{constructor(t){this.seed=t}next(){if(this.seed!==void 0)return this.seed++}}oF.className="RandomSeed";/**
 * @license
 * Copyright 2023 CodeSmith LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */class aF extends ue{constructor(t){super(t),this.randomGenerator=new oF(t.seed)}getConfig(){const t={seed:this.randomGenerator.seed},e=super.getConfig();return Object.assign(t,e),t}}aF.className="BaseRandomLayer";/**
 * @license
 * Copyright 2023 CodeSmith LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */const PQ=["bilinear","nearest"],PA=new Set(PQ);class lF extends aF{constructor(t){super(t);const{factor:e,interpolation:s="bilinear"}=t;if(this.factor=e,Array.isArray(this.factor)&&this.factor.length===2)this.widthLower=this.factor[0],this.widthUpper=this.factor[1];else if(!Array.isArray(this.factor)&&this.factor>0)this.widthLower=-this.factor,this.widthUpper=this.factor;else throw new X(`Invalid factor: ${this.factor}. Must be positive number or tuple of 2 numbers`);if(this.widthLower<-1||this.widthUpper<-1)throw new X(`factor must have values larger than -1. Got: ${this.factor}`);if(this.widthUpper<this.widthLower)throw new X(`factor cannot have upper bound less than lower bound.
        Got upper bound: ${this.widthUpper}.
        Got lower bound: ${this.widthLower}
      `);if(s)if(PA.has(s))this.interpolation=s;else throw new X(`Invalid interpolation parameter: ${s} is not implemented`)}getConfig(){const t={factor:this.factor,interpolation:this.interpolation},e=super.getConfig();return Object.assign(t,e),t}computeOutputShape(t){t=Ae(t);const e=t[2];return[this.imgHeight,-1,e]}call(t,e){return ct(()=>{const s=Zt(t);this.imgHeight=s.shape[s.shape.length-3];const r=s.shape[s.shape.length-2];this.widthFactor=Rp([1],1+this.widthLower,1+this.widthUpper,"float32",this.randomGenerator.next());let i=this.widthFactor.dataSync()[0]*r;i=Math.round(i);const o=[this.imgHeight,i];switch(this.interpolation){case"bilinear":return Do.resizeBilinear(t,o);case"nearest":return Do.resizeNearestNeighbor(t,o);default:throw new Error(`Interpolation is ${this.interpolation}
          but only ${[...PA]} are supported`)}})}}lF.className="RandomWidth";It(lF);/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const VQ=dt();VQ.registerFlag("KEEP_INTERMEDIATE_TENSORS",()=>!1,n=>{n&&console.warn("Keep intermediate tensors is ON. This will print the values of all intermediate tensors during model inference. Not all models support this mode. For details, check e2e/benchmarks/ model_config.js. This significantly impacts performance.")});/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *
 * =============================================================================
 */var VA;(function(n){n[n.DT_INVALID=0]="DT_INVALID",n[n.DT_FLOAT=1]="DT_FLOAT",n[n.DT_DOUBLE=2]="DT_DOUBLE",n[n.DT_INT32=3]="DT_INT32",n[n.DT_UINT8=4]="DT_UINT8",n[n.DT_INT16=5]="DT_INT16",n[n.DT_INT8=6]="DT_INT8",n[n.DT_STRING=7]="DT_STRING",n[n.DT_COMPLEX64=8]="DT_COMPLEX64",n[n.DT_INT64=9]="DT_INT64",n[n.DT_BOOL=10]="DT_BOOL",n[n.DT_QINT8=11]="DT_QINT8",n[n.DT_QUINT8=12]="DT_QUINT8",n[n.DT_QINT32=13]="DT_QINT32",n[n.DT_BFLOAT16=14]="DT_BFLOAT16",n[n.DT_QINT16=15]="DT_QINT16",n[n.DT_QUINT16=16]="DT_QUINT16",n[n.DT_UINT16=17]="DT_UINT16",n[n.DT_COMPLEX128=18]="DT_COMPLEX128",n[n.DT_HALF=19]="DT_HALF",n[n.DT_RESOURCE=20]="DT_RESOURCE",n[n.DT_VARIANT=21]="DT_VARIANT",n[n.DT_UINT32=22]="DT_UINT32",n[n.DT_UINT64=23]="DT_UINT64",n[n.DT_FLOAT_REF=101]="DT_FLOAT_REF",n[n.DT_DOUBLE_REF=102]="DT_DOUBLE_REF",n[n.DT_INT32_REF=103]="DT_INT32_REF",n[n.DT_UINT8_REF=104]="DT_UINT8_REF",n[n.DT_INT16_REF=105]="DT_INT16_REF",n[n.DT_INT8_REF=106]="DT_INT8_REF",n[n.DT_STRING_REF=107]="DT_STRING_REF",n[n.DT_COMPLEX64_REF=108]="DT_COMPLEX64_REF",n[n.DT_INT64_REF=109]="DT_INT64_REF",n[n.DT_BOOL_REF=110]="DT_BOOL_REF",n[n.DT_QINT8_REF=111]="DT_QINT8_REF",n[n.DT_QUINT8_REF=112]="DT_QUINT8_REF",n[n.DT_QINT32_REF=113]="DT_QINT32_REF",n[n.DT_BFLOAT16_REF=114]="DT_BFLOAT16_REF",n[n.DT_QINT16_REF=115]="DT_QINT16_REF",n[n.DT_QUINT16_REF=116]="DT_QUINT16_REF",n[n.DT_UINT16_REF=117]="DT_UINT16_REF",n[n.DT_COMPLEX128_REF=118]="DT_COMPLEX128_REF",n[n.DT_HALF_REF=119]="DT_HALF_REF",n[n.DT_RESOURCE_REF=120]="DT_RESOURCE_REF",n[n.DT_VARIANT_REF=121]="DT_VARIANT_REF",n[n.DT_UINT32_REF=122]="DT_UINT32_REF",n[n.DT_UINT64_REF=123]="DT_UINT64_REF"})(VA||(VA={}));var zA;(function(n){(function(t){t[t.LEGACY=0]="LEGACY",t[t.V1=1]="V1",t[t.V2=2]="V2"})(n.CheckpointFormatVersion||(n.CheckpointFormatVersion={}))})(zA||(zA={}));/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *
 * =============================================================================
 */var BA;(function(n){n[n.FAIL=0]="FAIL",n[n.SHORTEST=1]="SHORTEST",n[n.LONGEST=2]="LONGEST"})(BA||(BA={}));/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Ft(n,t){Array.isArray(n)||(n=[n]),n.forEach(e=>{e!=null&&U(e.dtype!=="complex64",()=>`${t} does not support complex64 tensors in the CPU backend.`)})}/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const zQ=nO;class Mx extends fC{nextDataId(){return Mx.nextDataId++}constructor(){super(),this.blockSize=48,this.firstUse=!0,this.data=new A$(this,$i())}write(t,e,s){this.firstUse&&(this.firstUse=!1,dt().get("IS_NODE")&&vr(`
============================
Hi, looks like you are running TensorFlow.js in Node.js. To speed things up dramatically, install our node backend, visit https://github.com/tensorflow/tfjs-node for more details. 
============================`));const r={id:this.nextDataId()};return this.data.set(r,{values:t,dtype:s,refCount:1}),r}makeTensorInfo(t,e,s){let r;if(e==="string"&&s!=null&&s.length>0&&Rf(s[0])){const i=s.map(o=>Ma(o));r=this.write(i,t,e)}else r=this.write(s,t,e);return{dataId:r,shape:t,dtype:e}}refCount(t){return this.data.has(t)?this.data.get(t).refCount:0}incRef(t){const e=this.data.get(t);e.refCount++}decRef(t){if(this.data.has(t)){const e=this.data.get(t);e.refCount--}}move(t,e,s,r,i){this.data.set(t,{values:e,dtype:r,refCount:i})}numDataIds(){return this.data.numDataIds()}async read(t){return this.readSync(t)}readSync(t){const{dtype:e,complexTensorInfos:s}=this.data.get(t);if(e==="complex64"){const r=this.readSync(s.real.dataId),i=this.readSync(s.imag.dataId);return Uo(r,i)}return UW(this.data.get(t).values,e)}bufferSync(t){const e=this.readSync(t.dataId);if(t.dtype==="string")try{const s=e.map(r=>Wa(r));return ae(t.shape,t.dtype,s)}catch{throw new Error("Failed to decode encoded string bytes into utf-8")}return ae(t.shape,t.dtype,e)}makeOutput(t,e,s){return $i().makeTensorFromTensorInfo(this.makeTensorInfo(e,s,t),this)}disposeData(t,e=!1){if(this.data.has(t)){if(this.data.get(t).refCount--,!e&&this.data.get(t).refCount>0)return!1;const{complexTensorInfos:s}=this.data.get(t);s!=null&&(this.disposeData(s.real.dataId,!0),this.disposeData(s.imag.dataId,!0)),this.data.delete(t)}return!0}disposeIntermediateTensorInfo(t){this.disposeData(t.dataId)}async time(t){const e=qs();return t(),{kernelMs:qs()-e}}memory(){return{unreliable:!0,reasons:["The reported memory is an upper bound. Due to automatic garbage collection, the true allocated memory may be less."]}}where(t){Ft([t],"where");const e=this.readSync(t.dataId);return zQ(t.shape,e)}dispose(){}floatPrecision(){return 32}epsilon(){return super.epsilon()}}Mx.nextDataId=0;/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function uF(n){const t=new Float32Array(n.length);for(let e=0;e<n.length;++e)t[e]=Math.abs(n[e]);return t}const BQ=n=>{const{x:t}=n.inputs,e=n.backend;Ft(t,"abs");let s=new Float32Array(yt(t.shape));const r=e.data.get(t.dataId).values;return s=uF(r),e.makeOutput(s,t.shape,t.dtype)},UQ={kernelName:p0,backendName:"cpu",kernelFunc:BQ};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Tn(n){return(t,e,s,r,i)=>{const o=ne(t,e),l=o.length,u=zt(o),h=yt(o),d=Ss(i,h),p=t.length,m=e.length,y=zt(t),x=zt(e),v=jc(t,o),C=jc(e,o);if(v.length+C.length===0)for(let S=0;S<d.length;++S)d[S]=n(s[S%s.length],r[S%r.length]);else for(let S=0;S<d.length;++S){const E=uh(S,l,u),_=E.slice(-p);v.forEach(D=>_[D]=0);const I=Bi(_,p,y),O=E.slice(-m);C.forEach(D=>O[D]=0);const P=Bi(O,m,x);d[S]=n(s[I],r[P])}return[d,o]}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function or(n){const{inputs:t,backend:e}=n,{real:s,imag:r}=t,i=e.data.get(s.dataId).values,o=e.data.get(r.dataId).values,l=e.makeTensorInfo(s.shape,"complex64"),u=e.data.get(l.dataId);return u.complexTensorInfos={real:e.makeTensorInfo(s.shape,"float32",i),imag:e.makeTensorInfo(r.shape,"float32",o)},l}const GQ={kernelName:_C,backendName:"cpu",kernelFunc:or};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function By(n,t,e="float32"){if(e==="complex64"){const r=By(n,t,"float32"),i=By(n,t,"float32");return or({inputs:{real:r,imag:i},backend:n})}const s=Ts(yt(t),e);return n.makeTensorInfo(t,e,s)}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function to(n){const{inputs:t,backend:e}=n,{x:s}=t;return e.incRef(s.dataId),{dataId:s.dataId,shape:s.shape,dtype:s.dtype}}const WQ={kernelName:Zf,backendName:"cpu",kernelFunc:to};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function du(n){const{inputs:t,backend:e}=n,{input:s}=t,r=e.data.get(s.dataId).complexTensorInfos.real,i=e.data.get(r.dataId).values;return e.makeTensorInfo(r.shape,r.dtype,i)}const HQ={kernelName:QC,backendName:"cpu",kernelFunc:du};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function cF(n,t,e,s){if(s==="int32"){const r=Int32Array.from(n);return[t,"int32",r]}if(s==="bool"){const r=vu([0],e),[i,o]=Tn((l,u)=>l!==u?1:0)(t,[],n,r,"bool");return[o,"bool",i]}throw new Error(`Error in Cast: failed to cast ${e} to ${s}`)}function Xa(n){const{inputs:t,backend:e,attrs:s}=n,{x:r}=t,{dtype:i}=s;if(i==="complex64"){if(r.dtype==="complex64")return to({inputs:{x:r},backend:e});const d=By(e,r.shape,r.dtype),p=Xa({inputs:{x:r},backend:e,attrs:{dtype:"float32"}}),m=or({inputs:{real:p,imag:d},backend:e});return e.disposeIntermediateTensorInfo(d),e.disposeIntermediateTensorInfo(p),m}if(r.dtype==="complex64"){const d=du({inputs:{input:r},backend:e}),p=Xa({inputs:{x:d},backend:e,attrs:{dtype:i}});return e.disposeIntermediateTensorInfo(d),p}if(!R$(r.dtype,i)){const d=to({inputs:{x:r},backend:e});return{dataId:d.dataId,shape:d.shape,dtype:i}}const o=e.data.get(r.dataId).values,[l,u,h]=cF(o,r.shape,r.dtype,i);return e.makeTensorInfo(l,u,h)}const qQ={kernelName:Vf,backendName:"cpu",kernelFunc:Xa};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Un(n,t,e,s){return e==null?({inputs:r,backend:i})=>{const{a:o,b:l}=r,u=i;Ft([o,l],n);const h=u.data.get(o.dataId).values,d=u.data.get(l.dataId).values,p=o.dtype==="string"?Go(h):h,m=o.dtype==="string"?Go(d):d,y=s||o.dtype,[x,v]=t(o.shape,l.shape,p,m,y);return u.makeTensorInfo(v,y,x)}:({inputs:r,backend:i})=>{const{a:o,b:l}=r,u=i;if(o.dtype==="complex64"||l.dtype==="complex64"){const h=Xa({inputs:{x:o},backend:u,attrs:{dtype:"complex64"}}),d=u.data.get(h.dataId),p=d.complexTensorInfos.real,m=d.complexTensorInfos.imag,y=u.data.get(p.dataId).values,x=u.data.get(m.dataId).values,v=Xa({inputs:{x:l},backend:u,attrs:{dtype:"complex64"}}),C=u.data.get(v.dataId),S=C.complexTensorInfos.real,E=C.complexTensorInfos.imag,_=u.data.get(S.dataId).values,I=u.data.get(E.dataId).values,[O,P,D]=e(o.shape,l.shape,y,x,_,I),N=u.makeTensorInfo(D,"float32",O),R=u.makeTensorInfo(D,"float32",P),$=or({inputs:{real:N,imag:R},backend:u});return u.disposeIntermediateTensorInfo(h),u.disposeIntermediateTensorInfo(v),u.disposeIntermediateTensorInfo(N),u.disposeIntermediateTensorInfo(R),$}else{const h=u.data.get(o.dataId).values,d=u.data.get(l.dataId).values,p=s||o.dtype,[m,y]=t(o.shape,l.shape,h,d,p);return u.makeTensorInfo(y,p,m)}}}function OT(n){return(t,e,s,r,i,o)=>{const l=ne(t,e),u=yt(l),h=l.length,d=zt(l),p=Ss("float32",u),m=Ss("float32",u),y=jc(t,l),x=jc(e,l),v=Uo(s,r),C=Uo(i,o),S=t.length,E=zt(t),_=e.length,I=zt(e);if(y.length+x.length===0)for(let O=0;O<p.length;O++){const P=O%v.length,D=O%C.length,N=n(v[P*2],v[P*2+1],C[D*2],C[D*2+1]);p[O]=N.real,m[O]=N.imag}else for(let O=0;O<p.length;O++){const P=uh(O,h,d),D=P.slice(-S);y.forEach(V=>D[V]=0);const N=Bi(D,S,E),R=P.slice(-_);x.forEach(V=>R[V]=0);const $=Bi(R,_,I),A=n(v[N*2],v[N*2+1],C[$*2],C[$*2+1]);p[O]=A.real,m[O]=A.imag}return[p,m,l]}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const hF=Tn((n,t)=>n+t),jQ=OT((n,t,e,s)=>({real:n+e,imag:t+s})),Yc=Un(ch,hF,jQ),KQ={kernelName:ch,backendName:"cpu",kernelFunc:Yc};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function MT(n,t,e,s,r){const i=yt(s),o=Ts(r,e);for(let l=0;l<n.length;l++){const u=n[l];if(u<0)throw new Error("Input x must be non-negative!");u>=r||(i>0?o[u]+=t[l]:o[u]+=1)}return o}function dF(n,t,e,s=!1){const r=n.shape[0],i=n.shape[1],o=ae([r,e],t.dtype);for(let l=0;l<r;l++)for(let u=0;u<i;u++){const h=n.get(l,u);if(h<0)throw new Error("Input x must be non-negative!");h>=e||(s?o.set(1,l,h):t.size>0?o.set(o.get(l,h)+t.get(l,u),l,h):o.set(o.get(l,h)+1,l,h))}return o}/**
 * @license
 * Copyright 2023 Google LLC.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const fF=Tn((n,t)=>n&t),XQ=Un(IC,fF),YQ={kernelName:IC,backendName:"cpu",kernelFunc:XQ};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function no(n){return(t,e,s)=>{const r=bn(e,t.length);for(let i=0;i<t.length;++i)r[i]=n(t[i],s);return r}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Be(n,t,e){const s=no(t);return il(n,s,e)}function il(n,t,e){return({inputs:s,attrs:r,backend:i})=>{const{x:o}=s;Ft(o,n);const l=i,u=l.data.get(o.dataId).values;let h;if(o.dtype==="string"){if(!Array.isArray(u))throw new Error("String tensor's value was not an instance of Array");h=Go(u)}else h=u;const d=e||o.dtype,p=t(h,d,r);return l.makeTensorInfo(o.shape,d,p)}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const pF=no(n=>Math.ceil(n)),QQ=il(zf,pF),ZQ={kernelName:zf,backendName:"cpu",kernelFunc:QQ};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function mF(n,t,e,s){const r=bn(e,yt(t));if(s&&e!=="string"){let i=0;n.forEach(o=>{const l=yt(o.shape);r.set(o.vals,i),i+=l})}else{let i=0;n.forEach(o=>{const l=e==="string"?Go(o.vals):o.vals;let u=0;for(let h=0;h<o.shape[0];++h){const d=h*t[1]+i;for(let p=0;p<o.shape[1];++p)r[d+p]=l[u++]}i+=o.shape[1]})}return r}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const gF=Tn((n,t)=>n===t?1:0),yF=Un(A0,gF,null,"bool"),JQ={kernelName:A0,backendName:"cpu",kernelFunc:yF};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const xF=no(n=>Math.exp(n)),bF=il(jf,xF,"float32"),tZ={kernelName:jf,backendName:"cpu",kernelFunc:bF};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const vF=no(n=>Math.expm1(n)),eZ=il(Kf,vF),nZ={kernelName:Kf,backendName:"cpu",kernelFunc:eZ};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const wF=no(n=>Math.floor(n)),sZ=il(Xf,wF),rZ={kernelName:Xf,backendName:"cpu",kernelFunc:sZ};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const CF=Tn((n,t)=>Math.floor(n/t)),iZ=Un(Yf,CF,null,"int32"),oZ={kernelName:Yf,backendName:"cpu",kernelFunc:iZ};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function SF(n,t,e,s,r,i,o,l,u){const h=ae([s,i],e);for(let d=0;d<s;d++){const p=[];let m=0;for(let y=0;y<r;y++){const x=n[d*r+y];m+=x*o[y],p.push(x)}if(m<0||m>=u/i)throw new Error(`Invalid indices: ${p} does not index into ${l}`);for(let y=0;y<i;y++)h.values[d*i+y]=t.get(...t.indexToLoc(m*i+y))}return h}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function TF(n,t,e){const s=ae(e,n.dtype);for(let r=0;r<s.size;++r){const o=s.indexToLoc(r).slice(),l=o[0],u=o[2],h=t.locToIndex([l,u]);o[2]=t.values[h];const d=n.locToIndex(o);0<=d&&d<n.values.length&&(s.values[r]=n.values[d])}return s}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const EF=Tn((n,t)=>n>t?1:0),aZ=Un(D0,EF,null,"bool"),lZ={kernelName:D0,backendName:"cpu",kernelFunc:aZ};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const IF=Tn((n,t)=>n>=t?1:0),uZ=Un(Qf,IF,null,"bool"),cZ={kernelName:Qf,backendName:"cpu",kernelFunc:uZ};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const _F=Tn((n,t)=>n<t?1:0),hZ=Un(M0,_F,null,"bool"),dZ={kernelName:M0,backendName:"cpu",kernelFunc:hZ};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const kF=Tn((n,t)=>n<=t?1:0),fZ=Un(F0,kF,null,"bool"),pZ={kernelName:F0,backendName:"cpu",kernelFunc:fZ};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function AF(n,t,e){const s=(t-n)/(e-1),r=Ts(e,"float32");r[0]=n;for(let i=1;i<r.length;i++)r[i]=r[i-1]+s;return r}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const NF=no(n=>Math.log(n)),mZ=il(np,NF),gZ={kernelName:np,backendName:"cpu",kernelFunc:mZ};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function RF(n,t,e,s){const r=Ss(s,yt(e));for(let i=0;i<r.length;++i){const o=i*t;let l=n[o];for(let u=0;u<t;++u){const h=n[o+u];(Number.isNaN(h)||h>l)&&(l=h)}r[i]=l}return r}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const $F=Tn((n,t)=>Math.max(n,t)),yZ=Un(rp,$F),xZ={kernelName:rp,backendName:"cpu",kernelFunc:yZ};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const DF=Tn((n,t)=>Math.min(n,t)),bZ=Un(ip,DF),vZ={kernelName:ip,backendName:"cpu",kernelFunc:bZ};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const FT=Tn((n,t)=>n*t),wZ=OT((n,t,e,s)=>({real:n*e-t*s,imag:n*s+t*e})),Fx=Un(ap,FT,wZ),CZ={kernelName:ap,backendName:"cpu",kernelFunc:Fx};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function OF(n,t,e){const s=Qa(-1,e);return FT([],t,s,n,e)}function SZ(n){const{inputs:t,backend:e}=n,{x:s}=t;Ft(s,"neg");const r=e.data.get(s.dataId).values,[i,o]=OF(r,s.shape,s.dtype);return e.makeTensorInfo(o,s.dtype,i)}const TZ={kernelName:j0,backendName:"cpu",kernelFunc:SZ};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const MF=Tn((n,t)=>n!==t?1:0),EZ=Un(K0,MF,null,"bool"),IZ={kernelName:K0,backendName:"cpu",kernelFunc:EZ};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function LT(n,t,e,s,r){const i=t.length,o=yt(t),l=zt(t),u=zt(r),h=Ss(e,yt(r));for(let d=0;d<o;++d){const p=uh(d,i,l),m=new Array(p.length);for(let x=0;x<m.length;x++)m[x]=p[s[x]];const y=Bi(m,i,u);h[y]=n[d]}return h}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Qs(n){const{inputs:t,attrs:e,backend:s}=n,{x:r}=t,{perm:i}=e;Ft(r,"transpose");const o=r.shape.length,l=new Array(o);for(let p=0;p<l.length;p++)l[p]=r.shape[i[p]];const u=s.data.get(r.dataId).values,h=LT(u,r.shape,r.dtype,i,l);return{dataId:s.write(h,l,r.dtype),shape:l,dtype:r.dtype}}const _Z={kernelName:Dc,backendName:"cpu",kernelFunc:Qs};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function FF(n,t,e,s){const[r,i]=es(n,s),o=lr(t,"int32"),l=Ts(yt(r),o),u=yt(i);for(let h=0;h<l.length;++h){const d=h*u;let p=1;for(let m=0;m<u;++m)p*=e[d+m];l[h]=p}return{outVals:l,outShape:r,outDtype:o}}function kZ(n){const{inputs:t,backend:e,attrs:s}=n,{x:r}=t,{axis:i,keepDims:o}=s;Ft(r,"prod");const l=r.shape.length,u=le(i,r.shape),h=hn(u,l);let d=u,p=r;const m=[];h!=null&&(p=Qs({inputs:{x:r},backend:e,attrs:{perm:h}}),m.push(p),d=Cn(d.length,l));const y=e.data.get(p.dataId).values,{outVals:x,outShape:v,outDtype:C}=FF(p.shape,p.dtype,y,d);let S=v;return o&&(S=Nn(v,u)),m.forEach(E=>e.disposeIntermediateTensorInfo(E)),e.makeTensorInfo(S,C,x)}const AZ={kernelName:tx,backendName:"cpu",kernelFunc:kZ};/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function NZ(n,t,e){n.forEach((s,r)=>{if(s<0||s>=e){const i=uh(r,t.length,zt(t)).join(",");throw new Error(`indices[${i}] = ${s} is not in [0, ${e})`)}})}function RZ(n,t){for(let e=0;e<n.length;++e){const s=n[e],r=e===n.length-1?t:n[e+1].length;if(s.length===0)throw new Error("Ragged splits may not be empty");if(s[0]<0)throw new Error("Ragged splits must be non-negative");if(s[s.length-1]>r)throw new Error("Ragged splits must not point past values");for(let i=1;i<s.length;++i)if(s[i-1]>s[i])throw new Error("Ragged splits must be sorted in ascending order")}}function $Z(n,t,e,s){const r=[];let i=0;const o=t.length-1+e.length,l=new Array(o).fill(null).map(()=>[0]);RZ(e,s);let u=1;for(let h=0;h<t.length-1;++h){u*=t[h];const d=t[h+1];for(let p=1;p<u+1;++p)l[h].push(p*d)}for(let h=0;h<n.length;++h){let d=n[h],p=n[h]+1;for(let m=0;m<e.length;++m){const y=e[m],x=m+t.length-1;if(x>=0){const v=l[x],C=v[v.length-1]-y[d];for(let S=d;S<p;++S)l[x].push(y[S+1]+C)}d=y[d],p=y[p]}p!==d&&(r.push([d,p]),i+=p-d)}return{outSplits:l,valueSlices:r,numValues:i}}function DZ(n){const t=[];for(let e=0;e<n.length;++e){const s=n[e].length,r=bn("int32",s);t.push(r),n[e].forEach((i,o)=>r[o]=i)}return t}function UA(n,t){const e=n.slice(0,t);for(;e.length<t;)e.push(1);for(let s=t;s<n.length;s++)e[t-1]*=n[s];return e}function OZ(n,t,e,s,r,i){const o=UA(t,2)[1],l=UA(i,2)[1];let u=0;for(const h of e)for(let d=h[0];d<h[1];++d){for(let p=0;p<s;++p)r[u*l+p]=n[d*o+p];++u}}function MZ(n,t,e,s,r){const i=t.slice();i[0]=r;const o=bn(e,yt(i)),l=n.length,u=l===0?0:l/t[0];return OZ(n,t,s,u,o,i),[o,i]}function LF(n,t,e,s,r,i,o,l){if(n.length===0)throw new Error("paramsNestedSplits must be non empty");if(t[0].length===0)throw new Error("Split tensors must not be scalars");const u=t[0][0]-1;if(NZ(i,o,u),s.length===0)throw new Error("params.rank must be nonzero");const h=s[0],{outSplits:d,valueSlices:p,numValues:m}=$Z(i,o,n,h),y=DZ(d),x=MZ(e,s,r,p,m);return[y,x[0],x[1]]}/**
 * @license
 * Copyright 2022 Google LLC.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const GA=2147483647;function PF(n,t,e,s,r,i,o){if(t.length>1)throw new Error("starts must be a scalar or vector");if(r.length>1)throw new Error("limits must be a scalar or vector");if(o.length>1)throw new Error("deltas must be a scalar or vector");const l=t.length===0,u=r.length===0,h=o.length===0,d=[];l||d.push(t[0]),u||d.push(r[0]),h||d.push(o[0]);for(let C=1;C<d.length;++C)if(d[C]!==d[C-1])throw new Error("starts, limits, and deltas must have the same shape");const p=d.length===0?1:d[0],m=bn("int32",p+1);m[0]=0;for(let C=0;C<p;++C){const S=l?n[0]:n[C],E=u?s[0]:s[C],_=h?i[0]:i[C];if(_===0)throw new Error("Requires delta != 0");let I;if(_>0&&E<S||_<0&&E>S)I=0;else if(I=Math.ceil(Math.abs((E-S)/_)),I>GA)throw new Error(`Requires ((limit - start) / delta) <= ${GA}`);m[C+1]=m[C]+I}const y=m[p],x=bn(e,y);let v=0;for(let C=0;C<p;++C){const S=m[C+1]-m[C];let E=l?n[0]:n[C];const _=h?i[0]:i[C];for(let I=0;I<S;++I)x[v++]=E,E+=_}return[m,x]}/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */var zr=ii;class Uy{constructor(t,e,s,r,i,o,l,u,h,d){this.shape=t,this.shapeShape=e,this.values=s,this.valuesShape=r,this.valuesDType=i,this.defaultValue=o,this.defaultValueShape=l,this.rowPartitionValues=u,this.rowPartitionValuesShapes=h,this.rowPartitionTypes=SO(d),this.raggedRank=TO(this.rowPartitionTypes)}getRowPartitionTypeByDimension(t){return this.rowPartitionTypes[0]===zr.FIRST_DIM_SIZE?this.rowPartitionTypes[t+1]:this.rowPartitionTypes[t]}getRowPartitionTensor(t){return this.rowPartitionTypes[0]===zr.FIRST_DIM_SIZE?this.rowPartitionValues[t+1]:this.rowPartitionValues[t]}getMaxWidth(t){const e=this.getRowPartitionTensor(t-1);switch(this.getRowPartitionTypeByDimension(t-1)){case zr.VALUE_ROWIDS:return Uy.getMaxWidthValueRowID(e);case zr.ROW_SPLITS:return Uy.getMaxWidthRowSplit(e);default:throw new Error(`Cannot handle partition type ${zr[this.getRowPartitionTypeByDimension(t-1)]}`)}}static getMaxWidthRowSplit(t){const e=t.length;if(e===0||e===1)return 0;let s=0;for(let r=0;r<e-1;++r){const i=t[r+1]-t[r];i>s&&(s=i)}return s}static getMaxWidthValueRowID(t){const e=t.length;if(e===0)return 0;let s=0,r=t[0],i=0;for(let o=1;o<e;++o){const l=t[o];l!==r&&(r=l,i=Math.max(o-s,i),s=o)}return Math.max(e-s,i)}tensorShapeFromTensor(t,e,s=!0){if(e.length===0){if(t[0]===-1)return[];throw new Error("The only valid scalar shape tensor is the fully unknown shape specified as -1.")}return HA(t,s)}calculateOutputSize(t){const e=this.valuesShape,s=this.defaultValueShape;EO(s,e);const r=this.tensorShapeFromTensor(this.shape,this.shapeShape),o=CO(this.raggedRank,r,e);o[0]<0&&(o[0]=t);for(let l=1;l<=this.raggedRank;++l)o[l]<0&&(o[l]=this.getMaxWidth(l));return o}calculateFirstParentOutputIndex(t,e,s){const r=Math.min(t,s),i=[];let o=0;for(let l=0;l<r;++l,o+=e)i.push(o);for(let l=r;l<t;++l)i.push(-1);return U(i.length===t,()=>"Final length of result must be equal to firstDimension."),i}calculateOutputIndexRowSplit(t,e,s,r){const i=t.length,o=[];for(let l=0;l<i-1;++l){const u=t[l+1]-t[l];let h=Math.min(r,u),d=e[l];d===-1&&(h=0);for(let p=0;p<h;++p)o.push(d),d+=s;for(let p=0;p<u-h;++p)o.push(-1)}if(i>0&&o.length!==t[i-1])throw new Error("Invalid row split size.");return o}calculateOutputIndexValueRowID(t,e,s,r){const i=t.length,o=[];if(i===0)return[];let l=0,u=t[0];if(u>=e.length)throw new Error(`Got currentValueRowId=${u}, which is not less than ${e.length}`);let h=e[u];o.push(h);for(let d=1;d<i;++d){const p=t[d];if(p===u)h>=0&&(++l,l<r?h+=s:h=-1);else{if(l=0,u=p,p>=e.length)throw new Error(`Got nextValueRowId=${p} which is not less than ${e.length}`);h=e[p]}o.push(h)}if(o.length!==t.length)throw new Error("Invalid row ids.");return o}calculateOutputIndex(t,e,s,r){const i=this.getRowPartitionTensor(t),o=this.getRowPartitionTypeByDimension(t);switch(o){case zr.VALUE_ROWIDS:return this.calculateOutputIndexValueRowID(i,e,s,r);case zr.ROW_SPLITS:if(i.length-1>e.length)throw new Error(`Row partition size is greater than output size: ${i.length-1} > ${e.length}`);return this.calculateOutputIndexRowSplit(i,e,s,r);default:throw new Error(`Unsupported partition type: ${zr[o]}`)}}getFirstDimensionSize(){const t=this.rowPartitionValues[0];if(this.rowPartitionTypes.length===0)throw new Error("No row_partition_types given.");const e=this.rowPartitionTypes[0];switch(e){case zr.FIRST_DIM_SIZE:return t[0];case zr.VALUE_ROWIDS:throw new Error("Cannot handle VALUE_ROWIDS in first dimension.");case zr.ROW_SPLITS:return this.rowPartitionValuesShapes[0][0]-1;default:throw new Error(`Cannot handle type ${zr[e]}`)}}compute(){if(this.rowPartitionValues[0].length<=0)throw new Error("Invalid first partition input. Tensor requires at least one element.");const e=this.getFirstDimensionSize(),s=this.calculateOutputSize(e),r=new Array(this.raggedRank+1);r[r.length-1]=1;for(let u=r.length-2;u>=0;--u)r[u]=r[u+1]*s[u+1];const i=HA(s,!1),o=bn(this.valuesDType,yt(i));if(r[0]*s[0]>0){let u=this.calculateFirstParentOutputIndex(e,r[0],s[0]);for(let h=1;h<=this.raggedRank;++h)u=this.calculateOutputIndex(h-1,u,r[h],s[h]);this.setOutput(this.raggedRank,u,o,i)}return[i,o]}setOutput(t,e,s,r){if(s.length===0)return;const i=this.values,o=s;let l=r.slice();l=l.slice(t+1);const u=yt(l),h=e.length;let d=this.defaultValue;if(d.length!==u&&d.length!==1){const x=this.defaultValueShape;ct(()=>{const v=rt(d,x);d=Zd(v,l).dataSync()})}let p=0,m=0,y=0;for(let x=0;x<=h;++x){let v=x<h?e[x]:-1;if(v===y){++y;continue}if(m<y){const C=i.subarray(p*u),S=o.subarray(m*u),E=(y-m)*u;WA(S,C,E)}if(x>=h){const C=s.length;v=Math.floor(C/u)}if(v>y)if(this.defaultValue.length===1)o.subarray(y*u,v*u).fill(this.defaultValue[0]),y=v;else for(;v>y;){const C=o.slice(y*u);WA(C,d,u),++y}v<0?(p=x+1,m=y):(p=x,m=y,y=m+1)}}}function WA(n,t,e){for(let s=0;s<e;s++)n[s]=t[s]}function HA(n,t){const e=[];for(let s of n){if(s<0){if(!t)throw new Error(`Dimension ${s} must be >= 0`);if(s<-1)throw new Error(`Dimension ${s} must be >= -1`);s=-1}e.push(s)}return e}function VF(n,t,e,s,r,i,o,l,u,h){return new Uy(n,t,e,s,r,i,o,l,u,h).compute()}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function zF(n,t,e,s){const r=n===t,i=n<t&&e<0,o=t<n&&e>1;if(r||i||o)return Ts(0,s);const l=Math.abs(Math.ceil((t-n)/e)),u=Ts(l,s);t<n&&e===1&&(e=-1),u[0]=n;for(let h=1;h<u.length;h++)u[h]=u[h-1]+e;return u}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const BF=no(n=>1/Math.sqrt(n)),FZ=il(fp,BF),LZ={kernelName:fp,backendName:"cpu",kernelFunc:FZ};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Kl(n,t,e,s,r,i,o,l,u,h){const d=[s/r,r],p=n.values,m=t.values;if(s===0)return ae(e,t.dtype);const y=u instanceof us?u:ae(d,t.dtype);typeof u=="string"||typeof u=="number"?y.values.fill(u):typeof u=="boolean"&&y.values.fill(+u);for(let x=0;x<i;x++){const v=[];let C=0;for(let S=0;S<o;S++){const E=p[x*o+S];v.push(E),C+=E*l[S]}if(C<0||C>=s/r)throw new Error(`Invalid indices: ${v} does not index into ${e}`);for(let S=0;S<r;S++)h?y.values[C*r+S]+=m[x*r+S]:y.values[C*r+S]=t.rank===0?m[0]:m[x*r+S]}return y}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const PZ=no(n=>1/(1+Math.exp(-n))),UF=Be(xp,n=>1/(1+Math.exp(-n))),VZ={kernelName:xp,backendName:"cpu",kernelFunc:UF};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function GF(n,t,e,s,r){const i=WS(s,t,e),o=yt(e),l=zt(s);if(i){const p=HS(t,l);return r==="string"?n.slice(p,p+o):n.subarray(p,p+o)}const u=r==="string"?Go(n):n,h=ae(s,r,u),d=ae(e,r);for(let p=0;p<d.size;++p){const m=d.indexToLoc(p),y=m.map((x,v)=>x+t[v]);d.set(h.get(...y),...m)}return r==="string"?HO(d.values):d.values}function fu(n){const{inputs:t,backend:e,attrs:s}=n,{x:r}=t,{begin:i,size:o}=s;Ft(r,"slice");const[l,u]=wx(r,i,o);US(r,l,u);const h=e.data.get(r.dataId).values,d=GF(h,l,u,r.shape,r.dtype);return e.makeTensorInfo(u,r.dtype,d)}const zZ={kernelName:ox,backendName:"cpu",kernelFunc:fu};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function WF(n,t,e,s,r,i,o){const l=t[0],u=i[0],h=new Array(u),d=new Array(l),p=t[1];if(u===0){if(l!==0)throw new Error($O(l));const C=bn(e,0),S=bn(r,0);return[C,[0,p],S,h,d]}let m=!0,y=0;const x=new Array(u).fill(0);for(let C=0;C<l;++C){const S=n[C*p];if(S<0)throw new Error(DO(C,S));if(S>=u)throw new Error(OO(C,S,u));++x[S],m=m&&S>=y,y=S}let v=!0;for(let C=0;C<u;++C){const S=x[C]===0;h[C]=S,v=v&&!S,x[C]=Math.max(x[C],1),C>0&&(x[C]+=x[C-1])}if(v&&m){const C=n,S=s;for(let E=0;E<l;++E)d[E]=E;return[C,[l,p],S,h,d]}else{const C=x[u-1],S=bn(e,C*p),E=bn(r,C),_=new Array(u).fill(0);for(let I=0;I<l;++I){const O=n[I*p],P=_[O],D=(O===0?0:x[O-1])+P;_[O]++;for(let N=0;N<p;++N)S[D*p+N]=n[I*p+N];E[D]=s[I],d[I]=D}for(let I=0;I<u;++I)if(_[I]===0){const P=I===0?0:x[I-1];S[P*p+0]=I;for(let D=1;D<p;++D)S[P*p+D]=0;E[P]=o}return[S,[C,p],E,h,d]}}/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function HF(n,t,e,s,r){const i=yt(s),o=t[0],l=r.length,u=[];let h=1,d=-1;for(let C=0;C<l;++C){const S=r[C];if(S===-1){if(d!==-1)throw new Error(MO(d,C));d=C,u.push(1)}else{if(S<0)throw new Error(FO(C,S));h*=S,u.push(S)}}if(d!==-1){if(h<=0)throw new Error(LO());const C=Math.trunc(i/h);if(h*C!==i)throw new Error(PO(s,u));u[d]=C}if(yt(u)!==i)throw new Error(VO(s,u));const m=s.length,y=[];if(m>0){y[m-1]=1;for(let C=m-2;C>=0;--C)y[C]=y[C+1]*s[C+1]}const x=[];if(l>0){x[l-1]=1;for(let C=l-2;C>=0;--C)x[C]=x[C+1]*u[C+1]}const v=bn(e,o*l);for(let C=0;C<o;++C){let S=0;for(let E=0;E<m;++E)S+=n[C*m+E]*y[E];for(let E=0;E<l;++E)v[C*l+E]=Math.trunc(S/x[E]),S%=x[E]}return[v,[o,l],u]}/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function PT(n,t,e,s,r,i=!1,o=0){const l=s.length,u=[t[0],n.length/t[0]],h=u[1],p=l>0?r[l-1]+1:0;if(p<0)throw new Error(pw());const m=t.slice();m[0]=p;const y=m.reduce((_,I)=>_*I,1),x=bn(e,y);if(l===0)return p>0&&x.fill(o),[x,m];if(p<=0)throw new Error(pw());let v=0,C=1,S=0,E=r[v];for(;;){let _=0;if(C<l){if(_=r[C],E===_){++C;continue}if(E>=_)throw new Error(zO())}if(E<0||E>=p)throw new Error(BO(E,p));E>S&&x.fill(o,S*h,E*h);for(let I=v;I<C;++I){const O=s[I];if(O<0||O>=u[0])throw new Error(UO(I,s[I],u[0]));for(let P=0;P<h;P++)x[E*h+P]+=n[O*h+P]}if(i)for(let I=0;I<h;I++)x[E*h+I]/=C-v;if(v=C,++C,S=E+1,E=_,C>l)break}return S<p&&x.fill(o,S*h,p*h),[x,m]}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const BZ=no(n=>Math.sqrt(n)),UZ=Be(vp,n=>Math.sqrt(n)),GZ={kernelName:vp,backendName:"cpu",kernelFunc:UZ};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const qF=Tn((n,t)=>{const e=n-t;return e*e}),WZ=Un(wp,qF),HZ={kernelName:wp,backendName:"cpu",kernelFunc:WZ};/**
 * @license
 * Copyright 2023 Google LLC.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const jF=no((n,t)=>{const{pattern:e,replaceGlobal:s,rewrite:r}=t;return n.replace(new RegExp(e,s?"g":""),r)}),qZ=il(eS,jF),jZ={kernelName:eS,backendName:"cpu",kernelFunc:qZ};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function KF(n,t,e,s){const r=ae(n,t.dtype);for(let i=0;i<r.size;i++){const o=r.indexToLoc(i),l=new Array(o.length);for(let u=0;u<l.length;u++)l[u]=o[u]*e[u]+s[u];r.set(t.get(...l),...o)}return r}/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class KZ{constructor(t,e,s,r,i,o){this.separator=Ma(t),this.nGramWidths=e,this.leftPad=Ma(s),this.rightPad=Ma(r),this.padWidth=i,this.preserveShort=o}getPadWidth(t){return Math.min(this.padWidth<0?t-1:this.padWidth,t-1)}getNumNGrams(t,e){const s=this.getPadWidth(e);return Math.max(0,t+2*s-e+1)}createNGrams(t,e,s,r,i,o){for(let l=0;l<i;++l){const u=this.getPadWidth(o),h=Math.max(0,u-l),d=Math.max(0,u-(i-(l+1))),p=o-(h+d),m=e+(h>0?0:l-u);let y=0;y+=h*this.leftPad.length;for(let E=0;E<p;++E)y+=t[m+E].length;y+=d*this.rightPad.length;const x=h+d+p-1;y+=x*this.separator.length,s[r+l]=new Uint8Array(y);const v=s[r+l];let C=0;const S=E=>E.forEach(_=>v[C++]=_);for(let E=0;E<h;++E)S(this.leftPad),S(this.separator);for(let E=0;E<p-1;++E)S(t[m+E]),S(this.separator);if(p>0){S(t[m+p-1]);for(let E=0;E<d;++E)S(this.separator),S(this.rightPad)}else{for(let E=0;E<d-1;++E)S(this.rightPad),S(this.separator);S(this.rightPad)}}}compute(t,e){const s=t.length,r=e.length;if(r>0){let u=e[0];if(u!==0)throw new Error(`First split value must be 0, got ${u}`);for(let h=1;h<r;++h){let d=e[h]>=u;if(d=d&&e[h]<=s,!d)throw new Error(`Invalid split value ${e[h]}, must be in [${u}, ${s}]`);u=e[h]}if(u!==s)throw new Error(`Last split value must be data size. Expected ${s}, got ${u}`)}const i=r-1,o=bn("int32",r);if(s===0||r===0){const u=new Array(s);for(let h=0;h<=i;++h)o[h]=0;return[u,o]}o[0]=0;for(let u=1;u<=i;++u){const h=e[u]-e[u-1];let d=0;this.nGramWidths.forEach(p=>{d+=this.getNumNGrams(h,p)}),this.preserveShort&&h>0&&d===0&&(d=1),o[u]=o[u-1]+d}const l=new Array(o[i]);for(let u=0;u<i;++u){const h=e[u];let d=o[u];if(this.nGramWidths.forEach(p=>{const m=e[u+1]-e[u],y=this.getNumNGrams(m,p);this.createNGrams(t,h,l,d,y,p),d+=y}),this.preserveShort&&d===o[u]){const p=e[u+1]-e[u];if(p===0)continue;const m=p+2*this.padWidth;this.createNGrams(t,h,l,d,1,m)}}return[l,o]}}function XF(n,t,e,s,r,i,o,l){return new KZ(e,s,r,i,o,l).compute(n,t)}/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function XZ(n,t,e,s){if(!n.length)return;if(t.length===0){for(let i=0;i<n.length;++i)s.push(n.subarray(i,i+1));return}if(t.length===1){const i=t[0];let o=n.indexOf(i);for(;o!==-1;){const l=n.subarray(0,o);(!e||l.length!==0)&&s.push(l),n=n.subarray(o+1),o=n.indexOf(i)}(!e||n.length!==0)&&s.push(n);return}let r=0;for(let i=0;i<n.length+1;i++)if(i===n.length||t.indexOf(n[i])!==-1){const o=n.subarray(r,i);(!e||o.length!==0)&&s.push(o),r=i+1}}function YF(n,t,e){const s=n.length,r=[];let i=0,o=0;const l=new Array(s);for(let m=0;m<s;++m){const y=r.length;XZ(n[m],t,e,r);const x=r.length-y;l[m]=x,i+=x,o=Math.max(o,x)}const u=bn("int32",i*2),h=new Array(i),d=[s,o];let p=0;for(let m=0;m<s;++m)for(let y=0;y<l[m];++y)u[p*2]=m,u[p*2+1]=y,h[p]=r[p],++p;return[u,h,d]}/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function QF(n,t){const e=bn("int32",n.length);for(let s=0;s<n.length;++s)e[s]=oH(n[s]).modulo(t).getLowBitsUnsigned();return e}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const ZF=Tn((n,t)=>n-t),YZ=OT((n,t,e,s)=>({real:n-e,imag:t-s})),VT=Un(Cp,ZF,YZ),QZ={kernelName:Cp,backendName:"cpu",kernelFunc:VT};/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function JF(n,t){const e=new Array(n.rank);for(let r=0;r<e.length;r++)e[r]=n.shape[r]*t[r];const s=ae(e,n.dtype);for(let r=0;r<s.values.length;++r){const i=s.indexToLoc(r),o=new Array(n.rank);for(let u=0;u<o.length;u++)o[u]=i[u]%n.shape[u];const l=n.locToIndex(o);s.values[r]=n.values[l]}return s}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Gd=(n,t)=>{const e=t.value-n.value;return e===0?n.index-t.index:e};function tL(n,t,e=0,s=n.length-1){for(;s>e;){if(s-e>600){const l=s-e+1,u=t-e+1,h=Math.log(l),d=.5*Math.exp(2*h/3),p=.5*Math.sqrt(h*d*(l-d)/l)*Math.sign(u-l/2),m=Math.max(e,Math.floor(t-u*d/l+p)),y=Math.min(s,Math.floor(t+(l-u)*d/l+p));tL(n,t,m,y)}const r=n[t];let i=e,o=s;for(_c(n,e,t),Gd(n[s],r)>0&&_c(n,e,s);i<o;){for(_c(n,i,o),i++,o--;Gd(n[i],r)<0;)i=i+1;for(;Gd(n[o],r)>0;)o=o-1}Gd(n[e],r)===0?_c(n,e,o):(o=o+1,_c(n,o,s)),o<=t&&(e=o+1),t<=o&&(s=o-1)}}function eL(n,t,e,s,r){const i=t[t.length-1],[o,l]=[n.length/i,i],u=Ss(e,o*s),h=Ss("int32",o*s);for(let p=0;p<o;p++){const m=p*l,y=n.subarray(m,m+l);let x=new Array(y.length);y.forEach((E,_)=>x[_]={value:E,index:_}),s<x.length&&(tL(x,s),x=x.slice(0,s)),r&&x.sort(Gd);const v=p*s,C=u.subarray(v,v+s),S=h.subarray(v,v+s);for(let E=0;E<s;E++)C[E]=x[E].value,S[E]=x[E].index}const d=t.slice();return d[d.length-1]=s,[ae(d,e,u),ae(d,"int32",h)]}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function nL(n,t,e,s){const r=le(t,e)[0],i=[1,e[0],1];for(let x=0;x<r;x++)i[0]*=e[x];i[1]=e[r];for(let x=r+1;x<e.length;x++)i[2]*=e[x];const o=new Map,l=new Int32Array(e[r]),u=new us(i,s,n),h=[],d=i[0]===1&&i[2]===1;for(let x=0;x<e[r];x++){let v;if(d)v=n[x].toString();else{const S=[];for(let E=0;E<i[0];E++)for(let _=0;_<i[2];_++)S.push(u.get(E,x,_));v=S.join(",")}const C=o.get(v);if(C!=null)l[x]=C;else{const S=o.size;o.set(v,S),l[x]=S,h.push(x)}}const p=i.slice();p[1]=o.size;const m=new us(p,s);h.forEach((x,v)=>{for(let C=0;C<i[0];C++)for(let S=0;S<i[2];S++)m.set(u.get(C,x,S),C,v,S)});const y=e.slice();return y[r]=p[1],{outputValues:m.values,outputShape:y,indices:l}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const ZZ=Object.freeze(Object.defineProperty({__proto__:null,addImpl:hF,bincountImpl:MT,bincountReduceImpl:dF,bitwiseAndImpl:fF,castImpl:cF,ceilImpl:pF,concatImpl:mF,equalImpl:gF,expImpl:xF,expm1Impl:vF,floorDivImpl:CF,floorImpl:wF,gatherNdImpl:SF,gatherV2Impl:TF,greaterEqualImpl:IF,greaterImpl:EF,lessEqualImpl:kF,lessImpl:_F,linSpaceImpl:AF,logImpl:NF,maxImpl:RF,maximumImpl:$F,minimumImpl:DF,multiplyImpl:FT,negImpl:OF,notEqualImpl:MF,prodImpl:FF,raggedGatherImpl:LF,raggedRangeImpl:PF,raggedTensorToTensorImpl:VF,rangeImpl:zF,rsqrtImpl:BF,scatterImpl:Kl,sigmoidImpl:PZ,simpleAbsImpl:uF,sliceImpl:GF,sparseFillEmptyRowsImpl:WF,sparseReshapeImpl:HF,sparseSegmentReductionImpl:PT,sqrtImpl:BZ,squaredDifferenceImpl:qF,staticRegexReplaceImpl:jF,stridedSliceImpl:KF,stringNGramsImpl:XF,stringSplitImpl:YF,stringToHashBucketFastImpl:QF,subImpl:ZF,tileImpl:JF,topKImpl:eL,transposeImpl:LT,uniqueImpl:nL},Symbol.toStringTag,{value:"Module"}));/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */vD("cpu",()=>new Mx,1);/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const sL=Be(Hf,n=>n>=0?n:Math.exp(n)-1),JZ={kernelName:Hf,backendName:"cpu",kernelFunc:sL};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function rL(n){const{inputs:t,backend:e,attrs:s}=n,{x:r}=t,{alpha:i}=s;Ft([r],"leakyRelu");const o=yt(r.shape),l=e.data.get(r.dataId).values,u=Ss("float32",o);for(let h=0;h<l.length;h++)u[h]=l[h]<0?i*l[h]:l[h];return e.makeTensorInfo(r.shape,"float32",u)}const tJ={kernelName:O0,backendName:"cpu",kernelFunc:rL};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const eJ=Tn((n,t)=>n<0?t*n:n);function iL(n){const{inputs:t,backend:e}=n,{x:s,alpha:r}=t;Ft([s,r],"prelu");const i=e.data.get(s.dataId).values,o=e.data.get(r.dataId).values,[l,u]=eJ(s.shape,r.shape,i,o,"float32");return e.makeTensorInfo(u,"float32",l)}const nJ={kernelName:J0,backendName:"cpu",kernelFunc:iL};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const oL=Be(cp,n=>Math.max(0,n)),sJ={kernelName:cp,backendName:"cpu",kernelFunc:oL};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const aL=Be(hp,n=>Math.min(Math.max(0,n),6)),rJ={kernelName:hp,backendName:"cpu",kernelFunc:aL};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Gy(n,t,e,s,r){if(e==="linear")return to({inputs:{x:t},backend:n});if(e==="relu")return oL({inputs:{x:t},backend:n});if(e==="elu")return sL({inputs:{x:t},backend:n});if(e==="relu6")return aL({inputs:{x:t},backend:n});if(e==="prelu")return iL({inputs:{x:t,alpha:s},backend:n});if(e==="leakyrelu")return rL({inputs:{x:t},backend:n,attrs:{alpha:r}});if(e==="sigmoid")return UF({inputs:{x:t},backend:n});throw new Error(`Activation ${e} has not been implemented for the CPU backend.`)}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function tn(n){const{inputs:t,backend:e,attrs:s}=n,{x:r}=t,{shape:i}=s,o=yt(r.shape),l=N$(i,o),u=yt(l);U(o===u,()=>`The new shape (${l}) has ${u} elements and the old shape (${r.shape}) has ${o} elements. The new shape and old shape must have the same number of elements.`),e.incRef(r.dataId);const h=e.data.get(r.dataId);if(h.complexTensorInfos!=null){const d=h.complexTensorInfos.real,p=h.complexTensorInfos.imag;d.shape=l,p.shape=l}return{dataId:r.dataId,shape:l,dtype:r.dtype}}const iJ={kernelName:ex,backendName:"cpu",kernelFunc:tn};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function lL(n){const{inputs:t,backend:e,attrs:s}=n,{a:r,b:i}=t,{transposeA:o,transposeB:l}=s;Ft([r,i],"matMul");const u=r.shape.length,h=i.shape.length,d=o?r.shape[u-2]:r.shape[u-1],p=l?i.shape[h-1]:i.shape[h-2],m=o?r.shape[u-1]:r.shape[u-2],y=l?i.shape[h-2]:i.shape[h-1],x=r.shape.slice(0,-2),v=i.shape.slice(0,-2),C=yt(x),S=yt(v),_=ne(r.shape.slice(0,-2),i.shape.slice(0,-2)).concat([m,y]);U(d===p,()=>`Error in matMul: inner shapes (${d}) and (${p}) of Tensors with shapes ${r.shape} and ${i.shape} and transposeA=${o} and transposeB=${l} must match.`);const I=o?[C,d,m]:[C,m,d],O=l?[S,y,p]:[S,p,y],P=tn({inputs:{x:r},backend:e,attrs:{shape:I}}),D=tn({inputs:{x:i},backend:e,attrs:{shape:O}}),N=o?P.shape[1]:P.shape[2],R=o?P.shape[2]:P.shape[1],$=l?D.shape[1]:D.shape[2],A=Math.max(C,S),V=e.data.get(P.dataId).values,L=e.data.get(D.dataId).values,nt=zt(P.shape),Z=zt(D.shape),[W,K,Y]=o?[nt[0],1,nt[1]]:[nt[0],nt[1],1],[at,B,j]=l?[1,Z[1],Z[0]]:[Z[1],1,Z[0]],st=R*$,tt=ae([A,R,$],P.dtype),xt=tt.values,vt=e.blockSize;for(let Ct=0;Ct<A;Ct++){const $t=Ct%C,Rt=Ct%S;for(let Lt=0;Lt<R;Lt+=vt){const jt=Math.min(Lt+vt,R);for(let Kt=0;Kt<$;Kt+=vt){const de=Math.min(Kt+vt,$);for(let be=0;be<N;be+=vt){const Me=Math.min(be+vt,N);for(let Ne=Lt;Ne<jt;Ne++)for(let Se=Kt;Se<de;Se++){let me=0;for(let Ue=be;Ue<Me;Ue++){const Bs=V[$t*W+Ne*K+Ue*Y],sn=L[Ue*at+Se*B+Rt*j];me+=Bs*sn}xt[Ct*st+(Ne*$+Se)]+=me}}}}}return e.disposeIntermediateTensorInfo(P),e.disposeIntermediateTensorInfo(D),e.makeTensorInfo(_,tt.dtype,tt.values)}const oJ={kernelName:b0,backendName:"cpu",kernelFunc:lL};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function aJ(n){const{inputs:t,backend:e,attrs:s}=n,{a:r,b:i,bias:o,preluActivationWeights:l}=t,{transposeA:u,transposeB:h,activation:d,leakyreluAlpha:p}=s;let m,y,x;const v=[];m=lL({inputs:{a:r,b:i},attrs:{transposeA:u,transposeB:h},backend:e}),o&&(y=Yc({inputs:{a:m,b:o},backend:e}),v.push(m),m=y),d&&(x=Gy(e,m,d,l,p),v.push(m),m=x);for(const S of v)e.disposeIntermediateTensorInfo(S);return m}const lJ={kernelName:wy,backendName:"cpu",kernelFunc:aJ};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const uJ=Be($f,n=>Math.acos(n)),cJ={kernelName:$f,backendName:"cpu",kernelFunc:uJ};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const hJ=Be(Df,n=>Math.acosh(n)),dJ={kernelName:Df,backendName:"cpu",kernelFunc:hJ};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function fJ(n){const{inputs:t,backend:e}=n,s=t;Ft(t,"addN");const r=s.map(l=>e.data.get(l.dataId).values),i=ae(s[0].shape,s[0].dtype),o=i.values;for(let l=0;l<s.length;l++){const u=r[l];for(let h=0;h<o.length;h++)o[h]+=u[h]}return e.makeTensorInfo(i.shape,i.dtype,i.values)}const pJ={kernelName:vC,backendName:"cpu",kernelFunc:fJ};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function mJ(n){const{inputs:t,backend:e,attrs:s}=n,{x:r}=t,{axis:i,keepDims:o}=s;Ft(r,"all");const l=le(i,r.shape);let u=l;const h=hn(u,r.shape.length);let d=r;h!=null&&(d=Qs({inputs:{x:r},backend:e,attrs:{perm:h}}),u=Cn(u.length,r.shape.length)),hs("all",u,d.shape.length);const[p,m]=es(d.shape,u),y=yt(m),x=Ts(yt(p),d.dtype),v=e.data.get(d.dataId).values;for(let S=0;S<x.length;++S){const E=S*y;let _=v[E];for(let I=0;I<y;++I){const O=v[E+I];_=_&&O}x[S]=_}h!=null&&e.disposeIntermediateTensorInfo(d);const C=e.makeTensorInfo(p,d.dtype,x);if(o){const S=Nn(p,l),E=tn({inputs:{x:C},backend:e,attrs:{shape:S}});return e.disposeIntermediateTensorInfo(C),E}return C}const gJ={kernelName:wC,backendName:"cpu",kernelFunc:mJ};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function yJ(n){const{inputs:t,backend:e,attrs:s}=n,{x:r}=t,{axis:i,keepDims:o}=s;Ft(r,"any");const l=le(i,r.shape);let u=l;const h=hn(u,r.shape.length);let d=r;h!=null&&(d=Qs({inputs:{x:r},backend:e,attrs:{perm:h}}),u=Cn(u.length,r.shape.length)),hs("any",u,d.shape.length);const[p,m]=es(d.shape,u),y=yt(m),x=Ts(yt(p),d.dtype),v=e.data.get(d.dataId).values;for(let S=0;S<x.length;++S){const E=S*y;let _=v[E];for(let I=0;I<y;++I){const O=v[E+I];_=_||O}x[S]=_}h!=null&&e.disposeIntermediateTensorInfo(d);const C=e.makeTensorInfo(p,d.dtype,x);if(o){const S=Nn(p,l),E=tn({inputs:{x:C},backend:e,attrs:{shape:S}});return e.disposeIntermediateTensorInfo(C),E}return C}const xJ={kernelName:CC,backendName:"cpu",kernelFunc:yJ};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function bJ(n){const{inputs:t,backend:e,attrs:s}=n,{x:r}=t,{axis:i}=s;Ft(r,"argMax");let o=le(i,r.shape);const l=hn(o,r.shape.length);let u=r;const h=[];l!=null&&(u=Qs({inputs:{x:r},backend:e,attrs:{perm:l}}),h.push(u),o=Cn(o.length,u.shape.length)),o=[o[0]],hs("argMax",o,u.shape.length);const[d,p]=es(u.shape,o),m=yt(d),y=Ts(m,"int32"),x=yt(p),v=e.data.get(u.dataId).values;for(let C=0;C<y.length;++C){const S=C*x;let E=v[S],_=0;for(let I=0;I<x;++I){const O=v[S+I];O>E&&(E=O,_=I)}y[C]=_}return h.forEach(C=>e.disposeIntermediateTensorInfo(C)),e.makeTensorInfo(d,"int32",y)}const vJ={kernelName:m0,backendName:"cpu",kernelFunc:bJ};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function wJ(n){const{inputs:t,backend:e,attrs:s}=n,{x:r}=t,{axis:i}=s;Ft(r,"argMin");let o=le(i,r.shape);const l=hn(o,r.shape.length);let u=r;const h=[];l!=null&&(u=Qs({inputs:{x:r},backend:e,attrs:{perm:l}}),h.push(u),o=Cn(o.length,u.shape.length)),o=[o[0]],hs("argMin",o,u.shape.length);const[d,p]=es(u.shape,o),m=yt(d),y=Ts(m,"int32"),x=yt(p),v=e.data.get(u.dataId).values;for(let C=0;C<y.length;++C){const S=C*x;let E=v[S],_=0;for(let I=0;I<x;++I){const O=v[S+I];O<E&&(E=O,_=I)}y[C]=_}return h.forEach(C=>e.disposeIntermediateTensorInfo(C)),e.makeTensorInfo(d,"int32",y)}const CJ={kernelName:g0,backendName:"cpu",kernelFunc:wJ};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const SJ=Be(Of,n=>Math.asin(n)),TJ={kernelName:Of,backendName:"cpu",kernelFunc:SJ};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const EJ=Be(Mf,n=>Math.asinh(n)),IJ={kernelName:Mf,backendName:"cpu",kernelFunc:EJ};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const _J=Be(Ff,n=>Math.atan(n)),kJ={kernelName:Ff,backendName:"cpu",kernelFunc:_J};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const AJ=Tn((n,t)=>Math.atan2(n,t)),NJ=Un(Pf,AJ),RJ={kernelName:Pf,backendName:"cpu",kernelFunc:NJ};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const $J=Be(Lf,n=>Math.atanh(n)),DJ={kernelName:Lf,backendName:"cpu",kernelFunc:$J};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function zT(n,t,e,s,r,i){const o=r.strideHeight,l=r.strideWidth,u=r.dilationHeight,h=r.dilationWidth,d=r.effectiveFilterHeight,p=r.effectiveFilterWidth,m=r.padInfo.top,y=r.padInfo.left,x=i==="max"?Number.NEGATIVE_INFINITY:Number.POSITIVE_INFINITY,v=ae(r.outShape,e),C=v.values,S=r.outShape[1]*r.outShape[2]*r.outShape[3],E=r.outShape[2]*r.outShape[3],_=r.outShape[3];for(let I=0;I<r.batchSize;++I){const O=I*S,P=I*s[0];for(let D=0;D<r.inChannels;++D)for(let N=0;N<r.outHeight;++N){const R=N*o-m,$=Math.max(0,R),A=Math.min(r.inHeight,d+R),V=O+N*E;for(let L=0;L<r.outWidth;++L){const nt=L*l-y,Z=Math.max(0,nt),W=Math.min(r.inWidth,p+nt);let K=x,Y=0,at=0;for(let j=$;j<A;j+=u){const st=P+j*s[1];for(let tt=Z;tt<W;tt+=h){const xt=st+tt*s[2],vt=n[xt+D];i==="max"&&vt>K?K=vt:i==="avg"&&(Y+=vt,at++)}if(isNaN(K))break}const B=V+L*_+D;C[B]=i==="avg"?Y/at:K}}}return v}function uL(n,t,e,s,r=!1,i=!1){const o=ae(s.outShape,"int32"),l=s.strideHeight,u=s.strideWidth,h=s.dilationHeight,d=s.dilationWidth,p=s.effectiveFilterHeight,m=s.effectiveFilterWidth,y=s.padInfo.top,x=s.padInfo.left,v=ae(t,e,n);for(let C=0;C<s.batchSize;++C)for(let S=0;S<s.inChannels;++S)for(let E=0;E<s.outHeight;++E){const _=E*l-y;let I=_;for(;I<0;)I+=h;const O=Math.min(s.inHeight,p+_);for(let P=0;P<s.outWidth;++P){const D=P*u-x;let N=D;for(;N<0;)N+=d;const R=Math.min(s.inWidth,m+D);let $=Number.NEGATIVE_INFINITY,A=-1;for(let V=I;V<O;V+=h){const L=V-_;for(let nt=N;nt<R;nt+=d){const Z=nt-D,W=v.get(C,V,nt,S);W>$&&($=W,r?A=i?((C*s.inHeight+V)*s.inWidth+nt)*s.inChannels+S:(V*s.inWidth+nt)*s.inChannels+S:A=L*m+Z)}}o.set(A,C,E,P,S)}}return o}function cL(n,t,e,s,r,i){const o=r.strideDepth,l=r.strideHeight,u=r.strideWidth,h=r.dilationDepth,d=r.dilationHeight,p=r.dilationWidth,m=r.effectiveFilterDepth,y=r.effectiveFilterHeight,x=r.effectiveFilterWidth,v=r.padInfo.front,C=r.padInfo.top,S=r.padInfo.left,E=i==="max"?Number.NEGATIVE_INFINITY:Number.POSITIVE_INFINITY,_=ae(r.outShape,e),I=_.values,O=r.outShape[1]*r.outShape[2]*r.outShape[3]*r.outShape[4],P=r.outShape[2]*r.outShape[3]*r.outShape[4],D=r.outShape[3]*r.outShape[4],N=r.outShape[4];for(let R=0;R<r.batchSize;++R){const $=R*O,A=R*s[0];for(let V=0;V<r.inChannels;++V)for(let L=0;L<r.outDepth;++L){const nt=L*o-v;let Z=nt;for(;Z<0;)Z+=h;const W=Math.min(r.inDepth,m+nt),K=$+L*P;for(let Y=0;Y<r.outHeight;++Y){const at=Y*l-C;let B=at;for(;B<0;)B+=d;const j=Math.min(r.inHeight,y+at),st=K+Y*D;for(let tt=0;tt<r.outWidth;++tt){const xt=tt*u-S;let vt=xt;for(;vt<0;)vt+=p;const Ct=Math.min(r.inWidth,x+xt),$t=st+tt*N;let Rt=E,Lt=0,jt=0;for(let de=Z;de<W;de+=h){const be=A+de*s[1];for(let Me=B;Me<j;Me+=d){const Ne=be+Me*s[2];for(let Se=vt;Se<Ct;Se+=p){const me=Ne+Se*s[3],Ue=n[me+V];if(i==="max"&&Ue>Rt?Rt=Ue:i==="avg"&&(Lt+=Ue,jt++),isNaN(Rt))break}if(isNaN(Rt))break}if(isNaN(Rt))break}const Kt=$t+V;I[Kt]=i==="avg"?Lt/Math.max(jt,1):Rt}}}}return _}function OJ(n,t){const e=ae(t.outShape,"int32"),s=t.strideDepth,r=t.strideHeight,i=t.strideWidth,o=t.dilationDepth,l=t.dilationHeight,u=t.dilationWidth,h=t.effectiveFilterDepth,d=t.effectiveFilterHeight,p=t.effectiveFilterWidth,m=t.padInfo.front,y=t.padInfo.top,x=t.padInfo.left;for(let v=0;v<t.batchSize;++v)for(let C=0;C<t.inChannels;++C)for(let S=0;S<t.outDepth;++S){const E=S*s-m;let _=E;for(;_<0;)_+=o;const I=Math.min(t.inDepth,h+E);for(let O=0;O<t.outHeight;++O){const P=O*r-y;let D=P;for(;D<0;)D+=l;const N=Math.min(t.inHeight,d+P);for(let R=0;R<t.outWidth;++R){const $=R*i-x;let A=$;for(;A<0;)A+=u;const V=Math.min(t.inWidth,p+$);let L=Number.NEGATIVE_INFINITY,nt=-1;for(let Z=_;Z<I;Z+=o){const W=Z-E;for(let K=D;K<N;K+=l){const Y=K-P;for(let at=A;at<V;at+=u){const B=at-$,j=n.get(v,Z,K,at,C);j>=L&&(L=j,nt=W*d*p+Y*d+B)}}}e.set(nt,v,S,O,R,C)}}}return e}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function MJ(n){const{inputs:t,backend:e,attrs:s}=n,{x:r}=t;Ft(r,"avgPool");const{filterSize:i,strides:o,pad:l,dimRoundingMode:u}=s,h=1;U(Is(o,h),()=>`Error in avgPool: Either strides or dilations must be 1. Got strides ${o} and dilations '${h}'`);const d=Kr(r.shape,i,o,h,l,u);let p;if(d.filterWidth===1&&d.filterHeight===1&&Oe(d.inShape,d.outShape))p=to({inputs:{x:r},backend:e});else{const m=e.data.get(r.dataId).values,y=zt(r.shape),x=zT(m,r.shape,r.dtype,y,d,"avg");p=e.makeTensorInfo(d.outShape,r.dtype,x.values)}return p}const FJ={kernelName:y0,backendName:"cpu",kernelFunc:MJ};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function LJ(n){const{inputs:t,backend:e,attrs:s}=n,{x:r}=t,{filterSize:i,strides:o,pad:l,dimRoundingMode:u,dataFormat:h}=s;Ft(r,"avgPool3d");const d=qo(r.shape,i,o,1,l,u,h),p=e.data.get(r.dataId).values,m=cL(p,r.shape,r.dtype,zt(r.shape),d,"avg");return e.makeTensorInfo(m.shape,"float32",m.values)}const PJ={kernelName:x0,backendName:"cpu",kernelFunc:LJ};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function VJ(n){const{inputs:t,backend:e,attrs:s}=n,{dy:r,input:i}=t,{filterSize:o,strides:l,pad:u,dimRoundingMode:h}=s;Ft([r,i],"avgPool3DGrad");const d=qo(i.shape,o,l,1,u,h),p=d.strideDepth,m=d.strideHeight,y=d.strideWidth,x=d.filterDepth,v=d.filterHeight,C=d.filterWidth,S=d.dilationDepth,E=d.dilationHeight,_=d.dilationWidth,I=d.effectiveFilterDepth,O=d.effectiveFilterHeight,P=d.effectiveFilterWidth,D=I-1-d.padInfo.front,N=P-1-d.padInfo.left,R=O-1-d.padInfo.top,$=ae(i.shape,"float32"),A=1/(x*v*C),V=e.bufferSync(r);for(let L=0;L<d.batchSize;++L)for(let nt=0;nt<d.inChannels;++nt)for(let Z=0;Z<d.inDepth;++Z)for(let W=0;W<d.inHeight;++W)for(let K=0;K<d.inWidth;++K){const Y=Z-D,at=W-R,B=K-N;let j=0;for(let st=0;st<I;st+=S){const tt=(Y+st)/p;if(!(tt<0||tt>=d.outDepth||Math.floor(tt)!==tt))for(let xt=0;xt<O;xt+=E){const vt=(at+xt)/m;if(!(vt<0||vt>=d.outHeight||Math.floor(vt)!==vt))for(let Ct=0;Ct<P;Ct+=_){const $t=(B+Ct)/y;if($t<0||$t>=d.outWidth||Math.floor($t)!==$t)continue;const Rt=V.get(L,tt,vt,$t,nt);j+=Rt}}}$.set(j*A,L,Z,W,K,nt)}return e.makeTensorInfo($.shape,$.dtype,$.values)}const zJ={kernelName:TC,backendName:"cpu",kernelFunc:VJ};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function BJ(n){const{inputs:t,backend:e,attrs:s}=n,{dy:r,input:i}=t,o=i;Ft([r,i],"avgPoolGrad");const{filterSize:l,strides:u,pad:h}=s,d=Kr(o.shape,l,u,1,h),p=d.strideHeight,m=d.strideWidth,y=d.filterHeight,x=d.filterWidth,v=d.dilationHeight,C=d.dilationWidth,S=d.effectiveFilterHeight,E=d.effectiveFilterWidth,_=E-1-d.padInfo.left,I=S-1-d.padInfo.top,O=ae(o.shape,"float32"),P=1/(y*x),D=e.data.get(r.dataId).values,N=ae(r.shape,"float32",D);for(let R=0;R<d.batchSize;++R)for(let $=0;$<d.inChannels;++$)for(let A=0;A<d.inHeight;++A)for(let V=0;V<d.inWidth;++V){const L=A-I,nt=V-_;let Z=0;for(let W=0;W<S;W+=v){const K=(L+W)/p;if(!(K<0||K>=d.outHeight||Math.floor(K)!==K))for(let Y=0;Y<E;Y+=C){const at=(nt+Y)/m;if(at<0||at>=d.outWidth||Math.floor(at)!==at)continue;const B=N.get(R,K,at,$);Z+=B}}O.set(Z*P,R,A,V,$)}return e.makeTensorInfo(O.shape,O.dtype,O.values)}const UJ={kernelName:SC,backendName:"cpu",kernelFunc:BJ};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function GJ(n){const{inputs:t,backend:e,attrs:s}=n,{x:r,scale:i,offset:o,mean:l,variance:u}=t;U(l.shape.length===u.shape.length,()=>"Batch normalization gradient requires mean and variance to have equal ranks."),U(o==null||l.shape.length===o.shape.length,()=>"Batch normalization gradient requires mean and offset to have equal ranks."),U(i==null||l.shape.length===i.shape.length,()=>"Batch normalization gradient requires mean and scale to have equal ranks."),Ft([r,l,u,i,o],"batchNorm");let{varianceEpsilon:h}=s;h==null&&(h=.001);const d=e.data.get(r.dataId).values,p=e.data.get(l.dataId).values,m=e.data.get(u.dataId).values,y=i?e.data.get(i.dataId).values:new Float32Array([1]),x=o?e.data.get(o.dataId).values:new Float32Array([0]),v=new Float32Array(d.length),C=x.length,S=y.length,E=m.length,_=p.length;let I=0,O=0,P=0,D=0;for(let N=0;N<d.length;++N)v[N]=x[I++]+(d[N]-p[O++])*y[P++]/Math.sqrt(m[D++]+h),I>=C&&(I=0),O>=_&&(O=0),P>=S&&(P=0),D>=E&&(D=0);return e.makeTensorInfo(r.shape,r.dtype,v)}const WJ={kernelName:R0,backendName:"cpu",kernelFunc:GJ};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function HJ(n){const{inputs:t,backend:e,attrs:s}=n,{x:r}=t,{blockShape:i,crops:o}=s;Ft([r],"batchToSpaceND");const l=i.reduce((S,E)=>S*E),u=Op(r.shape,i,l),h=Mp(u.length,i.length),d=Fp(r.shape,i,l),p=YS(o,i.length),m=QS(d,o,i.length),y=tn({inputs:{x:r},backend:e,attrs:{shape:u}}),x=Qs({inputs:{x:y},backend:e,attrs:{perm:h}}),v=tn({inputs:{x},backend:e,attrs:{shape:d}}),C=fu({inputs:{x:v},backend:e,attrs:{begin:p,size:m}});return e.disposeIntermediateTensorInfo(y),e.disposeIntermediateTensorInfo(x),e.disposeIntermediateTensorInfo(v),C}const qJ={kernelName:v0,backendName:"cpu",kernelFunc:HJ};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function jJ(n){const{inputs:t,backend:e,attrs:s}=n,{x:r,weights:i}=t,{size:o}=s,l=e.data.get(r.dataId).values,u=e.data.get(i.dataId).values,h=MT(l,u,i.dtype,i.shape,o);return e.makeTensorInfo([o],i.dtype,h)}const KJ={kernelName:EC,backendName:"cpu",kernelFunc:jJ};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function XJ(n){const{inputs:t,backend:e}=n,{s0:s,s1:r}=t,i=e.data.get(s.dataId).values,o=e.data.get(r.dataId).values,l=ne(Array.from(i),Array.from(o));return e.makeTensorInfo([l.length],"int32",Int32Array.from(l))}const YJ={kernelName:F$,backendName:"cpu",kernelFunc:XJ};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const QJ=Be(Bf,(n,t)=>{const e=t;return n>e.clipValueMax?e.clipValueMax:n<e.clipValueMin?e.clipValueMin:n}),ZJ={kernelName:Bf,backendName:"cpu",kernelFunc:QJ};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const JJ=n=>{const{x:t}=n.inputs,e=n.backend,s=new Float32Array(yt(t.shape)),r=e.data.get(t.dataId),i=r.complexTensorInfos.real,o=r.complexTensorInfos.imag,l=e.data.get(i.dataId).values,u=e.data.get(o.dataId).values;for(let h=0;h<l.length;h++){const d=l[h],p=u[h];s[h]=Math.hypot(d,p)}return e.makeOutput(s,t.shape,"float32")},ttt={kernelName:w0,backendName:"cpu",kernelFunc:JJ};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Qc(n){const{inputs:t,backend:e}=n,{input:s}=t,r=e.data.get(s.dataId).complexTensorInfos.imag,i=e.data.get(r.dataId).values;return e.makeTensorInfo(r.shape,r.dtype,i)}const ett={kernelName:GC,backendName:"cpu",kernelFunc:Qc};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Zc(n){const{inputs:t,backend:e,attrs:s}=n,{axis:r}=s,i=le(r,t[0].shape)[0],o=t.map(v=>v.shape);jS(o,i);let l=Gi(t.map(v=>v.shape),i);if(yt(l)===0)return e.makeTensorInfo(l,t[0].dtype,[]);const u=t.filter(v=>yt(v.shape)>0);if(u.length===1)return to({inputs:{x:u[0]},backend:e});if(u[0].dtype==="complex64"){const v=u.map(I=>du({inputs:{input:I},backend:e})),C=u.map(I=>Qc({inputs:{input:I},backend:e})),S=Zc({inputs:v,backend:e,attrs:{axis:i}}),E=Zc({inputs:C,backend:e,attrs:{axis:i}}),_=or({inputs:{real:S,imag:E},backend:e});return v.forEach(I=>e.disposeIntermediateTensorInfo(I)),C.forEach(I=>e.disposeIntermediateTensorInfo(I)),e.disposeIntermediateTensorInfo(S),e.disposeIntermediateTensorInfo(E),_}const h=u.map(v=>{const S=[-1,yt(v.shape.slice(i))];return tn({inputs:{x:v},backend:e,attrs:{shape:S}})}),d=h.map(v=>({vals:e.data.get(v.dataId).values,shape:v.shape}));l=Gi(h.map(v=>v.shape),1);const p=h[0].shape[0]===1,m=mF(d,l,t[0].dtype,p),y=Gi(u.map(v=>v.shape),i),x=e.makeTensorInfo(y,t[0].dtype,m);return h.forEach(v=>e.disposeIntermediateTensorInfo(v)),x}const ntt={kernelName:C0,backendName:"cpu",kernelFunc:Zc};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function hL(n){const{inputs:t,backend:e,attrs:s}=n,{x:r,filter:i}=t,{strides:o,pad:l,dataFormat:u,dilations:h,dimRoundingMode:d}=s;Ft([r,i],"conv2d");const p=jo(u),m=cs(r.shape,i.shape,o,h,l,d,!1,p),y=m.filterHeight,x=m.filterWidth,v=m.dilationHeight,C=m.dilationWidth,S=m.padInfo.left,E=m.padInfo.top,_=m.dataFormat==="channelsLast",I=new us(m.outShape,r.dtype),O=zt(r.shape),P=zt(i.shape),D=O[0],N=_?O[1]:O[2],R=_?O[2]:1,$=_?1:O[1],A=I.strides[0],V=_?I.strides[1]:I.strides[2],L=_?I.strides[2]:1,nt=_?1:I.strides[1],Z=e.data.get(r.dataId).values,W=e.data.get(i.dataId).values,K=I.values;for(let Y=0;Y<m.batchSize;++Y){const at=Y*D,B=Y*A;for(let j=0;j<m.outHeight;++j){const st=B+j*V,tt=j*m.strideHeight-E;for(let xt=0;xt<y;++xt){const vt=tt+xt*v;if(vt<0||vt>=m.inHeight)continue;const Ct=xt*P[0],$t=at+vt*N;for(let Rt=0;Rt<m.outWidth;++Rt){const Lt=st+Rt*L,jt=Rt*m.strideWidth-S;for(let Kt=0;Kt<x;++Kt){const de=jt+Kt*C;if(de<0||de>=m.inWidth)continue;const be=Ct+Kt*P[1],Me=$t+de*R;let Ne=be;for(let Se=0;Se<m.inChannels;++Se){const me=Z[Me+Se*$];for(let Ue=0;Ue<m.outChannels;++Ue)K[Lt+Ue*nt]+=me*W[Ne+Ue];Ne+=m.outChannels}}}}}}return e.makeTensorInfo(I.shape,I.dtype,K)}const stt={kernelName:S0,backendName:"cpu",kernelFunc:hL};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function rtt(n){const{inputs:t,backend:e,attrs:s}=n,{x:r,dy:i}=t,{strides:o,pad:l,dataFormat:u,dimRoundingMode:h,filterShape:d}=s;Ft([r,i],"conv2dBackpropFilter");const p=jo(u),m=cs(r.shape,d,o,1,l,h,!1,p),{strideHeight:y,strideWidth:x,filterHeight:v,filterWidth:C}=m,S=m.dataFormat==="channelsLast",E=new us(m.filterShape,"float32"),_=m.padInfo.left,I=m.padInfo.top,O=e.data.get(r.dataId).values,P=e.data.get(i.dataId).values,D=new us(r.shape,r.dtype,O),N=new us(i.shape,i.dtype,P);for(let R=0;R<v;++R){const $=Math.max(0,Math.ceil((I-R)/y)),A=Math.min(m.outHeight,(m.inHeight+I-R)/y);for(let V=0;V<C;++V){const L=Math.max(0,Math.ceil((_-V)/x)),nt=Math.min(m.outWidth,(m.inWidth+_-V)/x);for(let Z=0;Z<m.inChannels;++Z)for(let W=0;W<m.outChannels;++W){let K=0;for(let Y=0;Y<m.batchSize;++Y)for(let at=$;at<A;++at){const B=R+at*y-I;for(let j=L;j<nt;++j){const st=V+j*x-_;S?K+=D.get(Y,B,st,Z)*N.get(Y,at,j,W):K+=D.get(Y,Z,B,st)*N.get(Y,W,at,j)}}E.set(K,R,V,Z,W)}}}return e.makeTensorInfo(E.shape,E.dtype,E.values)}const itt={kernelName:kC,backendName:"cpu",kernelFunc:rtt};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function ott(n){const{inputs:t,backend:e,attrs:s}=n,{dy:r,filter:i}=t,{inputShape:o,strides:l,pad:u,dataFormat:h,dimRoundingMode:d}=s;Ft([r,i],"conv2dBackpropInput");const p=zt(i.shape),m=zt(r.shape);let y=jo(h);const x=cs(o,i.shape,l,1,u,d,!1,y),v=new us(x.inShape,"float32"),C=v.values,S=e.data.get(r.dataId).values,E=e.data.get(i.dataId).values,[_,I,O]=p,{batchSize:P,filterHeight:D,filterWidth:N,inChannels:R,inHeight:$,inWidth:A,outChannels:V,outHeight:L,outWidth:nt,strideHeight:Z,strideWidth:W}=x;y=x.dataFormat;const K=D-1-x.padInfo.top,Y=N-1-x.padInfo.left,at=y==="channelsLast",B=v.strides[0],j=at?v.strides[1]:v.strides[2],st=at?v.strides[2]:1,tt=at?1:v.strides[1],xt=m[0],vt=at?m[1]:m[2],Ct=at?m[2]:1,$t=at?1:m[1];for(let Rt=0;Rt<P;++Rt)for(let Lt=0;Lt<R;++Lt)for(let jt=0;jt<$;++jt){const Kt=jt-K,de=Math.max(0,Math.ceil(Kt/Z)),be=Math.min(L,(D+Kt)/Z);for(let Me=0;Me<A;++Me){const Ne=Me-Y,Se=Math.max(0,Math.ceil(Ne/W)),me=Math.min(nt,(N+Ne)/W);let Ue=0;for(let sn=de;sn<be;++sn){const As=sn*Z-Kt;for(let fs=Se;fs<me;++fs){const Js=fs*W-Ne,ps=xt*Rt+vt*sn+Ct*fs,tr=_*(D-1-As)+I*(N-1-Js)+O*Lt;for(let Fe=0;Fe<V;++Fe){const fe=S[ps+$t*Fe],mn=E[tr+Fe];Ue+=fe*mn}}}const Bs=B*Rt+j*jt+st*Me+tt*Lt;C[Bs]=Ue}}return e.makeTensorInfo(v.shape,v.dtype,v.values)}const att={kernelName:T0,backendName:"cpu",kernelFunc:ott};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function ltt(n){const{inputs:t,backend:e,attrs:s}=n,{x:r,filter:i}=t,{strides:o,pad:l,dilations:u}=s;Ft([r,i],"conv3d");const h=Ja(r.shape,i.shape,o,u,l),{filterDepth:d,filterHeight:p,filterWidth:m,dilationDepth:y,dilationHeight:x,dilationWidth:v,padInfo:C}=h,S=C.front,E=C.left,_=C.top,I=new us(h.outShape,r.dtype),O=e.data.get(r.dataId).values,P=e.data.get(i.dataId).values,D=I.values,N=zt(r.shape),R=zt(i.shape);for(let $=0;$<h.batchSize;++$){const A=$*N[0],V=$*I.strides[0];for(let L=0;L<h.outDepth;++L){const nt=V+L*I.strides[1],Z=L*h.strideDepth-S;for(let W=0;W<d;++W){const K=Z+W*y;if(K<0||K>=h.inDepth)continue;const Y=W*R[0],at=A+K*N[1];for(let B=0;B<h.outHeight;++B){const j=nt+B*I.strides[2],st=B*h.strideHeight-_;for(let tt=0;tt<p;++tt){const xt=st+tt*x;if(xt<0||xt>=h.inHeight)continue;const vt=Y+tt*R[1],Ct=at+xt*N[2];for(let $t=0;$t<h.outWidth;++$t){const Rt=j+$t*h.outChannels,Lt=$t*h.strideWidth-E;for(let jt=0;jt<m;++jt){const Kt=Lt+jt*v;if(Kt<0||Kt>=h.inWidth)continue;const de=vt+jt*R[2],be=Ct+Kt*h.inChannels;let Me=de;for(let Ne=0;Ne<h.inChannels;++Ne){const Se=O[be+Ne];for(let me=0;me<h.outChannels;++me)D[Rt+me]+=Se*P[Me+me];Me+=h.outChannels}}}}}}}}return e.makeTensorInfo(I.shape,I.dtype,I.values)}const utt={kernelName:E0,backendName:"cpu",kernelFunc:ltt};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function ctt(n){const{inputs:t,backend:e,attrs:s}=n,{x:r,dy:i}=t,{strides:o,pad:l,filterShape:u}=s;Ft([r,i],"conv3dBackpropFilterV2");const h=zt(r.shape),d=zt(i.shape),p=Ja(r.shape,u,o,1,l),m=p.strideDepth,y=p.strideHeight,x=p.strideWidth,v=p.filterDepth,C=p.filterHeight,S=p.filterWidth,E=new us(p.filterShape,"float32"),_=E.values,[I,O,P,D]=E.strides,N=e.data.get(i.dataId).values,[R,$,A,V]=d,L=e.data.get(r.dataId).values,[nt,Z,W,K]=h,Y=p.padInfo.front,at=p.padInfo.left,B=p.padInfo.top;for(let j=0;j<v;++j){const st=Math.max(0,Math.ceil((Y-j)/m)),tt=Math.min(p.outDepth,(p.inDepth+Y-j)/m),xt=j*I;for(let vt=0;vt<C;++vt){const Ct=Math.max(0,Math.ceil((B-vt)/y)),$t=Math.min(p.outHeight,(p.inHeight+B-vt)/y),Rt=vt*O+xt;for(let Lt=0;Lt<S;++Lt){const jt=Math.max(0,Math.ceil((at-Lt)/x)),Kt=Math.min(p.outWidth,(p.inWidth+at-Lt)/x),de=Lt*P+Rt;for(let be=0;be<p.inChannels;++be){const Me=be*D+de;for(let Ne=0;Ne<p.outChannels;++Ne){let Se=0;for(let me=0;me<p.batchSize;++me){const Ue=me*nt,Bs=me*R;for(let sn=st;sn<tt;++sn){const fs=(j+sn*m-Y)*Z+Ue,Js=sn*$+Bs;for(let ps=Ct;ps<$t;++ps){const Fe=(vt+ps*y-B)*W+fs,fe=ps*A+Js;for(let mn=jt;mn<Kt;++mn){const Xo=(Lt+mn*x-at)*K+Fe,al=mn*V+fe;Se+=L[Xo+be]*N[al+Ne]}}}}_[Me+Ne]=Se}}}}}return e.makeTensorInfo(E.shape,E.dtype,E.values)}const htt={kernelName:AC,backendName:"cpu",kernelFunc:ctt};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function dtt(n){const{inputs:t,backend:e,attrs:s}=n,{dy:r,filter:i}=t,{pad:o,strides:l,inputShape:u}=s;Ft([r],"conv3dBackpropInputV2");const h=zt(r.shape),d=zt(i.shape),p=Ja(u,i.shape,l,1,o),m=new us(p.inShape,"float32"),y=m.values,[x,v,C,S]=m.strides,E=e.data.get(r.dataId).values,[_,I,O,P]=h,D=e.data.get(i.dataId).values,[N,R,$,A]=d,{batchSize:V,filterDepth:L,filterHeight:nt,filterWidth:Z,inChannels:W,inDepth:K,inHeight:Y,inWidth:at,outChannels:B,outDepth:j,outHeight:st,outWidth:tt,strideDepth:xt,strideHeight:vt,strideWidth:Ct}=p,$t=L-1-p.padInfo.front,Rt=nt-1-p.padInfo.top,Lt=Z-1-p.padInfo.left;for(let jt=0;jt<V;++jt)for(let Kt=0;Kt<W;++Kt)for(let de=0;de<K;++de){const be=de-$t,Me=Math.max(0,Math.ceil(be/xt)),Ne=Math.min(j,(L+be)/xt);for(let Se=0;Se<Y;++Se){const me=Se-Rt,Ue=Math.max(0,Math.ceil(me/vt)),Bs=Math.min(st,(nt+me)/vt);for(let sn=0;sn<at;++sn){const As=sn-Lt,fs=Math.max(0,Math.ceil(As/Ct)),Js=Math.min(tt,(Z+As)/Ct);let ps=0;for(let tr=Me;tr<Ne;++tr){const Fe=tr*xt-be;for(let fe=Ue;fe<Bs;++fe){const mn=fe*vt-me;for(let gn=fs;gn<Js;++gn){const Xo=gn*Ct-As,al=_*jt+I*tr+O*fe+P*gn,so=N*(L-1-Fe)+R*(nt-1-mn)+$*(Z-1-Xo)+A*Kt;for(let Ir=0;Ir<B;++Ir){const ro=E[al+Ir],hr=D[so+Ir];ps+=ro*hr}}}}y[x*jt+v*de+C*Se+S*sn+Kt]=ps}}}return e.makeTensorInfo(m.shape,m.dtype,m.values)}const ftt={kernelName:NC,backendName:"cpu",kernelFunc:dtt};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const ptt=Be(Uf,n=>Math.cos(n)),mtt={kernelName:Uf,backendName:"cpu",kernelFunc:ptt};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const gtt=Be(Gf,n=>Math.cosh(n)),ytt={kernelName:Gf,backendName:"cpu",kernelFunc:gtt};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function xtt(n){const{inputs:t,backend:e,attrs:s}=n,{image:r,boxes:i,boxInd:o}=t,{cropSize:l,method:u,extrapolationValue:h}=s,[d,p,m,y]=r.shape,x=i.shape[0],[v,C]=l,S=ae([x,v,C,y],"float32"),E=e.data.get(i.dataId).values,_=e.data.get(o.dataId).values,I=e.data.get(r.dataId).values,O=zt(r.shape),P=zt(S.shape);for(let D=0;D<x;D++){const N=D*4,R=E[N],$=E[N+1],A=E[N+2],V=E[N+3],L=_[D];if(L>=d)continue;const nt=v>1?(A-R)*(p-1)/(v-1):0,Z=C>1?(V-$)*(m-1)/(C-1):0;for(let W=0;W<v;W++){const K=v>1?R*(p-1)+W*nt:.5*(R+A)*(p-1);if(K<0||K>p-1){for(let Y=0;Y<C;Y++)for(let at=0;at<y;at++){const B=at+Y*P[2]+W*P[1]+D*P[0];S.values[B]=h}continue}if(u==="bilinear"){const Y=Math.floor(K),at=Math.ceil(K),B=K-Y;for(let j=0;j<C;j++){const st=C>1?$*(m-1)+j*Z:.5*($+V)*(m-1);if(st<0||st>m-1){for(let Ct=0;Ct<y;Ct++){const $t=Ct+j*P[2]+W*P[1]+D*P[0];S.values[$t]=h}continue}const tt=Math.floor(st),xt=Math.ceil(st),vt=st-tt;for(let Ct=0;Ct<y;Ct++){let $t=Ct+tt*O[2]+Y*O[1]+L*O[0];const Rt=I[$t];$t=Ct+xt*O[2]+Y*O[1]+L*O[0];const Lt=I[$t];$t=Ct+tt*O[2]+at*O[1]+L*O[0];const jt=I[$t];$t=Ct+xt*O[2]+at*O[1]+L*O[0];const Kt=I[$t],de=Rt+(Lt-Rt)*vt,be=jt+(Kt-jt)*vt;$t=Ct+j*P[2]+W*P[1]+D*P[0],S.values[$t]=de+(be-de)*B}}}else for(let Y=0;Y<C;++Y){const at=C>1?$*(m-1)+Y*Z:.5*($+V)*(m-1);if(at<0||at>m-1){for(let st=0;st<y;st++){const tt=st+Y*P[2]+W*P[1]+D*P[0];S.values[tt]=h}continue}const B=Math.round(at),j=Math.round(K);for(let st=0;st<y;st++){const tt=st+B*O[2]+j*O[1]+L*O[0],xt=st+Y*P[2]+W*P[1]+D*P[0];S.values[xt]=I[tt]}}}}return e.makeTensorInfo(S.shape,S.dtype,S.values)}const btt={kernelName:$C,backendName:"cpu",kernelFunc:xtt};/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function vtt(n){const{inputs:t,backend:e,attrs:s}=n,{x:r}=t,{axis:i,exclusive:o,reverse:l}=s;Ft(r,"cumprod");const u=hn([i],r.shape.length);let h=r;u!=null&&(h=Qs({inputs:{x:r},backend:e,attrs:{perm:u}}));const d=Cn(1,r.shape.length)[0];if(d!==h.shape.length-1)throw new Error(`backend.cumprod in CPU expects an inner-most axis=${h.shape.length-1} but got axis=${d}`);const p=lr(h.dtype,"int32"),m=yC(yt(h.shape),p),y=e.data.get(h.dataId).values,x=h.shape[h.shape.length-1],v=l?(S,E)=>S+x-E-1:(S,E)=>S+E;for(let S=0;S<y.length;S+=x)for(let E=0;E<x;E++){const _=v(S,E);if(E===0)m[_]=o?1:y[_];else{const I=v(S,E-1);m[_]=o?y[I]*m[I]:y[_]*m[I]}}const C=e.makeTensorInfo(h.shape,p,m);if(u!=null){const S=tl(u),E=Qs({inputs:{x:C},backend:e,attrs:{perm:S}});return e.disposeIntermediateTensorInfo(C),e.disposeIntermediateTensorInfo(h),E}return C}const wtt={kernelName:RC,backendName:"cpu",kernelFunc:vtt};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Ctt(n){const{inputs:t,backend:e,attrs:s}=n,{x:r}=t,{axis:i,exclusive:o,reverse:l}=s;Ft(r,"cumsum");const u=hn([i],r.shape.length);let h=r;u!=null&&(h=Qs({inputs:{x:r},backend:e,attrs:{perm:u}}));const d=Cn(1,r.shape.length)[0];if(d!==h.shape.length-1)throw new Error(`backend.cumsum in CPU expects an inner-most axis=${h.shape.length-1} but got axis=${d}`);const p=lr(h.dtype,"int32"),m=Ts(yt(h.shape),p),y=e.data.get(h.dataId).values,x=h.shape[h.shape.length-1],v=l?(S,E)=>S+x-E-1:(S,E)=>S+E;for(let S=0;S<y.length;S+=x)for(let E=0;E<x;E++){const _=v(S,E);if(E===0)m[_]=o?0:y[_];else{const I=v(S,E-1);m[_]=o?y[I]+m[I]:y[_]+m[I]}}const C=e.makeTensorInfo(h.shape,p,m);if(u!=null){const S=tl(u),E=Qs({inputs:{x:C},backend:e,attrs:{perm:S}});return e.disposeIntermediateTensorInfo(C),e.disposeIntermediateTensorInfo(h),E}return C}const Stt={kernelName:I0,backendName:"cpu",kernelFunc:Ctt};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Ttt(n){const{inputs:t,backend:e,attrs:s}=n,{x:r,weights:i}=t,{size:o,binaryOutput:l}=s;if(r.shape.length===1){const u=e.data.get(r.dataId).values,h=e.data.get(i.dataId).values,d=MT(u,h,i.dtype,i.shape,o);return e.makeTensorInfo([o],i.dtype,d)}else if(r.shape.length===2){const u=e.bufferSync(r),h=e.bufferSync(i),d=dF(u,h,o,l);return e.makeTensorInfo(d.shape,i.dtype,d.values)}throw new Error(`Error in denseBincount: input must be at most rank 2, but got rank${r.shape.length}.`)}const Ett={kernelName:DC,backendName:"cpu",kernelFunc:Ttt};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Itt(n){const{inputs:t,backend:e,attrs:s}=n,{x:r}=t,{blockSize:i,dataFormat:o}=s;U(o==="NHWC",()=>`Only NHWC dataFormat supported on CPU for depthToSpace. Got ${o}`);const l=r.shape[0],u=r.shape[1],h=r.shape[2],d=r.shape[3],p=u*i,m=h*i,y=d/(i*i),x=e.data.get(r.dataId).values,v=new Float32Array(l*p*m*y);let C=0;for(let S=0;S<l;++S)for(let E=0;E<p;++E){const _=Math.floor(E/i),I=E%i;for(let O=0;O<m;++O){const P=Math.floor(O/i),D=O%i,N=(I*i+D)*y;for(let R=0;R<y;++R){const A=R+N+d*(P+h*(_+u*S));v[C++]=x[A]}}}return e.makeTensorInfo([l,p,m,y],r.dtype,v)}const _tt={kernelName:OC,backendName:"cpu",kernelFunc:Itt};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function dL(n){const{inputs:t,backend:e,attrs:s}=n,{x:r,filter:i}=t,{strides:o,pad:l,dilations:u,dimRoundingMode:h}=s;Ft([r,i],"depthwiseConv2DNative");const d=zt(r.shape),p=zt(i.shape);let m=u;m==null&&(m=[1,1]),U(Is(o,m),()=>`Error in depthwiseConv2d: Either strides or dilations must be 1. Got strides ${o} and dilations '${m}'`);const y=cs(r.shape,i.shape,o,m,l,h,!0),{filterHeight:x,filterWidth:v,dilationHeight:C,dilationWidth:S,padInfo:E}=y,_=E.left,I=E.top,O=y.outChannels/y.inChannels,P=new us(y.outShape,r.dtype),D=e.data.get(r.dataId).values,N=e.data.get(i.dataId).values,R=P.values;for(let $=0;$<y.batchSize;++$){const A=$*d[0],V=$*P.strides[0];for(let L=0;L<y.outHeight;++L){const nt=V+L*P.strides[1],Z=L*y.strideHeight-I;for(let W=0;W<x;++W){const K=Z+W*C;if(K<0||K>=y.inHeight)continue;const Y=W*p[0],at=A+K*d[1];for(let B=0;B<y.outWidth;++B){const j=nt+B*P.strides[2],st=B*y.strideWidth-_;for(let tt=0;tt<v;++tt){const xt=st+tt*S;if(xt<0||xt>=y.inWidth)continue;const vt=Y+tt*p[1],Ct=at+xt*y.inChannels;let $t=j,Rt=vt;for(let Lt=0;Lt<y.inChannels;++Lt){const jt=D[Ct+Lt];for(let Kt=0;Kt<O;++Kt)R[$t+Kt]+=jt*N[Rt+Kt];$t+=O,Rt+=O}}}}}}return e.makeTensorInfo(P.shape,P.dtype,P.values)}const ktt={kernelName:_0,backendName:"cpu",kernelFunc:dL};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Att(n){const{inputs:t,backend:e,attrs:s}=n,{x:r,dy:i}=t,{strides:o,dilations:l,pad:u,dimRoundingMode:h,filterShape:d}=s;Ft([r,i],"depthwiseConv2dNativeBackpropFilter");const p=cs(r.shape,d,o,l,u,h,!0),{strideHeight:m,strideWidth:y,filterHeight:x,filterWidth:v}=p,C=new us(p.filterShape,"float32"),S=p.padInfo.left,E=p.padInfo.top,_=p.outChannels/p.inChannels,I=e.data.get(r.dataId).values,O=new us(r.shape,r.dtype,I),P=e.data.get(i.dataId).values,D=new us(i.shape,i.dtype,P);for(let N=0;N<x;++N){const R=Math.max(0,Math.ceil((E-N)/m)),$=Math.min(p.outHeight,(p.inHeight+E-N)/m);for(let A=0;A<v;++A){const V=Math.max(0,Math.ceil((S-A)/y)),L=Math.min(p.outWidth,(p.inWidth+S-A)/y);for(let nt=0;nt<p.outChannels;++nt){const Z=Math.trunc(nt/_),W=nt%_;let K=0;for(let Y=0;Y<p.batchSize;++Y)for(let at=R;at<$;++at){const B=N+at*m-E;for(let j=V;j<L;++j){const st=A+j*y-S;K+=O.get(Y,B,st,Z)*D.get(Y,at,j,nt)}}C.set(K,N,A,Z,W)}}}return e.makeTensorInfo(C.shape,C.dtype,C.values)}const Ntt={kernelName:MC,backendName:"cpu",kernelFunc:Att};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Rtt(n){const{inputs:t,backend:e,attrs:s}=n,{dy:r,filter:i}=t,{strides:o,dilations:l,pad:u,dimRoundingMode:h,inputShape:d}=s;Ft([r,i],"depthwiseConv2DNativeBackpropInput");const p=zt(r.shape),m=zt(i.shape),y=cs(d,i.shape,o,l,u,h,!0),x=new us(y.inShape,"float32"),v=x.values,[C,S,E]=x.strides,_=e.data.get(r.dataId).values,[I,O,P]=p,D=e.data.get(i.dataId).values,[N,R,$]=m,{batchSize:A,filterHeight:V,filterWidth:L,inChannels:nt,inHeight:Z,inWidth:W,outChannels:K,outHeight:Y,outWidth:at,strideHeight:B,strideWidth:j}=y,st=V-1-y.padInfo.top,tt=L-1-y.padInfo.left,xt=K/nt;for(let vt=0;vt<A;++vt)for(let Ct=0;Ct<nt;++Ct)for(let $t=0;$t<Z;++$t){const Rt=$t-st,Lt=Math.max(0,Math.ceil(Rt/B)),jt=Math.min(Y,(V+Rt)/B);for(let Kt=0;Kt<W;++Kt){const de=Kt-tt,be=Math.max(0,Math.ceil(de/j)),Me=Math.min(at,(L+de)/j);let Ne=0;for(let Se=Lt;Se<jt;++Se){const me=Se*B-Rt;for(let Ue=be;Ue<Me;++Ue){const Bs=Ue*j-de,sn=I*vt+O*Se+P*Ue,As=N*(V-1-me)+R*(L-1-Bs)+$*Ct;for(let fs=0;fs<xt;++fs){const Js=Ct*xt+fs,ps=_[sn+Js],tr=D[As+fs];Ne+=ps*tr}}}v[C*vt+S*$t+E*Kt+Ct]=Ne}}return e.makeTensorInfo(x.shape,x.dtype,x.values)}const $tt={kernelName:FC,backendName:"cpu",kernelFunc:Rtt};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Dtt(n){const{inputs:t,backend:e}=n,{x:s}=t,r=yt(s.shape),i=e.data.get(s.dataId).values,o=ae([r,r],s.dtype),l=o.values;for(let h=0;h<i.length;h++)l[h*r+h]=i[h];const u=[...s.shape,...s.shape];return e.makeTensorInfo(u,o.dtype,o.values)}const Ott={kernelName:L$,backendName:"cpu",kernelFunc:Dtt};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Mtt={kernelName:k0,backendName:"cpu",kernelFunc:({inputs:n,backend:t,attrs:e})=>{const{x:s,filter:r}=n,{strides:i,pad:o,dilations:l}=e,u=t,h=u.data.get(s.dataId).values,d=s.shape.length,p=u.data.get(r.dataId).values,m=r.shape.length,{batchSize:y,inHeight:x,inWidth:v,inChannels:C,outHeight:S,outWidth:E,padInfo:_,strideHeight:I,strideWidth:O,filterHeight:P,filterWidth:D,dilationHeight:N,dilationWidth:R,outShape:$}=Ap(s.shape,r.shape,i,o,"NHWC",l),A=yt($),V=$.length,L=bn(s.dtype,A);for(let Z=0;Z<y;++Z)for(let W=0;W<S;++W){const K=W*I-_.top;for(let Y=0;Y<E;++Y){const at=Y*O-_.left;for(let B=0;B<C;++B){let j=Number.MIN_SAFE_INTEGER;for(let tt=0;tt<P;++tt){const xt=K+tt*N;if(xt>=0&&xt<x)for(let vt=0;vt<D;++vt){const Ct=at+vt*R;if(Ct>=0&&Ct<v){const $t=Bi([Z,xt,Ct,B],d,zt(s.shape)),Rt=Bi([tt,vt,B],m,zt(r.shape)),Lt=h[$t]+p[Rt];Lt>j&&(j=Lt)}}}const st=Bi([Z,W,Y,B],V,zt($));L[st]=j}}}return{dataId:u.write(vu(L,s.dtype),$,s.dtype),shape:$,dtype:s.dtype}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Ftt={kernelName:Qv,backendName:"cpu",kernelFunc:({inputs:n,backend:t,attrs:e})=>{const{x:s,filter:r,dy:i}=n,{strides:o,pad:l,dilations:u}=e,h=t,d=ui(s.shape,h.data.get(s.dataId).values),p=ui(r.shape,h.data.get(r.dataId).values),{batchSize:m,inHeight:y,inWidth:x,inChannels:v,outHeight:C,outWidth:S,padInfo:E,strideHeight:_,strideWidth:I,filterHeight:O,filterWidth:P,dilationHeight:D,dilationWidth:N,outShape:R}=Ap(s.shape,r.shape,o,l,"NHWC",u);U(i.rank===R.length,()=>`Error in ${Qv}, dy must have the same rank as output ${R.length}, but got ${i.rank}`);const $=ui(R,h.data.get(i.dataId).values),A=D$(r.shape,r.dtype);for(let L=0;L<m;++L)for(let nt=0;nt<C;++nt){const Z=nt*_-E.top;for(let W=0;W<S;++W){const K=W*I-E.left;for(let Y=0;Y<v;++Y){let at=Number.MIN_SAFE_INTEGER,B=0,j=0;for(let st=0;st<O;++st){const tt=Z+st*D;if(tt>=0&&tt<y)for(let xt=0;xt<P;++xt){const vt=K+xt*N;if(vt>=0&&vt<x){const Ct=d[L][tt][vt][Y]+p[st][xt][Y];Ct>at&&(at=Ct,B=st,j=xt)}}}A[B][j][Y]+=$[L][nt][W][Y]}}}return{dataId:h.write(vu(A,s.dtype),r.shape,r.dtype),shape:r.shape,dtype:r.dtype}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Ltt={kernelName:Yv,backendName:"cpu",kernelFunc:({inputs:n,backend:t,attrs:e})=>{const{x:s,filter:r,dy:i}=n,{strides:o,pad:l,dilations:u}=e,h=t,d=ui(s.shape,h.data.get(s.dataId).values),p=ui(r.shape,h.data.get(r.dataId).values),{batchSize:m,inHeight:y,inWidth:x,inChannels:v,outHeight:C,outWidth:S,padInfo:E,strideHeight:_,strideWidth:I,filterHeight:O,filterWidth:P,dilationHeight:D,dilationWidth:N,outShape:R}=Ap(s.shape,r.shape,o,l,"NHWC",u);U(i.rank===R.length,()=>`Error in ${Yv}, dy must have the same rank as output ${R.length}, but got ${i.rank}`);const $=ui(R,h.data.get(i.dataId).values),A=D$(s.shape,s.dtype);for(let L=0;L<m;++L)for(let nt=0;nt<C;++nt){const Z=nt*_-E.top;for(let W=0;W<S;++W){const K=W*I-E.left;for(let Y=0;Y<v;++Y){let at=Number.MIN_SAFE_INTEGER,B=Z<0?0:Z,j=K<0?0:K;for(let st=0;st<O;++st){const tt=Z+st*D;if(tt>=0&&tt<y)for(let xt=0;xt<P;++xt){const vt=K+xt*N;if(vt>=0&&vt<x){const Ct=d[L][tt][vt][Y]+p[st][xt][Y];Ct>at&&(at=Ct,B=tt,j=vt)}}}A[L][B][j][Y]+=$[L][nt][W][Y]}}}return{dataId:h.write(vu(A,s.dtype),s.shape,s.dtype),shape:s.shape,dtype:s.dtype}}};/**
 * @license
 * Copyright 2023 Google LLC.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Ptt(n){const{inputs:t,backend:e,attrs:s}=n,{image:r}=t,{canvas:i,options:o}=s,{contextOptions:l,imageOptions:u}=o||{},h=(u==null?void 0:u.alpha)||1,d=(l==null?void 0:l.contextType)||"2d";if(d!=="2d")throw new Error(`Context type ${l.contextType} is not supported by the CPU backend.`);const p=i.getContext(d,(l==null?void 0:l.contextAttributes)||{});if(p==null)throw new Error(`Could not get the context with ${d} type.`);const[m,y]=r.shape.slice(0,2),x=r.shape.length===2?1:r.shape[2],v=e.data.get(r.dataId).values,C=r.dtype==="float32"?255:1,S=new Uint8ClampedArray(y*m*4);for(let _=0;_<m*y;++_){const I=[0,0,0,255*h];for(let P=0;P<x;P++){const D=v[_*x+P];if(r.dtype==="float32"){if(D<0||D>1)throw new Error(`Tensor values for a float32 Tensor must be in the range [0 - 1] but encountered ${D}.`)}else if(r.dtype==="int32"&&(D<0||D>255))throw new Error(`Tensor values for a int32 Tensor must be in the range [0 - 255] but encountered ${D}.`);x===1?(I[0]=D*C,I[1]=D*C,I[2]=D*C):I[P]=D*C}const O=_*4;S[O+0]=Math.round(I[0]),S[O+1]=Math.round(I[1]),S[O+2]=Math.round(I[2]),S[O+3]=Math.round(I[3])}i.width=y,i.height=m;const E=new ImageData(S,y,m);return p.putImageData(E,0,0),r}const Vtt={kernelName:YW,backendName:"cpu",kernelFunc:Ptt};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Hp(n){const{inputs:t,backend:e,attrs:s}=n,{x:r}=t,{axis:i,keepDims:o}=s;Ft(r,"sum");let l;r.dtype==="bool"?l=Xa({inputs:{x:r},backend:e,attrs:{dtype:"int32"}}):l=to({inputs:{x:r},backend:e});const u=l.shape.length,h=le(i,l.shape),d=hn(h,u);let p=h,m=l;d!=null&&(m=Qs({inputs:{x:l},backend:e,attrs:{perm:d}}),p=Cn(p.length,u)),hs("sum",p,m.shape.length);const[y,x]=es(m.shape,p),v=lr(m.dtype,"int32");let C=By(e,y,v);const S=yt(x),E=e.data.get(C.dataId).values,_=e.data.get(m.dataId).values;for(let I=0;I<E.length;++I){const O=I*S;let P=0;for(let D=0;D<S;++D)P+=_[O+D];E[I]=P}if(o){const I=Nn(C.shape,h),O=C;C=tn({inputs:{x:C},backend:e,attrs:{shape:I}}),e.disposeIntermediateTensorInfo(O)}return e.disposeIntermediateTensorInfo(l),d!=null&&e.disposeIntermediateTensorInfo(m),C}const ztt={kernelName:ax,backendName:"cpu",kernelFunc:Hp};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Btt(n){const{inputs:t,backend:e,attrs:s}=n,{equation:r}=s,i=t,{allDims:o,summedDims:l,idDims:u}=iT(r,i.length);aT(o.length,u,i);const{path:h,steps:d}=lT(l,u),p=d.length;let m=null,y=o.length;const x=[];for(let v=0;v<p;++v){for(const C of d[v]){const{permutationIndices:S,expandDims:E}=oT(y,u[C]);let _;uT(S)?_=i[C]:(_=Qs({inputs:{x:i[C]},backend:e,attrs:{perm:S}}),x.push(_));const I=_.shape.slice();for(let O=0;O<E.length;++O)I.splice(E[O],0,1);Oe(_.shape,I)||(_=tn({inputs:{x:_},backend:e,attrs:{shape:I}}),x.push(_)),m===null?m=_:(m=Fx({inputs:{a:_,b:m},backend:e}),x.push(m))}v<p-1&&(h[v]>=0&&(m=Hp({inputs:{x:m},backend:e,attrs:{axis:h[v]-(o.length-y),keepDims:!1}}),x.push(m)),y--)}for(const v of x)v!==m&&e.disposeIntermediateTensorInfo(v);return m}const Utt={kernelName:LC,backendName:"cpu",kernelFunc:Btt};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Gtt(n){const{inputs:t,backend:e}=n,{dy:s,y:r}=t;Ft([s,r],"eluGrad");const i=new Float32Array(yt(r.shape)),o=e.data.get(r.dataId).values,l=e.data.get(s.dataId).values;for(let u=0;u<o.length;++u){const h=o[u];h>=0?i[u]=l[u]:i[u]=l[u]*(h+1)}return e.makeTensorInfo(r.shape,"float32",i)}const Wtt={kernelName:PC,backendName:"cpu",kernelFunc:Gtt};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Htt=ZS,qtt=JS,jtt=tT,Ktt=eT,Xtt=nT,Ytt=sT,Qtt=Be(qf,n=>{const t=Math.sign(n),e=Math.abs(n),s=1/(1+Htt*e);return t*(1-((((Ytt*s+Xtt)*s+Ktt)*s+jtt)*s+qtt)*s*Math.exp(-e*e))}),Ztt={kernelName:qf,backendName:"cpu",kernelFunc:Qtt};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Wy(n){const{inputs:t,backend:e,attrs:s}=n,{input:r}=t,{dim:i}=s,o=r.shape.length,l=r.shape.slice();let u=i;return i<0&&(U(-(o+1)<=i,()=>`Axis must be in the interval [${-(o+1)}, ${o}]`),u=o+i+1),l.splice(u,0,1),tn({inputs:{x:r},backend:e,attrs:{shape:l}})}const Jtt={kernelName:N0,backendName:"cpu",kernelFunc:Wy};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const tet=Tn((n,t)=>n/t),BT=Un(Wf,tet),Tw={kernelName:Wf,backendName:"cpu",kernelFunc:BT};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function fL(n,t,e){const s=n.shape,r=s[0],i=s[1],o=e.data.get(n.dataId),l=o.complexTensorInfos.real,u=o.complexTensorInfos.imag,h=[r,i],d=yt(h),p=Ss("float32",d),m=Ss("float32",d);for(let C=0;C<r;C++){const S=fu({inputs:{x:l},backend:e,attrs:{begin:[C,0],size:[1,i]}}),E=fu({inputs:{x:u},backend:e,attrs:{begin:[C,0],size:[1,i]}}),_=or({inputs:{real:S,imag:E},backend:e}),{real:I,imag:O}=eet(_,t,e),P=Uo(I,O);for(let D=0;D<i;D++){const N=rT(P,D);p[C*i+D]=N.real,m[C*i+D]=N.imag}e.disposeIntermediateTensorInfo(S),e.disposeIntermediateTensorInfo(E),e.disposeIntermediateTensorInfo(_)}const y=e.makeTensorInfo(h,"float32",p),x=e.makeTensorInfo(h,"float32",m),v=or({inputs:{real:y,imag:x},backend:e});return e.disposeIntermediateTensorInfo(y),e.disposeIntermediateTensorInfo(x),v}function eet(n,t,e){const s=yt(n.shape),r=e.data.get(n.dataId),i=e.data.get(r.complexTensorInfos.real.dataId).values,o=e.data.get(r.complexTensorInfos.imag.dataId).values;if(net(s)){const l=Ew(i,o,s,t,e),u=[n.shape[0],n.shape[1]];if(t){const h=e.makeTensorInfo(u,"float32",l.real),d=e.makeTensorInfo(u,"float32",l.imag),p=e.makeTensorInfo([],"float32",Qa(s,"float32")),m=to({inputs:{x:p},backend:e}),y=Tw.kernelFunc({inputs:{a:h,b:p},backend:e}),x=Tw.kernelFunc({inputs:{a:d,b:m},backend:e}),v=e.data.get(y.dataId).values,C=e.data.get(x.dataId).values;return e.disposeIntermediateTensorInfo(h),e.disposeIntermediateTensorInfo(d),e.disposeIntermediateTensorInfo(p),e.disposeIntermediateTensorInfo(m),e.disposeIntermediateTensorInfo(y),e.disposeIntermediateTensorInfo(x),{real:v,imag:C}}return l}else{const l=Uo(i,o),u=set(l,s,t);return IO(u)}}function net(n){return(n&n-1)===0}function Ew(n,t,e,s,r){if(e===1)return{real:n,imag:t};const i=Uo(n,t),o=e/2,l=_O(i),u=l.real,h=l.imag,d=[u.length],p=r.makeTensorInfo(d,"float32",u),m=r.makeTensorInfo(d,"float32",h),y=or({inputs:{real:p,imag:m},backend:r}),x=kO(i),v=x.real,C=x.imag,S=[v.length],E=r.makeTensorInfo(S,"float32",v),_=r.makeTensorInfo(S,"float32",C),I=or({inputs:{real:E,imag:_},backend:r}),O=Ew(u,h,o,s,r),P=O.real,D=O.imag,N=[P.length],R=r.makeTensorInfo(N,"float32",P),$=r.makeTensorInfo(N,"float32",D),A=or({inputs:{real:R,imag:$},backend:r}),V=Ew(v,C,o,s,r),L=V.real,nt=V.imag,Z=[L.length],W=r.makeTensorInfo(Z,"float32",L),K=r.makeTensorInfo(Z,"float32",nt),Y=or({inputs:{real:W,imag:K},backend:r}),at=NO(e,s),B=[at.real.length],j=r.makeTensorInfo(B,"float32",at.real),st=r.makeTensorInfo(B,"float32",at.imag),tt=or({inputs:{real:j,imag:st},backend:r}),xt=Fx({inputs:{a:tt,b:Y},backend:r}),vt=Yc({inputs:{a:A,b:xt},backend:r}),Ct=VT({inputs:{a:A,b:xt},backend:r}),$t=du({inputs:{input:vt},backend:r}),Rt=du({inputs:{input:Ct},backend:r}),Lt=Qc({inputs:{input:vt},backend:r}),jt=Qc({inputs:{input:Ct},backend:r}),Kt=Zc({inputs:[$t,Rt],backend:r,attrs:{axis:0}}),de=Zc({inputs:[Lt,jt],backend:r,attrs:{axis:0}}),be=r.data.get(Kt.dataId).values,Me=r.data.get(de.dataId).values;return r.disposeIntermediateTensorInfo(p),r.disposeIntermediateTensorInfo(m),r.disposeIntermediateTensorInfo(y),r.disposeIntermediateTensorInfo(E),r.disposeIntermediateTensorInfo(_),r.disposeIntermediateTensorInfo(I),r.disposeIntermediateTensorInfo(R),r.disposeIntermediateTensorInfo($),r.disposeIntermediateTensorInfo(A),r.disposeIntermediateTensorInfo(W),r.disposeIntermediateTensorInfo(K),r.disposeIntermediateTensorInfo(Y),r.disposeIntermediateTensorInfo(j),r.disposeIntermediateTensorInfo(st),r.disposeIntermediateTensorInfo(tt),r.disposeIntermediateTensorInfo(xt),r.disposeIntermediateTensorInfo(vt),r.disposeIntermediateTensorInfo(Ct),r.disposeIntermediateTensorInfo($t),r.disposeIntermediateTensorInfo(Lt),r.disposeIntermediateTensorInfo(Rt),r.disposeIntermediateTensorInfo(jt),r.disposeIntermediateTensorInfo(Kt),r.disposeIntermediateTensorInfo(de),{real:be,imag:Me}}function set(n,t,e){const s=new Float32Array(t*2);for(let r=0;r<t;r++){let i=0,o=0;for(let l=0;l<t;l++){const u=RO(r*l,t,e),h=rT(n,l);i+=h.real*u.real-h.imag*u.imag,o+=h.real*u.imag+h.imag*u.real}e&&(i/=t,o/=t),AO(s,i,o,r)}return s}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function ret(n){const{inputs:t,backend:e}=n,{input:s}=t,r=yt(s.shape),i=s.shape[s.shape.length-1],o=r/i,l=tn({inputs:{x:s},backend:e,attrs:{shape:[o,i]}}),u=fL(l,!1,e),h=tn({inputs:{x:u},backend:e,attrs:{shape:s.shape}});return e.disposeIntermediateTensorInfo(l),e.disposeIntermediateTensorInfo(u),h}const iet={kernelName:VC,backendName:"cpu",kernelFunc:ret};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function UT(n){const{backend:t,attrs:e}=n,{shape:s,value:r,dtype:i}=e,o=i||lh(r),l=bn(o,yt(s));return aet(l,r,o),t.makeTensorInfo(s,o,l)}const oet={kernelName:zC,backendName:"cpu",kernelFunc:UT};function aet(n,t,e){n.fill(t)}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const uet={kernelName:BC,backendName:"cpu",kernelFunc:({inputs:n,attrs:t,backend:e})=>{const{image:s}=n,r=e,i=Ss(s.dtype,yt(s.shape)),[o,l,u,h]=s.shape,d=r.data.get(s.dataId).values;for(let m=0;m<o;m++){const y=m*u*l*h;for(let x=0;x<l;x++){const v=x*(u*h);for(let C=0;C<u;C++){const S=C*h;for(let E=0;E<h;E++){const _=Math.round(u-C-1),I=y+v+S+E;let O=d[I];if(_>=0&&_<u){const P=_*h,D=y+v+P+E;O=d[D]}i[I]=O}}}}return{dataId:r.write(i,s.shape,s.dtype),shape:s.shape,dtype:s.dtype}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function cet(n){const{inputs:t,backend:e,attrs:s}=n,{x:r,filter:i,bias:o,preluActivationWeights:l}=t,{strides:u,pad:h,dataFormat:d,dilations:p,dimRoundingMode:m,activation:y,leakyreluAlpha:x}=s;let v=hL({inputs:{x:r,filter:i},backend:e,attrs:{strides:u,pad:h,dataFormat:d,dilations:p,dimRoundingMode:m}});if(o){const C=v;if(d==="NCHW"&&o.shape.length===1&&o.shape[0]!==1){const S=tn({inputs:{x:o},backend:e,attrs:{shape:[o.shape[0],1,1]}});v=Yc({inputs:{a:v,b:S},backend:e}),e.disposeIntermediateTensorInfo(S)}else v=Yc({inputs:{a:v,b:o},backend:e});e.disposeIntermediateTensorInfo(C)}if(y){const C=v;if(d==="NCHW"&&y==="prelu"&&l.shape.length===1&&l.shape[0]!==1){const S=tn({inputs:{x:l},backend:e,attrs:{shape:[l.shape[0],1,1]}});v=Gy(e,v,y,S,x),e.disposeIntermediateTensorInfo(S)}else v=Gy(e,v,y,l,x);e.disposeIntermediateTensorInfo(C)}return v}const het={kernelName:Cy,backendName:"cpu",kernelFunc:cet};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function det(n){const{inputs:t,backend:e,attrs:s}=n,{x:r,filter:i,bias:o,preluActivationWeights:l}=t,{strides:u,pad:h,dataFormat:d,dilations:p,dimRoundingMode:m,activation:y,leakyreluAlpha:x}=s;let v=dL({inputs:{x:r,filter:i},backend:e,attrs:{strides:u,pad:h,dataFormat:d,dilations:p,dimRoundingMode:m}});if(o){const C=v;v=Yc({inputs:{a:v,b:o},backend:e}),e.disposeIntermediateTensorInfo(C)}if(y){const C=v;v=Gy(e,v,y,l,x),e.disposeIntermediateTensorInfo(C)}return v}const fet={kernelName:nD,backendName:"cpu",kernelFunc:det};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function pet(n){const{inputs:t,backend:e}=n,{params:s,indices:r}=t,i=yt(s.shape),o=r.shape,l=o[o.length-1],[u,h,d,p]=BS(s,r);if(h===0)return e.makeTensorInfo(u,s.dtype,[]);const m=e.data.get(r.dataId).values,y=e.bufferSync(s),x=SF(m,y,s.dtype,h,l,d,p,s.shape,i);return e.makeTensorInfo(u,s.dtype,x.values)}const met={kernelName:P$,backendName:"cpu",kernelFunc:pet};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function get(n){const{inputs:t,backend:e,attrs:s}=n,{x:r,indices:i}=t,{axis:o,batchDims:l}=s;Ft([r,i],"gatherV2");const u=le(o,r.shape)[0],h=e.data.get(i.dataId).values,d=r.shape[u];for(let I=0;I<h.length;++I){const O=h[I];U(O<=d-1&&O>=0,()=>`GatherV2: the index value ${O} is not in [0, ${d-1}]`)}let p=l;l==null&&(p=0);const m=yt(i.shape),y=hT(r,i,u,p),x=tn({inputs:{x:r},backend:e,attrs:{shape:[y.batchSize,y.outerSize,y.dimSize,y.sliceSize]}}),v=tn({inputs:{x:i},backend:e,attrs:{shape:[y.batchSize,m/y.batchSize]}}),C=[y.batchSize,y.outerSize,m/y.batchSize,y.sliceSize],S=e.bufferSync(v),E=e.bufferSync(x),_=TF(E,S,C);return e.disposeIntermediateTensorInfo(x),e.disposeIntermediateTensorInfo(v),e.makeTensorInfo(y.outputShape,_.dtype,_.values)}const yet={kernelName:$0,backendName:"cpu",kernelFunc:get};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function xet(n){const{inputs:t,backend:e}=n,{input:s}=t,r=yt(s.shape),i=s.shape[s.shape.length-1],o=r/i,l=tn({inputs:{x:s},backend:e,attrs:{shape:[o,i]}}),u=fL(l,!0,e),h=tn({inputs:{x:u},backend:e,attrs:{shape:s.shape}});return e.disposeIntermediateTensorInfo(l),e.disposeIntermediateTensorInfo(u),h}const bet={kernelName:UC,backendName:"cpu",kernelFunc:xet};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const vet=Be(Jf,n=>Number.isFinite(n)?1:0,"bool"),wet={kernelName:Jf,backendName:"cpu",kernelFunc:vet};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Cet=Be(tp,n=>Math.abs(n)===1/0?1:0,"bool"),Tet={kernelName:tp,backendName:"cpu",kernelFunc:Cet};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Eet=Be(ep,n=>Number.isNaN(n)?1:0,"bool"),Iet={kernelName:ep,backendName:"cpu",kernelFunc:Eet};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function _et(n){const{backend:t,attrs:e}=n,{start:s,stop:r,num:i}=e,o=AF(s,r,i);return t.makeTensorInfo([o.length],"float32",o)}const ket={kernelName:V$,backendName:"cpu",kernelFunc:_et};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Aet=Be(sp,n=>Math.log1p(n)),Net={kernelName:sp,backendName:"cpu",kernelFunc:Aet};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Ret=Tn((n,t)=>n&&t),$et=Un(L0,Ret,null,"bool"),Det={kernelName:L0,backendName:"cpu",kernelFunc:$et};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Oet=Be(P0,n=>n?0:1,"bool"),Met={kernelName:P0,backendName:"cpu",kernelFunc:Oet};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Fet=Tn((n,t)=>n||t),Let=Un(V0,Fet,null,"bool"),Pet={kernelName:V0,backendName:"cpu",kernelFunc:Let};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Vet(n){const{inputs:t,backend:e,attrs:s}=n,{x:r}=t,{depthRadius:i,bias:o,alpha:l,beta:u}=s;Ft(r,"LRN");const h=r.shape[3],d=h-1,p=e.data.get(r.dataId).values,m=yt(r.shape),y=new Float32Array(m);function x(v){const C=v%h;let S=v-C+Math.max(0,C-i);const E=v-C+Math.min(C+i,d);let _=0;for(;S<=E;S++){const I=p[S];_+=I*I}return _}for(let v=0;v<m;v++){const C=x(v),S=p[v]*Math.pow(o+l*C,-u);y[v]=S}return e.makeTensorInfo(r.shape,r.dtype,y)}const zet={kernelName:z0,backendName:"cpu",kernelFunc:Vet};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Bet(n){const{inputs:t,backend:e,attrs:s}=n,{x:r,y:i,dy:o}=t,{depthRadius:l,bias:u,alpha:h,beta:d}=s;Ft(o,"LRNGrad");const p=yt(o.shape),m=o.shape[3],y=e.data.get(o.dataId).values,x=e.data.get(r.dataId).values,v=e.data.get(i.dataId).values,C=new Float32Array(p),S=p;for(let E=0;E<S;E++){const _=E%m,I=E-_+Math.max(0,_-l),O=E-_+Math.min(m,_+l+1);let P=0;for(let D=I;D<O;D++)P+=Math.pow(x[D],2);P=h*P+u;for(let D=I;D<O;D++){let N=-2*h*d*x[D]*v[E]/P;E===D&&(N+=Math.pow(P,-d)),N*=y[E],C[D]+=N}}return e.makeTensorInfo(o.shape,r.dtype,C)}const Uet={kernelName:WC,backendName:"cpu",kernelFunc:Bet};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function pL(n){const{inputs:t,backend:e,attrs:s}=n,{x:r}=t,{reductionIndices:i,keepDims:o}=s,l=e;let u=r.shape;const h=u.length,d=le(i,u);let p=d;const m=hn(p,h);let y=l.data.get(r.dataId).values;if(m!=null){const I=new Array(h);for(let O=0;O<I.length;O++)I[O]=u[m[O]];y=LT(y,u,r.dtype,m,I),p=Cn(p.length,h),u=I}Ft(r,"max"),hs("max",p,h);const[x,v]=es(u,p),C=yt(v),S=RF(y,C,x,r.dtype),E=l.write(S,x,r.dtype);let _=x;return o&&(_=Nn(x,d)),{dataId:E,shape:_,dtype:r.dtype}}const Get={kernelName:B0,backendName:"cpu",kernelFunc:pL};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Wet(n){const{inputs:t,backend:e,attrs:s}=n,{x:r}=t;Ft(r,"maxPool");const{filterSize:i,strides:o,pad:l,dimRoundingMode:u}=s,h=1;U(Is(o,h),()=>`Error in maxPool: Either strides or dilations must be 1. Got strides ${o} and dilations '${h}'`);const d=Kr(r.shape,i,o,h,l,u);let p;if(d.filterWidth===1&&d.filterHeight===1&&Oe(d.inShape,d.outShape))p=to({inputs:{x:r},backend:e});else{const m=e.data.get(r.dataId).values,y=zt(r.shape),x=zT(m,r.shape,r.dtype,y,d,"max");p=e.makeTensorInfo(d.outShape,r.dtype,x.values)}return p}const Het={kernelName:U0,backendName:"cpu",kernelFunc:Wet};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function qet(n){const{inputs:t,backend:e,attrs:s}=n,{x:r}=t,{filterSize:i,strides:o,pad:l,dimRoundingMode:u,dataFormat:h}=s;Ft(r,"maxPool3d");const d=qo(r.shape,i,o,1,l,u,h),p=e.data.get(r.dataId).values,m=cL(p,r.shape,r.dtype,zt(r.shape),d,"max");return e.makeTensorInfo(m.shape,"float32",m.values)}const jet={kernelName:G0,backendName:"cpu",kernelFunc:qet};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Ket(n){const{inputs:t,backend:e,attrs:s}=n,{dy:r,input:i}=t,{filterSize:o,strides:l,pad:u,dimRoundingMode:h}=s;Ft([r,i],"maxPool3DGrad");const d=qo(i.shape,o,l,1,u,h),p=e.bufferSync(i),m=OJ(p,d),y=d.strideDepth,x=d.strideHeight,v=d.strideWidth,C=d.dilationDepth,S=d.dilationHeight,E=d.dilationWidth,_=d.effectiveFilterDepth,I=d.effectiveFilterHeight,O=d.effectiveFilterWidth,P=_-1-d.padInfo.front,D=O-1-d.padInfo.left,N=I-1-d.padInfo.top,R=ae(i.shape,"float32"),$=e.bufferSync(r);for(let A=0;A<d.batchSize;++A)for(let V=0;V<d.inChannels;++V)for(let L=0;L<d.inDepth;++L)for(let nt=0;nt<d.inHeight;++nt)for(let Z=0;Z<d.inWidth;++Z){const W=L-P,K=nt-N,Y=Z-D;let at=0;for(let B=0;B<_;B+=C){const j=(W+B)/y;if(!(j<0||j>=d.outDepth||Math.floor(j)!==j))for(let st=0;st<I;st+=S){const tt=(K+st)/x;if(!(tt<0||tt>=d.outHeight||Math.floor(tt)!==tt))for(let xt=0;xt<O;xt+=E){const vt=(Y+xt)/v;if(vt<0||vt>=d.outWidth||Math.floor(vt)!==vt)continue;const Ct=_*I*O-1-m.get(A,j,tt,vt,V),$t=B*I*O+st*O+xt,Rt=Ct===$t?1:0;if(Rt===0)continue;const Lt=$.get(A,j,tt,vt,V);at+=Lt*Rt}}}R.set(at,A,L,nt,Z,V)}return e.makeTensorInfo(R.shape,R.dtype,R.values)}const Xet={kernelName:qC,backendName:"cpu",kernelFunc:Ket};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Yet(n){const{inputs:t,backend:e,attrs:s}=n,{dy:r,input:i,output:o}=t,l=i;Ft([i,o],"maxPoolGrad");const{filterSize:u,strides:h,pad:d,dimRoundingMode:p}=s,m=Kr(l.shape,u,h,1,d,p),y=e.data.get(l.dataId).values,x=ae(m.outShape,l.dtype,uL(y,l.shape,l.dtype,m).values),v=m.strideHeight,C=m.strideWidth,S=m.dilationHeight,E=m.dilationWidth,_=m.effectiveFilterHeight,I=m.effectiveFilterWidth,O=I-1-m.padInfo.left,P=_-1-m.padInfo.top,D=ae(l.shape,"float32"),N=e.data.get(r.dataId).values,R=ae(r.shape,"float32",N);for(let $=0;$<m.batchSize;++$)for(let A=0;A<m.inChannels;++A)for(let V=0;V<m.inHeight;++V)for(let L=0;L<m.inWidth;++L){const nt=V-P,Z=L-O;let W=0;for(let K=0;K<_;K+=S){const Y=(nt+K)/v;if(!(Y<0||Y>=m.outHeight||Math.floor(Y)!==Y))for(let at=0;at<I;at+=E){const B=(Z+at)/C;if(B<0||B>=m.outWidth||Math.floor(B)!==B)continue;const j=_*I-1-x.get($,Y,B,A),st=K*I+at,tt=j===st?1:0;if(tt===0)continue;const xt=R.get($,Y,B,A);W+=xt*tt}}D.set(W,$,V,L,A)}return e.makeTensorInfo(D.shape,D.dtype,D.values)}const Qet={kernelName:HC,backendName:"cpu",kernelFunc:Yet};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Zet(n,t,e,s,r){const i=zt(t),o=zT(n,t,e,i,r,"max"),l=uL(n,t,e,r,!0,s);return[o.values,l.values]}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Jet={kernelName:z$,backendName:"cpu",kernelFunc:({inputs:n,attrs:t,backend:e})=>{const{x:s}=n,{filterSize:r,strides:i,pad:o,includeBatchInIndex:l}=t,u=e;Ft(s,"MaxPoolWithArgmax");const h=u.data.get(s.dataId).values,d=Kr(s.shape,r,i,[1,1],o),[p,m]=Zet(h,s.shape,s.dtype,l,d),y=u.write(p,d.outShape,s.dtype),x=u.write(m,d.outShape,s.dtype);return[{dataId:y,shape:d.outShape,dtype:s.dtype},{dataId:x,shape:d.outShape,dtype:"int32"}]}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function tnt(n){const{inputs:t,backend:e,attrs:s}=n,{x:r}=t,{axis:i,keepDims:o}=s,l=le(i,r.shape),h=es(r.shape,l)[1],d=yt(h),p=[],m=e.makeTensorInfo([],"float32",new Float32Array([d]));p.push(m);const y=Xa({inputs:{x:r},backend:e,attrs:{dtype:"float32"}});p.push(y);const x=BT({inputs:{a:y,b:m},backend:e});p.push(x);const v=Hp({inputs:{x},backend:e,attrs:{axis:i,keepDims:o}});return p.forEach(C=>e.disposeIntermediateTensorInfo(C)),v}const ent={kernelName:W0,backendName:"cpu",kernelFunc:tnt};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function nnt(n){const{inputs:t,backend:e,attrs:s}=n,{x:r}=t,{axis:i,keepDims:o}=s;Ft(r,"min");const l=le(i,r.shape);let u=l;const h=hn(u,r.shape.length);let d=r;h!=null&&(d=Qs({inputs:{x:r},backend:e,attrs:{perm:h}}),u=Cn(u.length,r.shape.length)),hs("min",u,d.shape.length);const[p,m]=es(d.shape,u),y=yt(m),x=Ts(yt(p),d.dtype),v=e.data.get(d.dataId).values;for(let S=0;S<x.length;++S){const E=S*y;let _=v[E];for(let I=0;I<y;++I){const O=v[E+I];(Number.isNaN(O)||O<_)&&(_=O)}x[S]=_}h!=null&&e.disposeIntermediateTensorInfo(d);const C=e.makeTensorInfo(p,d.dtype,x);if(o){const S=Nn(p,l),E=tn({inputs:{x:C},backend:e,attrs:{shape:S}});return e.disposeIntermediateTensorInfo(C),E}return C}const snt={kernelName:H0,backendName:"cpu",kernelFunc:nnt};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function rnt(n){const{inputs:t,backend:e,attrs:s}=n,{x:r}=t,{paddings:i,mode:o}=s;Ft(r,"mirrorPad");const l=i.map((_,I)=>_[0]+r.shape[I]+_[1]),u=i.map(_=>_[0]),h=i.map((_,I)=>_[0]+r.shape[I]),d=o==="reflect"?0:1,p=e.data.get(r.dataId).values,m=r.shape.length,y=zt(r.shape),x=yt(l),v=l.length,C=zt(l),S=Ss(r.dtype,x);for(let _=0;_<x;_++){let I=uh(_,v,C);for(let P=0;P<v;P++)I[P]<u[P]?I[P]=u[P]*2-I[P]-d:I[P]>=h[P]&&(I[P]=(h[P]-1)*2-I[P]+d);I=I.map((P,D)=>P-u[D]);const O=Bi(I,m,y);S[_]=p[O]}return{dataId:e.write(S,l,r.dtype),shape:l,dtype:r.dtype}}const int={kernelName:q0,backendName:"cpu",kernelFunc:rnt};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const ont=Tn((n,t)=>{const e=n%t;return n<0&&t<0||n>=0&&t>=0?e:(e+t)%t}),ant=Un(op,ont),lnt={kernelName:op,backendName:"cpu",kernelFunc:ant};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function mL(n){const{inputs:t,backend:e,attrs:s}=n,{logits:r}=t,{dim:i}=s,o=r.shape.length;let l=i;if(l===-1&&(l=o-1),l!==o-1)throw Error(`Softmax along a non-last dimension is not yet supported. Logits was rank ${o} and dim was ${l}`);const u=le([l],r.shape),h=pL({inputs:{x:r},backend:e,attrs:{reductionIndices:u,keepDims:!1}}),d=Nn(h.shape,u),p=tn({inputs:{x:h},backend:e,attrs:{shape:d}}),m=VT({inputs:{a:r,b:p},backend:e}),y=bF({inputs:{x:m},backend:e}),x=Hp({inputs:{x:y},backend:e,attrs:{axis:u,keepDims:!1}}),v=tn({inputs:{x},backend:e,attrs:{shape:d}}),C=BT({inputs:{a:y,b:v},backend:e});return e.disposeIntermediateTensorInfo(h),e.disposeIntermediateTensorInfo(p),e.disposeIntermediateTensorInfo(m),e.disposeIntermediateTensorInfo(y),e.disposeIntermediateTensorInfo(x),e.disposeIntermediateTensorInfo(v),C}const unt={kernelName:cx,backendName:"cpu",kernelFunc:mL};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function cnt(n){const{inputs:t,backend:e,attrs:s}=n,{logits:r}=t,{numSamples:i,seed:o,normalized:l}=s;Ft(r,"multinomial");const u=l?r:mL({inputs:{logits:r},backend:e,attrs:{dim:-1}}),h=u.shape[0],d=u.shape[1],p=e.data.get(u.dataId).values,m=[h,i],y=Ts(yt(m),"int32");for(let x=0;x<h;++x){const v=x*d,C=new Float32Array(d-1);C[0]=p[v];for(let _=1;_<C.length;++_)C[_]=C[_-1]+p[v+_];const S=IS.alea(o.toString()),E=x*i;for(let _=0;_<i;++_){const I=S();y[E+_]=C.length;for(let O=0;O<C.length;O++)if(I<C[O]){y[E+_]=O;break}}}return l||e.disposeIntermediateTensorInfo(u),e.makeTensorInfo(m,"int32",y)}const hnt={kernelName:B$,backendName:"cpu",kernelFunc:cnt};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const dnt=MS;function fnt(n){const{inputs:t,backend:e,attrs:s}=n,{boxes:r,scores:i}=t,{maxOutputSize:o,iouThreshold:l,scoreThreshold:u}=s;Ft(r,"NonMaxSuppression");const h=e.data.get(r.dataId).values,d=e.data.get(i.dataId).values,{selectedIndices:p}=dnt(h,d,o,l,u);return e.makeTensorInfo([p.length],"int32",new Int32Array(p))}const pnt={kernelName:jC,backendName:"cpu",kernelFunc:fnt};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const mnt=FS;function gnt(n){const{inputs:t,backend:e,attrs:s}=n,{boxes:r,scores:i}=t,{maxOutputSize:o,iouThreshold:l,scoreThreshold:u,padToMaxOutputSize:h}=s;Ft(r,"NonMaxSuppressionPadded");const d=e.data.get(r.dataId).values,p=e.data.get(i.dataId).values,{selectedIndices:m,validOutputs:y}=mnt(d,p,o,l,u,h);return[e.makeTensorInfo([m.length],"int32",new Int32Array(m)),e.makeTensorInfo([],"int32",new Int32Array([y]))]}const ynt={kernelName:KC,backendName:"cpu",kernelFunc:gnt};/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const xnt=LS;function bnt(n){const{inputs:t,backend:e,attrs:s}=n,{boxes:r,scores:i}=t,{maxOutputSize:o,iouThreshold:l,scoreThreshold:u,softNmsSigma:h}=s;Ft(r,"NonMaxSuppressionWithScore");const d=e.data.get(r.dataId).values,p=e.data.get(i.dataId).values,m=o,y=l,x=u,v=h,{selectedIndices:C,selectedScores:S}=xnt(d,p,m,y,x,v);return[e.makeTensorInfo([C.length],"int32",new Int32Array(C)),e.makeTensorInfo([S.length],"float32",new Float32Array(S))]}const vnt={kernelName:XC,backendName:"cpu",kernelFunc:bnt};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function wnt(n){const{inputs:t,backend:e,attrs:s}=n,{indices:r}=t,{dtype:i,depth:o,onValue:l,offValue:u}=s;Ft(r,"oneHot");const h=yt(r.shape),d=new Float32Array(h*o);d.fill(u);const p=e.data.get(r.dataId).values;for(let m=0;m<h;++m)p[m]>=0&&p[m]<o&&(d[m*o+p[m]]=l);return e.makeTensorInfo([...r.shape,o],i,d)}const Cnt={kernelName:Y0,backendName:"cpu",kernelFunc:wnt};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Hy(n){const{inputs:t,backend:e}=n,{x:s}=t;if(s.dtype==="string")throw new Error("zerosLike is not supported for string tensors");if(s.dtype==="complex64"){const r=du({inputs:{input:s},backend:e}),i=Hy({inputs:{x:r},backend:e}),o=Qc({inputs:{input:s},backend:e}),l=Hy({inputs:{x:o},backend:e}),u=or({inputs:{real:i,imag:l},backend:e});return e.disposeIntermediateTensorInfo(r),e.disposeIntermediateTensorInfo(i),e.disposeIntermediateTensorInfo(o),e.disposeIntermediateTensorInfo(l),u}else return UT({backend:e,attrs:{shape:s.shape,value:0,dtype:s.dtype}})}const Snt={kernelName:fx,backendName:"cpu",kernelFunc:Hy};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function gL(n){const{inputs:t,backend:e}=n,{x:s}=t;if(s.dtype==="string")throw new Error("onesLike is not supported for string tensors");if(s.dtype==="complex64"){const r=du({inputs:{input:s},backend:e}),i=gL({inputs:{x:r},backend:e}),o=Qc({inputs:{input:s},backend:e}),l=Hy({inputs:{x:o},backend:e}),u=or({inputs:{real:i,imag:l},backend:e});return e.disposeIntermediateTensorInfo(r),e.disposeIntermediateTensorInfo(i),e.disposeIntermediateTensorInfo(o),e.disposeIntermediateTensorInfo(l),u}else return UT({backend:e,attrs:{shape:s.shape,value:1,dtype:s.dtype}})}const Tnt={kernelName:X0,backendName:"cpu",kernelFunc:gL};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function yL(n){const{inputs:t,backend:e,attrs:s}=n,{axis:r}=s;if(t.length===1)return Wy({inputs:{input:t[0]},backend:e,attrs:{dim:r}});const i=t[0].shape,o=t[0].dtype;t.forEach(d=>{mC(i,d.shape,"All tensors passed to stack must have matching shapes"),U(o===d.dtype,()=>"All tensors passed to stack must have matching dtypes")});const l=[],u=t.map(d=>{const p=Wy({inputs:{input:d},backend:e,attrs:{dim:r}});return l.push(p),p}),h=Zc({inputs:u,backend:e,attrs:{axis:r}});return l.forEach(d=>e.disposeIntermediateTensorInfo(d)),h}const Ent={kernelName:Q0,backendName:"cpu",kernelFunc:yL};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Int(n){const{inputs:t,backend:e,attrs:s}=n,{x:r}=t,{paddings:i,constantValue:o}=s;Ft(r,"pad");const l=i.map((E,_)=>E[0]+r.shape[_]+E[1]),u=i.map(E=>E[0]),h=e.data.get(r.dataId).values,d=yt(r.shape),p=r.shape.length,m=zt(r.shape),y=yt(l),x=l.length,v=zt(l),C=Ss(r.dtype,y);o!==0&&C.fill(o);for(let E=0;E<d;E++){const I=uh(E,p,m).map((P,D)=>P+u[D]),O=Bi(I,x,v);C[O]=h[E]}return{dataId:e.write(C,l,r.dtype),shape:l,dtype:r.dtype}}const xL={kernelName:Z0,backendName:"cpu",kernelFunc:Int};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const _nt=Tn((n,t)=>Math.pow(n,t)),knt=Un(lp,_nt),Ant={kernelName:lp,backendName:"cpu",kernelFunc:knt};/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Nnt(n){const{inputs:t,backend:e,attrs:s}=n,{paramsNestedSplits:r,paramsDenseValues:i,indices:o}=t,{outputRaggedRank:l}=s,u=r.map(S=>e.data.get(S.dataId).values),h=r.map(S=>S.shape),d=e.data.get(i.dataId).values,p=e.data.get(o.dataId).values,[m,y,x]=LF(u,h,d,i.shape,i.dtype,p,o.shape),v=m.map(S=>e.makeTensorInfo([S.length],"int32",S)),C=e.makeTensorInfo(x,i.dtype,y);return v.concat([C])}const Rnt={kernelName:U$,backendName:"cpu",kernelFunc:Nnt};/**
 * @license
 * Copyright 2022 Google LLC.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function $nt(n){const{inputs:t,backend:e}=n,{starts:s,limits:r,deltas:i}=t,o=e.data.get(s.dataId).values,l=e.data.get(r.dataId).values,u=e.data.get(i.dataId).values,[h,d]=PF(o,s.shape,s.dtype,l,r.shape,u,i.shape),p=e.makeTensorInfo([h.length],"int32",h),m=e.makeTensorInfo([d.length],s.dtype,d);return[p,m]}const Dnt={kernelName:G$,backendName:"cpu",kernelFunc:$nt};/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Ont(n){const{inputs:t,backend:e,attrs:s}=n,{shape:r,values:i,defaultValue:o,rowPartitionTensors:l}=t,{rowPartitionTypes:u}=s,h=e.data.get(r.dataId).values,d=e.data.get(i.dataId).values,p=e.data.get(o.dataId).values,m=l.map(C=>e.data.get(C.dataId).values),y=l.map(C=>C.shape),[x,v]=VF(h,r.shape,d,i.shape,i.dtype,p,o.shape,m,y,u);return e.makeTensorInfo(x,i.dtype,v)}const Mnt={kernelName:W$,backendName:"cpu",kernelFunc:Ont};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Fnt(n){const{backend:t,attrs:e}=n,{start:s,stop:r,dtype:i,step:o}=e,l=zF(s,r,o,i);return t.makeTensorInfo([l.length],i,l)}const Lnt={kernelName:YC,backendName:"cpu",kernelFunc:Fnt};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Pnt=Be(up,n=>1/n),Vnt={kernelName:up,backendName:"cpu",kernelFunc:Pnt};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function znt(n){const{inputs:t,backend:e,attrs:s}=n,{images:r}=t,{alignCorners:i,halfPixelCenters:o,size:l}=s;Ft(r,"resizeBilinear");const u=zt(r.shape),[h,d]=l,[p,m,y,x]=r.shape,v=e.data.get(r.dataId).values,C=new Float32Array(yt([p,h,d,x])),S=[i&&h>1?m-1:m,i&&d>1?y-1:y],E=[i&&h>1?h-1:h,i&&d>1?d-1:d];let _=0;const I=S[0]/E[0],O=S[1]/E[1];for(let P=0;P<p;P++)for(let D=0;D<h;D++){let N;o?N=I*(D+.5)-.5:N=I*D;const R=Math.max(0,Math.floor(N)),$=N-R,A=Math.min(m-1,Math.ceil(N)),V=P*u[0]+R*u[1],L=P*u[0]+A*u[1];for(let nt=0;nt<d;nt++){let Z;o?Z=O*(nt+.5)-.5:Z=O*nt;const W=Math.max(0,Math.floor(Z)),K=Z-W,Y=Math.min(y-1,Math.ceil(Z)),at=V+W*u[2],B=L+W*u[2],j=V+Y*u[2],st=L+Y*u[2];for(let tt=0;tt<x;tt++){const xt=v[at+tt],vt=v[B+tt],Ct=v[j+tt],$t=v[st+tt],Rt=xt+(Ct-xt)*K,Lt=vt+($t-vt)*K,jt=Rt+(Lt-Rt)*$;C[_++]=jt}}}return e.makeTensorInfo([p,h,d,x],"float32",C)}const Bnt={kernelName:sx,backendName:"cpu",kernelFunc:znt};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Unt(n){const{inputs:t,backend:e,attrs:s}=n,{images:r,dy:i}=t,{alignCorners:o}=s;Ft([i,r],"resizeBilinearGrad");const l=zt(r.shape),[u,h,d,p]=r.shape,[,m,y]=i.shape,x=new Float32Array(u*h*d*p),v=[o&&m>1?h-1:h,o&&y>1?d-1:d],C=[o&&m>1?m-1:m,o&&y>1?y-1:y],S=v[0]/C[0],E=v[1]/C[1],_=e.data.get(i.dataId).values;let I=0;for(let O=0;O<u;O++){const P=O*l[0];for(let D=0;D<m;D++){const N=D*S,R=Math.floor(N),$=Math.min(Math.ceil(N),h-1),A=P+R*l[1],V=P+$*l[1],L=N-R,nt=1-L;for(let Z=0;Z<y;Z++){const W=Z*E,K=Math.floor(W),Y=Math.min(Math.ceil(W),d-1),at=W-K,B=1-at,j=A+K*l[2],st=A+Y*l[2],tt=V+K*l[2],xt=V+Y*l[2],vt=nt*B,Ct=nt*at,$t=L*B,Rt=L*at;for(let Lt=0;Lt<p;Lt++){const jt=_[I++];x[j+Lt]+=jt*vt,x[st+Lt]+=jt*Ct,x[tt+Lt]+=jt*$t,x[xt+Lt]+=jt*Rt}}}}return e.makeTensorInfo([u,d,h,p],"float32",x)}const Gnt={kernelName:JC,backendName:"cpu",kernelFunc:Unt};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Wnt(n){const{inputs:t,backend:e,attrs:s}=n,{images:r}=t,{alignCorners:i,halfPixelCenters:o,size:l}=s;Ft(r,"resizeNearestNeighbor");const u=zt(r.shape),[h,d]=l,[p,m,y,x]=r.shape,v=e.data.get(r.dataId).values,C=new Float32Array(p*h*d*x),S=[i&&h>1?m-1:m,i&&d>1?y-1:y],E=[i&&h>1?h-1:h,i&&d>1?d-1:d],_=S[0]/E[0],I=S[1]/E[1];let O=0;for(let P=0;P<p;P++){const D=P*u[0];for(let N=0;N<h;N++){const R=o?_*(N+.5):_*N;let $=Math.min(m-1,i?Math.round(R):Math.floor(R));o&&($=Math.max(0,$));const A=D+$*u[1];for(let V=0;V<d;V++){const L=o?I*(V+.5):I*V;let nt=Math.min(y-1,i?Math.round(L):Math.floor(L));o&&(nt=Math.max(0,nt));const Z=A+nt*u[2];for(let W=0;W<x;W++){const K=v[Z+W];C[O++]=K}}}}return e.makeTensorInfo([p,h,d,x],r.dtype,C)}const Hnt={kernelName:nx,backendName:"cpu",kernelFunc:Wnt};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function qnt(n){const{inputs:t,backend:e,attrs:s}=n,{images:r,dy:i}=t,{alignCorners:o}=s;Ft([i,r],"resizeNearestNeighborGrad");const l=zt(r.shape),u=zt(i.shape),[h,d,p,m]=r.shape,[,y,x]=i.shape,v=new Float32Array(h*d*p*m),C=e.data.get(i.dataId).values,S=[o&&y>1?d-1:d,o&&x>1?p-1:p],E=[o&&y>1?y-1:y,o&&x>1?x-1:x],_=S[0]/E[0],I=S[1]/E[1],O=1/_,P=1/I,D=Math.ceil(O)*2+2,N=Math.ceil(P)*2+2;for(let R=0;R<h;R++){const $=R*l[0];for(let A=0;A<d;A++){const V=$+A*l[1],L=Math.floor(A*O),nt=Math.floor(L-D/2);for(let Z=0;Z<p;Z++){const W=V+Z*l[2],K=Math.floor(Z*P),Y=Math.floor(K-N/2);for(let at=0;at<m;at++){let B=0;for(let j=0;j<D;j++){const st=j+nt;if(st<0||st>=y)continue;const tt=$+st*u[1],xt=st*_,vt=Math.min(d-1,o?Math.round(xt):Math.floor(xt));if(A===vt)for(let Ct=0;Ct<N;Ct++){const $t=Ct+Y;if($t<0||$t>=x)continue;const Rt=tt+$t*u[2],Lt=$t*I,jt=Math.min(p-1,o?Math.round(Lt):Math.floor(Lt));Z===jt&&(B+=C[Rt+at])}}v[W+at]=B}}}}return e.makeTensorInfo(r.shape,r.dtype,v)}const jnt={kernelName:ZC,backendName:"cpu",kernelFunc:qnt};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Knt(n){const{inputs:t,backend:e,attrs:s}=n,{x:r}=t,{dims:i}=s;Ft(r,"reverse");const o=r.shape.length,l=le(i,r.shape);if(o===0)return to({inputs:{x:r},backend:e});const u=new us(r.shape,r.dtype),h=e.bufferSync(r);for(let d=0;d<u.size;d++){const p=u.indexToLoc(d),m=p.slice();l.forEach(y=>m[y]=r.shape[y]-1-m[y]),u.set(h.get(...m),...p)}return e.makeTensorInfo(u.shape,u.dtype,u.values)}const Xnt={kernelName:rx,backendName:"cpu",kernelFunc:Knt};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Ynt={kernelName:oS,backendName:"cpu",kernelFunc:({inputs:n,attrs:t,backend:e})=>{const{image:s}=n,{radians:r,fillValue:i,center:o}=t,l=e,u=Ss(s.dtype,yt(s.shape)),[h,d,p,m]=s.shape,[y,x]=XS(o,d,p),v=255,C=Math.sin(r),S=Math.cos(r),E=l.data.get(s.dataId).values;for(let I=0;I<h;I++){const O=I*p*d*m;for(let P=0;P<d;P++){const D=P*(p*m);for(let N=0;N<p;N++){const R=N*m;for(let $=0;$<m;$++){const A=[h,P,N,$],V=A[2],L=A[1];let nt=(V-y)*S-(L-x)*C,Z=(V-y)*C+(L-x)*S;nt=Math.round(nt+y),Z=Math.round(Z+x);let W=i;if(typeof i!="number"&&($===3?W=v:W=i[$]),nt>=0&&nt<p&&Z>=0&&Z<d){const Y=Z*(p*m),at=nt*m,B=O+Y+at+$;W=E[B]}const K=O+D+R+$;u[K]=W}}}}return{dataId:l.write(u,s.shape,s.dtype),shape:s.shape,dtype:s.dtype}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Qnt=Be(dp,n=>{const t=Math.floor(n);return n-t<.5?Math.floor(n):n-t>.5?Math.ceil(n):t%2===0?t:t+1}),Znt={kernelName:dp,backendName:"cpu",kernelFunc:Qnt};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Jnt(n){const{inputs:t,backend:e,attrs:s}=n,{indices:r,updates:i}=t,{shape:o}=s,{sliceRank:l,numUpdates:u,sliceSize:h,strides:d,outputSize:p}=Su(i,r,o),m=!0,y=e.bufferSync(r),x=e.bufferSync(i),v=Kl(y,x,o,p,h,u,l,d,0,m);return e.makeTensorInfo(o,v.dtype,v.values)}const tst={kernelName:H$,backendName:"cpu",kernelFunc:Jnt};/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function est(n,t){let e=0,s=n.length,r=0;for(;e<s;)r=Math.floor((e+s)/2),n[r]<t?e=r+1:s=r;return s}function nst(n,t){let e=0,s=n.length,r=0;for(;e<s;)r=Math.floor((e+s)/2),n[r]<=t?e=r+1:s=r;return s}function sst(n,t,e,s,r,i){const o=bn("int32",e*r);for(let l=0;l<e;++l){const u=n.slice(l*s,(l+1)*s),h=l*r;for(let d=0;d<r;++d)o[h+d]=i==="left"?est(u,t[d+h]):nst(u,t[d+h])}return o}/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function rst(n){const{inputs:t,backend:e,attrs:s}=n,{sortedSequence:r,values:i}=t,{side:o}=s,l=e.data.get(r.dataId).values,u=e.data.get(i.dataId).values,h=sst(l,u,r.shape[0],r.shape[1],i.shape[1],o);return e.makeTensorInfo(i.shape,"int32",h)}const ist={kernelName:j$,backendName:"cpu",kernelFunc:rst};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function ost(n){const{inputs:t,backend:e}=n,{condition:s,t:r,e:i}=t;Ft([s,r,i],"select");const o=s.shape.length,l=e.data.get(s.dataId).values,u=e.data.get(r.dataId).values,h=e.data.get(i.dataId).values,d=lr(r.dtype,i.dtype),p=Ts(yt(r.shape),d);let m=0;const y=o===0||o>1||r.shape.length===1?1:yt(r.shape.slice(1));for(let x=0;x<l.length;x++)for(let v=0;v<y;v++)l[x]===1?p[m++]=u[x]:p[m++]=h[x];return e.makeTensorInfo(r.shape,d,p)}const ast={kernelName:ix,backendName:"cpu",kernelFunc:ost};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const lst=Sx,ust=Tx,cst=Be(pp,n=>n>=0?ust*n:lst*(Math.exp(n)-1)),hst={kernelName:pp,backendName:"cpu",kernelFunc:cst};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const dst=Be(yp,n=>n<0?-1:n>0?1:0),fst={kernelName:yp,backendName:"cpu",kernelFunc:dst};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const pst=Be(mp,n=>Math.sin(n)),mst={kernelName:mp,backendName:"cpu",kernelFunc:pst};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const gst=Be(gp,n=>Math.sinh(n)),yst={kernelName:gp,backendName:"cpu",kernelFunc:gst};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const xst=11920928955078125e-23,qA=Math.log(xst)+2,bst=Be(bp,n=>{const t=n>-qA,e=n<qA,s=Math.exp(n);let r;return e?r=s:t?r=n:r=Math.log(1+s),r}),vst={kernelName:bp,backendName:"cpu",kernelFunc:bst};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function wst(n){const{inputs:t,backend:e,attrs:s}=n,{x:r}=t,{blockShape:i,paddings:o}=s;Ft([r],"spaceToBatchND");const l=yt(i),u=[[0,0]];u.push(...o);for(let P=1+i.length;P<r.shape.length;++P)u.push([0,0]);const h=xL.kernelFunc({inputs:{x:r},backend:e,attrs:{paddings:u,constantValue:0}}),d=Op(h.shape,i,l,!1),p=Mp(d.length,i.length,!1),m=Fp(h.shape,i,l,!1),v=tn({inputs:{x:h},backend:e,attrs:{shape:d}}),E=Qs({inputs:{x:v},backend:e,attrs:{perm:p}}),O=tn({inputs:{x:E},backend:e,attrs:{shape:m}});return e.disposeIntermediateTensorInfo(h),e.disposeIntermediateTensorInfo(v),e.disposeIntermediateTensorInfo(E),O}const Cst={kernelName:lx,backendName:"cpu",kernelFunc:wst};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Sst(n){const{inputs:t,backend:e}=n,{indices:s,values:r,denseShape:i,defaultValue:o}=t;if(i.shape.length!==1)throw new Error(`Dense shape must be a vector, saw:
        ${i.shape}`);if(s.shape.length!==2)throw new Error(`Indices must be a matrix, saw:
        ${s.shape}`);if(r.shape.length!==1)throw new Error(`Values must be a vector, saw:
        ${r.shape}`);if(o.shape.length!==0)throw new Error(`Default value must be a scalar, saw:
        ${o.shape}`);const l=e.data.get(s.dataId).values,u=e.data.get(r.dataId).values,h=e.data.get(i.dataId).values,d=e.data.get(o.dataId).values[0],[p,m,y,x,v]=WF(l,s.shape,s.dtype,u,r.dtype,h,d);return[e.makeTensorInfo(m,s.dtype,p),e.makeTensorInfo([m[0]],r.dtype,y),e.makeTensorInfo([x.length],"bool",new Uint8Array(x.map(C=>Number(C)))),e.makeTensorInfo([v.length],s.dtype,new Int32Array(v))]}const Tst={kernelName:K$,backendName:"cpu",kernelFunc:Sst};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Est(n){const{inputs:t,backend:e}=n,{inputIndices:s,inputShape:r,newShape:i}=t;if(s.shape.length!==2)throw new Error(`Input indices should be a matrix but received shape
        ${s.shape}`);if(r.shape.length!==1)throw new Error(`Input shape should be a vector but received shape
        ${r.shape}`);if(i.shape.length!==1)throw new Error(`Target shape should be a vector but received shape ${i.shape}`);const o=Array.from(e.data.get(r.dataId).values),l=e.data.get(s.dataId).values,u=Array.from(e.data.get(i.dataId).values),[h,d,p]=HF(l,s.shape,s.dtype,o,u);return[e.makeTensorInfo(d,s.dtype,h),e.makeTensorInfo([p.length],i.dtype,new Int32Array(p))]}const Ist={kernelName:X$,backendName:"cpu",kernelFunc:Est};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function _st(n){const{inputs:t,backend:e}=n,{data:s,indices:r,segmentIds:i}=t;if(s.shape.length<1)throw new Error("Data should be at least 1 dimensional but received scalar");if(r.shape.length!==1)throw new Error(`Indices should be a vector but received shape
          ${r.shape}`);if(i.shape.length!==1)throw new Error(`Segment ids should be a vector but received shape
          ${i.shape}`);if(r.shape[0]!==i.shape[0])throw new Error("segmentIds and indices should have same size.");const o=e.data.get(s.dataId).values,l=e.data.get(r.dataId).values,u=e.data.get(i.dataId).values,[h,d]=PT(o,s.shape,s.dtype,l,u,!0);return e.makeTensorInfo(d,s.dtype,h)}const kst={kernelName:Y$,backendName:"cpu",kernelFunc:_st};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Ast(n){const{inputs:t,backend:e}=n,{data:s,indices:r,segmentIds:i}=t;if(s.shape.length<1)throw new Error("Data should be at least 1 dimensional but received scalar");if(r.shape.length!==1)throw new Error(`Indices should be a vector but received shape
         ${r.shape}`);if(i.shape.length!==1)throw new Error(`Segment ids should be a vector but received shape
         ${i.shape}`);if(r.shape[0]!==i.shape[0])throw new Error("segmentIds and indices should have same size.");const o=e.data.get(s.dataId).values,l=e.data.get(r.dataId).values,u=e.data.get(i.dataId).values,[h,d]=PT(o,s.shape,s.dtype,l,u);return e.makeTensorInfo(d,s.dtype,h)}const Nst={kernelName:Q$,backendName:"cpu",kernelFunc:Ast};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Rst(n){const{inputs:t,backend:e,attrs:s}=n,{sparseIndices:r,sparseValues:i,defaultValue:o}=t,{outputShape:l}=s,{sliceRank:u,numUpdates:h,sliceSize:d,strides:p,outputSize:m}=Su(i,r,l),y=!1,x=e.bufferSync(r);let v;switch(i.dtype){case"bool":{const C=e.bufferSync(i),S=!!e.data.get(o.dataId).values[0];v=Kl(x,C,l,m,d,h,u,p,S,y);break}case"float32":{const C=e.bufferSync(i),S=e.data.get(o.dataId).values[0];v=Kl(x,C,l,m,d,h,u,p,S,y);break}case"int32":{const C=e.bufferSync(i),S=e.data.get(o.dataId).values[0];v=Kl(x,C,l,m,d,h,u,p,S,y);break}case"string":{const C=e.bufferSync(i),S=Wa(e.data.get(o.dataId).values[0]);v=Kl(x,C,l,m,d,h,u,p,S,y);break}default:throw new Error(`Unsupported type ${i.dtype}`)}return e.makeTensorInfo(l,v.dtype,v.values)}const $st={kernelName:Z$,backendName:"cpu",kernelFunc:Rst};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Dst(n){const{inputs:t,backend:e,attrs:s}=n,{x:r}=t,{numOrSizeSplits:i,axis:o}=s,l=le(o,r.shape)[0],u=cT(r,i,l),h=new Array(r.shape.length).fill(0),d=r.shape.slice();return u.map(p=>{const m=[...d];m[l]=p;const y=fu({inputs:{x:r},backend:e,attrs:{begin:h,size:m}});return h[l]+=p,y})}const Ost={kernelName:ux,backendName:"cpu",kernelFunc:Dst};/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Mst={kernelName:tS,backendName:"cpu",kernelFunc:({inputs:n,backend:t})=>{const{x:e}=n,s=t;Ft(e,"square");const r=s.data.get(e.dataId).values,i=new Float32Array(r.length);for(let l=0;l<r.length;++l){const u=r[l];i[l]=u*u}return{dataId:s.write(i,e.shape,e.dtype),shape:e.shape,dtype:e.dtype}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Fst=Be(Ip,(n,t)=>{const e=t;return isNaN(n)?NaN:n>0?1:e.alpha}),Lst={kernelName:Ip,backendName:"cpu",kernelFunc:Fst};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Pst(n){const{inputs:t,backend:e,attrs:s}=n,{x:r}=t,{begin:i,end:o,strides:l,beginMask:u,endMask:h,ellipsisMask:d,newAxisMask:p,shrinkAxisMask:m}=s;Ft(r,"stridedSlice");const{finalShapeSparse:y,finalShape:x,isIdentity:v,sliceDim0:C,isSimpleSlice:S,begin:E,end:_,strides:I}=qS(r.shape,i,o,l,u,h,d,p,m);let O;if(v)O=tn({inputs:{x:r},backend:e,attrs:{shape:x}});else if(C||S){U(r.shape.length>=1,()=>`Input must have rank at least 1, got: ${r.shape.length}`);const P=GS(E,_,I),D=fu({inputs:{x:r},backend:e,attrs:{begin:E,size:P}});O=tn({inputs:{x:D},backend:e,attrs:{shape:x}}),e.disposeIntermediateTensorInfo(D)}else{const P=e.bufferSync(r),D=KF(y,P,I,E);O=e.makeTensorInfo(x,D.dtype,D.values)}return O}const Vst={kernelName:nS,backendName:"cpu",kernelFunc:Pst};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function zst(n){const{inputs:t,backend:e,attrs:s}=n,{separator:r,nGramWidths:i,leftPad:o,rightPad:l,padWidth:u,preserveShortSequences:h}=s,{data:d,dataSplits:p}=t,m=e.data.get(d.dataId).values,y=e.data.get(p.dataId).values,[x,v]=XF(m,y,r,i,o,l,u,h);return[e.makeTensorInfo([x.length],"string",x),e.makeTensorInfo(p.shape,"int32",v)]}const Bst={kernelName:J$,backendName:"cpu",kernelFunc:zst};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Ust(n){const{inputs:t,backend:e,attrs:s}=n,{skipEmpty:r}=s,{input:i,delimiter:o}=t;if(i.dtype!=="string")throw new Error("Input must be of datatype string");if(i.shape.length!==1)throw new Error(`Input must be a vector, got shape: ${i.shape}`);if(o.shape.length!==0)throw new Error(`Delimiter must be a scalar, got shape: ${o.shape}`);const l=e.data.get(i.dataId).values,u=e.data.get(o.dataId).values[0],[h,d,p]=YF(l,u,r),m=d.length;return[e.makeTensorInfo([m,2],"int32",h),e.makeTensorInfo([m],"string",d),e.makeTensorInfo([2],"int32",new Int32Array(p))]}const Gst={kernelName:tD,backendName:"cpu",kernelFunc:Ust};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Wst(n){const{inputs:t,backend:e,attrs:s}=n,{numBuckets:r}=s,{input:i}=t;if(i.dtype!=="string")throw new Error("Input must be of datatype string");if(r<=0)throw new Error("Number of buckets must be at least 1");const o=e.data.get(i.dataId).values,l=QF(o,r);return e.makeTensorInfo(i.shape,"int32",l)}const Hst={kernelName:eD,backendName:"cpu",kernelFunc:Wst};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const qst=Be(Sp,n=>Math.tan(n)),jst={kernelName:Sp,backendName:"cpu",kernelFunc:qst};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Kst=Be(Tp,n=>Math.tanh(n)),Xst={kernelName:Tp,backendName:"cpu",kernelFunc:Kst};/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Yst(n){const{inputs:t,backend:e}=n,{tensor:s,indices:r,updates:i}=t,{sliceRank:o,numUpdates:l,sliceSize:u,strides:h,outputSize:d}=Su(i,r,s.shape),p=!1,m=e.bufferSync(r),y=e.bufferSync(i),x=e.bufferSync(s),v=Kl(m,y,s.shape,d,u,l,o,h,x,p);return e.makeTensorInfo(s.shape,v.dtype,v.values)}const Qst={kernelName:q$,backendName:"cpu",kernelFunc:Yst};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Zst(n){const{inputs:t,backend:e,attrs:s}=n,{x:r}=t,{reps:i}=s;Ft(r,"tile");const o=JF(e.bufferSync(r),i);return e.makeTensorInfo(o.shape,o.dtype,o.values)}const Jst={kernelName:Ep,backendName:"cpu",kernelFunc:Zst};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function trt(n){const{inputs:t,backend:e,attrs:s}=n,{x:r}=t,{k:i,sorted:o}=s;Ft(r,"topk");const l=e.data.get(r.dataId).values,[u,h]=eL(l,r.shape,r.dtype,i,o);return[e.makeTensorInfo(u.shape,u.dtype,u.values),e.makeTensorInfo(h.shape,h.dtype,h.values)]}const ert={kernelName:sS,backendName:"cpu",kernelFunc:trt};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function nrt(n){const{inputs:t,attrs:e,backend:s}=n,{image:r,transforms:i}=t,{interpolation:o,fillMode:l,fillValue:u,outputShape:h}=e,[d,p,m,y]=r.shape,[x,v]=h??[p,m],C=[d,x,v,y],S=zt(r.shape),E=S[0],_=S[1],I=S[2],O=zt(C),P=O[0],D=O[1],N=O[2],R=Ss(r.dtype,yt(C));R.fill(u);const $=s.data.get(r.dataId).values,A=s.data.get(i.dataId).values;for(let L=0;L<d;++L){const nt=i.shape[0]===1?A:A.subarray(L*8,L*8+8);for(let Z=0;Z<x;++Z)for(let W=0;W<v;++W)for(let K=0;K<y;++K){let Y;const at=nt[6]*W+nt[7]*Z+1;if(at===0)continue;const B=(nt[0]*W+nt[1]*Z+nt[2])/at,j=(nt[3]*W+nt[4]*Z+nt[5])/at,st=jA(B,m,l),tt=jA(j,p,l);switch(o){case"nearest":Y=lrt($,p,m,E,_,I,L,tt,st,K,u);break;case"bilinear":Y=urt($,p,m,E,_,I,L,tt,st,K,u);break;default:throw new Error(`Error in Transform: Expect 'nearest' or 'bilinear', but got ${o}`)}const xt=L*P+Z*D+W*N+K;R[xt]=Y}return s.makeTensorInfo(C,r.dtype,R)}return{dataId:s.write(R,C,r.dtype),shape:r.shape,dtype:r.dtype}}const srt={kernelName:rS,backendName:"cpu",kernelFunc:nrt};function jA(n,t,e){switch(e){case"reflect":return rrt(n,t);case"wrap":return irt(n,t);case"nearest":return art(n,t);case"constant":default:return ort(n)}}function rrt(n,t){let e=n;if(e<0)if(t<=1)e=0;else{const s=2*t;e<s&&(e=s*Math.trunc(-e/s)+e),e=e<-t?e+s:-e-1}else if(e>t-1)if(t<=1)e=0;else{const s=2*t;e-=s*Math.trunc(e/s),e>=t&&(e=s-e-1)}return tu(0,e,t-1)}function irt(n,t){let e=n;if(e<0)if(t<=1)e=0;else{const s=t-1;e+=t*(Math.trunc(-e/s)+1)}else if(e>t-1)if(t<=1)e=0;else{const s=t-1;e-=t*Math.trunc(e/s)}return tu(0,e,t-1)}function ort(n,t){return n}function art(n,t){return tu(0,n,t-1)}function Wd(n,t,e,s,r,i,o,l,u,h,d){const p=o*s+l*r+u*i+h;return 0<=l&&l<t&&0<=u&&u<e?n[p]:d}function lrt(n,t,e,s,r,i,o,l,u,h,d){const p=Math.round(l),m=Math.round(u);return Wd(n,t,e,s,r,i,o,p,m,h,d)}function urt(n,t,e,s,r,i,o,l,u,h,d){const p=Math.floor(l),m=Math.floor(u),y=p+1,x=m+1,v=(x-u)*Wd(n,t,e,s,r,i,o,p,m,h,d)+(u-m)*Wd(n,t,e,s,r,i,o,p,x,h,d),C=(x-u)*Wd(n,t,e,s,r,i,o,y,m,h,d)+(u-m)*Wd(n,t,e,s,r,i,o,y,x,h,d);return(y-l)*v+(l-p)*C}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function crt(n){const{inputs:t,attrs:e,backend:s}=n,{axis:r}=e,{x:i}=t;Ft(i,"unique");const o=s.data.get(i.dataId).values,{outputValues:l,outputShape:u,indices:h}=nL(o,r,i.shape,i.dtype);return[s.makeTensorInfo(u,i.dtype,l),s.makeTensorInfo([h.length],"int32",h)]}const hrt={kernelName:iS,backendName:"cpu",kernelFunc:crt};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function drt(n){const{inputs:t,backend:e,attrs:s}=n,{value:r}=t;let{axis:i}=s;i<0&&(i+=r.shape.length);const o=r.shape.length,l=r.shape[i],u=new Array(o-1);let h=0;for(let y=0;y<o;y++)y!==i&&(u[h++]=r.shape[y]);const d=new Array(o).fill(0),p=r.shape.slice();p[i]=1;const m=new Array(l);for(let y=0;y<m.length;y++){d[i]=y;const x=fu({inputs:{x:r},backend:e,attrs:{begin:d,size:p}});m[y]=tn({inputs:{x},backend:e,attrs:{shape:u}}),e.disposeIntermediateTensorInfo(x)}return m}const frt={kernelName:hx,backendName:"cpu",kernelFunc:drt};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function prt(n){const{inputs:t,backend:e,attrs:s}=n,{x:r,segmentIds:i}=t,{numSegments:o}=s;Ft(r,"unsortedSegmentSum");const l=r.shape.length,u=i.shape.length,h=[],d=[],p=l-u;let m=i;for(let x=0;x<p;++x){const v=Wy({inputs:{input:m},backend:e,attrs:{dim:x+1}});m=v,d.push(v)}for(let x=0;x<o;++x){const v=Qa(x,"int32"),C=e.makeTensorInfo([],"int32",v),S=yF({inputs:{a:C,b:m},backend:e}),E=Xa({inputs:{x:S},backend:e,attrs:{dtype:"float32"}}),_=Fx({inputs:{a:E,b:r},backend:e}),I=Hp({inputs:{x:_},backend:e,attrs:{axis:0,keepDims:!1}});h.push(I),d.push(C),d.push(S),d.push(E),d.push(_),d.push(I)}const y=yL({inputs:h,backend:e,attrs:{axis:0}});return d.forEach(x=>e.disposeIntermediateTensorInfo(x)),y}const mrt={kernelName:dx,backendName:"cpu",kernelFunc:prt};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const grt=[lJ,UQ,cJ,dJ,KQ,pJ,gJ,xJ,vJ,CJ,TJ,IJ,kJ,RJ,DJ,FJ,PJ,zJ,UJ,oJ,WJ,qJ,KJ,YQ,YJ,qQ,ZQ,ZJ,GQ,ttt,ntt,stt,itt,att,utt,htt,ftt,mtt,ytt,btt,wtt,Stt,Ett,_tt,ktt,Ntt,$tt,Ott,Mtt,Ftt,Ltt,Vtt,Utt,JZ,Wtt,JQ,Ztt,tZ,Jtt,nZ,iet,oet,uet,rZ,oZ,het,fet,met,yet,lZ,cZ,WQ,bet,ett,wet,Tet,Iet,tJ,dZ,pZ,ket,gZ,Net,Det,Met,Pet,zet,Uet,Get,xZ,Het,jet,Xet,Qet,Jet,ent,snt,vZ,int,lnt,hnt,CZ,TZ,pnt,ynt,vnt,IZ,Cnt,Tnt,Ent,xL,Ant,nJ,AZ,Rnt,Dnt,Mnt,Lnt,HQ,Tw,Vnt,sJ,rJ,iJ,Bnt,Gnt,Hnt,jnt,Xnt,Ynt,Znt,LZ,tst,ist,ast,hst,VZ,fst,mst,yst,zZ,unt,vst,Cst,Tst,Ist,kst,Nst,$st,Ost,GZ,Mst,HZ,jZ,Lst,Vst,Bst,Gst,Hst,QZ,ztt,jst,Xst,Qst,Jst,ert,srt,_Z,hrt,frt,mrt,Snt];for(const n of grt)sD(n);/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Hl={},Ng={alpha:!1,antialias:!1,premultipliedAlpha:!1,preserveDrawingBuffer:!1,depth:!1,stencil:!1,failIfMajorPerformanceCaveat:!0};function yrt(n,t){Hl[n]=t}function pi(n,t){if(!(n in Hl)||t!=null){const s=brt(n,t);if(s!==null)Hl[n]=s;else return console.log("Could not get context for WebGL version",n),null}const e=Hl[n];return e==null||e.isContextLost()?(delete Hl[n],pi(n)):(e.disable(e.DEPTH_TEST),e.disable(e.STENCIL_TEST),e.disable(e.BLEND),e.disable(e.DITHER),e.disable(e.POLYGON_OFFSET_FILL),e.disable(e.SAMPLE_COVERAGE),e.enable(e.SCISSOR_TEST),e.enable(e.CULL_FACE),e.cullFace(e.BACK),Hl[n])}function xrt(n){if(!dt().getBool("IS_SAFARI")&&typeof OffscreenCanvas<"u"&&n===2)return new OffscreenCanvas(300,150);if(typeof document<"u")return document.createElement("canvas");throw new Error("Cannot create a canvas in this context")}function brt(n,t){if(n!==1&&n!==2)throw new Error("Cannot get WebGL rendering context, WebGL is disabled.");const e=t??xrt(n);return e.addEventListener("webglcontextlost",s=>{s.preventDefault(),delete Hl[n]},!1),dt().getBool("SOFTWARE_WEBGL_ENABLED")&&(Ng.failIfMajorPerformanceCaveat=!1),n===1?e.getContext("webgl",Ng)||e.getContext("experimental-webgl",Ng):e.getContext("webgl2",Ng)}/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */var vf;(function(n){n[n.DENSE=0]="DENSE",n[n.SHARED_BATCH=1]="SHARED_BATCH"})(vf||(vf={}));var wr;(function(n){n[n.RENDER=0]="RENDER",n[n.UPLOAD=1]="UPLOAD",n[n.PIXELS=2]="PIXELS",n[n.DOWNLOAD=3]="DOWNLOAD"})(wr||(wr={}));var ls;(function(n){n[n.UNPACKED_FLOAT16=0]="UNPACKED_FLOAT16",n[n.UNPACKED_FLOAT32=1]="UNPACKED_FLOAT32",n[n.PACKED_4X1_UNSIGNED_BYTE=2]="PACKED_4X1_UNSIGNED_BYTE",n[n.PACKED_2X2_FLOAT32=3]="PACKED_2X2_FLOAT32",n[n.PACKED_2X2_FLOAT16=4]="PACKED_2X2_FLOAT16"})(ls||(ls={}));function qp(n,t){return[t,n]}function vrt(n,t){return n*t}function Rg(n){const t=yt(n),e=Math.ceil(t/4);return qv(e)}function gh(n,t){return[Math.max(1,Math.ceil(t/2)),Math.max(1,Math.ceil(n/2))]}function wrt(n,t){const[e,s]=gh(n,t);return e*s*4}function GT(n,t){const e=n;let s,r,i,o,l,u,h,d,p,m;return dt().getNumber("WEBGL_VERSION")===2?(s=e.R32F,r=e.R16F,i=e.RGBA16F,o=e.RGBA32F,l=e.RED,h=4,d=1,p=e.HALF_FLOAT,m=e.FLOAT,u=e.RGBA8):(s=n.RGBA,r=n.RGBA,i=n.RGBA,o=e.RGBA,l=n.RGBA,h=4,d=4,p=t!=null?t.HALF_FLOAT_OES:null,m=n.FLOAT,u=n.RGBA),{internalFormatFloat:s,internalFormatHalfFloat:r,internalFormatPackedHalfFloat:i,internalFormatPackedFloat:o,textureFormatFloat:l,downloadTextureFormat:u,downloadUnpackNumChannels:h,defaultNumChannels:d,textureTypeHalfFloat:p,textureTypeFloat:m}}/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Dt(n,t){const e=t();return dt().getBool("DEBUG")&&Crt(n),e}function Crt(n){const t=n.getError();if(t!==n.NO_ERROR)throw new Error("WebGL Error: "+Irt(n,t))}const Srt=596e-10,Trt=65504;function Ert(n){return!!(dt().getBool("WEBGL_RENDER_FLOAT32_ENABLED")||n===0||Srt<Math.abs(n)&&Math.abs(n)<Trt)}function Irt(n,t){switch(t){case n.NO_ERROR:return"NO_ERROR";case n.INVALID_ENUM:return"INVALID_ENUM";case n.INVALID_VALUE:return"INVALID_VALUE";case n.INVALID_OPERATION:return"INVALID_OPERATION";case n.INVALID_FRAMEBUFFER_OPERATION:return"INVALID_FRAMEBUFFER_OPERATION";case n.OUT_OF_MEMORY:return"OUT_OF_MEMORY";case n.CONTEXT_LOST_WEBGL:return"CONTEXT_LOST_WEBGL";default:return`Unknown error code ${t}`}}function $g(n,t){return Ko(n,()=>n.getExtension(t),'Extension "'+t+'" not supported on this browser.')}function _rt(n,t){const e=Ko(n,()=>n.createShader(n.VERTEX_SHADER),"Unable to create vertex WebGLShader.");if(Dt(n,()=>n.shaderSource(e,t)),Dt(n,()=>n.compileShader(e)),n.getShaderParameter(e,n.COMPILE_STATUS)===!1)throw console.log(n.getShaderInfoLog(e)),new Error("Failed to compile vertex shader.");return e}function krt(n,t){const e=Ko(n,()=>n.createShader(n.FRAGMENT_SHADER),"Unable to create fragment WebGLShader.");if(Dt(n,()=>n.shaderSource(e,t)),Dt(n,()=>n.compileShader(e)),dt().get("ENGINE_COMPILE_ONLY"))return e;if(n.getShaderParameter(e,n.COMPILE_STATUS)===!1)throw bL(t,n.getShaderInfoLog(e)),new Error("Failed to compile fragment shader.");return e}const Art=/ERROR: [0-9]+:([0-9]+):/g;function bL(n,t){const e=Art.exec(t);if(e==null){console.log(`Couldn't parse line number in error: ${t}`),console.log(n);return}const s=+e[1],r=n.split(`
`),i=r.length.toString().length+2,o=r.map((p,m)=>$c((m+1).toString(),i)+p);let l=0;for(let p=0;p<o.length;p++)l=Math.max(o[p].length,l);const u=o.slice(0,s-1),h=o.slice(s-1,s),d=o.slice(s);console.log(u.join(`
`)),console.log(t.split(`
`)[0]),console.log(`%c ${$c(h[0],l)}`,"border:1px solid red; background-color:#e3d2d2; color:#a61717"),console.log(d.join(`
`))}function Nrt(n){return Ko(n,()=>n.createProgram(),"Unable to create WebGLProgram.")}function Rrt(n,t){if(Dt(n,()=>n.linkProgram(t)),!dt().get("ENGINE_COMPILE_ONLY")&&n.getProgramParameter(t,n.LINK_STATUS)===!1)throw console.log(n.getProgramInfoLog(t)),new Error("Failed to link vertex and fragment shaders.")}function mv(n,t){if(Dt(n,()=>n.validateProgram(t)),n.getProgramParameter(t,n.VALIDATE_STATUS)===!1)throw console.log(n.getProgramInfoLog(t)),new Error("Shader program validation failed.")}function $rt(n,t){const e=Ko(n,()=>n.createBuffer(),"Unable to create WebGLBuffer");return Dt(n,()=>n.bindBuffer(n.ARRAY_BUFFER,e)),Dt(n,()=>n.bufferData(n.ARRAY_BUFFER,t,n.STATIC_DRAW)),e}function Drt(n,t){const e=Ko(n,()=>n.createBuffer(),"Unable to create WebGLBuffer");return Dt(n,()=>n.bindBuffer(n.ELEMENT_ARRAY_BUFFER,e)),Dt(n,()=>n.bufferData(n.ELEMENT_ARRAY_BUFFER,t,n.STATIC_DRAW)),e}function Ort(n){return Ko(n,()=>n.createTexture(),"Unable to create WebGLTexture.")}function Mrt(n,t){const e=dt().getNumber("WEBGL_MAX_TEXTURE_SIZE");if(n<=0||t<=0){const s=`[${n}x${t}]`;throw new Error("Requested texture size "+s+" is invalid.")}if(n>e||t>e){const s=`[${n}x${t}]`,r=`[${e}x${e}]`;throw new Error("Requested texture size "+s+" greater than WebGL maximum on this browser / GPU "+r+".")}}function Frt(n){return Ko(n,()=>n.createFramebuffer(),"Unable to create WebGLFramebuffer.")}function KA(n,t,e,s,r,i,o){const l=n.getAttribLocation(t,e);return l===-1?!1:(Dt(n,()=>n.bindBuffer(n.ARRAY_BUFFER,s)),Dt(n,()=>n.vertexAttribPointer(l,r,n.FLOAT,!1,i,o)),Dt(n,()=>n.enableVertexAttribArray(l)),!0)}function Lrt(n,t,e){Urt(n,e),Dt(n,()=>n.activeTexture(n.TEXTURE0+e)),Dt(n,()=>n.bindTexture(n.TEXTURE_2D,t))}function Prt(n,t,e){return Ko(n,()=>n.getUniformLocation(t,e),'uniform "'+e+'" not present in program.')}function Vrt(n,t,e){return n.getUniformLocation(t,e)}function zrt(n,t,e,s){Dt(n,()=>Lrt(n,t,s)),Dt(n,()=>n.uniform1i(e,s))}function gv(n,t,e){Dt(n,()=>n.bindFramebuffer(n.FRAMEBUFFER,e)),Dt(n,()=>n.framebufferTexture2D(n.FRAMEBUFFER,n.COLOR_ATTACHMENT0,n.TEXTURE_2D,t,0))}function XA(n,t){Dt(n,()=>n.bindFramebuffer(n.FRAMEBUFFER,t)),Dt(n,()=>n.framebufferTexture2D(n.FRAMEBUFFER,n.COLOR_ATTACHMENT0,n.TEXTURE_2D,null,0))}function Dg(n){const t=n.checkFramebufferStatus(n.FRAMEBUFFER);if(t!==n.FRAMEBUFFER_COMPLETE)throw new Error("Error binding framebuffer: "+Brt(n,t))}function Brt(n,t){switch(t){case n.FRAMEBUFFER_INCOMPLETE_ATTACHMENT:return"FRAMEBUFFER_INCOMPLETE_ATTACHMENT";case n.FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT:return"FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT";case n.FRAMEBUFFER_INCOMPLETE_DIMENSIONS:return"FRAMEBUFFER_INCOMPLETE_DIMENSIONS";case n.FRAMEBUFFER_UNSUPPORTED:return"FRAMEBUFFER_UNSUPPORTED";default:return`unknown error ${t}`}}function Ko(n,t,e){const s=Dt(n,()=>t());if(s==null)throw new Error(e);return s}function Urt(n,t){const e=n.MAX_COMBINED_TEXTURE_IMAGE_UNITS-1,s=t+n.TEXTURE0;if(s<n.TEXTURE0||s>e){const r=`[gl.TEXTURE0, gl.TEXTURE${e}]`;throw new Error(`textureUnit must be in ${r}.`)}}function Jc(n,t=2){return yt(n.slice(0,n.length-t))}function th(n){if(n.length===0)throw Error("Cannot get rows and columns of an empty shape array.");return[n.length>1?n[n.length-2]:1,n[n.length-1]]}function Og(n){let t=[1,1,1];return n.length===0||n.length===1&&n[0]===1||(t=[Jc(n),...th(n)]),t}function Grt(n,t=!1){let e=dt().getNumber("WEBGL_MAX_TEXTURE_SIZE"),s=dt().getNumber("WEBGL_MAX_SIZE_FOR_NARROW_TEXTURE");s===1/0&&dt().getBool("WEBGL_AUTO_SQUARIFY_NARROW_TEXTURE_SHAPE")&&(s=e/2),t&&(e=e*2,s=s*2,n=n.map((l,u)=>u>=n.length-2?pC(n[u]):n[u]),n.length===1&&(n=[2,n[0]])),n.length!==2&&(n=Ya(n).newShape);let r=yt(n),i=null;n.length<=1&&r<=e?i=[1,r]:n.length===2&&n[0]<=e&&n[1]<=e?i=n:n.length===3&&n[0]*n[1]<=e&&n[2]<=e?i=[n[0]*n[1],n[2]]:n.length===3&&n[0]<=e&&n[1]*n[2]<=e?i=[n[0],n[1]*n[2]]:n.length===4&&n[0]*n[1]*n[2]<=e&&n[3]<=e?i=[n[0]*n[1]*n[2],n[3]]:n.length===4&&n[0]<=e&&n[1]*n[2]*n[3]<=e&&(i=[n[0],n[1]*n[2]*n[3]]);const o=i!=null&&Math.max(...i)>s&&Math.min(...i)<=(t?2:1)&&Math.min(...i)>0;if(i==null||o)if(t){const l=Jc(n);let u=2,h=2;n.length&&([u,h]=th(n)),r=l*(u/2)*(h/2),i=qv(r).map(d=>d*2)}else i=qv(r);return i}function Mg(n){return n%2===0}function qy(n,t){if(n=n.slice(-2),t=t.slice(-2),Oe(n,t)||!n.length||!t.length||n[0]===0||n[1]===0||t[0]===0||t[1]===0)return!0;if(n.length!==t.length){const e=n[n.length-1],s=t[t.length-1];if(e===s||Mg(e)&&Mg(s)&&(n[0]===1||t[0]===1))return!0}return n[1]===t[1]&&Mg(n[0])&&Mg(t[0])}let yv,xv;function Wrt(n){if(yv==null){const t=pi(n);yv=t.getParameter(t.MAX_TEXTURE_SIZE)}return yv}function Hrt(n){if(xv==null){const t=pi(n);xv=t.getParameter(t.MAX_TEXTURE_IMAGE_UNITS)}return Math.min(16,xv)}function qrt(n){if(n===0)return 0;let t;const e=pi(n);return Hr(e,"EXT_disjoint_timer_query_webgl2")&&n===2?t=2:Hr(e,"EXT_disjoint_timer_query")?t=1:t=0,t}function Hr(n,t){return n.getExtension(t)!=null}function YA(n){try{if(pi(n)!=null)return!0}catch(t){return console.log("Error when getting WebGL context: ",t),!1}return!1}function jrt(n){if(n===0)return!1;const t=pi(n);if(n===1){if(!Hr(t,"OES_texture_float"))return!1}else if(!Hr(t,"EXT_color_buffer_float"))return!1;return Iw(t)}function Krt(n){if(n===0)return!1;const t=pi(n);if(n===1){if(!Hr(t,"OES_texture_float")||!Hr(t,"WEBGL_color_buffer_float"))return!1}else{if(Hr(t,"EXT_color_buffer_float"))return Iw(t);const s="EXT_color_buffer_half_float";if(Hr(t,s)){const r=t.getExtension(s);return Xrt(t,r)}return!1}return Iw(t)}function Iw(n){const t=GT(n),e=n.createTexture();n.bindTexture(n.TEXTURE_2D,e),n.texImage2D(n.TEXTURE_2D,0,t.internalFormatFloat,1,1,0,t.textureFormatFloat,t.textureTypeFloat,null);const i=n.createFramebuffer();n.bindFramebuffer(n.FRAMEBUFFER,i),n.framebufferTexture2D(n.FRAMEBUFFER,n.COLOR_ATTACHMENT0,n.TEXTURE_2D,e,0);const o=n.checkFramebufferStatus(n.FRAMEBUFFER)===n.FRAMEBUFFER_COMPLETE;return n.bindTexture(n.TEXTURE_2D,null),n.bindFramebuffer(n.FRAMEBUFFER,null),n.deleteTexture(e),n.deleteFramebuffer(i),o}function Xrt(n,t){const e=GT(n,t),s=n.createTexture();n.bindTexture(n.TEXTURE_2D,s),n.texImage2D(n.TEXTURE_2D,0,e.internalFormatHalfFloat,1,1,0,e.textureFormatFloat,e.textureTypeHalfFloat,null);const o=n.createFramebuffer();n.bindFramebuffer(n.FRAMEBUFFER,o),n.framebufferTexture2D(n.FRAMEBUFFER,n.COLOR_ATTACHMENT0,n.TEXTURE_2D,s,0);const l=n.checkFramebufferStatus(n.FRAMEBUFFER)===n.FRAMEBUFFER_COMPLETE;return n.bindTexture(n.TEXTURE_2D,null),n.bindFramebuffer(n.FRAMEBUFFER,null),n.deleteTexture(s),n.deleteFramebuffer(o),l}function Yrt(n){return n!==2?!1:pi(n).fenceSync!=null}function jp(n,t){Array.isArray(n)||(n=[n]),n.forEach(e=>{e!=null&&U(e.dtype!=="complex64",()=>`${t} does not support complex64 tensors in the WebGL backend.`)})}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Vt=dt();Vt.registerFlag("HAS_WEBGL",()=>Vt.getNumber("WEBGL_VERSION")>0);Vt.registerFlag("WEBGL_VERSION",()=>YA(2)?2:YA(1)?1:0);Vt.registerFlag("WEBGL_CHECK_NUMERICAL_PROBLEMS",()=>!1);Vt.registerFlag("WEBGL_BUFFER_SUPPORTED",()=>Vt.get("WEBGL_VERSION")===2);Vt.registerFlag("WEBGL_CPU_FORWARD",()=>!0);Vt.registerFlag("WEBGL_FORCE_F16_TEXTURES",()=>!1);Vt.registerFlag("WEBGL_PACK",()=>Vt.getBool("HAS_WEBGL"));Vt.registerFlag("WEBGL_PACK_NORMALIZATION",()=>Vt.getBool("WEBGL_PACK"));Vt.registerFlag("WEBGL_PACK_CLIP",()=>Vt.getBool("WEBGL_PACK"));Vt.registerFlag("WEBGL_PACK_DEPTHWISECONV",()=>Vt.getBool("WEBGL_PACK"));Vt.registerFlag("WEBGL_PACK_BINARY_OPERATIONS",()=>Vt.getBool("WEBGL_PACK"));Vt.registerFlag("WEBGL_PACK_UNARY_OPERATIONS",()=>Vt.getBool("WEBGL_PACK"));Vt.registerFlag("WEBGL_PACK_ARRAY_OPERATIONS",()=>Vt.getBool("WEBGL_PACK"));Vt.registerFlag("WEBGL_PACK_IMAGE_OPERATIONS",()=>Vt.getBool("WEBGL_PACK"));Vt.registerFlag("WEBGL_PACK_REDUCE",()=>Vt.getBool("WEBGL_PACK"));Vt.registerFlag("WEBGL_LAZILY_UNPACK",()=>Vt.getBool("WEBGL_PACK"));Vt.registerFlag("WEBGL_CONV_IM2COL",()=>Vt.getBool("WEBGL_PACK"));Vt.registerFlag("WEBGL_PACK_CONV2DTRANSPOSE",()=>Vt.getBool("WEBGL_PACK"));Vt.registerFlag("WEBGL_MAX_TEXTURE_SIZE",()=>Wrt(Vt.getNumber("WEBGL_VERSION")));Vt.registerFlag("WEBGL_MAX_TEXTURES_IN_SHADER",()=>Hrt(Vt.getNumber("WEBGL_VERSION")));Vt.registerFlag("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION",()=>{const n=Vt.getNumber("WEBGL_VERSION");return n===0?0:qrt(n)});Vt.registerFlag("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE",()=>Vt.getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")>0&&!gD());Vt.registerFlag("WEBGL_RENDER_FLOAT32_CAPABLE",()=>jrt(Vt.getNumber("WEBGL_VERSION")));Vt.registerFlag("WEBGL_RENDER_FLOAT32_ENABLED",()=>Vt.getBool("WEBGL_FORCE_F16_TEXTURES")?!1:Vt.getBool("WEBGL_RENDER_FLOAT32_CAPABLE"));Vt.registerFlag("WEBGL_DOWNLOAD_FLOAT_ENABLED",()=>Krt(Vt.getNumber("WEBGL_VERSION")));Vt.registerFlag("WEBGL_FENCE_API_ENABLED",()=>Yrt(Vt.getNumber("WEBGL_VERSION")));Vt.registerFlag("WEBGL_SIZE_UPLOAD_UNIFORM",()=>Vt.getBool("WEBGL_RENDER_FLOAT32_ENABLED")?4:0);Vt.registerFlag("WEBGL_DELETE_TEXTURE_THRESHOLD",()=>-1,n=>{if(typeof n!="number")throw new Error(`WEBGL_DELETE_TEXTURE_THRESHOLD must be a number but got ${n}.`);if(n<0&&n!==-1)throw new Error(`WEBGL_DELETE_TEXTURE_THRESHOLD must be -1 (indicating never delete) or at least 0, but got ${n}.`)});Vt.registerFlag("WEBGL_FLUSH_THRESHOLD",()=>gD()?1:-1,n=>{if(typeof n!="number")throw new Error(`WEBGL_FLUSH_THRESHOLD must be a number but got ${n}.`);if(n<0&&n!==-1)throw new Error(`WEBGL_FLUSH_THRESHOLD must be -1 (indicating never manual flush) or at least 0, but got ${n}.`)});Vt.registerFlag("CPU_HANDOFF_SIZE_THRESHOLD",()=>128);Vt.registerFlag("WEBGL_USE_SHAPES_UNIFORMS",()=>!1);Vt.registerFlag("TOPK_LAST_DIM_CPU_HANDOFF_SIZE_THRESHOLD",()=>1e5);Vt.registerFlag("TOPK_K_CPU_HANDOFF_THRESHOLD",()=>128);Vt.registerFlag("WEBGL_EXP_CONV",()=>!1);Vt.registerFlag("SOFTWARE_WEBGL_ENABLED",()=>Vt.getBool("IS_TEST"));Vt.registerFlag("WEBGL_MAX_SIZE_FOR_NARROW_TEXTURE",()=>1/0);Vt.registerFlag("WEBGL_AUTO_SQUARIFY_NARROW_TEXTURE_SHAPE",()=>!1);Vt.registerFlag("WEBGL2_ISNAN_CUSTOM",()=>!1);Vt.registerFlag("ENGINE_COMPILE_ONLY",()=>!1);/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function zs(){let n,t,e,s,r,i,o,l,u,h;return dt().getNumber("WEBGL_VERSION")===2?(n="#version 300 es",t="in",e="out",s="in",r="texture",i="outputColor",o="out vec4 outputColor;",l=dt().getBool("WEBGL2_ISNAN_CUSTOM")?`
      bool isnan_custom(float val) {
        uint floatToUint = floatBitsToUint(val);
        return (floatToUint & 0x7fffffffu) > 0x7f800000u;
      }

      bvec4 isnan_custom(vec4 val) {
        return bvec4(isnan_custom(val.x),
          isnan_custom(val.y), isnan_custom(val.z), isnan_custom(val.w));
      }

      #define isnan(value) isnan_custom(value)
    `:"",u="",h=`
      #define round(value) newRound(value)
      int newRound(float value) {
        return int(floor(value + 0.5));
      }

      ivec4 newRound(vec4 value) {
        return ivec4(floor(value + vec4(0.5)));
      }
    `):(n="",t="attribute",e="varying",s="varying",r="texture2D",i="gl_FragColor",o="",l=`
      #define isnan(value) isnan_custom(value)
      bool isnan_custom(float val) {
        return (val > 0. || val < 1. || val == 0.) ? false : true;
      }
      bvec4 isnan_custom(vec4 val) {
        return bvec4(isnan(val.x), isnan(val.y), isnan(val.z), isnan(val.w));
      }
    `,u=`
      uniform float INFINITY;

      bool isinf(float val) {
        return abs(val) == INFINITY;
      }
      bvec4 isinf(vec4 val) {
        return equal(abs(val), vec4(INFINITY));
      }
    `,h=`
      int round(float value) {
        return int(floor(value + 0.5));
      }

      ivec4 round(vec4 value) {
        return ivec4(floor(value + vec4(0.5)));
      }
    `),{version:n,attribute:t,varyingVs:e,varyingFs:s,texture2D:r,output:i,defineOutput:o,defineSpecialNaN:l,defineSpecialInf:u,defineRound:h}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Iu(n,t,e="index"){const s=zt(t);return s.map((r,i)=>{const o=`int ${n[i]} = ${e} / ${r}`,l=i===s.length-1?`int ${n[i+1]} = ${e} - ${n[i]} * ${r}`:`index -= ${n[i]} * ${r}`;return`${o}; ${l};`}).join("")}function Lx(n,t,e="index"){const s=zt(t);return s.map((r,i)=>{const o=`int ${n[i]} = ${e} / outShapeStrides[${i}]`,l=i===s.length-1?`int ${n[i+1]} = ${e} - ${n[i]} * outShapeStrides[${i}]`:`index -= ${n[i]} * outShapeStrides[${i}]`;return`${o}; ${l};`}).join("")}function Qrt(n,t){const e=n.length,s=n.map(i=>`${t}[${i}]`),r=new Array(e-1);r[e-2]=s[e-1];for(let i=e-3;i>=0;--i)r[i]=`(${r[i+1]} * ${s[i+1]})`;return r}function Zrt(n,t,e="index"){const s=n.map((i,o)=>o),r=Qrt(s,t);return r.map((i,o)=>{const l=`int ${n[o]} = ${e} / ${r[o]}`,u=o===r.length-1?`int ${n[o+1]} = ${e} - ${n[o]} * ${r[o]}`:`index -= ${n[o]} * ${r[o]}`;return`${l}; ${u};`}).join("")}function WT(n){const t=zt(n).map(e=>e.toString());return`
  int getFlatIndex(ivec3 coords) {
    return coords.x * ${t[0]} + coords.y * ${t[1]} + coords.z;
  }
`}function HT(){return`
  int getFlatIndex(ivec3 coords) {
    return coords.x * outShapeStrides[0] + coords.y * outShapeStrides[1] + coords.z;
  }
`}const vL=`
  const float FLOAT_MAX = 1.70141184e38;
  const float FLOAT_MIN = 1.17549435e-38;

  lowp vec4 encode_float(highp float v) {
    if (isnan(v)) {
      return vec4(255, 255, 255, 255);
    }

    highp float av = abs(v);

    if(av < FLOAT_MIN) {
      return vec4(0.0, 0.0, 0.0, 0.0);
    } else if(v > FLOAT_MAX) {
      return vec4(0.0, 0.0, 128.0, 127.0) / 255.0;
    } else if(v < -FLOAT_MAX) {
      return vec4(0.0, 0.0,  128.0, 255.0) / 255.0;
    }

    highp vec4 c = vec4(0,0,0,0);

    highp float e = floor(log2(av));
    highp float m = exp2(fract(log2(av))) - 1.0;

    c[2] = floor(128.0 * m);
    m -= c[2] / 128.0;
    c[1] = floor(32768.0 * m);
    m -= c[1] / 32768.0;
    c[0] = floor(8388608.0 * m);

    highp float ebias = e + 127.0;
    c[3] = floor(ebias / 2.0);
    ebias -= c[3] * 2.0;
    c[2] += floor(ebias) * 128.0;

    c[3] += 128.0 * step(0.0, -v);

    return c / 255.0;
  }
`;/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const{getBroadcastDims:wL}=L7;function Jrt(n,t,e){const s=[];if(n.forEach(y=>{const x=yt(y.shapeInfo.logicalShape);if(y.shapeInfo.isUniform?s.push(`uniform float ${y.name}${x>1?`[${x}]`:""};`):(s.push(`uniform sampler2D ${y.name};`),s.push(`uniform int offset${y.name};`)),e.enableShapeUniforms){const{uniformShape:v}=qT(e.packedInputs,y.shapeInfo.logicalShape,y.shapeInfo.texShape);switch(v.length){case 1:s.push(`uniform int ${y.name}Shape;`);break;case 2:s.push(`uniform ivec2 ${y.name}Shape;`);break;case 3:s.push(`uniform ivec3 ${y.name}Shape;`);break;case 4:s.push(`uniform ivec4 ${y.name}Shape;`);break}s.push(`uniform ivec2 ${y.name}TexShape;`)}}),e.enableShapeUniforms){switch(t.logicalShape.length){case 1:s.push("uniform int outShape;");break;case 2:s.push("uniform ivec2 outShape;"),s.push("uniform int outShapeStrides;");break;case 3:s.push("uniform ivec3 outShape;"),s.push("uniform ivec2 outShapeStrides;");break;case 4:s.push("uniform ivec4 outShape;"),s.push("uniform ivec3 outShapeStrides;");break}s.push("uniform ivec2 outTexShape;")}e.customUniforms&&e.customUniforms.forEach(y=>{s.push(`uniform ${y.type} ${y.name}${y.arrayIndex?`[${y.arrayIndex}]`:""};`)});const r=s.join(`
`),i=n.map(y=>tit(y,t,e.packedInputs,e.enableShapeUniforms)).join(`
`),o=t.texShape,l=zs(),u=sit(l);let h,d,p=oit(l);return t.isPacked?(h=eit(t.logicalShape,o,e.enableShapeUniforms),d=iit(l)):(h=nit(t.logicalShape,o,e.enableShapeUniforms),d=rit(l)),e.packedInputs&&(p+=cit),[p,u,d,r,h,i,e.userCode].join(`
`)}function yh(n,t=!1){const e=n.shapeInfo.logicalShape;switch(e.length){case 0:return Cit(n,t);case 1:return Tit(n,t);case 2:return Iit(n,t);case 3:return kit(n,t);case 4:return Nit(n,t);case 5:return Rit(n);case 6:return $it(n);default:throw new Error(`${e.length}-D input sampling is not yet supported`)}}function CL(n,t){switch(n.shapeInfo.logicalShape.length){case 0:return wit(n);case 1:return Sit(n,t);case 2:return Eit(n,t);case 3:return _it(n,t);default:return Ait(n,t)}}function tit(n,t,e=!1,s){let r="";e?r+=CL(n,s):r+=yh(n,s);const i=n.shapeInfo.logicalShape,o=t.logicalShape;return i.length<=o.length&&(e?r+=Dit(n,t):r+=Oit(n,t)),r}function eit(n,t,e){switch(n.length){case 0:return SL();case 1:return hit(n,t,e);case 2:return bit(n,t,e);case 3:return fit(n,t,e);default:return mit(n,t,e)}}function nit(n,t,e){switch(n.length){case 0:return SL();case 1:return dit(n,t,e);case 2:return vit(n,t,e);case 3:return pit(n,t,e);case 4:return git(n,t,e);case 5:return yit(n,t);case 6:return xit(n,t);default:throw new Error(`${n.length}-D output sampling is not yet supported`)}}function sit(n){return`
    float sampleTexture(sampler2D textureSampler, vec2 uv) {
      return ${n.texture2D}(textureSampler, uv).r;
    }
  `}function rit(n){return`
    void setOutput(float val) {
      ${n.output} = vec4(val, 0, 0, 0);
    }
  `}function iit(n){return`
    void setOutput(vec4 val) {
      ${n.output} = val;
    }
  `}function oit(n){return`${n.version}
    precision highp float;
    precision highp int;
    precision highp sampler2D;
    ${n.varyingFs} vec2 resultUV;
    ${n.defineOutput}
    const vec2 halfCR = vec2(0.5, 0.5);

    struct ivec5
    {
      int x;
      int y;
      int z;
      int w;
      int u;
    };

    struct ivec6
    {
      int x;
      int y;
      int z;
      int w;
      int u;
      int v;
    };

    uniform float NAN;
    ${n.defineSpecialNaN}
    ${n.defineSpecialInf}
    ${n.defineRound}

    int imod(int x, int y) {
      return x - y * (x / y);
    }

    int idiv(int a, int b, float sign) {
      int res = a / b;
      int mod = imod(a, b);
      if (sign < 0. && mod != 0) {
        res -= 1;
      }
      return res;
    }

    //Based on the work of Dave Hoskins
    //https://www.shadertoy.com/view/4djSRW
    #define HASHSCALE1 443.8975
    float random(float seed){
      vec2 p = resultUV * seed;
      vec3 p3  = fract(vec3(p.xyx) * HASHSCALE1);
      p3 += dot(p3, p3.yzx + 19.19);
      return fract((p3.x + p3.y) * p3.z);
    }

    ${ait}
    ${lit}
    ${uit}
  `}const ait=`
vec2 uvFromFlat(int texNumR, int texNumC, int index) {
  int texR = index / texNumC;
  int texC = index - texR * texNumC;
  return (vec2(texC, texR) + halfCR) / vec2(texNumC, texNumR);
}
vec2 packedUVfrom1D(int texNumR, int texNumC, int index) {
  int texelIndex = index / 2;
  int texR = texelIndex / texNumC;
  int texC = texelIndex - texR * texNumC;
  return (vec2(texC, texR) + halfCR) / vec2(texNumC, texNumR);
}
`,lit=`
vec2 packedUVfrom2D(int texelsInLogicalRow, int texNumR,
  int texNumC, int row, int col) {
  int texelIndex = (row / 2) * texelsInLogicalRow + (col / 2);
  int texR = texelIndex / texNumC;
  int texC = texelIndex - texR * texNumC;
  return (vec2(texC, texR) + halfCR) / vec2(texNumC, texNumR);
}
`,uit=`
vec2 packedUVfrom3D(int texNumR, int texNumC,
    int texelsInBatch, int texelsInLogicalRow, int b,
    int row, int col) {
  int index = b * texelsInBatch + (row / 2) * texelsInLogicalRow + (col / 2);
  int texR = index / texNumC;
  int texC = index - texR * texNumC;
  return (vec2(texC, texR) + halfCR) / vec2(texNumC, texNumR);
}
`,cit=`
  float getChannel(vec4 frag, vec2 innerDims) {
    vec2 modCoord = mod(innerDims, 2.);
    return modCoord.x == 0. ?
      (modCoord.y == 0. ? frag.r : frag.g) :
      (modCoord.y == 0. ? frag.b : frag.a);
  }
  float getChannel(vec4 frag, int dim) {
    float modCoord = mod(float(dim), 2.);
    return modCoord == 0. ? frag.r : frag.g;
  }
`;function SL(){return`
    int getOutputCoords() {
      return 0;
    }
  `}function hit(n,t,e){const s=[Math.ceil(t[0]/2),Math.ceil(t[1]/2)];return s[0]===1?e?`
      int getOutputCoords() {
        return 2 * int(resultUV.x * ceil(float(outTexShape[1]) / 2.0));
      }
    `:`
      int getOutputCoords() {
        return 2 * int(resultUV.x * ${s[1]}.0);
      }
    `:s[1]===1?e?`
      int getOutputCoords() {
        return 2 * int(resultUV.y * ceil(float(outTexShape[0]) / 2.0));
      }
    `:`
      int getOutputCoords() {
        return 2 * int(resultUV.y * ${s[0]}.0);
      }
    `:e?`
    int getOutputCoords() {
      ivec2 packedTexShape = ivec2(ceil(float(outTexShape[0]) / 2.0), ceil(float(outTexShape[1]) / 2.0));
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(packedTexShape[0], packedTexShape[1]));
      return 2 * (resTexRC.x * packedTexShape[1] + resTexRC.y);
    }
  `:`
    int getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(${s[0]}, ${s[1]}));
      return 2 * (resTexRC.x * ${s[1]} + resTexRC.y);
    }
  `}function dit(n,t,e){return t[0]===1?e?`
      int getOutputCoords() {
        return int(resultUV.x * float(outTexShape[1]));
      }
    `:`
      int getOutputCoords() {
        return int(resultUV.x * ${t[1]}.0);
      }
    `:t[1]===1?e?`
      int getOutputCoords() {
        return int(resultUV.y * float(outTexShape[0]));
      }
    `:`
      int getOutputCoords() {
        return int(resultUV.y * ${t[0]}.0);
      }
    `:e?`
    int getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(outTexShape[0], outTexShape[1]));
      return resTexRC.x * outTexShape[1] + resTexRC.y;
    }
  `:`
    int getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(${t[0]}, ${t[1]}));
      return resTexRC.x * ${t[1]} + resTexRC.y;
    }
  `}function fit(n,t,e){if(e)return`
    ivec3 getOutputCoords() {
      ivec2 packedTexShape = ivec2(ceil(float(outTexShape[0]) / 2.0), ceil(float(outTexShape[1]) / 2.0));
      int texelsInLogicalRow = int(ceil(float(outShape[2]) / 2.0));
      int texelsInBatch = texelsInLogicalRow * int(ceil(float(outShape[1]) / 2.0));
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(packedTexShape[0], packedTexShape[1]));
      int index = resTexRC.x * packedTexShape[1] + resTexRC.y;

      int b = index / texelsInBatch;
      index -= b * texelsInBatch;

      int r = 2 * (index / texelsInLogicalRow);
      int c = imod(index, texelsInLogicalRow) * 2;

      return ivec3(b, r, c);
    }
  `;const s=[Math.ceil(t[0]/2),Math.ceil(t[1]/2)],r=Math.ceil(n[2]/2),i=r*Math.ceil(n[1]/2);return`
    ivec3 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(${s[0]}, ${s[1]}));
      int index = resTexRC.x * ${s[1]} + resTexRC.y;

      int b = index / ${i};
      index -= b * ${i};

      int r = 2 * (index / ${r});
      int c = imod(index, ${r}) * 2;

      return ivec3(b, r, c);
    }
  `}function pit(n,t,e){if(e)return`
  ivec3 getOutputCoords() {
    ivec2 resTexRC = ivec2(resultUV.yx *
                           vec2(outTexShape[0], outTexShape[1]));
    int index = resTexRC.x * outTexShape[1] + resTexRC.y;
    ${Lx(["r","c","d"],n)}
    return ivec3(r, c, d);
  }
`;const s=Iu(["r","c","d"],n);return`
    ivec3 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(${t[0]}, ${t[1]}));
      int index = resTexRC.x * ${t[1]} + resTexRC.y;
      ${s}
      return ivec3(r, c, d);
    }
  `}function mit(n,t,e){if(e)return`
    ivec4 getOutputCoords() {
      ivec2 packedTexShape = ivec2(ceil(float(outTexShape[0]) / 2.0), ceil(float(outTexShape[1]) / 2.0));
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(packedTexShape[0], packedTexShape[1]));
      int index = resTexRC.x * packedTexShape[1] + resTexRC.y;

      int texelsInLogicalRow = int(ceil(float(outShape[3]) / 2.0));
      int texelsInBatch = texelsInLogicalRow * int(ceil(float(outShape[2]) / 2.0));
      int texelsInBatchN = texelsInBatch * outShape[1];

      int b2 = index / texelsInBatchN;
      index -= b2 * texelsInBatchN;

      int b = index / texelsInBatch;
      index -= b * texelsInBatch;

      int r = 2 * (index / texelsInLogicalRow);
      int c = imod(index, texelsInLogicalRow) * 2;

      return ivec4(b2, b, r, c);
    }
  `;const s=[Math.ceil(t[0]/2),Math.ceil(t[1]/2)],r=Math.ceil(n[n.length-1]/2),i=r*Math.ceil(n[n.length-2]/2);let o=i,l="",u="b, r, c";for(let h=2;h<n.length-1;h++)o*=n[n.length-h-1],l=`
      int b${h} = index / ${o};
      index -= b${h} * ${o};
    `+l,u=`b${h}, `+u;return`
    ivec${n.length} getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(${s[0]}, ${s[1]}));
      int index = resTexRC.x * ${s[1]} + resTexRC.y;

      ${l}

      int b = index / ${i};
      index -= b * ${i};

      int r = 2 * (index / ${r});
      int c = imod(index, ${r}) * 2;

      return ivec${n.length}(${u});
    }
  `}function git(n,t,e){if(e)return`
    ivec4 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
        vec2(outTexShape[0], outTexShape[1]));
      int index = resTexRC.x * outTexShape[1] + resTexRC.y;
      ${Lx(["r","c","d","d2"],n)}
      return ivec4(r, c, d, d2);
    }
  `;const s=Iu(["r","c","d","d2"],n);return`
    ivec4 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
        vec2(${t[0]}, ${t[1]}));
      int index = resTexRC.x * ${t[1]} + resTexRC.y;
      ${s}
      return ivec4(r, c, d, d2);
    }
  `}function yit(n,t){const e=Iu(["r","c","d","d2","d3"],n);return`
    ivec5 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx * vec2(${t[0]},
                             ${t[1]}));

      int index = resTexRC.x * ${t[1]} + resTexRC.y;

      ${e}

      ivec5 outShape = ivec5(r, c, d, d2, d3);
      return outShape;
    }
  `}function xit(n,t){const e=Iu(["r","c","d","d2","d3","d4"],n);return`
    ivec6 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
        vec2(${t[0]}, ${t[1]}));
      int index = resTexRC.x * ${t[1]} + resTexRC.y;

      ${e}

      ivec6 result = ivec6(r, c, d, d2, d3, d4);
      return result;
    }
  `}function bit(n,t,e){const s=[Math.ceil(t[0]/2),Math.ceil(t[1]/2)];if(Oe(n,t))return e?`
      ivec2 getOutputCoords() {
        ivec2 packedTexShape = ivec2(ceil(float(outTexShape[0]) / 2.0), ceil(float(outTexShape[1]) / 2.0));
        return 2 * ivec2(resultUV.yx * vec2(packedTexShape[0], packedTexShape[1]));
      }
    `:`
      ivec2 getOutputCoords() {
        return 2 * ivec2(resultUV.yx * vec2(${s[0]}, ${s[1]}));
      }
    `;const r=Math.ceil(n[1]/2);return e?`
    ivec2 getOutputCoords() {
      ivec2 packedTexShape = ivec2(ceil(float(outTexShape[0]) / 2.0), ceil(float(outTexShape[1]) / 2.0));
      int texelsInLogicalRow = int(ceil(float(outShape[1]) / 2.0));
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(packedTexShape[0], packedTexShape[1]));

      int index = resTexRC.x * packedTexShape[1] + resTexRC.y;
      int r = 2 * (index / texelsInLogicalRow);
      int c = imod(index, texelsInLogicalRow) * 2;

      return ivec2(r, c);
    }
  `:`
    ivec2 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(${s[0]}, ${s[1]}));

      int index = resTexRC.x * ${s[1]} + resTexRC.y;
      int r = 2 * (index / ${r});
      int c = imod(index, ${r}) * 2;

      return ivec2(r, c);
    }
  `}function vit(n,t,e){return Oe(n,t)?e?`
      ivec2 getOutputCoords() {
        return ivec2(resultUV.yx * vec2(outTexShape[0], outTexShape[1]));
      }
    `:`
      ivec2 getOutputCoords() {
        return ivec2(resultUV.yx * vec2(${t[0]}, ${t[1]}));
      }
    `:n[1]===1?e?`
      ivec2 getOutputCoords() {
        ivec2 resTexRC = ivec2(resultUV.yx *
                               vec2(outTexShape[0], outTexShape[1]));
        int index = resTexRC.x * outTexShape[1] + resTexRC.y;
        return ivec2(index, 0);
      }
    `:`
      ivec2 getOutputCoords() {
        ivec2 resTexRC = ivec2(resultUV.yx *
                               vec2(${t[0]}, ${t[1]}));
        int index = resTexRC.x * ${t[1]} + resTexRC.y;
        return ivec2(index, 0);
      }
    `:n[0]===1?e?`
      ivec2 getOutputCoords() {
        ivec2 resTexRC = ivec2(resultUV.yx *
                               vec2(outTexShape[0], outTexShape[1]));
        int index = resTexRC.x * outTexShape[1] + resTexRC.y;
        return ivec2(0, index);
      }
    `:`
      ivec2 getOutputCoords() {
        ivec2 resTexRC = ivec2(resultUV.yx *
                               vec2(${t[0]}, ${t[1]}));
        int index = resTexRC.x * ${t[1]} + resTexRC.y;
        return ivec2(0, index);
      }
    `:e?`
    ivec2 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(outTexShape[0], outTexShape[1]));
      int index = resTexRC.x * outTexShape[1] + resTexRC.y;
      int r = index / outShape[1];
      int c = index - r * outShape[1];
      return ivec2(r, c);
    }
  `:`
    ivec2 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(${t[0]}, ${t[1]}));
      int index = resTexRC.x * ${t[1]} + resTexRC.y;
      int r = index / ${n[1]};
      int c = index - r * ${n[1]};
      return ivec2(r, c);
    }
  `}function _u(n){return`offset${n}`}function wit(n){const t=n.name,e="get"+t.charAt(0).toUpperCase()+t.slice(1),s=zs();return`
    vec4 ${e}() {
      return ${s.texture2D}(${t}, halfCR);
    }
  `}function Cit(n,t){const e=n.name,s="get"+e.charAt(0).toUpperCase()+e.slice(1);if(n.shapeInfo.isUniform)return`float ${s}() {return ${e};}`;const[r,i]=n.shapeInfo.texShape;if(r===1&&i===1)return`
      float ${s}() {
        return sampleTexture(${e}, halfCR);
      }
    `;const o=_u(e);if(t)return`
    float ${s}() {
      vec2 uv = uvFromFlat(${e}TexShape[0], ${e}TexShape[1], ${o});
      return sampleTexture(${e}, uv);
    }
  `;const[l,u]=n.shapeInfo.texShape;return`
    float ${s}() {
      vec2 uv = uvFromFlat(${l}, ${u}, ${o});
      return sampleTexture(${e}, uv);
    }
  `}function Sit(n,t){const e=n.name,s="get"+e.charAt(0).toUpperCase()+e.slice(1),r=n.shapeInfo.texShape,i=zs();if(t)return`
    vec4 ${s}(int index) {
      ivec2 packedTexShape = ivec2(ceil(float(${e}TexShape[0]) / 2.0), ceil(float(${e}TexShape[1]) / 2.0));
      vec2 uv = packedUVfrom1D(
        packedTexShape[0], packedTexShape[1], index);
      return ${i.texture2D}(${e}, uv);
    }
  `;const o=[Math.ceil(r[0]/2),Math.ceil(r[1]/2)];return`
    vec4 ${s}(int index) {
      vec2 uv = packedUVfrom1D(
        ${o[0]}, ${o[1]}, index);
      return ${i.texture2D}(${e}, uv);
    }
  `}function Tit(n,t){const e=n.name,s="get"+e.charAt(0).toUpperCase()+e.slice(1);if(n.shapeInfo.isUniform)return`
      float ${s}(int index) {
        ${xh(n)}
      }
    `;const r=n.shapeInfo.texShape,i=r[0],o=r[1];if(o===1&&i===1)return`
      float ${s}(int index) {
        return sampleTexture(${e}, halfCR);
      }
    `;const l=_u(e);return o===1?t?`
      float ${s}(int index) {
        vec2 uv = vec2(0.5, (float(index + ${l}) + 0.5) / float(${e}TexShape[0]));
        return sampleTexture(${e}, uv);
      }
    `:`
      float ${s}(int index) {
        vec2 uv = vec2(0.5, (float(index + ${l}) + 0.5) / ${i}.0);
        return sampleTexture(${e}, uv);
      }
    `:i===1?t?`
      float ${s}(int index) {
        vec2 uv = vec2((float(index + ${l}) + 0.5) / float(${e}TexShape[1]), 0.5);
        return sampleTexture(${e}, uv);
      }
    `:`
      float ${s}(int index) {
        vec2 uv = vec2((float(index + ${l}) + 0.5) / ${o}.0, 0.5);
        return sampleTexture(${e}, uv);
      }
    `:t?`
    float ${s}(int index) {
      vec2 uv = uvFromFlat(${e}TexShape[0], ${e}TexShape[1], index + ${l});
      return sampleTexture(${e}, uv);
    }
  `:`
    float ${s}(int index) {
      vec2 uv = uvFromFlat(${i}, ${o}, index + ${l});
      return sampleTexture(${e}, uv);
    }
  `}function Eit(n,t){const e=n.shapeInfo.logicalShape,s=n.name,r="get"+s.charAt(0).toUpperCase()+s.slice(1),i=n.shapeInfo.texShape,o=i[0],l=i[1],u=zs();if(i!=null&&Oe(e,i))return t?`
      vec4 ${r}(int row, int col) {
        vec2 uv = (vec2(col, row) + halfCR) / vec2(${s}TexShape[1], ${s}TexShape[0]);

        return ${u.texture2D}(${s}, uv);
      }
    `:`
      vec4 ${r}(int row, int col) {
        vec2 uv = (vec2(col, row) + halfCR) / vec2(${l}.0, ${o}.0);

        return ${u.texture2D}(${s}, uv);
      }
    `;if(t)return`
    vec4 ${r}(int row, int col) {
      ivec2 packedTexShape = ivec2(ceil(float(${s}TexShape[0]) / 2.0), ceil(float(${s}TexShape[1]) / 2.0));
      int valuesPerRow = int(ceil(float(${s}Shape[1]) / 2.0));
      vec2 uv = packedUVfrom2D(valuesPerRow, packedTexShape[0], packedTexShape[1], row, col);
      return ${u.texture2D}(${s}, uv);
    }
  `;const h=[Math.ceil(i[0]/2),Math.ceil(i[1]/2)],d=Math.ceil(e[1]/2);return`
    vec4 ${r}(int row, int col) {
      vec2 uv = packedUVfrom2D(${d}, ${h[0]}, ${h[1]}, row, col);
      return ${u.texture2D}(${s}, uv);
    }
  `}function Iit(n,t){const e=n.shapeInfo.logicalShape,s=n.name,r="get"+s.charAt(0).toUpperCase()+s.slice(1),i=n.shapeInfo.texShape;if(i!=null&&Oe(e,i)){if(t)return`
      float ${r}(int row, int col) {
        vec2 uv = (vec2(col, row) + halfCR) / vec2(${s}TexShape[1], ${s}TexShape[0]);
        return sampleTexture(${s}, uv);
      }
    `;const m=i[0],y=i[1];return`
    float ${r}(int row, int col) {
      vec2 uv = (vec2(col, row) + halfCR) / vec2(${y}.0, ${m}.0);
      return sampleTexture(${s}, uv);
    }
  `}const{newShape:o,keptDims:l}=Ya(e),u=o;if(u.length<e.length){const m=bh(n,u),y=["row","col"];return`
      ${yh(m,t)}
      float ${r}(int row, int col) {
        return ${r}(${vh(y,l)});
      }
    `}if(n.shapeInfo.isUniform)return`
      float ${r}(int row, int col) {
        int index = round(dot(vec2(row, col), vec2(${e[1]}, 1)));
        ${xh(n)}
      }
    `;const h=i[0],d=i[1],p=_u(s);return d===1?t?`
      float ${r}(int row, int col) {
        float index = dot(vec3(row, col, ${p}), vec3(${s}Shape[1], 1, 1));
        vec2 uv = vec2(0.5, (index + 0.5) / float(${s}TexShape[0]));
        return sampleTexture(${s}, uv);
      }
    `:`
    float ${r}(int row, int col) {
      float index = dot(vec3(row, col, ${p}), vec3(${e[1]}, 1, 1));
      vec2 uv = vec2(0.5, (index + 0.5) / ${h}.0);
      return sampleTexture(${s}, uv);
    }
  `:h===1?t?`
      float ${r}(int row, int col) {
        float index = dot(vec3(row, col, ${p}), vec3(${s}Shape[1], 1, 1));
        vec2 uv = vec2((index + 0.5) / float(${s}TexShape[1]), 0.5);
        return sampleTexture(${s}, uv);
      }
    `:`
    float ${r}(int row, int col) {
      float index = dot(vec3(row, col, ${p}), vec3(${e[1]}, 1, 1));
      vec2 uv = vec2((index + 0.5) / ${d}.0, 0.5);
      return sampleTexture(${s}, uv);
    }
  `:t?`
      float ${r}(int row, int col) {
        // Explicitly use integer operations as dot() only works on floats.
        int index = row * ${s}Shape[1] + col + ${p};
        vec2 uv = uvFromFlat(${s}TexShape[0], ${s}TexShape[1], index);
        return sampleTexture(${s}, uv);
      }
    `:`
  float ${r}(int row, int col) {
    // Explicitly use integer operations as dot() only works on floats.
    int index = row * ${e[1]} + col + ${p};
    vec2 uv = uvFromFlat(${h}, ${d}, index);
    return sampleTexture(${s}, uv);
  }
`}function _it(n,t){const e=n.shapeInfo.logicalShape,s=n.name,r="get"+s.charAt(0).toUpperCase()+s.slice(1),i=n.shapeInfo.texShape,o=[Math.ceil(i[0]/2),Math.ceil(i[1]/2)];if(e[0]===1){const m=e.slice(1),y=[1,2],x=bh(n,m),v=["b","row","col"];return`
        ${CL(x,t)}
        vec4 ${r}(int b, int row, int col) {
          return ${r}(${vh(v,y)});
        }
      `}const l=zs();if(t)return`
    vec4 ${r}(int b, int row, int col) {
      ivec2 packedTexShape = ivec2(ceil(float(${s}TexShape[0]) / 2.0), ceil(float(${s}TexShape[1]) / 2.0));
      int valuesPerRow = int(ceil(float(${s}Shape[2]) / 2.0));
      int texelsInBatch = valuesPerRow * int(ceil(float(${s}Shape[1]) / 2.0));
      vec2 uv = packedUVfrom3D(
        packedTexShape[0], packedTexShape[1], texelsInBatch, valuesPerRow, b, row, col);
      return ${l.texture2D}(${s}, uv);
    }
  `;const u=o[0],h=o[1],d=Math.ceil(e[2]/2),p=d*Math.ceil(e[1]/2);return`
    vec4 ${r}(int b, int row, int col) {
      vec2 uv = packedUVfrom3D(
        ${u}, ${h}, ${p}, ${d}, b, row, col);
      return ${l.texture2D}(${s}, uv);
    }
  `}function kit(n,t){const e=n.shapeInfo.logicalShape,s=n.name,r="get"+s.charAt(0).toUpperCase()+s.slice(1),i=e[1]*e[2],o=e[2],{newShape:l,keptDims:u}=Ya(e),h=l;if(h.length<e.length){const v=bh(n,h),C=["row","col","depth"];return`
        ${yh(v,t)}
        float ${r}(int row, int col, int depth) {
          return ${r}(${vh(C,u)});
        }
      `}if(n.shapeInfo.isUniform)return`
      float ${r}(int row, int col, int depth) {
        int index = round(dot(vec3(row, col, depth),
                          vec3(${i}, ${o}, 1)));
        ${xh(n)}
      }
    `;const d=n.shapeInfo.texShape,p=d[0],m=d[1],y=n.shapeInfo.flatOffset;if(m===i&&y==null)return t?`
      float ${r}(int row, int col, int depth) {
        int stride1 = ${s}Shape[2];
        float texR = float(row);
        float texC = dot(vec2(col, depth), vec2(stride1, 1));
        vec2 uv = (vec2(texC, texR) + halfCR) /
                   vec2(${s}TexShape[1], ${s}TexShape[0]);
        return sampleTexture(${s}, uv);
      }
    `:`
        float ${r}(int row, int col, int depth) {
          float texR = float(row);
          float texC = dot(vec2(col, depth), vec2(${o}, 1));
          vec2 uv = (vec2(texC, texR) + halfCR) /
                     vec2(${m}.0, ${p}.0);
          return sampleTexture(${s}, uv);
        }
      `;if(m===o&&y==null)return t?`
      float ${r}(int row, int col, int depth) {
        float texR = dot(vec2(row, col), vec2(${s}Shape[1], 1));
        float texC = float(depth);
        vec2 uv = (vec2(texC, texR) + halfCR) / vec2(${s}TexShape[1], ${s}TexShape[0]);
        return sampleTexture(${s}, uv);
      }
    `:`
    float ${r}(int row, int col, int depth) {
      float texR = dot(vec2(row, col), vec2(${e[1]}, 1));
      float texC = float(depth);
      vec2 uv = (vec2(texC, texR) + halfCR) / vec2(${m}.0, ${p}.0);
      return sampleTexture(${s}, uv);
    }
  `;const x=_u(s);return t?`
    float ${r}(int row, int col, int depth) {
      // Explicitly use integer operations as dot() only works on floats.
      int stride0 = ${s}Shape[1] * ${s}Shape[2];
      int stride1 = ${s}Shape[2];
      int index = row * stride0 + col * stride1 + depth + ${x};
      vec2 uv = uvFromFlat(${s}TexShape[0], ${s}TexShape[1], index);
      return sampleTexture(${s}, uv);
    }
    `:`
      float ${r}(int row, int col, int depth) {
        // Explicitly use integer operations as dot() only works on floats.
        int index = row * ${i} + col * ${o} + depth + ${x};
        vec2 uv = uvFromFlat(${p}, ${m}, index);
        return sampleTexture(${s}, uv);
      }
  `}function Ait(n,t){const e=n.name,s="get"+e.charAt(0).toUpperCase()+e.slice(1),r=zs();if(t)return`
    vec4 ${s}(int b2, int b, int row, int col) {
      int valuesPerRow = int(ceil(float(${e}Shape[3]) / 2.0));
      int texelsInBatch = valuesPerRow * int(ceil(float(${e}Shape[2]) / 2.0));
      int index = b * texelsInBatch + (row / 2) * valuesPerRow + (col / 2);
      texelsInBatch *= ${e}Shape[1];
      index = b2 * texelsInBatch + index;
      ivec2 packedTexShape = ivec2(ceil(float(${e}TexShape[0]) / 2.0), ceil(float(${e}TexShape[1]) / 2.0));
      int texR = index / packedTexShape[1];
      int texC = index - texR * packedTexShape[1];
      vec2 uv = (vec2(texC, texR) + halfCR) / vec2(packedTexShape[1], packedTexShape[0]); return ${r.texture2D}(${e}, uv);
    }
  `;const i=n.shapeInfo.logicalShape,o=i.length,l=n.shapeInfo.texShape,u=[Math.ceil(l[0]/2),Math.ceil(l[1]/2)],h=u[0],d=u[1],p=Math.ceil(i[o-1]/2);let m=p*Math.ceil(i[o-2]/2),y="int b, int row, int col",x=`b * ${m} + (row / 2) * ${p} + (col / 2)`;for(let v=2;v<o-1;v++)y=`int b${v}, `+y,m*=i[o-v-1],x=`b${v} * ${m} + `+x;return`
    vec4 ${s}(${y}) {
      int index = ${x};
      int texR = index / ${d};
      int texC = index - texR * ${d};
      vec2 uv = (vec2(texC, texR) + halfCR) / vec2(${d}, ${h});
      return ${r.texture2D}(${e}, uv);
    }
  `}function Nit(n,t){const e=n.shapeInfo.logicalShape,s=n.name,r="get"+s.charAt(0).toUpperCase()+s.slice(1),i=e[3],o=e[2]*i,l=e[1]*o,{newShape:u,keptDims:h}=Ya(e);if(u.length<e.length){const E=bh(n,u),_=["row","col","depth","depth2"];return`
      ${yh(E,t)}
      float ${r}(int row, int col, int depth, int depth2) {
        return ${r}(${vh(_,h)});
      }
    `}if(n.shapeInfo.isUniform)return`
      float ${r}(int row, int col, int depth, int depth2) {
        int index = round(dot(vec4(row, col, depth, depth2),
                          vec4(${l}, ${o}, ${i}, 1)));
        ${xh(n)}
      }
    `;const d=n.shapeInfo.flatOffset,p=n.shapeInfo.texShape,m=p[0],y=p[1],x=`int stride2 = ${s}Shape[3];`,v=`int stride1 = ${s}Shape[2] * stride2;`,C=`int stride0 = ${s}Shape[1] * stride1;`;if(y===l&&d==null)return t?`
      float ${r}(int row, int col, int depth, int depth2) {
        ${x}
        ${v}
        float texR = float(row);
        float texC =
            dot(vec3(col, depth, depth2),
                vec3(stride1, stride2, 1));
        vec2 uv = (vec2(texC, texR) + halfCR) /
                   vec2(${s}TexShape[1], ${s}TexShape[0]);
        return sampleTexture(${s}, uv);
      }
    `:`
      float ${r}(int row, int col, int depth, int depth2) {
        float texR = float(row);
        float texC =
            dot(vec3(col, depth, depth2),
                vec3(${o}, ${i}, 1));
        vec2 uv = (vec2(texC, texR) + halfCR) /
                   vec2(${y}.0, ${m}.0);
        return sampleTexture(${s}, uv);
      }
    `;if(y===i&&d==null)return t?`
      float ${r}(int row, int col, int depth, int depth2) {
        float texR = dot(vec3(row, col, depth),
                         vec3(${s}Shape[1] * ${s}Shape[2], ${s}Shape[2], 1));
        float texC = float(depth2);
        vec2 uv = (vec2(texC, texR) + halfCR) /
                  vec2(${s}TexShape[1], ${s}TexShape[0]);
        return sampleTexture(${s}, uv);
      }
    `:`
      float ${r}(int row, int col, int depth, int depth2) {
        float texR = dot(vec3(row, col, depth),
                         vec3(${e[1]*e[2]}, ${e[2]}, 1));
        float texC = float(depth2);
        vec2 uv = (vec2(texC, texR) + halfCR) /
                  vec2(${y}.0, ${m}.0);
        return sampleTexture(${s}, uv);
      }
    `;const S=_u(s);return t?`
    float ${r}(int row, int col, int depth, int depth2) {
      // Explicitly use integer operations as dot() only works on floats.
      ${x}
      ${v}
      ${C}
      int index = row * stride0 + col * stride1 +
          depth * stride2 + depth2;
      vec2 uv = uvFromFlat(${s}TexShape[0], ${s}TexShape[1], index + ${S});
      return sampleTexture(${s}, uv);
    }
  `:`
    float ${r}(int row, int col, int depth, int depth2) {
      // Explicitly use integer operations as dot() only works on floats.
      int index = row * ${l} + col * ${o} +
          depth * ${i} + depth2;
      vec2 uv = uvFromFlat(${m}, ${y}, index + ${S});
      return sampleTexture(${s}, uv);
    }
  `}function Rit(n){const t=n.shapeInfo.logicalShape,e=n.name,s="get"+e.charAt(0).toUpperCase()+e.slice(1),r=t[4],i=t[3]*r,o=t[2]*i,l=t[1]*o,{newShape:u,keptDims:h}=Ya(t);if(u.length<t.length){const v=bh(n,u),C=["row","col","depth","depth2","depth3"];return`
      ${yh(v)}
      float ${s}(int row, int col, int depth, int depth2, int depth3) {
        return ${s}(${vh(C,h)});
      }
    `}if(n.shapeInfo.isUniform)return`
      float ${s}(int row, int col, int depth, int depth2, int depth3) {
        float index = dot(
          vec4(row, col, depth, depth2),
          vec4(${l}, ${o}, ${i}, ${r})) +
          depth3;
        ${xh(n)}
      }
    `;const d=n.shapeInfo.flatOffset,p=n.shapeInfo.texShape,m=p[0],y=p[1];if(y===l&&d==null)return`
      float ${s}(int row, int col, int depth, int depth2, int depth3) {
        int texR = row;
        float texC = dot(vec4(col, depth, depth2, depth3),
                         vec4(${o}, ${i}, ${r}, 1));
        vec2 uv = (vec2(texC, texR) + halfCR) /
                   vec2(${y}.0, ${m}.0);
        return sampleTexture(${e}, uv);
      }
    `;if(y===r&&d==null)return`
      float ${s}(int row, int col, int depth, int depth2, int depth3) {
        float texR = dot(
          vec4(row, col, depth, depth2),
          vec4(${t[1]*t[2]*t[3]},
               ${t[2]*t[3]}, ${t[3]}, 1));
        int texC = depth3;
        vec2 uv = (vec2(texC, texR) + halfCR) /
                  vec2(${y}.0, ${m}.0);
        return sampleTexture(${e}, uv);
      }
    `;const x=_u(e);return`
    float ${s}(int row, int col, int depth, int depth2, int depth3) {
      // Explicitly use integer operations as dot() only works on floats.
      int index = row * ${l} + col * ${o} + depth * ${i} +
          depth2 * ${r} + depth3 + ${x};
      vec2 uv = uvFromFlat(${m}, ${y}, index);
      return sampleTexture(${e}, uv);
    }
  `}function $it(n){const t=n.shapeInfo.logicalShape,e=n.name,s="get"+e.charAt(0).toUpperCase()+e.slice(1),{newShape:r,keptDims:i}=Ya(t);if(r.length<t.length){const C=bh(n,r),S=["row","col","depth","depth2","depth3","depth4"];return`
      ${yh(C)}
      float ${s}(int row, int col, int depth,
                    int depth2, int depth3, int depth4) {
        return ${s}(${vh(S,i)});
      }
    `}const o=t[5],l=t[4]*o,u=t[3]*l,h=t[2]*u,d=t[1]*h;if(n.shapeInfo.isUniform)return`
      float ${s}(int row, int col, int depth,
                  int depth2, int depth3, int depth4) {
        int index = round(dot(
          vec4(row, col, depth, depth2),
          vec4(${d}, ${h}, ${u}, ${l})) +
          dot(
            vec2(depth3, depth4),
            vec2(${o}, 1)));
        ${xh(n)}
      }
    `;const p=n.shapeInfo.flatOffset,m=n.shapeInfo.texShape,y=m[0],x=m[1];if(x===d&&p==null)return`
      float ${s}(int row, int col, int depth,
                    int depth2, int depth3, int depth4) {
        int texR = row;
        float texC = dot(vec4(col, depth, depth2, depth3),
          vec4(${h}, ${u}, ${l}, ${o})) +
               float(depth4);
        vec2 uv = (vec2(texC, texR) + halfCR) /
                   vec2(${x}.0, ${y}.0);
        return sampleTexture(${e}, uv);
      }
    `;if(x===o&&p==null)return`
      float ${s}(int row, int col, int depth,
                    int depth2, int depth3, int depth4) {
        float texR = dot(vec4(row, col, depth, depth2),
          vec4(${t[1]*t[2]*t[3]*t[4]},
               ${t[2]*t[3]*t[4]},
               ${t[3]*t[4]},
               ${t[4]})) + float(depth3);
        int texC = depth4;
        vec2 uv = (vec2(texC, texR) + halfCR) /
                  vec2(${x}.0, ${y}.0);
        return sampleTexture(${e}, uv);
      }
    `;const v=_u(e);return`
    float ${s}(int row, int col, int depth,
                  int depth2, int depth3, int depth4) {
      // Explicitly use integer operations as dot() only works on floats.
      int index = row * ${d} + col * ${h} + depth * ${u} +
          depth2 * ${l} + depth3 * ${o} + depth4 + ${v};
      vec2 uv = uvFromFlat(${y}, ${x}, index);
      return sampleTexture(${e}, uv);
    }
  `}function xh(n){const t=n.name,e=yt(n.shapeInfo.logicalShape);return e<2?`return ${t};`:`
    for (int i = 0; i < ${e}; i++) {
      if (i == index) {
        return ${t}[i];
      }
    }
  `}function Dit(n,t){const e=n.name,s=e.charAt(0).toUpperCase()+e.slice(1),r="get"+s+"AtOutCoords",i=n.shapeInfo.logicalShape.length,o=t.logicalShape.length,l=wL(n.shapeInfo.logicalShape,t.logicalShape),u=He(o),h=o-i;let d;const p=["x","y","z","w","u","v"];i===0?d="":o<2&&l.length>=1?d="coords = 0;":d=l.map(E=>`coords.${p[E+h]} = 0;`).join(`
`);let m="";o<2&&i>0?m="coords":m=n.shapeInfo.logicalShape.map((E,_)=>`coords.${p[_+h]}`).join(", ");let y="return outputValue;";const v=yt(n.shapeInfo.logicalShape)===1,S=yt(t.logicalShape)===1;if(i===1&&!v&&!S)y=`
      return vec4(outputValue.xy, outputValue.xy);
    `;else if(v&&!S)o===1?y=`
        return vec4(outputValue.x, outputValue.x, 0., 0.);
      `:y=`
        return vec4(outputValue.x);
      `;else if(l.length){const E=i-2,_=i-1;l.indexOf(E)>-1&&l.indexOf(_)>-1?y="return vec4(outputValue.x);":l.indexOf(E)>-1?y="return vec4(outputValue.x, outputValue.y, outputValue.x, outputValue.y);":l.indexOf(_)>-1&&(y="return vec4(outputValue.xx, outputValue.zz);")}return`
    vec4 ${r}() {
      ${u} coords = getOutputCoords();
      ${d}
      vec4 outputValue = get${s}(${m});
      ${y}
    }
  `}function Oit(n,t){const e=n.name,s=e.charAt(0).toUpperCase()+e.slice(1),r="get"+s+"AtOutCoords",i=t.texShape,o=n.shapeInfo.texShape,l=n.shapeInfo.logicalShape.length,u=t.logicalShape.length;if(!n.shapeInfo.isUniform&&l===u&&n.shapeInfo.flatOffset==null&&Oe(o,i))return`
      float ${r}() {
        return sampleTexture(${e}, resultUV);
      }
    `;const h=He(u),d=wL(n.shapeInfo.logicalShape,t.logicalShape),p=u-l;let m;const y=["x","y","z","w","u","v"];l===0?m="":u<2&&d.length>=1?m="coords = 0;":m=d.map(v=>`coords.${y[v+p]} = 0;`).join(`
`);let x="";return u<2&&l>0?x="coords":x=n.shapeInfo.logicalShape.map((v,C)=>`coords.${y[C+p]}`).join(", "),`
    float ${r}() {
      ${h} coords = getOutputCoords();
      ${m}
      return get${s}(${x});
    }
  `}function He(n){if(n<=1)return"int";if(n===2)return"ivec2";if(n===3)return"ivec3";if(n===4)return"ivec4";if(n===5)return"ivec5";if(n===6)return"ivec6";throw Error(`GPU for rank ${n} is not yet supported`)}function qT(n,t,e){const{newShape:s,keptDims:r}=Ya(t),i=t.length,o=n&&i===3&&t[0]===1,l=o?t.slice(1):s,u=!n&&i>1&&!Oe(t,e)&&s.length<i||o;return{useSqueezeShape:u,uniformShape:u?l:t,keptDims:r}}function bh(n,t){const e=JSON.parse(JSON.stringify(n));return e.shapeInfo.logicalShape=t,e}function vh(n,t){return t.map(e=>n[e]).join(", ")}/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Mit(n,t,e,s){const r=e.map((d,p)=>{const m={logicalShape:d.shape,texShape:d.isUniform?null:d.texData.texShape,isUniform:d.isUniform,isPacked:d.isUniform?!1:d.texData.isPacked,flatOffset:null};return d.texData!=null&&d.texData.slice!=null&&d.texData.slice.flatOffset>0&&(m.flatOffset=d.texData.slice.flatOffset),{name:t.variableNames[p],shapeInfo:m}}),i=r.map(d=>d.shapeInfo),o={logicalShape:s.shape,texShape:s.texData.texShape,isUniform:!1,isPacked:s.texData.isPacked,flatOffset:null},l=Jrt(r,o,t),u=krt(n.gl,l),h=n.createProgram(u);return dt().get("ENGINE_COMPILE_ONLY")?{program:t,fragmentShader:u,source:l,webGLProgram:h,inShapeInfos:i,outShapeInfo:o,variablesLocations:null,customUniformLocations:null,infLoc:null,nanLoc:null,outShapeLocation:null,outShapeStridesLocation:null,outTexShapeLocation:null}:(n.buildVao(h),Object.assign({program:t,fragmentShader:u,source:l,webGLProgram:h,inShapeInfos:i,outShapeInfo:o},TL(n,t,h)))}function TL(n,t,e){const s=[],r=[];let i,o,l,u=null,h=null;h=n.getUniformLocation(e,"NAN",!1),dt().getNumber("WEBGL_VERSION")===1&&(u=n.getUniformLocation(e,"INFINITY",!1));const d=!1;for(const p of t.variableNames){const m={name:p,uniform:n.getUniformLocation(e,p,d),offset:n.getUniformLocation(e,`offset${p}`,d)};t.enableShapeUniforms&&(m.shape=n.getUniformLocation(e,`${p}Shape`,d),m.texShape=n.getUniformLocation(e,`${p}TexShape`,d)),s.push(m)}if(t.enableShapeUniforms&&(i=n.getUniformLocation(e,"outShape",d),l=n.getUniformLocation(e,"outShapeStrides",d),o=n.getUniformLocation(e,"outTexShape",d)),t.customUniforms)for(const p of t.customUniforms)r.push(n.getUniformLocation(e,p.name,d));return{variablesLocations:s,customUniformLocations:r,infLoc:u,nanLoc:h,outShapeLocation:i,outShapeStridesLocation:l,outTexShapeLocation:o}}function QA(n,t){if(n.length!==t.length)throw Error(`Binary was compiled with ${n.length} inputs, but was executed with ${t.length} inputs`);n.forEach((e,s)=>{const r=e.logicalShape,i=t[s],o=i.shape;if(!Oe(r,o))throw Error(`Binary was compiled with different shapes than the current args. Shapes ${r} and ${o} must match`);if(e.isUniform&&i.isUniform)return;const l=e.texShape,u=i.isUniform?null:i.texData.texShape;if(!Oe(l,u))throw Error(`Binary was compiled with different texture shapes than the current args. Shape ${l} and ${u} must match`)})}function Fit(n,t,e,s,r){t.program.enableShapeUniforms||(QA(t.inShapeInfos,e),QA([t.outShapeInfo],[s]));const i=s.texData.texture,o=s.texData.texShape;s.texData.isPacked?n.setOutputPackedMatrixTexture(i.texture,o[0],o[1]):n.setOutputMatrixTexture(i.texture,o[0],o[1]),n.setProgram(t.webGLProgram),n.bindVertexArray(t.webGLProgram.vao),dt().getNumber("WEBGL_VERSION")===1&&t.infLoc!==null&&n.gl.uniform1f(t.infLoc,1/0),t.nanLoc!==null&&n.gl.uniform1f(t.nanLoc,NaN);for(let u=0;u<e.length;++u){const h=e[u],{uniform:d,offset:p,shape:m,texShape:y}=t.variablesLocations[u];if(m){const{uniformShape:x}=qT(t.program.packedInputs,h.shape,h.texData.texShape);switch(x.length){case 1:n.gl.uniform1iv(m,new Int32Array(x));break;case 2:n.gl.uniform2iv(m,new Int32Array(x));break;case 3:n.gl.uniform3iv(m,new Int32Array(x));break;case 4:n.gl.uniform4iv(m,new Int32Array(x));break}}if(y&&n.gl.uniform2i(y,h.texData.texShape[0],h.texData.texShape[1]),d!=null){if(h.isUniform){if(yt(h.shape)<2)n.gl.uniform1f(d,h.uniformValues[0]);else{let x=h.uniformValues;x instanceof Float32Array||(x=new Float32Array(x)),n.gl.uniform1fv(d,x)}continue}h.texData.slice!=null&&p!=null&&n.gl.uniform1i(p,h.texData.slice.flatOffset),n.setInputMatrixTexture(h.texData.texture.texture,d,u)}}const l=t.outShapeLocation;if(l)switch(s.shape.length){case 1:n.gl.uniform1iv(l,new Int32Array(s.shape));break;case 2:n.gl.uniform2iv(l,new Int32Array(s.shape));break;case 3:n.gl.uniform3iv(l,new Int32Array(s.shape));break;case 4:n.gl.uniform4iv(l,new Int32Array(s.shape));break}if(t.outShapeStridesLocation){const u=zt(s.shape);switch(s.shape.length){case 2:n.gl.uniform1iv(t.outShapeStridesLocation,new Int32Array(u));break;case 3:n.gl.uniform2iv(t.outShapeStridesLocation,new Int32Array(u));break;case 4:n.gl.uniform3iv(t.outShapeStridesLocation,new Int32Array(u));break}}if(t.outTexShapeLocation&&n.gl.uniform2i(t.outTexShapeLocation,s.texData.texShape[0],s.texData.texShape[1]),t.program.customUniforms&&r)for(let u=0;u<t.program.customUniforms.length;++u){const h=t.program.customUniforms[u],d=t.customUniformLocations[u],p=r[u];if(h.type==="float")n.gl.uniform1fv(d,p);else if(h.type==="vec2")n.gl.uniform2fv(d,p);else if(h.type==="vec3")n.gl.uniform3fv(d,p);else if(h.type==="vec4")n.gl.uniform4fv(d,p);else if(h.type==="int")n.gl.uniform1iv(d,p);else if(h.type==="ivec2")n.gl.uniform2iv(d,p);else if(h.type==="ivec3")n.gl.uniform3iv(d,p);else if(h.type==="ivec4")n.gl.uniform4iv(d,p);else throw Error(`uniform type ${h.type} is not supported yet.`)}n.executeProgram()}function Lit(n,t,e){let s="";t.concat(e).forEach(o=>{const l=o.texData!=null&&o.texData.slice!=null&&o.texData.slice.flatOffset>0;if(n.enableShapeUniforms&&!o.isUniform){const u=o.texData.texShape,{useSqueezeShape:h,uniformShape:d,keptDims:p}=qT(n.packedInputs,o.shape,u);let m="",y="",x="";if(d.length===1&&n.packedInputs){const O=[Math.ceil(u[0]/2),Math.ceil(u[1]/2)];m=`${O[0]>1}_${O[1]>1}`}else if(d.length===2&&!n.packedInputs)y=`${d[0]>1}_${d[1]>1}`;else if(d.length>2&&!n.packedInputs){const O=zt(d);x=`${O[0]===u[1]}_${O[O.length-1]===u[1]}`}const v=o.shape.length,C=d.length===2&&Oe(o.shape,u),S=yt(o.shape)===1,E=jc(o.shape,e.shape),_=!n.packedInputs&&v===e.shape.length&&Oe(u,e.texData.texShape),I=n.packedInputs||d.length>2?"":`${u[0]>1}_${u[1]>1}`;s+=`${v}_${_}_${h?p:""}_${d.length}_${S}_${E}_${C}_${m}_${y}_${x}_${I}_${l}`}else{const u=o.isUniform?"uniform":o.texData.texShape;s+=`${o.shape}_${u}_${l}`}});const r=n.userCode;let i=n.constructor.name;return i+="_"+s+"_"+r+`${dt().getNumber("WEBGL_VERSION")}`,i}function ks(n){return dt().getBool("WEBGL_USE_SHAPES_UNIFORMS")&&n<=4}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Pit{constructor(t){this.variableNames=["A"],this.packedInputs=!1,this.packedOutput=!0,this.outPackingScheme=vf.DENSE,this.customUniforms=[{name:"texShape",type:"ivec2"}];const e=zs();this.outputShape=t,this.enableShapeUniforms=ks(this.outputShape.length),this.userCode=`
      ivec3 outCoordsFromFlatIndex(int index) {
        ${this.enableShapeUniforms?Lx(["r","c","d"],t):Iu(["r","c","d"],t)}
        return ivec3(r, c, d);
      }

      void main() {
        ivec2 resTexRC = ivec2(resultUV.yx * vec2(texShape[0], texShape[1]));
        int index = 4 * (resTexRC.x * texShape[1] + resTexRC.y);

        vec4 result = vec4(0.);

        for (int i=0; i<4; i++) {
          int flatIndex = index + i;
          ivec3 rc = outCoordsFromFlatIndex(flatIndex);
          result[i] = getA(rc.x, rc.y, rc.z);
        }

        ${e.output} = result;
      }
    `}}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Vit{constructor(t){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outPackingScheme=vf.DENSE,this.customUniforms=[{name:"texShape",type:"ivec2"}];const e=zs();this.outputShape=t,this.enableShapeUniforms=ks(this.outputShape.length),this.userCode=`
      ivec3 outCoordsFromFlatIndex(int index) {
        ${this.enableShapeUniforms?Lx(["r","c","d"],t):Iu(["r","c","d"],t)}
        return ivec3(r, c, d);
      }

      void main() {
        ivec2 resTexRC = ivec2(resultUV.yx * vec2(texShape[0], texShape[1]));
        int index = 4 * (resTexRC.x * texShape[1] + resTexRC.y);

        vec4 result = vec4(0.);

        for (int i=0; i<4; i++) {
          int flatIndex = index + i;
          ivec3 rc = outCoordsFromFlatIndex(flatIndex);
          result[i] = getChannel(getA(rc.x, rc.y, rc.z), vec2(rc.y, rc.z));
        }

        ${e.output} = result;
      }
    `}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class zit{constructor(t){this.variableNames=["A"],this.outTexUsage=wr.DOWNLOAD;const e=zs();this.outputShape=t,this.userCode=`
      ${vL}

      void main() {
        float x = getAAtOutCoords();
        ${e.output} = encode_float(x);
      }
    `}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Bit{constructor(t){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!1,this.outTexUsage=wr.DOWNLOAD;const e=zs();this.outputShape=t,this.userCode=`
      ${vL}

      void main() {
        ivec3 coords = getOutputCoords();
        float x = getChannel(getAAtOutCoords(), vec2(coords.y, coords.z));
        ${e.output} = encode_float(x);
      }
    `}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Uit={R:0,G:1,B:2,A:3};class ZA{constructor(t,e=!1,s="RGBA"){this.variableNames=["A"],this.customUniforms=[{name:"texShape",type:"ivec2"}];const r=zs();this.outputShape=t,this.enableShapeUniforms=ks(this.outputShape.length);let i="result";e&&(i="floor(result * 255. + 0.5)");let o="";for(let l=0;l<s.length;l++){const u=s[l];o+=`
          if(offset == ${l}) {
            result = values[${Uit[u]}];
          }`}this.userCode=`
      ${this.enableShapeUniforms?HT():WT(t)}

      void main() {
        ivec3 coords = getOutputCoords();
        int flatIndex = getFlatIndex(coords);
        float result = 0.;
        int offset = imod(flatIndex, ${s.length});

        flatIndex = idiv(flatIndex, ${s.length}, 1.);

        int r = flatIndex / texShape[1];
        if (r < texShape[0]) {
          int c = imod(flatIndex, texShape[1]);
          vec2 uv = (vec2(c, r) + halfCR) / vec2(texShape[1], texShape[0]);
          vec4 values = ${r.texture2D}(A, uv);
          ${o}
        }
        ${r.output} = vec4(${i}, 0., 0., 0.);
      }
    `}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Git{constructor(t,e=!1){this.variableNames=["A"],this.packedInputs=!1,this.packedOutput=!0,this.customUniforms=[{name:"texShape",type:"ivec2"}];const s=zs();this.outputShape=t,this.enableShapeUniforms=ks(this.outputShape.length);let r="",i="result";e&&(i="floor(result * 255. + 0.5)");for(let o=0;o<=1;o++)for(let l=0;l<=1;l++){const u=o*2+l;r+=`
          localCoords = coords;
          if(localCoords[2] + ${l} < ${this.enableShapeUniforms?"outShape[2]":`${t[2]}`}) {
          localCoords[2] += ${l};
          if (localCoords[1] + ${o} < ${this.enableShapeUniforms?"outShape[1]":`${t[1]}`}) {
            localCoords[1] += ${o};

            flatIndex = getFlatIndex(localCoords);
            offset = imod(flatIndex, 4);

            flatIndex = idiv(flatIndex, 4, 1.);

            int r = flatIndex / texShape[1];
            int c = imod(flatIndex, texShape[1]);
            vec2 uv = (vec2(c, r) + halfCR) / vec2(texShape[1], texShape[0]);
            values = ${s.texture2D}(A, uv);

            if (offset == 0) {
              result[${u}] = values[0];
            } else if (offset == 1) {
              result[${u}] = values[1];
            } else if (offset == 2) {
              result[${u}] = values[2];
            } else {
              result[${u}] = values[3];
            }
          }
        }
        `}this.userCode=`
        ${this.enableShapeUniforms?HT():WT(t)}

        void main() {
          ivec3 coords = getOutputCoords();

          vec4 result = vec4(0.);
          int flatIndex, r, c, offset;
          ivec3 localCoords;
          vec2 uv;
          vec4 values;

          ${r}

          ${s.output} = ${i};
        }
    `}}/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Wit(n){const t=zs(),e=`${t.version}
    precision highp float;
    ${t.attribute} vec3 clipSpacePos;
    ${t.attribute} vec2 uv;
    ${t.varyingVs} vec2 resultUV;

    void main() {
      gl_Position = vec4(clipSpacePos, 1);
      resultUV = uv;
    }`;return _rt(n,e)}function Hit(n){const t=new Float32Array([-1,1,0,0,1,-1,-1,0,0,0,1,1,0,1,1,1,-1,0,1,0]);return $rt(n,t)}function qit(n){const t=new Uint16Array([0,1,2,2,1,3]);return Drt(n,t)}function Kp(n,t,e,s,r,i){Mrt(t,e);const o=Ort(n),l=n.TEXTURE_2D;return Dt(n,()=>n.bindTexture(l,o)),Dt(n,()=>n.texParameteri(l,n.TEXTURE_WRAP_S,n.CLAMP_TO_EDGE)),Dt(n,()=>n.texParameteri(l,n.TEXTURE_WRAP_T,n.CLAMP_TO_EDGE)),Dt(n,()=>n.texParameteri(l,n.TEXTURE_MIN_FILTER,n.NEAREST)),Dt(n,()=>n.texParameteri(l,n.TEXTURE_MAG_FILTER,n.NEAREST)),dt().getNumber("WEBGL_VERSION")===1?Dt(n,()=>n.texImage2D(l,0,s,t,e,0,r,i,null)):Dt(n,()=>n.texStorage2D(l,1,s,t,e)),Dt(n,()=>n.bindTexture(n.TEXTURE_2D,null)),{texture:o,texShape:[e,t]}}function EL(n){return n.internalFormatFloat}function jit(n,t,e,s){const[r,i]=qp(t,e);return Kp(n,r,i,EL(s),s.textureFormatFloat,n.FLOAT)}function IL(n){return n.internalFormatHalfFloat}function Kit(n,t,e,s){const[r,i]=qp(t,e);return Kp(n,r,i,IL(s),s.textureFormatFloat,s.textureTypeHalfFloat)}function _L(n){return n.downloadTextureFormat}function Xit(n,t,e,s){const[r,i]=qp(t,e);return Kp(n,r,i,_L(s),n.RGBA,n.UNSIGNED_BYTE)}function kL(n){return n.internalFormatPackedFloat}function Yit(n,t,e,s){const[r,i]=gh(t,e);return Kp(n,r,i,kL(s),n.RGBA,n.FLOAT)}function AL(n){return n.internalFormatPackedHalfFloat}function Qit(n,t,e,s){const[r,i]=gh(t,e);return Kp(n,r,i,AL(s),n.RGBA,s.textureTypeHalfFloat)}function Zit(n,t,e){return Dt(n,()=>n.bindBuffer(n.ARRAY_BUFFER,e)),KA(n,t,"clipSpacePos",e,3,20,0)&&KA(n,t,"uv",e,2,20,12)}function Jit(n,t,e,s,r,i){Dt(n,()=>n.bindTexture(n.TEXTURE_2D,t));let o,l,u;r instanceof Uint8Array?(o=new Uint8Array(e*s*4),l=n.UNSIGNED_BYTE,u=n.RGBA):(o=new Float32Array(e*s*4),l=n.FLOAT,u=i.internalFormatPackedFloat),o.set(r),dt().getNumber("WEBGL_VERSION")===2?Dt(n,()=>n.texSubImage2D(n.TEXTURE_2D,0,0,0,e,s,n.RGBA,l,o)):Dt(n,()=>n.texImage2D(n.TEXTURE_2D,0,u,e,s,0,n.RGBA,l,o)),Dt(n,()=>n.bindTexture(n.TEXTURE_2D,null))}function tot(n,t,e){Dt(n,()=>n.bindTexture(n.TEXTURE_2D,t)),e.data instanceof Uint8Array?dt().getNumber("WEBGL_VERSION")===2?Dt(n,()=>n.texSubImage2D(n.TEXTURE_2D,0,0,0,e.width,e.height,n.RGBA,n.UNSIGNED_BYTE,e.data)):Dt(n,()=>n.texImage2D(n.TEXTURE_2D,0,n.RGBA,e.width,e.height,0,n.RGBA,n.UNSIGNED_BYTE,e.data)):dt().getNumber("WEBGL_VERSION")===2?Dt(n,()=>n.texSubImage2D(n.TEXTURE_2D,0,0,0,n.RGBA,n.UNSIGNED_BYTE,e)):Dt(n,()=>n.texImage2D(n.TEXTURE_2D,0,n.RGBA,n.RGBA,n.UNSIGNED_BYTE,e)),Dt(n,()=>n.bindTexture(n.TEXTURE_2D,null))}function eot(n,t,e,s){const r=n.createBuffer();Dt(n,()=>n.bindBuffer(n.PIXEL_PACK_BUFFER,r));const l=4*4*t*e;return Dt(n,()=>n.bufferData(n.PIXEL_PACK_BUFFER,l,n.STREAM_READ)),Dt(n,()=>n.readPixels(0,0,e,t,n.RGBA,n.FLOAT,0)),Dt(n,()=>n.bindBuffer(n.PIXEL_PACK_BUFFER,null)),r}function not(n,t,e){const s=n,r=new Float32Array(e);return s.bindBuffer(s.PIXEL_PACK_BUFFER,t),s.getBufferSubData(s.PIXEL_PACK_BUFFER,0,r),s.bindBuffer(s.PIXEL_PACK_BUFFER,null),r}function sot(n,t,e,s){const[r,i]=qp(t,e),o=4,l=new Uint8Array(vrt(t*e,o));return Dt(n,()=>n.readPixels(0,0,r,i,s.downloadTextureFormat,n.UNSIGNED_BYTE,l)),new Float32Array(l.buffer)}function rot(n,t,e,s,r,i,o,l){const u=n,h=new Float32Array(wrt(i,o));return u.bindBuffer(u.PIXEL_PACK_BUFFER,t),u.getBufferSubData(u.PIXEL_PACK_BUFFER,0,h),u.bindBuffer(u.PIXEL_PACK_BUFFER,null),h}function iot(n,t,e){const s=new Float32Array(t*e*4);return Dt(n,()=>n.readPixels(0,0,e,t,n.RGBA,n.FLOAT,s)),s}/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class bv{constructor(t){this.outputTexture=null,this.program=null,this.disposed=!1,this.itemsToPoll=[];const e=dt().getNumber("WEBGL_VERSION");if(t!=null?(this.gl=t,yrt(e,t)):this.gl=pi(e),t=this.gl,dt().getNumber("WEBGL_VERSION")===2){const i=t;this.createVertexArray=()=>Dt(i,()=>i.createVertexArray()),this.bindVertexArray=o=>Dt(i,()=>i.bindVertexArray(o)),this.deleteVertexArray=o=>Dt(i,()=>i.deleteVertexArray(o)),this.getVertexArray=()=>Dt(i,()=>i.getParameter(i.VERTEX_ARRAY_BINDING))}else if(t!=null){const i=t.getExtension("OES_vertex_array_object");if(i==null)throw new Error("All WebGL1 implementations are expected to offer OES_vertex_array_object.");this.createVertexArray=()=>Dt(t,()=>i.createVertexArrayOES()),this.bindVertexArray=o=>Dt(t,()=>i.bindVertexArrayOES(o)),this.deleteVertexArray=o=>Dt(t,()=>i.deleteVertexArrayOES(o)),this.getVertexArray=()=>Dt(t,()=>t.getParameter(i.VERTEX_ARRAY_BINDING_OES))}let s="WEBGL_color_buffer_float";const r="EXT_color_buffer_half_float";if(this.parallelCompilationExtension=this.gl.getExtension("KHR_parallel_shader_compile"),dt().getNumber("WEBGL_VERSION")===1){const i="OES_texture_float",o="OES_texture_half_float";if(this.textureFloatExtension=$g(this.gl,i),Hr(this.gl,o))this.textureHalfFloatExtension=$g(this.gl,o);else if(dt().get("WEBGL_FORCE_F16_TEXTURES"))throw new Error("GL context does not support half float textures, yet the environment flag WEBGL_FORCE_F16_TEXTURES is set to true.");if(this.colorBufferFloatExtension=this.gl.getExtension(s),Hr(this.gl,r))this.colorBufferHalfFloatExtension=$g(this.gl,r);else if(dt().get("WEBGL_FORCE_F16_TEXTURES"))throw new Error("GL context does not support color renderable half floats, yet the environment flag WEBGL_FORCE_F16_TEXTURES is set to true.")}else if(s="EXT_color_buffer_float",Hr(this.gl,s))this.colorBufferFloatExtension=this.gl.getExtension(s);else if(Hr(this.gl,r))this.colorBufferHalfFloatExtension=this.gl.getExtension(r);else throw new Error("GL context does not support color renderable floats");this.vertexBuffer=Hit(this.gl),this.indexBuffer=qit(this.gl),this.framebuffer=Frt(this.gl),this.textureConfig=GT(this.gl,this.textureHalfFloatExtension)}get debug(){return dt().getBool("DEBUG")}dispose(){if(this.disposed)return;this.program!=null&&console.warn("Disposing a GPGPUContext that still has a bound WebGLProgram. This is probably a resource leak, delete the program with GPGPUContext.deleteProgram before disposing."),this.outputTexture!=null&&console.warn("Disposing a GPGPUContext that still has a bound output matrix texture.  This is probably a resource leak, delete the output matrix texture with GPGPUContext.deleteMatrixTexture before disposing.");const t=this.gl;Dt(t,()=>t.finish()),Dt(t,()=>t.bindFramebuffer(t.FRAMEBUFFER,null)),Dt(t,()=>t.deleteFramebuffer(this.framebuffer)),Dt(t,()=>t.bindBuffer(t.ARRAY_BUFFER,null)),Dt(t,()=>t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,null)),Dt(t,()=>t.deleteBuffer(this.indexBuffer)),this.disposed=!0}createFloat32MatrixTexture(t,e){return this.throwIfDisposed(),jit(this.gl,t,e,this.textureConfig)}createFloat16MatrixTexture(t,e){return this.throwIfDisposed(),Kit(this.gl,t,e,this.textureConfig)}createUnsignedBytesMatrixTexture(t,e){return this.throwIfDisposed(),Xit(this.gl,t,e,this.textureConfig)}uploadPixelDataToTexture(t,e){this.throwIfDisposed(),tot(this.gl,t,e)}uploadDenseMatrixToTexture(t,e,s,r){this.throwIfDisposed(),Jit(this.gl,t,e,s,r,this.textureConfig)}createFloat16PackedMatrixTexture(t,e){return this.throwIfDisposed(),Qit(this.gl,t,e,this.textureConfig)}createPackedMatrixTexture(t,e){return this.throwIfDisposed(),Yit(this.gl,t,e,this.textureConfig)}deleteMatrixTexture(t){this.throwIfDisposed(),this.outputTexture===t&&(XA(this.gl,this.framebuffer),this.outputTexture=null),Dt(this.gl,()=>this.gl.deleteTexture(t))}downloadByteEncodedFloatMatrixFromOutputTexture(t,e,s){return this.downloadMatrixDriver(t,()=>sot(this.gl,e,s,this.textureConfig))}downloadPackedMatrixFromBuffer(t,e,s,r,i,o){return rot(this.gl,t,e,s,r,i,o,this.textureConfig)}downloadFloat32MatrixFromBuffer(t,e){return not(this.gl,t,e)}createBufferFromTexture(t,e,s){this.bindTextureToFrameBuffer(t);const r=eot(this.gl,e,s,this.textureConfig);return this.unbindTextureToFrameBuffer(),r}createAndWaitForFence(){const t=this.createFence(this.gl);return this.pollFence(t)}createFence(t){let e,s;if(dt().getBool("WEBGL_FENCE_API_ENABLED")){const r=t,i=r.fenceSync(r.SYNC_GPU_COMMANDS_COMPLETE,0);t.flush(),s=()=>{const o=r.clientWaitSync(i,0,0);return o===r.ALREADY_SIGNALED||o===r.CONDITION_SATISFIED},e=i}else dt().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")>0?(e=this.beginQuery(),this.endQuery(),s=()=>this.isQueryAvailable(e,dt().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION"))):s=()=>!0;return{query:e,isFencePassed:s}}downloadMatrixFromPackedTexture(t,e,s){return this.downloadMatrixDriver(t,()=>iot(this.gl,e,s))}createProgram(t){this.throwIfDisposed();const e=this.gl;this.vertexShader==null&&(this.vertexShader=Wit(e));const s=Nrt(e);Dt(e,()=>e.attachShader(s,this.vertexShader)),Dt(e,()=>e.attachShader(s,t)),Rrt(e,s);const r=Object.assign(s,{vao:this.createVertexArray()});return this.debug&&mv(e,r),r}buildVao(t){this.setProgram(t),this.bindVertexArray(t.vao);const e=this.gl;Dt(e,()=>e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,this.indexBuffer)),Zit(e,t,this.vertexBuffer)}deleteProgram(t){this.throwIfDisposed(),t===this.program&&(this.program=null),t!=null&&(Dt(this.gl,()=>this.gl.deleteProgram(t)),this.deleteVertexArray(t.vao))}setProgram(t){this.throwIfDisposed(),this.program=t,this.program!=null&&this.debug&&mv(this.gl,this.program),Dt(this.gl,()=>this.gl.useProgram(t))}getUniformLocation(t,e,s=!0){return this.throwIfDisposed(),s?Prt(this.gl,t,e):Vrt(this.gl,t,e)}getAttributeLocation(t,e){return this.throwIfDisposed(),Dt(this.gl,()=>this.gl.getAttribLocation(t,e))}getUniformLocationNoThrow(t,e){return this.throwIfDisposed(),this.gl.getUniformLocation(t,e)}setInputMatrixTexture(t,e,s){this.throwIfDisposed(),this.throwIfNoProgram(),zrt(this.gl,t,e,s)}setOutputMatrixTexture(t,e,s){this.setOutputMatrixTextureDriver(t,s,e)}setOutputPackedMatrixTexture(t,e,s){this.throwIfDisposed();const[r,i]=gh(e,s);this.setOutputMatrixTextureDriver(t,r,i)}setOutputMatrixWriteRegion(t,e,s,r){this.setOutputMatrixWriteRegionDriver(s,t,r,e)}setOutputPackedMatrixWriteRegion(t,e,s,r){throw new Error("setOutputPackedMatrixWriteRegion not implemented.")}debugValidate(){this.program!=null&&mv(this.gl,this.program),Dg(this.gl)}executeProgram(){this.throwIfDisposed(),this.throwIfNoProgram();const t=this.gl;if(this.debug){const e=this.getVertexArray();console.assert(e===this.program.vao,"VAO changed between setProgram and executeProgram!"),this.debugValidate()}Dt(t,()=>t.drawElements(t.TRIANGLES,6,t.UNSIGNED_SHORT,0))}blockUntilAllProgramsCompleted(){this.throwIfDisposed(),Dt(this.gl,()=>this.gl.finish())}getQueryTimerExtension(){return this.disjointQueryTimerExtension==null&&(this.disjointQueryTimerExtension=$g(this.gl,dt().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")===2?"EXT_disjoint_timer_query_webgl2":"EXT_disjoint_timer_query")),this.disjointQueryTimerExtension}getQueryTimerExtensionWebGL2(){return this.getQueryTimerExtension()}getQueryTimerExtensionWebGL1(){return this.getQueryTimerExtension()}beginQuery(){if(dt().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")===2){const s=this.gl,r=this.getQueryTimerExtensionWebGL2(),i=s.createQuery();return s.beginQuery(r.TIME_ELAPSED_EXT,i),i}const t=this.getQueryTimerExtensionWebGL1(),e=t.createQueryEXT();return t.beginQueryEXT(t.TIME_ELAPSED_EXT,e),e}endQuery(){if(dt().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")===2){const e=this.gl,s=this.getQueryTimerExtensionWebGL2();e.endQuery(s.TIME_ELAPSED_EXT);return}const t=this.getQueryTimerExtensionWebGL1();t.endQueryEXT(t.TIME_ELAPSED_EXT)}async waitForQueryAndGetTime(t){return await Dk(()=>this.disposed||this.isQueryAvailable(t,dt().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION"))),this.getQueryTime(t,dt().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION"))}getQueryTime(t,e){if(e===0)return null;if(e===2){const s=this.gl;return s.getQueryParameter(t,s.QUERY_RESULT)/1e6}else{const s=this.getQueryTimerExtensionWebGL1();return s.getQueryObjectEXT(t,s.QUERY_RESULT_EXT)/1e6}}isQueryAvailable(t,e){if(e===0)return!0;if(e===2){const s=this.gl,r=this.getQueryTimerExtensionWebGL2(),i=s.getQueryParameter(t,s.QUERY_RESULT_AVAILABLE);return this.disjoint==null&&(this.disjoint=this.gl.getParameter(r.GPU_DISJOINT_EXT)),i&&!this.disjoint}else{const s=this.getQueryTimerExtensionWebGL1(),r=s.getQueryObjectEXT(t,s.QUERY_RESULT_AVAILABLE_EXT);return this.disjoint==null&&(this.disjoint=this.gl.getParameter(s.GPU_DISJOINT_EXT)),r&&!this.disjoint}}pollFence(t){return new Promise(e=>{this.addItemToPoll(()=>t.isFencePassed(),()=>e())})}pollItems(){const t=oot(this.itemsToPoll.map(e=>e.isDoneFn));for(let e=0;e<=t;++e){const{resolveFn:s}=this.itemsToPoll[e];s()}this.itemsToPoll=this.itemsToPoll.slice(t+1)}addItemToPoll(t,e){if(this.itemsToPoll.push({isDoneFn:t,resolveFn:e}),this.itemsToPoll.length>1)return;let s;"setTimeoutCustom"in dt().platform&&(s=dt().platform.setTimeoutCustom.bind(dt().platform)),Dk(()=>(this.pollItems(),this.itemsToPoll.length===0),()=>0,null,s)}bindTextureToFrameBuffer(t){this.throwIfDisposed(),gv(this.gl,t,this.framebuffer),this.debug&&Dg(this.gl)}unbindTextureToFrameBuffer(){this.outputTexture!=null?(gv(this.gl,this.outputTexture,this.framebuffer),this.debug&&Dg(this.gl)):XA(this.gl,this.framebuffer)}downloadMatrixDriver(t,e){this.bindTextureToFrameBuffer(t);const s=e();return this.unbindTextureToFrameBuffer(),s}setOutputMatrixTextureDriver(t,e,s){this.throwIfDisposed();const r=this.gl;gv(r,t,this.framebuffer),this.debug&&Dg(r),this.outputTexture=t,Dt(r,()=>r.viewport(0,0,e,s)),Dt(r,()=>r.scissor(0,0,e,s))}setOutputMatrixWriteRegionDriver(t,e,s,r){this.throwIfDisposed(),Dt(this.gl,()=>this.gl.scissor(t,e,s,r))}throwIfDisposed(){if(this.disposed)throw new Error("Attempted to use disposed GPGPUContext.")}throwIfNoProgram(){if(this.program==null)throw new Error("No GPU program is currently set.")}}function oot(n){let t=0;for(;t<n.length&&n[t]();++t);return t-1}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const{addImpl:aot,bincountImpl:NL,bincountReduceImpl:lot,bitwiseAndImpl:uot,castImpl:cot,ceilImpl:hot,concatImpl:dot,equalImpl:fot,expImpl:pot,expm1Impl:mot,floorImpl:got,gatherNdImpl:yot,gatherV2Impl:xot,greaterImpl:bot,greaterEqualImpl:vot,lessImpl:wot,lessEqualImpl:Cot,linSpaceImpl:Sot,logImpl:Tot,maxImpl:Eot,maximumImpl:Iot,minimumImpl:_ot,multiplyImpl:kot,negImpl:Aot,notEqualImpl:Not,prodImpl:Rot,raggedGatherImpl:$ot,raggedRangeImpl:Dot,raggedTensorToTensorImpl:Oot,rangeImpl:Mot,rsqrtImpl:Fot,scatterImpl:Lot,sigmoidImpl:Pot,simpleAbsImpl:RL,sliceImpl:Vot,sparseFillEmptyRowsImpl:zot,sparseReshapeImpl:Bot,sparseSegmentReductionImpl:$L,sqrtImpl:Uot,staticRegexReplaceImpl:Got,stridedSliceImpl:Wot,stringNGramsImpl:Hot,stringSplitImpl:qot,stringToHashBucketFastImpl:jot,subImpl:Kot,tileImpl:Xot,topKImpl:Yot,transposeImpl:jT,uniqueImpl:Qot}=ZZ;/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function DL(n,t){return["x","y","z","w","u","v"].slice(0,t).map(e=>`${n}.${e}`)}function Ls(n,t){return t===1?[n]:DL(n,t)}function Zot(n,t){if(n===1)return"rc";let e="";for(let s=0;s<n;s++)e+=t[s],s<n-1&&(e+=",");return e}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Jot{constructor(t){if(this.variableNames=["A"],this.packedInputs=!1,this.packedOutput=!0,this.outputShape=t,this.rank=t.length,this.enableShapeUniforms=ks(this.outputShape.length),this.rank===0)this.userCode=`
        void main() {
          setOutput(vec4(getA(), 0., 0., 0.));
        }
      `;else{const e=Ls("rc",this.rank),s=He(this.rank),r=this.getOutOfBoundsCondition(e),i=this.getSetup(e),o=this.getOutput(e);this.userCode=`
        void main() {
          ${s} rc = getOutputCoords();

          if(${r}) {
            setOutput(vec4(0));
          } else {
            ${i}

            setOutput(vec4(${o}));
          }
        }
      `}}getSourceCoordsArr(t){const e=[];for(let s=0;s<=1;s++)for(let r=0;r<=1;r++){let i=`${s===0?"r":"rp1"}, ${r===0?"c":"cp1"}`;for(let o=2;o<this.rank;o++)i=`${t[t.length-1-o]},`+i;e.push(i)}return e}getOutOfBoundsCondition(t){if(this.rank===1)return`rc > ${this.enableShapeUniforms?"outShape":this.outputShape[0]}`;let e="";for(let s=this.rank-2;s<this.rank;s++)e+=`${t[s]} >= ${this.enableShapeUniforms?`outShape[${s}]`:this.outputShape[s]}`,s<this.rank-1&&(e+="||");return e}getSetup(t){if(this.rank===1)return"";const e=t.slice(-2),s=this.enableShapeUniforms?`outShape[${this.rank} - 1]`:this.outputShape[this.rank-1],r=this.enableShapeUniforms?`outShape[${this.rank} - 2]`:this.outputShape[this.rank-2];return`
      int r = ${e[0]};
      int c = ${e[1]};
      int rp1 = r + 1;
      int cp1 = c + 1;

      bool cEdge = cp1 >= ${s};
      bool rEdge = rp1 >= ${r};
    `}getOutput(t){const e=this.getSourceCoordsArr(t);return this.rank===1?`getA(rc), (rc + 1 >= ${this.enableShapeUniforms?"outShape":this.outputShape[0]} ? 0. : getA(rc + 1)), 0, 0`:`getA(${e[0]}),
            cEdge ? 0. : getA(${e[1]}),
            rEdge ? 0. : getA(${e[2]}),
            rEdge || cEdge ? 0. : getA(${e[3]})`}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class OL{constructor(t,e){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.customUniforms=[{name:"inputShape",type:"ivec3"}],this.outputShape=t,this.enableShapeUniforms=ks(this.outputShape.length);let s="";for(let r=0;r<4;r++){let i="thisRC = rc;";r%2===1&&(i+="thisRC.z += 1;"),r>1&&(i+="thisRC.y += 1;"),s+=`
        ${i}
        ${r>0?"if(thisRC.y < rows && thisRC.z < cols){":""}
          int flatIndex = getFlatIndex(thisRC);

          ivec3 inputRC = inputCoordsFromReshapedOutCoords(flatIndex);
          vec2 inputRCInnerDims = vec2(float(inputRC.y),float(inputRC.z));

          result[${r}] =
            getChannel(getA(inputRC.x, inputRC.y, inputRC.z), inputRCInnerDims);
        ${r>0?"}":""}
      `}this.userCode=`
      ${tat(e,this.enableShapeUniforms)}
      ${this.enableShapeUniforms?HT():WT(t)}

      void main() {
        ivec3 rc = getOutputCoords();

        vec4 result = vec4(0.);

        ivec3 thisRC;
        int rows = ${this.enableShapeUniforms?"outShape[1]":t[1]};
        int cols = ${this.enableShapeUniforms?"outShape[2]":t[2]};

        ${s}

        setOutput(result);
      }
    `}}function tat(n,t){return`
    ivec3 inputCoordsFromReshapedOutCoords(int index) {
      ${t?Zrt(["r","c","d"],"inputShape"):Iu(["r","c","d"],n)}
      return ivec3(r, c, d);
    }
  `}/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class eat{constructor(t){this.gpgpu=t,this.numUsedTextures=0,this.numFreeTextures=0,this._numBytesAllocated=0,this._numBytesFree=0,this.freeTextures={},this.usedTextures={},this.logEnabled=!1}acquireTexture(t,e,s){const r=tN(e,s),i=eN(t,r,s);i in this.freeTextures||(this.freeTextures[i]=[]),i in this.usedTextures||(this.usedTextures[i]=[]);const o=JA(t,r,this.gpgpu.gl,this.gpgpu.textureConfig,s);if(this.freeTextures[i].length>0){this.numFreeTextures--,this.numUsedTextures++,this._numBytesFree-=o,this.log();const u=this.freeTextures[i].pop();return this.usedTextures[i].push(u),u}let l;return r===ls.PACKED_2X2_FLOAT32?l=this.gpgpu.createPackedMatrixTexture(t[0],t[1]):r===ls.PACKED_2X2_FLOAT16?l=this.gpgpu.createFloat16PackedMatrixTexture(t[0],t[1]):r===ls.UNPACKED_FLOAT32?l=this.gpgpu.createFloat32MatrixTexture(t[0],t[1]):r===ls.UNPACKED_FLOAT16?l=this.gpgpu.createFloat16MatrixTexture(t[0],t[1]):r===ls.PACKED_4X1_UNSIGNED_BYTE&&(l=this.gpgpu.createUnsignedBytesMatrixTexture(t[0],t[1])),this.usedTextures[i].push(l),this.numUsedTextures++,this._numBytesAllocated+=o,this.log(),l}releaseTexture(t,e,s,r){if(this.freeTextures==null)return;const i=tN(s,r),o=eN(e,i,r);o in this.freeTextures||(this.freeTextures[o]=[]);const l=JA(e,i,this.gpgpu.gl,this.gpgpu.textureConfig,r),u=dt().getNumber("WEBGL_DELETE_TEXTURE_THRESHOLD");u!==-1&&this._numBytesAllocated>u?(this.gpgpu.deleteMatrixTexture(t.texture),this._numBytesAllocated-=l):(this.freeTextures[o].push(t),this.numFreeTextures++,this._numBytesFree+=l),this.numUsedTextures--;const h=this.usedTextures[o],d=h&&h.indexOf(t);if(d==null||d<0)throw new Error("Cannot release a texture that was never provided by this texture manager");h[d]=h[h.length-1],h.pop(),this.log()}log(){if(!this.logEnabled)return;const t=this.numFreeTextures+this.numUsedTextures;console.log("Free/Used",`${this.numFreeTextures} / ${this.numUsedTextures}`,`(${t})`);const e=this._numBytesFree/this._numBytesAllocated;console.log(`Bytes allocated: ${this._numBytesAllocated}`),console.log(`Bytes unused: ${this._numBytesFree} (${Math.round(100*e)}%)`)}get numBytesAllocated(){return this._numBytesAllocated}get numBytesFree(){return this._numBytesFree}getNumUsedTextures(){return this.numUsedTextures}getNumFreeTextures(){return this.numFreeTextures}dispose(){if(this.freeTextures!=null){for(const t in this.freeTextures)this.freeTextures[t].forEach(e=>{this.gpgpu.deleteMatrixTexture(e.texture)});for(const t in this.usedTextures)this.usedTextures[t].forEach(e=>{this.gpgpu.deleteMatrixTexture(e.texture)});this.freeTextures=null,this.usedTextures=null,this.numUsedTextures=0,this.numFreeTextures=0,this._numBytesAllocated=0,this._numBytesFree=0}}}function nat(n,t){const e=n;if(t===e.R32F)return 4;if(t===e.R16F)return 2;if(t===e.RGBA32F)return 16;if(t===n.RGBA)return 16;if(t===e.RGBA16F)return 8;if(t===e.RGBA8)return 4;throw new Error(`Unknown internal format ${t}`)}function JA(n,t,e,s,r){const i=sat(t,s);let o;if(r){const[u,h]=gh(n[0],n[1]);o=u*h}else{const[u,h]=qp(n[0],n[1]);o=u*h}const l=nat(e,i);return o*l}function sat(n,t){switch(n){case ls.PACKED_2X2_FLOAT32:return kL(t);case ls.PACKED_2X2_FLOAT16:return AL(t);case ls.UNPACKED_FLOAT32:return EL(t);case ls.UNPACKED_FLOAT16:return IL(t);case ls.PACKED_4X1_UNSIGNED_BYTE:return _L(t);default:throw new Error(`Unknown physical texture type ${n}`)}}function rat(n){return dt().getBool("WEBGL_RENDER_FLOAT32_ENABLED")?n?ls.PACKED_2X2_FLOAT32:ls.UNPACKED_FLOAT32:n?ls.PACKED_2X2_FLOAT16:ls.UNPACKED_FLOAT16}function tN(n,t){if(n===wr.UPLOAD)return ls.PACKED_2X2_FLOAT32;if(n===wr.RENDER||n==null)return rat(t);if(n===wr.DOWNLOAD||n===wr.PIXELS)return ls.PACKED_4X1_UNSIGNED_BYTE;throw new Error(`Unknown logical texture type ${n}`)}function eN(n,t,e){return`${n[0]}_${n[1]}_${t}_${e}`}/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Pi{constructor(t,e){this.variableNames=["A"],this.outputShape=t,this.enableShapeUniforms=ks(this.outputShape.length),this.userCode=`
      float unaryOperation(float x) {
        ${e}
      }

      void main() {
        float x = getAAtOutCoords();
        float y = unaryOperation(x);

        setOutput(y);
      }
    `}}const Yr="if (isnan(x)) return x;",iat="return x;",nN="return abs(x);",oat="return (x >= 0.0) ? x : (exp(x) - 1.0);",aat=Yr+`
  return (x < 0.0) ? 0.0 : x;
`,lat=Yr+`
  return (x < 0.0) ? 0.0 : min(6.0, x);
`,Ta="return x;",uat="return 1.0 / (1.0 + exp(-1.0 * x));";/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const cat="return x;",hat=`
  vec4 result;

  result.r = (x.r >= 0.0) ? x.r : (exp(x.r) - 1.0);
  result.g = (x.g >= 0.0) ? x.g : (exp(x.g) - 1.0);
  result.b = (x.b >= 0.0) ? x.b : (exp(x.b) - 1.0);
  result.a = (x.a >= 0.0) ? x.a : (exp(x.a) - 1.0);

  return result;
`,dat=`
  vec4 result = x * vec4(greaterThanEqual(x, vec4(0.0)));
  bvec4 isNaN = isnan(x);

  result.r = isNaN.r ? x.r : result.r;
  result.g = isNaN.g ? x.g : result.g;
  result.b = isNaN.b ? x.b : result.b;
  result.a = isNaN.a ? x.a : result.a;

  return result;
`,fat=`
  vec4 result = min(x, vec4(6.)) * vec4(greaterThanEqual(x, vec4(0.0)));
  bvec4 isNaN = isnan(x);

  result.r = isNaN.r ? x.r : result.r;
  result.g = isNaN.g ? x.g : result.g;
  result.b = isNaN.b ? x.b : result.b;
  result.a = isNaN.a ? x.a : result.a;

  return result;
`,pat="return 1.0 / (1.0 + exp(-1.0 * x));";class ka{constructor(t,e){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=t,this.enableShapeUniforms=ks(this.outputShape.length),this.userCode=`
      vec4 unaryOperation(vec4 x) {
        ${e}
      }

      void main() {
        vec4 x = getAAtOutCoords();
        vec4 y = unaryOperation(x);

        setOutput(y);
      }
    `}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class mat{constructor(t){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!1,this.outputShape=t,this.enableShapeUniforms=ks(this.outputShape.length);const e=t.length,s=Ls("rc",e),r=He(e),i=Zot(e,s),o=s.slice(-2),l=e<=1?"rc":`vec2(${o.join(",")})`;this.userCode=`
      void main() {
        ${r} rc = getOutputCoords();
        vec4 packedInput = getA(${i});

        setOutput(getChannel(packedInput, ${l}));
      }
    `}}/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const gat=nO,yat=1e-7,xat=1e-4,Fg={};function bat(n){return n in Fg||(Fg[n]={}),Fg[n]}const vat=dt().getNumber("CPU_HANDOFF_SIZE_THRESHOLD"),wat=600;function Cat(){return dt().global.screen==null?1024:dt().global.screen.height*dt().global.screen.width*window.devicePixelRatio*wat/1024/1024}class Px extends fC{nextDataId(){return Px.nextDataId++}constructor(t){if(super(),this.pendingRead=new WeakMap,this.pendingDisposal=new WeakSet,this.dataRefCount=new WeakMap,this.numBytesInGPU=0,this.uploadWaitMs=0,this.downloadWaitMs=0,this.lastGlFlushTime=0,this.warnedAboutMemory=!1,this.pendingDeletes=0,this.disposed=!1,!dt().getBool("HAS_WEBGL"))throw new Error("WebGL is not supported on this device");let e;if(t!=null){if(t instanceof bv)e=t;else{const s=pi(dt().getNumber("WEBGL_VERSION"),t);e=new bv(s)}this.binaryCache={},this.gpgpuCreatedLocally=!1}else{const s=pi(dt().getNumber("WEBGL_VERSION"));e=new bv(s),this.binaryCache=bat(dt().getNumber("WEBGL_VERSION")),this.gpgpuCreatedLocally=!0}this.gpgpu=e,this.canvas=this.gpgpu.gl.canvas,this.textureManager=new eat(this.gpgpu),this.numMBBeforeWarning=Cat(),this.texData=new A$(this,$i())}numDataIds(){return this.texData.numDataIds()-this.pendingDeletes}writeTexture(t,e,s,r,i,o){const l=this.makeTensorInfo(e,s),u=this.texData.get(l.dataId);u.isPacked=!1,u.texture={texture:t,texShape:[r,i]},u.texShape=[r,i];const h=Og(e),d=new ZA(h,!1,o),p=this.runWebGLProgram(d,[l],s,[[r,i]]);return p.shape=e,u.texture=null,this.disposeIntermediateTensorInfo(l),p.dataId}write(t,e,s){if((dt().getBool("WEBGL_CHECK_NUMERICAL_PROBLEMS")||dt().getBool("DEBUG"))&&this.checkNumericalProblems(t),s==="complex64"&&t!=null)throw new Error("Cannot write to a complex64 dtype. Please use tf.complex(real, imag).");const r={id:this.nextDataId()};return this.texData.set(r,{shape:e,dtype:s,values:t,usage:wr.UPLOAD,refCount:1}),r}refCount(t){return this.texData.has(t)?this.texData.get(t).refCount:0}incRef(t){const e=this.texData.get(t);e.refCount++}decRef(t){if(this.texData.has(t)){const e=this.texData.get(t);e.refCount--}}move(t,e,s,r,i){if(dt().getBool("DEBUG")&&this.checkNumericalProblems(e),r==="complex64")throw new Error("Cannot write to a complex64 dtype. Please use tf.complex(real, imag).");this.texData.set(t,{shape:s,dtype:r,values:e,usage:wr.UPLOAD,refCount:i})}disposeIntermediateTensorInfo(t){this.disposeData(t.dataId)}readSync(t){const e=this.texData.get(t),{values:s,dtype:r,complexTensorInfos:i,slice:o,shape:l,isPacked:u}=e;if(o!=null){let m;u?m=new ka(l,Ta):m=new Pi(l,Ta);const y=this.runWebGLProgram(m,[{dataId:t,shape:l,dtype:r}],r),x=this.readSync(y.dataId);return this.disposeIntermediateTensorInfo(y),x}if(s!=null)return this.convertAndCacheOnCPU(t);if(r==="string")return s;const h=this.activeTimers!=null;let d;h&&(d=qs());let p;if(r==="complex64"){const m=this.readSync(i.real.dataId),y=this.readSync(i.imag.dataId);p=Uo(m,y)}else p=this.getValuesFromTexture(t);return h&&(this.downloadWaitMs+=qs()-d),this.convertAndCacheOnCPU(t,p)}async read(t){if(this.pendingRead.has(t)){const x=this.pendingRead.get(t);return new Promise(v=>x.push(v))}const e=this.texData.get(t),{values:s,shape:r,slice:i,dtype:o,complexTensorInfos:l,isPacked:u}=e;if(i!=null){let x;u?x=new ka(r,Ta):x=new Pi(r,Ta);const v=this.runWebGLProgram(x,[{dataId:t,shape:r,dtype:o}],o),C=this.read(v.dataId);return this.disposeIntermediateTensorInfo(v),C}if(s!=null)return this.convertAndCacheOnCPU(t);if(dt().getBool("DEBUG")&&!dt().getBool("WEBGL_DOWNLOAD_FLOAT_ENABLED")&&dt().getNumber("WEBGL_VERSION")===2)throw new Error("tensor.data() with WEBGL_DOWNLOAD_FLOAT_ENABLED=false and WEBGL_VERSION=2 not yet supported.");let h=null,d;if(o!=="complex64"&&dt().get("WEBGL_BUFFER_SUPPORTED")){d=this.decode(t);const x=this.texData.get(d.dataId);h=this.gpgpu.createBufferFromTexture(x.texture.texture,...Rg(r))}this.pendingRead.set(t,[]),o!=="complex64"&&await this.gpgpu.createAndWaitForFence();let p;if(o==="complex64"){const x=await Promise.all([this.read(l.real.dataId),this.read(l.imag.dataId)]),v=x[0],C=x[1];p=Uo(v,C)}else if(h==null)p=this.getValuesFromTexture(t);else{const x=yt(r);p=this.gpgpu.downloadFloat32MatrixFromBuffer(h,x)}if(d!=null&&this.disposeIntermediateTensorInfo(d),h!=null){const x=this.gpgpu.gl;Dt(x,()=>x.deleteBuffer(h))}const m=this.convertAndCacheOnCPU(t,p),y=this.pendingRead.get(t);return this.pendingRead.delete(t),y.forEach(x=>x(m)),this.pendingDisposal.has(t)&&(this.pendingDisposal.delete(t),this.disposeData(t)&&$i().removeDataId(t,this),this.pendingDeletes--),m}readToGPU(t,e={}){const s=this.texData.get(t),{values:r,shape:i,slice:o,dtype:l,isPacked:u,texture:h}=s;if(l==="complex64")throw new Error("Does not support reading texture for complex64 dtype.");if(o!=null){let y;u?y=new ka(i,Ta):y=new Pi(i,Ta);const x=this.runWebGLProgram(y,[{dataId:t,shape:i,dtype:l}],l),v=this.readToGPU(x,e);return this.disposeIntermediateTensorInfo(x),v}if(h==null)throw r!=null?new Error("Data is not on GPU but on CPU."):new Error("There is no data on GPU or CPU.");const d=this.decode(t,e.customTexShape),p=$i().makeTensorFromTensorInfo(d),m=this.texData.get(d.dataId);return Object.assign({tensorRef:p},m.texture)}bufferSync(t){const e=this.readSync(t.dataId);if(t.dtype==="string")try{const s=e.map(r=>Wa(r));return ae(t.shape,t.dtype,s)}catch{throw new Error("Failed to decode encoded string bytes into utf-8")}return ae(t.shape,t.dtype,e)}checkNumericalProblems(t){if(t!=null)for(let e=0;e<t.length;e++){const s=t[e];if(!Ert(s))throw dt().getBool("WEBGL_RENDER_FLOAT32_CAPABLE")?Error(`The value ${s} cannot be represented with your current settings. Consider enabling float32 rendering: 'tf.env().set('WEBGL_RENDER_FLOAT32_ENABLED', true);'`):Error(`The value ${s} cannot be represented on this device.`)}}getValuesFromTexture(t){const{shape:e,dtype:s,isPacked:r}=this.texData.get(t),i=yt(e);if(dt().getBool("WEBGL_DOWNLOAD_FLOAT_ENABLED")){const m=this.decode(t),y=this.texData.get(m.dataId),x=this.gpgpu.downloadMatrixFromPackedTexture(y.texture.texture,...Rg(e)).subarray(0,i);return this.disposeIntermediateTensorInfo(m),x}const o=dt().getBool("WEBGL_PACK")&&r===!0,l=o?Og(e):e,u=o?new Bit(l):new zit(l),h=this.runWebGLProgram(u,[{shape:l,dtype:s,dataId:t}],"float32"),d=this.texData.get(h.dataId),p=this.gpgpu.downloadByteEncodedFloatMatrixFromOutputTexture(d.texture.texture,d.texShape[0],d.texShape[1]).subarray(0,i);return this.disposeIntermediateTensorInfo(h),p}timerAvailable(){return dt().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE")>0}time(t){const e=this.activeTimers,s=[];let r=!1;this.programTimersStack==null?(this.programTimersStack=s,r=!0):this.activeTimers.push(s),this.activeTimers=s,t();const i=eu(this.activeTimers.map(u=>u.query)).filter(u=>u!=null),o=eu(this.activeTimers.map(u=>u.name)).filter(u=>u!=null);this.activeTimers=e,r&&(this.programTimersStack=null);const l={uploadWaitMs:this.uploadWaitMs,downloadWaitMs:this.downloadWaitMs,kernelMs:null,wallMs:null};return(async()=>{if(dt().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE")>0){const u=await Promise.all(i);l.kernelMs=LW(u),l.getExtraProfileInfo=()=>u.map((h,d)=>({name:o[d],ms:h})).map(h=>`${h.name}: ${h.ms}`).join(", ")}else l.kernelMs={error:"WebGL query timers are not supported in this environment."};return this.uploadWaitMs=0,this.downloadWaitMs=0,l})()}memory(){return{unreliable:!1,numBytesInGPU:this.numBytesInGPU,numBytesInGPUAllocated:this.textureManager.numBytesAllocated,numBytesInGPUFree:this.textureManager.numBytesFree}}startTimer(){return dt().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE")>0?this.gpgpu.beginQuery():{startMs:qs(),endMs:null}}endTimer(t){return dt().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE")>0?(this.gpgpu.endQuery(),t):(t.endMs=qs(),t)}async getQueryTime(t){if(dt().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE")>0)return this.gpgpu.waitForQueryAndGetTime(t);const e=t;return e.endMs-e.startMs}disposeData(t,e=!1){if(this.pendingDisposal.has(t))return!1;if(!this.texData.has(t))return!0;if(e?this.texData.get(t).refCount=0:this.texData.get(t).refCount--,!e&&this.texData.get(t).refCount>0)return!1;if(this.pendingRead.has(t))return this.pendingDisposal.add(t),this.pendingDeletes++,!1;this.releaseGPUData(t);const{complexTensorInfos:s}=this.texData.get(t);return s!=null&&(this.disposeData(s.real.dataId,e),this.disposeData(s.imag.dataId,e)),this.texData.delete(t),!0}releaseGPUData(t){const{texture:e,dtype:s,texShape:r,usage:i,isPacked:o,slice:l}=this.texData.get(t),u=l&&l.origDataId||t,h=this.dataRefCount.get(u);h>1?this.dataRefCount.set(u,h-1):(this.dataRefCount.delete(u),e!=null&&(this.numBytesInGPU-=this.computeBytes(r,s),this.textureManager.releaseTexture(e,r,i,o)));const d=this.texData.get(t);d.texture=null,d.texShape=null,d.isPacked=!1,d.slice=null}getTexture(t){return this.uploadToGPU(t),this.texData.get(t).texture.texture}getDataInfo(t){return this.texData.get(t)}shouldExecuteOnCPU(t,e=vat){return dt().getBool("WEBGL_CPU_FORWARD")&&t.every(s=>this.texData.get(s.dataId).texture==null&&yt(s.shape)<e)}getGPGPUContext(){return this.gpgpu}where(t){vr("tf.where() in webgl locks the UI thread. Call tf.whereAsync() instead");const e=t.dataSync();return gat(t.shape,e)}packedUnaryOp(t,e,s){const r=new ka(t.shape,e),i=this.compileAndRun(r,[t],s);return $i().makeTensorFromTensorInfo(i)}abs(t){if(this.shouldExecuteOnCPU([t])&&t.dtype!=="complex64"){const r=RL(this.texData.get(t.dataId).values);return this.makeOutput(t.shape,t.dtype,r)}if(dt().getBool("WEBGL_PACK_UNARY_OPERATIONS"))return this.packedUnaryOp(t,nN,t.dtype);const e=new Pi(t.shape,nN),s=this.compileAndRun(e,[t]);return $i().makeTensorFromTensorInfo(s)}makeTensorInfo(t,e,s){let r;if(e==="string"&&s!=null&&s.length>0&&Rf(s[0])){const i=s.map(o=>Ma(o));r=this.write(i,t,e)}else r=this.write(s,t,e);return this.texData.get(r).usage=null,{dataId:r,shape:t,dtype:e}}makeOutput(t,e,s){return $i().makeTensorFromTensorInfo(this.makeTensorInfo(t,e,s),this)}unpackTensor(t){const e=new mat(t.shape);return this.runWebGLProgram(e,[t],t.dtype)}packTensor(t){const e=new Jot(t.shape);return this.runWebGLProgram(e,[t],t.dtype,null,!0)}packedReshape(t,e){const s=[Jc(t.shape),...th(t.shape)],r={dtype:t.dtype,shape:s,dataId:t.dataId},i=[Jc(e),...th(e)],o=new OL(i,s),l=!0,u=[s],h=this.runWebGLProgram(o,[r],t.dtype,u,l);return{dataId:h.dataId,shape:e,dtype:h.dtype}}decode(t,e){const s=this.texData.get(t),{isPacked:r,shape:i,dtype:o}=s;if(e!=null){const m=yt(i),y=e[0]*e[1]*4;U(m<=y,()=>"customTexShape is too small. Row * Column * 4 should be equal or larger than the size of the tensor data.")}const l=Og(i);let u;r?u=new Vit(l):u=new Pit(l);const h=!0,d=[e??Rg(l)],p=this.runWebGLProgram(u,[{shape:l,dtype:o,dataId:t}],o,d,h,e);return{dtype:o,shape:i,dataId:p.dataId}}runWebGLProgram(t,e,s,r,i=!1,o){const l=this.makeTensorInfo(t.outputShape,s),u=this.texData.get(l.dataId);if(t.packedOutput&&(u.isPacked=!0),t.outPackingScheme===vf.DENSE){const S=o??Rg(t.outputShape);u.texShape=S.map(E=>E*2)}if(t.outTexUsage!=null&&(u.usage=t.outTexUsage),yt(l.shape)===0)return u.values=Ss(l.dtype,0),l;const h=[],d=e.map(S=>{if(S.dtype==="complex64")throw new Error("GPGPUProgram does not support complex64 input. For complex64 dtypes, please separate the program into real and imaginary parts.");let E=this.texData.get(S.dataId);if(E.texture==null){if(!t.packedInputs&&yt(S.shape)<=dt().getNumber("WEBGL_SIZE_UPLOAD_UNIFORM"))return{shape:S.shape,texData:null,isUniform:!0,uniformValues:E.values};t.packedInputs&&(E.isPacked=!0,E.shape=S.shape)}if(this.uploadToGPU(S.dataId),!!E.isPacked!=!!t.packedInputs)S=E.isPacked?this.unpackTensor(S):this.packTensor(S),h.push(S),E=this.texData.get(S.dataId);else if(E.isPacked&&!qy(E.shape,S.shape)){const _=S,I=S.shape;S.shape=E.shape,S=this.packedReshape(S,I),h.push(S),E=this.texData.get(S.dataId),_.shape=I}return{shape:S.shape,texData:E,isUniform:!1}});this.uploadToGPU(l.dataId);const p={shape:l.shape,texData:u,isUniform:!1},m=Lit(t,d,p),y=this.getAndSaveBinary(m,()=>Mit(this.gpgpu,t,d,p)),x=this.activeTimers!=null;let v;x&&(v=this.startTimer()),dt().get("ENGINE_COMPILE_ONLY")||Fit(this.gpgpu,y,d,p,r),h.forEach(S=>this.disposeIntermediateTensorInfo(S)),x&&(v=this.endTimer(v),this.activeTimers.push({name:t.constructor.name,query:this.getQueryTime(v)}));const C=dt().getNumber("WEBGL_FLUSH_THRESHOLD");if(C>0){const S=qs();S-this.lastGlFlushTime>C&&(this.gpgpu.gl.flush(),this.lastGlFlushTime=S)}if(!dt().getBool("WEBGL_LAZILY_UNPACK")&&u.isPacked&&i===!1){const S=this.unpackTensor(l);return this.disposeIntermediateTensorInfo(l),S}return l}compileAndRun(t,e,s,r,i=!1){return s=s||e[0].dtype,this.runWebGLProgram(t,e,s,r,i)}getAndSaveBinary(t,e){return t in this.binaryCache||(this.binaryCache[t]=e()),this.binaryCache[t]}getTextureManager(){return this.textureManager}dispose(){this.disposed||(dt().getBool("IS_TEST")||Object.keys(this.binaryCache).forEach(e=>{this.gpgpu.deleteProgram(this.binaryCache[e].webGLProgram),delete this.binaryCache[e]}),this.textureManager.dispose(),this.canvas!=null&&typeof HTMLCanvasElement<"u"&&this.canvas instanceof HTMLCanvasElement?this.canvas.remove():this.canvas=null,this.gpgpuCreatedLocally&&(this.gpgpu.program=null,this.gpgpu.dispose()),this.disposed=!0)}floatPrecision(){return this.floatPrecisionValue==null&&(this.floatPrecisionValue=ct(()=>{if(!dt().get("WEBGL_RENDER_FLOAT32_ENABLED")){const t=dt().getBool("DEBUG");dt().set("DEBUG",!1);const e=this.abs(De(1e-8)).dataSync()[0];if(dt().set("DEBUG",t),e>0)return 32}return 16})),this.floatPrecisionValue}epsilon(){return this.floatPrecision()===32?yat:xat}uploadToGPU(t){const e=this.texData.get(t),{shape:s,dtype:r,values:i,texture:o,usage:l,isPacked:u}=e;if(o!=null)return;const h=this.activeTimers!=null;let d;h&&(d=qs());let p=e.texShape;if(p==null&&(p=Grt(s,u),e.texShape=p),i!=null){const m=Og(s);let y,x=p[1],v=p[0];const C=i instanceof Uint8Array||i instanceof Uint8ClampedArray;(u||!C)&&([x,v]=gh(p[0],p[1])),u?y=new Git(m,C):y=new ZA(m,C);const S=C?[v,x]:p,E=this.makeTensorInfo(S,r),_=this.texData.get(E.dataId);C?_.usage=wr.PIXELS:_.usage=wr.UPLOAD,_.texShape=S,this.gpgpu.uploadDenseMatrixToTexture(this.getTexture(E.dataId),x,v,i);const I=[[v,x]],P=this.runWebGLProgram(y,[E],r,I,!0),D=this.texData.get(P.dataId);e.texShape=D.texShape,e.isPacked=D.isPacked,e.usage=D.usage,dt().get("ENGINE_COMPILE_ONLY")?this.disposeData(P.dataId):(e.texture=D.texture,e.values=null,this.texData.delete(P.dataId)),this.disposeIntermediateTensorInfo(E),h&&(this.uploadWaitMs+=qs()-d)}else{const m=this.acquireTexture(p,l,r,u);e.texture=m}}convertAndCacheOnCPU(t,e){const s=this.texData.get(t),{dtype:r}=s;return e!=null&&(s.values=Sat(e,r)),s.values}acquireTexture(t,e,s,r){if(this.numBytesInGPU+=this.computeBytes(t,s),!this.warnedAboutMemory&&this.numBytesInGPU>this.numMBBeforeWarning*1024*1024){const i=(this.numBytesInGPU/1024/1024).toFixed(2);this.warnedAboutMemory=!0,console.warn(`High memory usage in GPU: ${i} MB, most likely due to a memory leak`)}return this.textureManager.acquireTexture(t,e,r)}computeBytes(t,e){return t[0]*t[1]*vy(e)}checkCompileCompletion(){for(const[,t]of Object.entries(this.binaryCache))this.checkCompletion_(t)}async checkCompileCompletionAsync(){const t=[];if(this.gpgpu.parallelCompilationExtension){for(const[,e]of Object.entries(this.binaryCache))t.push(this.checkCompletionAsync_(e));return Promise.all(t)}else{for(const[,e]of Object.entries(this.binaryCache)){const s=new Promise(r=>{try{this.checkCompletion_(e),r(!0)}catch(i){throw i}});t.push(s)}return Promise.all(t)}}async checkCompletionAsync_(t){return this.gpgpu.gl.getProgramParameter(t.webGLProgram,this.gpgpu.parallelCompilationExtension.COMPLETION_STATUS_KHR)?this.checkCompletion_(t):(await wO(),this.checkCompletionAsync_(t))}checkCompletion_(t){if(this.gpgpu.gl.getProgramParameter(t.webGLProgram,this.gpgpu.gl.LINK_STATUS)===!1)throw console.log(this.gpgpu.gl.getProgramInfoLog(t.webGLProgram)),this.gpgpu.gl.getShaderParameter(t.fragmentShader,this.gpgpu.gl.COMPILE_STATUS)===!1?(bL(t.source,this.gpgpu.gl.getShaderInfoLog(t.fragmentShader)),new Error("Failed to compile fragment shader.")):new Error("Failed to link vertex and fragment shaders.");return!0}getUniformLocations(){for(const t of Object.values(this.binaryCache)){this.gpgpu.buildVao(t.webGLProgram);const{variablesLocations:e,customUniformLocations:s,infLoc:r,nanLoc:i,outShapeLocation:o,outShapeStridesLocation:l,outTexShapeLocation:u}=TL(this.gpgpu,t.program,t.webGLProgram);t.variablesLocations=e,t.customUniformLocations=s,t.infLoc=r,t.nanLoc=i,t.outShapeLocation=o,t.outShapeStridesLocation=l,t.outTexShapeLocation=u}}createTensorFromGPUData(t,e,s){t.channels=t.channels||"RGBA";const{texture:r,height:i,width:o,channels:l}=t,u=$i().backend;if(!u.gpgpu.gl.isTexture(r))throw new Error("The texture is invalid. Also, please make sure the texture and the TFJS WebGL backend are using the same canvas. If you want to use your own custom canvas, you have to create and use the custom TFJS WebGL backend created from the canvas through 'new tf.MathBackendWebGL(customCanvas)'.");const h=u.writeTexture(r,e,s,i,o,l);return $i().makeTensorFromDataId(h,e,s,u)}}Px.nextDataId=0;function Sat(n,t){if(t==="float32"||t==="complex64")return n;if(t==="int32"||t==="bool"){const e=t==="int32"?new Int32Array(n.length):new Uint8Array(n.length);for(let s=0;s<e.length;++s)e[s]=Math.round(n[s]);return e}else throw new Error(`Unknown dtype ${t}`)}/**
 * @license
 * Copyright 2020 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */yD()&&vD("webgl",()=>new Px,2);/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const KT=`
  if (isnan(a)) return a;
  if (isnan(b)) return b;
`;class pu{constructor(t,e,s){this.variableNames=["A","B"],this.outputShape=ne(e,s),this.enableShapeUniforms=ks(this.outputShape.length),this.userCode=`
      float binaryOperation(float a, float b) {
        ${t}
      }

      void main() {
        float a = getAAtOutCoords();
        float b = getBAtOutCoords();
        setOutput(binaryOperation(a, b));
      }
    `}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const ku=`
  result.r = isNaN.r ? NAN : result.r;
  result.g = isNaN.g ? NAN : result.g;
  result.b = isNaN.b ? NAN : result.b;
  result.a = isNaN.a ? NAN : result.a;
`;class wh{constructor(t,e,s,r=!1){this.variableNames=["A","B"],this.supportsBroadcasting=!0,this.packedInputs=!0,this.packedOutput=!0,this.outputShape=ne(e,s);const i=this.outputShape.length;this.enableShapeUniforms=ks(i);let o="";if(r)if(i===0||yt(this.outputShape)===1)o=`
          result.y = 0.;
          result.z = 0.;
          result.w = 0.;
        `;else if(o=`
          ${He(i)} coords = getOutputCoords();
        `,i===1)this.enableShapeUniforms?o+=`
            result.y = (coords + 1) >= outShape ? 0. : result.y;
            result.z = 0.;
            result.w = 0.;
          `:o+=`
            result.y = (coords + 1) >= ${this.outputShape[0]} ? 0. : result.y;
            result.z = 0.;
            result.w = 0.;
          `;else{const u=Ls("coords",i);this.enableShapeUniforms?o+=`
            bool nextRowOutOfBounds =
              (${u[i-2]} + 1) >= outShape[${i} - 2];
            bool nextColOutOfBounds =
              (${u[i-1]} + 1) >= outShape[${i} - 1];
            result.y = nextColOutOfBounds ? 0. : result.y;
            result.z = nextRowOutOfBounds ? 0. : result.z;
            result.w = nextColOutOfBounds || nextRowOutOfBounds ? 0. : result.w;
          `:o+=`
            bool nextRowOutOfBounds =
              (${u[i-2]} + 1) >= ${this.outputShape[i-2]};
            bool nextColOutOfBounds =
              (${u[i-1]} + 1) >= ${this.outputShape[i-1]};
            result.y = nextColOutOfBounds ? 0. : result.y;
            result.z = nextRowOutOfBounds ? 0. : result.z;
            result.w = nextColOutOfBounds || nextRowOutOfBounds ? 0. : result.w;
          `}this.userCode=`
      vec4 binaryOperation(vec4 a, vec4 b) {
        ${t}
      }

      void main() {
        vec4 a = getAAtOutCoords();
        vec4 b = getBAtOutCoords();

        vec4 result = binaryOperation(a, b);
        ${o}

        setOutput(result);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function cr(n){const{inputs:t,backend:e}=n,{x:s}=t;return e.incRef(s.dataId),{dataId:s.dataId,shape:s.shape,dtype:s.dtype}}const Tat={kernelName:Zf,backendName:"webgl",kernelFunc:cr};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function ol(n){const{inputs:t,backend:e}=n,{real:s,imag:r}=t,i=e.makeTensorInfo(s.shape,"complex64"),o=e.texData.get(i.dataId),l=cr({inputs:{x:s},backend:e}),u=cr({inputs:{x:r},backend:e});return o.complexTensorInfos={real:l,imag:u},i}const Eat={kernelName:_C,backendName:"webgl",kernelFunc:ol};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const ML="return (a < 0.) ? b * a : a;",FL=`
  vec4 aLessThanZero = vec4(lessThan(a, vec4(0.)));
  return (aLessThanZero * (b * a)) + ((vec4(1.0) - aLessThanZero) * a);
`;function Iat(n){const{inputs:t,backend:e,attrs:s}=n,{x:r}=t,{alpha:i}=s,o=e.makeTensorInfo([],"float32",Qa(i,"float32")),l=dt().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new wh(FL,r.shape,o.shape):new pu(ML,r.shape,o.shape),u=e.runWebGLProgram(l,[r,o],"float32");return e.disposeIntermediateTensorInfo(o),u}const _at={kernelName:O0,backendName:"webgl",kernelFunc:Iat};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const LL="return (a < 0.) ? b * a : a;",PL=`
  vec4 aLessThanZero = vec4(lessThan(a, vec4(0.)));
  return (aLessThanZero * (b * a)) + ((vec4(1.0) - aLessThanZero) * a);
`;function kat(n){const{inputs:t,backend:e}=n,{x:s,alpha:r}=t,i=dt().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new wh(PL,s.shape,r.shape):new pu(LL,s.shape,r.shape);return e.runWebGLProgram(i,[s,r],"float32")}const Aat={kernelName:J0,backendName:"webgl",kernelFunc:kat};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Ch="if (isnan(x)) return x;";function Ce({opSnippet:n,packedOpSnippet:t,cpuKernelImpl:e,dtype:s}){return({inputs:r,backend:i})=>{const{x:o}=r,l=i,u=s||o.dtype;if(l.shouldExecuteOnCPU([o])&&e!=null){const p=l.texData.get(o.dataId),m=e(p.values,u);return l.makeTensorInfo(o.shape,u,m)}const h=dt().getBool("WEBGL_PACK_UNARY_OPERATIONS")&&t!=null;let d;return h?d=new ka(o.shape,t):d=new Pi(o.shape,n),l.runWebGLProgram(d,[o],u)}}function ds({opSnippet:n,packedOpSnippet:t,checkOutOfBounds:e=!1,supportsComplex:s=!1,cpuKernelImpl:r,dtype:i}){return({inputs:o,backend:l})=>{const{a:u,b:h}=o,d=l;if(s&&u.dtype==="complex64"){const x=d.texData.get(u.dataId),v=d.texData.get(h.dataId),[C,S]=[[x.complexTensorInfos.real,v.complexTensorInfos.real],[x.complexTensorInfos.imag,v.complexTensorInfos.imag]].map(_=>{const[I,O]=_,P={dataId:I.dataId,dtype:I.dtype,shape:u.shape},D={dataId:O.dataId,dtype:O.dtype,shape:h.shape},N=new pu(n,u.shape,h.shape);return d.runWebGLProgram(N,[P,D],lr(I.dtype,O.dtype))}),E=ol({inputs:{real:C,imag:S},backend:d});return d.disposeIntermediateTensorInfo(C),d.disposeIntermediateTensorInfo(S),E}const p=i||lr(u.dtype,h.dtype);if((u.dtype==="string"||h.dtype==="string"||d.shouldExecuteOnCPU([u,h]))&&r!=null){const x=d.texData.get(u.dataId).values,v=d.texData.get(h.dataId).values,C=u.dtype==="string"?Go(x):x,S=u.dtype==="string"?Go(v):v,[E,_]=r(u.shape,h.shape,C,S,p),I=d.makeTensorInfo(_,p),O=d.texData.get(I.dataId);return O.values=E,I}const m=dt().getBool("WEBGL_PACK_BINARY_OPERATIONS")&&t!=null;let y;return m?y=new wh(t,u.shape,h.shape,e):y=new pu(n,u.shape,h.shape),d.runWebGLProgram(y,[u,h],p)}}function wf(n,t=!1){if(n==="linear")return t?cat:iat;if(n==="relu")return t?dat:aat;if(n==="elu")return t?hat:oat;if(n==="relu6")return t?fat:lat;if(n==="prelu")return t?PL:LL;if(n==="leakyrelu")return t?FL:ML;if(n==="sigmoid")return t?pat:uat;throw new Error(`Activation ${n} has not been implemented for the WebGL backend.`)}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class VL{constructor(t,e,s,r=!1,i=!1,o=!1,l=null,u=!1,h=!1){this.variableNames=["matrixA","matrixB"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=s,this.enableShapeUniforms=ks(this.outputShape.length);const d=r?t[1]:t[2],p=Math.ceil(d/2),m=r?"i * 2, rc.y":"rc.y, i * 2",y=i?"rc.z, i * 2":"i * 2, rc.z",x=r?["a.xxyy","a.zzww"]:["a.xxzz","a.yyww"],v=i?["b.xzxz","b.ywyw"]:["b.xyxy","b.zwzw"];let C="",S="";l&&(u?C=`vec4 activation(vec4 a) {
          vec4 b = getPreluActivationWeightsAtOutCoords();
          ${l}
        }`:h?C=`vec4 activation(vec4 a) {
          vec4 b = getLeakyreluAlphaAtOutCoords();
          ${l}
        }`:C=`vec4 activation(vec4 x) {
          ${l}
        }`,S="result = activation(result);");const E=o?"result += getBiasAtOutCoords();":"";o&&this.variableNames.push("bias"),u&&this.variableNames.push("preluActivationWeights"),h&&this.variableNames.push("leakyreluAlpha");let _="rc.x",I="rc.x";t[0]<e[0]?_=`imod(rc.x, ${t[0]})`:e[0]<t[0]&&(I=`imod(rc.x, ${e[0]})`),this.userCode=`
      ${C}
      // Don't use uniform for sharedDimensionPacked for performance.
      const float sharedDimension = ${p}.0;

      vec4 dot2x2ARowBCol(ivec3 rc) {
        vec4 result = vec4(0);
        int batchA = ${_};
        int batchB = ${I};
        for (int i = 0; i < ${p}; i++) {
          vec4 a = getMatrixA(batchA, ${m});
          vec4 b = getMatrixB(batchB, ${y});

          // These swizzled products need to be separately added.
          // See: https://github.com/tensorflow/tfjs/issues/1735
          result += (${x[0]} * ${v[0]});
          result += (${x[1]} * ${v[1]});
        }
        return result;
      }

      void main() {
        ivec3 rc = getOutputCoords();
        vec4 result = dot2x2ARowBCol(rc);

        ${E}

        ${S}

        setOutput(result);
      }
    `}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const sN={REAL:"return areal * breal - aimag * bimag;",IMAG:"return areal * bimag + aimag * breal;"};class rN{constructor(t,e,s){this.variableNames=["AReal","AImag","BReal","BImag"],this.outputShape=ne(e,s),this.userCode=`
      float binaryOpComplex(
          float areal, float aimag, float breal, float bimag) {
        ${t}
      }

      void main() {
        float areal = getARealAtOutCoords();
        float aimag = getAImagAtOutCoords();
        float breal = getBRealAtOutCoords();
        float bimag = getBImagAtOutCoords();
        setOutput(binaryOpComplex(areal, aimag, breal, bimag));
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const iN="return a * b;";function XT(n){const{inputs:t,backend:e}=n,{a:s,b:r}=t,i=lr(s.dtype,r.dtype);if(s.dtype==="complex64"){const l=e.texData.get(s.dataId),u=e.texData.get(r.dataId),h=new rN(sN.REAL,s.shape,r.shape),d=new rN(sN.IMAG,s.shape,r.shape),p=[{dataId:l.complexTensorInfos.real.dataId,dtype:l.complexTensorInfos.real.dtype,shape:s.shape},{dataId:l.complexTensorInfos.imag.dataId,dtype:l.complexTensorInfos.imag.dtype,shape:s.shape},{dataId:u.complexTensorInfos.real.dataId,dtype:u.complexTensorInfos.real.dtype,shape:r.shape},{dataId:u.complexTensorInfos.imag.dataId,dtype:u.complexTensorInfos.imag.dtype,shape:r.shape}],m=e.runWebGLProgram(h,p,"float32"),y=e.runWebGLProgram(d,p,"float32"),x=ol({inputs:{real:m,imag:y},backend:e});return e.disposeIntermediateTensorInfo(m),e.disposeIntermediateTensorInfo(y),x}if(e.shouldExecuteOnCPU([s,r])){const l=e.texData.get(s.dataId),u=e.texData.get(r.dataId),[h,d]=kot(s.shape,r.shape,l.values,u.values,i),p=e.makeTensorInfo(d,i),m=e.texData.get(p.dataId);return m.values=h,p}let o;return dt().getBool("WEBGL_PACK_BINARY_OPERATIONS")?o=new wh(iN,s.shape,r.shape):o=new pu(iN,s.shape,r.shape),e.runWebGLProgram(o,[s,r],i)}const Nat={kernelName:ap,backendName:"webgl",kernelFunc:XT};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Rat(n,t,e){const s=[Jc(n.shape),...th(n.shape)],r={dtype:n.dtype,shape:s,dataId:n.dataId},i=[Jc(t),...th(t)],o=new OL(i,s),l=!0,u=[s],h=e.runWebGLProgram(o,[r],n.dtype,u,l);return{dataId:h.dataId,shape:t,dtype:h.dtype}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Nt(n){const{inputs:t,backend:e,attrs:s}=n,{x:r}=t,{shape:i}=s,o=e,l=yt(r.shape),u=N$(i,l),h=yt(u);U(l===h,()=>`The new shape (${u}) has ${h} elements and the old shape (${r.shape}) has ${l} elements. The new shape and old shape must have the same number of elements.`);const d=o.texData.get(r.dataId);return d.isPacked&&!qy(r.shape,u)&&!(d.texture!==null&&qy(d.shape,u))?Rat(r,u,o):(o.incRef(r.dataId),{dataId:r.dataId,shape:u,dtype:r.dtype})}const $at={kernelName:ex,backendName:"webgl",kernelFunc:Nt};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class oN{constructor(t,e){this.variableNames=["x"];const{windowSize:s,batchSize:r,inSize:i,outSize:o}=t;this.outputShape=[r,o];const l=Math.floor(s/4)*4,u=s%4;let h="sumValue += dot(values, ones);";if(e!=null){const p=1/e;h=`sumValue += dot(values * ${Wc(p)?p.toPrecision(2):p}, ones);`}let d="";i%s>0&&(d=`
        if (inIdx < 0 || inIdx >= ${i}) {
          return 0.0;
        }
      `),this.userCode=`
      const vec4 ones = vec4(1.0, 1.0, 1.0, 1.0);

      float getValue(int batch, int inIdx) {
        ${d}
        return getX(batch, inIdx);
      }

      void main() {
        ivec2 coords = getOutputCoords();
        int batch = coords[0];
        int outIdx = coords[1];
        int inOffset = outIdx * ${s};

        float sumValue = 0.0;

        for (int i = 0; i < ${l}; i += 4) {
          int inIdx = inOffset + i;
          vec4 values = vec4(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1),
            getValue(batch, inIdx + 2),
            getValue(batch, inIdx + 3)
          );

          ${h}
        }

        int inIdx = inOffset + ${l};
        if (${u===1}) {
          vec4 values = vec4(getValue(batch, inIdx), 0.0, 0.0, 0.0);

          ${h}
        } else if (${u===2}) {
          vec4 values = vec4(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1), 0.0, 0.0);

          ${h}
        } else if (${u===3}) {
          vec4 values = vec4(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1),
            getValue(batch, inIdx + 2), 0.0);

          ${h}
        }
        setOutput(sumValue);
      }
    `}}/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Dat{constructor(t,e){this.variableNames=["x"];const{windowSize:s,batchSize:r,inSize:i,outSize:o}=t;this.outputShape=[r,o];let l="0.0",u="";e==="prod"?l="1.0":e==="min"?(l="1.0 / 1e-20",u="min"):e==="max"&&(l="-1.0 / 1e-20",u="max");let h=`${e}(${e}(${e}(minMaxValue[0], minMaxValue[1]), minMaxValue[2]), minMaxValue[3])`;e==="sum"?h="sumValue":e==="prod"?h="prodValue":e==="all"?h="allValue":e==="any"&&(h="anyValue");const d=Math.floor(s/4)*4,p=s%4;let m=`
      if (${e==="sum"}) {
        sumValue += dot(values, ones);
      } else if (${e==="prod"}) {
        vec2 tmp = vec2(values[0], values[1]) * vec2(values[2], values[3]);
        prodValue *= tmp[0] * tmp[1];
      } else {
        minMaxValue = ${u}(values, minMaxValue);
        if (${e==="min"} || ${e==="max"}) {
          minMaxValue = ${u}(values, minMaxValue);
          bvec4 isNaN = isnan(values);
          if (isNaN.r || isNaN.g || isNaN.b || isNaN.a) {
            minMaxValue = vec4(NAN);
          }
        }
      }
    `,y="vec4";e==="all"?(l="1.0",m=`
        bool reducedAllValue = all(values);
        float floatedReducedAllValue = float(reducedAllValue);
        allValue = float(allValue >= 1.0 && floatedReducedAllValue >= 1.0);
      `,y="bvec4"):e==="any"&&(l="0.0",m=`
        bool reducedAnyValue = any(values);
        float floatedReducedAnyValue = float(reducedAnyValue);
        anyValue = float(anyValue >= 1.0 || floatedReducedAnyValue >= 1.0);
      `,y="bvec4");let x="";i%s>0&&(x=`
        if (inIdx < 0 || inIdx >= ${i}) {
          return initializationValue;
        }
      `),this.userCode=`
      const float initializationValue = ${l};
      const vec4 ones = vec4(1.0, 1.0, 1.0, 1.0);

      float getValue(int batch, int inIdx) {
        ${x}
        return getX(batch, inIdx);
      }

      void main() {
        ivec2 coords = getOutputCoords();
        int batch = coords[0];
        int outIdx = coords[1];
        int inOffset = outIdx * ${s};

        vec4 minMaxValue = vec4(${l});
        float prodValue = 1.0;
        float sumValue = 0.0;
        float allValue = 1.0;
        float anyValue = 0.0;

        for (int i = 0; i < ${d}; i += 4) {
          int inIdx = inOffset + i;
          ${y} values = ${y}(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1),
            getValue(batch, inIdx + 2),
            getValue(batch, inIdx + 3)
          );

          ${m}
        }

        int inIdx = inOffset + ${d};
        if (${p===1}) {
          ${y} values = ${y}(
            getValue(batch, inIdx),
            initializationValue,
            initializationValue,
            initializationValue
          );

          ${m}
        } else if (${p===2}) {
          ${y} values = ${y}(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1),
            initializationValue,
            initializationValue
          );

          ${m}
        } else if (${p===3}) {
          ${y} values = ${y}(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1),
            getValue(batch, inIdx + 2),
            initializationValue
          );

          ${m}
        }
        setOutput(${h});
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Oat(n){const t=[];for(;t.length===0||t[t.length-1].outSize!==1;){const e=t.length?t[t.length-1].outSize:n[1],s=Cx(e);t.push({inSize:e,windowSize:s,outSize:Math.ceil(e/s)})}return t}function Au(n,t,e,s){const r=Oat(n.shape);let i=n;for(let o=0;o<r.length;o++){const{inSize:l,windowSize:u,outSize:h}=r[o];let d,p;e==="mean"?d=o===0?new oN({windowSize:u,inSize:l,batchSize:n.shape[0],outSize:h},l):new oN({windowSize:u,inSize:l,batchSize:n.shape[0],outSize:h}):d=new Dat({windowSize:u,inSize:l,batchSize:n.shape[0],outSize:h},e),p=i,i=s.runWebGLProgram(d,[i],t),p.dataId!==n.dataId&&s.disposeIntermediateTensorInfo(p)}return i}/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Mat{constructor(t,e){this.variableNames=["A"];const s=new Array(t.length);for(let o=0;o<s.length;o++)s[o]=t[e[o]];this.outputShape=s,this.rank=s.length;const r=He(this.rank),i=Fat(e);this.userCode=`
    void main() {
      ${r} resRC = getOutputCoords();
      setOutput(getA(${i}));
    }
    `}}function Fat(n){const t=n.length;if(t>6)throw Error(`Transpose for rank ${t} is not yet supported`);const e=["resRC.x","resRC.y","resRC.z","resRC.w","resRC.u","resRC.v"],s=new Array(t);for(let r=0;r<n.length;r++)s[n[r]]=e[r];return s.join()}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Lat{constructor(t,e){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0;const s=new Array(t.length);for(let d=0;d<s.length;d++)s[d]=t[e[d]];if(this.outputShape=s,this.rank=s.length,this.rank>6)throw Error(`Packed transpose for rank ${this.rank} is not yet supported.`);const r=He(this.rank),i=DL("rc",this.rank),o=new Array(this.rank);for(let d=0;d<e.length;d++)o[e[d]]=i[d];const l=`vec2(${o.slice(-2).join()})`,u=`++${i[this.rank-1]} < ${s[this.rank-1]}`,h=`getChannel(getA(${o.join()}), ${l})`;this.userCode=`
    void main() {
      ${r} rc = getOutputCoords();
      vec4 result = vec4(0.);
      result[0] = ${h};
      if(${u}) {
        result[1] = ${h};
      }
      --${i[this.rank-1]};
      if(++${i[this.rank-2]} < ${s[this.rank-2]}) {
        result[2] = ${h};
        if(${u}) {
          result[3] = ${h};
        }
      }
      setOutput(result);
    }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Vx(n,t,e){const s=dt().getBool("WEBGL_PACK_ARRAY_OPERATIONS")?new Lat(n.shape,t):new Mat(n.shape,t);return e.runWebGLProgram(s,[n],n.dtype)}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Pat(n,t,e,s){const r=t,i=n.shape.length,o=le(r,n.shape);let l=o;const u=hn(l,i),h=u!=null;let d=n;h&&(d=Vx(n,u,s),l=Cn(l.length,i)),hs("sum",l,i);const[p,m]=es(d.shape,l);let y=p;e&&(y=Nn(p,o));const x=yt(m),C=yt(n.shape)/x,S=Nt({inputs:{x:d},attrs:{shape:[C,x]},backend:s}),E=aS(n.dtype),_=Au(S,E,"sum",s),I=Nt({inputs:{x:_},attrs:{shape:y},backend:s});return s.disposeIntermediateTensorInfo(S),s.disposeIntermediateTensorInfo(_),h&&s.disposeIntermediateTensorInfo(d),I}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function zx(n){const{inputs:t,backend:e,attrs:s}=n,{x:r}=t,{axis:i,keepDims:o}=s;return Pat(r,i,o,e)}const Vat={kernelName:ax,backendName:"webgl",kernelFunc:zx};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Vs(n){const{inputs:t,backend:e,attrs:s}=n,{x:r}=t,{perm:i}=s,o=e,l=r.shape.length,u=new Array(l);for(let d=0;d<u.length;d++)u[d]=r.shape[i[d]];let h;if(o.shouldExecuteOnCPU([r])){const p=o.texData.get(r.dataId).values,m=jT(p,r.shape,r.dtype,i,u);h=o.makeTensorInfo(u,r.dtype);const y=o.texData.get(h.dataId);y.values=m}else h=Vx(r,i,o);return h}const zat={kernelName:Dc,backendName:"webgl",kernelFunc:Vs};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const zL=1e3;function jy({a:n,b:t,transposeA:e,transposeB:s,backend:r,bias:i=null,preluActivationWeights:o=null,leakyreluAlpha:l=0,activation:u=null}){const h=n.shape.length,d=t.shape.length,p=e?n.shape[h-2]:n.shape[h-1],m=s?t.shape[d-1]:t.shape[d-2],y=e?n.shape[h-1]:n.shape[h-2],x=s?t.shape[d-2]:t.shape[d-1],v=n.shape.slice(0,-2),C=t.shape.slice(0,-2),S=yt(v),E=yt(C),I=ne(n.shape.slice(0,-2),t.shape.slice(0,-2)).concat([y,x]);U(p===m,()=>`Error in matMul: inner shapes (${p}) and (${m}) of Tensors with shapes ${n.shape} and ${t.shape} and transposeA=${e} and transposeB=${s} must match.`);const O=e?[S,p,y]:[S,y,p],P=s?[E,x,m]:[E,m,x],D=Nt({inputs:{x:n},backend:r,attrs:{shape:O}}),N=Nt({inputs:{x:t},backend:r,attrs:{shape:P}}),R=[D,N],$=Math.max(S,E),A=e?D.shape[1]:D.shape[2],V=i!=null,L=o!=null,nt=u==="leakyrelu",Z=u!=null?wf(u,!0):null,W=V||L||nt||Z!=null;let K;if((y===1||x===1)&&A>zL&&W===!1){let at=D,B=N;e&&(at=Vs({inputs:{x:D},backend:r,attrs:{perm:[0,2,1]}}),R.push(at)),s&&(B=Vs({inputs:{x:N},backend:r,attrs:{perm:[0,2,1]}}),R.push(B));const j=x!==1,st=x===1;let tt=at;j&&(tt=Nt({inputs:{x:at},backend:r,attrs:{shape:[$,A,1]}}),R.push(tt));const xt=x===1?2:1;let vt=B;st&&(vt=Nt({inputs:{x:B},backend:r,attrs:{shape:[$,1,A]}}),R.push(vt));const Ct=XT({inputs:{a:tt,b:vt},backend:r});K=zx({inputs:{x:Ct},backend:r,attrs:{axis:xt,keepDims:!0}}),R.push(Ct)}else{const at=lr(n.dtype,t.dtype),B=new VL(O,P,[$,y,x],e,s,V,Z,L,nt),j=[D,N];if(i!=null&&j.push(i),L&&j.push(o),nt){const st=r.makeTensorInfo([],"float32",Qa(l,"float32"));j.push(st),R.push(st)}K=r.runWebGLProgram(B,j,at)}const Y=Nt({inputs:{x:K},backend:r,attrs:{shape:I}});R.push(K);for(const at of R)r.disposeIntermediateTensorInfo(at);return Y}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Bat(n){const{inputs:t,backend:e,attrs:s}=n,{a:r,b:i,bias:o,preluActivationWeights:l}=t,{transposeA:u,transposeB:h,activation:d,leakyreluAlpha:p}=s;return jy({a:r,b:i,transposeA:u,transposeB:h,backend:e,bias:o,preluActivationWeights:l,leakyreluAlpha:p,activation:d})}const Uat={kernelName:wy,backendName:"webgl",kernelFunc:Bat};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const aN="return abs(x);";function Gat(n){const{inputs:t,backend:e}=n,{x:s}=t;if(e.shouldExecuteOnCPU([s])&&s.dtype!=="complex64"){const i=e.texData.get(s.dataId),o=RL(i.values);return e.makeTensorInfo(s.shape,s.dtype,o)}let r;return dt().getBool("WEBGL_PACK_UNARY_OPERATIONS")?r=new ka(s.shape,aN):r=new Pi(s.shape,aN),e.runWebGLProgram(r,[s],s.dtype)}const Wat={kernelName:p0,backendName:"webgl",kernelFunc:Gat};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Hat=Yr+`
  if (abs(x) > 1.) {
    return NAN;
  }
  return acos(x);
`,qat=Ce({opSnippet:Hat}),jat={kernelName:$f,backendName:"webgl",kernelFunc:qat};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Kat=Yr+`
  if (x < 1.0) return NAN;
return log(x + sqrt(x * x - 1.0));`,Xat=Ce({opSnippet:Kat}),Yat={kernelName:Df,backendName:"webgl",kernelFunc:Xat};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const lN="return a + b;",Qat=ds({opSnippet:lN,packedOpSnippet:lN,supportsComplex:!0,cpuKernelImpl:aot}),Zat={kernelName:ch,backendName:"webgl",kernelFunc:Qat};/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Jat{constructor(t,e){this.outputShape=[],this.outputShape=t,this.variableNames=e.map((i,o)=>`T${o}`);const s=[];this.variableNames.forEach(i=>{s.push(`float v${i} = get${i}AtOutCoords();`)});const r=this.variableNames.map(i=>`v${i}`).join(" + ");this.userCode=`
      void main() {
        ${s.join(`
        `)}

        float result = ${r};
        setOutput(result);
      }
    `}}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class tlt{constructor(t,e){this.outputShape=[],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=t,this.variableNames=e.map((i,o)=>`T${o}`);const s=[];this.variableNames.forEach(i=>{s.push(`vec4 v${i} = get${i}AtOutCoords();`)});const r=this.variableNames.map(i=>`v${i}`).join(" + ");this.userCode=`
      void main() {
        ${s.join(`
        `)}

        vec4 result = ${r};
        setOutput(result);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function ey(n){const{inputs:t,backend:e}=n,s=t;if(s.length===1)return cr({inputs:{x:s[0]},backend:e});if(s.length>dt().getNumber("WEBGL_MAX_TEXTURES_IN_SHADER")){const u=Math.floor(s.length/2),h=ey({inputs:s.slice(0,u),backend:e}),d=ey({inputs:s.slice(u),backend:e});return ey({inputs:[h,d],backend:e})}const r=s.map(u=>u.dtype).reduce((u,h)=>lr(u,h)),i=s.map(u=>u.shape),l=dt().getBool("WEBGL_PACK")?new tlt(s[0].shape,i):new Jat(s[0].shape,i);return e.runWebGLProgram(l,s,r)}const elt={kernelName:vC,backendName:"webgl",kernelFunc:ey};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function nlt(n){const{inputs:t,backend:e,attrs:s}=n,{x:r}=t,{axis:i,keepDims:o}=s,l=r.shape.length,u=le(i,r.shape);let h=u;const d=hn(h,l);let p=r;d!=null&&(p=Vs({inputs:{x:r},backend:e,attrs:{perm:d}}),h=Cn(h.length,l)),hs("all",h,l);const[m,y]=es(p.shape,h),x=yt(y),v=Nt({inputs:{x:p},backend:e,attrs:{shape:[-1,x]}}),C=Au(v,v.dtype,"all",e);let S;if(o){const E=Nn(m,u);S=Nt({inputs:{x:C},backend:e,attrs:{shape:E}})}else S=Nt({inputs:{x:C},backend:e,attrs:{shape:m}});return e.disposeIntermediateTensorInfo(v),e.disposeIntermediateTensorInfo(C),d!=null&&e.disposeIntermediateTensorInfo(p),S}const slt={kernelName:wC,backendName:"webgl",kernelFunc:nlt};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function rlt(n){const{inputs:t,backend:e,attrs:s}=n,{x:r}=t,{axis:i,keepDims:o}=s,l=r.shape.length,u=le(i,r.shape);let h=u;const d=hn(h,l);let p=r;d!=null&&(p=Vs({inputs:{x:r},backend:e,attrs:{perm:d}}),h=Cn(h.length,l)),hs("any",h,l);const[m,y]=es(p.shape,h),x=yt(y),v=Nt({inputs:{x:p},backend:e,attrs:{shape:[-1,x]}}),C=Au(v,v.dtype,"any",e);let S;if(o){const E=Nn(m,u);S=Nt({inputs:{x:C},backend:e,attrs:{shape:E}})}else S=Nt({inputs:{x:C},backend:e,attrs:{shape:m}});return e.disposeIntermediateTensorInfo(v),e.disposeIntermediateTensorInfo(C),d!=null&&e.disposeIntermediateTensorInfo(p),S}const ilt={kernelName:CC,backendName:"webgl",kernelFunc:rlt};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class olt{constructor(t,e,s){this.variableNames=["A"];const{windowSize:r,batchSize:i,outSize:o}=t;s||this.variableNames.push("bestIndicesA"),this.outputShape=[i,o];const l=e==="max"?">":"<",u=s?"inOffset + i;":"round(getBestIndicesA(batch, inOffset + i));";this.userCode=`
      void main() {
        ivec2 coords = getOutputCoords();
        int batch = coords[0];
        int outIdx = coords[1];
        int inOffset = outIdx * ${r};

        int bestIndex = inOffset;
        float bestValue = getA(batch, bestIndex);

        for (int i = 0; i < ${r}; i++) {
          int inIdx = ${u};
          float candidate = getA(batch, inIdx);
          if (candidate ${l} bestValue) {
            bestValue = candidate;
            bestIndex = inIdx;
          }
        }
        setOutput(float(bestIndex));
      }
    `}}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class alt{constructor(t,e,s,r){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,U(t.length>2,()=>`Packed arg${s.charAt(0).toUpperCase()+s.slice(1)} supports only inputs with rank above 2.`);const i=t[t.length-1],o=Math.ceil(i/e);this.outputShape=t.slice(0,-1),o>1&&this.outputShape.push(o),r||this.variableNames.push("bestIndicesA");const l=this.outputShape,u=l.length,h=He(u),d=Ls("coords",u);let p,m;if(o===1){m=u+1;const N=He(m);p=`
        ${N} sourceLocR = ${N}(${d.join()}, 0);
        ++${d[u-1]};
        ${N} sourceLocG = ${N}(${d.join()}, 0);
        ++${d[u-2]};
        ${N} sourceLocA = ${N}(${d.join()}, 0);
        --${d[u-1]};
        ${N} sourceLocB = ${N}(${d.join()}, 0);
        --${d[u-2]};`}else m=u,p=`
        ${h} sourceLocR = coords;
        ++${d[u-1]};
        ${h} sourceLocG = coords;
        ++${d[u-2]};
        ${h} sourceLocA = coords;
        --${d[u-1]};
        ${h} sourceLocB = coords;
        --${d[u-2]};`;const y=["x","y","z","w","u","v"].slice(0,m),x="."+y[m-1],v=y.map(N=>"int "+N),C=Ls("sourceLocR",m-1).concat("inIdx.r"),S=Ls("sourceLocG",m-1).concat("inIdx.g"),E=Ls("sourceLocB",m-1).concat("inIdx.b"),_=Ls("sourceLocA",m-1).concat("inIdx.a"),I=s==="max"?"greaterThan":"lessThan",O=r?"":`
          inIdx = round(vec4(getBestIndicesAChannel(${C.join()}),
                             getBestIndicesAChannel(${S.join()}),
                             getBestIndicesAChannel(${E.join()}),
                             getBestIndicesAChannel(${_.join()})));`,P=`vec4(
            getAChannel(${C.join()}),
            hasNextCol ? getAChannel(${S.join()}) : 0.,
            hasNextRow ? getAChannel(${E.join()}) : 0.,
            hasNextRow && hasNextCol ? getAChannel(${_.join()}) : 0.)`,D=r?"":`
      float getBestIndicesAChannel(${v.join()}) {
        return getChannel(getBestIndicesA(${y.join()}),
                                          vec2(${y.slice(-2).join()}));
      }`;this.userCode=`
      float getAChannel(${v.join()}) {
        return getChannel(getA(${y.join()}),
                               vec2(${y.slice(-2).join()}));
      }
      ${D}
      void main() {
        ${h} coords = getOutputCoords();
        bool hasNextCol = ${d[u-1]} < ${l[u-1]-1};
        bool hasNextRow = ${d[u-2]} < ${l[u-2]-1};
        ${p}
        ivec4 srcIdx = ivec4(sourceLocR${x}, sourceLocG${x},
          sourceLocB${x}, sourceLocA${x}) * ${e};
        ivec4 inIdx = srcIdx;
        vec4 bestIndex = vec4(inIdx);
        vec4 bestValue = ${P};

        for (int i = 0; i < ${e}; i++) {
          inIdx = srcIdx;
          ${O}
          vec4 candidate = ${P};
          bvec4 nan = isnan(candidate);
          bvec4 replace = bvec4(
            vec4(${I}(candidate, bestValue)) * (vec4(1.0) - vec4(nan)));

          bestValue = vec4(replace.x  ? candidate.x : bestValue.x,
                           replace.y  ? candidate.y : bestValue.y,
                           replace.z  ? candidate.z : bestValue.z,
                           replace.w  ? candidate.w : bestValue.w);
          bestIndex = mix(bestIndex, vec4(inIdx), vec4(replace));
          srcIdx++;
        }
        setOutput(bestIndex);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function BL(n,t,e,s=null){let r=t.shape[0],i=t.shape[1];s!=null&&(r=s.shape[0],i=s.shape[1]);const o=Cx(i),l={windowSize:o,inSize:i,batchSize:r,outSize:Math.ceil(i/o)},u=new olt(l,e,s==null),h=[t];s!=null&&h.push(s);const d=n.runWebGLProgram(u,h,"int32");if(d.shape[1]===1)return d;const p=BL(n,t,e,d);return n.disposeIntermediateTensorInfo(d),p}function UL(n,t,e,s=null){const r=s!=null?s.shape:t.shape,i=r[r.length-1],o=Cx(i),l=new alt(r,o,e,s==null),u=s==null?[t]:[t,s],h=n.runWebGLProgram(l,u,"int32");if(h.shape.length===t.shape.length){const d=UL(n,t,e,h);return n.disposeIntermediateTensorInfo(h),d}return h}function GL(n,t,e,s){const r=[e];if(hs("arg"+s.charAt(0).toUpperCase()+s.slice(1),r,t.shape.length),!dt().getBool("WEBGL_PACK_REDUCE")||t.shape.length<=2){const i=[],o=n.texData.get(t.dataId),l=o!==null&&o.isPacked;let u=t;l&&(u=n.unpackTensor(t),i.push(u));const[h,d]=es(u.shape,r),p=yt(d),m=Nt({inputs:{x:u},backend:n,attrs:{shape:[-1,p]}});i.push(m);const y=BL(n,m,s);i.push(y);const x=Nt({inputs:{x:y},backend:n,attrs:{shape:h}});return i.forEach(v=>n.disposeIntermediateTensorInfo(v)),x}return UL(n,t,s)}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function llt(n){const{inputs:t,backend:e,attrs:s}=n,{x:r}=t,{axis:i}=s;let o=le(i,r.shape);const l=hn(o,r.shape.length);let u=r;const h=[];l!=null&&(u=Vs({inputs:{x:r},backend:e,attrs:{perm:l}}),h.push(u),o=Cn(o.length,u.shape.length)),hs("argMax",[o[0]],u.shape.length);const d=GL(e,u,o[0],"max");return h.forEach(p=>e.disposeIntermediateTensorInfo(p)),d}const ult={kernelName:m0,backendName:"webgl",kernelFunc:llt};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function clt(n){const{inputs:t,backend:e,attrs:s}=n,{x:r}=t,{axis:i}=s;let o=le(i,r.shape);const l=hn(o,r.shape.length);let u=r;const h=[];l!=null&&(u=Vs({inputs:{x:r},backend:e,attrs:{perm:l}}),h.push(u),o=Cn(o.length,u.shape.length)),hs("argMin",[o[0]],u.shape.length);const d=GL(e,u,o[0],"min");return h.forEach(p=>e.disposeIntermediateTensorInfo(p)),d}const hlt={kernelName:g0,backendName:"webgl",kernelFunc:clt};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const dlt=Yr+`
  if (abs(x) > 1.) {
    return NAN;
  }
  return asin(x);
`,flt=Ce({opSnippet:dlt}),plt={kernelName:Of,backendName:"webgl",kernelFunc:flt};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const mlt=Yr+"return log(x + sqrt(x * x + 1.0));",glt=Ce({opSnippet:mlt}),ylt={kernelName:Mf,backendName:"webgl",kernelFunc:glt};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const xlt=Yr+`
  return atan(x);
`,blt=Ce({opSnippet:xlt}),vlt={kernelName:Ff,backendName:"webgl",kernelFunc:blt};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const wlt=KT+`
  return atan(a, b);
`,Clt=`
  vec4 result = atan(a, b);
  bvec4 isNaNA = isnan(a);
  bvec4 isNaNB = isnan(b);
  bvec4 isNaN = bvec4(isNaNA.x || isNaNB.x, isNaNA.y || isNaNB.y, isNaNA.z || isNaNB.z, isNaNA.w || isNaNB.w);
  `+ku+`
  return result;
`,Slt=ds({opSnippet:wlt,packedOpSnippet:Clt}),Tlt={kernelName:Pf,backendName:"webgl",kernelFunc:Slt};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Elt=Yr+`
  if ((x < -1.0) || (x > 1.0)) return NAN;
return (log(1.0 + x) - log(1.0 - x)) / 2.0;`,Ilt=Ce({opSnippet:Elt}),_lt={kernelName:Lf,backendName:"webgl",kernelFunc:Ilt};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Cf{constructor(t,e,s,r=!1,i=!1){if(this.variableNames=["x"],e==="avg"&&s)throw new Error("Cannot compute positions for average pool.");const o=t.filterWidth,l=t.strideHeight,u=t.strideWidth,h=t.dilationHeight,d=t.dilationWidth,p=t.effectiveFilterHeight,m=t.effectiveFilterWidth,y=t.padInfo.top,x=t.padInfo.left;this.outputShape=t.outShape;const v=e==="avg",C=`((batch  * ${t.inHeight} + xR) * ${t.inWidth} + xC) * ${t.inChannels} + d`,S=`(xR * ${t.inWidth} + xC) * ${t.inChannels} + d`;let E="0.0";if(v||(E="-1.0 / 1e-20"),s){const N=">=";this.userCode=`
        const ivec2 strides = ivec2(${l}, ${u});
        const ivec2 pads = ivec2(${y}, ${x});

        void main() {
          ivec4 coords = getOutputCoords();
          int batch = coords[0];
          int d = coords[3];

          ivec2 xRCCorner = coords.yz * strides - pads;
          int xRCorner = xRCCorner.x;
          int xCCorner = xRCCorner.y;

          // max/min x(?, ?, d) to get y(yR, yC, d).
          // ? = to be determined
          float minMaxValue = 0.0;
          float minMaxValueFound = 0.0;
          int minMaxPosition = 0;
          float avgValue = 0.0;

          for (int wR = 0; wR < ${p};
              wR += ${h}) {
            int xR = xRCorner + wR;

            if (xR < 0 || xR >= ${t.inHeight}) {
              continue;
            }

            for (int wC = 0; wC < ${m};
                wC += ${d}) {
              int xC = xCCorner + wC;

              if (xC < 0 || xC >= ${t.inWidth}) {
                continue;
              }

              float value = getX(batch, xR, xC, d);

              // If a min / max value has already been found, use it. If not,
              // use the current value.
              float currMinMaxValue = mix(
                  value, minMaxValue, minMaxValueFound);
              if (value ${N} currMinMaxValue) {
                minMaxValue = value;
                minMaxValueFound = 1.0;
                minMaxPosition = ${r?i?C:S:`wR * ${m} + wC`};
              }
            }
          }
          setOutput(float(minMaxPosition));
        }
      `;return}const _="max";let I=`${e}(${e}(${e}(minMaxValue[0], minMaxValue[1]), minMaxValue[2]), minMaxValue[3])`;e==="avg"&&(I="avgValue / max(count, 1.0)");const O=Math.floor(o/4)*4,P=o%4,D=`
      if (${v}) {
        avgValue += dot(values, ones);
      } else {
        minMaxValue = ${_}(values, minMaxValue);
      }
    `;this.userCode=`
      const ivec2 strides = ivec2(${l}, ${u});
      const ivec2 pads = ivec2(${y}, ${x});
      const float initializationValue = ${E};
      const vec4 ones = vec4(1.0, 1.0, 1.0, 1.0);

      float count = 0.0;

      float getValue(int batch, int xR, int xC, int d) {
        if (xC < 0 || xC >= ${t.inWidth}) {
          return initializationValue;
        }
        count += 1.0;
        return getX(batch, xR, xC, d);
      }

      void main() {
        ivec4 coords = getOutputCoords();
        int batch = coords[0];
        int d = coords[3];

        ivec2 xRCCorner = coords.yz * strides - pads;
        int xRCorner = xRCCorner.x;
        int xCCorner = xRCCorner.y;

        // max/min x(?, ?, d) to get y(yR, yC, d).
        // ? = to be determined
        vec4 minMaxValue = vec4(${E});
        float avgValue = 0.0;
        count = 0.0;

        for (int wR = 0; wR < ${p};
            wR += ${h}) {
          int xR = xRCorner + wR;

          if (xR < 0 || xR >= ${t.inHeight}) {
            continue;
          }

          for (int wC = 0; wC < ${O}; wC += 4) {
            int xC = xCCorner + wC * ${d};

            vec4 values = vec4(
              getValue(batch, xR, xC, d),
              getValue(batch, xR, xC + ${d}, d),
              getValue(batch, xR, xC + 2 * ${d}, d),
              getValue(batch, xR, xC + 3 * ${d}, d)
            );

            ${D}
          }

          int xC = xCCorner + ${O};
          if (${P===1}) {
            vec4 values = vec4(
              getValue(batch, xR, xC, d),
              initializationValue,
              initializationValue,
              initializationValue
            );

            ${D}
          } else if (${P===2}) {
            vec4 values = vec4(
              getValue(batch, xR, xC, d),
              getValue(batch, xR, xC + ${d}, d),
              initializationValue,
              initializationValue
            );

            ${D}
          } else if (${P===3}) {
            vec4 values = vec4(
              getValue(batch, xR, xC, d),
              getValue(batch, xR, xC + ${d}, d),
              getValue(batch, xR, xC + 2 * ${d}, d),
              initializationValue
            );

            ${D}
          }
        }
        setOutput(${I});
      }
    `}}class YT{constructor(t,e,s,r=!1,i=!1){if(this.variableNames=["x"],e==="avg"&&s)throw new Error("Cannot compute positions for average pool.");const o=t.filterWidth,l=t.strideDepth,u=t.strideHeight,h=t.strideWidth,d=t.dilationDepth,p=t.dilationHeight,m=t.dilationWidth,y=t.effectiveFilterDepth,x=t.effectiveFilterHeight,v=t.effectiveFilterWidth,C=t.padInfo.front,S=t.padInfo.top,E=t.padInfo.left;this.outputShape=t.outShape;const _=e==="avg";let I="0.0";if(_||(I="-1.0 / 1e-20"),s){const $=">=";this.userCode=`
        const ivec3 strides =
            ivec3(${l}, ${u}, ${h});
        const ivec3 pads = ivec3(${C}, ${S}, ${E});

        void main() {
          ivec5 coords = getOutputCoords();
          int batch = coords.x;
          int ch = coords.u;

          ivec3 xCorner = ivec3(coords.y, coords.z, coords.w) * strides - pads;
          int xDCorner = xCorner.x;
          int xRCorner = xCorner.y;
          int xCCorner = xCorner.z;

          // max/min x(?, ?, ?, ch) to get y(yD, yR, yC, ch).
          // ? = to be determined
          float minMaxValue = 0.0;
          float minMaxValueFound = 0.0;
          int minMaxPosition = 0;

          for (int wD = 0; wD < ${y};
              wD += ${d}) {
            int xD = xDCorner + wD;

            if (xD < 0 || xD >= ${t.inDepth}) {
              continue;
            }

            for (int wR = 0; wR < ${x};
                wR += ${p}) {
              int xR = xRCorner + wR;

              if (xR < 0 || xR >= ${t.inHeight}) {
                continue;
              }

              for (int wC = 0; wC < ${v};
                  wC += ${m}) {
                int xC = xCCorner + wC;

                if (xC < 0 || xC >= ${t.inWidth}) {
                  continue;
                }

                float value = getX(batch, xD, xR, xC, ch);

                // If a min / max value has already been found, use it. If not,
                // use the current value.
                float currMinMaxValue = mix(
                    value, minMaxValue, minMaxValueFound);
                if (value ${$} currMinMaxValue) {
                  minMaxValue = value;
                  minMaxValueFound = 1.0;
                  minMaxPosition = ${r?i?`(((batch * ${t.inDepth} + xD) * ${t.inHeight} + xR) * ${t.inWidth} + xC) * ${t.inChannels} + ch`:`((xD * ${t.inHeight} + xR) * ${t.inWidth} + xC) * ${t.inChannels} + ch`:`wD * ${x} * ${v} +
                      wR * ${v} + wC`};
                }
              }
            }
          }
          setOutput(float(minMaxPosition));
        }
      `;return}const O="max";let P=`${e}(${e}(${e}(minMaxValue[0], minMaxValue[1]), minMaxValue[2]), minMaxValue[3])`;e==="avg"&&(P="avgValue / max(count, 1.0)");const D=Math.floor(o/4)*4,N=o%4,R=`
      if (${_}) {
        avgValue += dot(values, ones);
      } else {
        minMaxValue = ${O}(values, minMaxValue);
      }
    `;this.userCode=`
      const ivec3 strides =
        ivec3(${l}, ${u}, ${h});
      const ivec3 pads = ivec3(${C}, ${S}, ${E});
      const float initializationValue = ${I};
      const vec4 ones = vec4(1.0, 1.0, 1.0, 1.0);

      float count = 0.0;

      float getValue(int batch, int xD, int xR, int xC, int ch) {
        if (xC < 0 || xC >= ${t.inWidth}) {
          return initializationValue;
        }
        count += 1.0;
        return getX(batch, xD, xR, xC, ch);
      }

      void main() {
        ivec5 coords = getOutputCoords();
        int batch = coords.x;
        int ch = coords.u;

        ivec3 xCorner = ivec3(coords.y, coords.z, coords.w) * strides - pads;
        int xDCorner = xCorner.x;
        int xRCorner = xCorner.y;
        int xCCorner = xCorner.z;

        // max/min x(?, ?, ?, d) to get y(yD, yR, yC, ch).
        // ? = to be determined
        vec4 minMaxValue = vec4(${I});
        float avgValue = 0.0;
        count = 0.0;

        for (int wD = 0; wD < ${y};
            wD += ${d}) {
          int xD = xDCorner + wD;

          if (xD < 0 || xD >= ${t.inDepth}) {
            continue;
          }

          for (int wR = 0; wR < ${x};
            wR += ${p}) {
            int xR = xRCorner + wR;

            if (xR < 0 || xR >= ${t.inHeight}) {
              continue;
            }

            for (int wC = 0; wC < ${D}; wC += 4) {
              int xC = xCCorner + wC * ${m};

              vec4 values = vec4(
                getValue(batch, xD, xR, xC, ch),
                getValue(batch, xD, xR, xC + ${m}, ch),
                getValue(batch, xD, xR, xC + 2 * ${m}, ch),
                getValue(batch, xD, xR, xC + 3 * ${m}, ch)
              );

              ${R}
            }

            int xC = xCCorner + ${D};
            if (${N===1}) {
              vec4 values = vec4(
                getValue(batch, xD, xR, xC, ch),
                initializationValue,
                initializationValue,
                initializationValue
              );

              ${R}
            } else if (${N===2}) {
              vec4 values = vec4(
                getValue(batch, xD, xR, xC, ch),
                getValue(batch, xD, xR, xC + ${m}, ch),
                initializationValue,
                initializationValue
              );

              ${R}
            } else if (${N===3}) {
              vec4 values = vec4(
                getValue(batch, xD, xR, xC, ch),
                getValue(batch, xD, xR, xC + ${m}, ch),
                getValue(batch, xD, xR, xC + 2 * ${m}, ch),
                initializationValue
              );

              ${R}
            }
          }
        }
        setOutput(${P});
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function klt(n){const{inputs:t,backend:e,attrs:s}=n,{x:r}=t;jp(r,"avgPool");const{filterSize:i,strides:o,pad:l,dimRoundingMode:u}=s,h=1;U(Is(o,h),()=>`Error in avgPool: Either strides or dilations must be 1. Got strides ${o} and dilations '${h}'`);const d=Kr(r.shape,i,o,h,l,u);if(d.filterWidth===1&&d.filterHeight===1&&Oe(d.inShape,d.outShape))return cr({inputs:{x:r},backend:e});const p=new Cf(d,"avg",!1);return e.runWebGLProgram(p,[r],"float32")}const Alt={kernelName:y0,backendName:"webgl",kernelFunc:klt};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Nlt(n){const{inputs:t,backend:e,attrs:s}=n,{x:r}=t,{filterSize:i,strides:o,pad:l,dimRoundingMode:u,dataFormat:h}=s,d=[1,1,1],p=qo(r.shape,i,o,d,l,u,h),m=new YT(p,"avg",!1);return e.runWebGLProgram(m,[r],"float32")}const Rlt={kernelName:x0,backendName:"webgl",kernelFunc:Nlt};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class $lt{constructor(t){this.variableNames=["dy"],this.outputShape=t.inShape;const e=t.filterHeight,s=t.filterWidth,r=t.strideHeight,i=t.strideWidth,o=t.dilationHeight,l=t.dilationWidth,u=t.effectiveFilterHeight,h=t.effectiveFilterWidth,d=u-1-t.padInfo.top,p=h-1-t.padInfo.left,m=1/(e*s);this.userCode=`
      const ivec2 pads = ivec2(${d}, ${p});
      const float avgMultiplier = float(${m});

      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];

        ivec2 dyRCCorner = coords.yz - pads;
        int dyRCorner = dyRCCorner.x;
        int dyCCorner = dyRCCorner.y;

        // Convolve dy(?, ?, d) with pos mask(:, :, d) to get dx(xR, xC, d).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;
        for (int wR = 0; wR < ${u};
            wR += ${o}) {
          float dyR = float(dyRCorner + wR) / ${r}.0;

          if (dyR < 0.0 || dyR >= ${t.outHeight}.0 || fract(dyR) > 0.0) {
            continue;
          }
          int idyR = int(dyR);

          for (int wC = 0; wC < ${h};
            wC+= ${l}) {
            float dyC = float(dyCCorner + wC) / ${i}.0;

            if (dyC < 0.0 || dyC >= ${t.outWidth}.0 ||
                fract(dyC) > 0.0) {
              continue;
            }
            int idyC = int(dyC);

            float dyValue = getDy(b, idyR, idyC, d);

            dotProd += dyValue * avgMultiplier;
          }
        }
        setOutput(dotProd);
      }
    `}}class Dlt{constructor(t){this.variableNames=["dy"],this.outputShape=t.inShape;const e=t.filterDepth,s=t.filterHeight,r=t.filterWidth,i=t.strideDepth,o=t.strideHeight,l=t.strideWidth,u=t.dilationDepth,h=t.dilationHeight,d=t.dilationWidth,p=t.effectiveFilterDepth,m=t.effectiveFilterHeight,y=t.effectiveFilterWidth,x=p-1-t.padInfo.front,v=m-1-t.padInfo.top,C=y-1-t.padInfo.left,S=1/(e*s*r);this.userCode=`
      const ivec3 pads = ivec3(${x}, ${v}, ${C});
      const float avgMultiplier = float(${S});

      void main() {
        ivec5 coords = getOutputCoords();
        int batch = coords.x;
        int ch = coords.u;

        ivec3 dyCorner = ivec3(coords.y, coords.z, coords.w) - pads;
        int dyDCorner = dyCorner.x;
        int dyRCorner = dyCorner.y;
        int dyCCorner = dyCorner.z;

        // Convolve dy(?, ?, ?, d) with pos mask(:, :, :, ch) to get
        // dx(xD, xR, xC, ch).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;

        for (int wD = 0; wD < ${p};
            wD += ${u}) {
          float dyD = float(dyDCorner + wD) / ${i}.0;

          if (dyD < 0.0 || dyD >= ${t.outDepth}.0 || fract(dyD) > 0.0) {
            continue;
          }
          int idyD = int(dyD);

          for (int wR = 0; wR < ${m};
              wR += ${h}) {
            float dyR = float(dyRCorner + wR) / ${o}.0;

            if (dyR < 0.0 || dyR >= ${t.outHeight}.0 ||
                fract(dyR) > 0.0) {
              continue;
            }
            int idyR = int(dyR);

            for (int wC = 0; wC < ${y};
                wC += ${d}) {
              float dyC = float(dyCCorner + wC) / ${l}.0;

              if (dyC < 0.0 || dyC >= ${t.outWidth}.0 ||
                  fract(dyC) > 0.0) {
                continue;
              }
              int idyC = int(dyC);

              float dyValue = getDy(batch, idyD, idyR, idyC, ch);

              dotProd += dyValue * avgMultiplier;
            }
          }
        }
        setOutput(dotProd);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Olt(n){const{inputs:t,backend:e,attrs:s}=n,{dy:r,input:i}=t,o=i,{filterSize:l,strides:u,pad:h,dimRoundingMode:d}=s,p=[1,1,1],m=qo(o.shape,l,u,p,h,d),y=new Dlt(m);return e.runWebGLProgram(y,[r],o.dtype)}const Mlt={kernelName:TC,backendName:"webgl",kernelFunc:Olt};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Flt(n){const{inputs:t,backend:e,attrs:s}=n,{dy:r,input:i}=t,o=i;jp([r,i],"avgPoolGrad");const{filterSize:l,strides:u,pad:h}=s,d=Kr(o.shape,l,u,1,h),p=new $lt(d);return e.runWebGLProgram(p,[r],o.dtype)}const Llt={kernelName:SC,backendName:"webgl",kernelFunc:Flt};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Plt(n){const{inputs:t,backend:e,attrs:s}=n,{a:r,b:i}=t,{transposeA:o,transposeB:l}=s;return jy({a:r,b:i,transposeA:o,transposeB:l,backend:e})}const Vlt={kernelName:b0,backendName:"webgl",kernelFunc:Plt};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class zlt{constructor(t,e,s,r,i,o){this.outputShape=[],this.variableNames=["x","mean","variance"],ne(t,e),ne(t,s);let l="0.0";r!=null&&(ne(t,r),this.variableNames.push("offset"),l="getOffsetAtOutCoords()");let u="1.0";i!=null&&(ne(t,i),this.variableNames.push("scale"),u="getScaleAtOutCoords()"),this.outputShape=t,this.userCode=`
      void main() {
        float x = getXAtOutCoords();
        float mean = getMeanAtOutCoords();
        float variance = getVarianceAtOutCoords();
        float offset = ${l};
        float scale = ${u};
        float inv = scale * inversesqrt(variance + float(${o}));
        setOutput(dot(vec3(x, -mean, offset), vec3(inv, inv, 1)));
      }
    `}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Blt{constructor(t,e,s,r,i,o){this.packedInputs=!0,this.packedOutput=!0,this.variableNames=["x","mean","variance"],ne(t,e),ne(t,s);let l="vec4(0.0)";r!=null&&(ne(t,r),this.variableNames.push("offset"),l="getOffsetAtOutCoords()");let u="vec4(1.0)";i!=null&&(ne(t,i),this.variableNames.push("scale"),u="getScaleAtOutCoords()"),this.outputShape=t,this.userCode=`
      void main() {
        vec4 offset = ${l};
        vec4 scale = ${u};

        vec4 x = getXAtOutCoords();
        vec4 mean = getMeanAtOutCoords();
        vec4 variance = getVarianceAtOutCoords();

        vec4 inv = scale * inversesqrt(variance + vec4(${o}));

        setOutput((x - mean) * inv + offset);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Ult=({inputs:n,backend:t,attrs:e})=>{const{x:s,mean:r,variance:i,offset:o,scale:l}=n;U(r.shape.length===i.shape.length,()=>"Batch normalization gradient requires mean and variance to have equal ranks."),U(o==null||r.shape.length===o.shape.length,()=>"Batch normalization gradient requires mean and offset to have equal ranks."),U(l==null||r.shape.length===l.shape.length,()=>"Batch normalization gradient requires mean and scale to have equal ranks.");let{varianceEpsilon:u}=e;u==null&&(u=.001);const h=[s,r,i];let d=null;o!=null&&(d=o.shape,h.push(o));let p=null;l!=null&&(p=l.shape,h.push(l));const m=dt().getBool("WEBGL_PACK_NORMALIZATION")?new Blt(s.shape,r.shape,i.shape,d,p,u):new zlt(s.shape,r.shape,i.shape,d,p,u);return t.runWebGLProgram(m,h,h[0].dtype)},Glt={kernelName:R0,backendName:"webgl",kernelFunc:Ult};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Wlt{constructor(t){this.variableNames=["source"],this.outputShape=t,this.rank=t.length;const e=He(this.rank);this.customUniforms=[{name:"start",arrayIndex:this.rank,type:"int"}];const s=Hlt(this.rank);let r;const i=t.map((o,l)=>`sourceLoc.${_w[l]} = start[${l}] + coords.${_w[l]};`);r=`
        ${e} sourceLoc;
        ${e} coords = getOutputCoords();
        ${i.join(`
`)}
      `,this.userCode=`
      void main() {
        ${r}
        setOutput(getSource(${s}));
      }
    `}}const _w=["x","y","z","w","u","v"];function Hlt(n){if(n===1)return"sourceLoc";if(n<=6)return _w.slice(0,n).map(t=>"sourceLoc."+t).join(",");throw Error(`Slicing for rank ${n} is not yet supported`)}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class qlt{constructor(t){this.variableNames=["source"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=t,this.rank=t.length,this.customUniforms=[{name:"start",arrayIndex:this.rank,type:"int"}];const e=He(this.rank),s=Ls("coords",this.rank),r=Ls("sourceLoc",this.rank),i=this.rank===1?"sourceLoc":`vec2(${r.slice(-2).join()})`,o=`getChannel(getSource(${r.join()}), ${i})`,l=`
      result.x = ${o};
      if (++${s[this.rank-1]} < ${t[this.rank-1]}) {
        ++${r[this.rank-1]};
        result.y = ${o};
        --${r[this.rank-1]};
      }
    `,u=this.rank===1?"":`
      --${s[this.rank-1]};
      if (++${s[this.rank-2]} < ${t[this.rank-2]}) {
        ++${r[this.rank-2]};
        result.z = ${o};
        if (++${s[this.rank-1]} < ${t[this.rank-1]}) {
          ++${r[this.rank-1]};
          result.w = ${o};
        }
      }
    `,h=this.rank<=4?`sourceLoc = coords +
            ${e}(${t.map((d,p)=>`start[${p}]`).join()});`:t.map((d,p)=>`${r[p]} = ${s[p]} + start[${p}];`).join(`
`);this.userCode=`
      void main() {
        ${e} coords = getOutputCoords();
        ${e} sourceLoc;
        ${h}
        vec4 result = vec4(0.);
        ${l}
        ${u}
        setOutput(result);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function jlt(n,t,e,s){const r=s.texData.get(n.dataId),i=s.makeTensorInfo(e,n.dtype),o=s.texData.get(i.dataId);Object.assign(o,r),o.refCount=1,o.shape=e,o.dtype=n.dtype;let l=HS(t,zt(n.shape));r.slice&&(l+=r.slice.flatOffset),o.slice={flatOffset:l,origDataId:r.slice&&r.slice.origDataId||n.dataId};const u=s.dataRefCount.get(o.slice.origDataId)||1;return s.dataRefCount.set(o.slice.origDataId,u+1),i}function Sh(n){const{inputs:t,backend:e,attrs:s}=n,{x:r}=t,{begin:i,size:o}=s,[l,u]=wx(r,i,o);if(US(r,l,u),yt(u)===0)return e.makeTensorInfo(u,r.dtype,[]);if(e.shouldExecuteOnCPU([r])||r.dtype==="string"){const p=e.texData.get(r.dataId),m=Vot(p.values,l,u,r.shape,r.dtype);return e.makeTensorInfo(u,r.dtype,m)}const{isPacked:h}=e.texData.get(r.dataId),d=WS(r.shape,l,u);if(h||!d){const p=dt().getBool("WEBGL_PACK_ARRAY_OPERATIONS")?new qlt(u):new Wlt(u),m=[l];return e.runWebGLProgram(p,[r],r.dtype,m)}return e.uploadToGPU(r.dataId),jlt(r,l,u,e)}const Klt={kernelName:ox,backendName:"webgl",kernelFunc:Sh};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Xlt=n=>{const{inputs:t,backend:e,attrs:s}=n,{x:r}=t,{blockShape:i,crops:o}=s;U(r.shape.length<=4,()=>"batchToSpaceND for rank > 4 with a WebGL backend not implemented yet");const l=i.reduce((E,_)=>E*_),u=Op(r.shape,i,l),h=Mp(u.length,i.length),d=Fp(r.shape,i,l),p=YS(o,i.length),m=QS(d,o,i.length),y=[],x=Nt({inputs:{x:r},backend:e,attrs:{shape:u}}),v=Vs({inputs:{x},backend:e,attrs:{perm:h}}),C=Nt({inputs:{x:v},backend:e,attrs:{shape:d}}),S=Sh({inputs:{x:C},backend:e,attrs:{begin:p,size:m}});return y.push(x),y.push(v),y.push(C),y.forEach(E=>e.disposeIntermediateTensorInfo(E)),S},Ylt={kernelName:v0,backendName:"webgl",kernelFunc:Xlt};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Qlt(n){const{inputs:t,backend:e,attrs:s}=n,{x:r,weights:i}=t,{size:o}=s,l=e.readSync(r.dataId),u=e.readSync(i.dataId),h=NL(l,u,i.dtype,i.shape,o);return e.makeTensorInfo([o],i.dtype,h)}const Zlt={kernelName:EC,backendName:"webgl",kernelFunc:Qlt};/**
 * @license
 * Copyright 2023 Google LLC.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Jlt=`
  int r = int(a.r) & int(b.r);
  int g = int(a.g) & int(b.g);
  int rb = int(a.b) & int(b.b);
  int ra = int(a.a) & int(b.a);
  return vec4(r, g, rb, ra);
`,tut=`
  return float(int(a.r) & int(b.r));
`;function eut(n){const{inputs:t,backend:e}=n,{a:s,b:r}=t,i=dt().getBool("WEBGL_PACK_BINARY_OPERATIONS"),o=dt().getNumber("WEBGL_VERSION");if(e.shouldExecuteOnCPU([s,r])||o===1){const u=e.texData.get(s.dataId).values,h=e.texData.get(r.dataId).values,[d,p]=uot(s.shape,r.shape,u,h,s.dtype),m=e.makeTensorInfo(p,s.dtype),y=e.texData.get(m.dataId);return y.values=d,m}let l;return i?l=new wh(Jlt,s.shape,r.shape,!1):l=new pu(tut,s.shape,r.shape),e.runWebGLProgram(l,[s,r],s.dtype)}const nut={kernelName:IC,backendName:"webgl",kernelFunc:eut};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function sut(n){const{inputs:t,backend:e}=n,{s0:s,s1:r}=t,i=e.readSync(s.dataId),o=e.readSync(r.dataId),l=ne(Array.from(i),Array.from(o));return e.makeTensorInfo([l.length],"int32",Int32Array.from(l))}const rut={kernelName:F$,backendName:"webgl",kernelFunc:sut};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const iut="return float(a != b);",WL=ds({opSnippet:iut,cpuKernelImpl:Not,dtype:"bool"}),out={kernelName:K0,backendName:"webgl",kernelFunc:WL};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Xp(n){const{inputs:t,backend:e}=n,{input:s}=t,r=e.texData.get(s.dataId);return cr({inputs:{x:r.complexTensorInfos.real},backend:e})}const aut={kernelName:QC,backendName:"webgl",kernelFunc:Xp};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const lut="return float(int(x));";function uut(n,t){const e=new Pi(n.shape,lut),s=t.runWebGLProgram(e,[n],"int32");return{dataId:s.dataId,shape:s.shape,dtype:s.dtype}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function kw(n){const{inputs:t,backend:e,attrs:s}=n,{x:r}=t,{dtype:i}=s;if(i==="complex64"){if(r.dtype==="complex64")return cr({inputs:{x:r},backend:e});const o=Qn(r.shape),l=kw({inputs:{x:r},backend:e,attrs:{dtype:"float32"}}),u=ol({inputs:{real:l,imag:o},backend:e});return o.dispose(),e.disposeIntermediateTensorInfo(l),u}if(r.dtype==="complex64"){const o=Xp({inputs:{input:r},backend:e}),l=kw({inputs:{x:o},backend:e,attrs:{dtype:i}});return e.disposeIntermediateTensorInfo(o),l}if(!R$(r.dtype,i)){const o=cr({inputs:{x:r},backend:e});return{dataId:o.dataId,shape:o.shape,dtype:i}}if(e.shouldExecuteOnCPU([r])){const o=e.texData.get(r.dataId).values,[l,u,h]=cot(o,r.shape,r.dtype,i);return e.makeTensorInfo(l,u,h)}if(i==="int32")return uut(r,e);if(i==="bool"){const o=e.makeTensorInfo([],"bool",Ss("bool",1)),u=WL({inputs:{a:r,b:o},backend:e});return e.disposeIntermediateTensorInfo(o),u}throw new Error(`Error in Cast: failed to cast ${r.dtype} to ${i}`)}const cut={kernelName:Vf,backendName:"webgl",kernelFunc:kw};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const uN="return ceil(x);",hut=Ce({opSnippet:uN,packedOpSnippet:uN,cpuKernelImpl:hot}),dut={kernelName:zf,backendName:"webgl",kernelFunc:hut};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class fut{constructor(t){this.variableNames=["A"],this.customUniforms=[{name:"minVal",type:"float"},{name:"maxVal",type:"float"}],this.outputShape=t,this.userCode=`

      void main() {
        float value = getAAtOutCoords();
        if (isnan(value)) {
          setOutput(value);
          return;
        }

        setOutput(clamp(value, minVal, maxVal));
      }
    `}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class put{constructor(t){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.customUniforms=[{name:"minVal",type:"float"},{name:"maxVal",type:"float"}],this.outputShape=t,this.userCode=`
      void main() {
        vec4 value = getAAtOutCoords();

        if (any(isnan(value))) {
          setOutput(value);
          return;
        }

        setOutput(clamp(value, vec4(minVal), vec4(maxVal)));
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function mut(n){const{inputs:t,backend:e,attrs:s}=n,{x:r}=t,{clipValueMin:i,clipValueMax:o}=s;let l;dt().getBool("WEBGL_PACK_CLIP")?l=new put(r.shape):l=new fut(r.shape);const u=[[i],[o]];return e.runWebGLProgram(l,[r],r.dtype,u)}const gut={kernelName:Bf,backendName:"webgl",kernelFunc:mut};/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class yut{constructor(t){this.variableNames=["real","imag"],this.outputShape=t,this.userCode=`
      void main() {
        float re = abs(getRealAtOutCoords());
        float im = abs(getImagAtOutCoords());
        float mx = max(re, im);

        // sadly the length function in glsl is not underflow-safe
        // (at least not on Intel GPUs). So the safe solution is
        // to ensure underflow-safety in all cases.
        setOutput(
          mx == 0.0 ? 0.0 : mx * length(vec2(1, min(re, im)/mx))
        );
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function cN(n,t){return{dataId:t.dataId,dtype:t.dtype,shape:n.shape}}function xut(n){const{inputs:t,backend:e}=n,{x:s}=t,r=e.texData.get(s.dataId),i=new yut(s.shape),o=[cN(s,r.complexTensorInfos.real),cN(s,r.complexTensorInfos.imag)];return e.runWebGLProgram(i,o,o[0].dtype)}const but={kernelName:w0,backendName:"webgl",kernelFunc:xut};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class vut{constructor(t){this.outputShape=[],this.outputShape=Gi(t,1),this.variableNames=t.map((o,l)=>`T${l}`);const e=new Array(t.length-1);e[0]=t[0][1];for(let o=1;o<e.length;o++)e[o]=e[o-1]+t[o][1];const s=[`if (yC < ${e[0]}) setOutput(getT0(yR, yC));`];for(let o=1;o<e.length;o++){const l=e[o-1];s.push(`else if (yC < ${e[o]}) setOutput(getT${o}(yR, yC-${l}));`)}const r=e.length,i=e[e.length-1];s.push(`else setOutput(getT${r}(yR, yC-${i}));`),this.userCode=`
      void main() {
        ivec2 coords = getOutputCoords();
        int yR = coords.x;
        int yC = coords.y;

        ${s.join(`
        `)}
      }
    `}}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class wut{constructor(t,e){this.packedInputs=!0,this.packedOutput=!0,this.outputShape=[],this.outputShape=Gi(t,e);const s=this.outputShape,r=s.length,i=He(r),o=Ls("coords",r),l=["x","y","z","w","u","v"].slice(0,r);this.variableNames=t.map((v,C)=>`T${C}`);const u=new Array(t.length-1);u[0]=t[0][e];for(let v=1;v<u.length;v++)u[v]=u[v-1]+t[v][e];const h=l[e],d=l.slice(-2),p=l.join();let m=`if (${h} < ${u[0]}) {
        return getChannel(
            getT0(${p}), vec2(${d.join()}));
        }`;for(let v=1;v<u.length;v++){const C=u[v-1];m+=`
        if (${h} < ${u[v]}  && ${h} >= ${u[v-1]}) {
          return getChannel(
            getT${v}(${Lg(l,h,C)}),
            vec2(${Lg(d,h,C)}));
        }`}const y=u.length,x=u[u.length-1];m+=`
        return getChannel(
          getT${y}(${Lg(l,h,x)}),
          vec2(${Lg(d,h,x)}));`,this.userCode=`
      float getValue(${l.map(v=>"int "+v)}) {
        ${m}
      }

      void main() {
        ${i} coords = getOutputCoords();
        vec4 result = vec4(getValue(${o}), 0., 0., 0.);

        ${o[r-1]} = ${o[r-1]} + 1;
        if (${o[r-1]} < ${s[r-1]}) {
          result.g = getValue(${o});
        }

        ${o[r-2]} = ${o[r-2]} + 1;
        if (${o[r-2]} < ${s[r-2]}) {
          result.a = getValue(${o});
        }

        ${o[r-1]} = ${o[r-1]} - 1;
        if (${o[r-2]} < ${s[r-2]} &&
            ${o[r-1]} < ${s[r-1]}) {
          result.b = getValue(${o});
        }
        setOutput(result);
      }
    `}}function Lg(n,t,e){const s=n.indexOf(t);return n.map((i,o)=>o===s?`${i} - ${e}`:i).join()}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Bx(n){const{inputs:t,backend:e}=n,{input:s}=t,r=e.texData.get(s.dataId);return cr({inputs:{x:r.complexTensorInfos.imag},backend:e})}const Cut={kernelName:GC,backendName:"webgl",kernelFunc:Bx};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Hd(n,t,e){const s=n[0].dtype;if(s==="complex64"){const y=n.map(E=>Xp({inputs:{input:E},backend:e})),x=n.map(E=>Bx({inputs:{input:E},backend:e})),v=Hd(y,t,e),C=Hd(x,t,e),S=ol({inputs:{real:v,imag:C},backend:e});return y.forEach(E=>e.disposeIntermediateTensorInfo(E)),x.forEach(E=>e.disposeIntermediateTensorInfo(E)),e.disposeIntermediateTensorInfo(v),e.disposeIntermediateTensorInfo(C),S}let r=e.shouldExecuteOnCPU(n);if(s==="string"&&(r=!0),r){const y=n.map(I=>{const P=[-1,yt(I.shape.slice(t))];return Nt({inputs:{x:I},backend:e,attrs:{shape:P}})}),x=y.map(I=>({vals:e.readSync(I.dataId),shape:I.shape})),v=Gi(y.map(I=>I.shape),1),C=y[0].shape[0]===1,S=dot(x,v,s,C),E=Gi(n.map(I=>I.shape),t),_=e.makeTensorInfo(E,s,S);return y.forEach(I=>e.disposeIntermediateTensorInfo(I)),_}const i=n.filter(y=>yt(y.shape)>0),o=dt().getBool("WEBGL_PACK_ARRAY_OPERATIONS")&&i[0].shape.length>1;if(i.length===1){const y=o?new Pi(n[0].shape,Ta):new ka(n[0].shape,Ta);return e.runWebGLProgram(y,n,s)}const l=dt().getNumber("WEBGL_MAX_TEXTURES_IN_SHADER");if(i.length>l){const y=[];for(let v=0;v<i.length;v+=l){const C=i.slice(v,v+l);y.push(Hd(C,t,e))}const x=Hd(y,t,e);for(const v of y)e.disposeIntermediateTensorInfo(v);return x}if(o){const y=new wut(i.map(x=>x.shape),t);return e.runWebGLProgram(y,i,s)}const{tensors2D:u,outShape:h}=Sut(i,t,e),d=new vut(u.map(y=>y.shape)),p=e.runWebGLProgram(d,u,s);u.forEach(y=>e.disposeIntermediateTensorInfo(y));const m=Nt({inputs:{x:p},attrs:{shape:h},backend:e});return e.disposeIntermediateTensorInfo(p),m}function Sut(n,t,e){const s=Gi(n.map(i=>i.shape),t);return{tensors2D:n.map(i=>Nt({inputs:{x:i},attrs:{shape:[-1,yt(i.shape.slice(t))]},backend:e})),outShape:s}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function HL(n){const{inputs:t,backend:e,attrs:s}=n,{axis:r}=s,i=le(r,t[0].shape)[0],o=t.map(h=>h.shape);jS(o,i);const l=Gi(t.map(h=>h.shape),i);if(yt(l)===0)return e.makeTensorInfo(l,t[0].dtype,[]);const u=t.filter(h=>yt(h.shape)>0);return u.length===1?cr({inputs:{x:u[0]},backend:e}):Hd(u,i,e)}const Tut={kernelName:C0,backendName:"webgl",kernelFunc:HL};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class qL{constructor(t,e=!1,s=null,r=!1,i=!1){this.variableNames=["x","W"],this.outputShape=t.outShape;const o=t.padInfo.top,l=t.padInfo.left,u=t.strideHeight,h=t.strideWidth,d=t.dilationHeight,p=t.dilationWidth,m=t.filterHeight,y=t.filterWidth,x=Math.floor(t.inChannels/4)*4,v=t.inChannels%4,C=t.dataFormat==="channelsLast",S=C?1:2,E=C?2:3,_=C?3:1;let I="",O="";s&&(r?I=`float activation(float a) {
          float b = getPreluActivationWeightsAtOutCoords();
          ${s}
        }`:i?I=`float activation(float a) {
          float b = getLeakyreluAlphaAtOutCoords();
          ${s}
        }`:I=`
          float activation(float x) {
            ${s}
          }
        `,O="result = activation(result);");const P=e?"result += getBiasAtOutCoords();":"";e&&this.variableNames.push("bias"),r&&this.variableNames.push("preluActivationWeights"),i&&this.variableNames.push("leakyreluAlpha"),this.userCode=`
      ${I}

      const ivec2 strides = ivec2(${u}, ${h});
      const ivec2 pads = ivec2(${o}, ${l});

      void main() {
        ivec4 coords = getOutputCoords();
        int batch = coords[0];
        int d2 = coords[${_}];

        ivec2 xRCCorner =
            ivec2(coords[${S}], coords[${E}]) * strides - pads;
        int xRCorner = xRCCorner.x;
        int xCCorner = xRCCorner.y;

        // Convolve x(?, ?, d1) with w(:, :, d1, d2) to get y(yR, yC, d2).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;
        for (int wR = 0; wR < ${m}; wR++) {
          int xR = xRCorner + wR * ${d};

          if (xR < 0 || xR >= ${t.inHeight}) {
            continue;
          }

          for (int wC = 0; wC < ${y}; wC++) {
            int xC = xCCorner + wC * ${p};

            if (xC < 0 || xC >= ${t.inWidth}) {
              continue;
            }

            for (int d1 = 0; d1 < ${x}; d1 += 4) {
              vec4 wValues = vec4(
                getW(wR, wC, d1, d2),
                getW(wR, wC, d1 + 1, d2),
                getW(wR, wC, d1 + 2, d2),
                getW(wR, wC, d1 + 3, d2)
              );

              if (${C}) {
                vec4 xValues = vec4(
                  getX(batch, xR, xC, d1),
                  getX(batch, xR, xC, d1 + 1),
                  getX(batch, xR, xC, d1 + 2),
                  getX(batch, xR, xC, d1 + 3)
                );
                dotProd += dot(xValues, wValues);
              } else {
                vec4 xValues = vec4(
                  getX(batch, d1, xR, xC),
                  getX(batch, d1 + 1, xR, xC),
                  getX(batch, d1 + 2, xR, xC),
                  getX(batch, d1 + 3, xR, xC)
                );
                dotProd += dot(xValues, wValues);
              }
            }

            if (${v===1}) {

              if (${C}) {
                dotProd +=
                    getX(batch, xR, xC, ${x}) *
                    getW(wR, wC, ${x}, d2);
              } else {
                dotProd +=
                    getX(batch, ${x}, xR, xC) *
                    getW(wR, wC, ${x}, d2);
              }

            } else if (${v===2}) {
              vec2 wValues = vec2(
                getW(wR, wC, ${x}, d2),
                getW(wR, wC, ${x} + 1, d2)
              );

              if (${C}) {
                vec2 xValues = vec2(
                  getX(batch, xR, xC, ${x}),
                  getX(batch, xR, xC, ${x} + 1)
                );
                dotProd += dot(xValues, wValues);
              } else {
                vec2 xValues = vec2(
                  getX(batch, ${x}, xR, xC),
                  getX(batch, ${x} + 1, xR, xC)
                );
                dotProd += dot(xValues, wValues);
              }

            } else if (${v===3}) {
              vec3 wValues = vec3(
                getW(wR, wC, ${x}, d2),
                getW(wR, wC, ${x} + 1, d2),
                getW(wR, wC, ${x} + 2, d2)
              );

              if (${C}) {
                vec3 xValues = vec3(
                  getX(batch, xR, xC, ${x}),
                  getX(batch, xR, xC, ${x} + 1),
                  getX(batch, xR, xC, ${x} + 2)
                );
                dotProd += dot(xValues, wValues);
              } else {
                vec3 xValues = vec3(
                  getX(batch, ${x}, xR, xC),
                  getX(batch, ${x} + 1, xR, xC),
                  getX(batch, ${x} + 2, xR, xC)
                );
                dotProd += dot(xValues, wValues);
              }

            }
          }
        }

        float result = dotProd;
        ${P}
        ${O}
        setOutput(result);
      }
    `}}class Eut{constructor(t){this.variableNames=["x","W"],this.outputShape=t.outShape;const e=t.padInfo.front,s=t.padInfo.top,r=t.padInfo.left,i=t.strideDepth,o=t.strideHeight,l=t.strideWidth,u=t.dilationDepth,h=t.dilationHeight,d=t.dilationWidth,p=t.filterDepth,m=t.filterHeight,y=t.filterWidth,x=Math.floor(t.inChannels/4)*4,v=t.inChannels%4;this.userCode=`
      const ivec3 strides = ivec3(${i}, ${o}, ${l});
      const ivec3 pads = ivec3(${e}, ${s}, ${r});

      void main() {
        ivec5 coords = getOutputCoords();
        int batch = coords.x;
        int d2 = coords.u;

        ivec3 xFRCCorner = ivec3(coords.y, coords.z, coords.w) * strides - pads;
        int xFCorner = xFRCCorner.x;
        int xRCorner = xFRCCorner.y;
        int xCCorner = xFRCCorner.z;

        // Convolve x(?, ?, ?, d1) with w(:, :, :, d1, d2) to get
        // y(yF, yR, yC, d2). ? = to be determined. : = across all
        // values in that axis.
        float dotProd = 0.0;
        for (int wF = 0; wF < ${p}; wF++) {
          int xF = xFCorner + wF * ${u};

          if (xF < 0 || xF >= ${t.inDepth}) {
            continue;
          }

          for (int wR = 0; wR < ${m}; wR++) {
            int xR = xRCorner + wR * ${h};

            if (xR < 0 || xR >= ${t.inHeight}) {
              continue;
            }

            for (int wC = 0; wC < ${y}; wC++) {
              int xC = xCCorner + wC * ${d};

              if (xC < 0 || xC >= ${t.inWidth}) {
                continue;
              }

              for (int d1 = 0; d1 < ${x}; d1 += 4) {
                vec4 xValues = vec4(
                  getX(batch, xF, xR, xC, d1),
                  getX(batch, xF, xR, xC, d1 + 1),
                  getX(batch, xF, xR, xC, d1 + 2),
                  getX(batch, xF, xR, xC, d1 + 3)
                );
                vec4 wValues = vec4(
                  getW(wF, wR, wC, d1, d2),
                  getW(wF, wR, wC, d1 + 1, d2),
                  getW(wF, wR, wC, d1 + 2, d2),
                  getW(wF, wR, wC, d1 + 3, d2)
                );

                dotProd += dot(xValues, wValues);
              }

              if (${v===1}) {
                dotProd +=
                  getX(batch, xF, xR, xC, ${x}) *
                  getW(wF, wR, wC, ${x}, d2);
              } else if (${v===2}) {
                vec2 xValues = vec2(
                  getX(batch, xF, xR, xC, ${x}),
                  getX(batch, xF, xR, xC, ${x} + 1)
                );
                vec2 wValues = vec2(
                  getW(wF, wR, wC, ${x}, d2),
                  getW(wF, wR, wC, ${x} + 1, d2)
                );
                dotProd += dot(xValues, wValues);
              } else if (${v===3}) {
                vec3 xValues = vec3(
                  getX(batch, xF, xR, xC, ${x}),
                  getX(batch, xF, xR, xC, ${x} + 1),
                  getX(batch, xF, xR, xC, ${x} + 2)
                );
                vec3 wValues = vec3(
                  getW(wF, wR, wC, ${x}, d2),
                  getW(wF, wR, wC, ${x} + 1, d2),
                  getW(wF, wR, wC, ${x} + 2, d2)
                );
                dotProd += dot(xValues, wValues);
              }
            }
          }
        }
        setOutput(dotProd);
      }
    `}}/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class jL{constructor(t,e=!1,s=null,r=!1,i=!1){this.variableNames=["x","W"],this.packedInputs=!0,this.packedOutput=!0,this.customUniforms=[{name:"pads",type:"ivec2"},{name:"strides",type:"ivec2"},{name:"dilations",type:"ivec2"},{name:"inDims",type:"ivec2"}],this.outputShape=t.outShape,this.enableShapeUniforms=ks(this.outputShape.length);const o=t.padInfo.left,l=t.strideWidth,u=t.dilationWidth,h=t.filterHeight,d=t.filterWidth,p=d;let m=`
       int xR; int xC; int xCOffset;
       vec4 wTexel; vec4 previous; vec4 final;`;for(let C=0;C<d;C++)m+=`
           vec4 xTexelC${C*2};
           int xTexelC${C*2}Ready;
           vec4 xTexelC${C*2+1};
           int xTexelC${C*2+1}Ready;
           vec4 xC${C};`;m+=`
     for (int r = 0; r < ${h}; r++) {
      for (int d1 = 0; d1 < ${t.inChannels}; d1 += 2) {
       `;for(let C=0;C<d;C++)m+=`
           xTexelC${C*2} = vec4(0.0);
           xTexelC${C*2}Ready = 0;
           xTexelC${C*2+1} = vec4(0.0);
           xTexelC${C*2+1}Ready = 0;
           xC${C} = vec4(0.0);`;m+=`
         xR = xRCorner + r * dilations[0];
         if (xR >=0 && xR < inDims[0]) {
       `;for(let C=0;C<(p+1)/2;C++){const S=C*2;if(m+=`
           xC = xCCorner + ${S*u};
           `,l===1){if(S<d&&(o%2===1?(m+=`
                 xCOffset = xC + 1;
                 if (xCOffset >= 0 && xCOffset < inDims[1] && xTexelC${S}Ready == 0) {
                   xTexelC${S} = getX(batch, xR, xCOffset, d1);

                   // Need to manually clear unused channels in case
                   // we're reading from recycled texture.
                   if (xCOffset + 1 >= inDims[1]) {
                     xTexelC${S}.zw = vec2(0.0);
                   }
                   xTexelC${S}Ready = 1;
                 }
               `,u===1&&S>0?m+=`
                 xC${S} = vec4(xTexelC${S-2}.zw, xTexelC${S}.xy);
                 `:m+=`
                   xCOffset = xC + 1 - 2;

                   if (xCOffset >= 0 && xCOffset < inDims[1]) {
                     previous = getX(batch, xR, xCOffset, d1);

                     // Need to manually clear unused channels in case
                     // we're reading from recycled texture.
                     if (xCOffset + 1 >= inDims[1]) {
                       previous.zw = vec2(0.0);
                     }

                     xC${S} = vec4(previous.zw, xTexelC${S}.xy);
                   } else {
                     xC${S} = vec4(0.0, 0.0, xTexelC${S}.xy);
                   }
                   `):m+=`
                 if (xC >= 0 && xC < inDims[1] && xTexelC${S}Ready == 0) {
                   xTexelC${S} = getX(batch, xR, xC, d1);
                   if (xC + 1 >= inDims[1]) {
                     xTexelC${S}.zw = vec2(0.0);
                   }
                   xTexelC${S}Ready = 1;
                 }

                 xC${S} = xTexelC${S};
                 `,S+1<d)){const E=o%2===0?pC(u):u;u%2===0&&o%2===1||u%2!==0&&o%2!==1?(m+=`
                   xCOffset = xC + imod(pads[1], 2) + ${E};

                   if (xCOffset >= 0 && xCOffset < inDims[1] && xTexelC${S+1}Ready == 0) {
                     xTexelC${S+1} = getX(batch, xR, xCOffset, d1);

                     // Need to manually clear unused channels in case
                     // we're reading from recycled texture.
                     if (xCOffset + 1 >= inDims[1]) {
                       xTexelC${S+1}.zw = vec2(0.0);
                     }
                     xTexelC${S+1}Ready = 1;
                   }
                   `,u>1?m+=`
                     xCOffset -= 2;
                     if (xCOffset >= 0 && xCOffset < inDims[1]) {
                      previous = getX(batch, xR, xCOffset, d1);
                      xC${S+1} = vec4(previous.zw, xTexelC${S+1}.xy);
                     } else {
                      xC${S+1} = vec4(0.0, 0.0, xTexelC${S+1}.xy);
                     }
                     `:m+=`
                     xC${S+1} = vec4(xTexelC${S}.zw, xTexelC${S+1}.xy);
                     `):E===1?m+=`
                     xC${S+1} = xTexelC${S};
                     `:m+=`
                     xCOffset = xC + ${E};

                     if (xCOffset >= 0 && xCOffset < inDims[1] && xTexelC${S+1}Ready == 0) {
                       xTexelC${S+1} = getX(batch, xR, xCOffset, d1);
                       if (xCOffset + 1 >= inDims[1]) {
                         xTexelC${S+1}.zw = vec2(0.0);
                       }
                       xTexelC${S+1}Ready = 1;
                     }

                     xC${S+1} = xTexelC${S+1};
                     `}}else S<d&&(o%2===1?(m+=`
                 xCOffset = xC + 1 - strides[1];
                 if(xCOffset >= 0 && xCOffset < inDims[1] && xTexelC${S}Ready == 0) {
                   xTexelC${S} = getX(batch, xR, xCOffset, d1);
                   // Need to manually clear unused channels in case
                   // we're reading from recycled texture.
                   if (xCOffset + 1 >= inDims[1]) {
                     xTexelC${S}.zw = vec2(0.0);
                   }
                   xTexelC${S}Ready = 1;
                 }

                 if(xC + 1 >= 0 && xC + 1 < inDims[1] && xTexelC${S+1}Ready == 0) {
                   xTexelC${S+1} = getX(batch, xR, xC + 1, d1);
                   // Need to manually clear unused channels in case
                   // we're reading from recycled texture.
                   if (xC + 2 >= inDims[1]) {
                     xTexelC${S+1}.zw = vec2(0.0);
                   }
                   xTexelC${S+1}Ready = 1;
                 }

                 xC${S} = vec4(xTexelC${S}.zw, xTexelC${S+1}.zw);
               `,S+1<d&&(m+=`
                   final = vec4(0.0);
                   xCOffset = xC + 1 + strides[1];
                   if(xCOffset >= 0 && xCOffset < inDims[1]) {
                     final = getX(batch, xR, xCOffset, d1);
                   }
                   xC${S+1} = vec4(xTexelC${S+1}.xy, final.xy);
                 `)):(m+=`
                 if(xC >= 0 && xC < inDims[1] && xTexelC${S}Ready == 0) {
                   xTexelC${S} = getX(batch, xR, xC, d1);
                   if (xC + 1 >= inDims[1]) {
                     xTexelC${S}.zw = vec2(0.0);
                   }
                   xTexelC${S}Ready = 1;
                 }

                 xCOffset = xC + strides[1];
                 if(xCOffset >= 0 && xCOffset < inDims[1] && xTexelC${S+1}Ready == 0) {
                   xTexelC${S+1} = getX(batch, xR, xCOffset, d1);
                   if (xCOffset + 1 >= inDims[1]) {
                     xTexelC${S+1}.zw = vec2(0.);
                   }
                   xTexelC${S+1}Ready = 1;
                 }

                 xC${S} = vec4(
                   xTexelC${S}.xy, xTexelC${S+1}.xy);
               `,S+1<d&&(m+=`
                   xC${S+1} = vec4(xTexelC${S}.zw, xTexelC${S+1}.zw);
                 `)));S<d&&(m+=`
             wTexel = getW(r, ${S}, d1, d2);
             dotProd += xC${S}.xxzz * vec4(wTexel.xy, wTexel.xy);
             if(d1 + 1 < ${t.inChannels}) {
               dotProd += xC${S}.yyww * vec4(wTexel.zw, wTexel.zw);
             }
           `,S+1<d&&(m+=`
               wTexel = getW(r, ${S+1}, d1, d2);
               dotProd += xC${S+1}.xxzz * vec4(wTexel.xy, wTexel.xy);
               if(d1 + 1 < ${t.inChannels}) {
                 dotProd += xC${S+1}.yyww * vec4(wTexel.zw, wTexel.zw);
               }
             `))}m+=`
     }
   `,m+=`
     }
   `,m+=`
     }
   `;let y="",x="";s&&(r?y=`vec4 activation(vec4 a) {
           vec4 b = getPreluActivationWeightsAtOutCoords();
           ${s}
         }`:i?y=`vec4 activation(vec4 a) {
           vec4 b = getLeakyreluAlphaAtOutCoords();
           ${s}
         }`:y=`vec4 activation(vec4 x) {
           ${s}
         }`,x="result = activation(result);");const v=e?"result += getBiasAtOutCoords();":"";e&&this.variableNames.push("bias"),r&&this.variableNames.push("preluActivationWeights"),i&&this.variableNames.push("leakyreluAlpha"),this.userCode=`
       ${y}

       void main() {
         ivec4 coords = getOutputCoords();
         int batch = coords.x;
         ivec2 xRCCorner = coords.yz * strides - pads;
         int d2 = coords.w;
         int xRCorner = xRCCorner.x;
         int xCCorner = xRCCorner.y;

         //intialize dotProd with a small epsilon seems to reduce GPU accuracy loss.
         vec4 dotProd = vec4(0.000000000000001);

         ${m}

         vec4 result = dotProd - vec4(0.000000000000001);
         ${v}
         ${x}
         setOutput(result);
       }
     `}}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Iut{constructor(t,e){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.customUniforms=[{name:"inputShape",type:"ivec4"},{name:"pad",type:"ivec2"},{name:"stride",type:"ivec2"},{name:"dilation",type:"ivec2"},{name:"inChannels",type:"int"},{name:"itemsPerBlockRow",type:"int"},{name:"outWidth",type:"int"}],this.outputShape=t,this.enableShapeUniforms=ks(this.outputShape.length);const{dataFormat:s}=e,r=zs(),i=s==="channelsLast",o=i?1:2,l=i?2:3,u=this.enableShapeUniforms?"if(blockIndex < outShape[2] && pos < outShape[1]) {":`if(blockIndex < ${t[2]} && pos < ${t[1]}) {`;let h="";for(let d=0;d<=1;d++)for(let p=0;p<=1;p++)h+=`
          blockIndex = rc.z + ${p};
          pos = rc.y + ${d};

          ${u}
            offsetY = int(blockIndex / outWidth) * stride[0] - pad[0];
            d0 = offsetY + dilation[0] * (pos / itemsPerBlockRow);

            if(d0 < inputShape[${o}] && d0 >= 0) {
              // Use custom imod instead mod. On Intel GPU, mod may generate
              // unexpected value.
              // https://github.com/tensorflow/tfjs/issues/5447
              offsetX = imod(blockIndex, outWidth) * stride[1] - pad[1];
              d1 = offsetX + dilation[1] * (imod(pos, itemsPerBlockRow) /
                  inChannels);

              if(d1 < inputShape[${l}] && d1 >= 0) {

                ch = imod(pos, inChannels);

                if (${i}) {
                  innerDims = vec2(d1, ch);
                  result[${d*2+p}] = getChannel(
                    getA(rc.x, d0, int(innerDims.x),
                    int(innerDims.y)), innerDims);
                } else {
                  innerDims = vec2(d0, d1);
                  result[${d*2+p}] = getChannel(
                    getA(rc.x, ch, int(innerDims.x),
                    int(innerDims.y)), innerDims);
                }
              }
            }
          }
        `;this.userCode=`
      void main() {
        ivec3 rc = getOutputCoords();

        vec4 result = vec4(0);

        int blockIndex, pos, offsetY, d0, offsetX, d1, ch;
        vec2 innerDims;

        ${h}

        ${r.output} = result;
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Ky(n,t){const e=n.length;return e>=3?t?[...n.slice(0,-3),n[e-3]*n[e-2],n[e-1]]:[...n.slice(0,-3),n[e-3],n[e-2]*n[e-1]]:!t&&e===1&&n[0]>1?[n[0],1]:null}function KL({x:n,filter:t,convInfo:e,backend:s,bias:r=null,preluActivationWeights:i=null,leakyreluAlpha:o=0,activation:l=null}){const u=n.shape,h=s.texData.get(n.dataId),d=e.inChannels,p=u[0]*u[1]*u[2],m=e.outChannels,y=e.dataFormat==="channelsLast",x=!1,v=!1;let C;const S=[];if(i!=null){const I=Ky(i.shape,y);I!=null&&(i=Nt({inputs:{x:i},backend:s,attrs:{shape:I}}),S.push(i))}if(r!=null){const I=Ky(r.shape,y);I!=null&&(r=Nt({inputs:{x:r},backend:s,attrs:{shape:I}}),S.push(r))}if(!((p===1||m===1)&&d>zL)&&h.isPacked&&y&&h.texture!=null&&u[2]%2!==0&&Oe(h.shape.slice(-3),u.slice(-3))){const I=u[0]*u[1]*(u[2]+1),O={dataId:n.dataId,shape:[1,I,e.inChannels],dtype:n.dtype},P=h.shape;h.shape=h.shape.slice(),h.shape[h.shape.length-2]++,U(qy(h.shape,O.shape),()=>`packed reshape ${h.shape} to ${O.shape} isn't free`);const D=Nt({inputs:{x:t},backend:s,attrs:{shape:[1,e.inChannels,e.outChannels]}});S.push(D);const N=jy({a:O,b:D,backend:s,transposeA:x,transposeB:v,bias:r,activation:l,preluActivationWeights:i,leakyreluAlpha:o}),R=s.texData.get(N.dataId);U(R.isPacked,()=>"batchMatMul result is expected to be packed"),h.shape=P,R.shape=e.outShape,C=cr({inputs:{x:N},backend:s}),C.shape=e.outShape,S.push(N)}else{const I=e.outHeight*e.outWidth,O=Nt({inputs:{x:n},backend:s,attrs:{shape:y?[e.batchSize,I,e.inChannels]:[e.batchSize,e.inChannels,I]}}),P=Nt({inputs:{x:t},backend:s,attrs:{shape:[1,e.inChannels,e.outChannels]}}),D=jy({a:y?O:P,b:y?P:O,transposeA:!y,transposeB:v,backend:s,bias:r,activation:l,preluActivationWeights:i,leakyreluAlpha:o});C=Nt({inputs:{x:D},backend:s,attrs:{shape:e.outShape}}),S.push(O),S.push(P),S.push(D)}for(const I of S)s.disposeIntermediateTensorInfo(I);return C}function XL({x:n,filter:t,convInfo:e,backend:s,bias:r=null,preluActivationWeights:i=null,leakyreluAlpha:o=0,activation:l=null}){const{filterWidth:u,filterHeight:h,inChannels:d,outWidth:p,outHeight:m,dataFormat:y}=e,x=y==="channelsLast",v=u*h*d,C=m*p,S=[e.batchSize,v,C],E=!0,_=!1,I=[];if(i!=null){const Y=Ky(i.shape,x);Y!=null&&(i=Nt({inputs:{x:i},backend:s,attrs:{shape:Y}}),I.push(i))}if(r!=null){const Y=Ky(r.shape,x);Y!=null&&(r=Nt({inputs:{x:r},backend:s,attrs:{shape:Y}}),I.push(r))}const O=Nt({inputs:{x:t},backend:s,attrs:{shape:[1,v,yt(t.shape)/v]}});I.push(O);const P=new Iut(S,e),D=[n.shape,[e.padInfo.top,e.padInfo.left],[e.strideHeight,e.strideWidth],[e.dilationHeight,e.dilationWidth],[e.inChannels],[e.filterWidth*e.inChannels],[e.outWidth]],N=s.runWebGLProgram(P,[n],"float32",D),R=Nt({inputs:{x:N},backend:s,attrs:{shape:S}});I.push(N),I.push(R);const $=r!=null,A=i!=null,V=l==="leakyrelu",L=l?wf(l,!0):null,nt=new VL(x?R.shape:O.shape,x?O.shape:R.shape,x?[e.batchSize,C,e.outChannels]:[e.batchSize,e.outChannels,C],E,_,$,L,A,V),Z=x?[R,O]:[O,R];if(r&&Z.push(r),A&&Z.push(i),V){const Y=s.makeTensorInfo([],"float32",Qa(o,"float32"));Z.push(Y),I.push(Y)}const W=s.runWebGLProgram(nt,Z,"float32"),K=Nt({inputs:{x:W},backend:s,attrs:{shape:e.outShape}});I.push(W);for(const Y of I)s.disposeIntermediateTensorInfo(Y);return K}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function _ut(n){const{inputs:t,backend:e,attrs:s}=n,{x:r,filter:i}=t,{strides:o,pad:l,dataFormat:u,dilations:h,dimRoundingMode:d}=s,p=jo(u),m=cs(r.shape,i.shape,o,h,l,d,!1,p);let y;if(m.filterHeight===1&&m.filterWidth===1&&m.dilationHeight===1&&m.dilationWidth===1&&m.strideHeight===1&&m.strideWidth===1&&(m.padInfo.type==="SAME"||m.padInfo.type==="VALID"))y=KL({x:r,filter:i,convInfo:m,backend:e});else if(m.strideWidth<=2&&p==="channelsLast"&&dt().getBool("WEBGL_EXP_CONV")){const v=new jL(m),C=[[m.padInfo.top,m.padInfo.left],[m.strideHeight,m.strideWidth],[m.dilationHeight,m.dilationWidth],[m.inHeight,m.inWidth]];y=e.runWebGLProgram(v,[r,i],"float32",C)}else if(dt().getBool("WEBGL_CONV_IM2COL"))y=XL({x:r,filter:i,convInfo:m,backend:e});else{const v=new qL(m);y=e.runWebGLProgram(v,[r,i],"float32")}const x=Nt({inputs:{x:y},backend:e,attrs:{shape:m.outShape}});return e.disposeIntermediateTensorInfo(y),x}const kut={kernelName:S0,backendName:"webgl",kernelFunc:_ut};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Aut{constructor(t){this.variableNames=["x","dy"],this.outputShape=t.filterShape;const e=t.strideHeight,s=t.strideWidth,r=t.padInfo.top,i=t.padInfo.left,o=t.dataFormat==="channelsLast";this.userCode=`
      void main() {
        ivec4 coords = getOutputCoords();
        int wR = coords.x;
        int wC = coords.y;
        int d1 = coords.z;
        int d2 = coords.w;

        // Convolve x(?, ?, d1) with dy(:, :, d2) to get dw(wR, wC, d1, d2).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;

        for (int b = 0; b < ${t.batchSize}; b++) {
          for (int yR = 0; yR < ${t.outHeight}; yR++) {
            int xR = wR + yR * ${e} - ${r};

            if (xR < 0 || xR >= ${t.inHeight}) {
              continue;
            }

            for (int yC = 0; yC < ${t.outWidth}; yC++) {
              int xC = wC + yC * ${s} - ${i};

              if (xC < 0 || xC >= ${t.inWidth}) {
                continue;
              }

              ${o?`float dyValue = getDy(b, yR, yC, d2);
              float xValue = getX(b, xR, xC, d1);
              dotProd += (xValue * dyValue);`:`float dyValue = getDy(b, d2, yR, yC);
              float xValue = getX(b, d1, xR, xC);
              dotProd += (xValue * dyValue);`}
            }
          }
        }
        setOutput(dotProd);
      }
    `}}class Nut{constructor(t){this.variableNames=["dy","W"],this.outputShape=t.inShape;const e=t.filterHeight,s=t.filterWidth,r=t.strideHeight,i=t.strideWidth,o=t.dataFormat==="channelsLast",l=e-1-t.padInfo.top,u=s-1-t.padInfo.left,h=o?1:2,d=o?2:3,p=o?3:1;this.userCode=`
      const ivec2 pads = ivec2(${l}, ${u});

      void main() {
        ivec4 coords = getOutputCoords();
        int batch = coords[0];
        int d1 = coords[${p}];

        ivec2 dyCorner = ivec2(coords[${h}], coords[${d}]) - pads;
        int dyRCorner = dyCorner.x;
        int dyCCorner = dyCorner.y;

        // Convolve dy(?, ?, d2) with w(:, :, d1, d2) to compute dx(xR, xC, d1).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;
        for (int wR = 0; wR < ${e}; wR++) {
          float dyR = float(dyRCorner + wR) / ${r}.0;

          if (dyR < 0.0 || dyR >= ${t.outHeight}.0 || fract(dyR) > 0.0) {
            continue;
          }
          int idyR = int(dyR);

          int wRPerm = ${e} - 1 - wR;

          for (int wC = 0; wC < ${s}; wC++) {
            float dyC = float(dyCCorner + wC) / ${i}.0;

            if (dyC < 0.0 || dyC >= ${t.outWidth}.0 ||
                fract(dyC) > 0.0) {
              continue;
            }
            int idyC = int(dyC);

            int wCPerm = ${s} - 1 - wC;

            for (int d2 = 0; d2 < ${t.outChannels}; d2++) {

              if (${o}) {
                float xValue = getDy(batch, idyR, idyC, d2);
                float wValue = getW(wRPerm, wCPerm, d1, d2);
                dotProd += xValue * wValue;
              } else {
                float xValue = getDy(batch, d2, idyR, idyC);
                float wValue = getW(wRPerm, wCPerm, d1, d2);
                dotProd += xValue * wValue;
              }

            }
          }
        }
        setOutput(dotProd);
      }
    `}}class Rut{constructor(t){this.variableNames=["x","dy"],this.outputShape=t.filterShape;const e=t.strideDepth,s=t.strideHeight,r=t.strideWidth,i=t.padInfo.front,o=t.padInfo.top,l=t.padInfo.left;this.userCode=`
      void main() {
        ivec5 coords = getOutputCoords();
        int wF = coords.x;
        int wR = coords.y;
        int wC = coords.z;
        int d1 = coords.w;
        int d2 = coords.u;

        float dotProd = 0.0;

        for (int b = 0; b < ${t.batchSize}; b++) {
          for (int yF = 0; yF < ${t.outDepth}; yF++) {
            int xF = wF + yF * ${e} - ${i};

            if (xF < 0 || xF >= ${t.inDepth}) {
              continue;
            }

            for (int yR = 0; yR < ${t.outHeight}; yR++) {
              int xR = wR + yR * ${s} - ${o};

              if (xR < 0 || xR >= ${t.inHeight}) {
                continue;
              }

              for (int yC = 0; yC < ${t.outWidth}; yC++) {
                int xC = wC + yC * ${r} - ${l};

                if (xC < 0 || xC >= ${t.inWidth}) {
                  continue;
                }

                float dyValue = getDy(b, yF, yR, yC, d2);
                float xValue = getX(b, xF, xR, xC, d1);
                dotProd += (xValue * dyValue);
              }
            }
          }
        }
        setOutput(dotProd);
      }
    `}}class $ut{constructor(t){this.variableNames=["dy","W"],this.outputShape=t.inShape;const e=t.filterDepth,s=t.filterHeight,r=t.filterWidth,i=t.strideDepth,o=t.strideHeight,l=t.strideWidth,u=e-1-t.padInfo.front,h=s-1-t.padInfo.top,d=r-1-t.padInfo.left;this.userCode=`
      const ivec3 pads = ivec3(${u}, ${h}, ${d});

      void main() {
        ivec5 coords = getOutputCoords();
        int batch = coords.x;
        int d1 = coords.u;


        ivec3 dyCorner = ivec3(coords.y, coords.z, coords.w) - pads;
        int dyFCorner = dyCorner.x;
        int dyRCorner = dyCorner.y;
        int dyCCorner = dyCorner.z;

        float dotProd = 0.0;
        for (int wF = 0; wF < ${e}; wF++) {
          float dyF = float(dyFCorner + wF) / ${i}.0;

          if (dyF < 0.0 || dyF >= ${t.outDepth}.0 || fract(dyF) > 0.0) {
            continue;
          }
          int idyF = int(dyF);

          int wFPerm = ${e} - 1 - wF;

          for (int wR = 0; wR < ${s}; wR++) {
            float dyR = float(dyRCorner + wR) / ${o}.0;

            if (dyR < 0.0 || dyR >= ${t.outHeight}.0 ||
              fract(dyR) > 0.0) {
              continue;
            }
            int idyR = int(dyR);

            int wRPerm = ${s} - 1 - wR;

            for (int wC = 0; wC < ${r}; wC++) {
              float dyC = float(dyCCorner + wC) / ${l}.0;

              if (dyC < 0.0 || dyC >= ${t.outWidth}.0 ||
                  fract(dyC) > 0.0) {
                continue;
              }
              int idyC = int(dyC);

              int wCPerm = ${r} - 1 - wC;

              for (int d2 = 0; d2 < ${t.outChannels}; d2++) {
                float xValue = getDy(batch, idyF, idyR, idyC, d2);
                float wValue = getW(wFPerm, wRPerm, wCPerm, d1, d2);
                dotProd += xValue * wValue;
              }
            }
          }
        }
        setOutput(dotProd);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Dut(n){const{inputs:t,backend:e,attrs:s}=n,{x:r,dy:i}=t,{strides:o,pad:l,dataFormat:u,dimRoundingMode:h,filterShape:d}=s,p=jo(u),m=cs(r.shape,d,o,1,l,h,!1,p),y=new Aut(m);return e.runWebGLProgram(y,[r,i],"float32")}const Out={kernelName:kC,backendName:"webgl",kernelFunc:Dut};/**
 * @license
 * Copyright 2023 Google LLC.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Mut{constructor(t){this.variableNames=["dy","W"],this.packedInputs=!0,this.packedOutput=!0,this.customUniforms=[{name:"strides",type:"vec2"}],this.outputShape=t.inShape,this.enableShapeUniforms=ks(this.outputShape.length);const e=t.filterHeight,s=t.filterWidth,r=e-1-t.padInfo.top,i=s-1-t.padInfo.left;this.userCode=`
      const ivec2 pads = ivec2(${r}, ${i});

      void main() {
        ivec4 coords = getOutputCoords();
        int batch = coords[0];
        int d1 = coords[3];

        ivec2 dyCorner = ivec2(coords[1], coords[2]) - pads;
        int dyRCorner = dyCorner.x;
        int dyCCorner = dyCorner.y;

        vec4 result = vec4(0.);
        for (int wR = 0; wR < ${e}; wR++) {
          float dyR = float(dyRCorner + wR) / strides[0];
          if (dyR < 0.0 || dyR >= ${t.outHeight}.0 || fract(dyR) > 0.0) {
            continue;
          }
          int idyR = int(dyR);
          int wRPerm = ${e} - 1 - wR;

          for (int wC = 0; wC < ${s}; wC++) {
            int wCPerm = ${s} - 1 - wC;

            float dyC = float(dyCCorner + wC) / strides[1];
            bool idyCVal = (dyC >= 0.0) && (dyC < ${t.outWidth}.0)
              && (fract(dyC) == 0.0);
            int idyC = int(dyC);

            float dyC2 = float(dyCCorner + wC + 1) / strides[1];
            bool idyCVal2 = (dyC2 >= 0.0) && (dyC2 < ${t.outWidth}.0)
              && (fract(dyC2) == 0.0);
            int idyC2 = int(dyC2);

            if (idyCVal && idyCVal2) {
              for (int d2 = 0; d2 < ${t.outChannels}; d2 += 2) {
                vec4 wValue = getW(wRPerm, wCPerm, d1, d2);
                vec4 dySample = getDy(batch, idyR, idyC, d2);
                vec4 dySample2 = (idyC / 2 == idyC2 / 2) ?
                  dySample : getDy(batch, idyR, idyC2, d2);

                vec2 dyValue = mod(float(idyC), 2.) == 0. ?
                  dySample.xy : dySample.zw;
                result.xy += vec2(dot(dyValue, wValue.xy),
                  dot(dyValue, wValue.zw));

                dyValue = mod(float(idyC2), 2.) == 0. ?
                  dySample2.xy : dySample2.zw;
                result.zw += vec2(dot(dyValue, wValue.xy),
                  dot(dyValue, wValue.zw));
              }
            } else if (idyCVal) {
              for (int d2 = 0; d2 < ${t.outChannels}; d2 += 2) {
                vec4 wValue = getW(wRPerm, wCPerm, d1, d2);
                vec4 dySample = getDy(batch, idyR, idyC, d2);
                vec2 dyValue = mod(float(idyC), 2.) == 0. ?
                  dySample.xy : dySample.zw;
                result.xy += vec2(dot(dyValue, wValue.xy),
                  dot(dyValue, wValue.zw));
              }
            } else if (idyCVal2) {
              for (int d2 = 0; d2 < ${t.outChannels}; d2 += 2) {
                vec4 wValue = getW(wRPerm, wCPerm, d1, d2);
                vec4 dySample = getDy(batch, idyR, idyC2, d2);
                vec2 dyValue = mod(float(idyC2), 2.) == 0. ?
                  dySample.xy : dySample.zw;
                result.zw += vec2(dot(dyValue, wValue.xy),
                  dot(dyValue, wValue.zw));
              }
            }
          }
        }
        setOutput(result);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Fut(n){const{inputs:t,backend:e,attrs:s}=n,{dy:r,filter:i}=t,{inputShape:o,strides:l,pad:u,dataFormat:h,dimRoundingMode:d}=s,p=jo(h),m=cs(o,i.shape,l,1,u,d,!1,p);if(dt().getBool("WEBGL_PACK_CONV2DTRANSPOSE")&&p==="channelsLast"){const y=[[m.strideHeight,m.strideWidth]],x=new Mut(m);return e.runWebGLProgram(x,[r,i],"float32",y)}else{const y=new Nut(m);return e.runWebGLProgram(y,[r,i],"float32")}}const Lut={kernelName:T0,backendName:"webgl",kernelFunc:Fut};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Put(n){const{inputs:t,backend:e,attrs:s}=n,{x:r,filter:i}=t,{strides:o,pad:l,dilations:u}=s,h=Ja(r.shape,i.shape,o,u,l),d=new Eut(h);return e.runWebGLProgram(d,[r,i],"float32")}const Vut={kernelName:E0,backendName:"webgl",kernelFunc:Put};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function zut(n){const{inputs:t,backend:e,attrs:s}=n,{x:r,dy:i}=t,{strides:o,pad:l,filterShape:u}=s,h=Ja(r.shape,u,o,1,l),d=new Rut(h);return e.runWebGLProgram(d,[r,i],"float32")}const But={kernelName:AC,backendName:"webgl",kernelFunc:zut};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Uut(n){const{inputs:t,backend:e,attrs:s}=n,{dy:r,filter:i}=t,{pad:o,strides:l,inputShape:u}=s,h=Ja(u,i.shape,l,1,o),d=new $ut(h);return e.runWebGLProgram(d,[r,i],"float32")}const Gut={kernelName:NC,backendName:"webgl",kernelFunc:Uut};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Wut=Ch+`
  return cos(x);
`,Hut=`
  vec4 result = cos(x);
  bvec4 isNaN = isnan(x);
  ${ku}
  return result;
`,qut=Ce({opSnippet:Wut,packedOpSnippet:Hut}),jut={kernelName:Uf,backendName:"webgl",kernelFunc:qut};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Kut=`
  float e2x = exp(-x);
  return (e2x + 1.0 / e2x) / 2.0;
`,Xut=Ce({opSnippet:Kut}),Yut={kernelName:Gf,backendName:"webgl",kernelFunc:Xut};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Qut{constructor(t,e,s,r,i){this.variableNames=["Image","Boxes","BoxInd"],this.outputShape=[];const[o,l,u,h]=t,[d]=e,[p,m]=s;this.outputShape=[d,p,m,h];const y=r==="bilinear"?1:0,[x,v]=[`${l-1}.0`,`${u-1}.0`],[C,S,E]=p>1?[`${(l-1)/(p-1)}`,"(y2-y1) * height_ratio",`y1*${x} + float(y)*(height_scale)`]:["0.0","0.0",`0.5 * (y1+y2) * ${x}`],[_,I,O]=m>1?[`${(u-1)/(m-1)}`,"(x2-x1) * width_ratio",`x1*${v} + float(x)*(width_scale)`]:["0.0","0.0",`0.5 * (x1+x2) * ${v}`];this.userCode=`
      const float height_ratio = float(${C});
      const float width_ratio = float(${_});
      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int y = coords[1];
        int x = coords[2];
        int d = coords[3];

        // get box vals
        float y1 = getBoxes(b,0);
        float x1 = getBoxes(b,1);
        float y2 = getBoxes(b,2);
        float x2 = getBoxes(b,3);

        // get image in batch index
        int bInd = round(getBoxInd(b));
        if(bInd < 0 || bInd >= ${o}) {
          return;
        }

        float height_scale = ${S};
        float width_scale = ${I};

        float in_y = ${E};
        if( in_y < 0.0 || in_y > ${x} ) {
          setOutput(float(${i}));
          return;
        }
        float in_x = ${O};
        if( in_x < 0.0 || in_x > ${v} ) {
          setOutput(float(${i}));
          return;
        }

        vec2 sourceFracIndexCR = vec2(in_x,in_y);
        if(${y} == 1) {
          // Compute the four integer indices.
          ivec2 sourceFloorCR = ivec2(sourceFracIndexCR);
          ivec2 sourceCeilCR = ivec2(ceil(sourceFracIndexCR));

          float topLeft = getImage(b, sourceFloorCR.y, sourceFloorCR.x, d);
          float bottomLeft = getImage(b, sourceCeilCR.y, sourceFloorCR.x, d);
          float topRight = getImage(b, sourceFloorCR.y, sourceCeilCR.x, d);
          float bottomRight = getImage(b, sourceCeilCR.y, sourceCeilCR.x, d);

          vec2 fracCR = sourceFracIndexCR - vec2(sourceFloorCR);

          float top = topLeft + (topRight - topLeft) * fracCR.x;
          float bottom = bottomLeft + (bottomRight - bottomLeft) * fracCR.x;
          float newValue = top + (bottom - top) * fracCR.y;
          setOutput(newValue);
        } else {
          // Compute the coordinators of nearest neighbor point.
          ivec2 sourceNearestCR = ivec2(floor(
            sourceFracIndexCR + vec2(0.5,0.5)));
          float newValue = getImage(b, sourceNearestCR.y, sourceNearestCR.x, d);
          setOutput(newValue);
        }
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Zut=n=>{const{inputs:t,backend:e,attrs:s}=n,{image:r,boxes:i,boxInd:o}=t,{cropSize:l,method:u,extrapolationValue:h}=s,d=new Qut(r.shape,i.shape,l,u,h);return e.runWebGLProgram(d,[r,i,o],"float32")},Jut={kernelName:$C,backendName:"webgl",kernelFunc:Zut};var Sf;(function(n){n.Prod="*",n.Sum="+"})(Sf||(Sf={}));class hN{constructor(t,e,s,r){this.op=t,this.outputShape=e,this.variableNames=["x"],this.customUniforms=[{name:"index",type:"float"}];const i=this.outputShape.length,o=this.op===Sf.Prod?"1.0":"0.0",l=s?o:`getX(${dN(i,"coords",this.op)})`,u=this.outputShape[this.outputShape.length-1];let h="",d="";s?(h=r?`end != ${u-1}`:"end != 0",d=r?"end + 1":"end - 1"):(h=r?`end + pow2 < ${u}`:"end >= pow2",d=r?"end + pow2":"end - pow2"),this.userCode=`
      void main() {
        ${He(i)} coords = getOutputCoords();
        int end = ${fN(i,"coords",this.op)};
        float val = ${l};
        int pow2 = int(pow(2.0, index));
        if (${h}) {
          int idx = ${d};
          ${fN(i,"coords",this.op)} = idx;
          val ${this.op}= getX(${dN(i,"coords",this.op)});
        }
        setOutput(val);
      }
    `}}function dN(n,t,e){if(n===1)return`${t}`;if(n===2)return`${t}.x, ${t}.y`;if(n===3)return`${t}.x, ${t}.y, ${t}.z`;if(n===4)return`${t}.x, ${t}.y, ${t}.z, ${t}.w`;throw new Error(`Cumulative ${e} for rank ${n} is not yet supported`)}function fN(n,t,e){if(n===1)return`${t}`;if(n===2)return`${t}.y`;if(n===3)return`${t}.z`;if(n===4)return`${t}.w`;throw new Error(`Cumulative ${e} for rank ${n} is not yet supported`)}/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function YL(n,t,e,s,r,i){const o=t.shape.length,l=hn([s],o);let u=t;l!=null&&(u=Vs({inputs:{x:t},backend:e,attrs:{perm:l}}));const h=Cn(1,o)[0];if(h!==o-1)throw new Error(`WebGL cumprod shader expects an inner-most axis=${t.shape.length-1} but got axis=${s}`);const d=u.shape[h];let p=cr({inputs:{x:u},backend:e});for(let m=0;m<=Math.ceil(Math.log2(d))-1;m++){const y=new hN(n,u.shape,!1,i),x=[[m]],v=p;p=e.runWebGLProgram(y,[p],p.dtype,x),e.disposeIntermediateTensorInfo(v)}if(r){const m=new hN(n,u.shape,r,i),y=p;p=e.runWebGLProgram(m,[p],p.dtype),e.disposeIntermediateTensorInfo(y)}if(l!=null){const m=tl(l),y=Vs({inputs:{x:p},backend:e,attrs:{perm:m}});return e.disposeIntermediateTensorInfo(p),e.disposeIntermediateTensorInfo(u),y}return p}/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function tct(n){const{inputs:t,backend:e,attrs:s}=n,{x:r}=t,{axis:i,exclusive:o,reverse:l}=s;return YL(Sf.Prod,r,e,i,o,l)}const ect={kernelName:RC,backendName:"webgl",kernelFunc:tct};/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function nct(n){const{inputs:t,backend:e,attrs:s}=n,{x:r}=t,{axis:i,exclusive:o,reverse:l}=s;return YL(Sf.Sum,r,e,i,o,l)}const sct={kernelName:I0,backendName:"webgl",kernelFunc:nct};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function rct(n){const{inputs:t,backend:e,attrs:s}=n,{x:r,weights:i}=t,{size:o,binaryOutput:l}=s;if(r.shape.length===1){const u=e.readSync(r.dataId),h=e.readSync(i.dataId),d=NL(u,h,i.dtype,i.shape,o);return e.makeTensorInfo([o],i.dtype,d)}else if(r.shape.length===2){const u=e.bufferSync(r),h=e.bufferSync(i),d=lot(u,h,o,l);return e.makeTensorInfo(d.shape,i.dtype,d.values)}throw new Error(`Error in denseBincount: input must be at most rank 2, but got rank${r.shape.length}.`)}const ict={kernelName:DC,backendName:"webgl",kernelFunc:rct};/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class oct{constructor(t,e,s){this.variableNames=["x"],this.outputShape=[],this.outputShape=t,this.blockSize=e,this.dataFormat=s,this.userCode=`
    void main() {
      ivec4 coords = getOutputCoords();
      int b = coords[0];
      int h = ${this.getHeightCoordString()};
      int w = ${this.getWidthCoordString()};
      int d = ${this.getDepthCoordString()};

      int in_h = h / ${e};
      int offset_h = imod(h, ${e});
      int in_w = w / ${e};
      int offset_w = imod(w, ${e});
      int offset_d = (offset_h * ${e} + offset_w) *
        ${this.getOutputDepthSize()};
      int in_d = d + offset_d;

      float result = ${this.getInputSamplingString()};
      setOutput(result);
    }
  `}getHeightCoordString(){return this.dataFormat==="NHWC"?"coords[1]":"coords[2]"}getWidthCoordString(){return this.dataFormat==="NHWC"?"coords[2]":"coords[3]"}getDepthCoordString(){return this.dataFormat==="NHWC"?"coords[3]":"coords[1]"}getOutputDepthSize(){return this.dataFormat==="NHWC"?this.outputShape[3]:this.outputShape[1]}getInputSamplingString(){return this.dataFormat==="NHWC"?"getX(b, in_h, in_w, in_d)":"getX(b, in_d, in_h, in_w)"}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function act(n){const{inputs:t,backend:e,attrs:s}=n,{x:r}=t,{blockSize:i,dataFormat:o}=s,l=r.shape[0],u=o==="NHWC"?r.shape[1]:r.shape[2],h=o==="NHWC"?r.shape[2]:r.shape[3],d=o==="NHWC"?r.shape[3]:r.shape[1],p=u*i,m=h*i,y=d/(i*i),x=o==="NHWC"?[l,p,m,y]:[l,y,p,m],v=new oct(x,i,o);return e.runWebGLProgram(v,[r],r.dtype)}const lct={kernelName:OC,backendName:"webgl",kernelFunc:act};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class QL{constructor(t,e=!1,s=null,r=!1,i=!1){this.variableNames=["x","W"],this.customUniforms=[{name:"pads",type:"ivec2"},{name:"strides",type:"ivec2"},{name:"dilations",type:"ivec2"},{name:"inDims",type:"ivec2"}],this.outputShape=t.outShape,this.enableShapeUniforms=ks(this.outputShape.length);const o=t.filterHeight,l=t.filterWidth,u=t.outChannels/t.inChannels;let h="",d="";s&&(r?h=`float activation(float a) {
          float b = getPreluActivationWeightsAtOutCoords();
          ${s}
        }`:i?h=`float activation(float a) {
          float b = getLeakyreluAlphaAtOutCoords();
          ${s}
        }`:h=`
          float activation(float x) {
            ${s}
          }
        `,d="result = activation(result);");const p=e?"result += getBiasAtOutCoords();":"";e&&this.variableNames.push("bias"),r&&this.variableNames.push("preluActivationWeights"),i&&this.variableNames.push("leakyreluAlpha"),this.userCode=`
      ${h}

      void main() {
        ivec4 coords = getOutputCoords();
        int batch = coords.x;
        ivec2 xRCCorner = coords.yz * strides - pads;
        int d2 = coords.w;
        int d1 = d2 / ${u};
        int q = d2 - d1 * ${u};

        int xRCorner = xRCCorner.x;
        int xCCorner = xRCCorner.y;

        // Convolve x(?, ?, d1) with w(:, :, d1, q) to get y(yR, yC, d2).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;
        // TO DO(dsmilkov): Flatten the two for loops and vec4 the operations.
        for (int wR = 0; wR < ${o}; wR++) {
          int xR = xRCorner + wR * dilations[0];

          if (xR < 0 || xR >= inDims[0]) {
            continue;
          }

          for (int wC = 0; wC < ${l}; wC++) {
            int xC = xCCorner + wC * dilations[1];

            if (xC < 0 || xC >= inDims[1]) {
              continue;
            }

            float xVal = getX(batch, xR, xC, d1);
            float wVal = getW(wR, wC, d1, q);
            dotProd += xVal * wVal;
          }
        }

        float result = dotProd;
        ${p}
        ${d}
        setOutput(result);
      }
    `}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class ZL{constructor(t,e=!1,s=null,r=!1,i=!1){this.variableNames=["x","W"],this.packedInputs=!0,this.packedOutput=!0,this.customUniforms=[{name:"pads",type:"ivec2"},{name:"strides",type:"ivec2"},{name:"dilations",type:"ivec2"},{name:"inDims",type:"ivec2"}],this.outputShape=t.outShape,this.enableShapeUniforms=ks(this.outputShape.length);const o=t.outChannels/t.inChannels,l=t.padInfo.left,u=t.strideWidth,h=t.dilationWidth,d=t.filterHeight,p=t.filterWidth,m=p;let y=`
      int xR; int xC; int xCOffset;
      vec4 wTexel; vec4 previous; vec4 final;`;for(let S=0;S<p;S++)y+=`
          vec4 xTexelC${S*2};
          int xTexelC${S*2}Ready;
          vec4 xTexelC${S*2+1};
          int xTexelC${S*2+1}Ready;
          vec4 xC${S};`;y+=`
    for (int r = 0; r < ${d}; r++) {
      `;for(let S=0;S<p;S++)y+=`
          xTexelC${S*2} = vec4(0.0);
          xTexelC${S*2}Ready = 0;
          xTexelC${S*2+1} = vec4(0.0);
          xTexelC${S*2+1}Ready = 0;
          xC${S} = vec4(0.0);`;y+=`
        xR = xRCorner + r * dilations[0];
        if (xR >=0 && xR < inDims[0]) {
      `;for(let S=0;S<(m+1)/2;S++){const E=S*2;if(y+=`
          xC = xCCorner + ${E*h};
          `,u===1){if(E<p&&(l%2===1?(y+=`
                xCOffset = xC + 1;
                if (xCOffset >= 0 && xCOffset < inDims[1] && xTexelC${E}Ready == 0) {
                  xTexelC${E} = getX(batch, xR, xCOffset, d1);

                  // Need to manually clear unused channels in case
                  // we're reading from recycled texture.
                  if (xCOffset + 1 >= inDims[1]) {
                    xTexelC${E}.zw = vec2(0.0);
                  }
                  xTexelC${E}Ready = 1;
                }
              `,h===1&&E>0?y+=`
                xC${E} = vec4(xTexelC${E-2}.zw, xTexelC${E}.xy);
                `:y+=`
                  xCOffset = xC + 1 - 2;

                  if (xCOffset >= 0 && xCOffset < inDims[1]) {
                    previous = getX(batch, xR, xCOffset, d1);

                    // Need to manually clear unused channels in case
                    // we're reading from recycled texture.
                    if (xCOffset + 1 >= inDims[1]) {
                      previous.zw = vec2(0.0);
                    }

                    xC${E} = vec4(previous.zw, xTexelC${E}.xy);
                  } else {
                    xC${E} = vec4(0.0, 0.0, xTexelC${E}.xy);
                  }
                  `):y+=`
                if (xC >= 0 && xC < inDims[1] && xTexelC${E}Ready == 0) {
                  xTexelC${E} = getX(batch, xR, xC, d1);
                  if (xC + 1 >= inDims[1]) {
                    xTexelC${E}.zw = vec2(0.0);
                  }
                  xTexelC${E}Ready = 1;
                }

                xC${E} = xTexelC${E};
                `,E+1<p)){const _=l%2===0?pC(h):h;h%2===0&&l%2===1||h%2!==0&&l%2!==1?(y+=`
                  xCOffset = xC + imod(pads[1], 2) + ${_};

                  if (xCOffset >= 0 && xCOffset < inDims[1] && xTexelC${E+1}Ready == 0) {
                    xTexelC${E+1} = getX(batch, xR, xCOffset, d1);

                    // Need to manually clear unused channels in case
                    // we're reading from recycled texture.
                    if (xCOffset + 1 >= inDims[1]) {
                      xTexelC${E+1}.zw = vec2(0.0);
                    }
                    xTexelC${E+1}Ready = 1;
                  }
                  `,h>1?y+=`
                    xCOffset -= 2;
                    if (xCOffset >= 0 && xCOffset < inDims[1]) {
                     previous = getX(batch, xR, xCOffset, d1);
                     xC${E+1} = vec4(previous.zw, xTexelC${E+1}.xy);
                    } else {
                     xC${E+1} = vec4(0.0, 0.0, xTexelC${E+1}.xy);
                    }
                    `:y+=`
                    xC${E+1} = vec4(xTexelC${E}.zw, xTexelC${E+1}.xy);
                    `):_===1?y+=`
                    xC${E+1} = xTexelC${E};
                    `:y+=`
                    xCOffset = xC + ${_};

                    if (xCOffset >= 0 && xCOffset < inDims[1] && xTexelC${E+1}Ready == 0) {
                      xTexelC${E+1} = getX(batch, xR, xCOffset, d1);
                      if (xCOffset + 1 >= inDims[1]) {
                        xTexelC${E+1}.zw = vec2(0.0);
                      }
                      xTexelC${E+1}Ready = 1;
                    }

                    xC${E+1} = xTexelC${E+1};
                    `}}else E<p&&(l%2===1?(y+=`
                xCOffset = xC + 1 - strides[1];
                if(xCOffset >= 0 && xCOffset < inDims[1] && xTexelC${E}Ready == 0) {
                  xTexelC${E} = getX(batch, xR, xCOffset, d1);
                  // Need to manually clear unused channels in case
                  // we're reading from recycled texture.
                  if (xCOffset + 1 >= inDims[1]) {
                    xTexelC${E}.zw = vec2(0.0);
                  }
                  xTexelC${E}Ready = 1;
                }

                if(xC + 1 >= 0 && xC + 1 < inDims[1] && xTexelC${E+1}Ready == 0) {
                  xTexelC${E+1} = getX(batch, xR, xC + 1, d1);
                  // Need to manually clear unused channels in case
                  // we're reading from recycled texture.
                  if (xC + 2 >= inDims[1]) {
                    xTexelC${E+1}.zw = vec2(0.0);
                  }
                  xTexelC${E+1}Ready = 1;
                }

                xC${E} = vec4(xTexelC${E}.zw, xTexelC${E+1}.zw);
              `,E+1<p&&(y+=`
                  final = vec4(0.0);
                  xCOffset = xC + 1 + strides[1];
                  if(xCOffset >= 0 && xCOffset < inDims[1]) {
                    final = getX(batch, xR, xCOffset, d1);
                  }
                  xC${E+1} = vec4(xTexelC${E+1}.xy, final.xy);
                `)):(y+=`
                if(xC >= 0 && xC < inDims[1] && xTexelC${E}Ready == 0) {
                  xTexelC${E} = getX(batch, xR, xC, d1);
                  if (xC + 1 >= inDims[1]) {
                    xTexelC${E}.zw = vec2(0.0);
                  }
                  xTexelC${E}Ready = 1;
                }

                xCOffset = xC + strides[1];
                if(xCOffset >= 0 && xCOffset < inDims[1] && xTexelC${E+1}Ready == 0) {
                  xTexelC${E+1} = getX(batch, xR, xCOffset, d1);
                  if (xCOffset + 1 >= inDims[1]) {
                    xTexelC${E+1}.zw = vec2(0.);
                  }
                  xTexelC${E+1}Ready = 1;
                }

                xC${E} = vec4(
                  xTexelC${E}.xy, xTexelC${E+1}.xy);
              `,E+1<p&&(y+=`
                  xC${E+1} = vec4(xTexelC${E}.zw, xTexelC${E+1}.zw);
                `)));E<p&&(y+=`
            wTexel = getW(r, ${E}, d1, q);
            dotProd += xC${E} * vec4(wTexel.xz, wTexel.xz);
          `,E+1<p&&(y+=`
              wTexel = getW(r, ${E+1}, d1, q);
              dotProd += xC${E+1} * vec4(wTexel.xz, wTexel.xz);
            `))}y+=`
    }
  `,y+=`
      }
    `;let x="",v="";s&&(r?x=`vec4 activation(vec4 a) {
          vec4 b = getPreluActivationWeightsAtOutCoords();
          ${s}
        }`:i?x=`vec4 activation(vec4 a) {
          vec4 b = getLeakyreluAlphaAtOutCoords();
          ${s}
        }`:x=`vec4 activation(vec4 x) {
          ${s}
        }`,v="result = activation(result);");const C=e?"result += getBiasAtOutCoords();":"";e&&this.variableNames.push("bias"),r&&this.variableNames.push("preluActivationWeights"),i&&this.variableNames.push("leakyreluAlpha"),this.userCode=`
      ${x}

      void main() {
        ivec4 coords = getOutputCoords();
        int batch = coords.x;
        ivec2 xRCCorner = coords.yz * strides - pads;
        int d2 = coords.w;
        int d1 = d2 / ${o};
        int q = d2 - d1 * ${o};
        int xRCorner = xRCCorner.x;
        int xCCorner = xRCCorner.y;

        //intialize dotProd with a small epsilon seems to reduce GPU accuracy loss.
        vec4 dotProd = vec4(0.000000000000001);

        ${y}

        vec4 result = dotProd - vec4(0.000000000000001);
        ${C}
        ${v}
        setOutput(result);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function uct(n){const{inputs:t,backend:e,attrs:s}=n,{x:r,filter:i}=t,{strides:o,pad:l,dilations:u,dimRoundingMode:h}=s;let d=u;d==null&&(d=[1,1]),U(Is(o,d),()=>`Error in depthwiseConv2d: Either strides or dilations must be 1. Got strides ${o} and dilations '${d}'`);const p=cs(r.shape,i.shape,o,d,l,h,!0);let m;dt().getBool("WEBGL_PACK_DEPTHWISECONV")&&p.strideWidth<=2&&p.outChannels/p.inChannels===1?m=new ZL(p):m=new QL(p);const y=[[p.padInfo.top,p.padInfo.left],[p.strideHeight,p.strideWidth],[p.dilationHeight,p.dilationWidth],[p.inHeight,p.inWidth]];return e.runWebGLProgram(m,[r,i],"float32",y)}const cct={kernelName:_0,backendName:"webgl",kernelFunc:uct};/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class hct{constructor(t){this.variableNames=["x","dy"],this.outputShape=t.filterShape;const e=t.strideHeight,s=t.strideWidth,r=t.padInfo.top,i=t.padInfo.left,o=t.outChannels/t.inChannels;this.userCode=`
      void main() {
        ivec4 coords = getOutputCoords();
        int wR = coords.x;
        int wC = coords.y;
        int d1 = coords.z;
        int dm = coords.w;
        int d2 = d1 * ${o} + dm;

        float dotProd = 0.0;

        // TO DO: Vec4 over the batch size
        for (int b = 0; b < ${t.batchSize}; b++) {
          for (int yR = 0; yR < ${t.outHeight}; yR++) {
            int xR = wR + yR * ${e} - ${r};

            if (xR < 0 || xR >= ${t.inHeight}) {
              continue;
            }

            for (int yC = 0; yC < ${t.outWidth}; yC++) {
              int xC = wC + yC * ${s} - ${i};

              if (xC < 0 || xC >= ${t.inWidth}) {
                continue;
              }

              float dyValue = getDy(b, yR, yC, d2);
              float xValue = getX(b, xR, xC, d1);
              dotProd += (xValue * dyValue);
            }
          }
        }
        setOutput(dotProd);
      }
    `}}class dct{constructor(t){this.variableNames=["dy","W"],this.outputShape=t.inShape;const e=t.filterHeight,s=t.filterWidth,r=t.strideHeight,i=t.strideWidth,o=e-1-t.padInfo.top,l=s-1-t.padInfo.left,u=t.outChannels/t.inChannels;this.userCode=`
      const ivec2 pads = ivec2(${o}, ${l});

      void main() {
        ivec4 coords = getOutputCoords();
        int batch = coords[0];
        int d1 = coords[3];
        ivec2 dyCorner = coords.yz - pads;
        int dyRCorner = dyCorner.x;
        int dyCCorner = dyCorner.y;

        float dotProd = 0.0;

        for (int wR = 0; wR < ${e}; wR++) {
          float dyR = float(dyRCorner + wR) / ${r}.0;

          if (dyR < 0.0 || dyR >= ${t.outHeight}.0 || fract(dyR) > 0.0) {
            continue;
          }
          int idyR = int(dyR);

          int wRPerm = ${e} - 1 - wR;

          for (int wC = 0; wC < ${s}; wC++) {
            float dyC = float(dyCCorner + wC) / ${i}.0;

            if (dyC < 0.0 || dyC >= ${t.outWidth}.0 ||
                fract(dyC) > 0.0) {
              continue;
            }
            int idyC = int(dyC);

            int wCPerm = ${s} - 1 - wC;

            // TO DO: Vec4 over the channelMul
            for (int dm = 0; dm < ${u}; dm++) {
              int d2 = d1 * ${u} + dm;
              float xValue = getDy(batch, idyR, idyC, d2);
              float wValue = getW(wRPerm, wCPerm, d1, dm);
              dotProd += xValue * wValue;
            }
          }
        }
        setOutput(dotProd);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function fct(n){const{inputs:t,backend:e,attrs:s}=n,{x:r,dy:i}=t,{strides:o,dilations:l,pad:u,dimRoundingMode:h,filterShape:d}=s,p=cs(r.shape,d,o,l,u,h,!0),m=new hct(p);return e.runWebGLProgram(m,[r,i],"float32")}const pct={kernelName:MC,backendName:"webgl",kernelFunc:fct};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function mct(n){const{inputs:t,backend:e,attrs:s}=n,{dy:r,filter:i}=t,{strides:o,dilations:l,pad:u,dimRoundingMode:h,inputShape:d}=s,p=cs(d,i.shape,o,l,u,h,!0),m=new dct(p);return e.runWebGLProgram(m,[r,i],"float32")}const gct={kernelName:FC,backendName:"webgl",kernelFunc:mct};/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class yct{constructor(t){this.variableNames=["X"],this.outputShape=[t,t],this.userCode=`
      void main() {
          ivec2 coords = getOutputCoords();
          float val = coords[0] == coords[1] ? getX(coords[0]) : 0.0;
          setOutput(val);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function xct(n){const{inputs:t,backend:e}=n,{x:s}=t,r=[...s.shape,...s.shape],i=yt(s.shape),o=Nt({inputs:{x:s},backend:e,attrs:{shape:[i]}}),l=new yct(i),u=e.runWebGLProgram(l,[o],o.dtype),h=Nt({inputs:{x:u},backend:e,attrs:{shape:r}});return e.disposeIntermediateTensorInfo(o),e.disposeIntermediateTensorInfo(u),h}const bct={kernelName:L$,backendName:"webgl",kernelFunc:xct};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class vct{constructor(t){this.variableNames=["x","W"],this.outputShape=t.outShape;const{inHeight:e,inWidth:s,padInfo:r,strideHeight:i,strideWidth:o,filterHeight:l,filterWidth:u,dilationHeight:h,dilationWidth:d}=t,{top:p,left:m}=r;this.userCode=`
      const ivec2 strides = ivec2(${i}, ${o});
      const ivec2 pads = ivec2(${p}, ${m});
      const float neg_infinity = -3.4e38;

      void main() {
        ivec4 coords = getOutputCoords();
        int batch = coords.x;
        int d1 = coords.w;
        ivec2 outTopLeftCorner =
            coords.yz * strides - pads;
        int hBeg = outTopLeftCorner.x;
        int wBeg = outTopLeftCorner.y;

        float curVal = neg_infinity;
        for (int h = 0; h < ${l}; h++) {
          int hIn = hBeg + h * ${h};

          if (hIn >= 0 && hIn < ${e}) {
            for (int w = 0; w < ${u}; w++) {
              int wIn = wBeg + w * ${d};

              if (wIn >= 0 && wIn < ${s}) {
                float xVal = getX(batch, hIn, wIn, d1);
                float wVal = getW(h, w, d1);

                float val = xVal + wVal;
                if (val > curVal) {
                  curVal = val;
                }
              }
            }
          }
        }

        float result = curVal;
        setOutput(result);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function wct(n){const{inputs:t,backend:e,attrs:s}=n,{x:r,filter:i}=t,{strides:o,pad:l,dilations:u}=s,h=Ap(r.shape,i.shape,o,l,"NHWC",u);let d;const p=new vct(h);d=e.runWebGLProgram(p,[r,i],"float32");const m=Nt({inputs:{x:d},backend:e,attrs:{shape:h.outShape}});return e.disposeIntermediateTensorInfo(d),m}const Cct={kernelName:k0,backendName:"webgl",kernelFunc:wct};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Sct(n){const{inputs:t,backend:e,attrs:s}=n,{equation:r}=s,i=t,{allDims:o,summedDims:l,idDims:u}=iT(r,i.length);aT(o.length,u,i);const{path:h,steps:d}=lT(l,u),p=d.length;let m=null,y=o.length;const x=[];for(let v=0;v<p;++v){for(const C of d[v]){const{permutationIndices:S,expandDims:E}=oT(y,u[C]);let _;uT(S)?_=i[C]:(_=Vs({inputs:{x:i[C]},backend:e,attrs:{perm:S}}),x.push(_));const I=_.shape.slice();for(let O=0;O<E.length;++O)I.splice(E[O],0,1);Oe(_.shape,I)||(_=Nt({inputs:{x:_},backend:e,attrs:{shape:I}}),x.push(_)),m===null?m=_:(m=XT({inputs:{a:_,b:m},backend:e}),x.push(m))}v<p-1&&(h[v]>=0&&(m=zx({inputs:{x:m},backend:e,attrs:{axis:h[v]-(o.length-y),keepDims:!1}}),x.push(m)),y--)}for(const v of x)v!==m&&e.disposeIntermediateTensorInfo(v);return m}const Tct={kernelName:LC,backendName:"webgl",kernelFunc:Sct};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Ect="return (x >= 0.0) ? x : (exp(x) - 1.0);",Ict=`
  vec4 result;

  result.r = (x.r >= 0.0) ? x.r : (exp(x.r) - 1.0);
  result.g = (x.g >= 0.0) ? x.g : (exp(x.g) - 1.0);
  result.b = (x.b >= 0.0) ? x.b : (exp(x.b) - 1.0);
  result.a = (x.a >= 0.0) ? x.a : (exp(x.a) - 1.0);

  return result;
`,_ct=Ce({opSnippet:Ect,packedOpSnippet:Ict}),kct={kernelName:Hf,backendName:"webgl",kernelFunc:_ct};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Act="return (b >= 0.0) ? a : a * (b + 1.0);",Nct=`
  vec4 bGTEZero = vec4(greaterThanEqual(b, vec4(0.)));
  return (bGTEZero * a) + ((vec4(1.0) - bGTEZero) * (a * (b + vec4(1.0))));
`,Rct=n=>{const{inputs:t,backend:e}=n,{dy:s,y:r}=t,i=dt().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new wh(Nct,s.shape,r.shape):new pu(Act,s.shape,r.shape);return e.runWebGLProgram(i,[s,r],s.dtype)},$ct={kernelName:PC,backendName:"webgl",kernelFunc:Rct};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Dct=`
  return vec4(equal(a, b));
`,Oct="return float(a == b);",Mct=ds({opSnippet:Oct,packedOpSnippet:Dct,dtype:"bool",cpuKernelImpl:fot}),Fct={kernelName:A0,backendName:"webgl",kernelFunc:Mct};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Lct=`
  // Error function is calculated approximately with elementary function.
  // See "Handbook of Mathematical Functions with Formulas,
  // Graphs, and Mathematical Tables", Abramowitz and Stegun.
  float p = ${ZS};
  float a1 = ${JS};
  float a2 = ${tT};
  float a3 = ${eT};
  float a4 = ${nT};
  float a5 = ${sT};

  float sign = sign(x);
  x = abs(x);
  float t = 1.0 / (1.0 + p * x);
  return sign * (1.0 - (((((a5*t + a4)*t) + a3)*t + a2)*t + a1)*t*exp(-x*x));
`,Pct=Ce({opSnippet:Lct}),Vct={kernelName:qf,backendName:"webgl",kernelFunc:Pct};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const zct=Ch+`
  return exp(x);
`,Bct=`
  vec4 result = exp(x);
  bvec4 isNaN = isnan(x);
  result.r = isNaN.r ? x.r : result.r;
  result.g = isNaN.g ? x.g : result.g;
  result.b = isNaN.b ? x.b : result.b;
  result.a = isNaN.a ? x.a : result.a;

  return result;
`,JL=Ce({opSnippet:zct,packedOpSnippet:Bct,cpuKernelImpl:pot,dtype:"float32"}),Uct={kernelName:jf,backendName:"webgl",kernelFunc:JL};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Aw(n){const{inputs:t,attrs:e,backend:s}=n,{dim:r}=e,{input:i}=t,o=i.shape.length,l=i.shape.slice();let u=r;return r<0&&(U(-(o+1)<=r,()=>`Axis must be in the interval [${-(o+1)}, ${o}]`),u=o+r+1),l.splice(u,0,1),Nt({inputs:{x:i},backend:s,attrs:{shape:l}})}const Gct={kernelName:N0,backendName:"webgl",kernelFunc:Aw};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const pN="return exp(x) - 1.0;",Wct=Ce({opSnippet:pN,packedOpSnippet:pN,cpuKernelImpl:mot}),Hct={kernelName:Kf,backendName:"webgl",kernelFunc:Wct};/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class mN{constructor(t,e,s){this.variableNames=["real","imag"];const r=e[1];this.outputShape=e;const i=s?`2.0 * ${Math.PI}`:`-2.0 * ${Math.PI}`,o=s?`${r}.0`:"1.0";let l;if(t==="real")l="return real * expR - imag * expI;";else if(t==="imag")l="return real * expI + imag * expR;";else throw new Error(`FFT component must be either "real" or "imag", got ${t}.`);this.userCode=`
      const float exponentMultiplier = ${i};

      float unaryOpComplex(float real, float expR, float imag, float expI) {
        ${l}
      }

      float mulMatDFT(int batch, int index) {
        float indexRatio = float(index) / float(${r});
        float exponentMultiplierTimesIndexRatio =
            exponentMultiplier * indexRatio;

        float result = 0.0;

        for (int i = 0; i < ${r}; i++) {
          // x = (-2|2 * PI / N) * index * i;
          float x = exponentMultiplierTimesIndexRatio * float(i);
          float expR = cos(x);
          float expI = sin(x);
          float real = getReal(batch, i);
          float imag = getImag(batch, i);

          result +=
              unaryOpComplex(real, expR, imag, expI) / ${o};
        }

        return result;
      }

      void main() {
        ivec2 coords = getOutputCoords();
        setOutput(mulMatDFT(coords[0], coords[1]));
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function tP(n,t,e){const s=e.texData.get(n.dataId),r=yt(n.shape),i=n.shape[n.shape.length-1],o=r/i,l=Nt({inputs:{x:n},backend:e,attrs:{shape:[o,i]}}),u=l.shape,h=new mN("real",u,t),d=new mN("imag",u,t),p=[{dataId:s.complexTensorInfos.real.dataId,dtype:s.complexTensorInfos.real.dtype,shape:u},{dataId:s.complexTensorInfos.imag.dataId,dtype:s.complexTensorInfos.imag.dtype,shape:u}],m=e.runWebGLProgram(h,p,"float32"),y=e.runWebGLProgram(d,p,"float32"),x=ol({inputs:{real:m,imag:y},backend:e});e.disposeIntermediateTensorInfo(m),e.disposeIntermediateTensorInfo(y);const v=Nt({inputs:{x},backend:e,attrs:{shape:n.shape}});return e.disposeIntermediateTensorInfo(l),e.disposeIntermediateTensorInfo(x),v}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function qct(n){const{inputs:t,backend:e}=n,{input:s}=t;return tP(s,!1,e)}const jct={kernelName:VC,backendName:"webgl",kernelFunc:qct};/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Kct{constructor(t,e){this.outputShape=[],this.customUniforms=[{name:"value",type:"float"}],this.variableNames=["x"],this.outputShape=t,this.userCode=`
      void main() {
        // Input can be obtained from uniform value.
        setOutput(value);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Yp(n){const{backend:t,attrs:e}=n,{shape:s,value:r}=e;let{dtype:i}=e;if(i=i||lh(r),i==="string"){const o=bn(i,yt(s));return o.fill(r),t.makeTensorInfo(s,i,o)}else{const o=new Kct(s,r),l=[[r]];return t.runWebGLProgram(o,[],i,l)}}const Xct={kernelName:zC,backendName:"webgl",kernelFunc:Yp};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Yct{constructor(t){this.variableNames=["Image"],this.outputShape=[];const e=t[2];this.outputShape=t,this.userCode=`
        void main() {
          ivec4 coords = getOutputCoords();
          int x = coords[2];

          int coordX = ${e} - x - 1;
          float outputValue;
          if(coordX >= 0 && coordX < ${e}) {
            outputValue = getImage(coords[0], coords[1], coordX, coords[3]);
          } else {
            outputValue = getImage(coords[0], coords[1], coords[2], coords[3]);
          }
          setOutput(outputValue);
        }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Qct={kernelName:BC,backendName:"webgl",kernelFunc:({inputs:n,backend:t})=>{const{image:e}=n,s=t,r=new Yct(e.shape);return s.runWebGLProgram(r,[e],e.dtype)}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const gN="return floor(x);",Zct=Ce({opSnippet:gN,packedOpSnippet:gN,cpuKernelImpl:got}),Jct={kernelName:Xf,backendName:"webgl",kernelFunc:Zct};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const tht=`
  float s = sign(a) * sign(b);
  int ia = round(a);
  int ib = round(b);
  if (ib != 0) {
    // Windows (D3D) wants guaranteed non-zero int division at compile-time.
    return float(idiv(ia, ib, s));
  } else {
    return NAN;
  }
`,eht=`
  ivec4 ia = round(a);
  ivec4 ib = round(b);
  bvec4 cond = notEqual(ib, ivec4(0));
  ivec4 result = ivec4(0);
  vec4 s = sign(a) * sign(b);

  // Windows (D3D) wants guaranteed non-zero int division at compile-time.
  if (cond[0]) {
    result[0] = idiv(ia[0], ib[0], s[0]);
  }
  if (cond[1]) {
    result[1] = idiv(ia[1], ib[1], s[1]);
  }
  if (cond[2]) {
    result[2] = idiv(ia[2], ib[2], s[2]);
  }
  if (cond[3]) {
    result[3] = idiv(ia[3], ib[3], s[3]);
  }
  return vec4(result);
`,nht=ds({opSnippet:tht,packedOpSnippet:eht,dtype:"int32"}),sht={kernelName:Yf,backendName:"webgl",kernelFunc:nht};/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class rht{constructor(t){this.variableNames=["A"];const e=zs(),[s,r]=t;this.outputShape=t,this.userCode=`
      void main() {
        ivec3 coords = getOutputCoords();
        int texR = coords[0];
        int texC = coords[1];
        int depth = coords[2];
        vec2 uv = (vec2(texC, texR) + halfCR) / vec2(${r}.0, ${s}.0);

        vec4 values = ${e.texture2D}(A, uv);
        float value;
        if (depth == 0) {
          value = values.r;
        } else if (depth == 1) {
          value = values.g;
        } else if (depth == 2) {
          value = values.b;
        } else if (depth == 3) {
          value = values.a;
        }

        setOutput(floor(value * 255.0 + 0.5));
      }
    `}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class iht{constructor(t){this.variableNames=["A"],this.packedInputs=!1,this.packedOutput=!0;const e=zs(),[s,r]=t;this.outputShape=t,this.userCode=`
      void main() {
        ivec3 coords = getOutputCoords();
        int texR = coords[0];
        int texC = coords[1];
        int depth = coords[2];

        vec4 result = vec4(0.);

        for(int row=0; row<=1; row++) {
          for(int col=0; col<=1; col++) {
            texC = coords[1] + row;
            depth = coords[2] + col;

            vec2 uv = (vec2(texC, texR) + halfCR) /
                       vec2(${r}.0, ${s}.0);
            vec4 values = ${e.texture2D}(A, uv);
            float value;
            if (depth == 0) {
              value = values.r;
            } else if (depth == 1) {
              value = values.g;
            } else if (depth == 2) {
              value = values.b;
            } else if (depth == 3) {
              value = values.a;
            }

            result[row * 2 + col] = floor(value * 255.0 + 0.5);
          }
        }

        ${e.output} = result;
      }
    `}}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const oht={kernelName:Zv,backendName:"webgl",kernelFunc:aht};let Cc,vv=dt().getBool("CANVAS2D_WILL_READ_FREQUENTLY_FOR_GPU");function aht(n){const{inputs:t,backend:e,attrs:s}=n;let{pixels:r}=t;const{numChannels:i}=s,o=typeof HTMLVideoElement<"u"&&r instanceof HTMLVideoElement,l=typeof HTMLImageElement<"u"&&r instanceof HTMLImageElement,[u,h]=o?[r.videoWidth,r.videoHeight]:[r.width,r.height],d=[h,u],p=[h,u,i];if(l||o){const v=dt().getBool("CANVAS2D_WILL_READ_FREQUENTLY_FOR_GPU");(Cc==null||v!==vv)&&(vv=v,Cc=document.createElement("canvas").getContext("2d",{willReadFrequently:vv})),Cc.canvas.width=u,Cc.canvas.height=h,Cc.drawImage(r,0,0,u,h),r=Cc.canvas}const m=e.makeTensorInfo(d,"int32");e.texData.get(m.dataId).usage=wr.PIXELS,e.gpgpu.uploadPixelDataToTexture(e.getTexture(m.dataId),r);const y=dt().getBool("WEBGL_PACK")?new iht(p):new rht(p),x=e.runWebGLProgram(y,[m],"int32");return e.disposeData(m.dataId),x}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function lht(n){const{inputs:t,backend:e,attrs:s}=n,{x:r,filter:i,bias:o,preluActivationWeights:l}=t,{strides:u,pad:h,dataFormat:d,dilations:p,dimRoundingMode:m,activation:y,leakyreluAlpha:x}=s,v=jo(d),C=cs(r.shape,i.shape,u,p,h,m,!1,v);let S;const E=[],_=o!=null,I=l!=null,O=y==="leakyrelu",P=()=>{const N=[r,i],R=($,A)=>{if(A==="NCHW"&&$.shape.length===1&&$.shape[0]!==1){const V=Nt({inputs:{x:$},backend:e,attrs:{shape:[$.shape[0],1,1]}});return E.push(V),V}return $};if(_&&N.push(R(o,d)),I&&N.push(R(l,d)),O){const $=e.makeTensorInfo([],"float32",Qa(x,"float32"));N.push($),E.push($)}return N};if(C.filterHeight===1&&C.filterWidth===1&&C.dilationHeight===1&&C.dilationWidth===1&&C.strideHeight===1&&C.strideWidth===1&&(C.padInfo.type==="SAME"||C.padInfo.type==="VALID"))S=KL({x:r,filter:i,convInfo:C,backend:e,bias:o,activation:y,preluActivationWeights:l,leakyreluAlpha:x});else if(C.strideWidth<=2&&v==="channelsLast"&&dt().getBool("WEBGL_EXP_CONV")){const N=y?wf(y,!0):null,R=new jL(C,_,N,I,O),$=[[C.padInfo.top,C.padInfo.left],[C.strideHeight,C.strideWidth],[C.dilationHeight,C.dilationWidth],[C.inHeight,C.inWidth]],A=P();S=e.runWebGLProgram(R,A,"float32",$)}else if(dt().getBool("WEBGL_CONV_IM2COL"))S=XL({x:r,filter:i,convInfo:C,backend:e,bias:o,activation:y,preluActivationWeights:l,leakyreluAlpha:x});else{const N=y?wf(y,!1):null,R=new qL(C,_,N,I,O),$=P();S=e.runWebGLProgram(R,$,"float32")}const D=Nt({inputs:{x:S},backend:e,attrs:{shape:C.outShape}});return E.push(S),E.forEach(N=>e.disposeIntermediateTensorInfo(N)),D}const uht={kernelName:Cy,backendName:"webgl",kernelFunc:lht};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function cht(n){const{inputs:t,backend:e,attrs:s}=n,{x:r,filter:i,bias:o,preluActivationWeights:l}=t,{strides:u,pad:h,dilations:d,dimRoundingMode:p,activation:m,leakyreluAlpha:y}=s,x=[];let v=d;v==null&&(v=[1,1]),U(Is(u,v),()=>`Error in depthwiseConv2d: Either strides or dilations must be 1. Got strides ${u} and dilations '${v}'`);const C=cs(r.shape,i.shape,u,v,h,p,!0),S=dt().getBool("WEBGL_PACK_DEPTHWISECONV")&&C.strideWidth<=2&&C.outChannels/C.inChannels===1,E=m?wf(m,S):null,_=[r,i],I=o!=null,O=l!=null,P=m==="leakyrelu";if(I&&_.push(o),O&&_.push(l),P){const $=e.makeTensorInfo([],"float32",Qa(y,"float32"));_.push($),x.push($)}let D;S?D=new ZL(C,I,E,O,P):D=new QL(C,I,E,O,P);const N=[[C.padInfo.top,C.padInfo.left],[C.strideHeight,C.strideWidth],[C.dilationHeight,C.dilationWidth],[C.inHeight,C.inWidth]],R=e.runWebGLProgram(D,_,"float32",N);return x.forEach($=>e.disposeIntermediateTensorInfo($)),R}const hht={kernelName:nD,backendName:"webgl",kernelFunc:cht};class dht{constructor(t,e,s,r){this.sliceDim=t,this.strides=e,this.paramsShape=r,this.variableNames=["x","indices"],this.outputShape=s;const i=He(s.length);let o=`
    int index;`;for(let l=0;l<this.sliceDim;l++)o+=`
          index = round(getIndices(coords[0], ${l}));
          out_of_bounds = out_of_bounds || index < 0;
          out_of_bounds = out_of_bounds || index >= ${this.paramsShape[l]};
          flattenIndex += index * ${this.strides[l]};`;this.userCode=`
         void main() {
          ${i} coords = getOutputCoords();
          int flattenIndex = 0;
          bool out_of_bounds = false;

          ${o}

          setOutput(out_of_bounds ? 0.0 : getX(flattenIndex, coords[1]));
        }
      `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function fht(n){const{inputs:t,backend:e}=n,{params:s,indices:r}=t,i=r.shape,o=i[i.length-1],l=yt(s.shape),[u,h,d,p]=BS(s,r),m=Nt({inputs:{x:r},backend:e,attrs:{shape:[h,o]}}),y=Nt({inputs:{x:s},backend:e,attrs:{shape:[yt(s.shape)/d,d]}});if(e.shouldExecuteOnCPU([s,r])||s.dtype==="string"){const S=e.readSync(r.dataId),E=e.bufferSync(s),_=yot(S,E,s.dtype,h,o,d,p,s.shape,l);return e.makeTensorInfo(u,s.dtype,_.values)}const x=new dht(o,p,[h,d],s.shape),v=e.runWebGLProgram(x,[y,m],y.dtype),C=Nt({inputs:{x:v},backend:e,attrs:{shape:u}});return e.disposeIntermediateTensorInfo(m),e.disposeIntermediateTensorInfo(y),e.disposeIntermediateTensorInfo(v),C}const pht={kernelName:P$,backendName:"webgl",kernelFunc:fht};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class mht{constructor(t,e){this.variableNames=["A","indices"],this.outputShape=e,this.rank=e.length;const s=He(this.rank),r=ght(t);this.userCode=`
      void main() {
        ${s} resRC = getOutputCoords();
        int index = int(getIndices(resRC.x, resRC.z));
        float inBounds = (index >= 0) && (index < ${t[2]}) ? 1.0 : 0.0;
        setOutput(inBounds * getA(${r}));
      }
    `}}function ght(n,t){const e=["resRC.x","resRC.y","resRC.z","resRC.w"],s=[];for(let r=0;r<n.length;r++)r===2?s.push("index"):s.push(`${e[r]}`);return s.join()}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function eP(n){const{inputs:t,backend:e,attrs:s}=n,{x:r,indices:i}=t,{axis:o,batchDims:l}=s,u=le(o,r.shape)[0];if(dt().get("DEBUG")){const E=e.readSync(i.dataId),_=r.shape[u];for(let I=0;I<E.length;++I){const O=E[I];U(O<=_-1&&O>=0,()=>`GatherV2: the index value ${O} is not in [0, ${_-1}]`)}}const h=hT(r,i,u,l),d=yt(i.shape),p=[],m=Nt({inputs:{x:r},backend:e,attrs:{shape:[h.batchSize,h.outerSize,h.dimSize,h.sliceSize]}}),y=Nt({inputs:{x:i},backend:e,attrs:{shape:[h.batchSize,d/h.batchSize]}});p.push(m),p.push(y);const x=[h.batchSize,h.outerSize,d/h.batchSize,h.sliceSize];if(e.shouldExecuteOnCPU([r,i])||r.dtype==="string"){const E=e.bufferSync(y),_=e.bufferSync(m),I=xot(_,E,x);return p.forEach(O=>e.disposeIntermediateTensorInfo(O)),e.makeTensorInfo(h.outputShape,I.dtype,I.values)}const v=new mht(m.shape,x),C=e.runWebGLProgram(v,[m,y],m.dtype);p.push(C);const S=Nt({inputs:{x:C},backend:e,attrs:{shape:h.outputShape}});return p.forEach(E=>e.disposeIntermediateTensorInfo(E)),S}const yht={kernelName:$0,backendName:"webgl",kernelFunc:eP};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const xht="return float(a > b);",bht=`
  return vec4(greaterThan(a, b));
`,vht=ds({opSnippet:xht,packedOpSnippet:bht,cpuKernelImpl:bot,dtype:"bool"}),wht={kernelName:D0,backendName:"webgl",kernelFunc:vht};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Cht="return float(a >= b);",Sht=`
  return vec4(greaterThanEqual(a, b));
`,Tht=ds({opSnippet:Cht,packedOpSnippet:Sht,dtype:"bool",cpuKernelImpl:vot}),Eht={kernelName:Qf,backendName:"webgl",kernelFunc:Tht};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Iht(n){const{inputs:t,backend:e}=n,{input:s}=t;return tP(s,!0,e)}const _ht={kernelName:UC,backendName:"webgl",kernelFunc:Iht};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const kht="return float(!isnan(x) && !isinf(x));",Aht=Ce({opSnippet:kht,dtype:"bool"}),Nht={kernelName:Jf,backendName:"webgl",kernelFunc:Aht};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Rht="return float(isinf(x));",$ht=Ce({opSnippet:Rht,dtype:"bool"}),Dht={kernelName:tp,backendName:"webgl",kernelFunc:$ht};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Oht="return float(isnan(x));",Mht=Ce({opSnippet:Oht,dtype:"bool"}),Fht={kernelName:ep,backendName:"webgl",kernelFunc:Mht};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Lht="return float(a < b);",Pht=`
  return vec4(lessThan(a, b));
`,Vht=ds({opSnippet:Lht,packedOpSnippet:Pht,cpuKernelImpl:wot,dtype:"bool"}),zht={kernelName:M0,backendName:"webgl",kernelFunc:Vht};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Bht="return float(a <= b);",Uht=`
  return vec4(lessThanEqual(a, b));
`,Ght=ds({opSnippet:Bht,packedOpSnippet:Uht,cpuKernelImpl:Cot,dtype:"bool"}),Wht={kernelName:F0,backendName:"webgl",kernelFunc:Ght};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Hht(n){const{backend:t,attrs:e}=n,{start:s,stop:r,num:i}=e,o=Sot(s,r,i);return t.makeTensorInfo([o.length],"float32",o)}const qht={kernelName:V$,backendName:"webgl",kernelFunc:Hht};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const jht=Ch+`
  return x < 0.0 ? 0./0. : log(x);
`,Kht=`
  vec4 result = log(x);
  bvec4 isNaN = isnan(x);
  result.r = isNaN.r ? x.r : (x.r < 0.0 ? 0./0. : result.r);
  result.g = isNaN.g ? x.g : (x.g < 0.0 ? 0./0. : result.g);
  result.b = isNaN.b ? x.b : (x.b < 0.0 ? 0./0. : result.b);
  result.a = isNaN.a ? x.a : (x.a < 0.0 ? 0./0. : result.a);
  return result;
`,Xht=Ce({opSnippet:jht,packedOpSnippet:Kht,cpuKernelImpl:Tot}),Yht={kernelName:np,backendName:"webgl",kernelFunc:Xht};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Qht=Ch+`
  return log(1.0 + x);
`,Zht=Ce({opSnippet:Qht}),Jht={kernelName:sp,backendName:"webgl",kernelFunc:Zht};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const tdt="return float(a >= 1.0 && b >= 1.0);",edt=`
  return vec4(
    vec4(greaterThanEqual(a, vec4(1.0))) *
    vec4(greaterThanEqual(b, vec4(1.0))));
`,ndt=ds({opSnippet:tdt,packedOpSnippet:edt,dtype:"bool"}),sdt={kernelName:L0,backendName:"webgl",kernelFunc:ndt};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const rdt="return float(!(x >= 1.0));",idt=Ce({opSnippet:rdt}),odt={kernelName:P0,backendName:"webgl",kernelFunc:idt};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const adt="return float(a >= 1.0 || b >= 1.0);",ldt=`
  return min(
    vec4(greaterThanEqual(a, vec4(1.0))) +
    vec4(greaterThanEqual(b, vec4(1.0))),
    vec4(1.0));
`,udt=ds({opSnippet:adt,packedOpSnippet:ldt,dtype:"bool"}),cdt={kernelName:V0,backendName:"webgl",kernelFunc:udt};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class hdt{constructor(t,e,s,r,i){this.variableNames=["x"],this.outputShape=[];const o=e,l=t[3]-1;this.outputShape=t;let u;const h=`float(${s}) + float(${r}) * sum`;i===.5?u=`inversesqrt(${h})`:i===1?u=`1.0/(${h})`:u=`exp(log(${h}) * float(-${i}));`,this.userCode=`
      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int r = coords[1];
        int c = coords[2];
        int d = coords[3];
        float x = getX(b, r, c, d);
        float sum = 0.0;
        for (int j = -${o}; j <= ${o}; j++) {
          int idx = d + j;
          if (idx >= 0 && idx <=  ${l}) {
            float z = getX(b, r, c, idx);
            sum += z * z;
          }
        }
        float val = x * ${u};
        setOutput(val);
      }
    `}}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class ddt{constructor(t,e,s,r,i){this.variableNames=["x"],this.outputShape=[],this.packedInputs=!0,this.packedOutput=!0;const o=e,l=t[3]-1;this.outputShape=t;let u;const h=`float(${s}) + float(${r}) * sum`;i===.5?u=`inversesqrt(${h})`:i===1?u=`1.0/(${h})`:u=`exp(log(${h}) * float(-${i}));`,this.userCode=`
      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords.x;
        int r = coords.y;
        int c = coords.z;
        int d = coords.w;

        bool hasNextCol = d < ${this.outputShape[3]};
        bool hasNextRow = c < ${this.outputShape[2]};

        vec4 sum = vec4(0.);
        vec4 xFragAtOutputCoords = getX(b, r, c, d);

        vec4 xAtOutputCoords = vec4(
          getChannel(xFragAtOutputCoords, vec2(c, d)),
          hasNextCol ?
            getChannel(xFragAtOutputCoords, vec2(c, d + 1)) : 0.0,
          hasNextRow ?
            getChannel(xFragAtOutputCoords , vec2(c + 1, d)) : 0.0,
          (hasNextRow && hasNextCol) ?
            getChannel(xFragAtOutputCoords, vec2(c + 1, d + 1)) : 0.0
        );

        int firstChannel = d - ${o};
        vec2 cache = vec2(0.);
        if(firstChannel >= 0){
          vec4 firstChannelFrag = getX(b, r, c, firstChannel);
          cache.x = getChannel(firstChannelFrag, vec2(c, firstChannel));
            if(hasNextRow){
              cache.y = getChannel(firstChannelFrag, vec2(c + 1, firstChannel));
            }
        }

        ivec2 depth = ivec2(d, d + 1);
        for (int j = - ${o}; j <= ${o}; j++) {
          ivec2 idx = depth + j;
          bvec2 aboveLowerBound = greaterThanEqual(idx, ivec2(0));
          bvec2 belowUpperBound = lessThanEqual(idx, ivec2(${l}));

          bool depthInRange = aboveLowerBound.x && belowUpperBound.x;
          bool depthPlusOneInRange = aboveLowerBound.y && belowUpperBound.y;

          if(depthInRange || depthPlusOneInRange){
            vec4 z = vec4(0.);
            vec4 xFragAtCurrentDepth;
            z.xz = cache.xy;
            if(depthPlusOneInRange && hasNextCol){
              xFragAtCurrentDepth = idx.y != d ?
                getX(b, r, c, idx.y) : xFragAtOutputCoords;
              z.y = getChannel(xFragAtCurrentDepth, vec2(c, idx.y));
              if(hasNextRow){
                z.w = getChannel(xFragAtCurrentDepth, vec2(c + 1, idx.y));
              }
            }
            cache.xy = z.yw;
            sum += z * z;
          }
        }
        vec4 result = xAtOutputCoords * ${u};
        setOutput(result);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const fdt=n=>{const{inputs:t,backend:e,attrs:s}=n,{x:r}=t,{depthRadius:i,bias:o,alpha:l,beta:u}=s,h=dt().getBool("WEBGL_PACK_NORMALIZATION")?new ddt(r.shape,i,o,l,u):new hdt(r.shape,i,o,l,u);return e.runWebGLProgram(h,[r],r.dtype)},pdt={kernelName:z0,backendName:"webgl",kernelFunc:fdt};/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class mdt{constructor(t,e,s,r,i){this.variableNames=["inputImage","outputImage","dy"],this.outputShape=[],this.outputShape=t,this.depth=t[3],this.depthRadius=e,this.bias=s,this.alpha=r,this.beta=i,this.userCode=`
      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int r = coords[1];
        int c = coords[2];

        float result = 0.0;
        for (int d = 0; d < ${this.depth}; ++d) {
          int depthBegin = int(max(0.0, float(d - ${e})));
          int depthEnd = int(min(float(${this.depth}),
              float(d + ${e} + 1)));

          const int MIN_DEPTH_BEGIN = 0;
          const int MAX_DEPTH_END = ${this.depth};

          float norm = 0.0;
          for (int k = MIN_DEPTH_BEGIN; k < MAX_DEPTH_END; ++k) {
            if (k < depthBegin){
              continue;
            }
            else if (k >= depthBegin && k < depthEnd) {
              norm += getInputImage(b, r, c, k) * getInputImage(b, r, c, k);
            }
            else {
              break;
            }
          }

          norm = float(${r}) * norm + float(${s});

          for(int k = MIN_DEPTH_BEGIN; k < MAX_DEPTH_END; ++k){
            if (k < depthBegin){
              continue;
            }
            else if (k >= depthBegin && k < depthEnd){
              float dyi = -2.0 * float(${r})
                * float(${i})
                * getInputImage(b, r, c, k) * getOutputImage(b, r, c, d)
                / norm;
              if (k == d) {
                dyi += pow(norm, -1.0 * ${i});
              }
              if (k == coords[3]) {
                dyi *= getDy(b, r, c, d);
                result += dyi;
              }
            }
            else {
              break;
            }
          }
      }
      setOutput(result);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const gdt=n=>{const{inputs:t,backend:e,attrs:s}=n,{x:r,y:i,dy:o}=t,{depthRadius:l,bias:u,alpha:h,beta:d}=s,p=new mdt(r.shape,l,u,h,d);return e.runWebGLProgram(p,[r,i,o],r.dtype)},ydt={kernelName:WC,backendName:"webgl",kernelFunc:gdt};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function xdt(n,t,e,s){const r=yt(t),o=yt(n.shape)/r,l=Nt({inputs:{x:n},attrs:{shape:[o,r]},backend:s}),u=Au(l,n.dtype,"max",s),h=Nt({inputs:{x:u},attrs:{shape:e},backend:s});return s.disposeIntermediateTensorInfo(l),s.disposeIntermediateTensorInfo(u),h}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function nP(n){const{inputs:t,backend:e,attrs:s}=n,{x:r}=t,{reductionIndices:i,keepDims:o}=s,l=r.shape.length,u=le(i,r.shape);let h=u;const d=hn(h,l),p=d!=null,m=e.shouldExecuteOnCPU([r]);let y=r;if(p){if(m){const _=e.texData.get(y.dataId).values,I=new Array(l);for(let D=0;D<I.length;D++)I[D]=r.shape[d[D]];const O=jT(_,r.shape,r.dtype,d,I);y=e.makeTensorInfo(I,r.dtype);const P=e.texData.get(y.dataId);P.values=O}else y=Vx(r,d,e);h=Cn(h.length,l)}hs("max",h,l);const[x,v]=es(y.shape,h);let C=x;o&&(C=Nn(x,u));let S;if(m){const _=e.texData.get(y.dataId).values,I=Eot(_,yt(v),C,r.dtype);S=e.makeTensorInfo(C,r.dtype);const O=e.texData.get(S.dataId);O.values=I}else S=xdt(y,v,C,e);return p&&e.disposeIntermediateTensorInfo(y),S}const bdt={kernelName:B0,backendName:"webgl",kernelFunc:nP};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const vdt=KT+`
  return max(a, b);
`,wdt=`
  vec4 result = vec4(max(a, b));
  bvec4 isNaNA = isnan(a);
  bvec4 isNaNB = isnan(b);
  bvec4 isNaN = bvec4(isNaNA.x || isNaNB.x, isNaNA.y || isNaNB.y, isNaNA.z || isNaNB.z, isNaNA.w || isNaNB.w);
  `+ku+`
  return result;
`,Cdt=ds({opSnippet:vdt,packedOpSnippet:wdt,cpuKernelImpl:Iot}),Sdt={kernelName:rp,backendName:"webgl",kernelFunc:Cdt};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Tdt(n){const{inputs:t,backend:e,attrs:s}=n,{x:r}=t;jp(r,"maxPool");const{filterSize:i,strides:o,pad:l,dimRoundingMode:u}=s,h=1;U(Is(o,h),()=>`Error in maxPool: Either strides or dilations must be 1. Got strides ${o} and dilations '${h}'`);const d=Kr(r.shape,i,o,h,l,u);if(d.filterWidth===1&&d.filterHeight===1&&Oe(d.inShape,d.outShape))return cr({inputs:{x:r},backend:e});const p=new Cf(d,"max",!1);return e.runWebGLProgram(p,[r],r.dtype)}const Edt={kernelName:U0,backendName:"webgl",kernelFunc:Tdt};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Idt(n){const{inputs:t,backend:e,attrs:s}=n,{x:r}=t,{filterSize:i,strides:o,pad:l,dataFormat:u,dimRoundingMode:h}=s,d=[1,1,1],p=qo(r.shape,i,o,d,l,h,u),m=new YT(p,"max",!1);return e.runWebGLProgram(m,[r],r.dtype)}const _dt={kernelName:G0,backendName:"webgl",kernelFunc:Idt};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class kdt{constructor(t){this.variableNames=["dy","maxPos"],this.outputShape=t.inShape;const e=t.strideHeight,s=t.strideWidth,r=t.dilationHeight,i=t.effectiveFilterHeight,o=t.effectiveFilterWidth,l=i-1-t.padInfo.top,u=o-1-t.padInfo.left,h=i*o-1;this.userCode=`
      const ivec2 pads = ivec2(${l}, ${u});

      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];

        ivec2 dyRCCorner = coords.yz - pads;
        int dyRCorner = dyRCCorner.x;
        int dyCCorner = dyRCCorner.y;

        // Convolve dy(?, ?, d) with pos mask(:, :, d) to get dx(xR, xC, d).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;
        for (int wR = 0; wR < ${i};
          wR += ${r}) {
          float dyR = float(dyRCorner + wR) / ${e}.0;

          if (dyR < 0.0 || dyR >= ${t.outHeight}.0 || fract(dyR) > 0.0) {
            continue;
          }
          int idyR = int(dyR);

          for (int wC = 0; wC < ${o}; wC++) {
            float dyC = float(dyCCorner + wC) / ${s}.0;

            if (dyC < 0.0 || dyC >= ${t.outWidth}.0 ||
                fract(dyC) > 0.0) {
              continue;
            }
            int idyC = int(dyC);

            float dyValue = getDy(b, idyR, idyC, d);
            int maxPosValue = ${h} - int(getMaxPos(b, idyR, idyC, d));

            // Get the current value, check it against the value from the
            // position matrix.
            int curPosValue = wR * ${o} + wC;
            float mask = float(maxPosValue == curPosValue ? 1.0 : 0.0);

            dotProd += dyValue * mask;
          }
        }
        setOutput(dotProd);
      }
    `}}class Adt{constructor(t){this.variableNames=["dy","maxPos"],this.outputShape=t.inShape;const e=t.strideDepth,s=t.strideHeight,r=t.strideWidth,i=t.dilationDepth,o=t.dilationHeight,l=t.dilationWidth,u=t.effectiveFilterDepth,h=t.effectiveFilterHeight,d=t.effectiveFilterWidth,p=u-1-t.padInfo.front,m=h-1-t.padInfo.top,y=d-1-t.padInfo.left,x=u*h*d-1;this.userCode=`
      const ivec3 pads = ivec3(${p}, ${m}, ${y});

      void main() {
        ivec5 coords = getOutputCoords();
        int batch = coords.x;
        int ch = coords.u;

        ivec3 dyCorner = ivec3(coords.y, coords.z, coords.w) - pads;
        int dyDCorner = dyCorner.x;
        int dyRCorner = dyCorner.y;
        int dyCCorner = dyCorner.z;

        // Convolve dy(?, ?, ?, ch) with pos mask(:, :, :, d) to get
        // dx(xD, xR, xC, ch).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;

        for (int wD = 0; wD < ${u};
           wD += ${i}) {
          float dyD = float(dyDCorner + wD) / ${e}.0;

          if (dyD < 0.0 || dyD >= ${t.outDepth}.0 || fract(dyD) > 0.0) {
            continue;
          }
          int idyD = int(dyD);

          for (int wR = 0; wR < ${h};
              wR += ${o}) {
            float dyR = float(dyRCorner + wR) / ${s}.0;

            if (dyR < 0.0 || dyR >= ${t.outHeight}.0 ||
                fract(dyR) > 0.0) {
              continue;
            }
            int idyR = int(dyR);

            for (int wC = 0; wC < ${d};
                wC += ${l}) {
              float dyC = float(dyCCorner + wC) / ${r}.0;

              if (dyC < 0.0 || dyC >= ${t.outWidth}.0 ||
                  fract(dyC) > 0.0) {
                continue;
              }
              int idyC = int(dyC);

              float dyValue = getDy(batch, idyD, idyR, idyC, ch);
              int maxPosValue = ${x} -
                  int(getMaxPos(batch, idyD, idyR, idyC, ch));

              // Get the current value, check it against the value from the
              // position matrix.
              int curPosValue =
                  wD * ${h} * ${d} +
                  wR * ${d} + wC;
              float mask = float(maxPosValue == curPosValue ? 1.0 : 0.0);

              dotProd += dyValue * mask;
            }
          }
        }
        setOutput(dotProd);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Ndt(n){const{inputs:t,backend:e,attrs:s}=n,{dy:r,input:i}=t,o=i,{filterSize:l,strides:u,pad:h,dimRoundingMode:d}=s,p=[1,1,1],m=qo(o.shape,l,u,p,h,d),y=new YT(m,"max",!0),x=e.runWebGLProgram(y,[o],o.dtype),v=new Adt(m),C=e.runWebGLProgram(v,[r,x],o.dtype);return e.disposeIntermediateTensorInfo(x),C}const Rdt={kernelName:qC,backendName:"webgl",kernelFunc:Ndt};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function $dt(n){const{inputs:t,backend:e,attrs:s}=n,{dy:r,input:i,output:o}=t,l=i;jp([i,o],"maxPoolGrad");const{filterSize:u,strides:h,pad:d,dimRoundingMode:p}=s,m=Kr(l.shape,u,h,1,d,p),y=!0,x=new Cf(m,"max",y),v=e.runWebGLProgram(x,[l],l.dtype),C=new kdt(m),S=e.runWebGLProgram(C,[r,v],l.dtype);return e.disposeIntermediateTensorInfo(v),S}const Ddt={kernelName:HC,backendName:"webgl",kernelFunc:$dt};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Odt(n,t,e,s){let r=new Cf(e,"max",!1);const i=s.runWebGLProgram(r,[n],"float32");r=new Cf(e,"max",!0,!0,t);const o=s.runWebGLProgram(r,[n],"float32");return[i,o]}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Mdt={kernelName:z$,backendName:"webgl",kernelFunc:({inputs:n,attrs:t,backend:e})=>{const{x:s}=n,{filterSize:r,strides:i,pad:o,includeBatchInIndex:l}=t,u=e;U(s.shape.length===4,()=>`Error in maxPool: input must be rank 4 but got rank ${s.shape.length}.`);const h=[1,1];U(Is(i,h),()=>`Error in maxPool: Either strides or dilations must be 1. Got strides ${i} and dilations '${h}'`);const d=Kr(s.shape,r,i,h,o),[p,m]=Odt(s,l,d,u);return[p,m]}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Fdt(n,t,e,s){const r=yt(t),o=yt(n.shape)/r,l=Nt({inputs:{x:n},attrs:{shape:[o,r]},backend:s}),u=Au(l,"float32","mean",s),h=Nt({inputs:{x:u},attrs:{shape:e},backend:s});return s.disposeIntermediateTensorInfo(l),s.disposeIntermediateTensorInfo(u),h}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Ldt={kernelName:W0,backendName:"webgl",kernelFunc:({inputs:n,attrs:t,backend:e})=>{const{x:s}=n,{keepDims:r,axis:i}=t,o=e,l=s.shape.length,u=le(i,s.shape);let h=u;const d=hn(h,l),p=d!=null,m=o.shouldExecuteOnCPU([s]),y=[];let x=s;if(p){if(m){const I=o.texData.get(x.dataId).values,O=new Array(l);for(let N=0;N<O.length;N++)O[N]=s.shape[d[N]];const P=jT(I,s.shape,s.dtype,d,O);x=o.makeTensorInfo(O,s.dtype);const D=o.texData.get(x.dataId);D.values=P}else x=Vx(s,d,o);y.push(x),h=Cn(h.length,l)}hs("sum",h,l);const[v,C]=es(x.shape,h);let S=v;r&&(S=Nn(v,u));const E=Fdt(x,C,S,o);for(const _ of y)o.disposeIntermediateTensorInfo(_);return E}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Pdt(n){const{inputs:t,backend:e,attrs:s}=n,{x:r}=t,{axis:i,keepDims:o}=s,l=r.shape.length,u=le(i,r.shape);let h=u;const d=hn(h,l);let p=r;d!=null&&(p=Vs({inputs:{x:r},backend:e,attrs:{perm:d}}),h=Cn(h.length,r.shape.length)),hs("min",h,l);const[m,y]=es(p.shape,h),x=yt(y),v=Nt({inputs:{x:p},backend:e,attrs:{shape:[-1,x]}}),C=Au(v,v.dtype,"min",e);let S;if(o){const E=Nn(m,u);S=Nt({inputs:{x:C},backend:e,attrs:{shape:E}})}else S=Nt({inputs:{x:C},backend:e,attrs:{shape:m}});return e.disposeIntermediateTensorInfo(v),e.disposeIntermediateTensorInfo(C),d!=null&&e.disposeIntermediateTensorInfo(p),S}const Vdt={kernelName:H0,backendName:"webgl",kernelFunc:Pdt};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const zdt=KT+`
  return min(a, b);
`,Bdt=`
  vec4 result = vec4(min(a, b));
  bvec4 isNaNA = isnan(a);
  bvec4 isNaNB = isnan(b);
  bvec4 isNaN = bvec4(isNaNA.x || isNaNB.x, isNaNA.y || isNaNB.y, isNaNA.z || isNaNB.z, isNaNA.w || isNaNB.w);
  `+ku+`
  return result;
`,Udt=ds({opSnippet:zdt,packedOpSnippet:Bdt,cpuKernelImpl:_ot}),Gdt={kernelName:ip,backendName:"webgl",kernelFunc:Udt};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Wdt{constructor(t,e,s){this.variableNames=["x"],this.outputShape=e.map((d,p)=>d[0]+t[p]+d[1]);const r=t.length,i=He(r),o=e.map(d=>d[0]).join(","),l=e.map((d,p)=>d[0]+t[p]).join(","),u=["coords[0]","coords[1]","coords[2]","coords[3]"].slice(0,r),h=s==="reflect"?0:1;if(r===1){this.userCode=`
        int start = ${o};
        int end = ${l};

        void main() {
          int outC = getOutputCoords();
          if (outC < start) {
            outC = start * 2 - outC - ${h};
          } else if(outC >= end) {
            outC = (end - 1) * 2 - outC + ${h};
          }
          setOutput(getX(outC - start));
        }
      `;return}this.userCode=`
      ${i} start = ${i}(${o});
      ${i} end = ${i}(${l});

      void main() {
        ${i} outC = getOutputCoords();
        for (int i = 0; i < ${r}; i++) {
          if (outC[i] < start[i]) {
            outC[i] = start[i] * 2 - outC[i] - ${h};
          } else if(outC[i] >= end[i]) {
            outC[i] = (end[i] - 1) * 2 - outC[i] + ${h};
          }
        }
        ${i} coords = outC - start;
        setOutput(getX(${u}));
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Hdt{constructor(t,e,s){this.variableNames=["x"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=e.map((x,v)=>x[0]+t[v]+x[1]);const r=t.length,i=He(r),o=e.map(x=>x[0]).join(","),l=e.map((x,v)=>x[0]+t[v]).join(","),u=Ls("rc",r),h=Ls("source",r),d=`${u[r-1]} < ${this.outputShape[r-1]}`,p=r===1?"source":`vec2(${h.slice(-2).join()})`,m=s==="reflect"?0:1;let y="";if(r===1){const x=`
        ${i} source = rc;
        if (source < start) {
          source = start * 2 - source - ${m};
        } else if (source >= end) {
          source = (end - 1) * 2 - source + ${m};
        }
        source -= start;
      `;y=`
        ${i} rc = outputLoc;
        ${x}
        result[0] = getChannel(getX(${h.join()}), ${p});
        ${u[r-1]} += 1;
        if(${d}) {
          ${x}
          result[1] = getChannel(getX(${h.join()}), ${p});
        }
      `}else{const x=`
        ${i} source = rc;
        ${i} lt = ${i}(lessThan(source, start));
        ${i} gte = ${i}(greaterThanEqual(source, end));
        ${i} orig = 1 - (lt + gte);
        source = orig * source +
                lt * (start * 2 - source - ${m}) +
                gte * ((end - 1) * 2 - source + ${m});
        source -= start;
      `;y=`
        ${i} rc = outputLoc;
        ${x}
        result[0] = getChannel(getX(${h.join()}), ${p});
        ${u[r-1]} += 1;
        if(${d}) {
          ${x}
          result[1] = getChannel(getX(${h.join()}), ${p});
        }
        rc = outputLoc;
        ${u[r-2]} += 1;
        if(${u[r-2]} < ${this.outputShape[r-2]}) {
          ${x}
          result[2] = getChannel(getX(${h.join()}), ${p});
          ${u[r-1]} += 1;
          if(${d}) {
            ${x}
            result[3] = getChannel(getX(${h.join()}), ${p});
          }
        }
      `}this.userCode=`
      const ${i} start = ${i}(${o});
      const ${i} end = ${i}(${l});

      void main() {
        ${i} outputLoc = getOutputCoords();
        vec4 result = vec4(0.);
        ${y}
        setOutput(result);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const qdt=({inputs:n,backend:t,attrs:e})=>{const{x:s}=n,{paddings:r,mode:i}=e,o=dt().getBool("WEBGL_PACK_ARRAY_OPERATIONS")?new Hdt(s.shape,r,i):new Wdt(s.shape,r,i);return t.runWebGLProgram(o,[s],s.dtype)},jdt={kernelName:q0,backendName:"webgl",kernelFunc:qdt};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Kdt=`if (b == 0.0) return NAN;
  return mod(a, b);`,Xdt=`
  vec4 result = mod(a, b);
  bvec4 isNaN = equal(b, vec4(0.0));
  `+ku+`
  return result;
`,Ydt=ds({opSnippet:Kdt,packedOpSnippet:Xdt}),Qdt={kernelName:op,backendName:"webgl",kernelFunc:Ydt};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Zdt{constructor(t,e,s){this.variableNames=["probs"],this.customUniforms=[{name:"seed",type:"float"}],this.outputShape=[t,s],this.userCode=`
      void main() {
        ivec2 coords = getOutputCoords();
        int batch = coords[0];

        float r = random(seed);
        float cdf = 0.0;

        for (int i = 0; i < ${e-1}; i++) {
          cdf += getProbs(batch, i);

          if (r < cdf) {
            setOutput(float(i));
            return;
          }
        }

        // If no other event happened, last event happened.
        setOutput(float(${e-1}));
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Jdt=`
if (a == b) {
  return 1.0;
};
return a / b;`,tft=`
  // vec4 one = vec4(equal(a, b));
  // return one + (vec4(1.0) - one) * a / b;
  vec4 result = a / b;
  if(a.x == b.x) {
    result.x = 1.;
  }
  if(a.y == b.y) {
    result.y = 1.;
  }
  if(a.z == b.z) {
    result.z = 1.;
  }
  if(a.w == b.w) {
    result.w = 1.;
  }

  return result;
`,sP=ds({opSnippet:Jdt,packedOpSnippet:tft,checkOutOfBounds:!0}),eft={kernelName:Wf,backendName:"webgl",kernelFunc:sP};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const yN="return a - b;",rP=ds({opSnippet:yN,packedOpSnippet:yN,supportsComplex:!0,cpuKernelImpl:Kot}),nft={kernelName:Cp,backendName:"webgl",kernelFunc:rP};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function iP(n){const{inputs:t,backend:e,attrs:s}=n,{logits:r}=t,{dim:i}=s,o=le([i],r.shape),l=nP({inputs:{x:r},backend:e,attrs:{reductionIndices:o,keepDims:!1}}),u=Nn(l.shape,o),h=Nt({inputs:{x:l},backend:e,attrs:{shape:u}}),d=rP({inputs:{a:r,b:h},backend:e}),p=JL({inputs:{x:d},backend:e}),m=zx({inputs:{x:p},backend:e,attrs:{axis:o,keepDims:!1}}),y=Nt({inputs:{x:m},backend:e,attrs:{shape:u}}),x=sP({inputs:{a:p,b:y},backend:e});return e.disposeIntermediateTensorInfo(l),e.disposeIntermediateTensorInfo(h),e.disposeIntermediateTensorInfo(d),e.disposeIntermediateTensorInfo(p),e.disposeIntermediateTensorInfo(m),e.disposeIntermediateTensorInfo(y),x}const sft={kernelName:cx,backendName:"webgl",kernelFunc:iP};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function rft(n){const{inputs:t,backend:e,attrs:s}=n,{logits:r}=t,{numSamples:i,seed:o,normalized:l}=s,u=l?r:iP({inputs:{logits:r},backend:e,attrs:{dim:r.shape.length-1}}),h=u.shape[0],d=u.shape[1],p=new Zdt(h,d,i),m=[[o]],y=e.runWebGLProgram(p,[u],"int32",m);return l||e.disposeIntermediateTensorInfo(u),y}const ift={kernelName:B$,backendName:"webgl",kernelFunc:rft};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const oft=Yr+`
  return -x;
`,aft=`
  vec4 result = -x;
  bvec4 isNaN = isnan(x);

  result.r = isNaN.r ? x.r : result.r;
  result.g = isNaN.g ? x.g : result.g;
  result.b = isNaN.b ? x.b : result.b;
  result.a = isNaN.a ? x.a : result.a;

  return result;
`;function lft(n){const{inputs:t,backend:e}=n,{x:s}=t;if(e.shouldExecuteOnCPU([s])){const i=e.texData.get(s.dataId),[o,l]=Aot(i.values,s.shape,s.dtype);return e.makeTensorInfo(l,s.dtype,o)}let r;return dt().getBool("WEBGL_PACK_UNARY_OPERATIONS")?r=new ka(s.shape,aft):r=new Pi(s.shape,oft),e.runWebGLProgram(r,[s],s.dtype)}const uft={kernelName:j0,backendName:"webgl",kernelFunc:lft};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const cft=MS;function hft(n){vr("tf.nonMaxSuppression() in webgl locks the UI thread. Call tf.nonMaxSuppressionAsync() instead");const{inputs:t,backend:e,attrs:s}=n,{boxes:r,scores:i}=t,{maxOutputSize:o,iouThreshold:l,scoreThreshold:u}=s,h=e.readSync(r.dataId),d=e.readSync(i.dataId),{selectedIndices:p}=cft(h,d,o,l,u);return e.makeTensorInfo([p.length],"int32",new Int32Array(p))}const dft={kernelName:jC,backendName:"webgl",kernelFunc:hft};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const fft=FS;function pft(n){vr("tf.nonMaxSuppression() in webgl locks the UI thread. Call tf.nonMaxSuppressionAsync() instead");const{inputs:t,backend:e,attrs:s}=n,{boxes:r,scores:i}=t,{maxOutputSize:o,iouThreshold:l,scoreThreshold:u,padToMaxOutputSize:h}=s,d=e.readSync(r.dataId),p=e.readSync(i.dataId),{selectedIndices:m,validOutputs:y}=fft(d,p,o,l,u,h);return[e.makeTensorInfo([m.length],"int32",new Int32Array(m)),e.makeTensorInfo([],"int32",new Int32Array([y]))]}const mft={kernelName:KC,backendName:"webgl",kernelFunc:pft};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const gft=LS;function yft(n){vr("tf.nonMaxSuppression() in webgl locks the UI thread. Call tf.nonMaxSuppressionAsync() instead");const{inputs:t,backend:e,attrs:s}=n,{boxes:r,scores:i}=t,{maxOutputSize:o,iouThreshold:l,scoreThreshold:u,softNmsSigma:h}=s,d=e.readSync(r.dataId),p=e.readSync(i.dataId),m=o,y=l,x=u,v=h,{selectedIndices:C,selectedScores:S}=gft(d,p,m,y,x,v);return[e.makeTensorInfo([C.length],"int32",new Int32Array(C)),e.makeTensorInfo([S.length],"float32",new Float32Array(S))]}const xft={kernelName:XC,backendName:"webgl",kernelFunc:yft};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class bft{constructor(t,e,s,r){this.variableNames=["indices"],this.outputShape=[t,e],this.userCode=`
      void main() {
        ivec2 coords = getOutputCoords();
        int index = round(getIndices(coords.x));
        setOutput(mix(float(${r}), float(${s}),
                      float(index == coords.y)));
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const vft=n=>{const{inputs:t,backend:e,attrs:s}=n,{indices:r}=t,{dtype:i,depth:o,onValue:l,offValue:u}=s,h=yt(r.shape),d=new bft(h,o,l,u),p=Nt({inputs:{x:r},backend:e,attrs:{shape:[h]}}),m=e.runWebGLProgram(d,[p],i);e.disposeIntermediateTensorInfo(p);const y=[...r.shape,o],x=Nt({inputs:{x:m},backend:e,attrs:{shape:y}});return e.disposeIntermediateTensorInfo(m),x},wft={kernelName:Y0,backendName:"webgl",kernelFunc:vft};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Xy(n){const{inputs:t,backend:e}=n,{x:s}=t;if(s.dtype==="complex64"){const r=Xp({inputs:{input:s},backend:e}),i=Xy({inputs:{x:r},backend:e}),o=Bx({inputs:{input:s},backend:e}),l=Xy({inputs:{x:o},backend:e}),u=ol({inputs:{real:i,imag:l},backend:e});return e.disposeIntermediateTensorInfo(r),e.disposeIntermediateTensorInfo(i),e.disposeIntermediateTensorInfo(o),e.disposeIntermediateTensorInfo(l),u}else return Yp({attrs:{shape:s.shape,dtype:s.dtype,value:s.dtype==="string"?"":0},backend:e})}const Cft={kernelName:fx,backendName:"webgl",kernelFunc:Xy};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function oP(n){const{inputs:t,backend:e}=n,{x:s}=t;if(s.dtype==="string")throw new Error("onesLike is not supported under string dtype");if(s.dtype==="complex64"){const r=Xp({inputs:{input:s},backend:e}),i=oP({inputs:{x:r},backend:e}),o=Bx({inputs:{input:s},backend:e}),l=Xy({inputs:{x:o},backend:e}),u=ol({inputs:{real:i,imag:l},backend:e});return e.disposeIntermediateTensorInfo(r),e.disposeIntermediateTensorInfo(i),e.disposeIntermediateTensorInfo(o),e.disposeIntermediateTensorInfo(l),u}else return Yp({attrs:{shape:s.shape,dtype:s.dtype,value:1},backend:e})}const Sft={kernelName:X0,backendName:"webgl",kernelFunc:oP};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Tft(n){const{inputs:t,backend:e,attrs:s}=n,{axis:r}=s;if(t.length===1)return Aw({inputs:{input:t[0]},backend:e,attrs:{dim:r}});const i=t[0].shape,o=t[0].dtype;t.forEach(d=>{mC(i,d.shape,"All tensors passed to stack must have matching shapes"),U(o===d.dtype,()=>"All tensors passed to stack must have matching dtypes")});const l=[],u=t.map(d=>{const p=Aw({inputs:{input:d},backend:e,attrs:{dim:r}});return l.push(p),p}),h=HL({inputs:u,backend:e,attrs:{axis:r}});return l.forEach(d=>e.disposeIntermediateTensorInfo(d)),h}const Eft={kernelName:Q0,backendName:"webgl",kernelFunc:Tft};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Ift{constructor(t,e,s){this.variableNames=["x"],this.customUniforms=[{name:"value",type:"float"}],this.outputShape=e.map((h,d)=>h[0]+t[d]+h[1]);const r=t.length,i=He(r),o=e.map(h=>h[0]).join(","),l=e.map((h,d)=>h[0]+t[d]).join(","),u=["coords[0]","coords[1]","coords[2]","coords[3]"].slice(0,r);if(r===1){this.userCode=`
        int start = ${o};
        int end = ${l};

        void main() {
          int outC = getOutputCoords();
          if (outC < start || outC >= end) {
            setOutput(value);
          } else {
            setOutput(getX(outC - start));
          }
        }
      `;return}this.userCode=`
      ${i} start = ${i}(${o});
      ${i} end = ${i}(${l});

      void main() {
        ${i} outC = getOutputCoords();
        if (any(lessThan(outC, start)) || any(greaterThanEqual(outC, end))) {
          setOutput(value);
        } else {
          ${i} coords = outC - start;
          setOutput(getX(${u}));
        }
      }
    `}}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class _ft{constructor(t,e,s){this.variableNames=["x"],this.packedInputs=!0,this.packedOutput=!0,this.customUniforms=[{name:"value",type:"float"}],this.outputShape=e.map((v,C)=>v[0]+t[C]+v[1]);const r=t.length,i=He(r),o=e.map(v=>v[0]).join(","),l=e.map((v,C)=>v[0]+t[C]).join(","),u=Ls("rc",r),h=Ls("source",r),d=`${u[r-1]} < ${this.outputShape[r-1]}`,p=r===1?"source":`vec2(${h.slice(-2).join()})`,m=[`${i} rc = outputLoc;`,`${u[r-1]} += 1;
       if(${d}) {
      `,r===1?"":`}
       rc = outputLoc;
       ${u[r-2]} += 1;
       if(${u[r-2]} < ${this.outputShape[r-2]}) {`,r===1?"":`  ${u[r-1]} += 1;
         if(${d}) {`],y=r===1?"rc < start || rc >= end":"any(lessThan(rc, start)) || any(greaterThanEqual(rc, end))";let x="";for(let v=0,C=r===1?2:4;v<C;v++)x+=`
        ${m[v]}
        if (${y}) {
          result[${v}] = float(value);
        } else {
          ${i} source = rc - start;
          result[${v}] = getChannel(getX(${h.join()}), ${p});
        }
      `;x+=r===1?"} ":"}}",this.userCode=`
      const ${i} start = ${i}(${o});
      const ${i} end = ${i}(${l});

      void main() {
        ${i} outputLoc = getOutputCoords();
        vec4 result = vec4(0.);
        ${x}
        setOutput(result);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const aP=n=>{const{inputs:t,backend:e,attrs:s}=n,{x:r}=t,{paddings:i,constantValue:o}=s;if(yt(r.shape)===0){const h=i.map((d,p)=>d[0]+r.shape[p]+d[1]);return Yp({backend:e,attrs:{shape:h,value:o,dtype:r.dtype}})}const l=dt().getBool("WEBGL_PACK_ARRAY_OPERATIONS")?new _ft(r.shape,i,o):new Ift(r.shape,i,o),u=[[o]];return e.runWebGLProgram(l,[r],r.dtype,u)},kft={kernelName:Z0,backendName:"webgl",kernelFunc:aP};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Aft=`
  if(a < 0.0 && floor(b) < b){
    return NAN;
  }
  if (b == 0.0) {
    return 1.0;
  }
  return (round(mod(b, 2.0)) != 1) ?
      pow(abs(a), b) : sign(a) * pow(abs(a), b);
`,Nft=`
  // isModRound1 has 1 for components with round(mod(b, 2.0)) == 1, 0 otherwise.
  vec4 isModRound1 = vec4(equal(round(mod(b, 2.0)), ivec4(1)));
  vec4 multiplier = sign(a) * isModRound1 + (vec4(1.0) - isModRound1);
  vec4 result = multiplier * pow(abs(a), b);

  // Ensure that a^0 = 1, including 0^0 = 1 as this correspond to TF and JS
  bvec4 isExpZero = equal(b, vec4(0.0));
  result.r = isExpZero.r ? 1.0 : result.r;
  result.g = isExpZero.g ? 1.0 : result.g;
  result.b = isExpZero.b ? 1.0 : result.b;
  result.a = isExpZero.a ? 1.0 : result.a;

  bvec4 isNaN1 = lessThan(a, vec4(0.0));
  bvec4 isNaN2 = lessThan(floor(b), b);
  bvec4 isNaN = bvec4(isNaN1.x && isNaN2.x, isNaN1.y && isNaN2.y, isNaN1.z && isNaN2.z, isNaN1.w && isNaN2.w);
  `+ku+`
  return result;
`,Rft=ds({opSnippet:Aft,packedOpSnippet:Nft}),$ft={kernelName:lp,backendName:"webgl",kernelFunc:Rft};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Dft(n){const{inputs:t,backend:e,attrs:s}=n,{x:r}=t,{axis:i,keepDims:o}=s,l=r.shape.length,u=[],h=le(i,r.shape);let d=h;const p=hn(d,l);let m=r;p!=null&&(m=Vs({inputs:{x:r},backend:e,attrs:{perm:p}}),d=Cn(d.length,l),u.push(m)),hs("prod",d,l);let y;if(e.shouldExecuteOnCPU([m])){const x=e.texData.get(m.dataId).values,{outVals:v,outShape:C,outDtype:S}=Rot(m.shape,m.dtype,x,d);y=e.makeTensorInfo(C,S,v)}else{const[x,v]=es(m.shape,d),C=yt(v),S=Nt({inputs:{x:m},backend:e,attrs:{shape:[-1,C]}}),E=aS(r.dtype),_=Au(S,E,"prod",e);y=Nt({inputs:{x:_},backend:e,attrs:{shape:x}}),u.push(S),u.push(_)}if(o){u.push(y);const x=Nn(y.shape,h);y=Nt({inputs:{x:y},backend:e,attrs:{shape:x}})}return u.forEach(x=>e.disposeIntermediateTensorInfo(x)),y}const Oft={kernelName:tx,backendName:"webgl",kernelFunc:Dft};/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Mft(n){const{inputs:t,backend:e,attrs:s}=n,{paramsNestedSplits:r,paramsDenseValues:i,indices:o}=t,{outputRaggedRank:l}=s,u=r.map(S=>e.readSync(S.dataId)),h=r.map(S=>S.shape),d=e.readSync(i.dataId),p=e.readSync(o.dataId),[m,y,x]=$ot(u,h,d,i.shape,i.dtype,p,o.shape,l),v=m.map(S=>e.makeTensorInfo([S.length],"int32",S)),C=e.makeTensorInfo(x,i.dtype,y);return v.concat([C])}const Fft={kernelName:U$,backendName:"webgl",kernelFunc:Mft};/**
 * @license
 * Copyright 2022 Google LLC.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Lft(n){const{inputs:t,backend:e}=n,{starts:s,limits:r,deltas:i}=t,o=e.readSync(s.dataId),l=e.readSync(r.dataId),u=e.readSync(i.dataId),[h,d]=Dot(o,s.shape,s.dtype,l,r.shape,u,i.shape),p=e.makeTensorInfo([h.length],"int32",h),m=e.makeTensorInfo([d.length],s.dtype,d);return[p,m]}const Pft={kernelName:G$,backendName:"webgl",kernelFunc:Lft};/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Vft(n){const{inputs:t,backend:e,attrs:s}=n,{shape:r,values:i,defaultValue:o,rowPartitionTensors:l}=t,{rowPartitionTypes:u}=s,h=e.readSync(r.dataId),d=e.readSync(i.dataId),p=e.readSync(o.dataId),m=l.map(C=>e.readSync(C.dataId)),y=l.map(C=>C.shape),[x,v]=Oot(h,r.shape,d,i.shape,i.dtype,p,o.shape,m,y,u);return e.makeTensorInfo(x,i.dtype,v)}const zft={kernelName:W$,backendName:"webgl",kernelFunc:Vft};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const lP=n=>{const{backend:t,attrs:e}=n,{start:s,stop:r,step:i,dtype:o}=e,l=Mot(s,r,i,o);return t.makeTensorInfo([l.length],o,l)},Bft={kernelName:YC,backendName:"webgl",kernelFunc:lP};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Uft="return 1.0 / x;",Gft=Ce({opSnippet:Uft}),Wft={kernelName:up,backendName:"webgl",kernelFunc:Gft};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Hft=Yr+`
  return (x < 0.0) ? 0.0 : x;
`,qft=`
  vec4 result = x * vec4(greaterThanEqual(x, vec4(0.0)));
  bvec4 isNaN = isnan(x);

  result.r = isNaN.r ? x.r : result.r;
  result.g = isNaN.g ? x.g : result.g;
  result.b = isNaN.b ? x.b : result.b;
  result.a = isNaN.a ? x.a : result.a;

  return result;
`,jft=Ce({opSnippet:Hft,packedOpSnippet:qft}),Kft={kernelName:cp,backendName:"webgl",kernelFunc:jft};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Xft=Yr+`
  return (x < 0.0) ? 0.0 : min(6.0, x);
`,Yft=`
  vec4 result = min(x, vec4(6.)) * vec4(greaterThanEqual(x, vec4(0.0)));
  bvec4 isNaN = isnan(x);

  result.r = isNaN.r ? x.r : result.r;
  result.g = isNaN.g ? x.g : result.g;
  result.b = isNaN.b ? x.b : result.b;
  result.a = isNaN.a ? x.a : result.a;

  return result;
`,Qft=Ce({opSnippet:Xft,packedOpSnippet:Yft}),Zft={kernelName:hp,backendName:"webgl",kernelFunc:Qft};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Jft{constructor(t,e,s,r,i){this.variableNames=["A"],this.outputShape=[];const[o,l,u,h]=t;this.outputShape=[o,e,s,h];const d=[r&&e>1?l-1:l,r&&s>1?u-1:u],p=[r&&e>1?e-1:e,r&&s>1?s-1:s];let m;i?m="(vec2(yRC) + vec2(0.5)) * effectiveInputOverOutputRatioRC - vec2(0.5)":m="vec2(yRC) * effectiveInputOverOutputRatioRC",this.userCode=`
      const vec2 effectiveInputOverOutputRatioRC = vec2(
          ${d[0]/p[0]},
          ${d[1]/p[1]});
      const vec2 inputShapeRC = vec2(${l}.0, ${u}.0);

      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];
        ivec2 yRC = coords.yz;

        // Fractional source index.
        vec2 sourceFracIndexRC = ${m};

        // Compute the four integer indices.
        ivec2 sourceFloorRC = ivec2(max(sourceFracIndexRC, vec2(0.0)));
        ivec2 sourceCeilRC = ivec2(
          min(inputShapeRC - 1.0, ceil(sourceFracIndexRC)));

        float topLeft = getA(b, sourceFloorRC.x, sourceFloorRC.y, d);
        float bottomLeft = getA(b, sourceCeilRC.x, sourceFloorRC.y, d);
        float topRight = getA(b, sourceFloorRC.x, sourceCeilRC.y, d);
        float bottomRight = getA(b, sourceCeilRC.x, sourceCeilRC.y, d);

        vec2 fracRC = sourceFracIndexRC - vec2(sourceFloorRC);

        float top = topLeft + (topRight - topLeft) * fracRC.y;
        float bottom = bottomLeft + (bottomRight - bottomLeft) * fracRC.y;
        float newValue = top + (bottom - top) * fracRC.x;

        setOutput(newValue);
      }
    `}}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class tpt{constructor(t,e,s,r,i){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=[];const[o,l,u,h]=t;this.outputShape=[o,e,s,h];const d=[r&&e>1?l-1:l,r&&s>1?u-1:u],p=[r&&e>1?e-1:e,r&&s>1?s-1:s];let m;i?m="(vec3(yRC) + vec3(0.5)) * effectiveInputOverOutputRatioRC - vec3(0.5)":m="vec3(yRC) * effectiveInputOverOutputRatioRC",this.userCode=`
      const vec3 effectiveInputOverOutputRatioRC = vec3(
          ${d[0]/p[0]},
          ${d[1]/p[1]},
          ${d[1]/p[1]});
      const vec3 inputShapeRC = vec3(${l}.0, ${u}.0,
                                     ${u}.0);

      float getAValue(int b, int r, int c, int d) {
        return getChannel(getA(b, r, c, d), vec2(c, d));
      }

      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];
        // Calculate values for next column in yRC.z.
        ivec3 yRC = coords.yzz + ivec3(0, 0, 1);

        // Fractional source index.
        vec3 sourceFracIndexRC = ${m};

        // Compute the four integer indices.
        ivec3 sourceFloorRC = ivec3(max(sourceFracIndexRC, vec3(0.0)));
        ivec3 sourceCeilRC = ivec3(
          min(inputShapeRC - 1.0, ceil(sourceFracIndexRC)));

        // Should we calculate next column and row elements in 2x2 packed cell.
        bool hasNextCol = d < ${h-1};
        bool hasNextRow = coords.z < ${s-1};

        // In parallel, construct four corners for all four components in
        // packed 2x2 cell.
        vec4 topLeft = vec4(
          getAValue(b, sourceFloorRC.x, sourceFloorRC.y, d),
          hasNextCol ? getAValue(b, sourceFloorRC.x, sourceFloorRC.y, d + 1)
                     : 0.0,
          hasNextRow ? getAValue(b, sourceFloorRC.x, sourceFloorRC.z, d)
                     : 0.0,
          (hasNextRow && hasNextCol) ?
            getAValue(b, sourceFloorRC.x, sourceFloorRC.z, d + 1) : 0.0);

        vec4 bottomLeft = vec4(
          getAValue(b, sourceCeilRC.x, sourceFloorRC.y, d),
          hasNextCol ? getAValue(b, sourceCeilRC.x, sourceFloorRC.y, d + 1)
                     : 0.0,
          hasNextRow ? getAValue(b, sourceCeilRC.x, sourceFloorRC.z, d)
                     : 0.0,
          (hasNextRow && hasNextCol) ?
            getAValue(b, sourceCeilRC.x, sourceFloorRC.z, d + 1) : 0.0);

        vec4 topRight = vec4(
          getAValue(b, sourceFloorRC.x, sourceCeilRC.y, d),
          hasNextCol ? getAValue(b, sourceFloorRC.x, sourceCeilRC.y, d + 1)
                     : 0.0,
          hasNextRow ? getAValue(b, sourceFloorRC.x, sourceCeilRC.z, d)
                     : 0.0,
          (hasNextRow && hasNextCol) ?
            getAValue(b, sourceFloorRC.x, sourceCeilRC.z, d + 1) : 0.0);

        vec4 bottomRight = vec4(
          getAValue(b, sourceCeilRC.x, sourceCeilRC.y, d),
          hasNextCol ? getAValue(b, sourceCeilRC.x, sourceCeilRC.y, d + 1)
                     : 0.0,
          hasNextRow ? getAValue(b, sourceCeilRC.x, sourceCeilRC.z, d)
                     : 0.0,
          (hasNextRow && hasNextCol) ?
            getAValue(b, sourceCeilRC.x, sourceCeilRC.z, d + 1) : 0.0);

        vec3 fracRC = sourceFracIndexRC - vec3(sourceFloorRC);

        vec4 top = mix(topLeft, topRight, fracRC.yyzz);
        vec4 bottom = mix(bottomLeft, bottomRight, fracRC.yyzz);
        vec4 newValue = mix(top, bottom, fracRC.x);

        setOutput(newValue);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function ept(n){const{inputs:t,backend:e,attrs:s}=n,{images:r}=t,{alignCorners:i,halfPixelCenters:o,size:l}=s,[u,h]=l,d=dt().getBool("WEBGL_PACK_IMAGE_OPERATIONS")?new tpt(r.shape,u,h,i,o):new Jft(r.shape,u,h,i,o);return e.runWebGLProgram(d,[r],"float32")}const npt={kernelName:sx,backendName:"webgl",kernelFunc:ept};/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class spt{constructor(t,e,s){this.variableNames=["dy"],this.outputShape=[],this.outputShape=e;const[,r,i]=e,[,o,l]=t,u=[s&&o>1?r-1:r,s&&l>1?i-1:i],h=[s&&o>1?o-1:o,s&&l>1?l-1:l],d=u[0]/h[0],p=u[1]/h[1],m=1/d,y=1/p,x=Math.ceil(m)*2+2,v=Math.ceil(y)*2+2;this.userCode=`
      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];
        int r = coords[1];
        int c = coords[2];

        float accumulator = 0.0;

        const float heightScale = float(${d});
        const float widthScale = float(${p});

        const float invHeightScale = float(${m});
        const float invWidthScale = float(${y});

        const int winHeight = int(${x});
        const int winWidth = int(${v});

        // Compute bounds for where in dy we will look
        float startRLerp = floor(float(r) * invHeightScale);
        int startDyR = int(startRLerp - float(winHeight / 2));

        float startCLerp = floor(float(c) * invWidthScale);
        int startDyC = int(startCLerp - float(winWidth / 2));

        // Loop over dy
        for (int dyROffset = 0; dyROffset < winHeight; dyROffset++) {
          int dyR = dyROffset + startDyR;

          // Guard against the window exceeding the bounds of dy
          if (dyR < 0 || dyR >= ${o}) {
            continue;
          }

          for (int dyCOffset = 0; dyCOffset < winWidth; dyCOffset++) {
            int dyC = dyCOffset + startDyC;

            // Guard against the window exceeding the bounds of dy
            if (dyC < 0 || dyC >= ${l}) {
              continue;
            }

            float dxR = float(dyR) * heightScale;
            int topDxRIndex = int(floor(dxR));
            int bottomDxRIndex = int(min(ceil(dxR), ${r-1}.0));
            float dxRLerp = dxR - float(topDxRIndex);
            float inverseDxRLerp = 1.0 - dxRLerp;

            float dxC = float(dyC) * widthScale;
            int leftDxCIndex = int(floor(dxC));
            int rightDxCIndex = int(min(ceil(dxC), ${i-1}.0));
            float dxCLerp = dxC - float(leftDxCIndex);
            float inverseDxCLerp = 1.0 - dxCLerp;

            if (r == topDxRIndex && c == leftDxCIndex) {
              // topLeft
              accumulator +=
                getDy(b, dyR, dyC, d) * inverseDxRLerp * inverseDxCLerp;
            }

            if (r == topDxRIndex && c == rightDxCIndex) {
              // topRight
              accumulator += getDy(b, dyR, dyC, d) * inverseDxRLerp * dxCLerp;
            }

            if (r == bottomDxRIndex && c == leftDxCIndex) {
              // bottomLeft
              accumulator += getDy(b, dyR, dyC, d) * dxRLerp * inverseDxCLerp;
            }

            if (r == bottomDxRIndex && c == rightDxCIndex) {
              // bottomRight
              accumulator += getDy(b, dyR, dyC, d) * dxRLerp * dxCLerp;
            }
          }
        }
        // End loop over dy

        setOutput(accumulator);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function rpt(n){const{inputs:t,backend:e,attrs:s}=n,{images:r,dy:i}=t,{alignCorners:o}=s,l=new spt(i.shape,r.shape,o);return e.runWebGLProgram(l,[i],i.dtype)}const ipt={kernelName:JC,backendName:"webgl",kernelFunc:rpt};/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class opt{constructor(t,e,s,r,i){this.variableNames=["A"],this.outputShape=[];const[o,l,u,h]=t;this.outputShape=[o,e,s,h];const d=[r&&e>1?l-1:l,r&&s>1?u-1:u],p=[r&&e>1?e-1:e,r&&s>1?s-1:s],m=r?"0.5":"0.0";let y;i?y="max((vec2(yRC) + vec2(0.5)) * effectiveInputOverOutputRatioRC, vec2(0.0))":y="vec2(yRC) * effectiveInputOverOutputRatioRC",this.userCode=`
      const vec2 effectiveInputOverOutputRatioRC = vec2(
          ${d[0]/p[0]},
          ${d[1]/p[1]});
      const vec2 inputShapeRC = vec2(${l}.0, ${u}.0);

      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];
        ivec2 yRC = coords.yz;

        // Fractional source index.
        vec2 sourceFracIndexRC = ${y};

        // Compute the coordinators of nearest neighbor point.
        ivec2 sourceNearestRC = ivec2(
          min(inputShapeRC - 1.0, floor(sourceFracIndexRC + ${m})));
        float newValue = getA(b, sourceNearestRC.x, sourceNearestRC.y, d);

        setOutput(newValue);
      }
    `}}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class apt{constructor(t,e,s,r,i){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=[];const[o,l,u,h]=t;this.outputShape=[o,e,s,h];const d=[r&&e>1?l-1:l,r&&s>1?u-1:u],p=[r&&e>1?e-1:e,r&&s>1?s-1:s],m=r?"0.5":"0.0";let y;i?y="max((vec3(yRC) + vec3(0.5)) * effectiveInputOverOutputRatioRC, vec3(0.0))":y="vec3(yRC) * effectiveInputOverOutputRatioRC",this.userCode=`
      const vec3 effectiveInputOverOutputRatioRC = vec3(
          ${d[0]/p[0]},
          ${d[1]/p[1]},
          ${d[1]/p[1]});
      const vec3 inputShapeRC = vec3(${l}.0, ${u}.0,
                                     ${u}.0);

      float getAValue(int b, int r, int c, int d) {
        return getChannel(getA(b, r, c, d), vec2(c, d));
      }

      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];
        // Calculate values for next column in yRC.z.
        ivec3 yRC = coords.yzz + ivec3(0, 0, 1);

        // Fractional source index.
        vec3 sourceFracIndexRC = ${y};

        // Compute the coordinators of nearest neighbor point.
        ivec3 sourceNearestRC = ivec3(
          min(inputShapeRC - 1.0, floor(sourceFracIndexRC + ${m})));

        // Should we calculate next column and row elements in 2x2 packed cell.
        bool hasNextCol = d < ${h-1};
        bool hasNextRow = coords.z < ${s-1};

        vec4 newValue = vec4(
          getAValue(b, sourceNearestRC.x, sourceNearestRC.y, d),
          hasNextCol ? getAValue(b, sourceNearestRC.x, sourceNearestRC.y, d + 1)
                     : 0.0,
          hasNextRow ? getAValue(b, sourceNearestRC.x, sourceNearestRC.z, d)
                     : 0.0,
          (hasNextRow && hasNextCol) ?
            getAValue(b, sourceNearestRC.x, sourceNearestRC.z, d + 1) : 0.0);

        setOutput(newValue);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function lpt(n){const{inputs:t,backend:e,attrs:s}=n,{images:r}=t,{alignCorners:i,halfPixelCenters:o,size:l}=s,[u,h]=l,d=dt().getBool("WEBGL_PACK_IMAGE_OPERATIONS")?new apt(r.shape,u,h,i,o):new opt(r.shape,u,h,i,o);return e.runWebGLProgram(d,[r],r.dtype)}const upt={kernelName:nx,backendName:"webgl",kernelFunc:lpt};/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class cpt{constructor(t,e,s){this.variableNames=["dy"],this.outputShape=[],this.outputShape=e;const[,r,i]=e,[,o,l]=t,u=[s&&o>1?r-1:r,s&&l>1?i-1:i],h=[s&&o>1?o-1:o,s&&l>1?l-1:l],d=u[0]/h[0],p=u[1]/h[1],m=1/d,y=1/p,x=Math.ceil(m)*2+2,v=Math.ceil(y)*2+2;this.userCode=`
      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];
        int r = coords[1];
        int c = coords[2];

        float accumulator = 0.0;

        const float heightScale = float(${d});
        const float widthScale = float(${p});

        const float invHeightScale = float(${m});
        const float invWidthScale = float(${y});

        const int winHeight = int(${x});
        const int winWidth = int(${v});

        // Compute bounds for where in dy we will look
        float startRLerp = floor(float(r) * invHeightScale);
        int startDyR = int(floor(startRLerp - float(winHeight / 2)));

        float startCLerp = floor(float(c) * invWidthScale);
        int startDyC = int(floor(startCLerp - float(winWidth / 2)));

        // Loop over dy
        for (int dyROffset = 0; dyROffset < winHeight; dyROffset++) {
          int dyR = dyROffset + startDyR;

          // Guard against the window exceeding the bounds of dy
          if (dyR < 0 || dyR >= ${o}) {
            continue;
          }

          for (int dyCOffset = 0; dyCOffset < winWidth; dyCOffset++) {
            int dyC = dyCOffset + startDyC;

            // Guard against the window exceeding the bounds of dy
            if (dyC < 0 || dyC >= ${l}) {
              continue;
            }

            float sourceFracRow =
              float(${u[0]}) *
                (float(dyR) / float(${h[0]}));

            float sourceFracCol =
                float(${u[1]}) *
                  (float(dyC) / float(${h[1]}));

            int sourceNearestRow = int(min(
                float(int(${r}) - 1),
                ${s} ? float(round(sourceFracRow)) :
                                  float(floor(sourceFracRow))));

            int sourceNearestCol = int(min(
                float(int(${i}) - 1),
                ${s} ? float(round(sourceFracCol)) :
                                  float(floor(sourceFracCol))));

            if (r == sourceNearestRow && c == sourceNearestCol) {
              accumulator += getDy(b, dyR, dyC, d);
            }
          }
        }
        // End loop over dy

        setOutput(accumulator);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function hpt(n){const{inputs:t,backend:e,attrs:s}=n,{images:r,dy:i}=t,{alignCorners:o}=s,l=new cpt(i.shape,r.shape,o);return e.runWebGLProgram(l,[i],i.dtype)}const dpt={kernelName:ZC,backendName:"webgl",kernelFunc:hpt};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class fpt{constructor(t,e){this.variableNames=["x"];const s=t.length;if(s>4)throw new Error(`WebGL backend: Reverse of rank-${s} tensor is not yet supported`);if(this.outputShape=t,s===1){this.userCode=`
        void main() {
          int coord = getOutputCoords();
          setOutput(getX(${t[0]} - coord - 1));
        }
      `;return}const r=l=>e.indexOf(l)!==-1&&t[l]!==1?`${t[l]} - coords[${l}] - 1`:`coords[${l}]`,i=t.map((l,u)=>r(u)).join(","),o=He(s);this.userCode=`
      void main() {
        ${o} coords = getOutputCoords();
        setOutput(getX(${i}));
      }
    `}}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class ppt{constructor(t,e){this.variableNames=["x"],this.packedInputs=!0,this.packedOutput=!0;const s=t.length;if(s>4)throw new Error(`WebGL backend: Reverse of rank-${s} tensor is not yet supported`);this.outputShape=t;const r=Ls("rc",s),i=`${r[s-1]} + 1 < ${this.outputShape[s-1]}`,o=`${r[s-2]} + 1 < ${this.outputShape[s-2]}`,l=He(s);s===1?this.userCode=`
        void main(){
          int rc = getOutputCoords();
          vec4 result = vec4(0.);
          result.r = getChannel(getX(${t[0]} - rc - 1),
            ${t[0]} - rc - 1);
          if(${i}){
              result.g = getChannel(getX(${t[0]} - (rc  + 1) - 1),
                ${t[0]} - (rc  + 1) - 1);
          }
          setOutput(result);
        }
      `:this.userCode=`
        void main() {
          ${l} rc = getOutputCoords();
          vec4 result = vec4(0.);
          result.r = ${u(r.slice())};
          if(${i}){
            result.g = ${h(r.slice())};
          }
          if(${o}) {
            result.b = ${d(r.slice())};
            if(${i}) {
              result.a = ${p(r.slice())};
            }
          }
          setOutput(result);
        }
    `;function u(x){return m(x)}function h(x){return x[s-1]="("+x[s-1]+" + 1)",m(x)}function d(x){return x[s-2]="("+x[s-2]+" + 1)",m(x)}function p(x){return x[s-1]="("+x[s-1]+" + 1)",x[s-2]="("+x[s-2]+" + 1)",m(x)}function m(x){const v=t.map((E,_)=>y(_,x)),C=v.join(","),S=v.slice(-2).join(",");return`getChannel(getX(${C}), vec2(${S}))`}function y(x,v){return e.indexOf(x)!==-1&&t[x]!==1?`${t[x]} - ${v[x]} - 1`:`${v[x]}`}}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function mpt(n){const{inputs:t,backend:e,attrs:s}=n,{x:r}=t,{dims:i}=s,o=r.shape.length,l=le(i,r.shape);if(o===0)return cr({inputs:{x:r},backend:e});const u=dt().getBool("WEBGL_PACK_ARRAY_OPERATIONS")?new ppt(r.shape,l):new fpt(r.shape,l);return e.runWebGLProgram(u,[r],r.dtype)}const gpt={kernelName:rx,backendName:"webgl",kernelFunc:mpt};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class ypt{constructor(t,e){this.variableNames=["Image"],this.outputShape=[],this.customUniforms=[{name:"params",type:"vec4"}];const s=t[1],r=t[2];this.outputShape=t;let i="";typeof e=="number"?i=`float outputValue = ${e.toFixed(2)};`:i=`
        vec3 fill = vec3(${e.join(",")});
        float outputValue = fill[coords[3]];`,this.userCode=`
        void main() {
          ivec4 coords = getOutputCoords();
          int x = coords[2];
          int y = coords[1];
          float coordXFloat = (float(x) - params[0]) * params[3] -
            (float(y) - params[1]) * params[2];
          float coordYFloat = (float(x) - params[0]) * params[2] +
            (float(y) - params[1]) * params[3];
          int coordX = int(round(coordXFloat + params[0]));
          int coordY = int(round(coordYFloat + params[1]));
          ${i}
          if(coordX >= 0 && coordX < ${r} && coordY >= 0 && coordY < ${s}) {
            outputValue = getImage(coords[0], coordY, coordX, coords[3]);
          }
          setOutput(outputValue);
        }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const xpt={kernelName:oS,backendName:"webgl",kernelFunc:({inputs:n,attrs:t,backend:e})=>{const{image:s}=n,{radians:r,fillValue:i,center:o}=t,l=e,u=new ypt(s.shape,i),[h,d]=XS(o,s.shape[1],s.shape[2]),p=[[h,d,Math.sin(r),Math.cos(r)]];return l.runWebGLProgram(u,[s],s.dtype,p)}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const bpt=`
  // OpenGL ES does not support round function.
  // The algorithm is based on banker's rounding.
  float base = floor(x);
  if ((x - base) < 0.5) {
    return floor(x);
  } else if ((x - base) > 0.5) {
    return ceil(x);
  } else {
    if (mod(base, 2.0) == 0.0) {
      return base;
    } else {
      return base + 1.0;
    }
  }
`,vpt=Ce({opSnippet:bpt}),wpt={kernelName:dp,backendName:"webgl",kernelFunc:vpt};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Cpt="return inversesqrt(x);",Spt=Ce({opSnippet:Cpt,cpuKernelImpl:Fot}),Tpt={kernelName:fp,backendName:"webgl",kernelFunc:Spt};/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class QT{constructor(t,e,s,r,i,o,l=!0,u=!1){this.variableNames=["updates","indices","defaultValue"],this.outputShape=o;const h=He(i.length),d=He(o.length);let p="";s===1?p="i":s===2&&(p="i, j");const m=`getIndices(${p})`;let y="";r===1?y="i":r===2&&(y="i, coords[1]");const x=`getUpdates(${y})`;let v="";u&&(v="coords[0], coords[1]");const C=`getDefaultValue(${v})`,S=e>1?"strides[j]":"strides";this.userCode=`
        ${h} strides = ${h}(${i});

        void main() {
          ${d} coords = getOutputCoords();
          float sum = 0.0;
          bool found = false;
          for (int i = 0; i < ${t}; i++) {
            int flattenedIndex = 0;
            for (int j = 0; j < ${e}; j++) {
              int index = round(${m});
              flattenedIndex += index * ${S};
            }
            if (flattenedIndex == coords[0]) {
              sum += ${x};
              found = true;
            }
          }
          setOutput(mix(${C}, sum, float(found)));
        }
      `}}/**
 * @license
 * Copyright 2023 Google LLC.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Ept{constructor(t,e,s,r,i,o,l=!0,u=!1){this.variableNames=["updates","indices","defaultValue"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=o;const h=He(i.length),d=He(o.length);let p="";s===1?p="i":s===2&&(p="i, j");const m=`getIndices(${p})`;let y="";r===1?y="i":r===2&&(y="i, coords[1]");const x=`getUpdates(${y})`;let v="";u&&(v="coords[0], coords[1]");const C=`getDefaultValue(${v})`,S=e>1?"strides[j]":"strides",E=e>1?"strides[j + 1]":"strides";this.userCode=`
        ${h} strides = ${h}(${i});

        void main() {
          ${d} coords = getOutputCoords();
          vec4 sum = vec4(0.);
          vec4 found = vec4(0.);
          for (int i = 0; i < ${t}; i+=2) {
            ivec2 flattenedIndex = ivec2(0);
            for (int j = 0; j < ${e}; j+=2) {
              ivec4 index = round(${m});
              flattenedIndex += index.xz * ${S};
              if (j + 1 < ${e}) {
                flattenedIndex += index.yw * ${E};
              }
            }
            if (flattenedIndex[0] == coords[0] || flattenedIndex[1] == coords[0] ||
                flattenedIndex[0] == coords[0] + 1 || flattenedIndex[1] == coords[0] + 1) {
              vec4 updVals = ${x};
              if (flattenedIndex[0] == coords[0]) {
                sum.xy += updVals.xy;
                found.xy = vec2(1.);
              } else if (flattenedIndex[0] == coords[0] + 1) {
                sum.zw += updVals.xy;
                found.zw = vec2(1.);
              }
              if (flattenedIndex[1] == coords[0]) {
                sum.xy += updVals.zw;
                found.xy = vec2(1.);
              } else if (flattenedIndex[1] == coords[0] + 1) {
                sum.zw += updVals.zw;
                found.zw = vec2(1.);
              }
            }
          }
          setOutput(mix(${C}, sum, found));
        }
      `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Ipt(n){const{inputs:t,backend:e,attrs:s}=n,{indices:r,updates:i}=t,{shape:o}=s,{sliceRank:l,numUpdates:u,sliceSize:h,strides:d,outputSize:p}=Su(i,r,o),m=[p/h,h];if(p===0)return e.makeTensorInfo(o,r.dtype);const y=Nt({inputs:{x:r},backend:e,attrs:{shape:[u,l]}}),x=Nt({inputs:{x:i},backend:e,attrs:{shape:[u,h]}}),v=e.makeTensorInfo([],"float32",new Float32Array([0]));let C;dt().getBool("WEBGL_PACK")?C=new Ept(u,l,y.shape.length,x.shape.length,d,m):C=new QT(u,l,y.shape.length,x.shape.length,d,m);const S=e.runWebGLProgram(C,[x,y,v],x.dtype),E=Nt({inputs:{x:S},backend:e,attrs:{shape:o}});return e.disposeIntermediateTensorInfo(y),e.disposeIntermediateTensorInfo(x),e.disposeIntermediateTensorInfo(S),e.disposeIntermediateTensorInfo(v),E}const _pt={kernelName:H$,backendName:"webgl",kernelFunc:Ipt};/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class kpt{constructor(t,e,s,r){this.variableNames=["sortedSequence","values"],this.customUniforms=[{name:"numInputs",type:"int"}],this.outputShape=[t,s];const i="while (left < right) {",o=`for (int i = 0; i < ${Math.ceil(Math.log2(e+1))}; ++i) { if (left >= right) break;`,l=dt().getNumber("WEBGL_VERSION")===2?i:o,u=r==="left"?"<":"<=";this.userCode=`
       int findBound(int batch, float value) {
         int left = 0;
         int right = numInputs;
         int mid;
         ${l}
           mid = (left + right) / 2;
           if (getSortedSequence(batch, mid) ${u} value) {
             left = mid + 1;
           } else {
             right = mid;
           }
         }
         return right;
       }

       void main() {
         ivec2 coords = getOutputCoords();
         int batch = coords[0];
         int valueIndex = coords[1];

         float value = getValues(batch, valueIndex);

         setOutput(float(findBound(batch, value)));
       }
     `}}/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Apt(n){const{inputs:t,backend:e,attrs:s}=n,{sortedSequence:r,values:i}=t,{side:o}=s,l=new kpt(r.shape[0],r.shape[1],i.shape[1],o),u=[[r.shape[1]]];return e.runWebGLProgram(l,[r,i],"int32",u)}const Npt={kernelName:j$,backendName:"webgl",kernelFunc:Apt};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Rpt{constructor(t,e,s){this.variableNames=["c","a","b"],this.outputShape=e;let r,i;if(s>4)throw Error(`Where for rank ${s} is not yet supported`);if(s===1)i="resRC",r="resRC";else{const l=["resRC.x","resRC.y","resRC.z","resRC.w"],u=[],h=[];for(let d=0;d<e.length;d++)h.push(`${l[d]}`),d<t&&u.push(`${l[d]}`);r=u.join(),i=h.join()}const o=He(s);this.userCode=`
      void main() {
        ${o} resRC = getOutputCoords();
        float cVal = getC(${r});
        if (cVal >= 1.0) {
          setOutput(getA(${i}));
        } else {
          setOutput(getB(${i}));
        }
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function $pt(n){const{inputs:t,backend:e}=n,{condition:s,t:r,e:i}=t,o=new Rpt(s.shape.length,r.shape,r.shape.length);return e.runWebGLProgram(o,[s,r,i],lr(r.dtype,i.dtype))}const Dpt={kernelName:ix,backendName:"webgl",kernelFunc:$pt};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Opt=`
  // Stable and Attracting Fixed Point (0, 1) for Normalized Weights.
  // see: https://arxiv.org/abs/1706.02515
  float scaleAlpha = ${Sx};
  float scale = ${Tx};
  return (x >= 0.0) ? scale * x : scaleAlpha * (exp(x) - 1.0);
`,Mpt=Ce({opSnippet:Opt}),Fpt={kernelName:pp,backendName:"webgl",kernelFunc:Mpt};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Lpt=Ch+`
  return 1.0 / (1.0 + exp(-1.0 * x));
`,Ppt=`
  vec4 result = 1.0 / (1.0 + exp(-1.0 * x));
  bvec4 isNaN = isnan(x);

  result.r = isNaN.r ? x.r : result.r;
  result.g = isNaN.g ? x.g : result.g;
  result.b = isNaN.b ? x.b : result.b;
  result.a = isNaN.a ? x.a : result.a;

  return result;
`,Vpt=Ce({opSnippet:Lpt,packedOpSnippet:Ppt,cpuKernelImpl:Pot}),zpt={kernelName:xp,backendName:"webgl",kernelFunc:Vpt};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Bpt=`
  if (isnan(x)) { return 0.0; }
  return sign(x);
`,Upt=Ce({opSnippet:Bpt}),Gpt={kernelName:yp,backendName:"webgl",kernelFunc:Upt};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Wpt=Ch+`
  return sin(x);
`,Hpt=`
  vec4 result = sin(x);
  bvec4 isNaN = isnan(x);
  ${ku}
  return result;
`,qpt=Ce({opSnippet:Wpt,packedOpSnippet:Hpt}),jpt={kernelName:mp,backendName:"webgl",kernelFunc:qpt};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Kpt=`
  float e2x = exp(x);
  return (e2x - 1.0 / e2x) / 2.0;
`,Xpt=Ce({opSnippet:Kpt}),Ypt={kernelName:gp,backendName:"webgl",kernelFunc:Xpt};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Qpt=`
  float epsilon = 1.1920928955078125e-7;
  float threshold = log(epsilon) + 2.0;

  bool too_large = x > -threshold;
  bool too_small = x < threshold;

  float result;
  float exp_x = exp(x);

  if (too_large){
    result = x;
  }
  else if (too_small){
    result = exp_x;
  }
  else{
    result = log(exp_x + 1.0);
  }
  return result;
`,Zpt=Ce({opSnippet:Qpt}),Jpt={kernelName:bp,backendName:"webgl",kernelFunc:Zpt};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const tmt=n=>{const{inputs:t,backend:e,attrs:s}=n,{x:r}=t,{blockShape:i,paddings:o}=s;U(r.shape.length<=4,()=>"spaceToBatchND for rank > 4 with a WebGL backend not implemented yet");const l=i.reduce((S,E)=>S*E),u=[[0,0]];u.push(...o);for(let S=1+i.length;S<r.shape.length;++S)u.push([0,0]);const h=[],d=aP({inputs:{x:r},backend:e,attrs:{paddings:u,constantValue:0}}),p=Op(d.shape,i,l,!1),m=Mp(p.length,i.length,!1),y=Fp(d.shape,i,l,!1),x=Nt({inputs:{x:d},backend:e,attrs:{shape:p}}),v=Vs({inputs:{x},backend:e,attrs:{perm:m}}),C=Nt({inputs:{x:v},backend:e,attrs:{shape:y}});return h.push(d),h.push(x),h.push(v),h.forEach(S=>e.disposeIntermediateTensorInfo(S)),C},emt={kernelName:lx,backendName:"webgl",kernelFunc:tmt};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function nmt(n){const{inputs:t,backend:e}=n,{indices:s,values:r,denseShape:i,defaultValue:o}=t;if(i.shape.length!==1)throw new Error(`Dense shape must be a vector, saw:
         ${i.shape}`);if(s.shape.length!==2)throw new Error(`Indices must be a matrix, saw:
         ${s.shape}`);if(r.shape.length!==1)throw new Error(`Values must be a vector, saw:
         ${r.shape}`);if(o.shape.length!==0)throw new Error(`Default value must be a scalar, saw:
        ${o.shape}`);const l=e.readSync(s.dataId),u=e.readSync(r.dataId),h=e.readSync(i.dataId),d=e.readSync(o.dataId)[0],[p,m,y,x,v]=zot(l,s.shape,s.dtype,u,r.dtype,h,d);return[e.makeTensorInfo(m,s.dtype,p),e.makeTensorInfo([m[0]],r.dtype,y),e.makeTensorInfo([x.length],"bool",new Uint8Array(x.map(C=>Number(C)))),e.makeTensorInfo([v.length],s.dtype,new Int32Array(v))]}const smt={kernelName:K$,backendName:"webgl",kernelFunc:nmt};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function rmt(n){const{inputs:t,backend:e}=n,{inputIndices:s,inputShape:r,newShape:i}=t;if(s.shape.length!==2)throw new Error(`Input indices should be a matrix but received shape ${s.shape}`);if(r.shape.length!==1)throw new Error(`Input shape should be a vector but received shape ${r.shape}`);if(i.shape.length!==1)throw new Error(`Target shape should be a vector but received shape ${i.shape}`);const o=Array.from(e.readSync(r.dataId)),l=e.readSync(s.dataId),u=Array.from(e.readSync(i.dataId)),[h,d,p]=Bot(l,s.shape,s.dtype,o,u);return[e.makeTensorInfo(d,s.dtype,h),e.makeTensorInfo([p.length],i.dtype,new Int32Array(p))]}const imt={kernelName:X$,backendName:"webgl",kernelFunc:rmt};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function omt(n){const{inputs:t,backend:e}=n,{data:s,indices:r,segmentIds:i}=t;if(s.shape.length<1)throw new Error("Data should be at least 1 dimensional but received scalar");if(r.shape.length!==1)throw new Error(`Indices should be a vector but received shape
              ${r.shape}`);if(i.shape.length!==1)throw new Error(`Segment ids should be a vector but received shape
              ${i.shape}`);const o=e.readSync(s.dataId),l=e.readSync(r.dataId),u=e.readSync(i.dataId),[h,d]=$L(o,s.shape,s.dtype,l,u,!0);return e.makeTensorInfo(d,s.dtype,h)}const amt={kernelName:Y$,backendName:"webgl",kernelFunc:omt};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function lmt(n){const{inputs:t,backend:e}=n,{data:s,indices:r,segmentIds:i}=t;if(s.shape.length<1)throw new Error("Data should be at least 1 dimensional but received scalar");if(r.shape.length!==1)throw new Error(`Indices should be a vector but received shape
             ${r.shape}`);if(i.shape.length!==1)throw new Error(`Segment ids should be a vector but received shape
             ${i.shape}`);const o=e.readSync(s.dataId),l=e.readSync(r.dataId),u=e.readSync(i.dataId),[h,d]=$L(o,s.shape,s.dtype,l,u);return e.makeTensorInfo(d,s.dtype,h)}const umt={kernelName:Q$,backendName:"webgl",kernelFunc:lmt};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function cmt(n){const{inputs:t,backend:e,attrs:s}=n,{sparseIndices:r,sparseValues:i,defaultValue:o}=t,{outputShape:l}=s,{sliceRank:u,numUpdates:h,sliceSize:d,strides:p,outputSize:m}=Su(i,r,l),y=!1;if(i.dtype==="string"){const S=e.bufferSync(r),E=e.bufferSync(i),_=Wa(e.readSync(o.dataId)[0]),I=Lot(S,E,l,m,d,h,u,p,_,y);return e.makeTensorInfo(l,I.dtype,I.values)}const x=new QT(h,u,r.shape.length,i.shape.length,p,[m,1],y),v=e.runWebGLProgram(x,[i,r,o],i.dtype),C=Nt({inputs:{x:v},backend:e,attrs:{shape:l}});return e.disposeIntermediateTensorInfo(v),C}const hmt={kernelName:Z$,backendName:"webgl",kernelFunc:cmt};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function dmt(n){const{inputs:t,backend:e,attrs:s}=n,{x:r}=t,{numOrSizeSplits:i,axis:o}=s,l=le(o,r.shape)[0],u=cT(r,i,l),h=r.shape.length,d=new Array(h).fill(0),p=r.shape.slice();return u.map(m=>{const y=[...p];y[l]=m;const x=Sh({inputs:{x:r},backend:e,attrs:{begin:d,size:y}});return d[l]+=m,x})}const fmt={kernelName:ux,backendName:"webgl",kernelFunc:dmt};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const xN="return sqrt(x);",pmt=Ce({opSnippet:xN,packedOpSnippet:xN,cpuKernelImpl:Uot}),mmt={kernelName:vp,backendName:"webgl",kernelFunc:pmt};/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const gmt="return x * x;",ymt=Ce({opSnippet:gmt}),xmt={kernelName:tS,backendName:"webgl",kernelFunc:ymt};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const bN="return (a - b) * (a - b);",bmt=ds({opSnippet:bN,packedOpSnippet:bN}),vmt={kernelName:wp,backendName:"webgl",kernelFunc:bmt};/**
 * @license
 * Copyright 2023 Google LLC.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function wmt(n){const{inputs:t,backend:e,attrs:s}=n,{x:r}=t;if(r.dtype!=="string")throw new Error("Input must be of datatype string");const i=e.readSync(r.dataId),o=Go(i),l=Got(o,"string",s);return e.makeTensorInfo(r.shape,"string",l)}const Cmt={kernelName:eS,backendName:"webgl",kernelFunc:wmt};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Smt({inputs:n,attrs:t,backend:e}){const{x:s}=n,r=Yr+`
    return x > 0.0 ? 1.0 : float(${t.alpha});
  `,i=new Pi(s.shape,r);return e.runWebGLProgram(i,[s],s.dtype)}const Tmt={kernelName:Ip,backendName:"webgl",kernelFunc:Smt};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Emt{constructor(t,e,s){this.variableNames=["x"],this.outputShape=s;const r=s.length,i=He(s.length),o=He(s.length);let l="";if(r===1)l="coords * strides + begin";else{let u=0;l=s.map((h,d)=>(u++,s.length===1?`coords * strides[${d}] + begin[${d}]`:`coords[${u-1}] * strides[${d}] + begin[${d}]`)).join(",")}this.userCode=`
      ${i} begin = ${i}(${t});
      ${i} strides = ${i}(${e});

      void main() {
        ${o} coords = getOutputCoords();
        setOutput(getX(${l}));
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Imt(n){const{inputs:t,backend:e,attrs:s}=n,{x:r}=t,{begin:i,end:o,strides:l,beginMask:u,endMask:h,ellipsisMask:d,newAxisMask:p,shrinkAxisMask:m}=s,{finalShapeSparse:y,finalShape:x,isIdentity:v,sliceDim0:C,isSimpleSlice:S,begin:E,end:_,strides:I}=qS(r.shape,i,o,l,u,h,d,p,m);let O;if(v)O=Nt({inputs:{x:r},backend:e,attrs:{shape:x}});else if(C||S){U(r.shape.length>=1,()=>`Input must have rank at least 1, got: ${r.shape.length}`);const D=GS(E,_,I),N=Sh({inputs:{x:r},backend:e,attrs:{begin:E,size:D}});O=Nt({inputs:{x:N},backend:e,attrs:{shape:x}}),e.disposeIntermediateTensorInfo(N)}else if(e.shouldExecuteOnCPU([r])){const N=e.readSync(r.dataId),R=ae(r.shape,r.dtype,N),$=Wot(y,R,I,E);O=e.makeTensorInfo(x,r.dtype,$.values)}else{const N=new Emt(E,I,y);O=e.runWebGLProgram(N,[r],r.dtype)}const P=Nt({inputs:{x:O},backend:e,attrs:{shape:x}});return e.disposeIntermediateTensorInfo(O),P}const _mt={kernelName:nS,backendName:"webgl",kernelFunc:Imt};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function kmt(n){const{inputs:t,backend:e,attrs:s}=n,{separator:r,nGramWidths:i,leftPad:o,rightPad:l,padWidth:u,preserveShortSequences:h}=s,{data:d,dataSplits:p}=t,m=e.readSync(d.dataId),y=e.readSync(p.dataId),[x,v]=Hot(m,y,r,i,o,l,u,h);return[e.makeTensorInfo([x.length],"string",x),e.makeTensorInfo(p.shape,"int32",v)]}const Amt={kernelName:J$,backendName:"webgl",kernelFunc:kmt};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Nmt(n){const{inputs:t,backend:e,attrs:s}=n,{skipEmpty:r}=s,{input:i,delimiter:o}=t;if(i.dtype!=="string")throw new Error("Input must be of datatype string");if(i.shape.length!==1)throw new Error(`Input must be a vector, got shape: ${i.shape}`);if(o.shape.length!==0)throw new Error(`Delimiter must be a scalar, got shape: ${o.shape}`);const l=e.readSync(i.dataId),u=e.readSync(o.dataId)[0],[h,d,p]=qot(l,u,r),m=d.length;return[e.makeTensorInfo([m,2],"int32",h),e.makeTensorInfo([m],"string",d),e.makeTensorInfo([2],"int32",new Int32Array(p))]}const Rmt={kernelName:tD,backendName:"webgl",kernelFunc:Nmt};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function $mt(n){const{inputs:t,backend:e,attrs:s}=n,{numBuckets:r}=s,{input:i}=t;if(i.dtype!=="string")throw new Error("Input must be of datatype string");if(r<=0)throw new Error("Number of buckets must be at least 1");const o=e.readSync(i.dataId),l=jot(o,r);return e.makeTensorInfo(i.shape,"int32",l)}const Dmt={kernelName:eD,backendName:"webgl",kernelFunc:$mt};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Omt="return tan(x);",Mmt=Ce({opSnippet:Omt}),Fmt={kernelName:Sp,backendName:"webgl",kernelFunc:Mmt};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Lmt=`
  float e2x = exp(-2.0 * abs(x));
  return sign(x) * (1.0 - e2x) / (1.0 + e2x);
`,Pmt=Ce({opSnippet:Lmt}),Vmt={kernelName:Tp,backendName:"webgl",kernelFunc:Pmt};/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function zmt(n){const{inputs:t,backend:e,attrs:s}=n,{tensor:r,indices:i,updates:o}=t,{sliceRank:l,numUpdates:u,sliceSize:h,strides:d,outputSize:p}=Su(o,i,r.shape),m=[p/h,h];if(p===0)return e.makeTensorInfo(r.shape,i.dtype);const y=Nt({inputs:{x:i},backend:e,attrs:{shape:[u,l]}}),x=Nt({inputs:{x:o},backend:e,attrs:{shape:[u,h]}}),v=Nt({inputs:{x:r},backend:e,attrs:{shape:m}}),C=new QT(u,l,y.shape.length,x.shape.length,d,m,!1,!0),S=e.runWebGLProgram(C,[x,y,v],v.dtype),E=Nt({inputs:{x:S},backend:e,attrs:{shape:r.shape}});return e.disposeIntermediateTensorInfo(y),e.disposeIntermediateTensorInfo(x),e.disposeIntermediateTensorInfo(v),e.disposeIntermediateTensorInfo(S),E}const Bmt={kernelName:q$,backendName:"webgl",kernelFunc:zmt};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Umt{constructor(t,e){this.variableNames=["A"];const s=new Array(t.length);for(let o=0;o<s.length;o++)s[o]=t[o]*e[o];this.outputShape=s,this.rank=s.length;const r=He(this.rank),i=Gmt(t);this.userCode=`
      void main() {
        ${r} resRC = getOutputCoords();
        setOutput(getA(${i}));
      }
    `}}function Gmt(n){const t=n.length;if(t>5)throw Error(`Tile for rank ${t} is not yet supported`);if(t===1)return`imod(resRC, ${n[0]})`;const e=["resRC.x","resRC.y","resRC.z","resRC.w","resRC.u"],s=[];for(let r=0;r<n.length;r++)s.push(`imod(${e[r]}, ${n[r]})`);return s.join()}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function uP(n){const{inputs:t,backend:e,attrs:s}=n,{x:r}=t,{reps:i}=s;if(r.dtype==="string"||r.shape.length>5){const u=e.readSync(r.dataId),h=r.dtype==="string"?u.map(m=>Wa(m)):u,d=ae(r.shape,r.dtype,h),p=Xot(d,i);return e.makeTensorInfo(p.shape,p.dtype,p.values)}const o=new Umt(r.shape,i);return e.runWebGLProgram(o,[r],r.dtype)}const Wmt={kernelName:Ep,backendName:"webgl",kernelFunc:uP};class Hmt{constructor(t){this.variableNames=["x","indices"],this.customUniforms=[{name:"n",type:"int"},{name:"firstPass",type:"int"},{name:"negativeInf",type:"float"},{name:"dir",type:"int"},{name:"inc",type:"int"}],this.outputShape=t,this.userCode=`
       void main() {
         ivec2 coords = getOutputCoords();
         int batch = coords[0];
         int elemIdx = coords[1];

         // We compare elements pair-wise within a group of size 2 * inc.
         // The comparing rule for each group alternates between ascending
         // and descending. Within each group, we compare each pair at
         // positions i and i+inc. To decide whether an element at position i
         // is x0 or x1, we mod it by 2 * inc, if the result is smaller than
         // inc, it is in the first half of the group, we denote it as x0,
         // otherwise we denote it as x1.
         // For example, as shown in the Bitonic top K paper referenced above,
         // Figure5(a) shows that element[1] is in the
         // second half of the group when group size is 2, but it is in the
         // first half of the group when group size is 4.

         bool isFirstInPair = imod(elemIdx, 2 * inc) < inc;
         int i = isFirstInPair ? elemIdx : elemIdx - inc;

         int i0 = firstPass == 1 ? i : int(getIndices(batch, i));
         int i1 = firstPass == 1 ? i + inc : int(getIndices(batch, i + inc));
         float x0 = i0 < n ? getX(batch, i0) : negativeInf;
         float x1 = i1 < n ? getX(batch, i1) : negativeInf;

         // Denotes which direction indices are in (ascending or descending).
         bool reverse = imod(elemIdx, 2 * dir) >= dir;
         bool isGreater = x0 > x1 || (x0 == x1 && i1 > i0);
         if (reverse == isGreater) { // Elements in opposite order of direction
           int iTemp = i0;
           i0 = i1;
           i1 = iTemp;
         }
         if (isFirstInPair) {
            setOutput(float(i0));
         } else {
            setOutput(float(i1));
         }
       }
     `}}class qmt{constructor(t){this.variableNames=["x","indices"],this.customUniforms=[{name:"n",type:"int"},{name:"firstPass",type:"int"},{name:"k",type:"int"}],this.outputShape=t,this.userCode=`
    void main() {
         // Takes max of indices (0, k), (1, k + 1), (2, k + 2) ...
         ivec2 coords = getOutputCoords();
         int batch = coords[0];
         int elemIdx = coords[1];

         // The output size is half of the previous size.
         // If the previous sequence is | | | | _ _ _ _  | | | |  _ _ _ _ (k=4),
         // we only need to output the indices at positions |, the indices at
         // positions _ can be thrown away, see Figure5(b) After Phase 2
         // (Merge phase) in the Bitonic Top K paper referenced above.
         // For example, the paper shows we only need to output the orange bars.
         // The output sequence should look like this | | | | | | | |.
         // Because the sequence is halved, to map the output index back
         // to the previous sequence to find the corresponding value,
         // we need to double the index. When we double the index,
         // we basically interpolate a position, so 2i looks like
         // | _ | _ | _ | _ | _ | _ | _. We move the | to the first k position
         // of each 2k positions by - elemIdx % k. E.g. for output at
         // index 4,5,6,7, we want to get the corresponding element at
         // original index 8,9,10,11, for output at index 8,9,10,11,
         // we want to get the corresponding element at original index
         // 16,17,18,19, so on and so forth.

         int i = elemIdx < k ? elemIdx : (elemIdx * 2 - imod(elemIdx, k));
         int i0 = firstPass == 1 ? i : int(getIndices(batch, i));
         int i1 = firstPass == 1 ? i + k : int(getIndices(batch, i + k));

         float x0 = getX(batch, i0);
         float x1 = i1 < n ? getX(batch, i1) : x0;

         setOutput(x0 >= x1 ? float(i0) : float(i1));
       }
     `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function zl(n,t){t!==null&&n.disposeIntermediateTensorInfo(t)}function vN(n){let t=1;for(;t<n;)t*=2;return t}function jmt(n){const{inputs:t,backend:e,attrs:s}=n,{x:r}=t,{k:i,sorted:o}=s,l=dt().getNumber("TOPK_LAST_DIM_CPU_HANDOFF_SIZE_THRESHOLD"),u=dt().getNumber("TOPK_K_CPU_HANDOFF_THRESHOLD"),h=r.shape,d=h[h.length-1];if(e.shouldExecuteOnCPU([r])||d<l||i>u){const $=e.readSync(r.dataId),[A,V]=Yot($,h,r.dtype,i,o);return[e.makeTensorInfo(A.shape,A.dtype,A.values),e.makeTensorInfo(V.shape,V.dtype,V.values)]}if(i===0)return h[h.length-1]=0,[e.makeTensorInfo(h,r.dtype,[]),e.makeTensorInfo(h,"int32",[])];if(d===1)return[r,Yp({attrs:{shape:h,dtype:"int32",value:0},backend:e})];const p=e.texData.get(r.dataId),m=p!==null&&p.isPacked,y=m?e.unpackTensor(r):r,v=yt(h)/d,C=Nt({inputs:{x:y},attrs:{shape:[v,d]},backend:e});m&&zl(e,y);const S=vN(i),E=vN(d);let _=null;const I=()=>_===null?[C,C]:[C,_],O=($,A,V)=>{const L=I(),nt=new Hmt(V),W=[[d],[_===null?1:0],[Number.NEGATIVE_INFINITY],[$],[A]],K=_;_=e.runWebGLProgram(nt,L,"int32",W),zl(e,K)};for(let $=1;$<S;$*=2){const A=$*2;for(let V=$;V>=1;V/=2)O(A,V,[v,E])}for(let $=E;$>S;$/=2){const A=I(),V=new qmt([v,$/2]),nt=[[d],[_===null?1:0],[S]],Z=_;_=e.runWebGLProgram(V,A,"int32",nt),zl(e,Z);const W=S/2,K=W*2;for(let Y=W;Y>=1;Y/=2)O(K,Y,_.shape)}let P=_;_=Sh({inputs:{x:_},backend:e,attrs:{begin:0,size:[v,i]}}),zl(e,P);let D=eP({inputs:{x:C,indices:_},backend:e,attrs:{axis:1,batchDims:1}});zl(e,C);const N=h.slice(0,-1);N.push(i),P=_,_=Nt({inputs:{x:_},attrs:{shape:N},backend:e}),zl(e,P);const R=D;return D=Nt({inputs:{x:D},attrs:{shape:N},backend:e}),zl(e,R),[D,_]}const Kmt={kernelName:sS,backendName:"webgl",kernelFunc:jmt};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Xmt{constructor(t,e,s,r,i,o){this.variableNames=["Image","Transforms"],this.outputShape=o;const l=s==="nearest"?1:2;let u;switch(r){case"constant":u=1;break;case"reflect":u=2;break;case"wrap":u=3;break;case"nearest":u=4;break;default:u=1;break}this.userCode=`
            float mapCoord(float outCoord, float len) {
              float inCoord = outCoord;
              if(${u} == 2) {
                if (inCoord < 0.0) {
                  if (len <= 1.0) {
                    inCoord = 0.0;
                  } else {
                    float sz2 = 2.0 * len;
                    if (inCoord < sz2) {
                      inCoord = sz2 * float(int(float(-inCoord / sz2))) +
                      inCoord;
                    }
                    inCoord = inCoord < -len ? inCoord + sz2 : -inCoord - 1.0;
                  }
                } else if (inCoord > len - 1.0) {
                  if (len <= 1.0) {
                    inCoord = 0.0;
                  } else {
                    float sz2 = 2.0 * len;
                    inCoord -= sz2 * float(int(float(inCoord / sz2)));
                    if (inCoord >= len) {
                      inCoord = sz2 - inCoord - 1.0;
                    }
                  }
                }
                return clamp(inCoord, 0.0, len - 1.0);
              } else if (${u} == 3) {
                if (inCoord < 0.0) {
                  if (len <= 1.0) {
                    inCoord = 0.0;
                  } else {
                    float sz = len - 1.0;
                    inCoord += len * (float(int(float(-inCoord / sz))) + 1.0);
                  }
                } else if (inCoord > len - 1.0) {
                  if (len <= 1.0) {
                    inCoord = 0.0;
                  } else {
                    float sz = len - 1.0;
                    inCoord -= len * float(int(float(inCoord / sz)));
                  }
                }
                return clamp(inCoord, 0.0, len - 1.0);
              } else if (${u} == 4) {
                return clamp(outCoord, 0.0, len - 1.0);
              } else {
                return outCoord;
              }
            }

            float readWithFillValue(int batch, int coordY, int coordX,
              int channel) {
              float outputValue;
              if (0 <= coordY && coordY < ${t} && 0 <= coordX && coordX < ${e}) {
                  outputValue = getImage(batch, coordY, coordX, channel);
              } else {
                outputValue = float(${i});
              }
              return outputValue;
            }

            void main() {
              ivec4 coords = getOutputCoords();
              float outputValue;
              int batch = coords[0];
              int x = coords[2];
              int y = coords[1];
              int channel = coords[3];
              float xf = float(x);
              float yf = float(y);
              float a1 = getTransforms(batch, 0);
              float a2 = getTransforms(batch, 1);
              float a3 = getTransforms(batch, 2);
              float b1 = getTransforms(batch, 3);
              float b2 = getTransforms(batch, 4);
              float b3 = getTransforms(batch, 5);
              float c1 = getTransforms(batch, 6);
              float c2 = getTransforms(batch, 7);
              float projection = c1 * xf + c2 * yf + 1.0;
              if (projection == 0.0) {
                outputValue = float(${i});
              } else {
                float inX = (a1 * xf + a2 * yf + a3) / projection;
                float inY = (b1 * xf + b2 * yf + b3) / projection;
                float mapX = mapCoord(inX, float(${e}));
                float mapY = mapCoord(inY, float(${t}));

                if (${l} == 1) {
                  int coordY = int(round(mapY));
                  int coordX = int(round(mapX));
                  outputValue = readWithFillValue(batch, coordY, coordX,
                    channel);
                } else {
                  float yFloor = floor(mapY);
                  float xFloor = floor(mapX);
                  float yCeil = yFloor + 1.0;
                  float xCeil = xFloor + 1.0;
                  float valueYFloor = (xCeil - mapX) *
                  readWithFillValue(batch, int(yFloor), int(xFloor), channel) +
                  (mapX - xFloor) *
                  readWithFillValue(batch, int(yFloor), int(xCeil), channel);
                  float valueYCeil = (xCeil - mapX) *
                  readWithFillValue(batch, int(yCeil), int(xFloor), channel) +
                  (mapX - xFloor) *
                  readWithFillValue(batch, int(yCeil), int(xCeil), channel);
                  outputValue = (yCeil - mapY) * valueYFloor +
                  (mapY - yFloor) * valueYCeil;
                }
              }
              setOutput(outputValue);
            }
        `}}/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Ymt(n){const{inputs:t,backend:e,attrs:s}=n,{image:r,transforms:i}=t,{interpolation:o,fillMode:l,fillValue:u,outputShape:h}=s,[d,p,m,y]=r.shape,[x,v]=h??[p,m],C=[d,x,v,y],S=new Xmt(p,m,o,l,u,C);return e.runWebGLProgram(S,[r,i],"float32")}const Qmt={kernelName:rS,backendName:"webgl",kernelFunc:Ymt};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Zmt(n){const{inputs:t,attrs:e,backend:s}=n,{axis:r}=e,{x:i}=t;jp(i,"unique"),console.warn("WARNING: ","UI might be locked temporarily as data is being downloaded");const o=s.readSync(i.dataId),{outputValues:l,outputShape:u,indices:h}=Qot(o,r,i.shape,i.dtype);return[s.makeTensorInfo(u,i.dtype,l),s.makeTensorInfo([h.length],"int32",h)]}const Jmt={kernelName:iS,backendName:"webgl",kernelFunc:Zmt};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function tgt(n){const{inputs:t,backend:e,attrs:s}=n,{value:r}=t;let{axis:i}=s;i<0&&(i+=r.shape.length);const o=r,l=o.shape.length,u=r.shape[i],h=new Array(l-1);let d=0;for(let v=0;v<l;v++)v!==i&&(h[d++]=o.shape[v]);const p=[],m=new Array(l).fill(0),y=o.shape.slice();y[i]=1;const x=new Array(u);for(let v=0;v<x.length;v++){m[i]=v;const C=Sh({inputs:{x:o},backend:e,attrs:{begin:m,size:y}}),S=Nt({inputs:{x:C},backend:e,attrs:{shape:h}});x[v]=S,p.push(C)}return p.forEach(v=>e.disposeIntermediateTensorInfo(v)),x}const egt={kernelName:hx,backendName:"webgl",kernelFunc:tgt};/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class ngt{constructor(t,e){this.variableNames=["x","segmentIds"];const s=t.windowSize,r=t.batchSize,i=t.inSize,o=t.numSegments,l=o*Math.ceil(i/s);this.outputShape=[r,l];const u="0.0",h="sumValue",d=Math.floor(s/4)*4,p=s%4,m=`
        sumValue += dot(values, segFilter);
    `;let y="";i%s>0&&(y=`
        if (inIdx < 0 || inIdx >= ${i}) {
          return initializationValue;
        }
      `);let x="";i%s>0&&(x=`
        if (inIdx < 0 || inIdx >= ${i}) {
          return -1.0;
        }
      `),this.userCode=`
      const float initializationValue = ${u};

      float getValue(int batch, int inIdx) {
        ${y}
        return getX(batch, inIdx);
      }

      float getSegmentIdAtIndex(int inIdx) {
        ${x}
        return getSegmentIds(inIdx);
      }

      void main() {
        ivec2 coords = getOutputCoords();
        int batch = coords[0];
        int outIdx = coords[1];
        int inOffset = int(floor(float(outIdx) / float(
          ${o})) * float(${s}));
        int currentSeg = int(mod(float(outIdx), float(${o})));

        float sumValue = 0.0;

        for (int i = 0; i < ${d}; i += 4) {
          int inIdx = inOffset + i;
          vec4 values = vec4(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1),
            getValue(batch, inIdx + 2),
            getValue(batch, inIdx + 3)
          );

          vec4 segFilter = vec4(
            int(getSegmentIdAtIndex(inIdx)) == currentSeg ? 1 : 0,
            int(getSegmentIdAtIndex(inIdx + 1)) == currentSeg ? 1 : 0,
            int(getSegmentIdAtIndex(inIdx + 2)) == currentSeg ? 1 : 0,
            int(getSegmentIdAtIndex(inIdx + 3)) == currentSeg ? 1 : 0
          );

          ${m}
        }

        int inIdx = inOffset + ${d};
        if (${p===1}) {
          vec4 values = vec4(
            getValue(batch, inIdx),
            initializationValue,
            initializationValue,
            initializationValue
          );

          int inIdxSeg = int(getSegmentIdAtIndex(inIdx));

          vec4 segFilter = vec4(
            int(getSegmentIdAtIndex(inIdx)) == currentSeg ? 1 : 0,
            0,
            0,
            0
          );

          ${m}
        } else if (${p===2}) {
          vec4 values = vec4(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1),
            initializationValue,
            initializationValue
          );

          vec4 segFilter = vec4(
            int(getSegmentIdAtIndex(inIdx)) == currentSeg ? 1 : 0,
            int(getSegmentIdAtIndex(inIdx + 1)) == currentSeg ? 1 : 0,
              0,
              0
          );

          ${m}
        } else if (${p===3}) {
          vec4 values = vec4(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1),
            getValue(batch, inIdx + 2),
            initializationValue
          );

          vec4 segFilter = vec4(
            int(getSegmentIdAtIndex(inIdx)) == currentSeg ? 1 : 0,
            int(getSegmentIdAtIndex(inIdx + 1)) == currentSeg ? 1 : 0,
            int(getSegmentIdAtIndex(inIdx + 2)) == currentSeg ? 1 : 0,
            0
          );

          ${m}
        }
        setOutput(${h});
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function sgt(n){const{inputs:t,backend:e,attrs:s}=n,{x:r,segmentIds:i}=t,{numSegments:o}=s,l=r.shape.length,u=[];let h=0;const d=hn([h],l);let p=r;d!=null&&(p=Vs({inputs:{x:r},backend:e,attrs:{perm:d}}),u.push(p),h=Cn(1,l)[0]);const m=WO(p.shape,h,o),y=yt([p.shape[h]]),x=Nt({inputs:{x:p},backend:e,attrs:{shape:[-1,y]}});u.push(x);const v=aS(r.dtype),C=(I,O,P,D,N)=>{const R=I.shape[0],$=I.shape[1],A=GO($,N),V={windowSize:A,inSize:$,batchSize:R,numSegments:N},L=new ngt(V,O),nt=e.compileAndRun(L,[I,P],D);if(u.push(nt),nt.shape[1]===N)return nt;const Z=lP({backend:e,attrs:{start:0,stop:N,step:1,dtype:"float32"}}),W=uP({inputs:{x:Z},backend:e,attrs:{reps:[$/A]}});return u.push(Z),u.push(W),C(nt,O,W,D,N)},S=C(x,"unsortedSegmentSum",i,v,o),E=Nt({inputs:{x:S},backend:e,attrs:{shape:m}});let _=E;if(d!=null){u.push(E);const I=tl(d);_=Vs({inputs:{x:_},backend:e,attrs:{perm:I}})}return u.forEach(I=>e.disposeIntermediateTensorInfo(I)),_}const rgt={kernelName:dx,backendName:"webgl",kernelFunc:sgt};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const igt=[Uat,Wat,jat,Yat,Zat,elt,slt,ilt,ult,hlt,plt,ylt,vlt,Tlt,_lt,Alt,Rlt,Mlt,Llt,Vlt,Glt,Ylt,Zlt,nut,rut,cut,dut,gut,Eat,but,Tut,kut,Out,Lut,Vut,But,Gut,jut,Yut,Jut,ect,sct,ict,lct,cct,pct,gct,bct,Cct,Tct,kct,$ct,Fct,Vct,Uct,Gct,Hct,jct,Xct,Qct,Jct,sht,oht,uht,hht,pht,yht,wht,Eht,Tat,_ht,Cut,Nht,Dht,Fht,_at,zht,Wht,qht,Yht,Jht,sdt,odt,cdt,pdt,ydt,bdt,Sdt,Edt,_dt,Rdt,Ddt,Mdt,Ldt,Vdt,Gdt,jdt,Qdt,ift,Nat,uft,dft,mft,xft,out,wft,Sft,Eft,kft,$ft,Aat,Oft,Fft,Pft,zft,Bft,aut,eft,Wft,Kft,Zft,$at,npt,ipt,upt,dpt,gpt,xpt,wpt,Tpt,_pt,Npt,Dpt,Fpt,zpt,Gpt,jpt,Ypt,Klt,sft,Jpt,emt,smt,imt,amt,umt,hmt,fmt,mmt,xmt,vmt,Cmt,Tmt,_mt,Amt,Rmt,Dmt,nft,Vat,Fmt,Vmt,Bmt,Wmt,Kmt,Qmt,zat,Jmt,egt,rgt,Cft];for(const n of igt)sD(n);const ogt="/tfjs_model/model.json",agt=["Sisy","Yoga"];function lgt(n){return new Promise((t,e)=>{const s=new window.Image;s.src=n,s.onload=()=>t(s),s.onerror=e})}function ugt(){const n=bt.useRef(null),[t,e]=bt.useState("Belum memulai absensi"),[s,r]=bt.useState(!1),[i,o]=bt.useState(null),[l,u]=bt.useState(!0),h=async()=>{r(!0),e("Mendeteksi wajah..."),u(!1);const d=n.current.getScreenshot();if(!d){e("Gagal mengambil gambar dari webcam."),o({message:"Gagal mengambil gambar dari webcam.",type:"error"}),r(!1),u(!0);return}let p;try{p=await bQ(ogt)}catch{e("Gagal memuat model."),o({message:"Gagal memuat model.",type:"error"}),r(!1),u(!0);return}try{const m=await lgt(d),y=I7(m).resizeNearestNeighbor([224,224]).toFloat().div(255).expandDims(),v=await p.predict(y).data(),C=v.indexOf(Math.max(...v));if(v[C]<.8)e("Wajah tidak terdeteksi. Silakan ulangi."),o({message:"Wajah tidak terdeteksi. Silakan ulangi.",type:"error"});else{const E=agt[C],_=new Date().toISOString(),I=await $W(E,_);e(I?`Absensi berhasil: ${E}`:"Gagal menyimpan absensi"),o({message:I?`Absensi tercatat untuk ${E}`:"Terjadi kesalahan saat menyimpan.",type:I?"success":"error"})}}catch(m){console.error("Error saat memproses gambar:",m),e("Gagal memproses gambar."),o({message:"Gagal memproses gambar.",type:"error"})}finally{r(!1),u(!0)}};return Ut.jsxs("div",{className:"p-4 sm:p-6 md:p-8 min-h-screen bg-gray-100",children:[Ut.jsx(k$,{show:i!==null,message:i?i.message:"",type:i?i.type:"",onClose:()=>o(null)}),Ut.jsxs("div",{className:"w-full max-w-md mx-auto",children:[Ut.jsx("h2",{className:"text-2xl font-semibold mb-4 text-center",children:"Halaman Absensi"}),Ut.jsx(Sz,{ref:n,audio:!1,screenshotFormat:"image/jpeg",className:"rounded-lg shadow-md w-full mb-4",style:{transform:"scaleX(-1)"}}),Ut.jsx("button",{onClick:h,className:"w-full bg-gradient-to-r from-red-600 to-black text-white px-6 py-3 rounded-2xl font-semibold shadow-lg hover:scale-105 transition-transform",disabled:s||!l,children:s?"Memproses absensi...":"Mulai Absensi"}),Ut.jsx("p",{className:"mt-4 text-gray-700 text-center",children:t})]})]})}/**
 * @license lucide-react v0.514.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const cgt=n=>n.replace(/([a-z0-9])([A-Z])/g,"$1-$2").toLowerCase(),hgt=n=>n.replace(/^([A-Z])|[\s-_]+(\w)/g,(t,e,s)=>s?s.toUpperCase():e.toLowerCase()),wN=n=>{const t=hgt(n);return t.charAt(0).toUpperCase()+t.slice(1)},cP=(...n)=>n.filter((t,e,s)=>!!t&&t.trim()!==""&&s.indexOf(t)===e).join(" ").trim(),dgt=n=>{for(const t in n)if(t.startsWith("aria-")||t==="role"||t==="title")return!0};/**
 * @license lucide-react v0.514.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */var fgt={xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round"};/**
 * @license lucide-react v0.514.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const pgt=bt.forwardRef(({color:n="currentColor",size:t=24,strokeWidth:e=2,absoluteStrokeWidth:s,className:r="",children:i,iconNode:o,...l},u)=>bt.createElement("svg",{ref:u,...fgt,width:t,height:t,stroke:n,strokeWidth:s?Number(e)*24/Number(t):e,className:cP("lucide",r),...!i&&!dgt(l)&&{"aria-hidden":"true"},...l},[...o.map(([h,d])=>bt.createElement(h,d)),...Array.isArray(i)?i:[i]]));/**
 * @license lucide-react v0.514.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const hP=(n,t)=>{const e=bt.forwardRef(({className:s,...r},i)=>bt.createElement(pgt,{ref:i,iconNode:t,className:cP(`lucide-${cgt(wN(n))}`,`lucide-${n}`,s),...r}));return e.displayName=wN(n),e};/**
 * @license lucide-react v0.514.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const mgt=[["path",{d:"M8 2v4",key:"1cmpym"}],["path",{d:"M16 2v4",key:"4m81vk"}],["rect",{width:"18",height:"18",x:"3",y:"4",rx:"2",key:"1hopcy"}],["path",{d:"M3 10h18",key:"8toen8"}],["path",{d:"M8 14h.01",key:"6423bh"}],["path",{d:"M12 14h.01",key:"1etili"}],["path",{d:"M16 14h.01",key:"1gbofw"}],["path",{d:"M8 18h.01",key:"lrp35t"}],["path",{d:"M12 18h.01",key:"mhygvu"}],["path",{d:"M16 18h.01",key:"kzsmim"}]],CN=hP("calendar-days",mgt);/**
 * @license lucide-react v0.514.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ggt=[["circle",{cx:"10",cy:"7",r:"4",key:"e45bow"}],["path",{d:"M10.3 15H7a4 4 0 0 0-4 4v2",key:"3bnktk"}],["circle",{cx:"17",cy:"17",r:"3",key:"18b49y"}],["path",{d:"m21 21-1.9-1.9",key:"1g2n9r"}]],ygt=hP("user-search",ggt);function xgt(n){return n?new Date(n).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"}):"-"}function bgt(n){return n?new Date(n).toLocaleDateString():"-"}function vgt(){const[n,t]=bt.useState([]),[e,s]=bt.useState(""),[r,i]=bt.useState(""),[o,l]=bt.useState("");bt.useEffect(()=>{DW().then(h=>{t(h)})},[]);const u=n.filter(h=>{const d=h.name.toLowerCase().includes(e.toLowerCase()),p=new Date(h.timestamp).toISOString().split("T")[0],m=(!r||p>=r)&&(!o||p<=o);return d&&m});return Ut.jsxs("div",{className:"min-h-screen bg-gray-100 py-10 px-4 md:px-16",children:[Ut.jsx("h1",{className:"text-3xl font-bold mb-6 text-gray-800 text-center mx-auto",children:"Dashboard Kehadiran"}),Ut.jsxs("div",{className:"w-full max-w-5xl mx-auto mb-6 flex flex-col md:flex-row md:items-center md:justify-between gap-4",children:[Ut.jsxs("div",{className:"flex items-center bg-white rounded-full shadow px-4 py-2 w-full md:w-[60%]",children:[Ut.jsx(ygt,{className:"text-gray-400 mr-2",size:18}),Ut.jsx("input",{type:"text",placeholder:"Cari nama...",className:"flex-1 outline-none text-sm",value:e,onChange:h=>s(h.target.value)})]}),Ut.jsxs("div",{className:"flex items-center gap-2",children:[Ut.jsxs("div",{className:"flex items-center bg-white rounded-lg shadow px-3 py-1",children:[Ut.jsx(CN,{className:"text-gray-400 mr-2",size:16}),Ut.jsx("input",{type:"date",value:r,className:"outline-none text-sm",onChange:h=>i(h.target.value)})]}),Ut.jsx("span",{className:"text-gray-600",children:"to"}),Ut.jsxs("div",{className:"flex items-center bg-white rounded-lg shadow px-3 py-1",children:[Ut.jsx(CN,{className:"text-gray-400 mr-2",size:16}),Ut.jsx("input",{type:"date",value:o,className:"outline-none text-sm",onChange:h=>l(h.target.value)})]})]})]}),Ut.jsx("div",{className:"overflow-x-auto shadow-lg rounded-2xl bg-white w-full max-w-[1050px] mx-auto",children:Ut.jsxs("table",{className:"w-full bg-white shadow-xl rounded-2xl text-sm border-separate border-spacing-0",children:[Ut.jsx("thead",{children:Ut.jsxs("tr",{className:"bg-gradient-to-r from-red-700 to-black text-white text-center",children:[Ut.jsx("th",{className:"py-3 px-4",children:"ID"}),Ut.jsx("th",{className:"py-3 px-4",children:"Nama"}),Ut.jsx("th",{className:"py-3 px-4",children:"Waktu"}),Ut.jsx("th",{className:"py-3 px-4",children:"Tanggal"})]})}),Ut.jsx("tbody",{children:u.length===0?Ut.jsx("tr",{children:Ut.jsx("td",{colSpan:"4",className:"text-center py-6 text-gray-500",children:"Tidak ada data yang ditemukan."})}):u.map((h,d)=>Ut.jsxs("tr",{className:"bg-white hover:shadow-md transition-shadow text-center",children:[Ut.jsx("td",{className:"px-4 py-3",children:d+1}),Ut.jsx("td",{className:"px-4 py-3",children:h.name}),Ut.jsx("td",{className:"px-4 py-3",children:xgt(h.timestamp)}),Ut.jsx("td",{className:"px-4 py-3 rounded-r-lg",children:bgt(h.timestamp)})]},d))})]})})]})}function wgt(){return Ut.jsx("nav",{className:"bg-gradient-to-r from-red-900 to-black text-white py-3 px-6 shadow-md",children:Ut.jsxs("div",{className:"max-w-7xl mx-auto flex items-center justify-between",children:[Ut.jsx("div",{className:"text-[32px] font-bold italic",children:"FaceAttend"}),Ut.jsxs("div",{className:"flex gap-4",children:[Ut.jsx(Tv,{to:"/",className:({isActive:n})=>`px-4 py-2 rounded-full transition ${n?"bg-white text-black font-semibold":"hover:bg-red-800"}`,children:"Absensi"}),Ut.jsx(Tv,{to:"/dashboard",className:({isActive:n})=>`px-4 py-2 rounded-full transition ${n?"bg-white text-black font-semibold":"hover:bg-red-800"}`,children:"Dashboard"})]})]})})}function Cgt(){return Ut.jsx(hz,{children:Ut.jsxs("div",{className:"font-sans min-h-screen flex flex-col",children:[Ut.jsx(wgt,{}),Ut.jsx("main",{className:"flex-1",children:Ut.jsxs(BV,{children:[Ut.jsx(Cv,{path:"/",element:Ut.jsx(ugt,{})}),Ut.jsx(Cv,{path:"/dashboard",element:Ut.jsx(vgt,{})})]})}),Ut.jsx(k$,{})]})})}X4.createRoot(document.getElementById("root")).render(Ut.jsx(B4.StrictMode,{children:Ut.jsx(Cgt,{})}));
